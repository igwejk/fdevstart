{"version":3,"sources":["/projects/nodejs/botbuilder/fdevstart/src/../src/model/model.ts"],"names":[],"mappings":"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","file":"model/model.js","sourcesContent":["/**\r\n * Functionality managing the match models\r\n *\r\n * @file\r\n */\r\n\r\nimport * as intf from 'constants';\r\n\r\nimport * as debug from 'debug';\r\n\r\nvar debuglog = debug('model');\r\n\r\nimport *  as IMatch from '../match/ifmatch';\r\n\r\nimport * as Match from '../match/match';\r\n\r\nimport * as fs from 'fs';\r\n\r\nimport * as process from 'process';\r\n\r\ninterface IModels {\r\n    domains: string[],\r\n    tools: IMatch.ITool[],\r\n    category: string[],\r\n    mRules: IMatch.mRule[]\r\n}\r\n\r\n\r\ninterface IModel {\r\n    domain: string,\r\n    tool: IMatch.ITool,\r\n    toolhidden?: boolean,\r\n    synonyms?: { [key: string]: string[] },\r\n    category: string[],\r\n    wordindex: string[],\r\n    hidden: string[]\r\n};\r\n\r\nfunction addSynonyms(synonyms: string[], category: string, synonymFor: string, mRules: Array<IMatch.mRule>) {\r\n    synonyms.forEach(function(syn) {\r\n        mRules.push({\r\n            category: category,\r\n            matchedString: synonymFor,\r\n            type: IMatch.EnumRuleType.WORD,\r\n            word: syn,\r\n            _ranking: 0.95\r\n        });\r\n    });\r\n}\r\n\r\n\r\nfunction loadModelData(oMdl: IModel, sModelName: string, oModel: IModels) {\r\n    // read the data ->\r\n    // data is processed into mRules directly,\r\n    var mdldata = fs.readFileSync('./sensitive/' + sModelName + \".data.json\", 'utf-8');\r\n    var oMdlData = JSON.parse(mdldata);\r\n    oMdlData.forEach(function(oEntry) {\r\n        if (!oEntry.tool) {\r\n            oEntry.tool = oMdl.tool.name;\r\n        }\r\n        oMdl.wordindex.forEach(function(category) {\r\n            if (oMdlData[category] !== \"*\") {\r\n                var sString = oMdlData[category];\r\n                oModel.mRules.push(\r\n                    {\r\n                        category: category,\r\n                        matchedString: sString,\r\n                        type: IMatch.EnumRuleType.WORD,\r\n                        word: sString,\r\n                        _ranking: 0.95\r\n                    });\r\n                if (oMdlData.synonyms && oMdlData.synonyms[category]) {\r\n                    addSynonyms(oMdlData.synonyms[category], category, sString, oModel.mRules);\r\n                }\r\n            }\r\n        });\r\n    });\r\n}\r\n\r\nfunction loadModel(sModelName: string, oModel: IModels) {\r\n    debuglog(\" loading \" + sModelName + \" ....\");\r\n    var mdl = fs.readFileSync('./sensitive/' + sModelName + \".model.json\", 'utf-8');\r\n    var oMdl = JSON.parse(mdl) as IModel;\r\n\r\n    if (oModel.domains.indexOf(oMdl.domain)>= 0) {\r\n        debuglog(\"***********here mdl\" + JSON.stringify(oMdl,undefined, 2));\r\n\r\n        throw new Error('Domain ' + oMdl.domain + ' already loaded while loading ' + sModelName + '?');\r\n    }\r\n    // extract tools an add to tools:\r\n    oModel.tools.filter(function(oEntry) {\r\n        if (oEntry.name === oMdl.tool.name) {\r\n            console.log(\"Tool \" + oMdl.tool.name + \" already present when loading \" + sModelName);\r\n            //throw new Error('Domain already loaded?');\r\n            process.exit(-1);\r\n        }\r\n    });\r\n    // add the tool name as rule unless hidden\r\n    if (!oMdl.toolhidden) {\r\n        oModel.mRules.push({\r\n            category: \"tool\",\r\n            matchedString: oMdl.tool.name,\r\n            type: IMatch.EnumRuleType.WORD,\r\n            word: oMdl.tool.name,\r\n            _ranking: 0.95\r\n        });\r\n    };\r\n    if (oMdl.synonyms && oMdl.synonyms[\"tool\"]) {\r\n        addSynonyms(oMdl.synonyms[\"tool\"], \"tool\", oMdl.tool.name, oModel.mRules);\r\n    };\r\n    if (oMdl.synonyms) {\r\n        Object.keys(oMdl.synonyms).forEach(function(ssynkey) {\r\n            if (oMdl.category.indexOf(ssynkey) >= 0 && ssynkey !== \"tool\") {\r\n                addSynonyms(oMdl.synonyms[ssynkey], \"category\", ssynkey, oModel.mRules);\r\n            }\r\n        });\r\n    }\r\n\r\n    oModel.domains.push(oMdl.domain);\r\n    oModel.tools.push(oMdl.tool);\r\n    oModel.category = oModel.category.concat(oMdl.category);\r\n    oModel.category.sort();\r\n    oModel.category = oModel.category.filter(function(string, index) {\r\n        return oModel.category[index] !== oModel.category[index + 1];\r\n    });\r\n    loadModelData(oMdl, sModelName, oModel);\r\n} // loadmodel\r\n\r\n\r\nexport function loadModels() {\r\n    var oModel: IModels;\r\n    oModel = {\r\n        domains: [],\r\n        tools: [],\r\n        category: [],\r\n        mRules: []\r\n    }\r\n    var smdls = fs.readFileSync('./sensitive/models.json', 'utf-8');\r\n    var mdls = JSON.parse(\"\" + smdls);\r\n    mdls.forEach(function(sModelName) {\r\n        loadModel(sModelName, oModel)\r\n    });\r\n\r\n    // add the categories to the model:\r\n    oModel.category.forEach(function(category) {\r\n        oModel.mRules.push({\r\n            category: \"category\",\r\n            matchedString: category,\r\n            type: IMatch.EnumRuleType.WORD,\r\n            word: category,\r\n            _ranking: 0.95\r\n        });\r\n    });\r\n    return oModel;\r\n}\r\n\r\n\r\n\r\nfunction expandParametersInURL(oMergedContextResult) {\r\n    var ptn = oMergedContextResult.result.pattern\r\n    Object.keys(oMergedContextResult.context).forEach(function(sKey) {\r\n        var regex = new RegExp('{' + sKey + '}', 'g')\r\n        ptn = ptn.replace(regex, oMergedContextResult.context[sKey])\r\n        ptn = ptn.replace(regex, oMergedContextResult.context[sKey])\r\n    })\r\n    return ptn\r\n}\r\n\r\n\r\nimport * as inputFilterRules from '../match/inputFilterRules';\r\n\r\nvar toolExecutors = {\r\n    \"xFLP\": {},\r\n    \"xFLPD\": {},\r\n    \"unit test\": function(match: IMatch.IToolMatch) {\r\n        var unittest = match.toolmatchresult.required[\"unit test\"].matchedString;\r\n        var url = inputFilterRules.getUnitTestUrl(unittest);\r\n        return {\r\n            text: \"starting unit test \\\"\" + unittest + \"\\\"\" + (url ? (' with url ' + url) : 'no url :-('),\r\n            action: { url: url }\r\n        }\r\n    },\r\n    \"wiki\": function(match: IMatch.IToolMatch) {\r\n        var wiki = match.toolmatchresult.required[\"wiki\"].matchedString;\r\n        var url = inputFilterRules.getWikiUrl(wiki);\r\n        return {\r\n            text: \"starting wiki \" + wiki + (url ? (' with url ' + url) : 'no url :-('),\r\n            action: { url: url }\r\n        }\r\n    }\r\n};\r\n\r\nexport function execTool(match: IMatch.IToolMatch, bExplain?: boolean): {\r\n    text: string,\r\n    action: any\r\n} {\r\n    //\r\n    var exec = undefined;\r\n    if (toolExecutors[match.tool.name]) {\r\n        exec = toolExecutors[match.tool.name](match);\r\n\r\n    }\r\n    if (!exec) {\r\n        exec = {\r\n            text: \"don't know how to execute \" + match.tool.name + '\\n'\r\n        }\r\n    }\r\n    if (bExplain) {\r\n        exec.text = exec.text + \"\\n\" + Match.ToolMatch.dumpNice(match);\r\n    }\r\n    return exec;\r\n\r\n    // TODO invoke tool specific starter\r\n    /* if (oMergedContextResult.result.type === 'URL') {\r\n      var ptn = expandParametersInURL(oMergedContextResult)\r\n      startBrowser(ptn)\r\n      return ptn\r\n    } else {\r\n      var s = (\"Don't know how to start \" + oMergedContextResult.result.type + '\\n for \"' + oMergedContextResult.query + '\"')\r\n      debuglog(s)\r\n      return s\r\n    }*/\r\n}\r\n\r\n\r\n//  executeStartup: executeStartup\r\n//}\r\n"],"sourceRoot":"ABC"}