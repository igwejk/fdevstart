/**
 * Functionality managing the match models
 *
 * @file
 */
"use strict";

var debug = require("debug");
var debuglog = debug('model');
var logger = require("../utils/logger");
var loadlog = logger.logger('modelload', '');
var IMatch = require("../match/ifmatch");
var InputFilterRules = require("../match/inputFilterRules");
var Tools = require("../match/tools");
var fs = require("fs");
var Meta = require("./meta");
var Utils = require("../utils/utils");
var CircularSer = require("../utils/circularser");
var process = require("process");
var _ = require("lodash");
exports.global_AddSplits = true; // false;
/**
 * the model path, may be controlled via environment variable
 */
var envModelPath = process.env["ABOT_MODELPATH"] || "testmodel";
var ARR_MODEL_PROPERTIES = ["domain", "bitindex", "defaultkeycolumn", "defaulturi", "categoryDescribed", "columns", "description", "tool", "toolhidden", "synonyms", "category", "wordindex", "exactmatch", "hidden"];
function addSynonyms(synonyms, category, synonymFor, bitindex, mRules, seen) {
    synonyms.forEach(function (syn) {
        var oRule = {
            category: category,
            matchedString: synonymFor,
            type: 0 /* WORD */
            , word: syn,
            bitindex: bitindex,
            _ranking: 0.95
        };
        debuglog(debuglog.enabled ? "inserting synonym" + JSON.stringify(oRule) : '-');
        insertRuleIfNotPresent(mRules, oRule, seen);
    });
}
function getRuleKey(rule) {
    var r1 = rule.matchedString + "-|-" + rule.category + " -|- " + rule.type + " -|- " + rule.word + " ";
    if (rule.range) {
        var r2 = getRuleKey(rule.range.rule);
        r1 += " -|- " + rule.range.low + "/" + rule.range.high + " -|- " + r2;
    }
    return r1;
}
var Breakdown = require("../match/breakdown");
/* given a rule which represents a word sequence which is split during tokenization */
function addBestSplit(mRules, rule, seenRules) {
    if (!exports.global_AddSplits) {
        return;
    }
    if (rule.type !== 0 /* WORD */) {
            return;
        }
    var best = Breakdown.makeMatchPattern(rule.lowercaseword);
    if (!best) {
        return;
    }
    var newRule = {
        category: rule.category,
        matchedString: rule.matchedString,
        bitindex: rule.bitindex,
        word: best.longestToken,
        type: 0,
        lowercaseword: best.longestToken,
        _ranking: 0.95,
        //    exactOnly : rule.exactOnly,
        range: best.span
    };
    if (rule.exactOnly) {
        newRule.exactOnly = rule.exactOnly;
    }
    ;
    newRule.range.rule = rule;
    insertRuleIfNotPresent(mRules, newRule, seenRules);
}
exports.addBestSplit = addBestSplit;
function insertRuleIfNotPresent(mRules, rule, seenRules) {
    if (rule.type !== 0 /* WORD */) {
            mRules.push(rule);
            return;
        }
    if (rule.word === undefined || rule.matchedString === undefined) {
        throw new Error('illegal rule' + JSON.stringify(rule, undefined, 2));
    }
    var r = getRuleKey(rule);
    /* if( (rule.word === "service" || rule.word=== "services") && r.indexOf('OData') >= 0) {
         console.log("rulekey is" + r);
         console.log("presence is " + JSON.stringify(seenRules[r]));
     }*/
    rule.lowercaseword = rule.word.toLowerCase();
    if (seenRules[r]) {
        debuglog(debuglog.enabled ? "Attempting to insert duplicate" + JSON.stringify(rule, undefined, 2) : "-");
        var duplicates = seenRules[r].filter(function (oEntry) {
            return 0 === InputFilterRules.compareMRuleFull(oEntry, rule);
        });
        if (duplicates.length > 0) {
            return;
        }
    }
    seenRules[r] = seenRules[r] || [];
    seenRules[r].push(rule);
    if (rule.word === "") {
        debuglog(debuglog.enabled ? 'Skipping rule with emtpy word ' + JSON.stringify(rule, undefined, 2) : '-');
        loadlog('Skipping rule with emtpy word ' + JSON.stringify(rule, undefined, 2));
        return;
    }
    mRules.push(rule);
    addBestSplit(mRules, rule, seenRules);
    return;
}
function loadModelData(modelPath, oMdl, sModelName, oModel) {
    // read the data ->
    // data is processed into mRules directly,
    var bitindex = oMdl.bitindex;
    var sFileName = './' + modelPath + '/' + sModelName + ".data.json";
    var mdldata = fs.readFileSync(sFileName, 'utf-8');
    var oMdlData = JSON.parse(mdldata);
    oMdlData.forEach(function (oEntry) {
        if (!oEntry.tool) {
            oEntry._domain = oMdl.domain;
        }
        if (!oEntry.tool && oMdl.tool.name) {
            oEntry.tool = oMdl.tool.name;
        }
        oModel.records.push(oEntry);
        oMdl.category.forEach(function (cat) {
            if (oEntry[cat] === 'undefined') {
                oEntry[cat] = "n/a";
                var bug = "INCONSISTENT*> ModelData " + sFileName + " does not contain category " + cat + " with value 'undefined', undefined is illegal value, use n/a " + JSON.stringify(oEntry) + "";
                debuglog(bug);
            }
        });
        oMdl.wordindex.forEach(function (category) {
            if (oEntry[category] === undefined) {
                debuglog("INCONSISTENT*> ModelData " + sFileName + " does not contain category " + category + " of wordindex" + JSON.stringify(oEntry) + "");
                return;
            }
            if (oEntry[category] !== "*") {
                var sString = oEntry[category];
                debuglog("pushing rule with " + category + " -> " + sString);
                var oRule = {
                    category: category,
                    matchedString: sString,
                    type: 0 /* WORD */
                    , word: sString,
                    bitindex: bitindex,
                    _ranking: 0.95
                };
                if (oMdl.exactmatch && oMdl.exactmatch.indexOf(category) >= 0) {
                    oRule.exactOnly = true;
                }
                insertRuleIfNotPresent(oModel.mRules, oRule, oModel.seenRules);
                if (oMdlData.synonyms && oMdlData.synonyms[category]) {
                    addSynonyms(oMdlData.synonyms[category], category, sString, bitindex, oModel.mRules, oModel.seenRules);
                }
                if (oEntry.synonyms && oEntry.synonyms[category]) {
                    addSynonyms(oEntry.synonyms[category], category, sString, bitindex, oModel.mRules, oModel.seenRules);
                }
            }
        });
    });
}
function loadModel(modelPath, sModelName, oModel) {
    debuglog(" loading " + sModelName + " ....");
    var mdl = fs.readFileSync('./' + modelPath + '/' + sModelName + ".model.json", 'utf-8');
    var oMdl = JSON.parse(mdl);
    mergeModelJson(sModelName, oMdl, oModel);
    loadModelData(modelPath, oMdl, sModelName, oModel);
}
function getDomainBitIndex(domain, oModel) {
    var index = oModel.domains.indexOf(domain);
    if (index < 0) {
        index = oModel.domains.length;
    }
    if (index >= 32) {
        throw new Error("too many domain for single 32 bit index");
    }
    return 0x0001 << index;
}
exports.getDomainBitIndex = getDomainBitIndex;
function mergeModelJson(sModelName, oMdl, oModel) {
    var categoryDescribedMap = {};
    oMdl.bitindex = getDomainBitIndex(oMdl.domain, oModel);
    oMdl.categoryDescribed = [];
    // rectify category
    oMdl.category = oMdl.category.map(function (cat) {
        if (typeof cat === "string") {
            return cat;
        }
        if (typeof cat.name !== "string") {
            console.log("Missing name in object typed category in " + JSON.stringify(cat) + " in model " + sModelName);
            process.exit(-1);
        }
        categoryDescribedMap[cat.name] = cat;
        oMdl.categoryDescribed.push(cat);
        return cat.name;
    });
    // add the categories to the model:
    oMdl.category.forEach(function (category) {
        insertRuleIfNotPresent(oModel.mRules, {
            category: "category",
            matchedString: category,
            type: 0 /* WORD */
            , word: category,
            lowercaseword: category.toLowerCase(),
            bitindex: oMdl.bitindex,
            _ranking: 0.95
        }, oModel.seenRules);
    });
    if (oModel.domains.indexOf(oMdl.domain) >= 0) {
        debuglog("***********here mdl" + JSON.stringify(oMdl, undefined, 2));
        throw new Error('Domain ' + oMdl.domain + ' already loaded while loading ' + sModelName + '?');
    }
    // check properties of model
    Object.keys(oMdl).sort().forEach(function (sProperty) {
        if (ARR_MODEL_PROPERTIES.indexOf(sProperty) < 0) {
            throw new Error('Model property "' + sProperty + '" not a known model property in model of domain ' + oMdl.domain + ' ');
        }
    });
    // consider streamlining the categories
    oModel.rawModels[oMdl.domain] = oMdl;
    oModel.full.domain[oMdl.domain] = {
        description: oMdl.description,
        categories: categoryDescribedMap,
        bitindex: oMdl.bitindex
    };
    // check that
    // check that members of wordindex are in categories,
    oMdl.wordindex = oMdl.wordindex || [];
    oMdl.wordindex.forEach(function (sWordIndex) {
        if (oMdl.category.indexOf(sWordIndex) < 0) {
            throw new Error('Model wordindex "' + sWordIndex + '" not a category of domain ' + oMdl.domain + ' ');
        }
    });
    oMdl.exactmatch = oMdl.exactmatch || [];
    oMdl.exactmatch.forEach(function (sExactMatch) {
        if (oMdl.category.indexOf(sExactMatch) < 0) {
            throw new Error('Model exactmatch "' + sExactMatch + '" not a category of domain ' + oMdl.domain + ' ');
        }
    });
    oMdl.columns = oMdl.columns || [];
    oMdl.columns.forEach(function (sExactMatch) {
        if (oMdl.category.indexOf(sExactMatch) < 0) {
            throw new Error('Model column "' + sExactMatch + '" not a category of domain ' + oMdl.domain + ' ');
        }
    });
    // add relation domain -> category
    var domainStr = MetaF.Domain(oMdl.domain).toFullString();
    var relationStr = MetaF.Relation(Meta.RELATION_hasCategory).toFullString();
    var reverseRelationStr = MetaF.Relation(Meta.RELATION_isCategoryOf).toFullString();
    oMdl.category.forEach(function (sCategory) {
        var CategoryString = MetaF.Category(sCategory).toFullString();
        oModel.meta.t3[domainStr] = oModel.meta.t3[domainStr] || {};
        oModel.meta.t3[domainStr][relationStr] = oModel.meta.t3[domainStr][relationStr] || {};
        oModel.meta.t3[domainStr][relationStr][CategoryString] = {};
        oModel.meta.t3[CategoryString] = oModel.meta.t3[CategoryString] || {};
        oModel.meta.t3[CategoryString][reverseRelationStr] = oModel.meta.t3[CategoryString][reverseRelationStr] || {};
        oModel.meta.t3[CategoryString][reverseRelationStr][domainStr] = {};
    });
    // add a precice domain matchrule
    insertRuleIfNotPresent(oModel.mRules, {
        category: "domain",
        matchedString: oMdl.domain,
        type: 0 /* WORD */
        , word: oMdl.domain,
        bitindex: oMdl.bitindex,
        _ranking: 0.95
    }, oModel.seenRules);
    // check the tool
    if (oMdl.tool && oMdl.tool.requires) {
        var requires = Object.keys(oMdl.tool.requires || {});
        var diff = _.difference(requires, oMdl.category);
        if (diff.length > 0) {
            console.log(" " + oMdl.domain + " : Unkown category in requires of tool: \"" + diff.join('"') + '"');
            process.exit(-1);
        }
        var optional = Object.keys(oMdl.tool.optional);
        diff = _.difference(optional, oMdl.category);
        if (diff.length > 0) {
            console.log(" " + oMdl.domain + " : Unkown category optional of tool: \"" + diff.join('"') + '"');
            process.exit(-1);
        }
        Object.keys(oMdl.tool.sets || {}).forEach(function (setID) {
            var diff = _.difference(oMdl.tool.sets[setID].set, oMdl.category);
            if (diff.length > 0) {
                console.log(" " + oMdl.domain + " : Unkown category in setId " + setID + " of tool: \"" + diff.join('"') + '"');
                process.exit(-1);
            }
        });
        // extract tools an add to tools:
        oModel.tools.filter(function (oEntry) {
            if (oEntry.name === (oMdl.tool && oMdl.tool.name)) {
                console.log("Tool " + oMdl.tool.name + " already present when loading " + sModelName);
                //throw new Error('Domain already loaded?');
                process.exit(-1);
            }
        });
    } else {
        oMdl.toolhidden = true;
        oMdl.tool.requires = { "impossible": {} };
    }
    // add the tool name as rule unless hidden
    if (!oMdl.toolhidden && oMdl.tool && oMdl.tool.name) {
        insertRuleIfNotPresent(oModel.mRules, {
            category: "tool",
            matchedString: oMdl.tool.name,
            type: 0 /* WORD */
            , word: oMdl.tool.name,
            bitindex: oMdl.bitindex,
            _ranking: 0.95
        }, oModel.seenRules);
    }
    ;
    if (oMdl.synonyms && oMdl.synonyms["tool"]) {
        addSynonyms(oMdl.synonyms["tool"], "tool", oMdl.tool.name, oMdl.bitindex, oModel.mRules, oModel.seenRules);
    }
    ;
    if (oMdl.synonyms) {
        Object.keys(oMdl.synonyms).forEach(function (ssynkey) {
            if (oMdl.category.indexOf(ssynkey) >= 0 && ssynkey !== "tool") {
                if (oModel.full.domain[oMdl.domain].categories[ssynkey]) {
                    oModel.full.domain[oMdl.domain].categories[ssynkey].synonyms = oMdl.synonyms[ssynkey];
                }
                addSynonyms(oMdl.synonyms[ssynkey], "category", ssynkey, oMdl.bitindex, oModel.mRules, oModel.seenRules);
            }
        });
    }
    oModel.domains.push(oMdl.domain);
    if (oMdl.tool.name) {
        oModel.tools.push(oMdl.tool);
    }
    oModel.category = oModel.category.concat(oMdl.category);
    oModel.category.sort();
    oModel.category = oModel.category.filter(function (string, index) {
        return oModel.category[index] !== oModel.category[index + 1];
    });
} // loadmodel
function splitRules(rules) {
    var res = {};
    var nonWordRules = [];
    rules.forEach(function (rule) {
        if (rule.type === 0 /* WORD */) {
                if (!rule.lowercaseword) {
                    throw new Error("Rule has no member lowercaseword" + JSON.stringify(rule));
                }
                res[rule.lowercaseword] = res[rule.lowercaseword] || { bitindex: 0, rules: [] };
                res[rule.lowercaseword].bitindex = res[rule.lowercaseword].bitindex | rule.bitindex;
                res[rule.lowercaseword].rules.push(rule);
            } else {
            nonWordRules.push(rule);
        }
    });
    return {
        wordMap: res,
        nonWordRules: nonWordRules,
        allRules: rules
    };
}
exports.splitRules = splitRules;
function cmpLengthSort(a, b) {
    var d = a.length - b.length;
    if (d) {
        return d;
    }
    return a.localeCompare(b);
}
var Distance = require("../utils/damerauLevenshtein");
var Algol = require("../match/algol");
// offset[0] : len-2
//             len -1
//             len
//             len +1
//             len +2
//             len +3
function findNextLen(targetLen, arr, offsets) {
    offsets.shift();
    for (var i = offsets[4]; i < arr.length && arr[i].length <= targetLen; ++i) {}
    //console.log("pushing " + i);
    offsets.push(i);
}
exports.findNextLen = findNextLen;
function addRangeRulesUnlessPresent(rules, lcword, rangeRules, presentRulesForKey, seenRules) {
    rangeRules.forEach(function (rangeRule) {
        var newRule = Object.assign({}, rangeRule);
        newRule.lowercaseword = lcword;
        newRule.word = lcword;
        //if((lcword === 'services' || lcword === 'service') && newRule.range.rule.lowercaseword.indexOf('odata')>=0) {
        //    console.log("adding "+ JSON.stringify(newRule) + "\n");
        //}
        //todo: check whether an equivalent rule is already present?
        var cnt = rules.length;
        insertRuleIfNotPresent(rules, newRule, seenRules);
    });
}
exports.addRangeRulesUnlessPresent = addRangeRulesUnlessPresent;
function addCloseExactRangeRules(rules, seenRules) {
    var keysMap = {};
    var rangeKeysMap = {};
    rules.forEach(function (rule) {
        if (rule.type === 0 /* WORD */) {
                //keysMap[rule.lowercaseword] = 1;
                keysMap[rule.lowercaseword] = keysMap[rule.lowercaseword] || [];
                keysMap[rule.lowercaseword].push(rule);
                if (!rule.exactOnly && rule.range) {
                    rangeKeysMap[rule.lowercaseword] = rangeKeysMap[rule.lowercaseword] || [];
                    rangeKeysMap[rule.lowercaseword].push(rule);
                }
            }
    });
    var keys = Object.keys(keysMap);
    keys.sort(cmpLengthSort);
    var len = 0;
    keys.forEach(function (key, index) {
        if (key.length != len) {}
        len = key.length;
    });
    //   keys = keys.slice(0,2000);
    var rangeKeys = Object.keys(rangeKeysMap);
    rangeKeys.sort(cmpLengthSort);
    //console.log(` ${keys.length} keys and ${rangeKeys.length} rangekeys `);
    var low = 0;
    var high = 0;
    var lastlen = 0;
    var offsets = [0, 0, 0, 0, 0, 0];
    var len = rangeKeys.length;
    findNextLen(0, keys, offsets);
    findNextLen(1, keys, offsets);
    findNextLen(2, keys, offsets);
    rangeKeys.forEach(function (rangeKey) {
        if (rangeKey.length !== lastlen) {
            for (i = lastlen + 1; i <= rangeKey.length; ++i) {
                findNextLen(i + 2, keys, offsets);
            }
            //   console.log(` shifted to ${rangeKey.length} with offsets beeing ${offsets.join(' ')}`);
            //   console.log(` here 0 ${offsets[0]} : ${keys[Math.min(keys.length-1, offsets[0])].length}  ${keys[Math.min(keys.length-1, offsets[0])]} `);
            //  console.log(` here 5-1  ${keys[offsets[5]-1].length}  ${keys[offsets[5]-1]} `);
            //   console.log(` here 5 ${offsets[5]} : ${keys[Math.min(keys.length-1, offsets[5])].length}  ${keys[Math.min(keys.length-1, offsets[5])]} `);
            lastlen = rangeKey.length;
        }
        for (var i = offsets[0]; i < offsets[5]; ++i) {
            var d = Distance.calcDistanceAdjusted(rangeKey, keys[i]);
            // console.log(`${rangeKey.length-keys[i].length} ${d} ${rangeKey} and ${keys[i]}  `);
            if (d !== 1.0 && d >= Algol.Cutoff_rangeCloseMatch) {
                //console.log(`would add ${rangeKey} for ${keys[i]} ${d}`);
                var cnt = rules.length;
                // we only have to add if there is not yet a match rule here which points to the same
                addRangeRulesUnlessPresent(rules, keys[i], rangeKeysMap[rangeKey], keysMap[keys[i]], seenRules);
                if (rules.length > cnt) {}
            }
        }
    });
    /*
    [
        ['aEFG','aEFGH'],
        ['aEFGH','aEFGHI'],
        ['Odata','ODatas'],
    ['Odata','Odatas'],
    ['Odata','Odatb'],
    ['Odata','UData'],
    ['service','services'],
    ['this isfunny and more','this isfunny and mores'],
    ].forEach(rec => {
        console.log(`distance ${rec[0]} ${rec[1]} : ${Distance.calcDistance(rec[0],rec[1])}  adf ${Distance.calcDistanceAdjusted(rec[0],rec[1])} `);
     });
    console.log("distance Odata Udata"+ Distance.calcDistance('OData','UData'));
    console.log("distance Odata Odatb"+ Distance.calcDistance('OData','ODatb'));
    console.log("distance Odatas Odata"+ Distance.calcDistance('OData','ODataa'));
    console.log("distance Odatas abcde"+ Distance.calcDistance('abcde','abcdef'));
    console.log("distance services "+ Distance.calcDistance('services','service'));
    */
}
exports.addCloseExactRangeRules = addCloseExactRangeRules;
var n = 0;
function loadModels(modelPath, addSplits) {
    var oModel;
    oModel = {
        full: { domain: {} },
        rawModels: {},
        domains: [],
        tools: [],
        rules: undefined,
        category: [],
        operators: {},
        mRules: [],
        seenRules: {},
        records: [],
        meta: { t3: {} }
    };
    exports.global_AddSplits = true; // addSplits || !process.env.ABOT_OLDMATCH;
    modelPath = modelPath || envModelPath;
    try {
        var a = CircularSer.load('./' + modelPath + '/_cache' + !!addSplits + '.js');
        //console.log("found a cache ?  " + !!a);
        //a = undefined;
        if (a) {
            debuglog(" return preparese model ");
            return a;
        }
    } catch (e) {}
    var smdls = fs.readFileSync('./' + modelPath + '/models.json', 'utf-8');
    var mdls = JSON.parse("" + smdls);
    mdls.forEach(function (sModelName) {
        loadModel(modelPath, sModelName, oModel);
    });
    // add the categories to the model:
    /*
    oModel.category.forEach(function (category) {
        insertRuleIfNotPresent(oModel.mRules, {
            category: "category",
            matchedString: category,
            type: IMatch.EnumRuleType.WORD,
            word: category,
            lowercaseword: category.toLowerCase(),
            bitindex : oMdl.
            _ranking: 0.95
        }, oModel.seenRules);
    });
    */
    var metaBitIndex = getDomainBitIndex('meta', oModel);
    // add the domain meta rule
    insertRuleIfNotPresent(oModel.mRules, {
        category: "meta",
        matchedString: "domain",
        type: 0 /* WORD */
        , word: "domain",
        bitindex: metaBitIndex,
        _ranking: 0.95
    }, oModel.seenRules);
    var fillerBitIndex = getDomainBitIndex('meta', oModel);
    //add a filler rule
    var sfillers = fs.readFileSync('./' + modelPath + '/filler.json', 'utf-8');
    var fillers = JSON.parse(sfillers);
    var re = "^((" + fillers.join(")|(") + "))$";
    oModel.mRules.push({
        category: "filler",
        type: 1 /* REGEXP */
        , regexp: new RegExp(re, "i"),
        matchedString: "filler",
        bitindex: fillerBitIndex,
        _ranking: 0.9
    });
    //add operators
    var sOperators = fs.readFileSync('./resources/model/operators.json', 'utf-8');
    var operators = JSON.parse(sOperators);
    var operatorBitIndex = getDomainBitIndex('operators', oModel);
    Object.keys(operators.operators).forEach(function (operator) {
        if (IMatch.aOperatorNames.indexOf(operator) < 0) {
            debuglog("unknown operator " + operator);
            throw new Error("unknown operator " + operator);
        }
        oModel.operators[operator] = operators.operators[operator];
        oModel.operators[operator].operator = operator;
        Object.freeze(oModel.operators[operator]);
        var word = operator;
        insertRuleIfNotPresent(oModel.mRules, {
            category: "operator",
            word: word.toLowerCase(),
            lowercaseword: word.toLowerCase(),
            type: 0 /* WORD */
            , matchedString: word,
            bitindex: operatorBitIndex,
            _ranking: 0.9
        }, oModel.seenRules);
        // add all synonyms
        if (operators.synonyms[operator]) {
            Object.keys(operators.synonyms[operator]).forEach(function (synonym) {
                insertRuleIfNotPresent(oModel.mRules, {
                    category: "operator",
                    word: synonym.toLowerCase(),
                    lowercaseword: synonym.toLowerCase(),
                    type: 0 /* WORD */
                    , matchedString: operator,
                    bitindex: operatorBitIndex,
                    _ranking: 0.9
                }, oModel.seenRules);
            });
        }
    });
    /*
        })
            {
          category: "filler",
          type: 1,
          regexp: /^((start)|(show)|(from)|(in))$/i,
          matchedString: "filler",
          _ranking: 0.9
        },
    */
    oModel.mRules = oModel.mRules.sort(InputFilterRules.cmpMRule);
    addCloseExactRangeRules(oModel.mRules, oModel.seenRules);
    oModel.mRules = oModel.mRules.sort(InputFilterRules.cmpMRule);
    if (global && global.gc) {
        global.gc();
    }
    oModel.rules = splitRules(oModel.mRules);
    if (global && global.gc) {
        global.gc();
    }
    oModel.tools = oModel.tools.sort(Tools.cmpTools);
    delete oModel.seenRules;
    debuglog('saving');
    if (global && global.gc) {
        global.gc();
    }
    CircularSer.save('./' + modelPath + '/_cache' + !!addSplits + '.js', oModel);
    if (global && global.gc) {
        global.gc();
    }
    return oModel;
}
exports.loadModels = loadModels;
function sortCategoriesByImportance(map, cats) {
    var res = cats.slice(0);
    res.sort(rankCategoryByImportance.bind(undefined, map));
    return res;
}
exports.sortCategoriesByImportance = sortCategoriesByImportance;
function rankCategoryByImportance(map, cata, catb) {
    var catADesc = map[cata];
    var catBDesc = map[catb];
    if (cata === catb) {
        return 0;
    }
    // if a is before b, return -1
    if (catADesc && !catBDesc) {
        return -1;
    }
    if (!catADesc && catBDesc) {
        return +1;
    }
    var prioA = catADesc && catADesc.importance || 99;
    var prioB = catBDesc && catBDesc.importance || 99;
    // lower prio goes to front
    var r = prioA - prioB;
    if (r) {
        return r;
    }
    return cata.localeCompare(catb);
}
exports.rankCategoryByImportance = rankCategoryByImportance;
var MetaF = Meta.getMetaFactory();
function getOperator(mdl, operator) {
    return mdl.operators[operator];
}
exports.getOperator = getOperator;
function getResultAsArray(mdl, a, rel) {
    if (rel.toType() !== 'relation') {
        throw new Error("expect relation as 2nd arg");
    }
    var res = mdl.meta.t3[a.toFullString()] && mdl.meta.t3[a.toFullString()][rel.toFullString()];
    if (!res) {
        return [];
    }
    return Object.getOwnPropertyNames(res).sort().map(MetaF.parseIMeta);
}
exports.getResultAsArray = getResultAsArray;
function getCategoriesForDomain(theModel, domain) {
    if (theModel.domains.indexOf(domain) < 0) {
        throw new Error("Domain \"" + domain + "\" not part of model");
    }
    var res = getResultAsArray(theModel, MetaF.Domain(domain), MetaF.Relation(Meta.RELATION_hasCategory));
    return Meta.getStringArray(res);
}
exports.getCategoriesForDomain = getCategoriesForDomain;
function getTableColumns(theModel, domain) {
    if (theModel.domains.indexOf(domain) < 0) {
        throw new Error("Domain \"" + domain + "\" not part of model");
    }
    return theModel.rawModels[domain].columns.slice(0);
}
exports.getTableColumns = getTableColumns;
/**
 * Return all categories of a domain which can appear on a word,
 * these are typically the wordindex domains + entries generated by generic rules
 *
 * The current implementation is a simplification
 */
function getPotentialWordCategoriesForDomain(theModel, domain) {
    // this is a simplified version
    return getCategoriesForDomain(theModel, domain);
}
exports.getPotentialWordCategoriesForDomain = getPotentialWordCategoriesForDomain;
function getDomainsForCategory(theModel, category) {
    if (theModel.category.indexOf(category) < 0) {
        throw new Error("Category \"" + category + "\" not part of model");
    }
    var res = getResultAsArray(theModel, MetaF.Category(category), MetaF.Relation(Meta.RELATION_isCategoryOf));
    return Meta.getStringArray(res);
}
exports.getDomainsForCategory = getDomainsForCategory;
function getAllRecordCategoriesForTargetCategory(model, category, wordsonly) {
    var res = {};
    //
    var fn = wordsonly ? getPotentialWordCategoriesForDomain : getCategoriesForDomain;
    var domains = getDomainsForCategory(model, category);
    domains.forEach(function (domain) {
        fn(model, domain).forEach(function (wordcat) {
            res[wordcat] = true;
        });
    });
    Object.freeze(res);
    return res;
}
exports.getAllRecordCategoriesForTargetCategory = getAllRecordCategoriesForTargetCategory;
function getAllRecordCategoriesForTargetCategories(model, categories, wordsonly) {
    var res = {};
    //
    var fn = wordsonly ? getPotentialWordCategoriesForDomain : getCategoriesForDomain;
    var domains = undefined;
    categories.forEach(function (category) {
        var catdomains = getDomainsForCategory(model, category);
        if (!domains) {
            domains = catdomains;
        } else {
            domains = _.intersection(domains, catdomains);
        }
    });
    if (domains.length === 0) {
        throw new Error('categories ' + Utils.listToQuotedCommaAnd(categories) + ' have no common domain.');
    }
    domains.forEach(function (domain) {
        fn(model, domain).forEach(function (wordcat) {
            res[wordcat] = true;
        });
    });
    Object.freeze(res);
    return res;
}
exports.getAllRecordCategoriesForTargetCategories = getAllRecordCategoriesForTargetCategories;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9tb2RlbC9tb2RlbC50cyIsIm1vZGVsL21vZGVsLmpzIl0sIm5hbWVzIjpbImRlYnVnIiwicmVxdWlyZSIsImRlYnVnbG9nIiwibG9nZ2VyIiwibG9hZGxvZyIsIklNYXRjaCIsIklucHV0RmlsdGVyUnVsZXMiLCJUb29scyIsImZzIiwiTWV0YSIsIlV0aWxzIiwiQ2lyY3VsYXJTZXIiLCJwcm9jZXNzIiwiXyIsImV4cG9ydHMiLCJnbG9iYWxfQWRkU3BsaXRzIiwiZW52TW9kZWxQYXRoIiwiZW52IiwiQVJSX01PREVMX1BST1BFUlRJRVMiLCJhZGRTeW5vbnltcyIsInN5bm9ueW1zIiwiY2F0ZWdvcnkiLCJzeW5vbnltRm9yIiwiYml0aW5kZXgiLCJtUnVsZXMiLCJzZWVuIiwiZm9yRWFjaCIsInN5biIsIm9SdWxlIiwibWF0Y2hlZFN0cmluZyIsInR5cGUiLCJ3b3JkIiwiX3JhbmtpbmciLCJlbmFibGVkIiwiSlNPTiIsInN0cmluZ2lmeSIsImluc2VydFJ1bGVJZk5vdFByZXNlbnQiLCJnZXRSdWxlS2V5IiwicnVsZSIsInIxIiwicmFuZ2UiLCJyMiIsImxvdyIsImhpZ2giLCJCcmVha2Rvd24iLCJhZGRCZXN0U3BsaXQiLCJzZWVuUnVsZXMiLCJiZXN0IiwibWFrZU1hdGNoUGF0dGVybiIsImxvd2VyY2FzZXdvcmQiLCJuZXdSdWxlIiwibG9uZ2VzdFRva2VuIiwic3BhbiIsImV4YWN0T25seSIsInB1c2giLCJ1bmRlZmluZWQiLCJFcnJvciIsInIiLCJ0b0xvd2VyQ2FzZSIsImR1cGxpY2F0ZXMiLCJmaWx0ZXIiLCJvRW50cnkiLCJjb21wYXJlTVJ1bGVGdWxsIiwibGVuZ3RoIiwibG9hZE1vZGVsRGF0YSIsIm1vZGVsUGF0aCIsIm9NZGwiLCJzTW9kZWxOYW1lIiwib01vZGVsIiwic0ZpbGVOYW1lIiwibWRsZGF0YSIsInJlYWRGaWxlU3luYyIsIm9NZGxEYXRhIiwicGFyc2UiLCJ0b29sIiwiX2RvbWFpbiIsImRvbWFpbiIsIm5hbWUiLCJyZWNvcmRzIiwiY2F0IiwiYnVnIiwid29yZGluZGV4Iiwic1N0cmluZyIsImV4YWN0bWF0Y2giLCJpbmRleE9mIiwibG9hZE1vZGVsIiwibWRsIiwibWVyZ2VNb2RlbEpzb24iLCJnZXREb21haW5CaXRJbmRleCIsImluZGV4IiwiZG9tYWlucyIsImNhdGVnb3J5RGVzY3JpYmVkTWFwIiwiY2F0ZWdvcnlEZXNjcmliZWQiLCJtYXAiLCJjb25zb2xlIiwibG9nIiwiZXhpdCIsIk9iamVjdCIsImtleXMiLCJzb3J0Iiwic1Byb3BlcnR5IiwicmF3TW9kZWxzIiwiZnVsbCIsImRlc2NyaXB0aW9uIiwiY2F0ZWdvcmllcyIsInNXb3JkSW5kZXgiLCJzRXhhY3RNYXRjaCIsImNvbHVtbnMiLCJkb21haW5TdHIiLCJNZXRhRiIsIkRvbWFpbiIsInRvRnVsbFN0cmluZyIsInJlbGF0aW9uU3RyIiwiUmVsYXRpb24iLCJSRUxBVElPTl9oYXNDYXRlZ29yeSIsInJldmVyc2VSZWxhdGlvblN0ciIsIlJFTEFUSU9OX2lzQ2F0ZWdvcnlPZiIsInNDYXRlZ29yeSIsIkNhdGVnb3J5U3RyaW5nIiwiQ2F0ZWdvcnkiLCJtZXRhIiwidDMiLCJyZXF1aXJlcyIsImRpZmYiLCJkaWZmZXJlbmNlIiwiam9pbiIsIm9wdGlvbmFsIiwic2V0cyIsInNldElEIiwic2V0IiwidG9vbHMiLCJ0b29saGlkZGVuIiwic3N5bmtleSIsImNvbmNhdCIsInN0cmluZyIsInNwbGl0UnVsZXMiLCJydWxlcyIsInJlcyIsIm5vbldvcmRSdWxlcyIsIndvcmRNYXAiLCJhbGxSdWxlcyIsImNtcExlbmd0aFNvcnQiLCJhIiwiYiIsImQiLCJsb2NhbGVDb21wYXJlIiwiRGlzdGFuY2UiLCJBbGdvbCIsImZpbmROZXh0TGVuIiwidGFyZ2V0TGVuIiwiYXJyIiwib2Zmc2V0cyIsInNoaWZ0IiwiaSIsImFkZFJhbmdlUnVsZXNVbmxlc3NQcmVzZW50IiwibGN3b3JkIiwicmFuZ2VSdWxlcyIsInByZXNlbnRSdWxlc0ZvcktleSIsInJhbmdlUnVsZSIsImFzc2lnbiIsImNudCIsImFkZENsb3NlRXhhY3RSYW5nZVJ1bGVzIiwia2V5c01hcCIsInJhbmdlS2V5c01hcCIsImxlbiIsImtleSIsInJhbmdlS2V5cyIsImxhc3RsZW4iLCJyYW5nZUtleSIsImNhbGNEaXN0YW5jZUFkanVzdGVkIiwiQ3V0b2ZmX3JhbmdlQ2xvc2VNYXRjaCIsIm4iLCJsb2FkTW9kZWxzIiwiYWRkU3BsaXRzIiwib3BlcmF0b3JzIiwibG9hZCIsImUiLCJzbWRscyIsIm1kbHMiLCJtZXRhQml0SW5kZXgiLCJmaWxsZXJCaXRJbmRleCIsInNmaWxsZXJzIiwiZmlsbGVycyIsInJlIiwicmVnZXhwIiwiUmVnRXhwIiwic09wZXJhdG9ycyIsIm9wZXJhdG9yQml0SW5kZXgiLCJvcGVyYXRvciIsImFPcGVyYXRvck5hbWVzIiwiZnJlZXplIiwic3lub255bSIsImNtcE1SdWxlIiwiZ2xvYmFsIiwiZ2MiLCJjbXBUb29scyIsInNhdmUiLCJzb3J0Q2F0ZWdvcmllc0J5SW1wb3J0YW5jZSIsImNhdHMiLCJzbGljZSIsInJhbmtDYXRlZ29yeUJ5SW1wb3J0YW5jZSIsImJpbmQiLCJjYXRhIiwiY2F0YiIsImNhdEFEZXNjIiwiY2F0QkRlc2MiLCJwcmlvQSIsImltcG9ydGFuY2UiLCJwcmlvQiIsImdldE1ldGFGYWN0b3J5IiwiZ2V0T3BlcmF0b3IiLCJnZXRSZXN1bHRBc0FycmF5IiwicmVsIiwidG9UeXBlIiwiZ2V0T3duUHJvcGVydHlOYW1lcyIsInBhcnNlSU1ldGEiLCJnZXRDYXRlZ29yaWVzRm9yRG9tYWluIiwidGhlTW9kZWwiLCJnZXRTdHJpbmdBcnJheSIsImdldFRhYmxlQ29sdW1ucyIsImdldFBvdGVudGlhbFdvcmRDYXRlZ29yaWVzRm9yRG9tYWluIiwiZ2V0RG9tYWluc0ZvckNhdGVnb3J5IiwiZ2V0QWxsUmVjb3JkQ2F0ZWdvcmllc0ZvclRhcmdldENhdGVnb3J5IiwibW9kZWwiLCJ3b3Jkc29ubHkiLCJmbiIsIndvcmRjYXQiLCJnZXRBbGxSZWNvcmRDYXRlZ29yaWVzRm9yVGFyZ2V0Q2F0ZWdvcmllcyIsImNhdGRvbWFpbnMiLCJpbnRlcnNlY3Rpb24iLCJsaXN0VG9RdW90ZWRDb21tYUFuZCJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7O0FDS0E7O0FERUEsSUFBQUEsUUFBQUMsUUFBQSxPQUFBLENBQUE7QUFFQSxJQUFJQyxXQUFXRixNQUFNLE9BQU4sQ0FBZjtBQUVBLElBQUFHLFNBQUFGLFFBQUEsaUJBQUEsQ0FBQTtBQUVBLElBQU1HLFVBQVVELE9BQU9BLE1BQVAsQ0FBYyxXQUFkLEVBQTJCLEVBQTNCLENBQWhCO0FBRUEsSUFBQUUsU0FBQUosUUFBQSxrQkFBQSxDQUFBO0FBRUEsSUFBQUssbUJBQUFMLFFBQUEsMkJBQUEsQ0FBQTtBQUNBLElBQUFNLFFBQUFOLFFBQUEsZ0JBQUEsQ0FBQTtBQUNBLElBQUFPLEtBQUFQLFFBQUEsSUFBQSxDQUFBO0FBQ0EsSUFBQVEsT0FBQVIsUUFBQSxRQUFBLENBQUE7QUFDQSxJQUFBUyxRQUFBVCxRQUFBLGdCQUFBLENBQUE7QUFDQSxJQUFBVSxjQUFBVixRQUFBLHNCQUFBLENBQUE7QUFFQSxJQUFBVyxVQUFBWCxRQUFBLFNBQUEsQ0FBQTtBQUNBLElBQUFZLElBQUFaLFFBQUEsUUFBQSxDQUFBO0FBRVdhLFFBQUFDLGdCQUFBLEdBQW1CLElBQW5CLEMsQ0FBeUI7QUFDcEM7OztBQUdBLElBQUlDLGVBQWVKLFFBQVFLLEdBQVIsQ0FBWSxnQkFBWixLQUFpQyxXQUFwRDtBQW9CQSxJQUFNQyx1QkFBdUIsQ0FBQyxRQUFELEVBQVcsVUFBWCxFQUF1QixrQkFBdkIsRUFBMkMsWUFBM0MsRUFBeUQsbUJBQXpELEVBQThFLFNBQTlFLEVBQXlGLGFBQXpGLEVBQXdHLE1BQXhHLEVBQWdILFlBQWhILEVBQThILFVBQTlILEVBQTBJLFVBQTFJLEVBQXNKLFdBQXRKLEVBQW1LLFlBQW5LLEVBQWlMLFFBQWpMLENBQTdCO0FBRUEsU0FBQUMsV0FBQSxDQUFxQkMsUUFBckIsRUFBeUNDLFFBQXpDLEVBQTJEQyxVQUEzRCxFQUErRUMs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UUFBVCxFQUFpQjtBQUNoQyxZQUFJK00sYUFBYVAsc0JBQXNCRSxLQUF0QixFQUE2QjFNLFFBQTdCLENBQWpCO0FBQ0EsWUFBRyxDQUFDcUUsT0FBSixFQUFhO0FBQ1RBLHNCQUFVMEksVUFBVjtBQUNILFNBRkQsTUFFTztBQUNIMUksc0JBQVU3RSxFQUFFd04sWUFBRixDQUFlM0ksT0FBZixFQUF3QjBJLFVBQXhCLENBQVY7QUFDSDtBQUNKLEtBUEQ7QUFRQSxRQUFHMUksUUFBUTNCLE1BQVIsS0FBbUIsQ0FBdEIsRUFBeUI7QUFDckIsY0FBTSxJQUFJUCxLQUFKLENBQVUsZ0JBQWdCOUMsTUFBTTROLG9CQUFOLENBQTJCOUgsVUFBM0IsQ0FBaEIsR0FBeUQseUJBQW5FLENBQU47QUFDSDtBQUNEZCxZQUFRaEUsT0FBUixDQUFnQixVQUFTa0QsTUFBVCxFQUFlO0FBQzNCcUosV0FBR0YsS0FBSCxFQUFVbkosTUFBVixFQUFrQmxELE9BQWxCLENBQTBCLFVBQVN3TSxPQUFULEVBQWdCO0FBQ3RDekYsZ0JBQUl5RixPQUFKLElBQWUsSUFBZjtBQUNILFNBRkQ7QUFHSCxLQUpEO0FBS0FqSSxXQUFPNkYsTUFBUCxDQUFjckQsR0FBZDtBQUNBLFdBQU9BLEdBQVA7QUFDRjtBQXZCRDNILFFBQUFxTix5Q0FBQSxHQUFBQSx5Q0FBQSIsImZpbGUiOiJtb2RlbC9tb2RlbC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBGdW5jdGlvbmFsaXR5IG1hbmFnaW5nIHRoZSBtYXRjaCBtb2RlbHNcclxuICpcclxuICogQGZpbGVcclxuICovXHJcblxyXG5pbXBvcnQgKiBhcyBpbnRmIGZyb20gJ2NvbnN0YW50cyc7XHJcbmltcG9ydCAqIGFzIGRlYnVnIGZyb20gJ2RlYnVnJztcclxuXHJcbnZhciBkZWJ1Z2xvZyA9IGRlYnVnKCdtb2RlbCcpO1xyXG5cclxuaW1wb3J0ICogYXMgbG9nZ2VyIGZyb20gJy4uL3V0aWxzL2xvZ2dlcic7XHJcblxyXG5jb25zdCBsb2FkbG9nID0gbG9nZ2VyLmxvZ2dlcignbW9kZWxsb2FkJywgJycpO1xyXG5cclxuaW1wb3J0ICogIGFzIElNYXRjaCBmcm9tICcuLi9tYXRjaC9pZm1hdGNoJztcclxuaW1wb3J0ICogYXMgTWF0Y2ggZnJvbSAnLi4vbWF0Y2gvbWF0Y2gnO1xyXG5pbXBvcnQgKiBhcyBJbnB1dEZpbHRlclJ1bGVzIGZyb20gJy4uL21hdGNoL2lucHV0RmlsdGVyUnVsZXMnO1xyXG5pbXBvcnQgKiBhcyBUb29scyBmcm9tICcuLi9tYXRjaC90b29scyc7XHJcbmltcG9ydCAqIGFzIGZzIGZyb20gJ2ZzJztcclxuaW1wb3J0ICogYXMgTWV0YSBmcm9tICcuL21ldGEnO1xyXG5pbXBvcnQgKiBhcyBVdGlscyBmcm9tICcuLi91dGlscy91dGlscyc7XHJcbmltcG9ydCAqIGFzIENpcmN1bGFyU2VyIGZyb20gJy4uL3V0aWxzL2NpcmN1bGFyc2VyJztcclxuXHJcbmltcG9ydCAqIGFzIHByb2Nlc3MgZnJvbSAncHJvY2Vzcyc7XHJcbmltcG9ydCAqIGFzIF8gZnJvbSAnbG9kYXNoJztcclxuXHJcbmV4cG9ydCB2YXIgZ2xvYmFsX0FkZFNwbGl0cyA9IHRydWU7IC8vIGZhbHNlO1xyXG4vKipcclxuICogdGhlIG1vZGVsIHBhdGgsIG1heSBiZSBjb250cm9sbGVkIHZpYSBlbnZpcm9ubWVudCB2YXJpYWJsZVxyXG4gKi9cclxudmFyIGVudk1vZGVsUGF0aCA9IHByb2Nlc3MuZW52W1wiQUJPVF9NT0RFTFBBVEhcIl0gfHwgXCJ0ZXN0bW9kZWxcIjtcclxuXHJcbi8vZXhwb3J0IGludGVyZmFjZSBJTW9kZWxzID0gTWF0Y2guSU1vZGVscztcclxuXHJcbi8qXHJcbmV4cG9ydCBpbnRlcmZhY2UgSU1vZGVscyB7XHJcbiAgICBkb21haW5zOiBzdHJpbmdbXSxcclxuICAgIHRvb2xzOiBJTWF0Y2guSVRvb2xbXSxcclxuICAgIGNhdGVnb3J5OiBzdHJpbmdbXSxcclxuICAgIG1SdWxlczogSU1hdGNoLm1SdWxlW10sXHJcbiAgICByZWNvcmRzOiBhbnlbXVxyXG4gICAgc2VlblJ1bGVzPzogeyBba2V5OiBzdHJpbmddOiBJTWF0Y2gubVJ1bGUgfSxcclxuICAgIG1ldGEgOiB7XHJcbiAgICAgICAgLy8gZW50aXR5IC0+IHJlbGF0aW9uIC0+IHRhcmdldFxyXG4gICAgICAgIHQzIDogeyBba2V5OiBzdHJpbmddIDogeyBba2V5IDogc3RyaW5nXSA6IGFueSB9fVxyXG4gICAgfVxyXG59Ki9cclxuXHJcbnR5cGUgSU1vZGVsID0gSU1hdGNoLklNb2RlbDtcclxuXHJcbmNvbnN0IEFSUl9NT0RFTF9QUk9QRVJUSUVTID0gW1wiZG9tYWluXCIsIFwiYml0aW5kZXhcIiwgXCJkZWZhdWx0a2V5Y29sdW1uXCIsIFwiZGVmYXVsdHVyaVwiLCBcImNhdGVnb3J5RGVzY3JpYmVkXCIsIFwiY29sdW1uc1wiLCBcImRlc2NyaXB0aW9uXCIsIFwidG9vbFwiLCBcInRvb2xoaWRkZW5cIiwgXCJzeW5vbnltc1wiLCBcImNhdGVnb3J5XCIsIFwid29yZGluZGV4XCIsIFwiZXhhY3RtYXRjaFwiLCBcImhpZGRlblwiXTtcclxuXHJcbmZ1bmN0aW9uIGFkZFN5bm9ueW1zKHN5bm9ueW1zOiBzdHJpbmdbXSwgY2F0ZWdvcnk6IHN0cmluZywgc3lub255bUZvcjogc3RyaW5nLCBiaXRpbmRleCA6IG51bWJlciwgbVJ1bGVzOiBBcnJheTxJTWF0Y2gubVJ1bGU+LCBzZWVuOiB7IFtrZXk6IHN0cmluZ106IElNYXRjaC5tUnVsZVtdIH0pIHtcclxuICAgIHN5bm9ueW1zLmZvckVhY2goZnVuY3Rpb24gKHN5bikge1xyXG4gICAgICAgIHZhciBvUnVsZSA9IHtcclxuICAgICAgICAgICAgY2F0ZWdvcnk6IGNhdGVnb3J5LFxyXG4gICAgICAgICAgICBtYXRjaGVkU3RyaW5nOiBzeW5vbnltRm9yLFxyXG4gICAgICAgICAgICB0eXBlOiBJTWF0Y2guRW51bVJ1bGVUeXBlLldPUkQsXHJcbiAgICAgICAgICAgIHdvcmQ6IHN5bixcclxuICAgICAgICAgICAgYml0aW5kZXggOiBiaXRpbmRleCxcclxuICAgICAgICAgICAgX3Jhbmtpbmc6IDAuOTVcclxuICAgICAgICB9O1xyXG4gICAgICAgIGRlYnVnbG9nKGRlYnVnbG9nLmVuYWJsZWQ/IChcImluc2VydGluZyBzeW5vbnltXCIgKyBKU09OLnN0cmluZ2lmeShvUnVsZSkpOictJyk7XHJcbiAgICAgICAgaW5zZXJ0UnVsZUlmTm90UHJlc2VudChtUnVsZXMsIG9SdWxlLCBzZWVuKTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5mdW5jdGlvbiBnZXRSdWxlS2V5KHJ1bGUpIHtcclxuICAgIHZhciByMSA9IHJ1bGUubWF0Y2hlZFN0cmluZyArIFwiLXwtXCIgKyBydWxlLmNhdGVnb3J5ICsgXCIgLXwtIFwiICsgcnVsZS50eXBlICArIFwiIC18LSBcIiArIHJ1bGUud29yZCArIFwiIFwiO1xyXG4gICAgaWYocnVsZS5yYW5nZSkge1xyXG4gICAgICAgIHZhciByMiA9IGdldFJ1bGVLZXkocnVsZS5yYW5nZS5ydWxlKTtcclxuICAgICAgICByMSArPSBcIiAtfC0gXCIgKyBydWxlLnJhbmdlLmxvdyArIFwiL1wiICsgcnVsZS5yYW5nZS5oaWdoICsgXCIgLXwtIFwiICsgcjI7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcjE7XHJcbn1cclxuXHJcblxyXG5pbXBvcnQgKiBhcyBCcmVha2Rvd24gZnJvbSAnLi4vbWF0Y2gvYnJlYWtkb3duJztcclxuXHJcbi8qIGdpdmVuIGEgcnVsZSB3aGljaCByZXByZXNlbnRzIGEgd29yZCBzZXF1ZW5jZSB3aGljaCBpcyBzcGxpdCBkdXJpbmcgdG9rZW5pemF0aW9uICovXHJcbmV4cG9ydCBmdW5jdGlvbiBhZGRCZXN0U3BsaXQobVJ1bGVzOiBBcnJheTxJTWF0Y2gubVJ1bGU+LCBydWxlOiBJTWF0Y2gubVJ1bGUsIHNlZW5SdWxlczogeyBba2V5OiBzdHJpbmddOiBJTWF0Y2gubVJ1bGVbXSB9KSB7XHJcbiAgICBpZighZ2xvYmFsX0FkZFNwbGl0cykge1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBpZihydWxlLnR5cGUgIT09IElNYXRjaC5FbnVtUnVsZVR5cGUuV09SRCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBiZXN0ID0gQnJlYWtkb3duLm1ha2VNYXRjaFBhdHRlcm4ocnVsZS5sb3dlcmNhc2V3b3JkKTtcclxuICAgICAgICBpZighYmVzdCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHZhciBuZXdSdWxlID0ge1xyXG4gICAgICAgICAgICBjYXRlZ29yeSA6IHJ1bGUuY2F0ZWdvcnksXHJcbiAgICAgICAgICAgIG1hdGNoZWRTdHJpbmcgOiBydWxlLm1hdGNoZWRTdHJpbmcsXHJcbiAgICAgICAgICAgIGJpdGluZGV4IDogcnVsZS5iaXRpbmRleCxcclxuICAgICAgICAgICAgd29yZCA6IGJlc3QubG9uZ2VzdFRva2VuLFxyXG4gICAgICAgICAgICB0eXBlIDogMCxcclxuICAgICAgICAgICAgbG93ZXJjYXNld29yZCA6IGJlc3QubG9uZ2VzdFRva2VuLFxyXG4gICAgICAgICAgICBfcmFua2luZyA6IDAuOTUsXHJcbiAgICAgICAgLy8gICAgZXhhY3RPbmx5IDogcnVsZS5leGFjdE9ubHksXHJcbiAgICAgICAgICAgIHJhbmdlIDogYmVzdC5zcGFuXHJcbiAgICAgICAgfSBhcyBJTWF0Y2gubVJ1bGU7XHJcbiAgICAgICAgaWYocnVsZS5leGFjdE9ubHkpIHtcclxuICAgICAgICAgICAgbmV3UnVsZS5leGFjdE9ubHkgPSBydWxlLmV4YWN0T25seVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgbmV3UnVsZS5yYW5nZS5ydWxlID0gcnVsZTtcclxuICAgICAgICBpbnNlcnRSdWxlSWZOb3RQcmVzZW50KG1SdWxlcyxuZXdSdWxlICxzZWVuUnVsZXMpO1xyXG4gfVxyXG5cclxuXHJcbmZ1bmN0aW9uIGluc2VydFJ1bGVJZk5vdFByZXNlbnQobVJ1bGVzOiBBcnJheTxJTWF0Y2gubVJ1bGU+LCBydWxlOiBJTWF0Y2gubVJ1bGUsXHJcbiAgICBzZWVuUnVsZXM6IHsgW2tleTogc3RyaW5nXTogSU1hdGNoLm1SdWxlW10gfSkge1xyXG5cclxuICAgIGlmIChydWxlLnR5cGUgIT09IElNYXRjaC5FbnVtUnVsZVR5cGUuV09SRCkge1xyXG4gICAgICAgIG1SdWxlcy5wdXNoKHJ1bGUpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmICgocnVsZS53b3JkID09PSB1bmRlZmluZWQpIHx8IChydWxlLm1hdGNoZWRTdHJpbmcgPT09IHVuZGVmaW5lZCkpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2lsbGVnYWwgcnVsZScgKyBKU09OLnN0cmluZ2lmeShydWxlLCB1bmRlZmluZWQsIDIpKTtcclxuICAgIH1cclxuICAgIHZhciByID0gZ2V0UnVsZUtleShydWxlKTtcclxuICAgLyogaWYoIChydWxlLndvcmQgPT09IFwic2VydmljZVwiIHx8IHJ1bGUud29yZD09PSBcInNlcnZpY2VzXCIpICYmIHIuaW5kZXhPZignT0RhdGEnKSA+PSAwKSB7XHJcbiAgICAgICAgY29uc29sZS5sb2coXCJydWxla2V5IGlzXCIgKyByKTtcclxuICAgICAgICBjb25zb2xlLmxvZyhcInByZXNlbmNlIGlzIFwiICsgSlNPTi5zdHJpbmdpZnkoc2VlblJ1bGVzW3JdKSk7XHJcbiAgICB9Ki9cclxuICAgIHJ1bGUubG93ZXJjYXNld29yZCA9IHJ1bGUud29yZC50b0xvd2VyQ2FzZSgpO1xyXG4gICAgaWYgKHNlZW5SdWxlc1tyXSkge1xyXG4gICAgICAgIGRlYnVnbG9nKGRlYnVnbG9nLmVuYWJsZWQgPyAoXCJBdHRlbXB0aW5nIHRvIGluc2VydCBkdXBsaWNhdGVcIiArIEpTT04uc3RyaW5naWZ5KHJ1bGUsIHVuZGVmaW5lZCwgMikpIDogXCItXCIpO1xyXG4gICAgICAgIHZhciBkdXBsaWNhdGVzID0gc2VlblJ1bGVzW3JdLmZpbHRlcihmdW5jdGlvbiggb0VudHJ5KSB7XHJcbiAgICAgICAgICAgIHJldHVybiAwID09PSBJbnB1dEZpbHRlclJ1bGVzLmNvbXBhcmVNUnVsZUZ1bGwob0VudHJ5LHJ1bGUpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGlmKGR1cGxpY2F0ZXMubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgc2VlblJ1bGVzW3JdID0gKHNlZW5SdWxlc1tyXSB8fCBbXSk7XHJcbiAgICBzZWVuUnVsZXNbcl0ucHVzaChydWxlKTtcclxuICAgIGlmIChydWxlLndvcmQgPT09IFwiXCIpIHtcclxuICAgICAgICBkZWJ1Z2xvZyhkZWJ1Z2xvZy5lbmFibGVkPyAoJ1NraXBwaW5nIHJ1bGUgd2l0aCBlbXRweSB3b3JkICcgKyBKU09OLnN0cmluZ2lmeShydWxlLCB1bmRlZmluZWQsIDIpKTogJy0nKTtcclxuICAgICAgICBsb2FkbG9nKCdTa2lwcGluZyBydWxlIHdpdGggZW10cHkgd29yZCAnICsgSlNPTi5zdHJpbmdpZnkocnVsZSwgdW5kZWZpbmVkLCAyKSk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgbVJ1bGVzLnB1c2gocnVsZSk7XHJcbiAgICBhZGRCZXN0U3BsaXQobVJ1bGVzLCBydWxlLCBzZWVuUnVsZXMpO1xyXG4gICAgcmV0dXJuO1xyXG59XHJcblxyXG5mdW5jdGlvbiBsb2FkTW9kZWxEYXRhKG1vZGVsUGF0aDogc3RyaW5nLCBvTWRsOiBJTW9kZWwsIHNNb2RlbE5hbWU6IHN0cmluZywgb01vZGVsOiBJTWF0Y2guSU1vZGVscykge1xyXG4gICAgLy8gcmVhZCB0aGUgZGF0YSAtPlxyXG4gICAgLy8gZGF0YSBpcyBwcm9jZXNzZWQgaW50byBtUnVsZXMgZGlyZWN0bHksXHJcbiAgICB2YXIgYml0aW5kZXggPSBvTWRsLmJpdGluZGV4O1xyXG4gICAgY29uc3Qgc0ZpbGVOYW1lID0gKCcuLycgKyBtb2RlbFBhdGggKyAnLycgKyBzTW9kZWxOYW1lICsgXCIuZGF0YS5qc29uXCIpO1xyXG4gICAgdmFyIG1kbGRhdGEgPSBmcy5yZWFkRmlsZVN5bmMoc0ZpbGVOYW1lLCAndXRmLTgnKTtcclxuICAgIHZhciBvTWRsRGF0YSA9IEpTT04ucGFyc2UobWRsZGF0YSk7XHJcbiAgICBvTWRsRGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChvRW50cnkpIHtcclxuICAgICAgICBpZighb0VudHJ5LnRvb2wpIHtcclxuICAgICAgICAgICAgb0VudHJ5Ll9kb21haW4gPSBvTWRsLmRvbWFpbjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCFvRW50cnkudG9vbCAmJiBvTWRsLnRvb2wubmFtZSkge1xyXG4gICAgICAgICAgICBvRW50cnkudG9vbCA9IG9NZGwudG9vbC5uYW1lO1xyXG4gICAgICAgIH1cclxuICAgICAgICBvTW9kZWwucmVjb3Jkcy5wdXNoKG9FbnRyeSk7XHJcbiAgICAgICAgb01kbC5jYXRlZ29yeS5mb3JFYWNoKGZ1bmN0aW9uKGNhdCkge1xyXG4gICAgICAgICAgICBpZihvRW50cnlbY2F0XSA9PT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgICAgICAgICAgIG9FbnRyeVtjYXRdID0gXCJuL2FcIjtcclxuICAgICAgICAgICAgICAgIHZhciBidWcgPVxyXG4gICAgICAgICAgICAgICAgICAgIFwiSU5DT05TSVNURU5UKj4gTW9kZWxEYXRhIFwiICsgc0ZpbGVOYW1lICsgXCIgZG9lcyBub3QgY29udGFpbiBjYXRlZ29yeSBcIiArIGNhdCArIFwiIHdpdGggdmFsdWUgJ3VuZGVmaW5lZCcsIHVuZGVmaW5lZCBpcyBpbGxlZ2FsIHZhbHVlLCB1c2Ugbi9hIFwiICsgSlNPTi5zdHJpbmdpZnkob0VudHJ5KSArIFwiXCI7XHJcbiAgICAgICAgICAgICAgICBkZWJ1Z2xvZyhidWcpO1xyXG4gICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhidWcpO1xyXG4gICAgICAgICAgICAgICAgLy9wcm9jZXNzLmV4aXQoLTEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuXHJcbiAgICAgICAgb01kbC53b3JkaW5kZXguZm9yRWFjaChmdW5jdGlvbiAoY2F0ZWdvcnkpIHtcclxuICAgICAgICAgICAgaWYgKG9FbnRyeVtjYXRlZ29yeV0gPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgZGVidWdsb2coXCJJTkNPTlNJU1RFTlQqPiBNb2RlbERhdGEgXCIgKyBzRmlsZU5hbWUgKyBcIiBkb2VzIG5vdCBjb250YWluIGNhdGVnb3J5IFwiICsgY2F0ZWdvcnkgKyBcIiBvZiB3b3JkaW5kZXhcIiArIEpTT04uc3RyaW5naWZ5KG9FbnRyeSkgKyBcIlwiKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChvRW50cnlbY2F0ZWdvcnldICE9PSBcIipcIikge1xyXG4gICAgICAgICAgICAgICAgdmFyIHNTdHJpbmcgPSBvRW50cnlbY2F0ZWdvcnldO1xyXG4gICAgICAgICAgICAgICAgZGVidWdsb2coXCJwdXNoaW5nIHJ1bGUgd2l0aCBcIiArIGNhdGVnb3J5ICsgXCIgLT4gXCIgKyBzU3RyaW5nKTtcclxuICAgICAgICAgICAgICAgIHZhciBvUnVsZSA9IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY2F0ZWdvcnk6IGNhdGVnb3J5LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXRjaGVkU3RyaW5nOiBzU3RyaW5nLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiBJTWF0Y2guRW51bVJ1bGVUeXBlLldPUkQsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdvcmQ6IHNTdHJpbmcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGJpdGluZGV4IDogYml0aW5kZXgsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIF9yYW5raW5nOiAwLjk1XHJcbiAgICAgICAgICAgICAgICAgICAgfSBhcyBJTWF0Y2gubVJ1bGU7XHJcbiAgICAgICAgICAgICAgICBpZihvTWRsLmV4YWN0bWF0Y2ggJiYgb01kbC5leGFjdG1hdGNoLmluZGV4T2YoY2F0ZWdvcnkpID49IDApIHtcclxuICAgICAgICAgICAgICAgICAgICBvUnVsZS5leGFjdE9ubHkgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaW5zZXJ0UnVsZUlmTm90UHJlc2VudChvTW9kZWwubVJ1bGVzLG9SdWxlLCBvTW9kZWwuc2VlblJ1bGVzKTtcclxuICAgICAgICAgICAgICAgIGlmIChvTWRsRGF0YS5zeW5vbnltcyAmJiBvTWRsRGF0YS5zeW5vbnltc1tjYXRlZ29yeV0pIHtcclxuICAgICAgICAgICAgICAgICAgICBhZGRTeW5vbnltcyhvTWRsRGF0YS5zeW5vbnltc1tjYXRlZ29yeV0sIGNhdGVnb3J5LCBzU3RyaW5nLCBiaXRpbmRleCwgb01vZGVsLm1SdWxlcywgb01vZGVsLnNlZW5SdWxlcyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAob0VudHJ5LnN5bm9ueW1zICYmIG9FbnRyeS5zeW5vbnltc1tjYXRlZ29yeV0pIHtcclxuICAgICAgICAgICAgICAgICAgICBhZGRTeW5vbnltcyhvRW50cnkuc3lub255bXNbY2F0ZWdvcnldLCBjYXRlZ29yeSwgc1N0cmluZywgYml0aW5kZXgsIG9Nb2RlbC5tUnVsZXMsIG9Nb2RlbC5zZWVuUnVsZXMpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufVxyXG5cclxuXHJcblxyXG5cclxuZnVuY3Rpb24gbG9hZE1vZGVsKG1vZGVsUGF0aCA6IHN0cmluZywgc01vZGVsTmFtZTogc3RyaW5nLCBvTW9kZWw6IElNYXRjaC5JTW9kZWxzKSB7XHJcbiAgICBkZWJ1Z2xvZyhcIiBsb2FkaW5nIFwiICsgc01vZGVsTmFtZSArIFwiIC4uLi5cIik7XHJcbiAgICB2YXIgbWRsID0gZnMucmVhZEZpbGVTeW5jKCcuLycgKyBtb2RlbFBhdGggKyAnLycgKyBzTW9kZWxOYW1lICsgXCIubW9kZWwuanNvblwiLCAndXRmLTgnKTtcclxuICAgIHZhciBvTWRsID0gSlNPTi5wYXJzZShtZGwpIGFzIElNb2RlbDtcclxuICAgIG1lcmdlTW9kZWxKc29uKHNNb2RlbE5hbWUsIG9NZGwsIG9Nb2RlbCk7XHJcbiAgICBsb2FkTW9kZWxEYXRhKG1vZGVsUGF0aCwgb01kbCwgc01vZGVsTmFtZSwgb01vZGVsKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldERvbWFpbkJpdEluZGV4KGRvbWFpbjogc3RyaW5nLCBvTW9kZWw6IElNYXRjaC5JTW9kZWxzKSA6IG51bWJlciB7XHJcbiAgICB2YXIgaW5kZXggPSBvTW9kZWwuZG9tYWlucy5pbmRleE9mKGRvbWFpbik7XHJcbiAgICBpZihpbmRleCA8IDApIHtcclxuICAgICAgICBpbmRleCA9IG9Nb2RlbC5kb21haW5zLmxlbmd0aDtcclxuICAgIH1cclxuICAgIGlmKGluZGV4ID49IDMyKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwidG9vIG1hbnkgZG9tYWluIGZvciBzaW5nbGUgMzIgYml0IGluZGV4XCIpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIDB4MDAwMSA8PCBpbmRleDtcclxufVxyXG5cclxuZnVuY3Rpb24gbWVyZ2VNb2RlbEpzb24oc01vZGVsTmFtZTogc3RyaW5nLCBvTWRsOiBJTW9kZWwsIG9Nb2RlbDogSU1hdGNoLklNb2RlbHMpIHtcclxuICAgIHZhciBjYXRlZ29yeURlc2NyaWJlZE1hcCA9IHt9IGFzIHsgW2tleTogc3RyaW5nXSA6IElNYXRjaC5JQ2F0ZWdvcnlEZXNjIH07XHJcbiAgICBvTWRsLmJpdGluZGV4ID0gZ2V0RG9tYWluQml0SW5kZXgob01kbC5kb21haW4sIG9Nb2RlbCk7XHJcbiAgICBvTWRsLmNhdGVnb3J5RGVzY3JpYmVkID0gW107XHJcbiAgICAvLyByZWN0aWZ5IGNhdGVnb3J5XHJcbiAgICBvTWRsLmNhdGVnb3J5ID0gb01kbC5jYXRlZ29yeS5tYXAoZnVuY3Rpb24oY2F0IDogYW55KSB7XHJcbiAgICAgICAgaWYodHlwZW9mIGNhdCA9PT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgICAgICByZXR1cm4gY2F0O1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZih0eXBlb2YgY2F0Lm5hbWUgIT09IFwic3RyaW5nXCIpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coXCJNaXNzaW5nIG5hbWUgaW4gb2JqZWN0IHR5cGVkIGNhdGVnb3J5IGluIFwiICsgSlNPTi5zdHJpbmdpZnkoY2F0KSArIFwiIGluIG1vZGVsIFwiICsgc01vZGVsTmFtZSApO1xyXG4gICAgICAgICAgICBwcm9jZXNzLmV4aXQoLTEpO1xyXG4gICAgICAgICAgICAvL3Rocm93IG5ldyBFcnJvcignRG9tYWluICcgKyBvTWRsLmRvbWFpbiArICcgYWxyZWFkeSBsb2FkZWQgd2hpbGUgbG9hZGluZyAnICsgc01vZGVsTmFtZSArICc/Jyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhdGVnb3J5RGVzY3JpYmVkTWFwW2NhdC5uYW1lXSA9IGNhdDtcclxuICAgICAgICBvTWRsLmNhdGVnb3J5RGVzY3JpYmVkLnB1c2goY2F0KTtcclxuICAgICAgICByZXR1cm4gY2F0Lm5hbWU7XHJcbiAgICB9KTtcclxuXHJcbiAgICAgICAvLyBhZGQgdGhlIGNhdGVnb3JpZXMgdG8gdGhlIG1vZGVsOlxyXG4gICAgb01kbC5jYXRlZ29yeS5mb3JFYWNoKGZ1bmN0aW9uIChjYXRlZ29yeSkge1xyXG4gICAgICAgIGluc2VydFJ1bGVJZk5vdFByZXNlbnQob01vZGVsLm1SdWxlcywge1xyXG4gICAgICAgICAgICBjYXRlZ29yeTogXCJjYXRlZ29yeVwiLFxyXG4gICAgICAgICAgICBtYXRjaGVkU3RyaW5nOiBjYXRlZ29yeSxcclxuICAgICAgICAgICAgdHlwZTogSU1hdGNoLkVudW1SdWxlVHlwZS5XT1JELFxyXG4gICAgICAgICAgICB3b3JkOiBjYXRlZ29yeSxcclxuICAgICAgICAgICAgbG93ZXJjYXNld29yZDogY2F0ZWdvcnkudG9Mb3dlckNhc2UoKSxcclxuICAgICAgICAgICAgYml0aW5kZXggOiBvTWRsLmJpdGluZGV4LFxyXG4gICAgICAgICAgICBfcmFua2luZzogMC45NVxyXG4gICAgICAgIH0sIG9Nb2RlbC5zZWVuUnVsZXMpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaWYgKG9Nb2RlbC5kb21haW5zLmluZGV4T2Yob01kbC5kb21haW4pID49IDApIHtcclxuICAgICAgICBkZWJ1Z2xvZyhcIioqKioqKioqKioqaGVyZSBtZGxcIiArIEpTT04uc3RyaW5naWZ5KG9NZGwsIHVuZGVmaW5lZCwgMikpO1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignRG9tYWluICcgKyBvTWRsLmRvbWFpbiArICcgYWxyZWFkeSBsb2FkZWQgd2hpbGUgbG9hZGluZyAnICsgc01vZGVsTmFtZSArICc/Jyk7XHJcbiAgICB9XHJcbiAgICAvLyBjaGVjayBwcm9wZXJ0aWVzIG9mIG1vZGVsXHJcbiAgICBPYmplY3Qua2V5cyhvTWRsKS5zb3J0KCkuZm9yRWFjaChmdW5jdGlvbihzUHJvcGVydHkpIHtcclxuICAgICAgICBpZihBUlJfTU9ERUxfUFJPUEVSVElFUy5pbmRleE9mKHNQcm9wZXJ0eSkgPCAwKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTW9kZWwgcHJvcGVydHkgXCInICsgc1Byb3BlcnR5ICsgJ1wiIG5vdCBhIGtub3duIG1vZGVsIHByb3BlcnR5IGluIG1vZGVsIG9mIGRvbWFpbiAnICsgb01kbC5kb21haW4gKyAnICcpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgLy8gY29uc2lkZXIgc3RyZWFtbGluaW5nIHRoZSBjYXRlZ29yaWVzXHJcbiAgICBvTW9kZWwucmF3TW9kZWxzW29NZGwuZG9tYWluXSA9IG9NZGw7XHJcblxyXG4gICAgb01vZGVsLmZ1bGwuZG9tYWluW29NZGwuZG9tYWluXSA9IHtcclxuICAgICAgICBkZXNjcmlwdGlvbiA6IG9NZGwuZGVzY3JpcHRpb24sXHJcbiAgICAgICAgY2F0ZWdvcmllcyA6IGNhdGVnb3J5RGVzY3JpYmVkTWFwLFxyXG4gICAgICAgIGJpdGluZGV4IDogb01kbC5iaXRpbmRleFxyXG4gICAgfTtcclxuXHJcbiAgICAvLyBjaGVjayB0aGF0XHJcblxyXG5cclxuICAgIC8vIGNoZWNrIHRoYXQgbWVtYmVycyBvZiB3b3JkaW5kZXggYXJlIGluIGNhdGVnb3JpZXMsXHJcbiAgICBvTWRsLndvcmRpbmRleCA9IG9NZGwud29yZGluZGV4IHx8IFtdO1xyXG4gICAgb01kbC53b3JkaW5kZXguZm9yRWFjaChmdW5jdGlvbihzV29yZEluZGV4KSB7XHJcbiAgICAgICAgaWYob01kbC5jYXRlZ29yeS5pbmRleE9mKHNXb3JkSW5kZXgpIDwgMCkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ01vZGVsIHdvcmRpbmRleCBcIicgKyBzV29yZEluZGV4ICsgJ1wiIG5vdCBhIGNhdGVnb3J5IG9mIGRvbWFpbiAnICsgb01kbC5kb21haW4gKyAnICcpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgb01kbC5leGFjdG1hdGNoID0gb01kbC5leGFjdG1hdGNoIHx8IFtdO1xyXG4gICAgb01kbC5leGFjdG1hdGNoLmZvckVhY2goZnVuY3Rpb24oc0V4YWN0TWF0Y2gpIHtcclxuICAgICAgICBpZihvTWRsLmNhdGVnb3J5LmluZGV4T2Yoc0V4YWN0TWF0Y2gpIDwgMCkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ01vZGVsIGV4YWN0bWF0Y2ggXCInICsgc0V4YWN0TWF0Y2ggKyAnXCIgbm90IGEgY2F0ZWdvcnkgb2YgZG9tYWluICcgKyBvTWRsLmRvbWFpbiArICcgJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICBvTWRsLmNvbHVtbnMgPSBvTWRsLmNvbHVtbnMgfHwgW107XHJcbiAgICBvTWRsLmNvbHVtbnMuZm9yRWFjaChmdW5jdGlvbihzRXhhY3RNYXRjaCkge1xyXG4gICAgICAgIGlmKG9NZGwuY2F0ZWdvcnkuaW5kZXhPZihzRXhhY3RNYXRjaCkgPCAwKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTW9kZWwgY29sdW1uIFwiJyArIHNFeGFjdE1hdGNoICsgJ1wiIG5vdCBhIGNhdGVnb3J5IG9mIGRvbWFpbiAnICsgb01kbC5kb21haW4gKyAnICcpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuXHJcbiAgICAvLyBhZGQgcmVsYXRpb24gZG9tYWluIC0+IGNhdGVnb3J5XHJcbiAgICB2YXIgZG9tYWluU3RyID0gTWV0YUYuRG9tYWluKG9NZGwuZG9tYWluKS50b0Z1bGxTdHJpbmcoKTtcclxuICAgIHZhciByZWxhdGlvblN0ciA9IE1ldGFGLlJlbGF0aW9uKE1ldGEuUkVMQVRJT05faGFzQ2F0ZWdvcnkpLnRvRnVsbFN0cmluZygpO1xyXG4gICAgdmFyIHJldmVyc2VSZWxhdGlvblN0ciA9IE1ldGFGLlJlbGF0aW9uKE1ldGEuUkVMQVRJT05faXNDYXRlZ29yeU9mKS50b0Z1bGxTdHJpbmcoKTtcclxuICAgIG9NZGwuY2F0ZWdvcnkuZm9yRWFjaChmdW5jdGlvbihzQ2F0ZWdvcnkpIHtcclxuXHJcbiAgICAgICAgdmFyIENhdGVnb3J5U3RyaW5nID0gTWV0YUYuQ2F0ZWdvcnkoc0NhdGVnb3J5KS50b0Z1bGxTdHJpbmcoKTtcclxuICAgICAgICBvTW9kZWwubWV0YS50M1tkb21haW5TdHJdID0gb01vZGVsLm1ldGEudDNbZG9tYWluU3RyXSB8fCB7fTtcclxuICAgICAgICBvTW9kZWwubWV0YS50M1tkb21haW5TdHJdW3JlbGF0aW9uU3RyXSA9IG9Nb2RlbC5tZXRhLnQzW2RvbWFpblN0cl1bcmVsYXRpb25TdHJdIHx8IHt9O1xyXG4gICAgICAgIG9Nb2RlbC5tZXRhLnQzW2RvbWFpblN0cl1bcmVsYXRpb25TdHJdW0NhdGVnb3J5U3RyaW5nXSAgPSB7fTtcclxuXHJcbiAgICAgICAgb01vZGVsLm1ldGEudDNbQ2F0ZWdvcnlTdHJpbmddID0gb01vZGVsLm1ldGEudDNbQ2F0ZWdvcnlTdHJpbmddIHx8IHt9O1xyXG4gICAgICAgIG9Nb2RlbC5tZXRhLnQzW0NhdGVnb3J5U3RyaW5nXVtyZXZlcnNlUmVsYXRpb25TdHJdID0gb01vZGVsLm1ldGEudDNbQ2F0ZWdvcnlTdHJpbmddW3JldmVyc2VSZWxhdGlvblN0cl0gfHwge307XHJcbiAgICAgICAgb01vZGVsLm1ldGEudDNbQ2F0ZWdvcnlTdHJpbmddW3JldmVyc2VSZWxhdGlvblN0cl1bZG9tYWluU3RyXSAgPSB7fTtcclxuXHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBhZGQgYSBwcmVjaWNlIGRvbWFpbiBtYXRjaHJ1bGVcclxuICAgIGluc2VydFJ1bGVJZk5vdFByZXNlbnQob01vZGVsLm1SdWxlcywge1xyXG4gICAgICAgICAgICBjYXRlZ29yeTogXCJkb21haW5cIixcclxuICAgICAgICAgICAgbWF0Y2hlZFN0cmluZzogb01kbC5kb21haW4sXHJcbiAgICAgICAgICAgIHR5cGU6IElNYXRjaC5FbnVtUnVsZVR5cGUuV09SRCxcclxuICAgICAgICAgICAgd29yZDogb01kbC5kb21haW4sXHJcbiAgICAgICAgICAgIGJpdGluZGV4IDogb01kbC5iaXRpbmRleCxcclxuICAgICAgICAgICAgX3Jhbmtpbmc6IDAuOTVcclxuICAgICAgICB9LCBvTW9kZWwuc2VlblJ1bGVzKTtcclxuXHJcbiAgICAvLyBjaGVjayB0aGUgdG9vbFxyXG4gICAgaWYob01kbC50b29sICYmIG9NZGwudG9vbC5yZXF1aXJlcykge1xyXG4gICAgICAgIHZhciByZXF1aXJlcyA9IE9iamVjdC5rZXlzKG9NZGwudG9vbC5yZXF1aXJlcyB8fCB7fSk7XHJcbiAgICAgICAgdmFyIGRpZmYgPSBfLmRpZmZlcmVuY2UocmVxdWlyZXMsIG9NZGwuY2F0ZWdvcnkpO1xyXG4gICAgICAgICAgICBpZihkaWZmLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGAgJHtvTWRsLmRvbWFpbn0gOiBVbmtvd24gY2F0ZWdvcnkgaW4gcmVxdWlyZXMgb2YgdG9vbDogXCJgICsgZGlmZi5qb2luKCdcIicpICsgJ1wiJyk7XHJcbiAgICAgICAgICAgICAgICBwcm9jZXNzLmV4aXQoLTEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgdmFyIG9wdGlvbmFsID0gT2JqZWN0LmtleXMob01kbC50b29sLm9wdGlvbmFsKTtcclxuICAgICAgICBkaWZmID0gXy5kaWZmZXJlbmNlKG9wdGlvbmFsLCBvTWRsLmNhdGVnb3J5KTtcclxuICAgICAgICAgICAgaWYoZGlmZi5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgICR7b01kbC5kb21haW59IDogVW5rb3duIGNhdGVnb3J5IG9wdGlvbmFsIG9mIHRvb2w6IFwiYCArIGRpZmYuam9pbignXCInKSArICdcIicpO1xyXG4gICAgICAgICAgICAgICAgcHJvY2Vzcy5leGl0KC0xKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIE9iamVjdC5rZXlzKG9NZGwudG9vbC5zZXRzIHx8IHt9KS5mb3JFYWNoKGZ1bmN0aW9uKHNldElEKSB7XHJcbiAgICAgICAgICAgIHZhciBkaWZmID0gXy5kaWZmZXJlbmNlKG9NZGwudG9vbC5zZXRzW3NldElEXS5zZXQsIG9NZGwuY2F0ZWdvcnkpO1xyXG4gICAgICAgICAgICBpZihkaWZmLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGAgJHtvTWRsLmRvbWFpbn0gOiBVbmtvd24gY2F0ZWdvcnkgaW4gc2V0SWQgJHtzZXRJRH0gb2YgdG9vbDogXCJgICsgZGlmZi5qb2luKCdcIicpICsgJ1wiJyk7XHJcbiAgICAgICAgICAgICAgICBwcm9jZXNzLmV4aXQoLTEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIGV4dHJhY3QgdG9vbHMgYW4gYWRkIHRvIHRvb2xzOlxyXG4gICAgICAgIG9Nb2RlbC50b29scy5maWx0ZXIoZnVuY3Rpb24gKG9FbnRyeSkge1xyXG4gICAgICAgICAgICBpZiAob0VudHJ5Lm5hbWUgPT09IChvTWRsLnRvb2wgJiYgb01kbC50b29sLm5hbWUpKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlRvb2wgXCIgKyBvTWRsLnRvb2wubmFtZSArIFwiIGFscmVhZHkgcHJlc2VudCB3aGVuIGxvYWRpbmcgXCIgKyBzTW9kZWxOYW1lKTtcclxuICAgICAgICAgICAgICAgIC8vdGhyb3cgbmV3IEVycm9yKCdEb21haW4gYWxyZWFkeSBsb2FkZWQ/Jyk7XHJcbiAgICAgICAgICAgICAgICBwcm9jZXNzLmV4aXQoLTEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIG9NZGwudG9vbGhpZGRlbiA9IHRydWU7XHJcbiAgICAgICAgb01kbC50b29sLnJlcXVpcmVzID0geyBcImltcG9zc2libGVcIiA6IHt9fTtcclxuICAgIH1cclxuICAgIC8vIGFkZCB0aGUgdG9vbCBuYW1lIGFzIHJ1bGUgdW5sZXNzIGhpZGRlblxyXG4gICAgaWYgKCFvTWRsLnRvb2xoaWRkZW4gJiYgb01kbC50b29sICYmIG9NZGwudG9vbC5uYW1lKSB7XHJcbiAgICAgICAgaW5zZXJ0UnVsZUlmTm90UHJlc2VudChvTW9kZWwubVJ1bGVzLCB7XHJcbiAgICAgICAgICAgIGNhdGVnb3J5OiBcInRvb2xcIixcclxuICAgICAgICAgICAgbWF0Y2hlZFN0cmluZzogb01kbC50b29sLm5hbWUsXHJcbiAgICAgICAgICAgIHR5cGU6IElNYXRjaC5FbnVtUnVsZVR5cGUuV09SRCxcclxuICAgICAgICAgICAgd29yZDogb01kbC50b29sLm5hbWUsXHJcbiAgICAgICAgICAgIGJpdGluZGV4IDogb01kbC5iaXRpbmRleCxcclxuICAgICAgICAgICAgX3Jhbmtpbmc6IDAuOTVcclxuICAgICAgICB9LCBvTW9kZWwuc2VlblJ1bGVzKTtcclxuICAgIH07XHJcbiAgICBpZiAob01kbC5zeW5vbnltcyAmJiBvTWRsLnN5bm9ueW1zW1widG9vbFwiXSkge1xyXG4gICAgICAgIGFkZFN5bm9ueW1zKG9NZGwuc3lub255bXNbXCJ0b29sXCJdLCBcInRvb2xcIiwgb01kbC50b29sLm5hbWUsIG9NZGwuYml0aW5kZXgsIG9Nb2RlbC5tUnVsZXMsIG9Nb2RlbC5zZWVuUnVsZXMpO1xyXG4gICAgfTtcclxuICAgIGlmIChvTWRsLnN5bm9ueW1zKSB7XHJcbiAgICAgICAgT2JqZWN0LmtleXMob01kbC5zeW5vbnltcykuZm9yRWFjaChmdW5jdGlvbiAoc3N5bmtleSkge1xyXG4gICAgICAgICAgICBpZiAob01kbC5jYXRlZ29yeS5pbmRleE9mKHNzeW5rZXkpID49IDAgJiYgc3N5bmtleSAhPT0gXCJ0b29sXCIpIHtcclxuICAgICAgICAgICAgICAgIGlmIChvTW9kZWwuZnVsbC5kb21haW5bb01kbC5kb21haW5dLmNhdGVnb3JpZXNbc3N5bmtleV0pICB7XHJcbiAgICAgICAgICAgICAgICAgICBvTW9kZWwuZnVsbC5kb21haW5bb01kbC5kb21haW5dLmNhdGVnb3JpZXNbc3N5bmtleV0uc3lub255bXMgPSBvTWRsLnN5bm9ueW1zW3NzeW5rZXldO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGFkZFN5bm9ueW1zKG9NZGwuc3lub255bXNbc3N5bmtleV0sIFwiY2F0ZWdvcnlcIiwgc3N5bmtleSwgb01kbC5iaXRpbmRleCwgb01vZGVsLm1SdWxlcywgb01vZGVsLnNlZW5SdWxlcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIG9Nb2RlbC5kb21haW5zLnB1c2gob01kbC5kb21haW4pO1xyXG4gICAgaWYob01kbC50b29sLm5hbWUpIHtcclxuICAgICAgb01vZGVsLnRvb2xzLnB1c2gob01kbC50b29sKTtcclxuICAgIH1cclxuICAgIG9Nb2RlbC5jYXRlZ29yeSA9IG9Nb2RlbC5jYXRlZ29yeS5jb25jYXQob01kbC5jYXRlZ29yeSk7XHJcbiAgICBvTW9kZWwuY2F0ZWdvcnkuc29ydCgpO1xyXG4gICAgb01vZGVsLmNhdGVnb3J5ID0gb01vZGVsLmNhdGVnb3J5LmZpbHRlcihmdW5jdGlvbiAoc3RyaW5nLCBpbmRleCkge1xyXG4gICAgICAgIHJldHVybiBvTW9kZWwuY2F0ZWdvcnlbaW5kZXhdICE9PSBvTW9kZWwuY2F0ZWdvcnlbaW5kZXggKyAxXTtcclxuICAgIH0pO1xyXG5cclxufSAvLyBsb2FkbW9kZWxcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBzcGxpdFJ1bGVzKHJ1bGVzIDogSU1hdGNoLm1SdWxlW10pIDogSU1hdGNoLlNwbGl0UnVsZXMge1xyXG4gICAgdmFyIHJlcyA9IHt9O1xyXG4gICAgdmFyIG5vbldvcmRSdWxlcyA9IFtdO1xyXG4gICAgcnVsZXMuZm9yRWFjaChmdW5jdGlvbihydWxlKSB7XHJcbiAgICAgICAgaWYocnVsZS50eXBlID09PSBJTWF0Y2guRW51bVJ1bGVUeXBlLldPUkQpIHtcclxuICAgICAgICAgICAgaWYoIXJ1bGUubG93ZXJjYXNld29yZCkge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiUnVsZSBoYXMgbm8gbWVtYmVyIGxvd2VyY2FzZXdvcmRcIiArIEpTT04uc3RyaW5naWZ5KHJ1bGUpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXNbcnVsZS5sb3dlcmNhc2V3b3JkXSA9IHJlc1tydWxlLmxvd2VyY2FzZXdvcmRdIHx8IHsgYml0aW5kZXggOiAwLCBydWxlcyA6W10gfTtcclxuICAgICAgICAgICAgcmVzW3J1bGUubG93ZXJjYXNld29yZF0uYml0aW5kZXggPSByZXNbcnVsZS5sb3dlcmNhc2V3b3JkXS5iaXRpbmRleCB8IHJ1bGUuYml0aW5kZXg7XHJcbiAgICAgICAgICAgIHJlc1tydWxlLmxvd2VyY2FzZXdvcmRdLnJ1bGVzLnB1c2gocnVsZSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgbm9uV29yZFJ1bGVzLnB1c2gocnVsZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIHdvcmRNYXA6IHJlcyxcclxuICAgICAgICBub25Xb3JkUnVsZXMgOiBub25Xb3JkUnVsZXMsXHJcbiAgICAgICAgYWxsUnVsZXMgOiBydWxlc1xyXG4gICAgfTtcclxufVxyXG5cclxuZnVuY3Rpb24gY21wTGVuZ3RoU29ydChhOiBzdHJpbmcsIGIgOiBzdHJpbmcpIHtcclxuICAgIHZhciBkPSBhLmxlbmd0aCAtIGIubGVuZ3RoO1xyXG4gICAgaWYoZCkge1xyXG4gICAgICAgIHJldHVybiBkO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGEubG9jYWxlQ29tcGFyZShiKTtcclxufVxyXG5cclxuaW1wb3J0ICogYXMgRGlzdGFuY2UgZnJvbSAnLi4vdXRpbHMvZGFtZXJhdUxldmVuc2h0ZWluJztcclxuaW1wb3J0ICogYXMgQWxnb2wgZnJvbSAnLi4vbWF0Y2gvYWxnb2wnO1xyXG4vLyBvZmZzZXRbMF0gOiBsZW4tMlxyXG4vLyAgICAgICAgICAgICBsZW4gLTFcclxuLy8gICAgICAgICAgICAgbGVuXHJcbi8vICAgICAgICAgICAgIGxlbiArMVxyXG4vLyAgICAgICAgICAgICBsZW4gKzJcclxuLy8gICAgICAgICAgICAgbGVuICszXHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZmluZE5leHRMZW4odGFyZ2V0TGVuIDogbnVtYmVyLCBhcnIgOiBzdHJpbmdbXSwgb2Zmc2V0czogbnVtYmVyW10pIHtcclxuICAgIG9mZnNldHMuc2hpZnQoKTtcclxuICAgIGZvcih2YXIgaSA9IG9mZnNldHNbNF07ICAoaSA8IGFyci5sZW5ndGgpICYmIChhcnJbaV0ubGVuZ3RoIDw9IHRhcmdldExlbik7ICsraSkge1xyXG4gICAgICAgIC8qIGVtcHR5Ki9cclxuICAgIH1cclxuICAgIC8vY29uc29sZS5sb2coXCJwdXNoaW5nIFwiICsgaSk7XHJcbiAgICBvZmZzZXRzLnB1c2goaSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBhZGRSYW5nZVJ1bGVzVW5sZXNzUHJlc2VudChydWxlcyA6IElNYXRjaC5tUnVsZVtdLCBsY3dvcmQ6IHN0cmluZywgcmFuZ2VSdWxlcyA6IElNYXRjaC5tUnVsZVtdLCBwcmVzZW50UnVsZXNGb3JLZXk6IElNYXRjaC5tUnVsZVtdLCBzZWVuUnVsZXMpIHtcclxuICAgIHJhbmdlUnVsZXMuZm9yRWFjaChyYW5nZVJ1bGUgPT4ge1xyXG4gICAgICAgIHZhciBuZXdSdWxlID0gT2JqZWN0LmFzc2lnbih7fSxyYW5nZVJ1bGUpO1xyXG4gICAgICAgIG5ld1J1bGUubG93ZXJjYXNld29yZCA9IGxjd29yZDtcclxuICAgICAgICBuZXdSdWxlLndvcmQgPSBsY3dvcmQ7XHJcbiAgICAgICAgLy9pZigobGN3b3JkID09PSAnc2VydmljZXMnIHx8IGxjd29yZCA9PT0gJ3NlcnZpY2UnKSAmJiBuZXdSdWxlLnJhbmdlLnJ1bGUubG93ZXJjYXNld29yZC5pbmRleE9mKCdvZGF0YScpPj0wKSB7XHJcbiAgICAgICAgLy8gICAgY29uc29sZS5sb2coXCJhZGRpbmcgXCIrIEpTT04uc3RyaW5naWZ5KG5ld1J1bGUpICsgXCJcXG5cIik7XHJcbiAgICAgICAgLy99XHJcbiAgICAgICAgLy90b2RvOiBjaGVjayB3aGV0aGVyIGFuIGVxdWl2YWxlbnQgcnVsZSBpcyBhbHJlYWR5IHByZXNlbnQ/XHJcbiAgICAgICAgdmFyIGNudCA9IHJ1bGVzLmxlbmd0aDtcclxuICAgICAgICBpbnNlcnRSdWxlSWZOb3RQcmVzZW50KHJ1bGVzLCBuZXdSdWxlLCBzZWVuUnVsZXMpO1xyXG4gICAgfSlcclxufVxyXG5cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBhZGRDbG9zZUV4YWN0UmFuZ2VSdWxlcyhydWxlcyA6IElNYXRjaC5tUnVsZVtdLCBzZWVuUnVsZXMpIHtcclxuICAgIHZhciBrZXlzTWFwID0ge30gYXMgeyBba2V5IDogc3RyaW5nXSA6IElNYXRjaC5tUnVsZVtdfSA7XHJcbiAgICB2YXIgcmFuZ2VLZXlzTWFwID0ge30gYXMgeyBba2V5IDogc3RyaW5nXSA6IElNYXRjaC5tUnVsZVtdfSA7XHJcbiAgICBydWxlcy5mb3JFYWNoKHJ1bGUgPT4ge1xyXG4gICAgICAgIGlmIChydWxlLnR5cGUgPT09IElNYXRjaC5FbnVtUnVsZVR5cGUuV09SRCkge1xyXG4gICAgICAgICAgICAvL2tleXNNYXBbcnVsZS5sb3dlcmNhc2V3b3JkXSA9IDE7XHJcbiAgICAgICAgICAgIGtleXNNYXBbcnVsZS5sb3dlcmNhc2V3b3JkXSA9IGtleXNNYXBbcnVsZS5sb3dlcmNhc2V3b3JkXSB8fCBbXTtcclxuICAgICAgICAgICAga2V5c01hcFtydWxlLmxvd2VyY2FzZXdvcmRdLnB1c2gocnVsZSk7XHJcbiAgICAgICAgICAgIGlmKCFydWxlLmV4YWN0T25seSAmJiBydWxlLnJhbmdlKSB7XHJcbiAgICAgICAgICAgICAgICByYW5nZUtleXNNYXBbcnVsZS5sb3dlcmNhc2V3b3JkXSA9IHJhbmdlS2V5c01hcFtydWxlLmxvd2VyY2FzZXdvcmRdIHx8IFtdO1xyXG4gICAgICAgICAgICAgICAgcmFuZ2VLZXlzTWFwW3J1bGUubG93ZXJjYXNld29yZF0ucHVzaChydWxlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgdmFyIGtleXMgPSBPYmplY3Qua2V5cyhrZXlzTWFwKTtcclxuICAgIGtleXMuc29ydChjbXBMZW5ndGhTb3J0KTtcclxuICAgIHZhciBsZW4gPSAwO1xyXG4gICAga2V5cy5mb3JFYWNoKCAoa2V5LGluZGV4KSA9PiB7XHJcbiAgICAgICAgaWYoa2V5Lmxlbmd0aCAhPSBsZW4pIHtcclxuICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhcInNoaWZ0IHRvIGxlblwiICsga2V5Lmxlbmd0aCArICcgYXQgJyArIGluZGV4ICsgJyAnICsga2V5ICk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxlbiA9IGtleS5sZW5ndGg7XHJcbiAgICB9KTtcclxuICAgICAvLyAgIGtleXMgPSBrZXlzLnNsaWNlKDAsMjAwMCk7XHJcbiAgICB2YXIgcmFuZ2VLZXlzID0gT2JqZWN0LmtleXMocmFuZ2VLZXlzTWFwKTtcclxuICAgIHJhbmdlS2V5cy5zb3J0KGNtcExlbmd0aFNvcnQpO1xyXG4gICAgLy9jb25zb2xlLmxvZyhgICR7a2V5cy5sZW5ndGh9IGtleXMgYW5kICR7cmFuZ2VLZXlzLmxlbmd0aH0gcmFuZ2VrZXlzIGApO1xyXG4gICAgdmFyIGxvdyA9IDA7XHJcbiAgICB2YXIgaGlnaCA9IDA7XHJcbiAgICB2YXIgbGFzdGxlbiA9IDA7XHJcbiAgICB2YXIgb2Zmc2V0cyA9IFswLDAsMCwwLDAsMF07XHJcbiAgICB2YXIgbGVuID0gcmFuZ2VLZXlzLmxlbmd0aDtcclxuICAgIGZpbmROZXh0TGVuKDAsa2V5cywgb2Zmc2V0cyk7XHJcbiAgICBmaW5kTmV4dExlbigxLGtleXMsIG9mZnNldHMpO1xyXG4gICAgZmluZE5leHRMZW4oMixrZXlzLCBvZmZzZXRzKTtcclxuXHJcbiAgICByYW5nZUtleXMuZm9yRWFjaChmdW5jdGlvbihyYW5nZUtleSkge1xyXG4gICAgICAgIGlmKHJhbmdlS2V5Lmxlbmd0aCAhPT0gbGFzdGxlbikge1xyXG4gICAgICAgICAgICBmb3IoaSA9IGxhc3RsZW4rMTsgaSA8PSByYW5nZUtleS5sZW5ndGg7ICsraSkge1xyXG4gICAgICAgICAgICAgICAgZmluZE5leHRMZW4oaSsyLGtleXMsb2Zmc2V0cyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgLy8gICBjb25zb2xlLmxvZyhgIHNoaWZ0ZWQgdG8gJHtyYW5nZUtleS5sZW5ndGh9IHdpdGggb2Zmc2V0cyBiZWVpbmcgJHtvZmZzZXRzLmpvaW4oJyAnKX1gKTtcclxuICAgICAgICAgLy8gICBjb25zb2xlLmxvZyhgIGhlcmUgMCAke29mZnNldHNbMF19IDogJHtrZXlzW01hdGgubWluKGtleXMubGVuZ3RoLTEsIG9mZnNldHNbMF0pXS5sZW5ndGh9ICAke2tleXNbTWF0aC5taW4oa2V5cy5sZW5ndGgtMSwgb2Zmc2V0c1swXSldfSBgKTtcclxuICAgICAgICAgLy8gIGNvbnNvbGUubG9nKGAgaGVyZSA1LTEgICR7a2V5c1tvZmZzZXRzWzVdLTFdLmxlbmd0aH0gICR7a2V5c1tvZmZzZXRzWzVdLTFdfSBgKTtcclxuICAgICAgICAgLy8gICBjb25zb2xlLmxvZyhgIGhlcmUgNSAke29mZnNldHNbNV19IDogJHtrZXlzW01hdGgubWluKGtleXMubGVuZ3RoLTEsIG9mZnNldHNbNV0pXS5sZW5ndGh9ICAke2tleXNbTWF0aC5taW4oa2V5cy5sZW5ndGgtMSwgb2Zmc2V0c1s1XSldfSBgKTtcclxuICAgICAgICAgICAgbGFzdGxlbiA9IHJhbmdlS2V5Lmxlbmd0aDtcclxuICAgICAgICB9XHJcbiAgICAgICAgZm9yKHZhciBpID0gb2Zmc2V0c1swXTsgaSA8IG9mZnNldHNbNV07ICsraSkge1xyXG4gICAgICAgICAgICB2YXIgZCA9IERpc3RhbmNlLmNhbGNEaXN0YW5jZUFkanVzdGVkKHJhbmdlS2V5LCBrZXlzW2ldKTtcclxuICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhgJHtyYW5nZUtleS5sZW5ndGgta2V5c1tpXS5sZW5ndGh9ICR7ZH0gJHtyYW5nZUtleX0gYW5kICR7a2V5c1tpXX0gIGApO1xyXG4gICAgICAgICAgICBpZiAoKGQgIT09IDEuMCkgJiYgKGQgPj0gQWxnb2wuQ3V0b2ZmX3JhbmdlQ2xvc2VNYXRjaCkpIHtcclxuICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coYHdvdWxkIGFkZCAke3JhbmdlS2V5fSBmb3IgJHtrZXlzW2ldfSAke2R9YCk7XHJcbiAgICAgICAgICAgICAgICB2YXIgY250ID0gcnVsZXMubGVuZ3RoO1xyXG4gICAgICAgICAgICAgICAgLy8gd2Ugb25seSBoYXZlIHRvIGFkZCBpZiB0aGVyZSBpcyBub3QgeWV0IGEgbWF0Y2ggcnVsZSBoZXJlIHdoaWNoIHBvaW50cyB0byB0aGUgc2FtZVxyXG4gICAgICAgICAgICAgICAgYWRkUmFuZ2VSdWxlc1VubGVzc1ByZXNlbnQocnVsZXMsa2V5c1tpXSxyYW5nZUtleXNNYXBbcmFuZ2VLZXldLGtleXNNYXBba2V5c1tpXV0sc2VlblJ1bGVzKTtcclxuICAgICAgICAgICAgICAgIGlmKHJ1bGVzLmxlbmd0aCA+IGNudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIC8vY29uc29sZS5sb2coYCBhZGRlZCAkeyhydWxlcy5sZW5ndGggLSBjbnQpfSByZWNvcmRzIGF0JHtyYW5nZUtleX0gZm9yICR7a2V5c1tpXX0gJHtkfWApO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgLypcclxuICAgIFtcclxuICAgICAgICBbJ2FFRkcnLCdhRUZHSCddLFxyXG4gICAgICAgIFsnYUVGR0gnLCdhRUZHSEknXSxcclxuICAgICAgICBbJ09kYXRhJywnT0RhdGFzJ10sXHJcbiAgIFsnT2RhdGEnLCdPZGF0YXMnXSxcclxuICAgWydPZGF0YScsJ09kYXRiJ10sXHJcbiAgIFsnT2RhdGEnLCdVRGF0YSddLFxyXG4gICBbJ3NlcnZpY2UnLCdzZXJ2aWNlcyddLFxyXG4gICBbJ3RoaXMgaXNmdW5ueSBhbmQgbW9yZScsJ3RoaXMgaXNmdW5ueSBhbmQgbW9yZXMnXSxcclxuICAgIF0uZm9yRWFjaChyZWMgPT4ge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKGBkaXN0YW5jZSAke3JlY1swXX0gJHtyZWNbMV19IDogJHtEaXN0YW5jZS5jYWxjRGlzdGFuY2UocmVjWzBdLHJlY1sxXSl9ICBhZGYgJHtEaXN0YW5jZS5jYWxjRGlzdGFuY2VBZGp1c3RlZChyZWNbMF0scmVjWzFdKX0gYCk7XHJcblxyXG4gICAgfSk7XHJcbiAgICBjb25zb2xlLmxvZyhcImRpc3RhbmNlIE9kYXRhIFVkYXRhXCIrIERpc3RhbmNlLmNhbGNEaXN0YW5jZSgnT0RhdGEnLCdVRGF0YScpKTtcclxuICAgIGNvbnNvbGUubG9nKFwiZGlzdGFuY2UgT2RhdGEgT2RhdGJcIisgRGlzdGFuY2UuY2FsY0Rpc3RhbmNlKCdPRGF0YScsJ09EYXRiJykpO1xyXG4gICAgY29uc29sZS5sb2coXCJkaXN0YW5jZSBPZGF0YXMgT2RhdGFcIisgRGlzdGFuY2UuY2FsY0Rpc3RhbmNlKCdPRGF0YScsJ09EYXRhYScpKTtcclxuICAgIGNvbnNvbGUubG9nKFwiZGlzdGFuY2UgT2RhdGFzIGFiY2RlXCIrIERpc3RhbmNlLmNhbGNEaXN0YW5jZSgnYWJjZGUnLCdhYmNkZWYnKSk7XHJcbiAgICBjb25zb2xlLmxvZyhcImRpc3RhbmNlIHNlcnZpY2VzIFwiKyBEaXN0YW5jZS5jYWxjRGlzdGFuY2UoJ3NlcnZpY2VzJywnc2VydmljZScpKTtcclxuICAgICovXHJcbn1cclxudmFyIG4gPSAwO1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGxvYWRNb2RlbHMobW9kZWxQYXRoPyA6IHN0cmluZywgYWRkU3BsaXRzPyA6IGJvb2xlYW4pIDogSU1hdGNoLklNb2RlbHMge1xyXG4gICAgdmFyIG9Nb2RlbDogSU1hdGNoLklNb2RlbHM7XHJcbiAgICBvTW9kZWwgPSB7XHJcbiAgICAgICAgZnVsbCA6IHsgZG9tYWluIDoge319LFxyXG4gICAgICAgIHJhd01vZGVscyA6IHt9LFxyXG4gICAgICAgIGRvbWFpbnM6IFtdLFxyXG4gICAgICAgIHRvb2xzOiBbXSxcclxuICAgICAgICBydWxlcyA6IHVuZGVmaW5lZCxcclxuICAgICAgICBjYXRlZ29yeTogW10sXHJcbiAgICAgICAgb3BlcmF0b3JzIDoge30sXHJcbiAgICAgICAgbVJ1bGVzOiBbXSxcclxuICAgICAgICBzZWVuUnVsZXMgOiB7fSxcclxuICAgICAgICByZWNvcmRzOiBbXSxcclxuICAgICAgICBtZXRhIDogeyB0MyA6IHt9IH1cclxuICAgIH1cclxuICAgIGdsb2JhbF9BZGRTcGxpdHMgPSB0cnVlOyAvLyBhZGRTcGxpdHMgfHwgIXByb2Nlc3MuZW52LkFCT1RfT0xETUFUQ0g7XHJcbiAgICBtb2RlbFBhdGggPSBtb2RlbFBhdGggfHwgZW52TW9kZWxQYXRoO1xyXG5cclxuICAgIHRyeSB7XHJcbiAgICAgICB2YXIgYSA9IENpcmN1bGFyU2VyLmxvYWQoJy4vJyArIG1vZGVsUGF0aCArICcvX2NhY2hlJyArICEhYWRkU3BsaXRzICsgJy5qcycpO1xyXG4gICAgICAgLy9jb25zb2xlLmxvZyhcImZvdW5kIGEgY2FjaGUgPyAgXCIgKyAhIWEpO1xyXG4gICAgICAgLy9hID0gdW5kZWZpbmVkO1xyXG4gICAgICAgaWYoYSkge1xyXG4gICAgICAgICAgIGRlYnVnbG9nKFwiIHJldHVybiBwcmVwYXJlc2UgbW9kZWwgXCIpO1xyXG4gICAgICAgICAgIHJldHVybiBhO1xyXG4gICAgICAgfVxyXG4gICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgIC8vY29uc29sZS5sb2coJ2Vycm9yJyArIGUpO1xyXG4gICAgICAgIC8vIG5vIGNhY2hlIGZpbGUsXHJcbiAgICB9XHJcbiAgICB2YXIgc21kbHMgPSBmcy5yZWFkRmlsZVN5bmMoJy4vJyArIG1vZGVsUGF0aCArICcvbW9kZWxzLmpzb24nLCAndXRmLTgnKTtcclxuICAgIHZhciBtZGxzID0gSlNPTi5wYXJzZShcIlwiICsgc21kbHMpO1xyXG4gICAgbWRscy5mb3JFYWNoKGZ1bmN0aW9uIChzTW9kZWxOYW1lKSB7XHJcbiAgICAgICAgbG9hZE1vZGVsKG1vZGVsUGF0aCwgc01vZGVsTmFtZSwgb01vZGVsKVxyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gYWRkIHRoZSBjYXRlZ29yaWVzIHRvIHRoZSBtb2RlbDpcclxuICAgIC8qXHJcbiAgICBvTW9kZWwuY2F0ZWdvcnkuZm9yRWFjaChmdW5jdGlvbiAoY2F0ZWdvcnkpIHtcclxuICAgICAgICBpbnNlcnRSdWxlSWZOb3RQcmVzZW50KG9Nb2RlbC5tUnVsZXMsIHtcclxuICAgICAgICAgICAgY2F0ZWdvcnk6IFwiY2F0ZWdvcnlcIixcclxuICAgICAgICAgICAgbWF0Y2hlZFN0cmluZzogY2F0ZWdvcnksXHJcbiAgICAgICAgICAgIHR5cGU6IElNYXRjaC5FbnVtUnVsZVR5cGUuV09SRCxcclxuICAgICAgICAgICAgd29yZDogY2F0ZWdvcnksXHJcbiAgICAgICAgICAgIGxvd2VyY2FzZXdvcmQ6IGNhdGVnb3J5LnRvTG93ZXJDYXNlKCksXHJcbiAgICAgICAgICAgIGJpdGluZGV4IDogb01kbC5cclxuICAgICAgICAgICAgX3Jhbmtpbmc6IDAuOTVcclxuICAgICAgICB9LCBvTW9kZWwuc2VlblJ1bGVzKTtcclxuICAgIH0pO1xyXG4gICAgKi9cclxuXHJcbiAgICB2YXIgbWV0YUJpdEluZGV4ID0gZ2V0RG9tYWluQml0SW5kZXgoJ21ldGEnLG9Nb2RlbCk7XHJcblxyXG4gICAgLy8gYWRkIHRoZSBkb21haW4gbWV0YSBydWxlXHJcbiAgICBpbnNlcnRSdWxlSWZOb3RQcmVzZW50KG9Nb2RlbC5tUnVsZXMsIHtcclxuICAgICAgICAgICAgY2F0ZWdvcnk6IFwibWV0YVwiLFxyXG4gICAgICAgICAgICBtYXRjaGVkU3RyaW5nOiBcImRvbWFpblwiLFxyXG4gICAgICAgICAgICB0eXBlOiBJTWF0Y2guRW51bVJ1bGVUeXBlLldPUkQsXHJcbiAgICAgICAgICAgIHdvcmQ6IFwiZG9tYWluXCIsXHJcbiAgICAgICAgICAgIGJpdGluZGV4IDogbWV0YUJpdEluZGV4LFxyXG4gICAgICAgICAgICBfcmFua2luZzogMC45NVxyXG4gICAgICAgIH0sIG9Nb2RlbC5zZWVuUnVsZXMpO1xyXG5cclxuXHJcbiAgICB2YXIgZmlsbGVyQml0SW5kZXggPSBnZXREb21haW5CaXRJbmRleCgnbWV0YScsb01vZGVsKTtcclxuICAgIC8vYWRkIGEgZmlsbGVyIHJ1bGVcclxuICAgIHZhciBzZmlsbGVycyA9IGZzLnJlYWRGaWxlU3luYygnLi8nICsgbW9kZWxQYXRoICsgJy9maWxsZXIuanNvbicsICd1dGYtOCcpO1xyXG4gICAgdmFyIGZpbGxlcnMgPSBKU09OLnBhcnNlKHNmaWxsZXJzKTtcclxuICAgIHZhciByZSA9IFwiXigoXCIgKyBmaWxsZXJzLmpvaW4oXCIpfChcIikgKyBcIikpJFwiO1xyXG4gICAgb01vZGVsLm1SdWxlcy5wdXNoKHtcclxuICAgICAgICBjYXRlZ29yeTogXCJmaWxsZXJcIixcclxuICAgICAgICB0eXBlOiBJTWF0Y2guRW51bVJ1bGVUeXBlLlJFR0VYUCxcclxuICAgICAgICByZWdleHA6IG5ldyBSZWdFeHAocmUsIFwiaVwiKSxcclxuICAgICAgICBtYXRjaGVkU3RyaW5nOiBcImZpbGxlclwiLFxyXG4gICAgICAgIGJpdGluZGV4IDogZmlsbGVyQml0SW5kZXgsXHJcbiAgICAgICAgX3Jhbmtpbmc6IDAuOVxyXG4gICAgfSk7XHJcblxyXG4gICAgLy9hZGQgb3BlcmF0b3JzXHJcbiAgICB2YXIgc09wZXJhdG9ycyA9IGZzLnJlYWRGaWxlU3luYygnLi9yZXNvdXJjZXMvbW9kZWwvb3BlcmF0b3JzLmpzb24nLCAndXRmLTgnKTtcclxuICAgIHZhciBvcGVyYXRvcnMgPSBKU09OLnBhcnNlKHNPcGVyYXRvcnMpO1xyXG4gICAgdmFyIG9wZXJhdG9yQml0SW5kZXggPSBnZXREb21haW5CaXRJbmRleCgnb3BlcmF0b3JzJyxvTW9kZWwpO1xyXG4gICAgT2JqZWN0LmtleXMob3BlcmF0b3JzLm9wZXJhdG9ycykuZm9yRWFjaChmdW5jdGlvbihvcGVyYXRvcikge1xyXG4gICAgICAgIGlmKElNYXRjaC5hT3BlcmF0b3JOYW1lcy5pbmRleE9mKG9wZXJhdG9yKSA8IDApIHtcclxuICAgICAgICAgICAgZGVidWdsb2coXCJ1bmtub3duIG9wZXJhdG9yIFwiICsgb3BlcmF0b3IpO1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJ1bmtub3duIG9wZXJhdG9yIFwiICsgb3BlcmF0b3IpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBvTW9kZWwub3BlcmF0b3JzW29wZXJhdG9yXSA9IG9wZXJhdG9ycy5vcGVyYXRvcnNbb3BlcmF0b3JdO1xyXG4gICAgICAgIG9Nb2RlbC5vcGVyYXRvcnNbb3BlcmF0b3JdLm9wZXJhdG9yID0gPElNYXRjaC5PcGVyYXRvck5hbWU+IG9wZXJhdG9yO1xyXG4gICAgICAgIE9iamVjdC5mcmVlemUob01vZGVsLm9wZXJhdG9yc1tvcGVyYXRvcl0pO1xyXG4gICAgICAgIHZhciB3b3JkID0gb3BlcmF0b3I7XHJcbiAgICAgICAgaW5zZXJ0UnVsZUlmTm90UHJlc2VudChvTW9kZWwubVJ1bGVzLCB7XHJcbiAgICAgICAgICAgIGNhdGVnb3J5OiBcIm9wZXJhdG9yXCIsXHJcbiAgICAgICAgICAgIHdvcmQgOiB3b3JkLnRvTG93ZXJDYXNlKCksXHJcbiAgICAgICAgICAgIGxvd2VyY2FzZXdvcmQgOiB3b3JkLnRvTG93ZXJDYXNlKCksXHJcbiAgICAgICAgICAgIHR5cGU6IElNYXRjaC5FbnVtUnVsZVR5cGUuV09SRCxcclxuICAgICAgICAgICAgbWF0Y2hlZFN0cmluZyA6IHdvcmQsXHJcbiAgICAgICAgICAgIGJpdGluZGV4IDogb3BlcmF0b3JCaXRJbmRleCxcclxuICAgICAgICAgICAgX3Jhbmtpbmc6IDAuOVxyXG4gICAgICAgIH0sIG9Nb2RlbC5zZWVuUnVsZXMpO1xyXG4gICAgICAgIC8vIGFkZCBhbGwgc3lub255bXNcclxuICAgICAgICBpZihvcGVyYXRvcnMuc3lub255bXNbb3BlcmF0b3JdKSB7XHJcbiAgICAgICAgICAgIE9iamVjdC5rZXlzKG9wZXJhdG9ycy5zeW5vbnltc1tvcGVyYXRvcl0pLmZvckVhY2goZnVuY3Rpb24oc3lub255bSkge1xyXG4gICAgICAgICAgICAgICAgaW5zZXJ0UnVsZUlmTm90UHJlc2VudChvTW9kZWwubVJ1bGVzLHtcclxuICAgICAgICAgICAgICAgICAgICBjYXRlZ29yeTogXCJvcGVyYXRvclwiLFxyXG4gICAgICAgICAgICAgICAgICAgIHdvcmQgOiBzeW5vbnltLnRvTG93ZXJDYXNlKCksXHJcbiAgICAgICAgICAgICAgICAgICAgbG93ZXJjYXNld29yZCA6IHN5bm9ueW0udG9Mb3dlckNhc2UoKSxcclxuICAgICAgICAgICAgICAgICAgICB0eXBlOiBJTWF0Y2guRW51bVJ1bGVUeXBlLldPUkQsXHJcbiAgICAgICAgICAgICAgICAgICAgbWF0Y2hlZFN0cmluZyA6IG9wZXJhdG9yLFxyXG4gICAgICAgICAgICAgICAgICAgIGJpdGluZGV4IDogb3BlcmF0b3JCaXRJbmRleCxcclxuICAgICAgICAgICAgICAgICAgICBfcmFua2luZzogMC45XHJcbiAgICAgICAgICAgICAgICB9LCBvTW9kZWwuc2VlblJ1bGVzKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICAvKlxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgICAgIHtcclxuICAgICAgICAgIGNhdGVnb3J5OiBcImZpbGxlclwiLFxyXG4gICAgICAgICAgdHlwZTogMSxcclxuICAgICAgICAgIHJlZ2V4cDogL14oKHN0YXJ0KXwoc2hvdyl8KGZyb20pfChpbikpJC9pLFxyXG4gICAgICAgICAgbWF0Y2hlZFN0cmluZzogXCJmaWxsZXJcIixcclxuICAgICAgICAgIF9yYW5raW5nOiAwLjlcclxuICAgICAgICB9LFxyXG4gICAgKi9cclxuICAgIG9Nb2RlbC5tUnVsZXMgPSBvTW9kZWwubVJ1bGVzLnNvcnQoSW5wdXRGaWx0ZXJSdWxlcy5jbXBNUnVsZSk7XHJcbiAgICBhZGRDbG9zZUV4YWN0UmFuZ2VSdWxlcyhvTW9kZWwubVJ1bGVzLCBvTW9kZWwuc2VlblJ1bGVzKTtcclxuICAgIG9Nb2RlbC5tUnVsZXMgPSBvTW9kZWwubVJ1bGVzLnNvcnQoSW5wdXRGaWx0ZXJSdWxlcy5jbXBNUnVsZSk7XHJcbiAgICBpZihnbG9iYWwgJiYgZ2xvYmFsLmdjKSB7XHJcbiAgICAgICAgZ2xvYmFsLmdjKCk7XHJcbiAgICB9XHJcbiAgICBvTW9kZWwucnVsZXMgPSBzcGxpdFJ1bGVzKG9Nb2RlbC5tUnVsZXMpO1xyXG4gICAgaWYoZ2xvYmFsICYmIGdsb2JhbC5nYykge1xyXG4gICAgICAgIGdsb2JhbC5nYygpO1xyXG4gICAgfVxyXG4gICAgb01vZGVsLnRvb2xzID0gb01vZGVsLnRvb2xzLnNvcnQoVG9vbHMuY21wVG9vbHMpO1xyXG4gICAgZGVsZXRlIG9Nb2RlbC5zZWVuUnVsZXM7XHJcbiAgICBkZWJ1Z2xvZygnc2F2aW5nJyk7XHJcbiAgICBpZihnbG9iYWwgJiYgZ2xvYmFsLmdjKSB7XHJcbiAgICAgICAgZ2xvYmFsLmdjKCk7XHJcbiAgICB9XHJcbiAgICBDaXJjdWxhclNlci5zYXZlKCcuLycgKyBtb2RlbFBhdGggKyAnL19jYWNoZScgKyAhIWFkZFNwbGl0cyArICcuanMnLG9Nb2RlbCk7XHJcbiAgICBpZihnbG9iYWwgJiYgZ2xvYmFsLmdjKSB7XHJcbiAgICAgICAgZ2xvYmFsLmdjKCk7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gb01vZGVsO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gc29ydENhdGVnb3JpZXNCeUltcG9ydGFuY2UoIG1hcCA6IHtba2V5IDogc3RyaW5nXSA6IElNYXRjaC5JQ2F0ZWdvcnlEZXNjIH0sIGNhdHMgOiBzdHJpbmdbXSkgOiBzdHJpbmdbXSB7XHJcbiAgICB2YXIgcmVzID0gY2F0cy5zbGljZSgwKTtcclxuICAgIHJlcy5zb3J0KHJhbmtDYXRlZ29yeUJ5SW1wb3J0YW5jZS5iaW5kKHVuZGVmaW5lZCxtYXApKTtcclxuICAgIHJldHVybiByZXM7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiByYW5rQ2F0ZWdvcnlCeUltcG9ydGFuY2UobWFwIDoge1trZXkgOiBzdHJpbmddIDogSU1hdGNoLklDYXRlZ29yeURlc2MgfSwgY2F0YSA6IHN0cmluZywgY2F0YiA6IHN0cmluZykgOiBudW1iZXIge1xyXG4gICAgdmFyIGNhdEFEZXNjID0gbWFwW2NhdGFdO1xyXG4gICAgdmFyIGNhdEJEZXNjID0gbWFwW2NhdGJdO1xyXG4gICAgaWYgKGNhdGEgPT09IGNhdGIpIHtcclxuICAgICAgICByZXR1cm4gMDtcclxuICAgIH1cclxuICAgIC8vIGlmIGEgaXMgYmVmb3JlIGIsIHJldHVybiAtMVxyXG4gICAgaWYoY2F0QURlc2MgJiYgIWNhdEJEZXNjKSB7XHJcbiAgICAgICAgcmV0dXJuIC0xO1xyXG4gICAgfVxyXG4gICAgaWYoIWNhdEFEZXNjICYmIGNhdEJEZXNjKSB7XHJcbiAgICAgICAgcmV0dXJuICsxO1xyXG4gICAgfVxyXG5cclxuICAgIHZhciBwcmlvQSA9IChjYXRBRGVzYyAmJiBjYXRBRGVzYy5pbXBvcnRhbmNlKSB8fCA5OTtcclxuICAgIHZhciBwcmlvQiA9IChjYXRCRGVzYyAmJiBjYXRCRGVzYy5pbXBvcnRhbmNlKSB8fCA5OTtcclxuICAgIC8vIGxvd2VyIHByaW8gZ29lcyB0byBmcm9udFxyXG4gICAgdmFyIHIgPSBwcmlvQSAtIHByaW9CO1xyXG4gICAgaWYocikge1xyXG4gICAgICAgIHJldHVybiByO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGNhdGEubG9jYWxlQ29tcGFyZShjYXRiKTtcclxufVxyXG5cclxuY29uc3QgTWV0YUYgPSBNZXRhLmdldE1ldGFGYWN0b3J5KCk7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0T3BlcmF0b3IobWRsOiBJTWF0Y2guSU1vZGVscywgb3BlcmF0b3IgOiBzdHJpbmcpIDogSU1hdGNoLklPcGVyYXRvciB7XHJcbiAgICByZXR1cm4gbWRsLm9wZXJhdG9yc1tvcGVyYXRvcl07XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRSZXN1bHRBc0FycmF5KG1kbCA6IElNYXRjaC5JTW9kZWxzLCBhIDogTWV0YS5JTWV0YSwgcmVsIDogTWV0YS5JTWV0YSkgOiBNZXRhLklNZXRhW10ge1xyXG4gICAgaWYocmVsLnRvVHlwZSgpICE9PSAncmVsYXRpb24nKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiZXhwZWN0IHJlbGF0aW9uIGFzIDJuZCBhcmdcIik7XHJcbiAgICB9XHJcblxyXG4gICAgdmFyIHJlcyA9IG1kbC5tZXRhLnQzW2EudG9GdWxsU3RyaW5nKCldICYmXHJcbiAgICBtZGwubWV0YS50M1thLnRvRnVsbFN0cmluZygpXVtyZWwudG9GdWxsU3RyaW5nKCldO1xyXG4gICAgaWYoIXJlcykge1xyXG4gICAgICAgIHJldHVybiBbXTtcclxuICAgIH1cclxuICAgIHJldHVybiBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhyZXMpLnNvcnQoKS5tYXAoTWV0YUYucGFyc2VJTWV0YSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRDYXRlZ29yaWVzRm9yRG9tYWluKHRoZU1vZGVsIDogSU1hdGNoLklNb2RlbHMsIGRvbWFpbiA6IHN0cmluZykgOiBzdHJpbmdbXSB7XHJcbiAgICBpZih0aGVNb2RlbC5kb21haW5zLmluZGV4T2YoZG9tYWluKSA8IDApIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEb21haW4gXFxcIlwiICsgZG9tYWluICsgXCJcXFwiIG5vdCBwYXJ0IG9mIG1vZGVsXCIpO1xyXG4gICAgfVxyXG4gICAgdmFyIHJlcyA9IGdldFJlc3VsdEFzQXJyYXkodGhlTW9kZWwsIE1ldGFGLkRvbWFpbihkb21haW4pLCBNZXRhRi5SZWxhdGlvbihNZXRhLlJFTEFUSU9OX2hhc0NhdGVnb3J5KSk7XHJcbiAgICByZXR1cm4gTWV0YS5nZXRTdHJpbmdBcnJheShyZXMpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0VGFibGVDb2x1bW5zKHRoZU1vZGVsOiBJTWF0Y2guSU1vZGVscywgZG9tYWluIDogc3RyaW5nKSA6IHN0cmluZ1tdIHtcclxuICAgIGlmKHRoZU1vZGVsLmRvbWFpbnMuaW5kZXhPZihkb21haW4pIDwgMCkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkRvbWFpbiBcXFwiXCIgKyBkb21haW4gKyBcIlxcXCIgbm90IHBhcnQgb2YgbW9kZWxcIik7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gdGhlTW9kZWwucmF3TW9kZWxzW2RvbWFpbl0uY29sdW1ucy5zbGljZSgwKTtcclxufVxyXG5cclxuXHJcbi8qKlxyXG4gKiBSZXR1cm4gYWxsIGNhdGVnb3JpZXMgb2YgYSBkb21haW4gd2hpY2ggY2FuIGFwcGVhciBvbiBhIHdvcmQsXHJcbiAqIHRoZXNlIGFyZSB0eXBpY2FsbHkgdGhlIHdvcmRpbmRleCBkb21haW5zICsgZW50cmllcyBnZW5lcmF0ZWQgYnkgZ2VuZXJpYyBydWxlc1xyXG4gKlxyXG4gKiBUaGUgY3VycmVudCBpbXBsZW1lbnRhdGlvbiBpcyBhIHNpbXBsaWZpY2F0aW9uXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gZ2V0UG90ZW50aWFsV29yZENhdGVnb3JpZXNGb3JEb21haW4odGhlTW9kZWwgOiBJTWF0Y2guSU1vZGVscywgZG9tYWluIDogc3RyaW5nKSA6IHN0cmluZ1tdIHtcclxuICAgIC8vIHRoaXMgaXMgYSBzaW1wbGlmaWVkIHZlcnNpb25cclxuICAgIHJldHVybiBnZXRDYXRlZ29yaWVzRm9yRG9tYWluKHRoZU1vZGVsLCBkb21haW4pO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0RG9tYWluc0ZvckNhdGVnb3J5KHRoZU1vZGVsIDogSU1hdGNoLklNb2RlbHMsIGNhdGVnb3J5IDogc3RyaW5nKSA6IHN0cmluZ1tdIHtcclxuICAgIGlmKHRoZU1vZGVsLmNhdGVnb3J5LmluZGV4T2YoY2F0ZWdvcnkpIDwgMCkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhdGVnb3J5IFxcXCJcIiArIGNhdGVnb3J5ICsgXCJcXFwiIG5vdCBwYXJ0IG9mIG1vZGVsXCIpO1xyXG4gICAgfVxyXG4gICAgdmFyIHJlcyA9IGdldFJlc3VsdEFzQXJyYXkodGhlTW9kZWwsIE1ldGFGLkNhdGVnb3J5KGNhdGVnb3J5KSwgTWV0YUYuUmVsYXRpb24oTWV0YS5SRUxBVElPTl9pc0NhdGVnb3J5T2YpKTtcclxuICAgIHJldHVybiBNZXRhLmdldFN0cmluZ0FycmF5KHJlcyk7XHJcbn1cclxuXHJcblxyXG4gZXhwb3J0IGZ1bmN0aW9uIGdldEFsbFJlY29yZENhdGVnb3JpZXNGb3JUYXJnZXRDYXRlZ29yeShtb2RlbCA6IElNYXRjaC5JTW9kZWxzLCBjYXRlZ29yeSA6IHN0cmluZywgd29yZHNvbmx5IDogYm9vbGVhbikgOiB7W2tleTogc3RyaW5nXSA6IGJvb2xlYW59IHtcclxuICAgIHZhciByZXMgPSB7fTtcclxuICAgIC8vXHJcbiAgICB2YXIgZm4gPSB3b3Jkc29ubHkgPyBnZXRQb3RlbnRpYWxXb3JkQ2F0ZWdvcmllc0ZvckRvbWFpbiA6IGdldENhdGVnb3JpZXNGb3JEb21haW47XHJcbiAgICB2YXIgZG9tYWlucyA9IGdldERvbWFpbnNGb3JDYXRlZ29yeShtb2RlbCwgY2F0ZWdvcnkpO1xyXG4gICAgZG9tYWlucy5mb3JFYWNoKGZ1bmN0aW9uKGRvbWFpbikge1xyXG4gICAgICAgIGZuKG1vZGVsLCBkb21haW4pLmZvckVhY2goZnVuY3Rpb24od29yZGNhdCkge1xyXG4gICAgICAgICAgICByZXNbd29yZGNhdF0gPSB0cnVlO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZnJlZXplKHJlcyk7XHJcbiAgICByZXR1cm4gcmVzO1xyXG4gfVxyXG5cclxuIGV4cG9ydCBmdW5jdGlvbiBnZXRBbGxSZWNvcmRDYXRlZ29yaWVzRm9yVGFyZ2V0Q2F0ZWdvcmllcyhtb2RlbCA6IElNYXRjaC5JTW9kZWxzLCBjYXRlZ29yaWVzIDogc3RyaW5nW10sIHdvcmRzb25seSA6IGJvb2xlYW4pIDoge1trZXk6IHN0cmluZ10gOiBib29sZWFufSB7XHJcbiAgICB2YXIgcmVzID0ge307XHJcbiAgICAvL1xyXG4gICAgdmFyIGZuID0gd29yZHNvbmx5ID8gZ2V0UG90ZW50aWFsV29yZENhdGVnb3JpZXNGb3JEb21haW4gOiBnZXRDYXRlZ29yaWVzRm9yRG9tYWluO1xyXG4gICAgdmFyIGRvbWFpbnMgPSB1bmRlZmluZWQ7XHJcbiAgICBjYXRlZ29yaWVzLmZvckVhY2goZnVuY3Rpb24oY2F0ZWdvcnkpIHtcclxuICAgICAgICB2YXIgY2F0ZG9tYWlucyA9IGdldERvbWFpbnNGb3JDYXRlZ29yeShtb2RlbCwgY2F0ZWdvcnkpXHJcbiAgICAgICAgaWYoIWRvbWFpbnMpIHtcclxuICAgICAgICAgICAgZG9tYWlucyA9IGNhdGRvbWFpbnM7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgZG9tYWlucyA9IF8uaW50ZXJzZWN0aW9uKGRvbWFpbnMsIGNhdGRvbWFpbnMpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgaWYoZG9tYWlucy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2NhdGVnb3JpZXMgJyArIFV0aWxzLmxpc3RUb1F1b3RlZENvbW1hQW5kKGNhdGVnb3JpZXMpICsgJyBoYXZlIG5vIGNvbW1vbiBkb21haW4uJylcclxuICAgIH1cclxuICAgIGRvbWFpbnMuZm9yRWFjaChmdW5jdGlvbihkb21haW4pIHtcclxuICAgICAgICBmbihtb2RlbCwgZG9tYWluKS5mb3JFYWNoKGZ1bmN0aW9uKHdvcmRjYXQpIHtcclxuICAgICAgICAgICAgcmVzW3dvcmRjYXRdID0gdHJ1ZTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmZyZWV6ZShyZXMpO1xyXG4gICAgcmV0dXJuIHJlcztcclxuIH1cclxuXHJcblxyXG4iLCIvKipcbiAqIEZ1bmN0aW9uYWxpdHkgbWFuYWdpbmcgdGhlIG1hdGNoIG1vZGVsc1xuICpcbiAqIEBmaWxlXG4gKi9cblwidXNlIHN0cmljdFwiO1xudmFyIGRlYnVnID0gcmVxdWlyZShcImRlYnVnXCIpO1xudmFyIGRlYnVnbG9nID0gZGVidWcoJ21vZGVsJyk7XG52YXIgbG9nZ2VyID0gcmVxdWlyZShcIi4uL3V0aWxzL2xvZ2dlclwiKTtcbnZhciBsb2FkbG9nID0gbG9nZ2VyLmxvZ2dlcignbW9kZWxsb2FkJywgJycpO1xudmFyIElNYXRjaCA9IHJlcXVpcmUoXCIuLi9tYXRjaC9pZm1hdGNoXCIpO1xudmFyIElucHV0RmlsdGVyUnVsZXMgPSByZXF1aXJlKFwiLi4vbWF0Y2gvaW5wdXRGaWx0ZXJSdWxlc1wiKTtcbnZhciBUb29scyA9IHJlcXVpcmUoXCIuLi9tYXRjaC90b29sc1wiKTtcbnZhciBmcyA9IHJlcXVpcmUoXCJmc1wiKTtcbnZhciBNZXRhID0gcmVxdWlyZShcIi4vbWV0YVwiKTtcbnZhciBVdGlscyA9IHJlcXVpcmUoXCIuLi91dGlscy91dGlsc1wiKTtcbnZhciBDaXJjdWxhclNlciA9IHJlcXVpcmUoXCIuLi91dGlscy9jaXJjdWxhcnNlclwiKTtcbnZhciBwcm9jZXNzID0gcmVxdWlyZShcInByb2Nlc3NcIik7XG52YXIgXyA9IHJlcXVpcmUoXCJsb2Rhc2hcIik7XG5leHBvcnRzLmdsb2JhbF9BZGRTcGxpdHMgPSB0cnVlOyAvLyBmYWxzZTtcbi8qKlxuICogdGhlIG1vZGVsIHBhdGgsIG1heSBiZSBjb250cm9sbGVkIHZpYSBlbnZpcm9ubWVudCB2YXJpYWJsZVxuICovXG52YXIgZW52TW9kZWxQYXRoID0gcHJvY2Vzcy5lbnZbXCJBQk9UX01PREVMUEFUSFwiXSB8fCBcInRlc3Rtb2RlbFwiO1xudmFyIEFSUl9NT0RFTF9QUk9QRVJUSUVTID0gW1wiZG9tYWluXCIsIFwiYml0aW5kZXhcIiwgXCJkZWZhdWx0a2V5Y29sdW1uXCIsIFwiZGVmYXVsdHVyaVwiLCBcImNhdGVnb3J5RGVzY3JpYmVkXCIsIFwiY29sdW1uc1wiLCBcImRlc2NyaXB0aW9uXCIsIFwidG9vbFwiLCBcInRvb2xoaWRkZW5cIiwgXCJzeW5vbnltc1wiLCBcImNhdGVnb3J5XCIsIFwid29yZGluZGV4XCIsIFwiZXhhY3RtYXRjaFwiLCBcImhpZGRlblwiXTtcbmZ1bmN0aW9uIGFkZFN5bm9ueW1zKHN5bm9ueW1zLCBjYXRlZ29yeSwgc3lub255bUZvciwgYml0aW5kZXgsIG1SdWxlcywgc2Vlbikge1xuICAgIHN5bm9ueW1zLmZvckVhY2goZnVuY3Rpb24gKHN5bikge1xuICAgICAgICB2YXIgb1J1bGUgPSB7XG4gICAgICAgICAgICBjYXRlZ29yeTogY2F0ZWdvcnksXG4gICAgICAgICAgICBtYXRjaGVkU3RyaW5nOiBzeW5vbnltRm9yLFxuICAgICAgICAgICAgdHlwZTogMCAvKiBXT1JEICovLFxuICAgICAgICAgICAgd29yZDogc3luLFxuICAgICAgICAgICAgYml0aW5kZXg6IGJpdGluZGV4LFxuICAgICAgICAgICAgX3Jhbmtpbmc6IDAuOTVcbiAgICAgICAgfTtcbiAgICAgICAgZGVidWdsb2coZGVidWdsb2cuZW5hYmxlZCA/IChcImluc2VydGluZyBzeW5vbnltXCIgKyBKU09OLnN0cmluZ2lmeShvUnVsZSkpIDogJy0nKTtcbiAgICAgICAgaW5zZXJ0UnVsZUlmTm90UHJlc2VudChtUnVsZXMsIG9SdWxlLCBzZWVuKTtcbiAgICB9KTtcbn1cbmZ1bmN0aW9uIGdldFJ1bGVLZXkocnVsZSkge1xuICAgIHZhciByMSA9IHJ1bGUubWF0Y2hlZFN0cmluZyArIFwiLXwtXCIgKyBydWxlLmNhdGVnb3J5ICsgXCIgLXwtIFwiICsgcnVsZS50eXBlICsgXCIgLXwtIFwiICsgcnVsZS53b3JkICsgXCIgXCI7XG4gICAgaWYgKHJ1bGUucmFuZ2UpIHtcbiAgICAgICAgdmFyIHIyID0gZ2V0UnVsZUtleShydWxlLnJhbmdlLnJ1bGUpO1xuICAgICAgICByMSArPSBcIiAtfC0gXCIgKyBydWxlLnJhbmdlLmxvdyArIFwiL1wiICsgcnVsZS5yYW5nZS5oaWdoICsgXCIgLXwtIFwiICsgcjI7XG4gICAgfVxuICAgIHJldHVybiByMTtcbn1cbnZhciBCcmVha2Rvd24gPSByZXF1aXJlKFwiLi4vbWF0Y2gvYnJlYWtkb3duXCIpO1xuLyogZ2l2ZW4gYSBydWxlIHdoaWNoIHJlcHJlc2VudHMgYSB3b3JkIHNlcXVlbmNlIHdoaWNoIGlzIHNwbGl0IGR1cmluZyB0b2tlbml6YXRpb24gKi9cbmZ1bmN0aW9uIGFkZEJlc3RTcGxpdChtUnVsZXMsIHJ1bGUsIHNlZW5SdWxlcykge1xuICAgIGlmICghZXhwb3J0cy5nbG9iYWxfQWRkU3BsaXRzKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKHJ1bGUudHlwZSAhPT0gMCAvKiBXT1JEICovKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdmFyIGJlc3QgPSBCcmVha2Rvd24ubWFrZU1hdGNoUGF0dGVybihydWxlLmxvd2VyY2FzZXdvcmQpO1xuICAgIGlmICghYmVzdCkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIHZhciBuZXdSdWxlID0ge1xuICAgICAgICBjYXRlZ29yeTogcnVsZS5jYXRlZ29yeSxcbiAgICAgICAgbWF0Y2hlZFN0cmluZzogcnVsZS5tYXRjaGVkU3RyaW5nLFxuICAgICAgICBiaXRpbmRleDogcnVsZS5iaXRpbmRleCxcbiAgICAgICAgd29yZDogYmVzdC5sb25nZXN0VG9rZW4sXG4gICAgICAgIHR5cGU6IDAsXG4gICAgICAgIGxvd2VyY2FzZXdvcmQ6IGJlc3QubG9uZ2VzdFRva2VuLFxuICAgICAgICBfcmFua2luZzogMC45NSxcbiAgICAgICAgLy8gICAgZXhhY3RPbmx5IDogcnVsZS5leGFjdE9ubHksXG4gICAgICAgIHJhbmdlOiBiZXN0LnNwYW5cbiAgICB9O1xuICAgIGlmIChydWxlLmV4YWN0T25seSkge1xuICAgICAgICBuZXdSdWxlLmV4YWN0T25seSA9IHJ1bGUuZXhhY3RPbmx5O1xuICAgIH1cbiAgICA7XG4gICAgbmV3UnVsZS5yYW5nZS5ydWxlID0gcnVsZTtcbiAgICBpbnNlcnRSdWxlSWZOb3RQcmVzZW50KG1SdWxlcywgbmV3UnVsZSwgc2VlblJ1bGVzKTtcbn1cbmV4cG9ydHMuYWRkQmVzdFNwbGl0ID0gYWRkQmVzdFNwbGl0O1xuZnVuY3Rpb24gaW5zZXJ0UnVsZUlmTm90UHJlc2VudChtUnVsZXMsIHJ1bGUsIHNlZW5SdWxlcykge1xuICAgIGlmIChydWxlLnR5cGUgIT09IDAgLyogV09SRCAqLykge1xuICAgICAgICBtUnVsZXMucHVzaChydWxlKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoKHJ1bGUud29yZCA9PT0gdW5kZWZpbmVkKSB8fCAocnVsZS5tYXRjaGVkU3RyaW5nID09PSB1bmRlZmluZWQpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignaWxsZWdhbCBydWxlJyArIEpTT04uc3RyaW5naWZ5KHJ1bGUsIHVuZGVmaW5lZCwgMikpO1xuICAgIH1cbiAgICB2YXIgciA9IGdldFJ1bGVLZXkocnVsZSk7XG4gICAgLyogaWYoIChydWxlLndvcmQgPT09IFwic2VydmljZVwiIHx8IHJ1bGUud29yZD09PSBcInNlcnZpY2VzXCIpICYmIHIuaW5kZXhPZignT0RhdGEnKSA+PSAwKSB7XG4gICAgICAgICBjb25zb2xlLmxvZyhcInJ1bGVrZXkgaXNcIiArIHIpO1xuICAgICAgICAgY29uc29sZS5sb2coXCJwcmVzZW5jZSBpcyBcIiArIEpTT04uc3RyaW5naWZ5KHNlZW5SdWxlc1tyXSkpO1xuICAgICB9Ki9cbiAgICBydWxlLmxvd2VyY2FzZXdvcmQgPSBydWxlLndvcmQudG9Mb3dlckNhc2UoKTtcbiAgICBpZiAoc2VlblJ1bGVzW3JdKSB7XG4gICAgICAgIGRlYnVnbG9nKGRlYnVnbG9nLmVuYWJsZWQgPyAoXCJBdHRlbXB0aW5nIHRvIGluc2VydCBkdXBsaWNhdGVcIiArIEpTT04uc3RyaW5naWZ5KHJ1bGUsIHVuZGVmaW5lZCwgMikpIDogXCItXCIpO1xuICAgICAgICB2YXIgZHVwbGljYXRlcyA9IHNlZW5SdWxlc1tyXS5maWx0ZXIoZnVuY3Rpb24gKG9FbnRyeSkge1xuICAgICAgICAgICAgcmV0dXJuIDAgPT09IElucHV0RmlsdGVyUnVsZXMuY29tcGFyZU1SdWxlRnVsbChvRW50cnksIHJ1bGUpO1xuICAgICAgICB9KTtcbiAgICAgICAgaWYgKGR1cGxpY2F0ZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgfVxuICAgIHNlZW5SdWxlc1tyXSA9IChzZWVuUnVsZXNbcl0gfHwgW10pO1xuICAgIHNlZW5SdWxlc1tyXS5wdXNoKHJ1bGUpO1xuICAgIGlmIChydWxlLndvcmQgPT09IFwiXCIpIHtcbiAgICAgICAgZGVidWdsb2coZGVidWdsb2cuZW5hYmxlZCA/ICgnU2tpcHBpbmcgcnVsZSB3aXRoIGVtdHB5IHdvcmQgJyArIEpTT04uc3RyaW5naWZ5KHJ1bGUsIHVuZGVmaW5lZCwgMikpIDogJy0nKTtcbiAgICAgICAgbG9hZGxvZygnU2tpcHBpbmcgcnVsZSB3aXRoIGVtdHB5IHdvcmQgJyArIEpTT04uc3RyaW5naWZ5KHJ1bGUsIHVuZGVmaW5lZCwgMikpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIG1SdWxlcy5wdXNoKHJ1bGUpO1xuICAgIGFkZEJlc3RTcGxpdChtUnVsZXMsIHJ1bGUsIHNlZW5SdWxlcyk7XG4gICAgcmV0dXJuO1xufVxuZnVuY3Rpb24gbG9hZE1vZGVsRGF0YShtb2RlbFBhdGgsIG9NZGwsIHNNb2RlbE5hbWUsIG9Nb2RlbCkge1xuICAgIC8vIHJlYWQgdGhlIGRhdGEgLT5cbiAgICAvLyBkYXRhIGlzIHByb2Nlc3NlZCBpbnRvIG1SdWxlcyBkaXJlY3RseSxcbiAgICB2YXIgYml0aW5kZXggPSBvTWRsLmJpdGluZGV4O1xuICAgIHZhciBzRmlsZU5hbWUgPSAoJy4vJyArIG1vZGVsUGF0aCArICcvJyArIHNNb2RlbE5hbWUgKyBcIi5kYXRhLmpzb25cIik7XG4gICAgdmFyIG1kbGRhdGEgPSBmcy5yZWFkRmlsZVN5bmMoc0ZpbGVOYW1lLCAndXRmLTgnKTtcbiAgICB2YXIgb01kbERhdGEgPSBKU09OLnBhcnNlKG1kbGRhdGEpO1xuICAgIG9NZGxEYXRhLmZvckVhY2goZnVuY3Rpb24gKG9FbnRyeSkge1xuICAgICAgICBpZiAoIW9FbnRyeS50b29sKSB7XG4gICAgICAgICAgICBvRW50cnkuX2RvbWFpbiA9IG9NZGwuZG9tYWluO1xuICAgICAgICB9XG4gICAgICAgIGlmICghb0VudHJ5LnRvb2wgJiYgb01kbC50b29sLm5hbWUpIHtcbiAgICAgICAgICAgIG9FbnRyeS50b29sID0gb01kbC50b29sLm5hbWU7XG4gICAgICAgIH1cbiAgICAgICAgb01vZGVsLnJlY29yZHMucHVzaChvRW50cnkpO1xuICAgICAgICBvTWRsLmNhdGVnb3J5LmZvckVhY2goZnVuY3Rpb24gKGNhdCkge1xuICAgICAgICAgICAgaWYgKG9FbnRyeVtjYXRdID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIG9FbnRyeVtjYXRdID0gXCJuL2FcIjtcbiAgICAgICAgICAgICAgICB2YXIgYnVnID0gXCJJTkNPTlNJU1RFTlQqPiBNb2RlbERhdGEgXCIgKyBzRmlsZU5hbWUgKyBcIiBkb2VzIG5vdCBjb250YWluIGNhdGVnb3J5IFwiICsgY2F0ICsgXCIgd2l0aCB2YWx1ZSAndW5kZWZpbmVkJywgdW5kZWZpbmVkIGlzIGlsbGVnYWwgdmFsdWUsIHVzZSBuL2EgXCIgKyBKU09OLnN0cmluZ2lmeShvRW50cnkpICsgXCJcIjtcbiAgICAgICAgICAgICAgICBkZWJ1Z2xvZyhidWcpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgb01kbC53b3JkaW5kZXguZm9yRWFjaChmdW5jdGlvbiAoY2F0ZWdvcnkpIHtcbiAgICAgICAgICAgIGlmIChvRW50cnlbY2F0ZWdvcnldID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBkZWJ1Z2xvZyhcIklOQ09OU0lTVEVOVCo+IE1vZGVsRGF0YSBcIiArIHNGaWxlTmFtZSArIFwiIGRvZXMgbm90IGNvbnRhaW4gY2F0ZWdvcnkgXCIgKyBjYXRlZ29yeSArIFwiIG9mIHdvcmRpbmRleFwiICsgSlNPTi5zdHJpbmdpZnkob0VudHJ5KSArIFwiXCIpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChvRW50cnlbY2F0ZWdvcnldICE9PSBcIipcIikge1xuICAgICAgICAgICAgICAgIHZhciBzU3RyaW5nID0gb0VudHJ5W2NhdGVnb3J5XTtcbiAgICAgICAgICAgICAgICBkZWJ1Z2xvZyhcInB1c2hpbmcgcnVsZSB3aXRoIFwiICsgY2F0ZWdvcnkgKyBcIiAtPiBcIiArIHNTdHJpbmcpO1xuICAgICAgICAgICAgICAgIHZhciBvUnVsZSA9IHtcbiAgICAgICAgICAgICAgICAgICAgY2F0ZWdvcnk6IGNhdGVnb3J5LFxuICAgICAgICAgICAgICAgICAgICBtYXRjaGVkU3RyaW5nOiBzU3RyaW5nLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAwIC8qIFdPUkQgKi8sXG4gICAgICAgICAgICAgICAgICAgIHdvcmQ6IHNTdHJpbmcsXG4gICAgICAgICAgICAgICAgICAgIGJpdGluZGV4OiBiaXRpbmRleCxcbiAgICAgICAgICAgICAgICAgICAgX3Jhbmtpbmc6IDAuOTVcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGlmIChvTWRsLmV4YWN0bWF0Y2ggJiYgb01kbC5leGFjdG1hdGNoLmluZGV4T2YoY2F0ZWdvcnkpID49IDApIHtcbiAgICAgICAgICAgICAgICAgICAgb1J1bGUuZXhhY3RPbmx5ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaW5zZXJ0UnVsZUlmTm90UHJlc2VudChvTW9kZWwubVJ1bGVzLCBvUnVsZSwgb01vZGVsLnNlZW5SdWxlcyk7XG4gICAgICAgICAgICAgICAgaWYgKG9NZGxEYXRhLnN5bm9ueW1zICYmIG9NZGxEYXRhLnN5bm9ueW1zW2NhdGVnb3J5XSkge1xuICAgICAgICAgICAgICAgICAgICBhZGRTeW5vbnltcyhvTWRsRGF0YS5zeW5vbnltc1tjYXRlZ29yeV0sIGNhdGVnb3J5LCBzU3RyaW5nLCBiaXRpbmRleCwgb01vZGVsLm1SdWxlcywgb01vZGVsLnNlZW5SdWxlcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChvRW50cnkuc3lub255bXMgJiYgb0VudHJ5LnN5bm9ueW1zW2NhdGVnb3J5XSkge1xuICAgICAgICAgICAgICAgICAgICBhZGRTeW5vbnltcyhvRW50cnkuc3lub255bXNbY2F0ZWdvcnldLCBjYXRlZ29yeSwgc1N0cmluZywgYml0aW5kZXgsIG9Nb2RlbC5tUnVsZXMsIG9Nb2RlbC5zZWVuUnVsZXMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSk7XG59XG5mdW5jdGlvbiBsb2FkTW9kZWwobW9kZWxQYXRoLCBzTW9kZWxOYW1lLCBvTW9kZWwpIHtcbiAgICBkZWJ1Z2xvZyhcIiBsb2FkaW5nIFwiICsgc01vZGVsTmFtZSArIFwiIC4uLi5cIik7XG4gICAgdmFyIG1kbCA9IGZzLnJlYWRGaWxlU3luYygnLi8nICsgbW9kZWxQYXRoICsgJy8nICsgc01vZGVsTmFtZSArIFwiLm1vZGVsLmpzb25cIiwgJ3V0Zi04Jyk7XG4gICAgdmFyIG9NZGwgPSBKU09OLnBhcnNlKG1kbCk7XG4gICAgbWVyZ2VNb2RlbEpzb24oc01vZGVsTmFtZSwgb01kbCwgb01vZGVsKTtcbiAgICBsb2FkTW9kZWxEYXRhKG1vZGVsUGF0aCwgb01kbCwgc01vZGVsTmFtZSwgb01vZGVsKTtcbn1cbmZ1bmN0aW9uIGdldERvbWFpbkJpdEluZGV4KGRvbWFpbiwgb01vZGVsKSB7XG4gICAgdmFyIGluZGV4ID0gb01vZGVsLmRvbWFpbnMuaW5kZXhPZihkb21haW4pO1xuICAgIGlmIChpbmRleCA8IDApIHtcbiAgICAgICAgaW5kZXggPSBvTW9kZWwuZG9tYWlucy5sZW5ndGg7XG4gICAgfVxuICAgIGlmIChpbmRleCA+PSAzMikge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJ0b28gbWFueSBkb21haW4gZm9yIHNpbmdsZSAzMiBiaXQgaW5kZXhcIik7XG4gICAgfVxuICAgIHJldHVybiAweDAwMDEgPDwgaW5kZXg7XG59XG5leHBvcnRzLmdldERvbWFpbkJpdEluZGV4ID0gZ2V0RG9tYWluQml0SW5kZXg7XG5mdW5jdGlvbiBtZXJnZU1vZGVsSnNvbihzTW9kZWxOYW1lLCBvTWRsLCBvTW9kZWwpIHtcbiAgICB2YXIgY2F0ZWdvcnlEZXNjcmliZWRNYXAgPSB7fTtcbiAgICBvTWRsLmJpdGluZGV4ID0gZ2V0RG9tYWluQml0SW5kZXgob01kbC5kb21haW4sIG9Nb2RlbCk7XG4gICAgb01kbC5jYXRlZ29yeURlc2NyaWJlZCA9IFtdO1xuICAgIC8vIHJlY3RpZnkgY2F0ZWdvcnlcbiAgICBvTWRsLmNhdGVnb3J5ID0gb01kbC5jYXRlZ29yeS5tYXAoZnVuY3Rpb24gKGNhdCkge1xuICAgICAgICBpZiAodHlwZW9mIGNhdCA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgcmV0dXJuIGNhdDtcbiAgICAgICAgfVxuICAgICAgICBpZiAodHlwZW9mIGNhdC5uYW1lICE9PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIk1pc3NpbmcgbmFtZSBpbiBvYmplY3QgdHlwZWQgY2F0ZWdvcnkgaW4gXCIgKyBKU09OLnN0cmluZ2lmeShjYXQpICsgXCIgaW4gbW9kZWwgXCIgKyBzTW9kZWxOYW1lKTtcbiAgICAgICAgICAgIHByb2Nlc3MuZXhpdCgtMSk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0ZWdvcnlEZXNjcmliZWRNYXBbY2F0Lm5hbWVdID0gY2F0O1xuICAgICAgICBvTWRsLmNhdGVnb3J5RGVzY3JpYmVkLnB1c2goY2F0KTtcbiAgICAgICAgcmV0dXJuIGNhdC5uYW1lO1xuICAgIH0pO1xuICAgIC8vIGFkZCB0aGUgY2F0ZWdvcmllcyB0byB0aGUgbW9kZWw6XG4gICAgb01kbC5jYXRlZ29yeS5mb3JFYWNoKGZ1bmN0aW9uIChjYXRlZ29yeSkge1xuICAgICAgICBpbnNlcnRSdWxlSWZOb3RQcmVzZW50KG9Nb2RlbC5tUnVsZXMsIHtcbiAgICAgICAgICAgIGNhdGVnb3J5OiBcImNhdGVnb3J5XCIsXG4gICAgICAgICAgICBtYXRjaGVkU3RyaW5nOiBjYXRlZ29yeSxcbiAgICAgICAgICAgIHR5cGU6IDAgLyogV09SRCAqLyxcbiAgICAgICAgICAgIHdvcmQ6IGNhdGVnb3J5LFxuICAgICAgICAgICAgbG93ZXJjYXNld29yZDogY2F0ZWdvcnkudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgIGJpdGluZGV4OiBvTWRsLmJpdGluZGV4LFxuICAgICAgICAgICAgX3Jhbmtpbmc6IDAuOTVcbiAgICAgICAgfSwgb01vZGVsLnNlZW5SdWxlcyk7XG4gICAgfSk7XG4gICAgaWYgKG9Nb2RlbC5kb21haW5zLmluZGV4T2Yob01kbC5kb21haW4pID49IDApIHtcbiAgICAgICAgZGVidWdsb2coXCIqKioqKioqKioqKmhlcmUgbWRsXCIgKyBKU09OLnN0cmluZ2lmeShvTWRsLCB1bmRlZmluZWQsIDIpKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdEb21haW4gJyArIG9NZGwuZG9tYWluICsgJyBhbHJlYWR5IGxvYWRlZCB3aGlsZSBsb2FkaW5nICcgKyBzTW9kZWxOYW1lICsgJz8nKTtcbiAgICB9XG4gICAgLy8gY2hlY2sgcHJvcGVydGllcyBvZiBtb2RlbFxuICAgIE9iamVjdC5rZXlzKG9NZGwpLnNvcnQoKS5mb3JFYWNoKGZ1bmN0aW9uIChzUHJvcGVydHkpIHtcbiAgICAgICAgaWYgKEFSUl9NT0RFTF9QUk9QRVJUSUVTLmluZGV4T2Yoc1Byb3BlcnR5KSA8IDApIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTW9kZWwgcHJvcGVydHkgXCInICsgc1Byb3BlcnR5ICsgJ1wiIG5vdCBhIGtub3duIG1vZGVsIHByb3BlcnR5IGluIG1vZGVsIG9mIGRvbWFpbiAnICsgb01kbC5kb21haW4gKyAnICcpO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgLy8gY29uc2lkZXIgc3RyZWFtbGluaW5nIHRoZSBjYXRlZ29yaWVzXG4gICAgb01vZGVsLnJhd01vZGVsc1tvTWRsLmRvbWFpbl0gPSBvTWRsO1xuICAgIG9Nb2RlbC5mdWxsLmRvbWFpbltvTWRsLmRvbWFpbl0gPSB7XG4gICAgICAgIGRlc2NyaXB0aW9uOiBvTWRsLmRlc2NyaXB0aW9uLFxuICAgICAgICBjYXRlZ29yaWVzOiBjYXRlZ29yeURlc2NyaWJlZE1hcCxcbiAgICAgICAgYml0aW5kZXg6IG9NZGwuYml0aW5kZXhcbiAgICB9O1xuICAgIC8vIGNoZWNrIHRoYXRcbiAgICAvLyBjaGVjayB0aGF0IG1lbWJlcnMgb2Ygd29yZGluZGV4IGFyZSBpbiBjYXRlZ29yaWVzLFxuICAgIG9NZGwud29yZGluZGV4ID0gb01kbC53b3JkaW5kZXggfHwgW107XG4gICAgb01kbC53b3JkaW5kZXguZm9yRWFjaChmdW5jdGlvbiAoc1dvcmRJbmRleCkge1xuICAgICAgICBpZiAob01kbC5jYXRlZ29yeS5pbmRleE9mKHNXb3JkSW5kZXgpIDwgMCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdNb2RlbCB3b3JkaW5kZXggXCInICsgc1dvcmRJbmRleCArICdcIiBub3QgYSBjYXRlZ29yeSBvZiBkb21haW4gJyArIG9NZGwuZG9tYWluICsgJyAnKTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIG9NZGwuZXhhY3RtYXRjaCA9IG9NZGwuZXhhY3RtYXRjaCB8fCBbXTtcbiAgICBvTWRsLmV4YWN0bWF0Y2guZm9yRWFjaChmdW5jdGlvbiAoc0V4YWN0TWF0Y2gpIHtcbiAgICAgICAgaWYgKG9NZGwuY2F0ZWdvcnkuaW5kZXhPZihzRXhhY3RNYXRjaCkgPCAwKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ01vZGVsIGV4YWN0bWF0Y2ggXCInICsgc0V4YWN0TWF0Y2ggKyAnXCIgbm90IGEgY2F0ZWdvcnkgb2YgZG9tYWluICcgKyBvTWRsLmRvbWFpbiArICcgJyk7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICBvTWRsLmNvbHVtbnMgPSBvTWRsLmNvbHVtbnMgfHwgW107XG4gICAgb01kbC5jb2x1bW5zLmZvckVhY2goZnVuY3Rpb24gKHNFeGFjdE1hdGNoKSB7XG4gICAgICAgIGlmIChvTWRsLmNhdGVnb3J5LmluZGV4T2Yoc0V4YWN0TWF0Y2gpIDwgMCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdNb2RlbCBjb2x1bW4gXCInICsgc0V4YWN0TWF0Y2ggKyAnXCIgbm90IGEgY2F0ZWdvcnkgb2YgZG9tYWluICcgKyBvTWRsLmRvbWFpbiArICcgJyk7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICAvLyBhZGQgcmVsYXRpb24gZG9tYWluIC0+IGNhdGVnb3J5XG4gICAgdmFyIGRvbWFpblN0ciA9IE1ldGFGLkRvbWFpbihvTWRsLmRvbWFpbikudG9GdWxsU3RyaW5nKCk7XG4gICAgdmFyIHJlbGF0aW9uU3RyID0gTWV0YUYuUmVsYXRpb24oTWV0YS5SRUxBVElPTl9oYXNDYXRlZ29yeSkudG9GdWxsU3RyaW5nKCk7XG4gICAgdmFyIHJldmVyc2VSZWxhdGlvblN0ciA9IE1ldGFGLlJlbGF0aW9uKE1ldGEuUkVMQVRJT05faXNDYXRlZ29yeU9mKS50b0Z1bGxTdHJpbmcoKTtcbiAgICBvTWRsLmNhdGVnb3J5LmZvckVhY2goZnVuY3Rpb24gKHNDYXRlZ29yeSkge1xuICAgICAgICB2YXIgQ2F0ZWdvcnlTdHJpbmcgPSBNZXRhRi5DYXRlZ29yeShzQ2F0ZWdvcnkpLnRvRnVsbFN0cmluZygpO1xuICAgICAgICBvTW9kZWwubWV0YS50M1tkb21haW5TdHJdID0gb01vZGVsLm1ldGEudDNbZG9tYWluU3RyXSB8fCB7fTtcbiAgICAgICAgb01vZGVsLm1ldGEudDNbZG9tYWluU3RyXVtyZWxhdGlvblN0cl0gPSBvTW9kZWwubWV0YS50M1tkb21haW5TdHJdW3JlbGF0aW9uU3RyXSB8fCB7fTtcbiAgICAgICAgb01vZGVsLm1ldGEudDNbZG9tYWluU3RyXVtyZWxhdGlvblN0cl1bQ2F0ZWdvcnlTdHJpbmddID0ge307XG4gICAgICAgIG9Nb2RlbC5tZXRhLnQzW0NhdGVnb3J5U3RyaW5nXSA9IG9Nb2RlbC5tZXRhLnQzW0NhdGVnb3J5U3RyaW5nXSB8fCB7fTtcbiAgICAgICAgb01vZGVsLm1ldGEudDNbQ2F0ZWdvcnlTdHJpbmddW3JldmVyc2VSZWxhdGlvblN0cl0gPSBvTW9kZWwubWV0YS50M1tDYXRlZ29yeVN0cmluZ11bcmV2ZXJzZVJlbGF0aW9uU3RyXSB8fCB7fTtcbiAgICAgICAgb01vZGVsLm1ldGEudDNbQ2F0ZWdvcnlTdHJpbmddW3JldmVyc2VSZWxhdGlvblN0cl1bZG9tYWluU3RyXSA9IHt9O1xuICAgIH0pO1xuICAgIC8vIGFkZCBhIHByZWNpY2UgZG9tYWluIG1hdGNocnVsZVxuICAgIGluc2VydFJ1bGVJZk5vdFByZXNlbnQob01vZGVsLm1SdWxlcywge1xuICAgICAgICBjYXRlZ29yeTogXCJkb21haW5cIixcbiAgICAgICAgbWF0Y2hlZFN0cmluZzogb01kbC5kb21haW4sXG4gICAgICAgIHR5cGU6IDAgLyogV09SRCAqLyxcbiAgICAgICAgd29yZDogb01kbC5kb21haW4sXG4gICAgICAgIGJpdGluZGV4OiBvTWRsLmJpdGluZGV4LFxuICAgICAgICBfcmFua2luZzogMC45NVxuICAgIH0sIG9Nb2RlbC5zZWVuUnVsZXMpO1xuICAgIC8vIGNoZWNrIHRoZSB0b29sXG4gICAgaWYgKG9NZGwudG9vbCAmJiBvTWRsLnRvb2wucmVxdWlyZXMpIHtcbiAgICAgICAgdmFyIHJlcXVpcmVzID0gT2JqZWN0LmtleXMob01kbC50b29sLnJlcXVpcmVzIHx8IHt9KTtcbiAgICAgICAgdmFyIGRpZmYgPSBfLmRpZmZlcmVuY2UocmVxdWlyZXMsIG9NZGwuY2F0ZWdvcnkpO1xuICAgICAgICBpZiAoZGlmZi5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIiBcIiArIG9NZGwuZG9tYWluICsgXCIgOiBVbmtvd24gY2F0ZWdvcnkgaW4gcmVxdWlyZXMgb2YgdG9vbDogXFxcIlwiICsgZGlmZi5qb2luKCdcIicpICsgJ1wiJyk7XG4gICAgICAgICAgICBwcm9jZXNzLmV4aXQoLTEpO1xuICAgICAgICB9XG4gICAgICAgIHZhciBvcHRpb25hbCA9IE9iamVjdC5rZXlzKG9NZGwudG9vbC5vcHRpb25hbCk7XG4gICAgICAgIGRpZmYgPSBfLmRpZmZlcmVuY2Uob3B0aW9uYWwsIG9NZGwuY2F0ZWdvcnkpO1xuICAgICAgICBpZiAoZGlmZi5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIiBcIiArIG9NZGwuZG9tYWluICsgXCIgOiBVbmtvd24gY2F0ZWdvcnkgb3B0aW9uYWwgb2YgdG9vbDogXFxcIlwiICsgZGlmZi5qb2luKCdcIicpICsgJ1wiJyk7XG4gICAgICAgICAgICBwcm9jZXNzLmV4aXQoLTEpO1xuICAgICAgICB9XG4gICAgICAgIE9iamVjdC5rZXlzKG9NZGwudG9vbC5zZXRzIHx8IHt9KS5mb3JFYWNoKGZ1bmN0aW9uIChzZXRJRCkge1xuICAgICAgICAgICAgdmFyIGRpZmYgPSBfLmRpZmZlcmVuY2Uob01kbC50b29sLnNldHNbc2V0SURdLnNldCwgb01kbC5jYXRlZ29yeSk7XG4gICAgICAgICAgICBpZiAoZGlmZi5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCIgXCIgKyBvTWRsLmRvbWFpbiArIFwiIDogVW5rb3duIGNhdGVnb3J5IGluIHNldElkIFwiICsgc2V0SUQgKyBcIiBvZiB0b29sOiBcXFwiXCIgKyBkaWZmLmpvaW4oJ1wiJykgKyAnXCInKTtcbiAgICAgICAgICAgICAgICBwcm9jZXNzLmV4aXQoLTEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgLy8gZXh0cmFjdCB0b29scyBhbiBhZGQgdG8gdG9vbHM6XG4gICAgICAgIG9Nb2RlbC50b29scy5maWx0ZXIoZnVuY3Rpb24gKG9FbnRyeSkge1xuICAgICAgICAgICAgaWYgKG9FbnRyeS5uYW1lID09PSAob01kbC50b29sICYmIG9NZGwudG9vbC5uYW1lKSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiVG9vbCBcIiArIG9NZGwudG9vbC5uYW1lICsgXCIgYWxyZWFkeSBwcmVzZW50IHdoZW4gbG9hZGluZyBcIiArIHNNb2RlbE5hbWUpO1xuICAgICAgICAgICAgICAgIC8vdGhyb3cgbmV3IEVycm9yKCdEb21haW4gYWxyZWFkeSBsb2FkZWQ/Jyk7XG4gICAgICAgICAgICAgICAgcHJvY2Vzcy5leGl0KC0xKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBvTWRsLnRvb2xoaWRkZW4gPSB0cnVlO1xuICAgICAgICBvTWRsLnRvb2wucmVxdWlyZXMgPSB7IFwiaW1wb3NzaWJsZVwiOiB7fSB9O1xuICAgIH1cbiAgICAvLyBhZGQgdGhlIHRvb2wgbmFtZSBhcyBydWxlIHVubGVzcyBoaWRkZW5cbiAgICBpZiAoIW9NZGwudG9vbGhpZGRlbiAmJiBvTWRsLnRvb2wgJiYgb01kbC50b29sLm5hbWUpIHtcbiAgICAgICAgaW5zZXJ0UnVsZUlmTm90UHJlc2VudChvTW9kZWwubVJ1bGVzLCB7XG4gICAgICAgICAgICBjYXRlZ29yeTogXCJ0b29sXCIsXG4gICAgICAgICAgICBtYXRjaGVkU3RyaW5nOiBvTWRsLnRvb2wubmFtZSxcbiAgICAgICAgICAgIHR5cGU6IDAgLyogV09SRCAqLyxcbiAgICAgICAgICAgIHdvcmQ6IG9NZGwudG9vbC5uYW1lLFxuICAgICAgICAgICAgYml0aW5kZXg6IG9NZGwuYml0aW5kZXgsXG4gICAgICAgICAgICBfcmFua2luZzogMC45NVxuICAgICAgICB9LCBvTW9kZWwuc2VlblJ1bGVzKTtcbiAgICB9XG4gICAgO1xuICAgIGlmIChvTWRsLnN5bm9ueW1zICYmIG9NZGwuc3lub255bXNbXCJ0b29sXCJdKSB7XG4gICAgICAgIGFkZFN5bm9ueW1zKG9NZGwuc3lub255bXNbXCJ0b29sXCJdLCBcInRvb2xcIiwgb01kbC50b29sLm5hbWUsIG9NZGwuYml0aW5kZXgsIG9Nb2RlbC5tUnVsZXMsIG9Nb2RlbC5zZWVuUnVsZXMpO1xuICAgIH1cbiAgICA7XG4gICAgaWYgKG9NZGwuc3lub255bXMpIHtcbiAgICAgICAgT2JqZWN0LmtleXMob01kbC5zeW5vbnltcykuZm9yRWFjaChmdW5jdGlvbiAoc3N5bmtleSkge1xuICAgICAgICAgICAgaWYgKG9NZGwuY2F0ZWdvcnkuaW5kZXhPZihzc3lua2V5KSA+PSAwICYmIHNzeW5rZXkgIT09IFwidG9vbFwiKSB7XG4gICAgICAgICAgICAgICAgaWYgKG9Nb2RlbC5mdWxsLmRvbWFpbltvTWRsLmRvbWFpbl0uY2F0ZWdvcmllc1tzc3lua2V5XSkge1xuICAgICAgICAgICAgICAgICAgICBvTW9kZWwuZnVsbC5kb21haW5bb01kbC5kb21haW5dLmNhdGVnb3JpZXNbc3N5bmtleV0uc3lub255bXMgPSBvTWRsLnN5bm9ueW1zW3NzeW5rZXldO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBhZGRTeW5vbnltcyhvTWRsLnN5bm9ueW1zW3NzeW5rZXldLCBcImNhdGVnb3J5XCIsIHNzeW5rZXksIG9NZGwuYml0aW5kZXgsIG9Nb2RlbC5tUnVsZXMsIG9Nb2RlbC5zZWVuUnVsZXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgb01vZGVsLmRvbWFpbnMucHVzaChvTWRsLmRvbWFpbik7XG4gICAgaWYgKG9NZGwudG9vbC5uYW1lKSB7XG4gICAgICAgIG9Nb2RlbC50b29scy5wdXNoKG9NZGwudG9vbCk7XG4gICAgfVxuICAgIG9Nb2RlbC5jYXRlZ29yeSA9IG9Nb2RlbC5jYXRlZ29yeS5jb25jYXQob01kbC5jYXRlZ29yeSk7XG4gICAgb01vZGVsLmNhdGVnb3J5LnNvcnQoKTtcbiAgICBvTW9kZWwuY2F0ZWdvcnkgPSBvTW9kZWwuY2F0ZWdvcnkuZmlsdGVyKGZ1bmN0aW9uIChzdHJpbmcsIGluZGV4KSB7XG4gICAgICAgIHJldHVybiBvTW9kZWwuY2F0ZWdvcnlbaW5kZXhdICE9PSBvTW9kZWwuY2F0ZWdvcnlbaW5kZXggKyAxXTtcbiAgICB9KTtcbn0gLy8gbG9hZG1vZGVsXG5mdW5jdGlvbiBzcGxpdFJ1bGVzKHJ1bGVzKSB7XG4gICAgdmFyIHJlcyA9IHt9O1xuICAgIHZhciBub25Xb3JkUnVsZXMgPSBbXTtcbiAgICBydWxlcy5mb3JFYWNoKGZ1bmN0aW9uIChydWxlKSB7XG4gICAgICAgIGlmIChydWxlLnR5cGUgPT09IDAgLyogV09SRCAqLykge1xuICAgICAgICAgICAgaWYgKCFydWxlLmxvd2VyY2FzZXdvcmQpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJSdWxlIGhhcyBubyBtZW1iZXIgbG93ZXJjYXNld29yZFwiICsgSlNPTi5zdHJpbmdpZnkocnVsZSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmVzW3J1bGUubG93ZXJjYXNld29yZF0gPSByZXNbcnVsZS5sb3dlcmNhc2V3b3JkXSB8fCB7IGJpdGluZGV4OiAwLCBydWxlczogW10gfTtcbiAgICAgICAgICAgIHJlc1tydWxlLmxvd2VyY2FzZXdvcmRdLmJpdGluZGV4ID0gcmVzW3J1bGUubG93ZXJjYXNld29yZF0uYml0aW5kZXggfCBydWxlLmJpdGluZGV4O1xuICAgICAgICAgICAgcmVzW3J1bGUubG93ZXJjYXNld29yZF0ucnVsZXMucHVzaChydWxlKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIG5vbldvcmRSdWxlcy5wdXNoKHJ1bGUpO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgd29yZE1hcDogcmVzLFxuICAgICAgICBub25Xb3JkUnVsZXM6IG5vbldvcmRSdWxlcyxcbiAgICAgICAgYWxsUnVsZXM6IHJ1bGVzXG4gICAgfTtcbn1cbmV4cG9ydHMuc3BsaXRSdWxlcyA9IHNwbGl0UnVsZXM7XG5mdW5jdGlvbiBjbXBMZW5ndGhTb3J0KGEsIGIpIHtcbiAgICB2YXIgZCA9IGEubGVuZ3RoIC0gYi5sZW5ndGg7XG4gICAgaWYgKGQpIHtcbiAgICAgICAgcmV0dXJuIGQ7XG4gICAgfVxuICAgIHJldHVybiBhLmxvY2FsZUNvbXBhcmUoYik7XG59XG52YXIgRGlzdGFuY2UgPSByZXF1aXJlKFwiLi4vdXRpbHMvZGFtZXJhdUxldmVuc2h0ZWluXCIpO1xudmFyIEFsZ29sID0gcmVxdWlyZShcIi4uL21hdGNoL2FsZ29sXCIpO1xuLy8gb2Zmc2V0WzBdIDogbGVuLTJcbi8vICAgICAgICAgICAgIGxlbiAtMVxuLy8gICAgICAgICAgICAgbGVuXG4vLyAgICAgICAgICAgICBsZW4gKzFcbi8vICAgICAgICAgICAgIGxlbiArMlxuLy8gICAgICAgICAgICAgbGVuICszXG5mdW5jdGlvbiBmaW5kTmV4dExlbih0YXJnZXRMZW4sIGFyciwgb2Zmc2V0cykge1xuICAgIG9mZnNldHMuc2hpZnQoKTtcbiAgICBmb3IgKHZhciBpID0gb2Zmc2V0c1s0XTsgKGkgPCBhcnIubGVuZ3RoKSAmJiAoYXJyW2ldLmxlbmd0aCA8PSB0YXJnZXRMZW4pOyArK2kpIHtcbiAgICB9XG4gICAgLy9jb25zb2xlLmxvZyhcInB1c2hpbmcgXCIgKyBpKTtcbiAgICBvZmZzZXRzLnB1c2goaSk7XG59XG5leHBvcnRzLmZpbmROZXh0TGVuID0gZmluZE5leHRMZW47XG5mdW5jdGlvbiBhZGRSYW5nZVJ1bGVzVW5sZXNzUHJlc2VudChydWxlcywgbGN3b3JkLCByYW5nZVJ1bGVzLCBwcmVzZW50UnVsZXNGb3JLZXksIHNlZW5SdWxlcykge1xuICAgIHJhbmdlUnVsZXMuZm9yRWFjaChmdW5jdGlvbiAocmFuZ2VSdWxlKSB7XG4gICAgICAgIHZhciBuZXdSdWxlID0gT2JqZWN0LmFzc2lnbih7fSwgcmFuZ2VSdWxlKTtcbiAgICAgICAgbmV3UnVsZS5sb3dlcmNhc2V3b3JkID0gbGN3b3JkO1xuICAgICAgICBuZXdSdWxlLndvcmQgPSBsY3dvcmQ7XG4gICAgICAgIC8vaWYoKGxjd29yZCA9PT0gJ3NlcnZpY2VzJyB8fCBsY3dvcmQgPT09ICdzZXJ2aWNlJykgJiYgbmV3UnVsZS5yYW5nZS5ydWxlLmxvd2VyY2FzZXdvcmQuaW5kZXhPZignb2RhdGEnKT49MCkge1xuICAgICAgICAvLyAgICBjb25zb2xlLmxvZyhcImFkZGluZyBcIisgSlNPTi5zdHJpbmdpZnkobmV3UnVsZSkgKyBcIlxcblwiKTtcbiAgICAgICAgLy99XG4gICAgICAgIC8vdG9kbzogY2hlY2sgd2hldGhlciBhbiBlcXVpdmFsZW50IHJ1bGUgaXMgYWxyZWFkeSBwcmVzZW50P1xuICAgICAgICB2YXIgY250ID0gcnVsZXMubGVuZ3RoO1xuICAgICAgICBpbnNlcnRSdWxlSWZOb3RQcmVzZW50KHJ1bGVzLCBuZXdSdWxlLCBzZWVuUnVsZXMpO1xuICAgIH0pO1xufVxuZXhwb3J0cy5hZGRSYW5nZVJ1bGVzVW5sZXNzUHJlc2VudCA9IGFkZFJhbmdlUnVsZXNVbmxlc3NQcmVzZW50O1xuZnVuY3Rpb24gYWRkQ2xvc2VFeGFjdFJhbmdlUnVsZXMocnVsZXMsIHNlZW5SdWxlcykge1xuICAgIHZhciBrZXlzTWFwID0ge307XG4gICAgdmFyIHJhbmdlS2V5c01hcCA9IHt9O1xuICAgIHJ1bGVzLmZvckVhY2goZnVuY3Rpb24gKHJ1bGUpIHtcbiAgICAgICAgaWYgKHJ1bGUudHlwZSA9PT0gMCAvKiBXT1JEICovKSB7XG4gICAgICAgICAgICAvL2tleXNNYXBbcnVsZS5sb3dlcmNhc2V3b3JkXSA9IDE7XG4gICAgICAgICAgICBrZXlzTWFwW3J1bGUubG93ZXJjYXNld29yZF0gPSBrZXlzTWFwW3J1bGUubG93ZXJjYXNld29yZF0gfHwgW107XG4gICAgICAgICAgICBrZXlzTWFwW3J1bGUubG93ZXJjYXNld29yZF0ucHVzaChydWxlKTtcbiAgICAgICAgICAgIGlmICghcnVsZS5leGFjdE9ubHkgJiYgcnVsZS5yYW5nZSkge1xuICAgICAgICAgICAgICAgIHJhbmdlS2V5c01hcFtydWxlLmxvd2VyY2FzZXdvcmRdID0gcmFuZ2VLZXlzTWFwW3J1bGUubG93ZXJjYXNld29yZF0gfHwgW107XG4gICAgICAgICAgICAgICAgcmFuZ2VLZXlzTWFwW3J1bGUubG93ZXJjYXNld29yZF0ucHVzaChydWxlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xuICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXMoa2V5c01hcCk7XG4gICAga2V5cy5zb3J0KGNtcExlbmd0aFNvcnQpO1xuICAgIHZhciBsZW4gPSAwO1xuICAgIGtleXMuZm9yRWFjaChmdW5jdGlvbiAoa2V5LCBpbmRleCkge1xuICAgICAgICBpZiAoa2V5Lmxlbmd0aCAhPSBsZW4pIHtcbiAgICAgICAgfVxuICAgICAgICBsZW4gPSBrZXkubGVuZ3RoO1xuICAgIH0pO1xuICAgIC8vICAga2V5cyA9IGtleXMuc2xpY2UoMCwyMDAwKTtcbiAgICB2YXIgcmFuZ2VLZXlzID0gT2JqZWN0LmtleXMocmFuZ2VLZXlzTWFwKTtcbiAgICByYW5nZUtleXMuc29ydChjbXBMZW5ndGhTb3J0KTtcbiAgICAvL2NvbnNvbGUubG9nKGAgJHtrZXlzLmxlbmd0aH0ga2V5cyBhbmQgJHtyYW5nZUtleXMubGVuZ3RofSByYW5nZWtleXMgYCk7XG4gICAgdmFyIGxvdyA9IDA7XG4gICAgdmFyIGhpZ2ggPSAwO1xuICAgIHZhciBsYXN0bGVuID0gMDtcbiAgICB2YXIgb2Zmc2V0cyA9IFswLCAwLCAwLCAwLCAwLCAwXTtcbiAgICB2YXIgbGVuID0gcmFuZ2VLZXlzLmxlbmd0aDtcbiAgICBmaW5kTmV4dExlbigwLCBrZXlzLCBvZmZzZXRzKTtcbiAgICBmaW5kTmV4dExlbigxLCBrZXlzLCBvZmZzZXRzKTtcbiAgICBmaW5kTmV4dExlbigyLCBrZXlzLCBvZmZzZXRzKTtcbiAgICByYW5nZUtleXMuZm9yRWFjaChmdW5jdGlvbiAocmFuZ2VLZXkpIHtcbiAgICAgICAgaWYgKHJhbmdlS2V5Lmxlbmd0aCAhPT0gbGFzdGxlbikge1xuICAgICAgICAgICAgZm9yIChpID0gbGFzdGxlbiArIDE7IGkgPD0gcmFuZ2VLZXkubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICBmaW5kTmV4dExlbihpICsgMiwga2V5cywgb2Zmc2V0cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyAgIGNvbnNvbGUubG9nKGAgc2hpZnRlZCB0byAke3JhbmdlS2V5Lmxlbmd0aH0gd2l0aCBvZmZzZXRzIGJlZWluZyAke29mZnNldHMuam9pbignICcpfWApO1xuICAgICAgICAgICAgLy8gICBjb25zb2xlLmxvZyhgIGhlcmUgMCAke29mZnNldHNbMF19IDogJHtrZXlzW01hdGgubWluKGtleXMubGVuZ3RoLTEsIG9mZnNldHNbMF0pXS5sZW5ndGh9ICAke2tleXNbTWF0aC5taW4oa2V5cy5sZW5ndGgtMSwgb2Zmc2V0c1swXSldfSBgKTtcbiAgICAgICAgICAgIC8vICBjb25zb2xlLmxvZyhgIGhlcmUgNS0xICAke2tleXNbb2Zmc2V0c1s1XS0xXS5sZW5ndGh9ICAke2tleXNbb2Zmc2V0c1s1XS0xXX0gYCk7XG4gICAgICAgICAgICAvLyAgIGNvbnNvbGUubG9nKGAgaGVyZSA1ICR7b2Zmc2V0c1s1XX0gOiAke2tleXNbTWF0aC5taW4oa2V5cy5sZW5ndGgtMSwgb2Zmc2V0c1s1XSldLmxlbmd0aH0gICR7a2V5c1tNYXRoLm1pbihrZXlzLmxlbmd0aC0xLCBvZmZzZXRzWzVdKV19IGApO1xuICAgICAgICAgICAgbGFzdGxlbiA9IHJhbmdlS2V5Lmxlbmd0aDtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKHZhciBpID0gb2Zmc2V0c1swXTsgaSA8IG9mZnNldHNbNV07ICsraSkge1xuICAgICAgICAgICAgdmFyIGQgPSBEaXN0YW5jZS5jYWxjRGlzdGFuY2VBZGp1c3RlZChyYW5nZUtleSwga2V5c1tpXSk7XG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhgJHtyYW5nZUtleS5sZW5ndGgta2V5c1tpXS5sZW5ndGh9ICR7ZH0gJHtyYW5nZUtleX0gYW5kICR7a2V5c1tpXX0gIGApO1xuICAgICAgICAgICAgaWYgKChkICE9PSAxLjApICYmIChkID49IEFsZ29sLkN1dG9mZl9yYW5nZUNsb3NlTWF0Y2gpKSB7XG4gICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhgd291bGQgYWRkICR7cmFuZ2VLZXl9IGZvciAke2tleXNbaV19ICR7ZH1gKTtcbiAgICAgICAgICAgICAgICB2YXIgY250ID0gcnVsZXMubGVuZ3RoO1xuICAgICAgICAgICAgICAgIC8vIHdlIG9ubHkgaGF2ZSB0byBhZGQgaWYgdGhlcmUgaXMgbm90IHlldCBhIG1hdGNoIHJ1bGUgaGVyZSB3aGljaCBwb2ludHMgdG8gdGhlIHNhbWVcbiAgICAgICAgICAgICAgICBhZGRSYW5nZVJ1bGVzVW5sZXNzUHJlc2VudChydWxlcywga2V5c1tpXSwgcmFuZ2VLZXlzTWFwW3JhbmdlS2V5XSwga2V5c01hcFtrZXlzW2ldXSwgc2VlblJ1bGVzKTtcbiAgICAgICAgICAgICAgICBpZiAocnVsZXMubGVuZ3RoID4gY250KSB7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG4gICAgLypcbiAgICBbXG4gICAgICAgIFsnYUVGRycsJ2FFRkdIJ10sXG4gICAgICAgIFsnYUVGR0gnLCdhRUZHSEknXSxcbiAgICAgICAgWydPZGF0YScsJ09EYXRhcyddLFxuICAgWydPZGF0YScsJ09kYXRhcyddLFxuICAgWydPZGF0YScsJ09kYXRiJ10sXG4gICBbJ09kYXRhJywnVURhdGEnXSxcbiAgIFsnc2VydmljZScsJ3NlcnZpY2VzJ10sXG4gICBbJ3RoaXMgaXNmdW5ueSBhbmQgbW9yZScsJ3RoaXMgaXNmdW5ueSBhbmQgbW9yZXMnXSxcbiAgICBdLmZvckVhY2gocmVjID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coYGRpc3RhbmNlICR7cmVjWzBdfSAke3JlY1sxXX0gOiAke0Rpc3RhbmNlLmNhbGNEaXN0YW5jZShyZWNbMF0scmVjWzFdKX0gIGFkZiAke0Rpc3RhbmNlLmNhbGNEaXN0YW5jZUFkanVzdGVkKHJlY1swXSxyZWNbMV0pfSBgKTtcblxuICAgIH0pO1xuICAgIGNvbnNvbGUubG9nKFwiZGlzdGFuY2UgT2RhdGEgVWRhdGFcIisgRGlzdGFuY2UuY2FsY0Rpc3RhbmNlKCdPRGF0YScsJ1VEYXRhJykpO1xuICAgIGNvbnNvbGUubG9nKFwiZGlzdGFuY2UgT2RhdGEgT2RhdGJcIisgRGlzdGFuY2UuY2FsY0Rpc3RhbmNlKCdPRGF0YScsJ09EYXRiJykpO1xuICAgIGNvbnNvbGUubG9nKFwiZGlzdGFuY2UgT2RhdGFzIE9kYXRhXCIrIERpc3RhbmNlLmNhbGNEaXN0YW5jZSgnT0RhdGEnLCdPRGF0YWEnKSk7XG4gICAgY29uc29sZS5sb2coXCJkaXN0YW5jZSBPZGF0YXMgYWJjZGVcIisgRGlzdGFuY2UuY2FsY0Rpc3RhbmNlKCdhYmNkZScsJ2FiY2RlZicpKTtcbiAgICBjb25zb2xlLmxvZyhcImRpc3RhbmNlIHNlcnZpY2VzIFwiKyBEaXN0YW5jZS5jYWxjRGlzdGFuY2UoJ3NlcnZpY2VzJywnc2VydmljZScpKTtcbiAgICAqL1xufVxuZXhwb3J0cy5hZGRDbG9zZUV4YWN0UmFuZ2VSdWxlcyA9IGFkZENsb3NlRXhhY3RSYW5nZVJ1bGVzO1xudmFyIG4gPSAwO1xuZnVuY3Rpb24gbG9hZE1vZGVscyhtb2RlbFBhdGgsIGFkZFNwbGl0cykge1xuICAgIHZhciBvTW9kZWw7XG4gICAgb01vZGVsID0ge1xuICAgICAgICBmdWxsOiB7IGRvbWFpbjoge30gfSxcbiAgICAgICAgcmF3TW9kZWxzOiB7fSxcbiAgICAgICAgZG9tYWluczogW10sXG4gICAgICAgIHRvb2xzOiBbXSxcbiAgICAgICAgcnVsZXM6IHVuZGVmaW5lZCxcbiAgICAgICAgY2F0ZWdvcnk6IFtdLFxuICAgICAgICBvcGVyYXRvcnM6IHt9LFxuICAgICAgICBtUnVsZXM6IFtdLFxuICAgICAgICBzZWVuUnVsZXM6IHt9LFxuICAgICAgICByZWNvcmRzOiBbXSxcbiAgICAgICAgbWV0YTogeyB0Mzoge30gfVxuICAgIH07XG4gICAgZXhwb3J0cy5nbG9iYWxfQWRkU3BsaXRzID0gdHJ1ZTsgLy8gYWRkU3BsaXRzIHx8ICFwcm9jZXNzLmVudi5BQk9UX09MRE1BVENIO1xuICAgIG1vZGVsUGF0aCA9IG1vZGVsUGF0aCB8fCBlbnZNb2RlbFBhdGg7XG4gICAgdHJ5IHtcbiAgICAgICAgdmFyIGEgPSBDaXJjdWxhclNlci5sb2FkKCcuLycgKyBtb2RlbFBhdGggKyAnL19jYWNoZScgKyAhIWFkZFNwbGl0cyArICcuanMnKTtcbiAgICAgICAgLy9jb25zb2xlLmxvZyhcImZvdW5kIGEgY2FjaGUgPyAgXCIgKyAhIWEpO1xuICAgICAgICAvL2EgPSB1bmRlZmluZWQ7XG4gICAgICAgIGlmIChhKSB7XG4gICAgICAgICAgICBkZWJ1Z2xvZyhcIiByZXR1cm4gcHJlcGFyZXNlIG1vZGVsIFwiKTtcbiAgICAgICAgICAgIHJldHVybiBhO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgfVxuICAgIHZhciBzbWRscyA9IGZzLnJlYWRGaWxlU3luYygnLi8nICsgbW9kZWxQYXRoICsgJy9tb2RlbHMuanNvbicsICd1dGYtOCcpO1xuICAgIHZhciBtZGxzID0gSlNPTi5wYXJzZShcIlwiICsgc21kbHMpO1xuICAgIG1kbHMuZm9yRWFjaChmdW5jdGlvbiAoc01vZGVsTmFtZSkge1xuICAgICAgICBsb2FkTW9kZWwobW9kZWxQYXRoLCBzTW9kZWxOYW1lLCBvTW9kZWwpO1xuICAgIH0pO1xuICAgIC8vIGFkZCB0aGUgY2F0ZWdvcmllcyB0byB0aGUgbW9kZWw6XG4gICAgLypcbiAgICBvTW9kZWwuY2F0ZWdvcnkuZm9yRWFjaChmdW5jdGlvbiAoY2F0ZWdvcnkpIHtcbiAgICAgICAgaW5zZXJ0UnVsZUlmTm90UHJlc2VudChvTW9kZWwubVJ1bGVzLCB7XG4gICAgICAgICAgICBjYXRlZ29yeTogXCJjYXRlZ29yeVwiLFxuICAgICAgICAgICAgbWF0Y2hlZFN0cmluZzogY2F0ZWdvcnksXG4gICAgICAgICAgICB0eXBlOiBJTWF0Y2guRW51bVJ1bGVUeXBlLldPUkQsXG4gICAgICAgICAgICB3b3JkOiBjYXRlZ29yeSxcbiAgICAgICAgICAgIGxvd2VyY2FzZXdvcmQ6IGNhdGVnb3J5LnRvTG93ZXJDYXNlKCksXG4gICAgICAgICAgICBiaXRpbmRleCA6IG9NZGwuXG4gICAgICAgICAgICBfcmFua2luZzogMC45NVxuICAgICAgICB9LCBvTW9kZWwuc2VlblJ1bGVzKTtcbiAgICB9KTtcbiAgICAqL1xuICAgIHZhciBtZXRhQml0SW5kZXggPSBnZXREb21haW5CaXRJbmRleCgnbWV0YScsIG9Nb2RlbCk7XG4gICAgLy8gYWRkIHRoZSBkb21haW4gbWV0YSBydWxlXG4gICAgaW5zZXJ0UnVsZUlmTm90UHJlc2VudChvTW9kZWwubVJ1bGVzLCB7XG4gICAgICAgIGNhdGVnb3J5OiBcIm1ldGFcIixcbiAgICAgICAgbWF0Y2hlZFN0cmluZzogXCJkb21haW5cIixcbiAgICAgICAgdHlwZTogMCAvKiBXT1JEICovLFxuICAgICAgICB3b3JkOiBcImRvbWFpblwiLFxuICAgICAgICBiaXRpbmRleDogbWV0YUJpdEluZGV4LFxuICAgICAgICBfcmFua2luZzogMC45NVxuICAgIH0sIG9Nb2RlbC5zZWVuUnVsZXMpO1xuICAgIHZhciBmaWxsZXJCaXRJbmRleCA9IGdldERvbWFpbkJpdEluZGV4KCdtZXRhJywgb01vZGVsKTtcbiAgICAvL2FkZCBhIGZpbGxlciBydWxlXG4gICAgdmFyIHNmaWxsZXJzID0gZnMucmVhZEZpbGVTeW5jKCcuLycgKyBtb2RlbFBhdGggKyAnL2ZpbGxlci5qc29uJywgJ3V0Zi04Jyk7XG4gICAgdmFyIGZpbGxlcnMgPSBKU09OLnBhcnNlKHNmaWxsZXJzKTtcbiAgICB2YXIgcmUgPSBcIl4oKFwiICsgZmlsbGVycy5qb2luKFwiKXwoXCIpICsgXCIpKSRcIjtcbiAgICBvTW9kZWwubVJ1bGVzLnB1c2goe1xuICAgICAgICBjYXRlZ29yeTogXCJmaWxsZXJcIixcbiAgICAgICAgdHlwZTogMSAvKiBSRUdFWFAgKi8sXG4gICAgICAgIHJlZ2V4cDogbmV3IFJlZ0V4cChyZSwgXCJpXCIpLFxuICAgICAgICBtYXRjaGVkU3RyaW5nOiBcImZpbGxlclwiLFxuICAgICAgICBiaXRpbmRleDogZmlsbGVyQml0SW5kZXgsXG4gICAgICAgIF9yYW5raW5nOiAwLjlcbiAgICB9KTtcbiAgICAvL2FkZCBvcGVyYXRvcnNcbiAgICB2YXIgc09wZXJhdG9ycyA9IGZzLnJlYWRGaWxlU3luYygnLi9yZXNvdXJjZXMvbW9kZWwvb3BlcmF0b3JzLmpzb24nLCAndXRmLTgnKTtcbiAgICB2YXIgb3BlcmF0b3JzID0gSlNPTi5wYXJzZShzT3BlcmF0b3JzKTtcbiAgICB2YXIgb3BlcmF0b3JCaXRJbmRleCA9IGdldERvbWFpbkJpdEluZGV4KCdvcGVyYXRvcnMnLCBvTW9kZWwpO1xuICAgIE9iamVjdC5rZXlzKG9wZXJhdG9ycy5vcGVyYXRvcnMpLmZvckVhY2goZnVuY3Rpb24gKG9wZXJhdG9yKSB7XG4gICAgICAgIGlmIChJTWF0Y2guYU9wZXJhdG9yTmFtZXMuaW5kZXhPZihvcGVyYXRvcikgPCAwKSB7XG4gICAgICAgICAgICBkZWJ1Z2xvZyhcInVua25vd24gb3BlcmF0b3IgXCIgKyBvcGVyYXRvcik7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJ1bmtub3duIG9wZXJhdG9yIFwiICsgb3BlcmF0b3IpO1xuICAgICAgICB9XG4gICAgICAgIG9Nb2RlbC5vcGVyYXRvcnNbb3BlcmF0b3JdID0gb3BlcmF0b3JzLm9wZXJhdG9yc1tvcGVyYXRvcl07XG4gICAgICAgIG9Nb2RlbC5vcGVyYXRvcnNbb3BlcmF0b3JdLm9wZXJhdG9yID0gb3BlcmF0b3I7XG4gICAgICAgIE9iamVjdC5mcmVlemUob01vZGVsLm9wZXJhdG9yc1tvcGVyYXRvcl0pO1xuICAgICAgICB2YXIgd29yZCA9IG9wZXJhdG9yO1xuICAgICAgICBpbnNlcnRSdWxlSWZOb3RQcmVzZW50KG9Nb2RlbC5tUnVsZXMsIHtcbiAgICAgICAgICAgIGNhdGVnb3J5OiBcIm9wZXJhdG9yXCIsXG4gICAgICAgICAgICB3b3JkOiB3b3JkLnRvTG93ZXJDYXNlKCksXG4gICAgICAgICAgICBsb3dlcmNhc2V3b3JkOiB3b3JkLnRvTG93ZXJDYXNlKCksXG4gICAgICAgICAgICB0eXBlOiAwIC8qIFdPUkQgKi8sXG4gICAgICAgICAgICBtYXRjaGVkU3RyaW5nOiB3b3JkLFxuICAgICAgICAgICAgYml0aW5kZXg6IG9wZXJhdG9yQml0SW5kZXgsXG4gICAgICAgICAgICBfcmFua2luZzogMC45XG4gICAgICAgIH0sIG9Nb2RlbC5zZWVuUnVsZXMpO1xuICAgICAgICAvLyBhZGQgYWxsIHN5bm9ueW1zXG4gICAgICAgIGlmIChvcGVyYXRvcnMuc3lub255bXNbb3BlcmF0b3JdKSB7XG4gICAgICAgICAgICBPYmplY3Qua2V5cyhvcGVyYXRvcnMuc3lub255bXNbb3BlcmF0b3JdKS5mb3JFYWNoKGZ1bmN0aW9uIChzeW5vbnltKSB7XG4gICAgICAgICAgICAgICAgaW5zZXJ0UnVsZUlmTm90UHJlc2VudChvTW9kZWwubVJ1bGVzLCB7XG4gICAgICAgICAgICAgICAgICAgIGNhdGVnb3J5OiBcIm9wZXJhdG9yXCIsXG4gICAgICAgICAgICAgICAgICAgIHdvcmQ6IHN5bm9ueW0udG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgICAgICAgICAgbG93ZXJjYXNld29yZDogc3lub255bS50b0xvd2VyQ2FzZSgpLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAwIC8qIFdPUkQgKi8sXG4gICAgICAgICAgICAgICAgICAgIG1hdGNoZWRTdHJpbmc6IG9wZXJhdG9yLFxuICAgICAgICAgICAgICAgICAgICBiaXRpbmRleDogb3BlcmF0b3JCaXRJbmRleCxcbiAgICAgICAgICAgICAgICAgICAgX3Jhbmtpbmc6IDAuOVxuICAgICAgICAgICAgICAgIH0sIG9Nb2RlbC5zZWVuUnVsZXMpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICAvKlxuICAgICAgICB9KVxuICAgICAgICAgICAge1xuICAgICAgICAgIGNhdGVnb3J5OiBcImZpbGxlclwiLFxuICAgICAgICAgIHR5cGU6IDEsXG4gICAgICAgICAgcmVnZXhwOiAvXigoc3RhcnQpfChzaG93KXwoZnJvbSl8KGluKSkkL2ksXG4gICAgICAgICAgbWF0Y2hlZFN0cmluZzogXCJmaWxsZXJcIixcbiAgICAgICAgICBfcmFua2luZzogMC45XG4gICAgICAgIH0sXG4gICAgKi9cbiAgICBvTW9kZWwubVJ1bGVzID0gb01vZGVsLm1SdWxlcy5zb3J0KElucHV0RmlsdGVyUnVsZXMuY21wTVJ1bGUpO1xuICAgIGFkZENsb3NlRXhhY3RSYW5nZVJ1bGVzKG9Nb2RlbC5tUnVsZXMsIG9Nb2RlbC5zZWVuUnVsZXMpO1xuICAgIG9Nb2RlbC5tUnVsZXMgPSBvTW9kZWwubVJ1bGVzLnNvcnQoSW5wdXRGaWx0ZXJSdWxlcy5jbXBNUnVsZSk7XG4gICAgaWYgKGdsb2JhbCAmJiBnbG9iYWwuZ2MpIHtcbiAgICAgICAgZ2xvYmFsLmdjKCk7XG4gICAgfVxuICAgIG9Nb2RlbC5ydWxlcyA9IHNwbGl0UnVsZXMob01vZGVsLm1SdWxlcyk7XG4gICAgaWYgKGdsb2JhbCAmJiBnbG9iYWwuZ2MpIHtcbiAgICAgICAgZ2xvYmFsLmdjKCk7XG4gICAgfVxuICAgIG9Nb2RlbC50b29scyA9IG9Nb2RlbC50b29scy5zb3J0KFRvb2xzLmNtcFRvb2xzKTtcbiAgICBkZWxldGUgb01vZGVsLnNlZW5SdWxlcztcbiAgICBkZWJ1Z2xvZygnc2F2aW5nJyk7XG4gICAgaWYgKGdsb2JhbCAmJiBnbG9iYWwuZ2MpIHtcbiAgICAgICAgZ2xvYmFsLmdjKCk7XG4gICAgfVxuICAgIENpcmN1bGFyU2VyLnNhdmUoJy4vJyArIG1vZGVsUGF0aCArICcvX2NhY2hlJyArICEhYWRkU3BsaXRzICsgJy5qcycsIG9Nb2RlbCk7XG4gICAgaWYgKGdsb2JhbCAmJiBnbG9iYWwuZ2MpIHtcbiAgICAgICAgZ2xvYmFsLmdjKCk7XG4gICAgfVxuICAgIHJldHVybiBvTW9kZWw7XG59XG5leHBvcnRzLmxvYWRNb2RlbHMgPSBsb2FkTW9kZWxzO1xuZnVuY3Rpb24gc29ydENhdGVnb3JpZXNCeUltcG9ydGFuY2UobWFwLCBjYXRzKSB7XG4gICAgdmFyIHJlcyA9IGNhdHMuc2xpY2UoMCk7XG4gICAgcmVzLnNvcnQocmFua0NhdGVnb3J5QnlJbXBvcnRhbmNlLmJpbmQodW5kZWZpbmVkLCBtYXApKTtcbiAgICByZXR1cm4gcmVzO1xufVxuZXhwb3J0cy5zb3J0Q2F0ZWdvcmllc0J5SW1wb3J0YW5jZSA9IHNvcnRDYXRlZ29yaWVzQnlJbXBvcnRhbmNlO1xuZnVuY3Rpb24gcmFua0NhdGVnb3J5QnlJbXBvcnRhbmNlKG1hcCwgY2F0YSwgY2F0Yikge1xuICAgIHZhciBjYXRBRGVzYyA9IG1hcFtjYXRhXTtcbiAgICB2YXIgY2F0QkRlc2MgPSBtYXBbY2F0Yl07XG4gICAgaWYgKGNhdGEgPT09IGNhdGIpIHtcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgfVxuICAgIC8vIGlmIGEgaXMgYmVmb3JlIGIsIHJldHVybiAtMVxuICAgIGlmIChjYXRBRGVzYyAmJiAhY2F0QkRlc2MpIHtcbiAgICAgICAgcmV0dXJuIC0xO1xuICAgIH1cbiAgICBpZiAoIWNhdEFEZXNjICYmIGNhdEJEZXNjKSB7XG4gICAgICAgIHJldHVybiArMTtcbiAgICB9XG4gICAgdmFyIHByaW9BID0gKGNhdEFEZXNjICYmIGNhdEFEZXNjLmltcG9ydGFuY2UpIHx8IDk5O1xuICAgIHZhciBwcmlvQiA9IChjYXRCRGVzYyAmJiBjYXRCRGVzYy5pbXBvcnRhbmNlKSB8fCA5OTtcbiAgICAvLyBsb3dlciBwcmlvIGdvZXMgdG8gZnJvbnRcbiAgICB2YXIgciA9IHByaW9BIC0gcHJpb0I7XG4gICAgaWYgKHIpIHtcbiAgICAgICAgcmV0dXJuIHI7XG4gICAgfVxuICAgIHJldHVybiBjYXRhLmxvY2FsZUNvbXBhcmUoY2F0Yik7XG59XG5leHBvcnRzLnJhbmtDYXRlZ29yeUJ5SW1wb3J0YW5jZSA9IHJhbmtDYXRlZ29yeUJ5SW1wb3J0YW5jZTtcbnZhciBNZXRhRiA9IE1ldGEuZ2V0TWV0YUZhY3RvcnkoKTtcbmZ1bmN0aW9uIGdldE9wZXJhdG9yKG1kbCwgb3BlcmF0b3IpIHtcbiAgICByZXR1cm4gbWRsLm9wZXJhdG9yc1tvcGVyYXRvcl07XG59XG5leHBvcnRzLmdldE9wZXJhdG9yID0gZ2V0T3BlcmF0b3I7XG5mdW5jdGlvbiBnZXRSZXN1bHRBc0FycmF5KG1kbCwgYSwgcmVsKSB7XG4gICAgaWYgKHJlbC50b1R5cGUoKSAhPT0gJ3JlbGF0aW9uJykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJleHBlY3QgcmVsYXRpb24gYXMgMm5kIGFyZ1wiKTtcbiAgICB9XG4gICAgdmFyIHJlcyA9IG1kbC5tZXRhLnQzW2EudG9GdWxsU3RyaW5nKCldICYmXG4gICAgICAgIG1kbC5tZXRhLnQzW2EudG9GdWxsU3RyaW5nKCldW3JlbC50b0Z1bGxTdHJpbmcoKV07XG4gICAgaWYgKCFyZXMpIHtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgICByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMocmVzKS5zb3J0KCkubWFwKE1ldGFGLnBhcnNlSU1ldGEpO1xufVxuZXhwb3J0cy5nZXRSZXN1bHRBc0FycmF5ID0gZ2V0UmVzdWx0QXNBcnJheTtcbmZ1bmN0aW9uIGdldENhdGVnb3JpZXNGb3JEb21haW4odGhlTW9kZWwsIGRvbWFpbikge1xuICAgIGlmICh0aGVNb2RlbC5kb21haW5zLmluZGV4T2YoZG9tYWluKSA8IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRG9tYWluIFxcXCJcIiArIGRvbWFpbiArIFwiXFxcIiBub3QgcGFydCBvZiBtb2RlbFwiKTtcbiAgICB9XG4gICAgdmFyIHJlcyA9IGdldFJlc3VsdEFzQXJyYXkodGhlTW9kZWwsIE1ldGFGLkRvbWFpbihkb21haW4pLCBNZXRhRi5SZWxhdGlvbihNZXRhLlJFTEFUSU9OX2hhc0NhdGVnb3J5KSk7XG4gICAgcmV0dXJuIE1ldGEuZ2V0U3RyaW5nQXJyYXkocmVzKTtcbn1cbmV4cG9ydHMuZ2V0Q2F0ZWdvcmllc0ZvckRvbWFpbiA9IGdldENhdGVnb3JpZXNGb3JEb21haW47XG5mdW5jdGlvbiBnZXRUYWJsZUNvbHVtbnModGhlTW9kZWwsIGRvbWFpbikge1xuICAgIGlmICh0aGVNb2RlbC5kb21haW5zLmluZGV4T2YoZG9tYWluKSA8IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRG9tYWluIFxcXCJcIiArIGRvbWFpbiArIFwiXFxcIiBub3QgcGFydCBvZiBtb2RlbFwiKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoZU1vZGVsLnJhd01vZGVsc1tkb21haW5dLmNvbHVtbnMuc2xpY2UoMCk7XG59XG5leHBvcnRzLmdldFRhYmxlQ29sdW1ucyA9IGdldFRhYmxlQ29sdW1ucztcbi8qKlxuICogUmV0dXJuIGFsbCBjYXRlZ29yaWVzIG9mIGEgZG9tYWluIHdoaWNoIGNhbiBhcHBlYXIgb24gYSB3b3JkLFxuICogdGhlc2UgYXJlIHR5cGljYWxseSB0aGUgd29yZGluZGV4IGRvbWFpbnMgKyBlbnRyaWVzIGdlbmVyYXRlZCBieSBnZW5lcmljIHJ1bGVzXG4gKlxuICogVGhlIGN1cnJlbnQgaW1wbGVtZW50YXRpb24gaXMgYSBzaW1wbGlmaWNhdGlvblxuICovXG5mdW5jdGlvbiBnZXRQb3RlbnRpYWxXb3JkQ2F0ZWdvcmllc0ZvckRvbWFpbih0aGVNb2RlbCwgZG9tYWluKSB7XG4gICAgLy8gdGhpcyBpcyBhIHNpbXBsaWZpZWQgdmVyc2lvblxuICAgIHJldHVybiBnZXRDYXRlZ29yaWVzRm9yRG9tYWluKHRoZU1vZGVsLCBkb21haW4pO1xufVxuZXhwb3J0cy5nZXRQb3RlbnRpYWxXb3JkQ2F0ZWdvcmllc0ZvckRvbWFpbiA9IGdldFBvdGVudGlhbFdvcmRDYXRlZ29yaWVzRm9yRG9tYWluO1xuZnVuY3Rpb24gZ2V0RG9tYWluc0ZvckNhdGVnb3J5KHRoZU1vZGVsLCBjYXRlZ29yeSkge1xuICAgIGlmICh0aGVNb2RlbC5jYXRlZ29yeS5pbmRleE9mKGNhdGVnb3J5KSA8IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ2F0ZWdvcnkgXFxcIlwiICsgY2F0ZWdvcnkgKyBcIlxcXCIgbm90IHBhcnQgb2YgbW9kZWxcIik7XG4gICAgfVxuICAgIHZhciByZXMgPSBnZXRSZXN1bHRBc0FycmF5KHRoZU1vZGVsLCBNZXRhRi5DYXRlZ29yeShjYXRlZ29yeSksIE1ldGFGLlJlbGF0aW9uKE1ldGEuUkVMQVRJT05faXNDYXRlZ29yeU9mKSk7XG4gICAgcmV0dXJuIE1ldGEuZ2V0U3RyaW5nQXJyYXkocmVzKTtcbn1cbmV4cG9ydHMuZ2V0RG9tYWluc0ZvckNhdGVnb3J5ID0gZ2V0RG9tYWluc0ZvckNhdGVnb3J5O1xuZnVuY3Rpb24gZ2V0QWxsUmVjb3JkQ2F0ZWdvcmllc0ZvclRhcmdldENhdGVnb3J5KG1vZGVsLCBjYXRlZ29yeSwgd29yZHNvbmx5KSB7XG4gICAgdmFyIHJlcyA9IHt9O1xuICAgIC8vXG4gICAgdmFyIGZuID0gd29yZHNvbmx5ID8gZ2V0UG90ZW50aWFsV29yZENhdGVnb3JpZXNGb3JEb21haW4gOiBnZXRDYXRlZ29yaWVzRm9yRG9tYWluO1xuICAgIHZhciBkb21haW5zID0gZ2V0RG9tYWluc0ZvckNhdGVnb3J5KG1vZGVsLCBjYXRlZ29yeSk7XG4gICAgZG9tYWlucy5mb3JFYWNoKGZ1bmN0aW9uIChkb21haW4pIHtcbiAgICAgICAgZm4obW9kZWwsIGRvbWFpbikuZm9yRWFjaChmdW5jdGlvbiAod29yZGNhdCkge1xuICAgICAgICAgICAgcmVzW3dvcmRjYXRdID0gdHJ1ZTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gICAgT2JqZWN0LmZyZWV6ZShyZXMpO1xuICAgIHJldHVybiByZXM7XG59XG5leHBvcnRzLmdldEFsbFJlY29yZENhdGVnb3JpZXNGb3JUYXJnZXRDYXRlZ29yeSA9IGdldEFsbFJlY29yZENhdGVnb3JpZXNGb3JUYXJnZXRDYXRlZ29yeTtcbmZ1bmN0aW9uIGdldEFsbFJlY29yZENhdGVnb3JpZXNGb3JUYXJnZXRDYXRlZ29yaWVzKG1vZGVsLCBjYXRlZ29yaWVzLCB3b3Jkc29ubHkpIHtcbiAgICB2YXIgcmVzID0ge307XG4gICAgLy9cbiAgICB2YXIgZm4gPSB3b3Jkc29ubHkgPyBnZXRQb3RlbnRpYWxXb3JkQ2F0ZWdvcmllc0ZvckRvbWFpbiA6IGdldENhdGVnb3JpZXNGb3JEb21haW47XG4gICAgdmFyIGRvbWFpbnMgPSB1bmRlZmluZWQ7XG4gICAgY2F0ZWdvcmllcy5mb3JFYWNoKGZ1bmN0aW9uIChjYXRlZ29yeSkge1xuICAgICAgICB2YXIgY2F0ZG9tYWlucyA9IGdldERvbWFpbnNGb3JDYXRlZ29yeShtb2RlbCwgY2F0ZWdvcnkpO1xuICAgICAgICBpZiAoIWRvbWFpbnMpIHtcbiAgICAgICAgICAgIGRvbWFpbnMgPSBjYXRkb21haW5zO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZG9tYWlucyA9IF8uaW50ZXJzZWN0aW9uKGRvbWFpbnMsIGNhdGRvbWFpbnMpO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgaWYgKGRvbWFpbnMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignY2F0ZWdvcmllcyAnICsgVXRpbHMubGlzdFRvUXVvdGVkQ29tbWFBbmQoY2F0ZWdvcmllcykgKyAnIGhhdmUgbm8gY29tbW9uIGRvbWFpbi4nKTtcbiAgICB9XG4gICAgZG9tYWlucy5mb3JFYWNoKGZ1bmN0aW9uIChkb21haW4pIHtcbiAgICAgICAgZm4obW9kZWwsIGRvbWFpbikuZm9yRWFjaChmdW5jdGlvbiAod29yZGNhdCkge1xuICAgICAgICAgICAgcmVzW3dvcmRjYXRdID0gdHJ1ZTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gICAgT2JqZWN0LmZyZWV6ZShyZXMpO1xuICAgIHJldHVybiByZXM7XG59XG5leHBvcnRzLmdldEFsbFJlY29yZENhdGVnb3JpZXNGb3JUYXJnZXRDYXRlZ29yaWVzID0gZ2V0QWxsUmVjb3JkQ2F0ZWdvcmllc0ZvclRhcmdldENhdGVnb3JpZXM7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
