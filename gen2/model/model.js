/**
 * Functionality managing the match models
 *
 * @file
 */
"use strict";

var debug = require("debug");
var debuglog = debug('model');
var logger = require("../utils/logger");
var loadlog = logger.logger('modelload', '');
var IMatch = require("../match/ifmatch");
var InputFilterRules = require("../match/inputFilterRules");
var Tools = require("../match/tools");
var fs = require("fs");
var Meta = require("./meta");
var Utils = require("../utils/utils");
var CircularSer = require("../utils/circularser");
var process = require("process");
var _ = require("lodash");
/**
 * the model path, may be controlled via environment variable
 */
var envModelPath = process.env["ABOT_MODELPATH"] || "testmodel";
var ARR_MODEL_PROPERTIES = ["domain", "bitindex", "defaultkeycolumn", "defaulturi", "categoryDescribed", "columns", "description", "tool", "toolhidden", "synonyms", "category", "wordindex", "exactmatch", "hidden"];
function addSynonyms(synonyms, category, synonymFor, bitindex, mRules, seen) {
    synonyms.forEach(function (syn) {
        var oRule = {
            category: category,
            matchedString: synonymFor,
            type: 0 /* WORD */
            , word: syn,
            bitindex: bitindex,
            _ranking: 0.95
        };
        debuglog(debuglog.enabled ? "inserting synonym" + JSON.stringify(oRule) : '-');
        insertRuleIfNotPresent(mRules, oRule, seen);
    });
}
function getRuleKey(rule) {
    var r1 = rule.matchedString + "-|-" + rule.category + " -|- " + rule.type + " -|- " + rule.word + " ";
    if (rule.range) {
        var r2 = getRuleKey(rule.range.rule);
        r1 += " -|- " + rule.range.low + "/" + rule.range.high + " -|- " + r2;
    }
    return r1;
}
var Breakdown = require("../match/breakdown");
/* given a rule which represents a word sequence which is split during tokenization */
function addBestSplit(mRules, rule, seenRules) {
    //if(!global_AddSplits) {
    //    return;
    //}
    if (rule.type !== 0 /* WORD */) {
            return;
        }
    var best = Breakdown.makeMatchPattern(rule.lowercaseword);
    if (!best) {
        return;
    }
    var newRule = {
        category: rule.category,
        matchedString: rule.matchedString,
        bitindex: rule.bitindex,
        word: best.longestToken,
        type: 0,
        lowercaseword: best.longestToken,
        _ranking: 0.95,
        //    exactOnly : rule.exactOnly,
        range: best.span
    };
    if (rule.exactOnly) {
        newRule.exactOnly = rule.exactOnly;
    }
    ;
    newRule.range.rule = rule;
    insertRuleIfNotPresent(mRules, newRule, seenRules);
}
exports.addBestSplit = addBestSplit;
function insertRuleIfNotPresent(mRules, rule, seenRules) {
    if (rule.type !== 0 /* WORD */) {
            mRules.push(rule);
            return;
        }
    if (rule.word === undefined || rule.matchedString === undefined) {
        throw new Error('illegal rule' + JSON.stringify(rule, undefined, 2));
    }
    var r = getRuleKey(rule);
    /* if( (rule.word === "service" || rule.word=== "services") && r.indexOf('OData') >= 0) {
         console.log("rulekey is" + r);
         console.log("presence is " + JSON.stringify(seenRules[r]));
     }*/
    rule.lowercaseword = rule.word.toLowerCase();
    if (seenRules[r]) {
        debuglog(debuglog.enabled ? "Attempting to insert duplicate" + JSON.stringify(rule, undefined, 2) : "-");
        var duplicates = seenRules[r].filter(function (oEntry) {
            return 0 === InputFilterRules.compareMRuleFull(oEntry, rule);
        });
        if (duplicates.length > 0) {
            return;
        }
    }
    seenRules[r] = seenRules[r] || [];
    seenRules[r].push(rule);
    if (rule.word === "") {
        debuglog(debuglog.enabled ? 'Skipping rule with emtpy word ' + JSON.stringify(rule, undefined, 2) : '-');
        loadlog('Skipping rule with emtpy word ' + JSON.stringify(rule, undefined, 2));
        return;
    }
    mRules.push(rule);
    addBestSplit(mRules, rule, seenRules);
    return;
}
function loadModelData(modelPath, oMdl, sModelName, oModel) {
    // read the data ->
    // data is processed into mRules directly,
    var bitindex = oMdl.bitindex;
    var sFileName = './' + modelPath + '/' + sModelName + ".data.json";
    var mdldata = fs.readFileSync(sFileName, 'utf-8');
    var oMdlData = JSON.parse(mdldata);
    oMdlData.forEach(function (oEntry) {
        if (!oEntry.tool) {
            oEntry._domain = oMdl.domain;
        }
        if (!oEntry.tool && oMdl.tool.name) {
            oEntry.tool = oMdl.tool.name;
        }
        oModel.records.push(oEntry);
        oMdl.category.forEach(function (cat) {
            if (oEntry[cat] === 'undefined') {
                oEntry[cat] = "n/a";
                var bug = "INCONSISTENT*> ModelData " + sFileName + " does not contain category " + cat + " with value 'undefined', undefined is illegal value, use n/a " + JSON.stringify(oEntry) + "";
                debuglog(bug);
            }
        });
        oMdl.wordindex.forEach(function (category) {
            if (oEntry[category] === undefined) {
                debuglog("INCONSISTENT*> ModelData " + sFileName + " does not contain category " + category + " of wordindex" + JSON.stringify(oEntry) + "");
                return;
            }
            if (oEntry[category] !== "*") {
                var sString = oEntry[category];
                debuglog("pushing rule with " + category + " -> " + sString);
                var oRule = {
                    category: category,
                    matchedString: sString,
                    type: 0 /* WORD */
                    , word: sString,
                    bitindex: bitindex,
                    _ranking: 0.95
                };
                if (oMdl.exactmatch && oMdl.exactmatch.indexOf(category) >= 0) {
                    oRule.exactOnly = true;
                }
                insertRuleIfNotPresent(oModel.mRules, oRule, oModel.seenRules);
                if (oMdlData.synonyms && oMdlData.synonyms[category]) {
                    addSynonyms(oMdlData.synonyms[category], category, sString, bitindex, oModel.mRules, oModel.seenRules);
                }
                if (oEntry.synonyms && oEntry.synonyms[category]) {
                    addSynonyms(oEntry.synonyms[category], category, sString, bitindex, oModel.mRules, oModel.seenRules);
                }
            }
        });
    });
}
function loadModel(modelPath, sModelName, oModel) {
    debuglog(" loading " + sModelName + " ....");
    var mdl = fs.readFileSync('./' + modelPath + '/' + sModelName + ".model.json", 'utf-8');
    var oMdl = JSON.parse(mdl);
    mergeModelJson(sModelName, oMdl, oModel);
    loadModelData(modelPath, oMdl, sModelName, oModel);
}
function getDomainBitIndex(domain, oModel) {
    var index = oModel.domains.indexOf(domain);
    if (index < 0) {
        index = oModel.domains.length;
    }
    if (index >= 32) {
        throw new Error("too many domain for single 32 bit index");
    }
    return 0x0001 << index;
}
exports.getDomainBitIndex = getDomainBitIndex;
function mergeModelJson(sModelName, oMdl, oModel) {
    var categoryDescribedMap = {};
    oMdl.bitindex = getDomainBitIndex(oMdl.domain, oModel);
    oMdl.categoryDescribed = [];
    // rectify category
    oMdl.category = oMdl.category.map(function (cat) {
        if (typeof cat === "string") {
            return cat;
        }
        if (typeof cat.name !== "string") {
            console.log("Missing name in object typed category in " + JSON.stringify(cat) + " in model " + sModelName);
            process.exit(-1);
        }
        categoryDescribedMap[cat.name] = cat;
        oMdl.categoryDescribed.push(cat);
        return cat.name;
    });
    // add the categories to the model:
    oMdl.category.forEach(function (category) {
        insertRuleIfNotPresent(oModel.mRules, {
            category: "category",
            matchedString: category,
            type: 0 /* WORD */
            , word: category,
            lowercaseword: category.toLowerCase(),
            bitindex: oMdl.bitindex,
            _ranking: 0.95
        }, oModel.seenRules);
    });
    if (oModel.domains.indexOf(oMdl.domain) >= 0) {
        debuglog("***********here mdl" + JSON.stringify(oMdl, undefined, 2));
        throw new Error('Domain ' + oMdl.domain + ' already loaded while loading ' + sModelName + '?');
    }
    // check properties of model
    Object.keys(oMdl).sort().forEach(function (sProperty) {
        if (ARR_MODEL_PROPERTIES.indexOf(sProperty) < 0) {
            throw new Error('Model property "' + sProperty + '" not a known model property in model of domain ' + oMdl.domain + ' ');
        }
    });
    // consider streamlining the categories
    oModel.rawModels[oMdl.domain] = oMdl;
    oModel.full.domain[oMdl.domain] = {
        description: oMdl.description,
        categories: categoryDescribedMap,
        bitindex: oMdl.bitindex
    };
    // check that
    // check that members of wordindex are in categories,
    oMdl.wordindex = oMdl.wordindex || [];
    oMdl.wordindex.forEach(function (sWordIndex) {
        if (oMdl.category.indexOf(sWordIndex) < 0) {
            throw new Error('Model wordindex "' + sWordIndex + '" not a category of domain ' + oMdl.domain + ' ');
        }
    });
    oMdl.exactmatch = oMdl.exactmatch || [];
    oMdl.exactmatch.forEach(function (sExactMatch) {
        if (oMdl.category.indexOf(sExactMatch) < 0) {
            throw new Error('Model exactmatch "' + sExactMatch + '" not a category of domain ' + oMdl.domain + ' ');
        }
    });
    oMdl.columns = oMdl.columns || [];
    oMdl.columns.forEach(function (sExactMatch) {
        if (oMdl.category.indexOf(sExactMatch) < 0) {
            throw new Error('Model column "' + sExactMatch + '" not a category of domain ' + oMdl.domain + ' ');
        }
    });
    // add relation domain -> category
    var domainStr = MetaF.Domain(oMdl.domain).toFullString();
    var relationStr = MetaF.Relation(Meta.RELATION_hasCategory).toFullString();
    var reverseRelationStr = MetaF.Relation(Meta.RELATION_isCategoryOf).toFullString();
    oMdl.category.forEach(function (sCategory) {
        var CategoryString = MetaF.Category(sCategory).toFullString();
        oModel.meta.t3[domainStr] = oModel.meta.t3[domainStr] || {};
        oModel.meta.t3[domainStr][relationStr] = oModel.meta.t3[domainStr][relationStr] || {};
        oModel.meta.t3[domainStr][relationStr][CategoryString] = {};
        oModel.meta.t3[CategoryString] = oModel.meta.t3[CategoryString] || {};
        oModel.meta.t3[CategoryString][reverseRelationStr] = oModel.meta.t3[CategoryString][reverseRelationStr] || {};
        oModel.meta.t3[CategoryString][reverseRelationStr][domainStr] = {};
    });
    // add a precice domain matchrule
    insertRuleIfNotPresent(oModel.mRules, {
        category: "domain",
        matchedString: oMdl.domain,
        type: 0 /* WORD */
        , word: oMdl.domain,
        bitindex: oMdl.bitindex,
        _ranking: 0.95
    }, oModel.seenRules);
    // check the tool
    if (oMdl.tool && oMdl.tool.requires) {
        var requires = Object.keys(oMdl.tool.requires || {});
        var diff = _.difference(requires, oMdl.category);
        if (diff.length > 0) {
            console.log(" " + oMdl.domain + " : Unkown category in requires of tool: \"" + diff.join('"') + '"');
            process.exit(-1);
        }
        var optional = Object.keys(oMdl.tool.optional);
        diff = _.difference(optional, oMdl.category);
        if (diff.length > 0) {
            console.log(" " + oMdl.domain + " : Unkown category optional of tool: \"" + diff.join('"') + '"');
            process.exit(-1);
        }
        Object.keys(oMdl.tool.sets || {}).forEach(function (setID) {
            var diff = _.difference(oMdl.tool.sets[setID].set, oMdl.category);
            if (diff.length > 0) {
                console.log(" " + oMdl.domain + " : Unkown category in setId " + setID + " of tool: \"" + diff.join('"') + '"');
                process.exit(-1);
            }
        });
        // extract tools an add to tools:
        oModel.tools.filter(function (oEntry) {
            if (oEntry.name === (oMdl.tool && oMdl.tool.name)) {
                console.log("Tool " + oMdl.tool.name + " already present when loading " + sModelName);
                //throw new Error('Domain already loaded?');
                process.exit(-1);
            }
        });
    } else {
        oMdl.toolhidden = true;
        oMdl.tool.requires = { "impossible": {} };
    }
    // add the tool name as rule unless hidden
    if (!oMdl.toolhidden && oMdl.tool && oMdl.tool.name) {
        insertRuleIfNotPresent(oModel.mRules, {
            category: "tool",
            matchedString: oMdl.tool.name,
            type: 0 /* WORD */
            , word: oMdl.tool.name,
            bitindex: oMdl.bitindex,
            _ranking: 0.95
        }, oModel.seenRules);
    }
    ;
    if (oMdl.synonyms && oMdl.synonyms["tool"]) {
        addSynonyms(oMdl.synonyms["tool"], "tool", oMdl.tool.name, oMdl.bitindex, oModel.mRules, oModel.seenRules);
    }
    ;
    if (oMdl.synonyms) {
        Object.keys(oMdl.synonyms).forEach(function (ssynkey) {
            if (oMdl.category.indexOf(ssynkey) >= 0 && ssynkey !== "tool") {
                if (oModel.full.domain[oMdl.domain].categories[ssynkey]) {
                    oModel.full.domain[oMdl.domain].categories[ssynkey].synonyms = oMdl.synonyms[ssynkey];
                }
                addSynonyms(oMdl.synonyms[ssynkey], "category", ssynkey, oMdl.bitindex, oModel.mRules, oModel.seenRules);
            }
        });
    }
    oModel.domains.push(oMdl.domain);
    if (oMdl.tool.name) {
        oModel.tools.push(oMdl.tool);
    }
    oModel.category = oModel.category.concat(oMdl.category);
    oModel.category.sort();
    oModel.category = oModel.category.filter(function (string, index) {
        return oModel.category[index] !== oModel.category[index + 1];
    });
} // loadmodel
function splitRules(rules) {
    var res = {};
    var nonWordRules = [];
    rules.forEach(function (rule) {
        if (rule.type === 0 /* WORD */) {
                if (!rule.lowercaseword) {
                    throw new Error("Rule has no member lowercaseword" + JSON.stringify(rule));
                }
                res[rule.lowercaseword] = res[rule.lowercaseword] || { bitindex: 0, rules: [] };
                res[rule.lowercaseword].bitindex = res[rule.lowercaseword].bitindex | rule.bitindex;
                res[rule.lowercaseword].rules.push(rule);
            } else {
            nonWordRules.push(rule);
        }
    });
    return {
        wordMap: res,
        nonWordRules: nonWordRules,
        allRules: rules,
        wordCache: {}
    };
}
exports.splitRules = splitRules;
function cmpLengthSort(a, b) {
    var d = a.length - b.length;
    if (d) {
        return d;
    }
    return a.localeCompare(b);
}
var Distance = require("../utils/damerauLevenshtein");
var Algol = require("../match/algol");
// offset[0] : len-2
//             len -1
//             len
//             len +1
//             len +2
//             len +3
function findNextLen(targetLen, arr, offsets) {
    offsets.shift();
    for (var i = offsets[4]; i < arr.length && arr[i].length <= targetLen; ++i) {}
    //console.log("pushing " + i);
    offsets.push(i);
}
exports.findNextLen = findNextLen;
function addRangeRulesUnlessPresent(rules, lcword, rangeRules, presentRulesForKey, seenRules) {
    rangeRules.forEach(function (rangeRule) {
        var newRule = Object.assign({}, rangeRule);
        newRule.lowercaseword = lcword;
        newRule.word = lcword;
        //if((lcword === 'services' || lcword === 'service') && newRule.range.rule.lowercaseword.indexOf('odata')>=0) {
        //    console.log("adding "+ JSON.stringify(newRule) + "\n");
        //}
        //todo: check whether an equivalent rule is already present?
        var cnt = rules.length;
        insertRuleIfNotPresent(rules, newRule, seenRules);
    });
}
exports.addRangeRulesUnlessPresent = addRangeRulesUnlessPresent;
function addCloseExactRangeRules(rules, seenRules) {
    var keysMap = {};
    var rangeKeysMap = {};
    rules.forEach(function (rule) {
        if (rule.type === 0 /* WORD */) {
                //keysMap[rule.lowercaseword] = 1;
                keysMap[rule.lowercaseword] = keysMap[rule.lowercaseword] || [];
                keysMap[rule.lowercaseword].push(rule);
                if (!rule.exactOnly && rule.range) {
                    rangeKeysMap[rule.lowercaseword] = rangeKeysMap[rule.lowercaseword] || [];
                    rangeKeysMap[rule.lowercaseword].push(rule);
                }
            }
    });
    var keys = Object.keys(keysMap);
    keys.sort(cmpLengthSort);
    var len = 0;
    keys.forEach(function (key, index) {
        if (key.length != len) {}
        len = key.length;
    });
    //   keys = keys.slice(0,2000);
    var rangeKeys = Object.keys(rangeKeysMap);
    rangeKeys.sort(cmpLengthSort);
    //console.log(` ${keys.length} keys and ${rangeKeys.length} rangekeys `);
    var low = 0;
    var high = 0;
    var lastlen = 0;
    var offsets = [0, 0, 0, 0, 0, 0];
    var len = rangeKeys.length;
    findNextLen(0, keys, offsets);
    findNextLen(1, keys, offsets);
    findNextLen(2, keys, offsets);
    rangeKeys.forEach(function (rangeKey) {
        if (rangeKey.length !== lastlen) {
            for (i = lastlen + 1; i <= rangeKey.length; ++i) {
                findNextLen(i + 2, keys, offsets);
            }
            //   console.log(` shifted to ${rangeKey.length} with offsets beeing ${offsets.join(' ')}`);
            //   console.log(` here 0 ${offsets[0]} : ${keys[Math.min(keys.length-1, offsets[0])].length}  ${keys[Math.min(keys.length-1, offsets[0])]} `);
            //  console.log(` here 5-1  ${keys[offsets[5]-1].length}  ${keys[offsets[5]-1]} `);
            //   console.log(` here 5 ${offsets[5]} : ${keys[Math.min(keys.length-1, offsets[5])].length}  ${keys[Math.min(keys.length-1, offsets[5])]} `);
            lastlen = rangeKey.length;
        }
        for (var i = offsets[0]; i < offsets[5]; ++i) {
            var d = Distance.calcDistanceAdjusted(rangeKey, keys[i]);
            // console.log(`${rangeKey.length-keys[i].length} ${d} ${rangeKey} and ${keys[i]}  `);
            if (d !== 1.0 && d >= Algol.Cutoff_rangeCloseMatch) {
                //console.log(`would add ${rangeKey} for ${keys[i]} ${d}`);
                var cnt = rules.length;
                // we only have to add if there is not yet a match rule here which points to the same
                addRangeRulesUnlessPresent(rules, keys[i], rangeKeysMap[rangeKey], keysMap[keys[i]], seenRules);
                if (rules.length > cnt) {}
            }
        }
    });
    /*
    [
        ['aEFG','aEFGH'],
        ['aEFGH','aEFGHI'],
        ['Odata','ODatas'],
    ['Odata','Odatas'],
    ['Odata','Odatb'],
    ['Odata','UData'],
    ['service','services'],
    ['this isfunny and more','this isfunny and mores'],
    ].forEach(rec => {
        console.log(`distance ${rec[0]} ${rec[1]} : ${Distance.calcDistance(rec[0],rec[1])}  adf ${Distance.calcDistanceAdjusted(rec[0],rec[1])} `);
     });
    console.log("distance Odata Udata"+ Distance.calcDistance('OData','UData'));
    console.log("distance Odata Odatb"+ Distance.calcDistance('OData','ODatb'));
    console.log("distance Odatas Odata"+ Distance.calcDistance('OData','ODataa'));
    console.log("distance Odatas abcde"+ Distance.calcDistance('abcde','abcdef'));
    console.log("distance services "+ Distance.calcDistance('services','service'));
    */
}
exports.addCloseExactRangeRules = addCloseExactRangeRules;
var n = 0;
function loadModels(modelPath) {
    var oModel;
    oModel = {
        full: { domain: {} },
        rawModels: {},
        domains: [],
        tools: [],
        rules: undefined,
        category: [],
        operators: {},
        mRules: [],
        seenRules: {},
        records: [],
        meta: { t3: {} }
    };
    var t = Date.now();
    modelPath = modelPath || envModelPath;
    try {
        var a = CircularSer.load('./' + modelPath + '/_cachefalse.js');
        //console.log("found a cache ?  " + !!a);
        //a = undefined;
        if (a) {
            debuglog(" return preparese model ");
            if (process.env.ABOT_EMAIL_USER) {
                console.log("loaded models from cache in " + (Date.now() - t) + " ");
            }
            return a;
        }
    } catch (e) {}
    var smdls = fs.readFileSync('./' + modelPath + '/models.json', 'utf-8');
    var mdls = JSON.parse("" + smdls);
    mdls.forEach(function (sModelName) {
        loadModel(modelPath, sModelName, oModel);
    });
    // add the categories to the model:
    /*
    oModel.category.forEach(function (category) {
        insertRuleIfNotPresent(oModel.mRules, {
            category: "category",
            matchedString: category,
            type: IMatch.EnumRuleType.WORD,
            word: category,
            lowercaseword: category.toLowerCase(),
            bitindex : oMdl.
            _ranking: 0.95
        }, oModel.seenRules);
    });
    */
    var metaBitIndex = getDomainBitIndex('meta', oModel);
    // add the domain meta rule
    insertRuleIfNotPresent(oModel.mRules, {
        category: "meta",
        matchedString: "domain",
        type: 0 /* WORD */
        , word: "domain",
        bitindex: metaBitIndex,
        _ranking: 0.95
    }, oModel.seenRules);
    var fillerBitIndex = getDomainBitIndex('meta', oModel);
    //add a filler rule
    var sfillers = fs.readFileSync('./' + modelPath + '/filler.json', 'utf-8');
    var fillers = JSON.parse(sfillers);
    var re = "^((" + fillers.join(")|(") + "))$";
    oModel.mRules.push({
        category: "filler",
        type: 1 /* REGEXP */
        , regexp: new RegExp(re, "i"),
        matchedString: "filler",
        bitindex: fillerBitIndex,
        _ranking: 0.9
    });
    //add operators
    var sOperators = fs.readFileSync('./resources/model/operators.json', 'utf-8');
    var operators = JSON.parse(sOperators);
    var operatorBitIndex = getDomainBitIndex('operators', oModel);
    Object.keys(operators.operators).forEach(function (operator) {
        if (IMatch.aOperatorNames.indexOf(operator) < 0) {
            debuglog("unknown operator " + operator);
            throw new Error("unknown operator " + operator);
        }
        oModel.operators[operator] = operators.operators[operator];
        oModel.operators[operator].operator = operator;
        Object.freeze(oModel.operators[operator]);
        var word = operator;
        insertRuleIfNotPresent(oModel.mRules, {
            category: "operator",
            word: word.toLowerCase(),
            lowercaseword: word.toLowerCase(),
            type: 0 /* WORD */
            , matchedString: word,
            bitindex: operatorBitIndex,
            _ranking: 0.9
        }, oModel.seenRules);
        // add all synonyms
        if (operators.synonyms[operator]) {
            Object.keys(operators.synonyms[operator]).forEach(function (synonym) {
                insertRuleIfNotPresent(oModel.mRules, {
                    category: "operator",
                    word: synonym.toLowerCase(),
                    lowercaseword: synonym.toLowerCase(),
                    type: 0 /* WORD */
                    , matchedString: operator,
                    bitindex: operatorBitIndex,
                    _ranking: 0.9
                }, oModel.seenRules);
            });
        }
    });
    /*
        })
            {
          category: "filler",
          type: 1,
          regexp: /^((start)|(show)|(from)|(in))$/i,
          matchedString: "filler",
          _ranking: 0.9
        },
    */
    oModel.mRules = oModel.mRules.sort(InputFilterRules.cmpMRule);
    addCloseExactRangeRules(oModel.mRules, oModel.seenRules);
    oModel.mRules = oModel.mRules.sort(InputFilterRules.cmpMRule);
    if (global && global.gc) {
        global.gc();
    }
    oModel.rules = splitRules(oModel.mRules);
    if (global && global.gc) {
        global.gc();
    }
    oModel.tools = oModel.tools.sort(Tools.cmpTools);
    delete oModel.seenRules;
    debuglog('saving');
    if (global && global.gc) {
        global.gc();
    }
    CircularSer.save('./' + modelPath + '/_cachefalse.js', oModel);
    if (global && global.gc) {
        global.gc();
    }
    if (process.env.ABOT_EMAIL_USER) {
        console.log("loaded models by calculation in " + (Date.now() - t) + " ");
    }
    return oModel;
}
exports.loadModels = loadModels;
function sortCategoriesByImportance(map, cats) {
    var res = cats.slice(0);
    res.sort(rankCategoryByImportance.bind(undefined, map));
    return res;
}
exports.sortCategoriesByImportance = sortCategoriesByImportance;
function rankCategoryByImportance(map, cata, catb) {
    var catADesc = map[cata];
    var catBDesc = map[catb];
    if (cata === catb) {
        return 0;
    }
    // if a is before b, return -1
    if (catADesc && !catBDesc) {
        return -1;
    }
    if (!catADesc && catBDesc) {
        return +1;
    }
    var prioA = catADesc && catADesc.importance || 99;
    var prioB = catBDesc && catBDesc.importance || 99;
    // lower prio goes to front
    var r = prioA - prioB;
    if (r) {
        return r;
    }
    return cata.localeCompare(catb);
}
exports.rankCategoryByImportance = rankCategoryByImportance;
var MetaF = Meta.getMetaFactory();
function getOperator(mdl, operator) {
    return mdl.operators[operator];
}
exports.getOperator = getOperator;
function getResultAsArray(mdl, a, rel) {
    if (rel.toType() !== 'relation') {
        throw new Error("expect relation as 2nd arg");
    }
    var res = mdl.meta.t3[a.toFullString()] && mdl.meta.t3[a.toFullString()][rel.toFullString()];
    if (!res) {
        return [];
    }
    return Object.getOwnPropertyNames(res).sort().map(MetaF.parseIMeta);
}
exports.getResultAsArray = getResultAsArray;
function getCategoriesForDomain(theModel, domain) {
    if (theModel.domains.indexOf(domain) < 0) {
        throw new Error("Domain \"" + domain + "\" not part of model");
    }
    var res = getResultAsArray(theModel, MetaF.Domain(domain), MetaF.Relation(Meta.RELATION_hasCategory));
    return Meta.getStringArray(res);
}
exports.getCategoriesForDomain = getCategoriesForDomain;
function getTableColumns(theModel, domain) {
    if (theModel.domains.indexOf(domain) < 0) {
        throw new Error("Domain \"" + domain + "\" not part of model");
    }
    return theModel.rawModels[domain].columns.slice(0);
}
exports.getTableColumns = getTableColumns;
/**
 * Return all categories of a domain which can appear on a word,
 * these are typically the wordindex domains + entries generated by generic rules
 *
 * The current implementation is a simplification
 */
function getPotentialWordCategoriesForDomain(theModel, domain) {
    // this is a simplified version
    return getCategoriesForDomain(theModel, domain);
}
exports.getPotentialWordCategoriesForDomain = getPotentialWordCategoriesForDomain;
function getDomainsForCategory(theModel, category) {
    if (theModel.category.indexOf(category) < 0) {
        throw new Error("Category \"" + category + "\" not part of model");
    }
    var res = getResultAsArray(theModel, MetaF.Category(category), MetaF.Relation(Meta.RELATION_isCategoryOf));
    return Meta.getStringArray(res);
}
exports.getDomainsForCategory = getDomainsForCategory;
function getAllRecordCategoriesForTargetCategory(model, category, wordsonly) {
    var res = {};
    //
    var fn = wordsonly ? getPotentialWordCategoriesForDomain : getCategoriesForDomain;
    var domains = getDomainsForCategory(model, category);
    domains.forEach(function (domain) {
        fn(model, domain).forEach(function (wordcat) {
            res[wordcat] = true;
        });
    });
    Object.freeze(res);
    return res;
}
exports.getAllRecordCategoriesForTargetCategory = getAllRecordCategoriesForTargetCategory;
function getAllRecordCategoriesForTargetCategories(model, categories, wordsonly) {
    var res = {};
    //
    var fn = wordsonly ? getPotentialWordCategoriesForDomain : getCategoriesForDomain;
    var domains = undefined;
    categories.forEach(function (category) {
        var catdomains = getDomainsForCategory(model, category);
        if (!domains) {
            domains = catdomains;
        } else {
            domains = _.intersection(domains, catdomains);
        }
    });
    if (domains.length === 0) {
        throw new Error('categories ' + Utils.listToQuotedCommaAnd(categories) + ' have no common domain.');
    }
    domains.forEach(function (domain) {
        fn(model, domain).forEach(function (wordcat) {
            res[wordcat] = true;
        });
    });
    Object.freeze(res);
    return res;
}
exports.getAllRecordCategoriesForTargetCategories = getAllRecordCategoriesForTargetCategories;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9tb2RlbC9tb2RlbC50cyIsIm1vZGVsL21vZGVsLmpzIl0sIm5hbWVzIjpbImRlYnVnIiwicmVxdWlyZSIsImRlYnVnbG9nIiwibG9nZ2VyIiwibG9hZGxvZyIsIklNYXRjaCIsIklucHV0RmlsdGVyUnVsZXMiLCJUb29scyIsImZzIiwiTWV0YSIsIlV0aWxzIiwiQ2lyY3VsYXJTZXIiLCJwcm9jZXNzIiwiXyIsImVudk1vZGVsUGF0aCIsImVudiIsIkFSUl9NT0RFTF9QUk9QRVJUSUVTIiwiYWRkU3lub255bXMiLCJzeW5vbnltcyIsImNhdGVnb3J5Iiwic3lub255bUZvciIsImJpdGluZGV4IiwibVJ1bGVzIiwic2VlbiIsImZvckVhY2giLCJzeW4iLCJvUnVsZSIsIm1hdGNoZWRTdHJpbmciLCJ0eXBlIiwid29yZCIsIl9yYW5raW5nIiwiZW5hYmxlZCIsIkpTT04iLCJzdHJpbmdpZnkiLCJpbnNlcnRSdWxlSWZOb3RQcmVzZW50IiwiZ2V0UnVsZUtleSIsInJ1bGUiLCJyMSIsInJhbmdlIiwicjIiLCJsb3ciLCJoaWdoIiwiQnJlYWtkb3duIiwiYWRkQmVzdFNwbGl0Iiwic2VlblJ1bGVzIiwiYmVzdCIsIm1ha2VNYXRjaFBhdHRlcm4iLCJsb3dlcmNhc2V3b3JkIiwibmV3UnVsZSIsImxvbmdlc3RUb2tlbiIsInNwYW4iLCJleGFjdE9ubHkiLCJleHBvcnRzIiwicHVzaCIsInVuZGVmaW5lZCIsIkVycm9yIiwiciIsInRvTG93ZXJDYXNlIiwiZHVwbGljYXRlcyIsImZpbHRlciIsIm9FbnRyeSIsImNvbXBhcmVNUnVsZUZ1bGwiLCJsZW5ndGgiLCJsb2FkTW9kZWxEYXRhIiwibW9kZWxQYXRoIiwib01kbCIsInNNb2RlbE5hbWUiLCJvTW9kZWwiLCJzRmlsZU5hbWUiLCJtZGxkYXRhIiwicmVhZEZpbGVTeW5jIiwib01kbERhdGEiLCJwYXJzZSIsInRvb2wiLCJfZG9tYWluIiwiZG9tYWluIiwibmFtZSIsInJlY29yZHMiLCJjYXQiLCJidWciLCJ3b3JkaW5kZXgiLCJzU3RyaW5nIiwiZXhhY3RtYXRjaCIsImluZGV4T2YiLCJsb2FkTW9kZWwiLCJtZGwiLCJtZXJnZU1vZGVsSnNvbiIsImdldERvbWFpbkJpdEluZGV4IiwiaW5kZXgiLCJkb21haW5zIiwiY2F0ZWdvcnlEZXNjcmliZWRNYXAiLCJjYXRlZ29yeURlc2NyaWJlZCIsIm1hcCIsImNvbnNvbGUiLCJsb2ciLCJleGl0IiwiT2JqZWN0Iiwia2V5cyIsInNvcnQiLCJzUHJvcGVydHkiLCJyYXdNb2RlbHMiLCJmdWxsIiwiZGVzY3JpcHRpb24iLCJjYXRlZ29yaWVzIiwic1dvcmRJbmRleCIsInNFeGFjdE1hdGNoIiwiY29sdW1ucyIsImRvbWFpblN0ciIsIk1ldGFGIiwiRG9tYWluIiwidG9GdWxsU3RyaW5nIiwicmVsYXRpb25TdHIiLCJSZWxhdGlvbiIsIlJFTEFUSU9OX2hhc0NhdGVnb3J5IiwicmV2ZXJzZVJlbGF0aW9uU3RyIiwiUkVMQVRJT05faXNDYXRlZ29yeU9mIiwic0NhdGVnb3J5IiwiQ2F0ZWdvcnlTdHJpbmciLCJDYXRlZ29yeSIsIm1ldGEiLCJ0MyIsInJlcXVpcmVzIiwiZGlmZiIsImRpZmZlcmVuY2UiLCJqb2luIiwib3B0aW9uYWwiLCJzZXRzIiwic2V0SUQiLCJzZXQiLCJ0b29scyIsInRvb2xoaWRkZW4iLCJzc3lua2V5IiwiY29uY2F0Iiwic3RyaW5nIiwic3BsaXRSdWxlcyIsInJ1bGVzIiwicmVzIiwibm9uV29yZFJ1bGVzIiwid29yZE1hcCIsImFsbFJ1bGVzIiwid29yZENhY2hlIiwiY21wTGVuZ3RoU29ydCIsImEiLCJiIiwiZCIsImxvY2FsZUNvbXBhcmUiLCJEaXN0YW5jZSIsIkFsZ29sIiwiZmluZE5leHRMZW4iLCJ0YXJnZXRMZW4iLCJhcnIiLCJvZmZzZXRzIiwic2hpZnQiLCJpIiwiYWRkUmFuZ2VSdWxlc1VubGVzc1ByZXNlbnQiLCJsY3dvcmQiLCJyYW5nZVJ1bGVzIiwicHJlc2VudFJ1bGVzRm9yS2V5IiwicmFuZ2VSdWxlIiwiYXNzaWduIiwiY250IiwiYWRkQ2xvc2VFeGFjdFJhbmdlUnVsZXMiLCJrZXlzTWFwIiwicmFuZ2VLZXlzTWFwIiwibGVuIiwia2V5IiwicmFuZ2VLZXlzIiwibGFzdGxlbiIsInJhbmdlS2V5IiwiY2FsY0Rpc3RhbmNlQWRqdXN0ZWQiLCJDdXRvZmZfcmFuZ2VDbG9zZU1hdGNoIiwibiIsImxvYWRNb2RlbHMiLCJvcGVyYXRvcnMiLCJ0IiwiRGF0ZSIsIm5vdyIsImxvYWQiLCJBQk9UX0VNQUlMX1VTRVIiLCJlIiwic21kbHMiLCJtZGxzIiwibWV0YUJpdEluZGV4IiwiZmlsbGVyQml0SW5kZXgiLCJzZmlsbGVycyIsImZpbGxlcnMiLCJyZSIsInJlZ2V4cCIsIlJlZ0V4cCIsInNPcGVyYXRvcnMiLCJvcGVyYXRvckJpdEluZGV4Iiwib3BlcmF0b3IiLCJhT3BlcmF0b3JOYW1lcyIsImZyZWV6ZSIsInN5bm9ueW0iLCJjbXBNUnVsZSIsImdsb2JhbCIsImdjIiwiY21wVG9vbHMiLCJzYXZlIiwic29ydENhdGVnb3JpZXNCeUltcG9ydGFuY2UiLCJjYXRzIiwic2xpY2UiLCJyYW5rQ2F0ZWdvcnlCeUltcG9ydGFuY2UiLCJiaW5kIiwiY2F0YSIsImNhdGIiLCJjYXRBRGVzYyIsImNhdEJEZXNjIiwicHJpb0EiLCJpbXBvcnRhbmNlIiwicHJpb0IiLCJnZXRNZXRhRmFjdG9yeSIsImdldE9wZXJhdG9yIiwiZ2V0UmVzdWx0QXNBcnJheSIsInJlbCIsInRvVHlwZSIsImdldE93blByb3BlcnR5TmFtZXMiLCJwYXJzZUlNZXRhIiwiZ2V0Q2F0ZWdvcmllc0ZvckRvbWFpbiIsInRoZU1vZGVsIiwiZ2V0U3RyaW5nQXJyYXkiLCJnZXRUYWJsZUNvbHVtbnMiLCJnZXRQb3RlbnRpYWxXb3JkQ2F0ZWdvcmllc0ZvckRvbWFpbiIsImdldERvbWFpbnNGb3JDYXRlZ29yeSIsImdldEFsbFJlY29yZENhdGVnb3JpZXNGb3JUYXJnZXRDYXRlZ29yeSIsIm1vZGVsIiwid29yZHNvbmx5IiwiZm4iLCJ3b3JkY2F0IiwiZ2V0QWxsUmVjb3JkQ2F0ZWdvcmllc0ZvclRhcmdldENhdGVnb3JpZXMiLCJjYXRkb21haW5zIiwiaW50ZXJzZWN0aW9uIiwibGlzdFRvUXVvdGVkQ29tbWFBbmQiXSwibWFwcGluZ3MiOiJBQUFBOzs7OztBQ0tBOztBREVBLElBQUFBLFFBQUFDLFFBQUEsT0FBQSxDQUFBO0FBRUEsSUFBSUMsV0FBV0YsTUFBTSxPQUFOLENBQWY7QUFFQSxJQUFBRyxTQUFBRixRQUFBLGlCQUFBLENBQUE7QUFFQSxJQUFNRyxVQUFVRCxPQUFPQSxNQUFQLENBQWMsV0FBZCxFQUEyQixFQUEzQixDQUFoQjtBQUVBLElBQUFFLFNBQUFKLFFBQUEsa0JBQUEsQ0FBQTtBQUVBLElBQUFLLG1CQUFBTCxRQUFBLDJCQUFBLENBQUE7QUFDQSxJQUFBTSxRQUFBTixRQUFBLGdCQUFBLENBQUE7QUFDQSxJQUFBTyxLQUFBUCxRQUFBLElBQUEsQ0FBQTtBQUNBLElBQUFRLE9BQUFSLFFBQUEsUUFBQSxDQUFBO0FBQ0EsSUFBQVMsUUFBQVQsUUFBQSxnQkFBQSxDQUFBO0FBQ0EsSUFBQVUsY0FBQVYsUUFBQSxzQkFBQSxDQUFBO0FBRUEsSUFBQVcsVUFBQVgsUUFBQSxTQUFBLENBQUE7QUFDQSxJQUFBWSxJQUFBWixRQUFBLFFBQUEsQ0FBQTtBQUNBOzs7QUFHQSxJQUFJYSxlQUFlRixRQUFRRyxHQUFSLENBQVksZ0JBQVosS0FBaUMsV0FBcEQ7QUFvQkEsSUFBTUMsdUJBQXVCLENBQUMsUUFBRCxFQUFXLFVBQVgsRUFBdUIsa0JBQXZCLEVBQTJDLFlBQTNDLEVBQXlELG1CQUF6RCxFQUE4RSxTQUE5RSxFQUF5RixhQUF6RixFQUF3RyxNQUF4RyxFQUFnSCxZQUFoSCxFQUE4SCxVQUE5SCxFQUEwSSxVQUExSSxFQUFzSixXQUF0SixFQUFtSyxZQUFuSyxFQUFpTCxRQUFqTCxDQUE3QjtBQUVBLFNBQUFDLFdBQUEsQ0FBcUJDLFFBQXJCLEVBQXlDQyxRQUF6QyxFQUEyREMsVUFBM0QsRUFBK0VDLFFBQS9FLEVBQWlHQyxNQUFqRyxFQUE4SEMsSUFBOUgsRUFBcUs7QUFDaktMLGFBQVNNLE9BQVQsQ0FBaUIsVUFBVUMsR0FBVixFQUFhO0FBQzFCLFlBQUlDLFFBQVE7QUFDUlAsc0JBQVVBLFFBREY7QUFFUlEsMkJBQWVQLFVBRlA7QUFHUlEsa0JBQU0sQ0FIRSxDQUdGO0FBSEUsY0FJUkMsTUFBTUosR0FKRTtBQUtSSixzQkFBVUEsUUFMRjtBQU1SUyxzQkFBVTtBQU5GLFNBQVo7QUFRQTVCLGlCQUFTQSxTQUFTNkIsT0FBVCxHQUFvQixzQkFBc0JDLEtBQUtDLFNBQUwsQ0FBZVAsS0FBZixDQUExQyxHQUFtRSxHQUE1RTtBQUNBUSwrQkFBdUJaLE1BQXZCLEVBQStCSSxLQUEvQixFQUFzQ0gsSUFBdEM7QUFDSCxLQVhEO0FBWUg7QUFFRCxTQUFBWSxVQUFBLENBQW9CQyxJQUFwQixFQUF3QjtBQUNwQixRQUFJQyxLQUFLRCxLQUFLVCxhQUFMLEdBQXFCLEtBQXJCLEdBQTZCUyxLQUFLakIsUUFBbEMsR0FBNkMsT0FBN0MsR0FBdURpQixLQUFLUixJQUE1RCxHQUFtRSxPQUFuRSxHQUE2RVEsS0FBS1AsSUFBbEYsR0FBeUYsR0FBbEc7QUFDQSxRQUFJTyxLQUFLRSxLQUFULEVBQWdCO0FBQ1osWUFBSUMsS0FBS0osV0FBV0MsS0FBS0UsS0FBTCxDQUFXRixJQUF0QixDQUFUO0FBQ0FDLGNBQU0sVUFBVUQsS0FBS0UsS0FBTCxDQUFXRSxHQUFyQixHQUEyQixHQUEzQixHQUFpQ0osS0FBS0UsS0FBTCxDQUFXRyxJQUE1QyxHQUFtRCxPQUFuRCxHQUE2REYsRUFBbkU7QUFDSDtBQUNELFdBQU9GLEVBQVA7QUFDSDtBQUdELElBQUFLLFlBQUF6QyxRQUFBLG9CQUFBLENBQUE7QUFFQTtBQUNBLFNBQUEwQyxZQUFBLENBQTZCckIsTUFBN0IsRUFBMERjLElBQTFELEVBQThFUSxTQUE5RSxFQUEwSDtBQUN0SDtBQUNBO0FBQ0E7QUFFQSxRQUFJUixLQUFLUixJQUFMLEtBQWMsQ0FBbEIsQ0FBa0IsVUFBbEIsRUFBNEM7QUFDeEM7QUFDSDtBQUNELFFBQUlpQixPQUFPSCxVQUFVSSxnQkFBVixDQUEyQlYsS0FBS1csYUFBaEMsQ0FBWDtBQUNBLFFBQUksQ0FBQ0YsSUFBTCxFQUFXO0FBQ1A7QUFDSDtBQUNELFFBQUlHLFVBQVU7QUFDVjdCLGtCQUFVaUIsS0FBS2pCLFFBREw7QUFFVlEsdUJBQWVTLEtBQUtULGFBRlY7QUFHVk4sa0JBQVVlLEtBQUtmLFFBSEw7QUFJVlEsY0FBTWdCLEtBQUtJLFlBSkQ7QUFLVnJCLGNBQU0sQ0FMSTtBQU1WbUIsdUJBQWVGLEtBQUtJLFlBTlY7QUFPVm5CLGtCQUFVLElBUEE7QUFRVjtBQUNBUSxlQUFPTyxLQUFLSztBQVRGLEtBQWQ7QUFXQSxRQUFJZCxLQUFLZSxTQUFULEVBQW9CO0FBQ2hCSCxnQkFBUUcsU0FBUixHQUFvQmYsS0FBS2UsU0FBekI7QUFDSDtBQUFBO0FBQ0RILFlBQVFWLEtBQVIsQ0FBY0YsSUFBZCxHQUFxQkEsSUFBckI7QUFDQUYsMkJBQXVCWixNQUF2QixFQUErQjBCLE9BQS9CLEVBQXdDSixTQUF4QztBQUNIO0FBNUJEUSxRQUFBVCxZQUFBLEdBQUFBLFlBQUE7QUErQkEsU0FBQVQsc0JBQUEsQ0FBZ0NaLE1BQWhDLEVBQTZEYyxJQUE3RCxFQUNJUSxTQURKLEVBQ2dEO0FBRTVDLFFBQUlSLEtBQUtSLElBQUwsS0FBYyxDQUFsQixDQUFrQixVQUFsQixFQUE0QztBQUN4Q04sbUJBQU8rQixJQUFQLENBQVlqQixJQUFaO0FBQ0E7QUFDSDtBQUNELFFBQUtBLEtBQUtQLElBQUwsS0FBY3lCLFNBQWYsSUFBOEJsQixLQUFLVCxhQUFMLEtBQXVCMkIsU0FBekQsRUFBcUU7QUFDakUsY0FBTSxJQUFJQyxLQUFKLENBQVUsaUJBQWlCdkIsS0FBS0MsU0FBTCxDQUFlRyxJQUFmLEVBQXFCa0IsU0FBckIsRUFBZ0MsQ0FBaEMsQ0FBM0IsQ0FBTjtBQUNIO0FBQ0QsUUFBSUUsSUFBSXJCLFdBQVdDLElBQVgsQ0FBUjtBQUNBOzs7O0FBSUFBLFNBQUtXLGFBQUwsR0FBcUJYLEtBQUtQLElBQUwsQ0FBVTRCLFdBQVYsRUFBckI7QUFDQSxRQUFJYixVQUFVWSxDQUFWLENBQUosRUFBa0I7QUFDZHRELGlCQUFTQSxTQUFTNkIsT0FBVCxHQUFvQixtQ0FBbUNDLEtBQUtDLFNBQUwsQ0FBZUcsSUFBZixFQUFxQmtCLFNBQXJCLEVBQWdDLENBQWhDLENBQXZELEdBQTZGLEdBQXRHO0FBQ0EsWUFBSUksYUFBYWQsVUFBVVksQ0FBVixFQUFhRyxNQUFiLENBQW9CLFVBQVVDLE1BQVYsRUFBZ0I7QUFDakQsbUJBQU8sTUFBTXRELGlCQUFpQnVELGdCQUFqQixDQUFrQ0QsTUFBbEMsRUFBMEN4QixJQUExQyxDQUFiO0FBQ0gsU0FGZ0IsQ0FBakI7QUFHQSxZQUFJc0IsV0FBV0ksTUFBWCxHQUFvQixDQUF4QixFQUEyQjtBQUN2QjtBQUNIO0FBQ0o7QUFDRGxCLGNBQVVZLENBQVYsSUFBZ0JaLFVBQVVZLENBQVYsS0FBZ0IsRUFBaEM7QUFDQVosY0FBVVksQ0FBVixFQUFhSCxJQUFiLENBQWtCakIsSUFBbEI7QUFDQSxRQUFJQSxLQUFLUCxJQUFMLEtBQWMsRUFBbEIsRUFBc0I7QUFDbEIzQixpQkFBU0EsU0FBUzZCLE9BQVQsR0FBb0IsbUNBQW1DQyxLQUFLQyxTQUFMLENBQWVHLElBQWYsRUFBcUJrQixTQUFyQixFQUFnQyxDQUFoQyxDQUF2RCxHQUE2RixHQUF0RztBQUNBbEQsZ0JBQVEsbUNBQW1DNEIsS0FBS0MsU0FBTCxDQUFlRyxJQUFmLEVBQXFCa0IsU0FBckIsRUFBZ0MsQ0FBaEMsQ0FBM0M7QUFDQTtBQUNIO0FBQ0RoQyxXQUFPK0IsSUFBUCxDQUFZakIsSUFBWjtBQUNBTyxpQkFBYXJCLE1BQWIsRUFBcUJjLElBQXJCLEVBQTJCUSxTQUEzQjtBQUNBO0FBQ0g7QUFFRCxTQUFBbUIsYUFBQSxDQUF1QkMsU0FBdkIsRUFBMENDLElBQTFDLEVBQXdEQyxVQUF4RCxFQUE0RUMsTUFBNUUsRUFBa0c7QUFDOUY7QUFDQTtBQUNBLFFBQUk5QyxXQUFXNEMsS0FBSzVDLFFBQXBCO0FBQ0EsUUFBTStDLFlBQWEsT0FBT0osU0FBUCxHQUFtQixHQUFuQixHQUF5QkUsVUFBekIsR0FBc0MsWUFBekQ7QUFDQSxRQUFJRyxVQUFVN0QsR0FBRzhELFlBQUgsQ0FBZ0JGLFNBQWhCLEVBQTJCLE9BQTNCLENBQWQ7QUFDQSxRQUFJRyxXQUFXdkMsS0FBS3dDLEtBQUwsQ0FBV0gsT0FBWCxDQUFmO0FBQ0FFLGFBQVMvQyxPQUFULENBQWlCLFVBQVVvQyxNQUFWLEVBQWdCO0FBQzdCLFlBQUksQ0FBQ0EsT0FBT2EsSUFBWixFQUFrQjtBQUNkYixtQkFBT2MsT0FBUCxHQUFpQlQsS0FBS1UsTUFBdEI7QUFDSDtBQUNELFlBQUksQ0FBQ2YsT0FBT2EsSUFBUixJQUFnQlIsS0FBS1EsSUFBTCxDQUFVRyxJQUE5QixFQUFvQztBQUNoQ2hCLG1CQUFPYSxJQUFQLEdBQWNSLEtBQUtRLElBQUwsQ0FBVUcsSUFBeEI7QUFDSDtBQUNEVCxlQUFPVSxPQUFQLENBQWV4QixJQUFmLENBQW9CTyxNQUFwQjtBQUNBSyxhQUFLOUMsUUFBTCxDQUFjSyxPQUFkLENBQXNCLFVBQVVzRCxHQUFWLEVBQWE7QUFDL0IsZ0JBQUlsQixPQUFPa0IsR0FBUCxNQUFnQixXQUFwQixFQUFpQztBQUM3QmxCLHVCQUFPa0IsR0FBUCxJQUFjLEtBQWQ7QUFDQSxvQkFBSUMsTUFDQSw4QkFBOEJYLFNBQTlCLEdBQTBDLDZCQUExQyxHQUEwRVUsR0FBMUUsR0FBZ0YsK0RBQWhGLEdBQWtKOUMsS0FBS0MsU0FBTCxDQUFlMkIsTUFBZixDQUFsSixHQUEySyxFQUQvSztBQUVBMUQseUJBQVM2RSxHQUFUO0FBR0g7QUFDSixTQVREO0FBV0FkLGFBQUtlLFNBQUwsQ0FBZXhELE9BQWYsQ0FBdUIsVUFBVUwsUUFBVixFQUFrQjtBQUNyQyxnQkFBSXlDLE9BQU96QyxRQUFQLE1BQXFCbUMsU0FBekIsRUFBb0M7QUFDaENwRCx5QkFBUyw4QkFBOEJrRSxTQUE5QixHQUEwQyw2QkFBMUMsR0FBMEVqRCxRQUExRSxHQUFxRixlQUFyRixHQUF1R2EsS0FBS0MsU0FBTCxDQUFlMkIsTUFBZixDQUF2RyxHQUFnSSxFQUF6STtBQUNBO0FBQ0g7QUFDRCxnQkFBSUEsT0FBT3pDLFFBQVAsTUFBcUIsR0FBekIsRUFBOEI7QUFDMUIsb0JBQUk4RCxVQUFVckIsT0FBT3pDLFFBQVAsQ0FBZDtBQUNBakIseUJBQVMsdUJBQXVCaUIsUUFBdkIsR0FBa0MsTUFBbEMsR0FBMkM4RCxPQUFwRDtBQUNBLG9CQUFJdkQsUUFBUTtBQUNSUCw4QkFBVUEsUUFERjtBQUVSUSxtQ0FBZXNELE9BRlA7QUFHUnJELDBCQUFNLENBSEUsQ0FHRjtBQUhFLHNCQUlSQyxNQUFNb0QsT0FKRTtBQUtSNUQsOEJBQVVBLFFBTEY7QUFNUlMsOEJBQVU7QUFORixpQkFBWjtBQVFBLG9CQUFJbUMsS0FBS2lCLFVBQUwsSUFBbUJqQixLQUFLaUIsVUFBTCxDQUFnQkMsT0FBaEIsQ0FBd0JoRSxRQUF4QixLQUFxQyxDQUE1RCxFQUErRDtBQUMzRE8sMEJBQU15QixTQUFOLEdBQWtCLElBQWxCO0FBQ0g7QUFDRGpCLHVDQUF1QmlDLE9BQU83QyxNQUE5QixFQUFzQ0ksS0FBdEMsRUFBNkN5QyxPQUFPdkIsU0FBcEQ7QUFDQSxvQkFBSTJCLFNBQVNyRCxRQUFULElBQXFCcUQsU0FBU3JELFFBQVQsQ0FBa0JDLFFBQWxCLENBQXpCLEVBQXNEO0FBQ2xERixnQ0FBWXNELFNBQVNyRCxRQUFULENBQWtCQyxRQUFsQixDQUFaLEVBQXlDQSxRQUF6QyxFQUFtRDhELE9BQW5ELEVBQTRENUQsUUFBNUQsRUFBc0U4QyxPQUFPN0MsTUFBN0UsRUFBcUY2QyxPQUFPdkIsU0FBNUY7QUFDSDtBQUNELG9CQUFJZ0IsT0FBTzFDLFFBQVAsSUFBbUIwQyxPQUFPMUMsUUFBUCxDQUFnQkMsUUFBaEIsQ0FBdkIsRUFBa0Q7QUFDOUNGLGdDQUFZMkMsT0FBTzFDLFFBQVAsQ0FBZ0JDLFFBQWhCLENBQVosRUFBdUNBLFFBQXZDLEVBQWlEOEQsT0FBakQsRUFBMEQ1RCxRQUExRCxFQUFvRThDLE9BQU83QyxNQUEzRSxFQUFtRjZDLE9BQU92QixTQUExRjtBQUNIO0FBQ0o7QUFDSixTQTNCRDtBQTRCSCxLQS9DRDtBQWdESDtBQUtELFNBQUF3QyxTQUFBLENBQW1CcEIsU0FBbkIsRUFBc0NFLFVBQXRDLEVBQTBEQyxNQUExRCxFQUFnRjtBQUM1RWpFLGFBQVMsY0FBY2dFLFVBQWQsR0FBMkIsT0FBcEM7QUFDQSxRQUFJbUIsTUFBTTdFLEdBQUc4RCxZQUFILENBQWdCLE9BQU9OLFNBQVAsR0FBbUIsR0FBbkIsR0FBeUJFLFVBQXpCLEdBQXNDLGFBQXRELEVBQXFFLE9BQXJFLENBQVY7QUFDQSxRQUFJRCxPQUFPakMsS0FBS3dDLEtBQUwsQ0FBV2EsR0FBWCxDQUFYO0FBQ0FDLG1CQUFlcEIsVUFBZixFQUEyQkQsSUFBM0IsRUFBaUNFLE1BQWpDO0FBQ0FKLGtCQUFjQyxTQUFkLEVBQXlCQyxJQUF6QixFQUErQkMsVUFBL0IsRUFBMkNDLE1BQTNDO0FBQ0g7QUFFRCxTQUFBb0IsaUJBQUEsQ0FBa0NaLE1BQWxDLEVBQWtEUixNQUFsRCxFQUF3RTtBQUNwRSxRQUFJcUIsUUFBUXJCLE9BQU9zQixPQUFQLENBQWVOLE9BQWYsQ0FBdUJSLE1BQXZCLENBQVo7QUFDQSxRQUFJYSxRQUFRLENBQVosRUFBZTtBQUNYQSxnQkFBUXJCLE9BQU9zQixPQUFQLENBQWUzQixNQUF2QjtBQUNIO0FBQ0QsUUFBSTBCLFNBQVMsRUFBYixFQUFpQjtBQUNiLGNBQU0sSUFBSWpDLEtBQUosQ0FBVSx5Q0FBVixDQUFOO0FBQ0g7QUFDRCxXQUFPLFVBQVVpQyxLQUFqQjtBQUNIO0FBVERwQyxRQUFBbUMsaUJBQUEsR0FBQUEsaUJBQUE7QUFXQSxTQUFBRCxjQUFBLENBQXdCcEIsVUFBeEIsRUFBNENELElBQTVDLEVBQTBERSxNQUExRCxFQUFnRjtBQUM1RSxRQUFJdUIsdUJBQXVCLEVBQTNCO0FBQ0F6QixTQUFLNUMsUUFBTCxHQUFnQmtFLGtCQUFrQnRCLEtBQUtVLE1BQXZCLEVBQStCUixNQUEvQixDQUFoQjtBQUNBRixTQUFLMEIsaUJBQUwsR0FBeUIsRUFBekI7QUFDQTtBQUNBMUIsU0FBSzlDLFFBQUwsR0FBZ0I4QyxLQUFLOUMsUUFBTCxDQUFjeUUsR0FBZCxDQUFrQixVQUFVZCxHQUFWLEVBQWtCO0FBQ2hELFlBQUksT0FBT0EsR0FBUCxLQUFlLFFBQW5CLEVBQTZCO0FBQ3pCLG1CQUFPQSxHQUFQO0FBQ0g7QUFDRCxZQUFJLE9BQU9BLElBQUlGLElBQVgsS0FBb0IsUUFBeEIsRUFBa0M7QUFDOUJpQixvQkFBUUMsR0FBUixDQUFZLDhDQUE4QzlELEtBQUtDLFNBQUwsQ0FBZTZDLEdBQWYsQ0FBOUMsR0FBb0UsWUFBcEUsR0FBbUZaLFVBQS9GO0FBQ0F0RCxvQkFBUW1GLElBQVIsQ0FBYSxDQUFDLENBQWQ7QUFFSDtBQUNETCw2QkFBcUJaLElBQUlGLElBQXpCLElBQWlDRSxHQUFqQztBQUNBYixhQUFLMEIsaUJBQUwsQ0FBdUJ0QyxJQUF2QixDQUE0QnlCLEdBQTVCO0FBQ0EsZUFBT0EsSUFBSUYsSUFBWDtBQUNILEtBWmUsQ0FBaEI7QUFjQTtBQUNBWCxTQUFLOUMsUUFBTCxDQUFjSyxPQUFkLENBQXNCLFVBQVVMLFFBQVYsRUFBa0I7QUFDcENlLCtCQUF1QmlDLE9BQU83QyxNQUE5QixFQUFzQztBQUNsQ0gsc0JBQVUsVUFEd0I7QUFFbENRLDJCQUFlUixRQUZtQjtBQUdsQ1Msa0JBQU0sQ0FINEIsQ0FHNUI7QUFINEIsY0FJbENDLE1BQU1WLFFBSjRCO0FBS2xDNEIsMkJBQWU1QixTQUFTc0MsV0FBVCxFQUxtQjtBQU1sQ3BDLHNCQUFVNEMsS0FBSzVDLFFBTm1CO0FBT2xDUyxzQkFBVTtBQVB3QixTQUF0QyxFQVFHcUMsT0FBT3ZCLFNBUlY7QUFTSCxLQVZEO0FBWUEsUUFBSXVCLE9BQU9zQixPQUFQLENBQWVOLE9BQWYsQ0FBdUJsQixLQUFLVSxNQUE1QixLQUF1QyxDQUEzQyxFQUE4QztBQUMxQ3pFLGlCQUFTLHdCQUF3QjhCLEtBQUtDLFNBQUwsQ0FBZWdDLElBQWYsRUFBcUJYLFNBQXJCLEVBQWdDLENBQWhDLENBQWpDO0FBQ0EsY0FBTSxJQUFJQyxLQUFKLENBQVUsWUFBWVUsS0FBS1UsTUFBakIsR0FBMEIsZ0NBQTFCLEdBQTZEVCxVQUE3RCxHQUEwRSxHQUFwRixDQUFOO0FBQ0g7QUFDRDtBQUNBOEIsV0FBT0MsSUFBUCxDQUFZaEMsSUFBWixFQUFrQmlDLElBQWxCLEdBQXlCMUUsT0FBekIsQ0FBaUMsVUFBVTJFLFNBQVYsRUFBbUI7QUFDaEQsWUFBSW5GLHFCQUFxQm1FLE9BQXJCLENBQTZCZ0IsU0FBN0IsSUFBMEMsQ0FBOUMsRUFBaUQ7QUFDN0Msa0JBQU0sSUFBSTVDLEtBQUosQ0FBVSxxQkFBcUI0QyxTQUFyQixHQUFpQyxrREFBakMsR0FBc0ZsQyxLQUFLVSxNQUEzRixHQUFvRyxHQUE5RyxDQUFOO0FBQ0g7QUFDSixLQUpEO0FBS0E7QUFDQVIsV0FBT2lDLFNBQVAsQ0FBaUJuQyxLQUFLVSxNQUF0QixJQUFnQ1YsSUFBaEM7QUFFQUUsV0FBT2tDLElBQVAsQ0FBWTFCLE1BQVosQ0FBbUJWLEtBQUtVLE1BQXhCLElBQWtDO0FBQzlCMkIscUJBQWFyQyxLQUFLcUMsV0FEWTtBQUU5QkMsb0JBQVliLG9CQUZrQjtBQUc5QnJFLGtCQUFVNEMsS0FBSzVDO0FBSGUsS0FBbEM7QUFNQTtBQUdBO0FBQ0E0QyxTQUFLZSxTQUFMLEdBQWlCZixLQUFLZSxTQUFMLElBQWtCLEVBQW5DO0FBQ0FmLFNBQUtlLFNBQUwsQ0FBZXhELE9BQWYsQ0FBdUIsVUFBVWdGLFVBQVYsRUFBb0I7QUFDdkMsWUFBSXZDLEtBQUs5QyxRQUFMLENBQWNnRSxPQUFkLENBQXNCcUIsVUFBdEIsSUFBb0MsQ0FBeEMsRUFBMkM7QUFDdkMsa0JBQU0sSUFBSWpELEtBQUosQ0FBVSxzQkFBc0JpRCxVQUF0QixHQUFtQyw2QkFBbkMsR0FBbUV2QyxLQUFLVSxNQUF4RSxHQUFpRixHQUEzRixDQUFOO0FBQ0g7QUFDSixLQUpEO0FBS0FWLFNBQUtpQixVQUFMLEdBQWtCakIsS0FBS2lCLFVBQUwsSUFBbUIsRUFBckM7QUFDQWpCLFNBQUtpQixVQUFMLENBQWdCMUQsT0FBaEIsQ0FBd0IsVUFBVWlGLFdBQVYsRUFBcUI7QUFDekMsWUFBSXhDLEtBQUs5QyxRQUFMLENBQWNnRSxPQUFkLENBQXNCc0IsV0FBdEIsSUFBcUMsQ0FBekMsRUFBNEM7QUFDeEMsa0JBQU0sSUFBSWxELEtBQUosQ0FBVSx1QkFBdUJrRCxXQUF2QixHQUFxQyw2QkFBckMsR0FBcUV4QyxLQUFLVSxNQUExRSxHQUFtRixHQUE3RixDQUFOO0FBQ0g7QUFDSixLQUpEO0FBS0FWLFNBQUt5QyxPQUFMLEdBQWV6QyxLQUFLeUMsT0FBTCxJQUFnQixFQUEvQjtBQUNBekMsU0FBS3lDLE9BQUwsQ0FBYWxGLE9BQWIsQ0FBcUIsVUFBVWlGLFdBQVYsRUFBcUI7QUFDdEMsWUFBSXhDLEtBQUs5QyxRQUFMLENBQWNnRSxPQUFkLENBQXNCc0IsV0FBdEIsSUFBcUMsQ0FBekMsRUFBNEM7QUFDeEMsa0JBQU0sSUFBSWxELEtBQUosQ0FBVSxtQkFBbUJrRCxXQUFuQixHQUFpQyw2QkFBakMsR0FBaUV4QyxLQUFLVSxNQUF0RSxHQUErRSxHQUF6RixDQUFOO0FBQ0g7QUFDSixLQUpEO0FBT0E7QUFDQSxRQUFJZ0MsWUFBWUMsTUFBTUMsTUFBTixDQUFhNUMsS0FBS1UsTUFBbEIsRUFBMEJtQyxZQUExQixFQUFoQjtBQUNBLFFBQUlDLGNBQWNILE1BQU1JLFFBQU4sQ0FBZXZHLEtBQUt3RyxvQkFBcEIsRUFBMENILFlBQTFDLEVBQWxCO0FBQ0EsUUFBSUkscUJBQXFCTixNQUFNSSxRQUFOLENBQWV2RyxLQUFLMEcscUJBQXBCLEVBQTJDTCxZQUEzQyxFQUF6QjtBQUNBN0MsU0FBSzlDLFFBQUwsQ0FBY0ssT0FBZCxDQUFzQixVQUFVNEYsU0FBVixFQUFtQjtBQUVyQyxZQUFJQyxpQkFBaUJULE1BQU1VLFFBQU4sQ0FBZUYsU0FBZixFQUEwQk4sWUFBMUIsRUFBckI7QUFDQTNDLGVBQU9vRCxJQUFQLENBQVlDLEVBQVosQ0FBZWIsU0FBZixJQUE0QnhDLE9BQU9vRCxJQUFQLENBQVlDLEVBQVosQ0FBZWIsU0FBZixLQUE2QixFQUF6RDtBQUNBeEMsZUFBT29ELElBQVAsQ0FBWUMsRUFBWixDQUFlYixTQUFmLEVBQTBCSSxXQUExQixJQUF5QzVDLE9BQU9vRCxJQUFQLENBQVlDLEVBQVosQ0FBZWIsU0FBZixFQUEwQkksV0FBMUIsS0FBMEMsRUFBbkY7QUFDQTVDLGVBQU9vRCxJQUFQLENBQVlDLEVBQVosQ0FBZWIsU0FBZixFQUEwQkksV0FBMUIsRUFBdUNNLGNBQXZDLElBQXlELEVBQXpEO0FBRUFsRCxlQUFPb0QsSUFBUCxDQUFZQyxFQUFaLENBQWVILGNBQWYsSUFBaUNsRCxPQUFPb0QsSUFBUCxDQUFZQyxFQUFaLENBQWVILGNBQWYsS0FBa0MsRUFBbkU7QUFDQWxELGVBQU9vRCxJQUFQLENBQVlDLEVBQVosQ0FBZUgsY0FBZixFQUErQkgsa0JBQS9CLElBQXFEL0MsT0FBT29ELElBQVAsQ0FBWUMsRUFBWixDQUFlSCxjQUFmLEVBQStCSCxrQkFBL0IsS0FBc0QsRUFBM0c7QUFDQS9DLGVBQU9vRCxJQUFQLENBQVlDLEVBQVosQ0FBZUgsY0FBZixFQUErQkgsa0JBQS9CLEVBQW1EUCxTQUFuRCxJQUFnRSxFQUFoRTtBQUVILEtBWEQ7QUFhQTtBQUNBekUsMkJBQXVCaUMsT0FBTzdDLE1BQTlCLEVBQXNDO0FBQ2xDSCxrQkFBVSxRQUR3QjtBQUVsQ1EsdUJBQWVzQyxLQUFLVSxNQUZjO0FBR2xDL0MsY0FBTSxDQUg0QixDQUc1QjtBQUg0QixVQUlsQ0MsTUFBTW9DLEtBQUtVLE1BSnVCO0FBS2xDdEQsa0JBQVU0QyxLQUFLNUMsUUFMbUI7QUFNbENTLGtCQUFVO0FBTndCLEtBQXRDLEVBT0dxQyxPQUFPdkIsU0FQVjtBQVNBO0FBQ0EsUUFBSXFCLEtBQUtRLElBQUwsSUFBYVIsS0FBS1EsSUFBTCxDQUFVZ0QsUUFBM0IsRUFBcUM7QUFDakMsWUFBSUEsV0FBV3pCLE9BQU9DLElBQVAsQ0FBWWhDLEtBQUtRLElBQUwsQ0FBVWdELFFBQVYsSUFBc0IsRUFBbEMsQ0FBZjtBQUNBLFlBQUlDLE9BQU83RyxFQUFFOEcsVUFBRixDQUFhRixRQUFiLEVBQXVCeEQsS0FBSzlDLFFBQTVCLENBQVg7QUFDQSxZQUFJdUcsS0FBSzVELE1BQUwsR0FBYyxDQUFsQixFQUFxQjtBQUNqQitCLG9CQUFRQyxHQUFSLENBQVksTUFBSTdCLEtBQUtVLE1BQVQsR0FBZSw0Q0FBZixHQUE2RCtDLEtBQUtFLElBQUwsQ0FBVSxHQUFWLENBQTdELEdBQThFLEdBQTFGO0FBQ0FoSCxvQkFBUW1GLElBQVIsQ0FBYSxDQUFDLENBQWQ7QUFDSDtBQUNELFlBQUk4QixXQUFXN0IsT0FBT0MsSUFBUCxDQUFZaEMsS0FBS1EsSUFBTCxDQUFVb0QsUUFBdEIsQ0FBZjtBQUNBSCxlQUFPN0csRUFBRThHLFVBQUYsQ0FBYUUsUUFBYixFQUF1QjVELEtBQUs5QyxRQUE1QixDQUFQO0FBQ0EsWUFBSXVHLEtBQUs1RCxNQUFMLEdBQWMsQ0FBbEIsRUFBcUI7QUFDakIrQixvQkFBUUMsR0FBUixDQUFZLE1BQUk3QixLQUFLVSxNQUFULEdBQWUseUNBQWYsR0FBMEQrQyxLQUFLRSxJQUFMLENBQVUsR0FBVixDQUExRCxHQUEyRSxHQUF2RjtBQUNBaEgsb0JBQVFtRixJQUFSLENBQWEsQ0FBQyxDQUFkO0FBQ0g7QUFDREMsZUFBT0MsSUFBUCxDQUFZaEMsS0FBS1EsSUFBTCxDQUFVcUQsSUFBVixJQUFrQixFQUE5QixFQUFrQ3RHLE9BQWxDLENBQTBDLFVBQVV1RyxLQUFWLEVBQWU7QUFDckQsZ0JBQUlMLE9BQU83RyxFQUFFOEcsVUFBRixDQUFhMUQsS0FBS1EsSUFBTCxDQUFVcUQsSUFBVixDQUFlQyxLQUFmLEVBQXNCQyxHQUFuQyxFQUF3Qy9ELEtBQUs5QyxRQUE3QyxDQUFYO0FBQ0EsZ0JBQUl1RyxLQUFLNUQsTUFBTCxHQUFjLENBQWxCLEVBQXFCO0FBQ2pCK0Isd0JBQVFDLEdBQVIsQ0FBWSxNQUFJN0IsS0FBS1UsTUFBVCxHQUFlLDhCQUFmLEdBQThDb0QsS0FBOUMsR0FBbUQsY0FBbkQsR0FBbUVMLEtBQUtFLElBQUwsQ0FBVSxHQUFWLENBQW5FLEdBQW9GLEdBQWhHO0FBQ0FoSCx3QkFBUW1GLElBQVIsQ0FBYSxDQUFDLENBQWQ7QUFDSDtBQUNKLFNBTkQ7QUFRQTtBQUNBNUIsZUFBTzhELEtBQVAsQ0FBYXRFLE1BQWIsQ0FBb0IsVUFBVUMsTUFBVixFQUFnQjtBQUNoQyxnQkFBSUEsT0FBT2dCLElBQVAsTUFBaUJYLEtBQUtRLElBQUwsSUFBYVIsS0FBS1EsSUFBTCxDQUFVRyxJQUF4QyxDQUFKLEVBQW1EO0FBQy9DaUIsd0JBQVFDLEdBQVIsQ0FBWSxVQUFVN0IsS0FBS1EsSUFBTCxDQUFVRyxJQUFwQixHQUEyQixnQ0FBM0IsR0FBOERWLFVBQTFFO0FBQ0E7QUFDQXRELHdCQUFRbUYsSUFBUixDQUFhLENBQUMsQ0FBZDtBQUNIO0FBQ0osU0FORDtBQU9ILEtBN0JELE1BNkJPO0FBQ0g5QixhQUFLaUUsVUFBTCxHQUFrQixJQUFsQjtBQUNBakUsYUFBS1EsSUFBTCxDQUFVZ0QsUUFBVixHQUFxQixFQUFFLGNBQWMsRUFBaEIsRUFBckI7QUFDSDtBQUNEO0FBQ0EsUUFBSSxDQUFDeEQsS0FBS2lFLFVBQU4sSUFBb0JqRSxLQUFLUSxJQUF6QixJQUFpQ1IsS0FBS1EsSUFBTCxDQUFVRyxJQUEvQyxFQUFxRDtBQUNqRDFDLCtCQUF1QmlDLE9BQU83QyxNQUE5QixFQUFzQztBQUNsQ0gsc0JBQVUsTUFEd0I7QUFFbENRLDJCQUFlc0MsS0FBS1EsSUFBTCxDQUFVRyxJQUZTO0FBR2xDaEQsa0JBQU0sQ0FINEIsQ0FHNUI7QUFINEIsY0FJbENDLE1BQU1vQyxLQUFLUSxJQUFMLENBQVVHLElBSmtCO0FBS2xDdkQsc0JBQVU0QyxLQUFLNUMsUUFMbUI7QUFNbENTLHNCQUFVO0FBTndCLFNBQXRDLEVBT0dxQyxPQUFPdkIsU0FQVjtBQVFIO0FBQUE7QUFDRCxRQUFJcUIsS0FBSy9DLFFBQUwsSUFBaUIrQyxLQUFLL0MsUUFBTCxDQUFjLE1BQWQsQ0FBckIsRUFBNEM7QUFDeENELG9CQUFZZ0QsS0FBSy9DLFFBQUwsQ0FBYyxNQUFkLENBQVosRUFBbUMsTUFBbkMsRUFBMkMrQyxLQUFLUSxJQUFMLENBQVVHLElBQXJELEVBQTJEWCxLQUFLNUMsUUFBaEUsRUFBMEU4QyxPQUFPN0MsTUFBakYsRUFBeUY2QyxPQUFPdkIsU0FBaEc7QUFDSDtBQUFBO0FBQ0QsUUFBSXFCLEtBQUsvQyxRQUFULEVBQW1CO0FBQ2Y4RSxlQUFPQyxJQUFQLENBQVloQyxLQUFLL0MsUUFBakIsRUFBMkJNLE9BQTNCLENBQW1DLFVBQVUyRyxPQUFWLEVBQWlCO0FBQ2hELGdCQUFJbEUsS0FBSzlDLFFBQUwsQ0FBY2dFLE9BQWQsQ0FBc0JnRCxPQUF0QixLQUFrQyxDQUFsQyxJQUF1Q0EsWUFBWSxNQUF2RCxFQUErRDtBQUMzRCxvQkFBSWhFLE9BQU9rQyxJQUFQLENBQVkxQixNQUFaLENBQW1CVixLQUFLVSxNQUF4QixFQUFnQzRCLFVBQWhDLENBQTJDNEIsT0FBM0MsQ0FBSixFQUF5RDtBQUNyRGhFLDJCQUFPa0MsSUFBUCxDQUFZMUIsTUFBWixDQUFtQlYsS0FBS1UsTUFBeEIsRUFBZ0M0QixVQUFoQyxDQUEyQzRCLE9BQTNDLEVBQW9EakgsUUFBcEQsR0FBK0QrQyxLQUFLL0MsUUFBTCxDQUFjaUgsT0FBZCxDQUEvRDtBQUNIO0FBRURsSCw0QkFBWWdELEtBQUsvQyxRQUFMLENBQWNpSCxPQUFkLENBQVosRUFBb0MsVUFBcEMsRUFBZ0RBLE9BQWhELEVBQXlEbEUsS0FBSzVDLFFBQTlELEVBQXdFOEMsT0FBTzdDLE1BQS9FLEVBQXVGNkMsT0FBT3ZCLFNBQTlGO0FBQ0g7QUFDSixTQVJEO0FBU0g7QUFDRHVCLFdBQU9zQixPQUFQLENBQWVwQyxJQUFmLENBQW9CWSxLQUFLVSxNQUF6QjtBQUNBLFFBQUlWLEtBQUtRLElBQUwsQ0FBVUcsSUFBZCxFQUFvQjtBQUNoQlQsZUFBTzhELEtBQVAsQ0FBYTVFLElBQWIsQ0FBa0JZLEtBQUtRLElBQXZCO0FBQ0g7QUFDRE4sV0FBT2hELFFBQVAsR0FBa0JnRCxPQUFPaEQsUUFBUCxDQUFnQmlILE1BQWhCLENBQXVCbkUsS0FBSzlDLFFBQTVCLENBQWxCO0FBQ0FnRCxXQUFPaEQsUUFBUCxDQUFnQitFLElBQWhCO0FBQ0EvQixXQUFPaEQsUUFBUCxHQUFrQmdELE9BQU9oRCxRQUFQLENBQWdCd0MsTUFBaEIsQ0FBdUIsVUFBVTBFLE1BQVYsRUFBa0I3QyxLQUFsQixFQUF1QjtBQUM1RCxlQUFPckIsT0FBT2hELFFBQVAsQ0FBZ0JxRSxLQUFoQixNQUEyQnJCLE9BQU9oRCxRQUFQLENBQWdCcUUsUUFBUSxDQUF4QixDQUFsQztBQUNILEtBRmlCLENBQWxCO0FBSUgsQyxDQUFDO0FBRUYsU0FBQThDLFVBQUEsQ0FBMkJDLEtBQTNCLEVBQWdEO0FBQzVDLFFBQUlDLE1BQU0sRUFBVjtBQUNBLFFBQUlDLGVBQWUsRUFBbkI7QUFDQUYsVUFBTS9HLE9BQU4sQ0FBYyxVQUFVWSxJQUFWLEVBQWM7QUFDeEIsWUFBSUEsS0FBS1IsSUFBTCxLQUFjLENBQWxCLENBQWtCLFVBQWxCLEVBQTRDO0FBQ3hDLG9CQUFJLENBQUNRLEtBQUtXLGFBQVYsRUFBeUI7QUFDckIsMEJBQU0sSUFBSVEsS0FBSixDQUFVLHFDQUFxQ3ZCLEtBQUtDLFNBQUwsQ0FBZUcsSUFBZixDQUEvQyxDQUFOO0FBQ0g7QUFDRG9HLG9CQUFJcEcsS0FBS1csYUFBVCxJQUEwQnlGLElBQUlwRyxLQUFLVyxhQUFULEtBQTJCLEVBQUUxQixVQUFVLENBQVosRUFBZWtILE9BQU8sRUFBdEIsRUFBckQ7QUFDQUMsb0JBQUlwRyxLQUFLVyxhQUFULEVBQXdCMUIsUUFBeEIsR0FBbUNtSCxJQUFJcEcsS0FBS1csYUFBVCxFQUF3QjFCLFFBQXhCLEdBQW1DZSxLQUFLZixRQUEzRTtBQUNBbUgsb0JBQUlwRyxLQUFLVyxhQUFULEVBQXdCd0YsS0FBeEIsQ0FBOEJsRixJQUE5QixDQUFtQ2pCLElBQW5DO0FBQ0gsYUFQRCxNQU9PO0FBQ0hxRyx5QkFBYXBGLElBQWIsQ0FBa0JqQixJQUFsQjtBQUNIO0FBQ0osS0FYRDtBQVlBLFdBQU87QUFDSHNHLGlCQUFTRixHQUROO0FBRUhDLHNCQUFjQSxZQUZYO0FBR0hFLGtCQUFVSixLQUhQO0FBSUhLLG1CQUFZO0FBSlQsS0FBUDtBQU1IO0FBckJEeEYsUUFBQWtGLFVBQUEsR0FBQUEsVUFBQTtBQXVCQSxTQUFBTyxhQUFBLENBQXVCQyxDQUF2QixFQUFrQ0MsQ0FBbEMsRUFBMkM7QUFDdkMsUUFBSUMsSUFBSUYsRUFBRWhGLE1BQUYsR0FBV2lGLEVBQUVqRixNQUFyQjtBQUNBLFFBQUlrRixDQUFKLEVBQU87QUFDSCxlQUFPQSxDQUFQO0FBQ0g7QUFDRCxXQUFPRixFQUFFRyxhQUFGLENBQWdCRixDQUFoQixDQUFQO0FBQ0g7QUFFRCxJQUFBRyxXQUFBakosUUFBQSw2QkFBQSxDQUFBO0FBQ0EsSUFBQWtKLFFBQUFsSixRQUFBLGdCQUFBLENBQUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFFQSxTQUFBbUosV0FBQSxDQUE0QkMsU0FBNUIsRUFBK0NDLEdBQS9DLEVBQThEQyxPQUE5RCxFQUErRTtBQUMzRUEsWUFBUUMsS0FBUjtBQUNBLFNBQUssSUFBSUMsSUFBSUYsUUFBUSxDQUFSLENBQWIsRUFBMEJFLElBQUlILElBQUl4RixNQUFULElBQXFCd0YsSUFBSUcsQ0FBSixFQUFPM0YsTUFBUCxJQUFpQnVGLFNBQS9ELEVBQTJFLEVBQUVJLENBQTdFLEVBQWdGLENBRS9FO0FBQ0Q7QUFDQUYsWUFBUWxHLElBQVIsQ0FBYW9HLENBQWI7QUFDSDtBQVBEckcsUUFBQWdHLFdBQUEsR0FBQUEsV0FBQTtBQVNBLFNBQUFNLDBCQUFBLENBQTJDbkIsS0FBM0MsRUFBa0VvQixNQUFsRSxFQUFrRkMsVUFBbEYsRUFBOEdDLGtCQUE5RyxFQUFrSmpILFNBQWxKLEVBQTJKO0FBQ3ZKZ0gsZUFBV3BJLE9BQVgsQ0FBbUIsVUFBQXNJLFNBQUEsRUFBUztBQUN4QixZQUFJOUcsVUFBVWdELE9BQU8rRCxNQUFQLENBQWMsRUFBZCxFQUFrQkQsU0FBbEIsQ0FBZDtBQUNBOUcsZ0JBQVFELGFBQVIsR0FBd0I0RyxNQUF4QjtBQUNBM0csZ0JBQVFuQixJQUFSLEdBQWU4SCxNQUFmO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSxZQUFJSyxNQUFNekIsTUFBTXpFLE1BQWhCO0FBQ0E1QiwrQkFBdUJxRyxLQUF2QixFQUE4QnZGLE9BQTlCLEVBQXVDSixTQUF2QztBQUNILEtBVkQ7QUFXSDtBQVpEUSxRQUFBc0csMEJBQUEsR0FBQUEsMEJBQUE7QUFlQSxTQUFBTyx1QkFBQSxDQUF3QzFCLEtBQXhDLEVBQStEM0YsU0FBL0QsRUFBd0U7QUFDcEUsUUFBSXNILFVBQVUsRUFBZDtBQUNBLFFBQUlDLGVBQWUsRUFBbkI7QUFDQTVCLFVBQU0vRyxPQUFOLENBQWMsVUFBQVksSUFBQSxFQUFJO0FBQ2QsWUFBSUEsS0FBS1IsSUFBTCxLQUFjLENBQWxCLENBQWtCLFVBQWxCLEVBQTRDO0FBQ3hDO0FBQ0FzSSx3QkFBUTlILEtBQUtXLGFBQWIsSUFBOEJtSCxRQUFROUgsS0FBS1csYUFBYixLQUErQixFQUE3RDtBQUNBbUgsd0JBQVE5SCxLQUFLVyxhQUFiLEVBQTRCTSxJQUE1QixDQUFpQ2pCLElBQWpDO0FBQ0Esb0JBQUksQ0FBQ0EsS0FBS2UsU0FBTixJQUFtQmYsS0FBS0UsS0FBNUIsRUFBbUM7QUFDL0I2SCxpQ0FBYS9ILEtBQUtXLGFBQWxCLElBQW1Db0gsYUFBYS9ILEtBQUtXLGFBQWxCLEtBQW9DLEVBQXZFO0FBQ0FvSCxpQ0FBYS9ILEtBQUtXLGFBQWxCLEVBQWlDTSxJQUFqQyxDQUFzQ2pCLElBQXRDO0FBQ0g7QUFDSjtBQUNKLEtBVkQ7QUFXQSxRQUFJNkQsT0FBT0QsT0FBT0MsSUFBUCxDQUFZaUUsT0FBWixDQUFYO0FBQ0FqRSxTQUFLQyxJQUFMLENBQVUyQyxhQUFWO0FBQ0EsUUFBSXVCLE1BQU0sQ0FBVjtBQUNBbkUsU0FBS3pFLE9BQUwsQ0FBYSxVQUFDNkksR0FBRCxFQUFNN0UsS0FBTixFQUFXO0FBQ3BCLFlBQUk2RSxJQUFJdkcsTUFBSixJQUFjc0csR0FBbEIsRUFBdUIsQ0FFdEI7QUFDREEsY0FBTUMsSUFBSXZHLE1BQVY7QUFDSCxLQUxEO0FBTUE7QUFDQSxRQUFJd0csWUFBWXRFLE9BQU9DLElBQVAsQ0FBWWtFLFlBQVosQ0FBaEI7QUFDQUcsY0FBVXBFLElBQVYsQ0FBZTJDLGFBQWY7QUFDQTtBQUNBLFFBQUlyRyxNQUFNLENBQVY7QUFDQSxRQUFJQyxPQUFPLENBQVg7QUFDQSxRQUFJOEgsVUFBVSxDQUFkO0FBQ0EsUUFBSWhCLFVBQVUsQ0FBQyxDQUFELEVBQUksQ0FBSixFQUFPLENBQVAsRUFBVSxDQUFWLEVBQWEsQ0FBYixFQUFnQixDQUFoQixDQUFkO0FBQ0EsUUFBSWEsTUFBTUUsVUFBVXhHLE1BQXBCO0FBQ0FzRixnQkFBWSxDQUFaLEVBQWVuRCxJQUFmLEVBQXFCc0QsT0FBckI7QUFDQUgsZ0JBQVksQ0FBWixFQUFlbkQsSUFBZixFQUFxQnNELE9BQXJCO0FBQ0FILGdCQUFZLENBQVosRUFBZW5ELElBQWYsRUFBcUJzRCxPQUFyQjtBQUVBZSxjQUFVOUksT0FBVixDQUFrQixVQUFVZ0osUUFBVixFQUFrQjtBQUNoQyxZQUFJQSxTQUFTMUcsTUFBVCxLQUFvQnlHLE9BQXhCLEVBQWlDO0FBQzdCLGlCQUFLZCxJQUFJYyxVQUFVLENBQW5CLEVBQXNCZCxLQUFLZSxTQUFTMUcsTUFBcEMsRUFBNEMsRUFBRTJGLENBQTlDLEVBQWlEO0FBQzdDTCw0QkFBWUssSUFBSSxDQUFoQixFQUFtQnhELElBQW5CLEVBQXlCc0QsT0FBekI7QUFDSDtBQUNEO0FBQ0E7QUFDQTtBQUNBO0FBQ0FnQixzQkFBVUMsU0FBUzFHLE1BQW5CO0FBQ0g7QUFDRCxhQUFLLElBQUkyRixJQUFJRixRQUFRLENBQVIsQ0FBYixFQUF5QkUsSUFBSUYsUUFBUSxDQUFSLENBQTdCLEVBQXlDLEVBQUVFLENBQTNDLEVBQThDO0FBQzFDLGdCQUFJVCxJQUFJRSxTQUFTdUIsb0JBQVQsQ0FBOEJELFFBQTlCLEVBQXdDdkUsS0FBS3dELENBQUwsQ0FBeEMsQ0FBUjtBQUNBO0FBQ0EsZ0JBQUtULE1BQU0sR0FBUCxJQUFnQkEsS0FBS0csTUFBTXVCLHNCQUEvQixFQUF3RDtBQUNwRDtBQUNBLG9CQUFJVixNQUFNekIsTUFBTXpFLE1BQWhCO0FBQ0E7QUFDQTRGLDJDQUEyQm5CLEtBQTNCLEVBQWtDdEMsS0FBS3dELENBQUwsQ0FBbEMsRUFBMkNVLGFBQWFLLFFBQWIsQ0FBM0MsRUFBbUVOLFFBQVFqRSxLQUFLd0QsQ0FBTCxDQUFSLENBQW5FLEVBQXFGN0csU0FBckY7QUFDQSxvQkFBSTJGLE1BQU16RSxNQUFOLEdBQWVrRyxHQUFuQixFQUF3QixDQUV2QjtBQUVKO0FBQ0o7QUFDSixLQXpCRDtBQTBCQTs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQW9CSDtBQWxGRDVHLFFBQUE2Ryx1QkFBQSxHQUFBQSx1QkFBQTtBQW1GQSxJQUFJVSxJQUFJLENBQVI7QUFFQSxTQUFBQyxVQUFBLENBQTJCNUcsU0FBM0IsRUFBNkM7QUFDekMsUUFBSUcsTUFBSjtBQUNBQSxhQUFTO0FBQ0xrQyxjQUFNLEVBQUUxQixRQUFRLEVBQVYsRUFERDtBQUVMeUIsbUJBQVcsRUFGTjtBQUdMWCxpQkFBUyxFQUhKO0FBSUx3QyxlQUFPLEVBSkY7QUFLTE0sZUFBT2pGLFNBTEY7QUFNTG5DLGtCQUFVLEVBTkw7QUFPTDBKLG1CQUFXLEVBUE47QUFRTHZKLGdCQUFRLEVBUkg7QUFTTHNCLG1CQUFXLEVBVE47QUFVTGlDLGlCQUFTLEVBVko7QUFXTDBDLGNBQU0sRUFBRUMsSUFBSSxFQUFOO0FBWEQsS0FBVDtBQWFBLFFBQUlzRCxJQUFJQyxLQUFLQyxHQUFMLEVBQVI7QUFDQWhILGdCQUFZQSxhQUFhbEQsWUFBekI7QUFFQSxRQUFJO0FBQ0EsWUFBSWdJLElBQUluSSxZQUFZc0ssSUFBWixDQUFpQixPQUFPakgsU0FBUCxHQUFtQixpQkFBcEMsQ0FBUjtBQUNBO0FBQ0E7QUFDQSxZQUFJOEUsQ0FBSixFQUFPO0FBQ0g1SSxxQkFBUywwQkFBVDtBQUNBLGdCQUFJVSxRQUFRRyxHQUFSLENBQVltSyxlQUFoQixFQUFpQztBQUM3QnJGLHdCQUFRQyxHQUFSLENBQVksa0NBQWtDaUYsS0FBS0MsR0FBTCxLQUFhRixDQUEvQyxJQUFvRCxHQUFoRTtBQUNIO0FBQ0QsbUJBQU9oQyxDQUFQO0FBQ0g7QUFDSixLQVhELENBV0UsT0FBT3FDLENBQVAsRUFBVSxDQUdYO0FBQ0QsUUFBSUMsUUFBUTVLLEdBQUc4RCxZQUFILENBQWdCLE9BQU9OLFNBQVAsR0FBbUIsY0FBbkMsRUFBbUQsT0FBbkQsQ0FBWjtBQUNBLFFBQUlxSCxPQUFPckosS0FBS3dDLEtBQUwsQ0FBVyxLQUFLNEcsS0FBaEIsQ0FBWDtBQUNBQyxTQUFLN0osT0FBTCxDQUFhLFVBQVUwQyxVQUFWLEVBQW9CO0FBQzdCa0Isa0JBQVVwQixTQUFWLEVBQXFCRSxVQUFyQixFQUFpQ0MsTUFBakM7QUFDSCxLQUZEO0FBSUE7QUFDQTs7Ozs7Ozs7Ozs7OztBQWNBLFFBQUltSCxlQUFlL0Ysa0JBQWtCLE1BQWxCLEVBQTBCcEIsTUFBMUIsQ0FBbkI7QUFFQTtBQUNBakMsMkJBQXVCaUMsT0FBTzdDLE1BQTlCLEVBQXNDO0FBQ2xDSCxrQkFBVSxNQUR3QjtBQUVsQ1EsdUJBQWUsUUFGbUI7QUFHbENDLGNBQU0sQ0FINEIsQ0FHNUI7QUFINEIsVUFJbENDLE1BQU0sUUFKNEI7QUFLbENSLGtCQUFVaUssWUFMd0I7QUFNbEN4SixrQkFBVTtBQU53QixLQUF0QyxFQU9HcUMsT0FBT3ZCLFNBUFY7QUFVQSxRQUFJMkksaUJBQWlCaEcsa0JBQWtCLE1BQWxCLEVBQTBCcEIsTUFBMUIsQ0FBckI7QUFDQTtBQUNBLFFBQUlxSCxXQUFXaEwsR0FBRzhELFlBQUgsQ0FBZ0IsT0FBT04sU0FBUCxHQUFtQixjQUFuQyxFQUFtRCxPQUFuRCxDQUFmO0FBQ0EsUUFBSXlILFVBQVV6SixLQUFLd0MsS0FBTCxDQUFXZ0gsUUFBWCxDQUFkO0FBQ0EsUUFBSUUsS0FBSyxRQUFRRCxRQUFRN0QsSUFBUixDQUFhLEtBQWIsQ0FBUixHQUE4QixLQUF2QztBQUNBekQsV0FBTzdDLE1BQVAsQ0FBYytCLElBQWQsQ0FBbUI7QUFDZmxDLGtCQUFVLFFBREs7QUFFZlMsY0FBTSxDQUZTLENBRVQ7QUFGUyxVQUdmK0osUUFBUSxJQUFJQyxNQUFKLENBQVdGLEVBQVgsRUFBZSxHQUFmLENBSE87QUFJZi9KLHVCQUFlLFFBSkE7QUFLZk4sa0JBQVVrSyxjQUxLO0FBTWZ6SixrQkFBVTtBQU5LLEtBQW5CO0FBU0E7QUFDQSxRQUFJK0osYUFBYXJMLEdBQUc4RCxZQUFILENBQWdCLGtDQUFoQixFQUFvRCxPQUFwRCxDQUFqQjtBQUNBLFFBQUl1RyxZQUFZN0ksS0FBS3dDLEtBQUwsQ0FBV3FILFVBQVgsQ0FBaEI7QUFDQSxRQUFJQyxtQkFBbUJ2RyxrQkFBa0IsV0FBbEIsRUFBK0JwQixNQUEvQixDQUF2QjtBQUNBNkIsV0FBT0MsSUFBUCxDQUFZNEUsVUFBVUEsU0FBdEIsRUFBaUNySixPQUFqQyxDQUF5QyxVQUFVdUssUUFBVixFQUFrQjtBQUN2RCxZQUFJMUwsT0FBTzJMLGNBQVAsQ0FBc0I3RyxPQUF0QixDQUE4QjRHLFFBQTlCLElBQTBDLENBQTlDLEVBQWlEO0FBQzdDN0wscUJBQVMsc0JBQXNCNkwsUUFBL0I7QUFDQSxrQkFBTSxJQUFJeEksS0FBSixDQUFVLHNCQUFzQndJLFFBQWhDLENBQU47QUFDSDtBQUNENUgsZUFBTzBHLFNBQVAsQ0FBaUJrQixRQUFqQixJQUE2QmxCLFVBQVVBLFNBQVYsQ0FBb0JrQixRQUFwQixDQUE3QjtBQUNBNUgsZUFBTzBHLFNBQVAsQ0FBaUJrQixRQUFqQixFQUEyQkEsUUFBM0IsR0FBMkRBLFFBQTNEO0FBQ0EvRixlQUFPaUcsTUFBUCxDQUFjOUgsT0FBTzBHLFNBQVAsQ0FBaUJrQixRQUFqQixDQUFkO0FBQ0EsWUFBSWxLLE9BQU9rSyxRQUFYO0FBQ0E3SiwrQkFBdUJpQyxPQUFPN0MsTUFBOUIsRUFBc0M7QUFDbENILHNCQUFVLFVBRHdCO0FBRWxDVSxrQkFBTUEsS0FBSzRCLFdBQUwsRUFGNEI7QUFHbENWLDJCQUFlbEIsS0FBSzRCLFdBQUwsRUFIbUI7QUFJbEM3QixrQkFBTSxDQUo0QixDQUk1QjtBQUo0QixjQUtsQ0QsZUFBZUUsSUFMbUI7QUFNbENSLHNCQUFVeUssZ0JBTndCO0FBT2xDaEssc0JBQVU7QUFQd0IsU0FBdEMsRUFRR3FDLE9BQU92QixTQVJWO0FBU0E7QUFDQSxZQUFJaUksVUFBVTNKLFFBQVYsQ0FBbUI2SyxRQUFuQixDQUFKLEVBQWtDO0FBQzlCL0YsbUJBQU9DLElBQVAsQ0FBWTRFLFVBQVUzSixRQUFWLENBQW1CNkssUUFBbkIsQ0FBWixFQUEwQ3ZLLE9BQTFDLENBQWtELFVBQVUwSyxPQUFWLEVBQWlCO0FBQy9EaEssdUNBQXVCaUMsT0FBTzdDLE1BQTlCLEVBQXNDO0FBQ2xDSCw4QkFBVSxVQUR3QjtBQUVsQ1UsMEJBQU1xSyxRQUFRekksV0FBUixFQUY0QjtBQUdsQ1YsbUNBQWVtSixRQUFRekksV0FBUixFQUhtQjtBQUlsQzdCLDBCQUFNLENBSjRCLENBSTVCO0FBSjRCLHNCQUtsQ0QsZUFBZW9LLFFBTG1CO0FBTWxDMUssOEJBQVV5SyxnQkFOd0I7QUFPbENoSyw4QkFBVTtBQVB3QixpQkFBdEMsRUFRR3FDLE9BQU92QixTQVJWO0FBU0gsYUFWRDtBQVdIO0FBQ0osS0FoQ0Q7QUFpQ0E7Ozs7Ozs7Ozs7QUFVQXVCLFdBQU83QyxNQUFQLEdBQWdCNkMsT0FBTzdDLE1BQVAsQ0FBYzRFLElBQWQsQ0FBbUI1RixpQkFBaUI2TCxRQUFwQyxDQUFoQjtBQUNBbEMsNEJBQXdCOUYsT0FBTzdDLE1BQS9CLEVBQXVDNkMsT0FBT3ZCLFNBQTlDO0FBQ0F1QixXQUFPN0MsTUFBUCxHQUFnQjZDLE9BQU83QyxNQUFQLENBQWM0RSxJQUFkLENBQW1CNUYsaUJBQWlCNkwsUUFBcEMsQ0FBaEI7QUFDQSxRQUFJQyxVQUFVQSxPQUFPQyxFQUFyQixFQUF5QjtBQUNyQkQsZUFBT0MsRUFBUDtBQUNIO0FBQ0RsSSxXQUFPb0UsS0FBUCxHQUFlRCxXQUFXbkUsT0FBTzdDLE1BQWxCLENBQWY7QUFDQSxRQUFJOEssVUFBVUEsT0FBT0MsRUFBckIsRUFBeUI7QUFDckJELGVBQU9DLEVBQVA7QUFDSDtBQUNEbEksV0FBTzhELEtBQVAsR0FBZTlELE9BQU84RCxLQUFQLENBQWEvQixJQUFiLENBQWtCM0YsTUFBTStMLFFBQXhCLENBQWY7QUFDQSxXQUFPbkksT0FBT3ZCLFNBQWQ7QUFDQTFDLGFBQVMsUUFBVDtBQUNBLFFBQUlrTSxVQUFVQSxPQUFPQyxFQUFyQixFQUF5QjtBQUNyQkQsZUFBT0MsRUFBUDtBQUNIO0FBQ0QxTCxnQkFBWTRMLElBQVosQ0FBaUIsT0FBT3ZJLFNBQVAsR0FBbUIsaUJBQXBDLEVBQXVERyxNQUF2RDtBQUNBLFFBQUlpSSxVQUFVQSxPQUFPQyxFQUFyQixFQUF5QjtBQUNyQkQsZUFBT0MsRUFBUDtBQUNIO0FBQ0QsUUFBSXpMLFFBQVFHLEdBQVIsQ0FBWW1LLGVBQWhCLEVBQWlDO0FBQzdCckYsZ0JBQVFDLEdBQVIsQ0FBWSxzQ0FBc0NpRixLQUFLQyxHQUFMLEtBQWFGLENBQW5ELElBQXdELEdBQXBFO0FBQ0g7QUFDRCxXQUFPM0csTUFBUDtBQUNIO0FBeEpEZixRQUFBd0gsVUFBQSxHQUFBQSxVQUFBO0FBMEpBLFNBQUE0QiwwQkFBQSxDQUEyQzVHLEdBQTNDLEVBQXlGNkcsSUFBekYsRUFBdUc7QUFDbkcsUUFBSWpFLE1BQU1pRSxLQUFLQyxLQUFMLENBQVcsQ0FBWCxDQUFWO0FBQ0FsRSxRQUFJdEMsSUFBSixDQUFTeUcseUJBQXlCQyxJQUF6QixDQUE4QnRKLFNBQTlCLEVBQXlDc0MsR0FBekMsQ0FBVDtBQUNBLFdBQU80QyxHQUFQO0FBQ0g7QUFKRHBGLFFBQUFvSiwwQkFBQSxHQUFBQSwwQkFBQTtBQU1BLFNBQUFHLHdCQUFBLENBQXlDL0csR0FBekMsRUFBdUZpSCxJQUF2RixFQUFxR0MsSUFBckcsRUFBaUg7QUFDN0csUUFBSUMsV0FBV25ILElBQUlpSCxJQUFKLENBQWY7QUFDQSxRQUFJRyxXQUFXcEgsSUFBSWtILElBQUosQ0FBZjtBQUNBLFFBQUlELFNBQVNDLElBQWIsRUFBbUI7QUFDZixlQUFPLENBQVA7QUFDSDtBQUNEO0FBQ0EsUUFBSUMsWUFBWSxDQUFDQyxRQUFqQixFQUEyQjtBQUN2QixlQUFPLENBQUMsQ0FBUjtBQUNIO0FBQ0QsUUFBSSxDQUFDRCxRQUFELElBQWFDLFFBQWpCLEVBQTJCO0FBQ3ZCLGVBQU8sQ0FBQyxDQUFSO0FBQ0g7QUFFRCxRQUFJQyxRQUFTRixZQUFZQSxTQUFTRyxVQUF0QixJQUFxQyxFQUFqRDtBQUNBLFFBQUlDLFFBQVNILFlBQVlBLFNBQVNFLFVBQXRCLElBQXFDLEVBQWpEO0FBQ0E7QUFDQSxRQUFJMUosSUFBSXlKLFFBQVFFLEtBQWhCO0FBQ0EsUUFBSTNKLENBQUosRUFBTztBQUNILGVBQU9BLENBQVA7QUFDSDtBQUNELFdBQU9xSixLQUFLNUQsYUFBTCxDQUFtQjZELElBQW5CLENBQVA7QUFDSDtBQXRCRDFKLFFBQUF1Six3QkFBQSxHQUFBQSx3QkFBQTtBQXdCQSxJQUFNL0YsUUFBUW5HLEtBQUsyTSxjQUFMLEVBQWQ7QUFFQSxTQUFBQyxXQUFBLENBQTRCaEksR0FBNUIsRUFBaUQwRyxRQUFqRCxFQUFpRTtBQUM3RCxXQUFPMUcsSUFBSXdGLFNBQUosQ0FBY2tCLFFBQWQsQ0FBUDtBQUNIO0FBRkQzSSxRQUFBaUssV0FBQSxHQUFBQSxXQUFBO0FBSUEsU0FBQUMsZ0JBQUEsQ0FBaUNqSSxHQUFqQyxFQUFzRHlELENBQXRELEVBQXFFeUUsR0FBckUsRUFBb0Y7QUFDaEYsUUFBSUEsSUFBSUMsTUFBSixPQUFpQixVQUFyQixFQUFpQztBQUM3QixjQUFNLElBQUlqSyxLQUFKLENBQVUsNEJBQVYsQ0FBTjtBQUNIO0FBRUQsUUFBSWlGLE1BQU1uRCxJQUFJa0MsSUFBSixDQUFTQyxFQUFULENBQVlzQixFQUFFaEMsWUFBRixFQUFaLEtBQ056QixJQUFJa0MsSUFBSixDQUFTQyxFQUFULENBQVlzQixFQUFFaEMsWUFBRixFQUFaLEVBQThCeUcsSUFBSXpHLFlBQUosRUFBOUIsQ0FESjtBQUVBLFFBQUksQ0FBQzBCLEdBQUwsRUFBVTtBQUNOLGVBQU8sRUFBUDtBQUNIO0FBQ0QsV0FBT3hDLE9BQU95SCxtQkFBUCxDQUEyQmpGLEdBQTNCLEVBQWdDdEMsSUFBaEMsR0FBdUNOLEdBQXZDLENBQTJDZ0IsTUFBTThHLFVBQWpELENBQVA7QUFDSDtBQVhEdEssUUFBQWtLLGdCQUFBLEdBQUFBLGdCQUFBO0FBYUEsU0FBQUssc0JBQUEsQ0FBdUNDLFFBQXZDLEVBQWlFakosTUFBakUsRUFBK0U7QUFDM0UsUUFBSWlKLFNBQVNuSSxPQUFULENBQWlCTixPQUFqQixDQUF5QlIsTUFBekIsSUFBbUMsQ0FBdkMsRUFBMEM7QUFDdEMsY0FBTSxJQUFJcEIsS0FBSixDQUFVLGNBQWNvQixNQUFkLEdBQXVCLHNCQUFqQyxDQUFOO0FBQ0g7QUFDRCxRQUFJNkQsTUFBTThFLGlCQUFpQk0sUUFBakIsRUFBMkJoSCxNQUFNQyxNQUFOLENBQWFsQyxNQUFiLENBQTNCLEVBQWlEaUMsTUFBTUksUUFBTixDQUFldkcsS0FBS3dHLG9CQUFwQixDQUFqRCxDQUFWO0FBQ0EsV0FBT3hHLEtBQUtvTixjQUFMLENBQW9CckYsR0FBcEIsQ0FBUDtBQUNIO0FBTkRwRixRQUFBdUssc0JBQUEsR0FBQUEsc0JBQUE7QUFRQSxTQUFBRyxlQUFBLENBQWdDRixRQUFoQyxFQUEwRGpKLE1BQTFELEVBQXdFO0FBQ3BFLFFBQUlpSixTQUFTbkksT0FBVCxDQUFpQk4sT0FBakIsQ0FBeUJSLE1BQXpCLElBQW1DLENBQXZDLEVBQTBDO0FBQ3RDLGNBQU0sSUFBSXBCLEtBQUosQ0FBVSxjQUFjb0IsTUFBZCxHQUF1QixzQkFBakMsQ0FBTjtBQUNIO0FBQ0QsV0FBT2lKLFNBQVN4SCxTQUFULENBQW1CekIsTUFBbkIsRUFBMkIrQixPQUEzQixDQUFtQ2dHLEtBQW5DLENBQXlDLENBQXpDLENBQVA7QUFDSDtBQUxEdEosUUFBQTBLLGVBQUEsR0FBQUEsZUFBQTtBQVFBOzs7Ozs7QUFNQSxTQUFBQyxtQ0FBQSxDQUFvREgsUUFBcEQsRUFBOEVqSixNQUE5RSxFQUE0RjtBQUN4RjtBQUNBLFdBQU9nSix1QkFBdUJDLFFBQXZCLEVBQWlDakosTUFBakMsQ0FBUDtBQUNIO0FBSER2QixRQUFBMkssbUNBQUEsR0FBQUEsbUNBQUE7QUFLQSxTQUFBQyxxQkFBQSxDQUFzQ0osUUFBdEMsRUFBZ0V6TSxRQUFoRSxFQUFnRjtBQUM1RSxRQUFJeU0sU0FBU3pNLFFBQVQsQ0FBa0JnRSxPQUFsQixDQUEwQmhFLFFBQTFCLElBQXNDLENBQTFDLEVBQTZDO0FBQ3pDLGNBQU0sSUFBSW9DLEtBQUosQ0FBVSxnQkFBZ0JwQyxRQUFoQixHQUEyQixzQkFBckMsQ0FBTjtBQUNIO0FBQ0QsUUFBSXFILE1BQU04RSxpQkFBaUJNLFFBQWpCLEVBQTJCaEgsTUFBTVUsUUFBTixDQUFlbkcsUUFBZixDQUEzQixFQUFxRHlGLE1BQU1JLFFBQU4sQ0FBZXZHLEtBQUswRyxxQkFBcEIsQ0FBckQsQ0FBVjtBQUNBLFdBQU8xRyxLQUFLb04sY0FBTCxDQUFvQnJGLEdBQXBCLENBQVA7QUFDSDtBQU5EcEYsUUFBQTRLLHFCQUFBLEdBQUFBLHFCQUFBO0FBU0EsU0FBQUMsdUNBQUEsQ0FBd0RDLEtBQXhELEVBQStFL00sUUFBL0UsRUFBaUdnTixTQUFqRyxFQUFtSDtBQUMvRyxRQUFJM0YsTUFBTSxFQUFWO0FBQ0E7QUFDQSxRQUFJNEYsS0FBS0QsWUFBWUosbUNBQVosR0FBa0RKLHNCQUEzRDtBQUNBLFFBQUlsSSxVQUFVdUksc0JBQXNCRSxLQUF0QixFQUE2Qi9NLFFBQTdCLENBQWQ7QUFDQXNFLFlBQVFqRSxPQUFSLENBQWdCLFVBQVVtRCxNQUFWLEVBQWdCO0FBQzVCeUosV0FBR0YsS0FBSCxFQUFVdkosTUFBVixFQUFrQm5ELE9BQWxCLENBQTBCLFVBQVU2TSxPQUFWLEVBQWlCO0FBQ3ZDN0YsZ0JBQUk2RixPQUFKLElBQWUsSUFBZjtBQUNILFNBRkQ7QUFHSCxLQUpEO0FBS0FySSxXQUFPaUcsTUFBUCxDQUFjekQsR0FBZDtBQUNBLFdBQU9BLEdBQVA7QUFDSDtBQVpEcEYsUUFBQTZLLHVDQUFBLEdBQUFBLHVDQUFBO0FBY0EsU0FBQUsseUNBQUEsQ0FBMERKLEtBQTFELEVBQWlGM0gsVUFBakYsRUFBdUc0SCxTQUF2RyxFQUF5SDtBQUNySCxRQUFJM0YsTUFBTSxFQUFWO0FBQ0E7QUFDQSxRQUFJNEYsS0FBS0QsWUFBWUosbUNBQVosR0FBa0RKLHNCQUEzRDtBQUNBLFFBQUlsSSxVQUFVbkMsU0FBZDtBQUNBaUQsZUFBVy9FLE9BQVgsQ0FBbUIsVUFBVUwsUUFBVixFQUFrQjtBQUNqQyxZQUFJb04sYUFBYVAsc0JBQXNCRSxLQUF0QixFQUE2Qi9NLFFBQTdCLENBQWpCO0FBQ0EsWUFBSSxDQUFDc0UsT0FBTCxFQUFjO0FBQ1ZBLHNCQUFVOEksVUFBVjtBQUNILFNBRkQsTUFFTztBQUNIOUksc0JBQVU1RSxFQUFFMk4sWUFBRixDQUFlL0ksT0FBZixFQUF3QjhJLFVBQXhCLENBQVY7QUFDSDtBQUNKLEtBUEQ7QUFRQSxRQUFJOUksUUFBUTNCLE1BQVIsS0FBbUIsQ0FBdkIsRUFBMEI7QUFDdEIsY0FBTSxJQUFJUCxLQUFKLENBQVUsZ0JBQWdCN0MsTUFBTStOLG9CQUFOLENBQTJCbEksVUFBM0IsQ0FBaEIsR0FBeUQseUJBQW5FLENBQU47QUFDSDtBQUNEZCxZQUFRakUsT0FBUixDQUFnQixVQUFVbUQsTUFBVixFQUFnQjtBQUM1QnlKLFdBQUdGLEtBQUgsRUFBVXZKLE1BQVYsRUFBa0JuRCxPQUFsQixDQUEwQixVQUFVNk0sT0FBVixFQUFpQjtBQUN2QzdGLGdCQUFJNkYsT0FBSixJQUFlLElBQWY7QUFDSCxTQUZEO0FBR0gsS0FKRDtBQUtBckksV0FBT2lHLE1BQVAsQ0FBY3pELEdBQWQ7QUFDQSxXQUFPQSxHQUFQO0FBQ0g7QUF2QkRwRixRQUFBa0wseUNBQUEsR0FBQUEseUNBQUEiLCJmaWxlIjoibW9kZWwvbW9kZWwuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogRnVuY3Rpb25hbGl0eSBtYW5hZ2luZyB0aGUgbWF0Y2ggbW9kZWxzXHJcbiAqXHJcbiAqIEBmaWxlXHJcbiAqL1xyXG5cclxuaW1wb3J0ICogYXMgaW50ZiBmcm9tICdjb25zdGFudHMnO1xyXG5pbXBvcnQgKiBhcyBkZWJ1ZyBmcm9tICdkZWJ1Zyc7XHJcblxyXG52YXIgZGVidWdsb2cgPSBkZWJ1ZygnbW9kZWwnKTtcclxuXHJcbmltcG9ydCAqIGFzIGxvZ2dlciBmcm9tICcuLi91dGlscy9sb2dnZXInO1xyXG5cclxuY29uc3QgbG9hZGxvZyA9IGxvZ2dlci5sb2dnZXIoJ21vZGVsbG9hZCcsICcnKTtcclxuXHJcbmltcG9ydCAqICBhcyBJTWF0Y2ggZnJvbSAnLi4vbWF0Y2gvaWZtYXRjaCc7XHJcbmltcG9ydCAqIGFzIE1hdGNoIGZyb20gJy4uL21hdGNoL21hdGNoJztcclxuaW1wb3J0ICogYXMgSW5wdXRGaWx0ZXJSdWxlcyBmcm9tICcuLi9tYXRjaC9pbnB1dEZpbHRlclJ1bGVzJztcclxuaW1wb3J0ICogYXMgVG9vbHMgZnJvbSAnLi4vbWF0Y2gvdG9vbHMnO1xyXG5pbXBvcnQgKiBhcyBmcyBmcm9tICdmcyc7XHJcbmltcG9ydCAqIGFzIE1ldGEgZnJvbSAnLi9tZXRhJztcclxuaW1wb3J0ICogYXMgVXRpbHMgZnJvbSAnLi4vdXRpbHMvdXRpbHMnO1xyXG5pbXBvcnQgKiBhcyBDaXJjdWxhclNlciBmcm9tICcuLi91dGlscy9jaXJjdWxhcnNlcic7XHJcblxyXG5pbXBvcnQgKiBhcyBwcm9jZXNzIGZyb20gJ3Byb2Nlc3MnO1xyXG5pbXBvcnQgKiBhcyBfIGZyb20gJ2xvZGFzaCc7XHJcbi8qKlxyXG4gKiB0aGUgbW9kZWwgcGF0aCwgbWF5IGJlIGNvbnRyb2xsZWQgdmlhIGVudmlyb25tZW50IHZhcmlhYmxlXHJcbiAqL1xyXG52YXIgZW52TW9kZWxQYXRoID0gcHJvY2Vzcy5lbnZbXCJBQk9UX01PREVMUEFUSFwiXSB8fCBcInRlc3Rtb2RlbFwiO1xyXG5cclxuLy9leHBvcnQgaW50ZXJmYWNlIElNb2RlbHMgPSBNYXRjaC5JTW9kZWxzO1xyXG5cclxuLypcclxuZXhwb3J0IGludGVyZmFjZSBJTW9kZWxzIHtcclxuICAgIGRvbWFpbnM6IHN0cmluZ1tdLFxyXG4gICAgdG9vbHM6IElNYXRjaC5JVG9vbFtdLFxyXG4gICAgY2F0ZWdvcnk6IHN0cmluZ1tdLFxyXG4gICAgbVJ1bGVzOiBJTWF0Y2gubVJ1bGVbXSxcclxuICAgIHJlY29yZHM6IGFueVtdXHJcbiAgICBzZWVuUnVsZXM/OiB7IFtrZXk6IHN0cmluZ106IElNYXRjaC5tUnVsZSB9LFxyXG4gICAgbWV0YSA6IHtcclxuICAgICAgICAvLyBlbnRpdHkgLT4gcmVsYXRpb24gLT4gdGFyZ2V0XHJcbiAgICAgICAgdDMgOiB7IFtrZXk6IHN0cmluZ10gOiB7IFtrZXkgOiBzdHJpbmddIDogYW55IH19XHJcbiAgICB9XHJcbn0qL1xyXG5cclxudHlwZSBJTW9kZWwgPSBJTWF0Y2guSU1vZGVsO1xyXG5cclxuY29uc3QgQVJSX01PREVMX1BST1BFUlRJRVMgPSBbXCJkb21haW5cIiwgXCJiaXRpbmRleFwiLCBcImRlZmF1bHRrZXljb2x1bW5cIiwgXCJkZWZhdWx0dXJpXCIsIFwiY2F0ZWdvcnlEZXNjcmliZWRcIiwgXCJjb2x1bW5zXCIsIFwiZGVzY3JpcHRpb25cIiwgXCJ0b29sXCIsIFwidG9vbGhpZGRlblwiLCBcInN5bm9ueW1zXCIsIFwiY2F0ZWdvcnlcIiwgXCJ3b3JkaW5kZXhcIiwgXCJleGFjdG1hdGNoXCIsIFwiaGlkZGVuXCJdO1xyXG5cclxuZnVuY3Rpb24gYWRkU3lub255bXMoc3lub255bXM6IHN0cmluZ1tdLCBjYXRlZ29yeTogc3RyaW5nLCBzeW5vbnltRm9yOiBzdHJpbmcsIGJpdGluZGV4OiBudW1iZXIsIG1SdWxlczogQXJyYXk8SU1hdGNoLm1SdWxlPiwgc2VlbjogeyBba2V5OiBzdHJpbmddOiBJTWF0Y2gubVJ1bGVbXSB9KSB7XHJcbiAgICBzeW5vbnltcy5mb3JFYWNoKGZ1bmN0aW9uIChzeW4pIHtcclxuICAgICAgICB2YXIgb1J1bGUgPSB7XHJcbiAgICAgICAgICAgIGNhdGVnb3J5OiBjYXRlZ29yeSxcclxuICAgICAgICAgICAgbWF0Y2hlZFN0cmluZzogc3lub255bUZvcixcclxuICAgICAgICAgICAgdHlwZTogSU1hdGNoLkVudW1SdWxlVHlwZS5XT1JELFxyXG4gICAgICAgICAgICB3b3JkOiBzeW4sXHJcbiAgICAgICAgICAgIGJpdGluZGV4OiBiaXRpbmRleCxcclxuICAgICAgICAgICAgX3Jhbmtpbmc6IDAuOTVcclxuICAgICAgICB9O1xyXG4gICAgICAgIGRlYnVnbG9nKGRlYnVnbG9nLmVuYWJsZWQgPyAoXCJpbnNlcnRpbmcgc3lub255bVwiICsgSlNPTi5zdHJpbmdpZnkob1J1bGUpKSA6ICctJyk7XHJcbiAgICAgICAgaW5zZXJ0UnVsZUlmTm90UHJlc2VudChtUnVsZXMsIG9SdWxlLCBzZWVuKTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5mdW5jdGlvbiBnZXRSdWxlS2V5KHJ1bGUpIHtcclxuICAgIHZhciByMSA9IHJ1bGUubWF0Y2hlZFN0cmluZyArIFwiLXwtXCIgKyBydWxlLmNhdGVnb3J5ICsgXCIgLXwtIFwiICsgcnVsZS50eXBlICsgXCIgLXwtIFwiICsgcnVsZS53b3JkICsgXCIgXCI7XHJcbiAgICBpZiAocnVsZS5yYW5nZSkge1xyXG4gICAgICAgIHZhciByMiA9IGdldFJ1bGVLZXkocnVsZS5yYW5nZS5ydWxlKTtcclxuICAgICAgICByMSArPSBcIiAtfC0gXCIgKyBydWxlLnJhbmdlLmxvdyArIFwiL1wiICsgcnVsZS5yYW5nZS5oaWdoICsgXCIgLXwtIFwiICsgcjI7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gcjE7XHJcbn1cclxuXHJcblxyXG5pbXBvcnQgKiBhcyBCcmVha2Rvd24gZnJvbSAnLi4vbWF0Y2gvYnJlYWtkb3duJztcclxuXHJcbi8qIGdpdmVuIGEgcnVsZSB3aGljaCByZXByZXNlbnRzIGEgd29yZCBzZXF1ZW5jZSB3aGljaCBpcyBzcGxpdCBkdXJpbmcgdG9rZW5pemF0aW9uICovXHJcbmV4cG9ydCBmdW5jdGlvbiBhZGRCZXN0U3BsaXQobVJ1bGVzOiBBcnJheTxJTWF0Y2gubVJ1bGU+LCBydWxlOiBJTWF0Y2gubVJ1bGUsIHNlZW5SdWxlczogeyBba2V5OiBzdHJpbmddOiBJTWF0Y2gubVJ1bGVbXSB9KSB7XHJcbiAgICAvL2lmKCFnbG9iYWxfQWRkU3BsaXRzKSB7XHJcbiAgICAvLyAgICByZXR1cm47XHJcbiAgICAvL31cclxuXHJcbiAgICBpZiAocnVsZS50eXBlICE9PSBJTWF0Y2guRW51bVJ1bGVUeXBlLldPUkQpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICB2YXIgYmVzdCA9IEJyZWFrZG93bi5tYWtlTWF0Y2hQYXR0ZXJuKHJ1bGUubG93ZXJjYXNld29yZCk7XHJcbiAgICBpZiAoIWJlc3QpIHtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICB2YXIgbmV3UnVsZSA9IHtcclxuICAgICAgICBjYXRlZ29yeTogcnVsZS5jYXRlZ29yeSxcclxuICAgICAgICBtYXRjaGVkU3RyaW5nOiBydWxlLm1hdGNoZWRTdHJpbmcsXHJcbiAgICAgICAgYml0aW5kZXg6IHJ1bGUuYml0aW5kZXgsXHJcbiAgICAgICAgd29yZDogYmVzdC5sb25nZXN0VG9rZW4sXHJcbiAgICAgICAgdHlwZTogMCxcclxuICAgICAgICBsb3dlcmNhc2V3b3JkOiBiZXN0Lmxvbmdlc3RUb2tlbixcclxuICAgICAgICBfcmFua2luZzogMC45NSxcclxuICAgICAgICAvLyAgICBleGFjdE9ubHkgOiBydWxlLmV4YWN0T25seSxcclxuICAgICAgICByYW5nZTogYmVzdC5zcGFuXHJcbiAgICB9IGFzIElNYXRjaC5tUnVsZTtcclxuICAgIGlmIChydWxlLmV4YWN0T25seSkge1xyXG4gICAgICAgIG5ld1J1bGUuZXhhY3RPbmx5ID0gcnVsZS5leGFjdE9ubHlcclxuICAgIH07XHJcbiAgICBuZXdSdWxlLnJhbmdlLnJ1bGUgPSBydWxlO1xyXG4gICAgaW5zZXJ0UnVsZUlmTm90UHJlc2VudChtUnVsZXMsIG5ld1J1bGUsIHNlZW5SdWxlcyk7XHJcbn1cclxuXHJcblxyXG5mdW5jdGlvbiBpbnNlcnRSdWxlSWZOb3RQcmVzZW50KG1SdWxlczogQXJyYXk8SU1hdGNoLm1SdWxlPiwgcnVsZTogSU1hdGNoLm1SdWxlLFxyXG4gICAgc2VlblJ1bGVzOiB7IFtrZXk6IHN0cmluZ106IElNYXRjaC5tUnVsZVtdIH0pIHtcclxuXHJcbiAgICBpZiAocnVsZS50eXBlICE9PSBJTWF0Y2guRW51bVJ1bGVUeXBlLldPUkQpIHtcclxuICAgICAgICBtUnVsZXMucHVzaChydWxlKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAoKHJ1bGUud29yZCA9PT0gdW5kZWZpbmVkKSB8fCAocnVsZS5tYXRjaGVkU3RyaW5nID09PSB1bmRlZmluZWQpKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbGxlZ2FsIHJ1bGUnICsgSlNPTi5zdHJpbmdpZnkocnVsZSwgdW5kZWZpbmVkLCAyKSk7XHJcbiAgICB9XHJcbiAgICB2YXIgciA9IGdldFJ1bGVLZXkocnVsZSk7XHJcbiAgICAvKiBpZiggKHJ1bGUud29yZCA9PT0gXCJzZXJ2aWNlXCIgfHwgcnVsZS53b3JkPT09IFwic2VydmljZXNcIikgJiYgci5pbmRleE9mKCdPRGF0YScpID49IDApIHtcclxuICAgICAgICAgY29uc29sZS5sb2coXCJydWxla2V5IGlzXCIgKyByKTtcclxuICAgICAgICAgY29uc29sZS5sb2coXCJwcmVzZW5jZSBpcyBcIiArIEpTT04uc3RyaW5naWZ5KHNlZW5SdWxlc1tyXSkpO1xyXG4gICAgIH0qL1xyXG4gICAgcnVsZS5sb3dlcmNhc2V3b3JkID0gcnVsZS53b3JkLnRvTG93ZXJDYXNlKCk7XHJcbiAgICBpZiAoc2VlblJ1bGVzW3JdKSB7XHJcbiAgICAgICAgZGVidWdsb2coZGVidWdsb2cuZW5hYmxlZCA/IChcIkF0dGVtcHRpbmcgdG8gaW5zZXJ0IGR1cGxpY2F0ZVwiICsgSlNPTi5zdHJpbmdpZnkocnVsZSwgdW5kZWZpbmVkLCAyKSkgOiBcIi1cIik7XHJcbiAgICAgICAgdmFyIGR1cGxpY2F0ZXMgPSBzZWVuUnVsZXNbcl0uZmlsdGVyKGZ1bmN0aW9uIChvRW50cnkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIDAgPT09IElucHV0RmlsdGVyUnVsZXMuY29tcGFyZU1SdWxlRnVsbChvRW50cnksIHJ1bGUpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGlmIChkdXBsaWNhdGVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHNlZW5SdWxlc1tyXSA9IChzZWVuUnVsZXNbcl0gfHwgW10pO1xyXG4gICAgc2VlblJ1bGVzW3JdLnB1c2gocnVsZSk7XHJcbiAgICBpZiAocnVsZS53b3JkID09PSBcIlwiKSB7XHJcbiAgICAgICAgZGVidWdsb2coZGVidWdsb2cuZW5hYmxlZCA/ICgnU2tpcHBpbmcgcnVsZSB3aXRoIGVtdHB5IHdvcmQgJyArIEpTT04uc3RyaW5naWZ5KHJ1bGUsIHVuZGVmaW5lZCwgMikpIDogJy0nKTtcclxuICAgICAgICBsb2FkbG9nKCdTa2lwcGluZyBydWxlIHdpdGggZW10cHkgd29yZCAnICsgSlNPTi5zdHJpbmdpZnkocnVsZSwgdW5kZWZpbmVkLCAyKSk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgbVJ1bGVzLnB1c2gocnVsZSk7XHJcbiAgICBhZGRCZXN0U3BsaXQobVJ1bGVzLCBydWxlLCBzZWVuUnVsZXMpO1xyXG4gICAgcmV0dXJuO1xyXG59XHJcblxyXG5mdW5jdGlvbiBsb2FkTW9kZWxEYXRhKG1vZGVsUGF0aDogc3RyaW5nLCBvTWRsOiBJTW9kZWwsIHNNb2RlbE5hbWU6IHN0cmluZywgb01vZGVsOiBJTWF0Y2guSU1vZGVscykge1xyXG4gICAgLy8gcmVhZCB0aGUgZGF0YSAtPlxyXG4gICAgLy8gZGF0YSBpcyBwcm9jZXNzZWQgaW50byBtUnVsZXMgZGlyZWN0bHksXHJcbiAgICB2YXIgYml0aW5kZXggPSBvTWRsLmJpdGluZGV4O1xyXG4gICAgY29uc3Qgc0ZpbGVOYW1lID0gKCcuLycgKyBtb2RlbFBhdGggKyAnLycgKyBzTW9kZWxOYW1lICsgXCIuZGF0YS5qc29uXCIpO1xyXG4gICAgdmFyIG1kbGRhdGEgPSBmcy5yZWFkRmlsZVN5bmMoc0ZpbGVOYW1lLCAndXRmLTgnKTtcclxuICAgIHZhciBvTWRsRGF0YSA9IEpTT04ucGFyc2UobWRsZGF0YSk7XHJcbiAgICBvTWRsRGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChvRW50cnkpIHtcclxuICAgICAgICBpZiAoIW9FbnRyeS50b29sKSB7XHJcbiAgICAgICAgICAgIG9FbnRyeS5fZG9tYWluID0gb01kbC5kb21haW47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghb0VudHJ5LnRvb2wgJiYgb01kbC50b29sLm5hbWUpIHtcclxuICAgICAgICAgICAgb0VudHJ5LnRvb2wgPSBvTWRsLnRvb2wubmFtZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgb01vZGVsLnJlY29yZHMucHVzaChvRW50cnkpO1xyXG4gICAgICAgIG9NZGwuY2F0ZWdvcnkuZm9yRWFjaChmdW5jdGlvbiAoY2F0KSB7XHJcbiAgICAgICAgICAgIGlmIChvRW50cnlbY2F0XSA9PT0gJ3VuZGVmaW5lZCcpIHtcclxuICAgICAgICAgICAgICAgIG9FbnRyeVtjYXRdID0gXCJuL2FcIjtcclxuICAgICAgICAgICAgICAgIHZhciBidWcgPVxyXG4gICAgICAgICAgICAgICAgICAgIFwiSU5DT05TSVNURU5UKj4gTW9kZWxEYXRhIFwiICsgc0ZpbGVOYW1lICsgXCIgZG9lcyBub3QgY29udGFpbiBjYXRlZ29yeSBcIiArIGNhdCArIFwiIHdpdGggdmFsdWUgJ3VuZGVmaW5lZCcsIHVuZGVmaW5lZCBpcyBpbGxlZ2FsIHZhbHVlLCB1c2Ugbi9hIFwiICsgSlNPTi5zdHJpbmdpZnkob0VudHJ5KSArIFwiXCI7XHJcbiAgICAgICAgICAgICAgICBkZWJ1Z2xvZyhidWcpO1xyXG4gICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhidWcpO1xyXG4gICAgICAgICAgICAgICAgLy9wcm9jZXNzLmV4aXQoLTEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuXHJcbiAgICAgICAgb01kbC53b3JkaW5kZXguZm9yRWFjaChmdW5jdGlvbiAoY2F0ZWdvcnkpIHtcclxuICAgICAgICAgICAgaWYgKG9FbnRyeVtjYXRlZ29yeV0gPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgZGVidWdsb2coXCJJTkNPTlNJU1RFTlQqPiBNb2RlbERhdGEgXCIgKyBzRmlsZU5hbWUgKyBcIiBkb2VzIG5vdCBjb250YWluIGNhdGVnb3J5IFwiICsgY2F0ZWdvcnkgKyBcIiBvZiB3b3JkaW5kZXhcIiArIEpTT04uc3RyaW5naWZ5KG9FbnRyeSkgKyBcIlwiKVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChvRW50cnlbY2F0ZWdvcnldICE9PSBcIipcIikge1xyXG4gICAgICAgICAgICAgICAgdmFyIHNTdHJpbmcgPSBvRW50cnlbY2F0ZWdvcnldO1xyXG4gICAgICAgICAgICAgICAgZGVidWdsb2coXCJwdXNoaW5nIHJ1bGUgd2l0aCBcIiArIGNhdGVnb3J5ICsgXCIgLT4gXCIgKyBzU3RyaW5nKTtcclxuICAgICAgICAgICAgICAgIHZhciBvUnVsZSA9IHtcclxuICAgICAgICAgICAgICAgICAgICBjYXRlZ29yeTogY2F0ZWdvcnksXHJcbiAgICAgICAgICAgICAgICAgICAgbWF0Y2hlZFN0cmluZzogc1N0cmluZyxcclxuICAgICAgICAgICAgICAgICAgICB0eXBlOiBJTWF0Y2guRW51bVJ1bGVUeXBlLldPUkQsXHJcbiAgICAgICAgICAgICAgICAgICAgd29yZDogc1N0cmluZyxcclxuICAgICAgICAgICAgICAgICAgICBiaXRpbmRleDogYml0aW5kZXgsXHJcbiAgICAgICAgICAgICAgICAgICAgX3Jhbmtpbmc6IDAuOTVcclxuICAgICAgICAgICAgICAgIH0gYXMgSU1hdGNoLm1SdWxlO1xyXG4gICAgICAgICAgICAgICAgaWYgKG9NZGwuZXhhY3RtYXRjaCAmJiBvTWRsLmV4YWN0bWF0Y2guaW5kZXhPZihjYXRlZ29yeSkgPj0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG9SdWxlLmV4YWN0T25seSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpbnNlcnRSdWxlSWZOb3RQcmVzZW50KG9Nb2RlbC5tUnVsZXMsIG9SdWxlLCBvTW9kZWwuc2VlblJ1bGVzKTtcclxuICAgICAgICAgICAgICAgIGlmIChvTWRsRGF0YS5zeW5vbnltcyAmJiBvTWRsRGF0YS5zeW5vbnltc1tjYXRlZ29yeV0pIHtcclxuICAgICAgICAgICAgICAgICAgICBhZGRTeW5vbnltcyhvTWRsRGF0YS5zeW5vbnltc1tjYXRlZ29yeV0sIGNhdGVnb3J5LCBzU3RyaW5nLCBiaXRpbmRleCwgb01vZGVsLm1SdWxlcywgb01vZGVsLnNlZW5SdWxlcyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAob0VudHJ5LnN5bm9ueW1zICYmIG9FbnRyeS5zeW5vbnltc1tjYXRlZ29yeV0pIHtcclxuICAgICAgICAgICAgICAgICAgICBhZGRTeW5vbnltcyhvRW50cnkuc3lub255bXNbY2F0ZWdvcnldLCBjYXRlZ29yeSwgc1N0cmluZywgYml0aW5kZXgsIG9Nb2RlbC5tUnVsZXMsIG9Nb2RlbC5zZWVuUnVsZXMpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufVxyXG5cclxuXHJcblxyXG5cclxuZnVuY3Rpb24gbG9hZE1vZGVsKG1vZGVsUGF0aDogc3RyaW5nLCBzTW9kZWxOYW1lOiBzdHJpbmcsIG9Nb2RlbDogSU1hdGNoLklNb2RlbHMpIHtcclxuICAgIGRlYnVnbG9nKFwiIGxvYWRpbmcgXCIgKyBzTW9kZWxOYW1lICsgXCIgLi4uLlwiKTtcclxuICAgIHZhciBtZGwgPSBmcy5yZWFkRmlsZVN5bmMoJy4vJyArIG1vZGVsUGF0aCArICcvJyArIHNNb2RlbE5hbWUgKyBcIi5tb2RlbC5qc29uXCIsICd1dGYtOCcpO1xyXG4gICAgdmFyIG9NZGwgPSBKU09OLnBhcnNlKG1kbCkgYXMgSU1vZGVsO1xyXG4gICAgbWVyZ2VNb2RlbEpzb24oc01vZGVsTmFtZSwgb01kbCwgb01vZGVsKTtcclxuICAgIGxvYWRNb2RlbERhdGEobW9kZWxQYXRoLCBvTWRsLCBzTW9kZWxOYW1lLCBvTW9kZWwpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0RG9tYWluQml0SW5kZXgoZG9tYWluOiBzdHJpbmcsIG9Nb2RlbDogSU1hdGNoLklNb2RlbHMpOiBudW1iZXIge1xyXG4gICAgdmFyIGluZGV4ID0gb01vZGVsLmRvbWFpbnMuaW5kZXhPZihkb21haW4pO1xyXG4gICAgaWYgKGluZGV4IDwgMCkge1xyXG4gICAgICAgIGluZGV4ID0gb01vZGVsLmRvbWFpbnMubGVuZ3RoO1xyXG4gICAgfVxyXG4gICAgaWYgKGluZGV4ID49IDMyKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwidG9vIG1hbnkgZG9tYWluIGZvciBzaW5nbGUgMzIgYml0IGluZGV4XCIpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIDB4MDAwMSA8PCBpbmRleDtcclxufVxyXG5cclxuZnVuY3Rpb24gbWVyZ2VNb2RlbEpzb24oc01vZGVsTmFtZTogc3RyaW5nLCBvTWRsOiBJTW9kZWwsIG9Nb2RlbDogSU1hdGNoLklNb2RlbHMpIHtcclxuICAgIHZhciBjYXRlZ29yeURlc2NyaWJlZE1hcCA9IHt9IGFzIHsgW2tleTogc3RyaW5nXTogSU1hdGNoLklDYXRlZ29yeURlc2MgfTtcclxuICAgIG9NZGwuYml0aW5kZXggPSBnZXREb21haW5CaXRJbmRleChvTWRsLmRvbWFpbiwgb01vZGVsKTtcclxuICAgIG9NZGwuY2F0ZWdvcnlEZXNjcmliZWQgPSBbXTtcclxuICAgIC8vIHJlY3RpZnkgY2F0ZWdvcnlcclxuICAgIG9NZGwuY2F0ZWdvcnkgPSBvTWRsLmNhdGVnb3J5Lm1hcChmdW5jdGlvbiAoY2F0OiBhbnkpIHtcclxuICAgICAgICBpZiAodHlwZW9mIGNhdCA9PT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgICAgICByZXR1cm4gY2F0O1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodHlwZW9mIGNhdC5uYW1lICE9PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiTWlzc2luZyBuYW1lIGluIG9iamVjdCB0eXBlZCBjYXRlZ29yeSBpbiBcIiArIEpTT04uc3RyaW5naWZ5KGNhdCkgKyBcIiBpbiBtb2RlbCBcIiArIHNNb2RlbE5hbWUpO1xyXG4gICAgICAgICAgICBwcm9jZXNzLmV4aXQoLTEpO1xyXG4gICAgICAgICAgICAvL3Rocm93IG5ldyBFcnJvcignRG9tYWluICcgKyBvTWRsLmRvbWFpbiArICcgYWxyZWFkeSBsb2FkZWQgd2hpbGUgbG9hZGluZyAnICsgc01vZGVsTmFtZSArICc/Jyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNhdGVnb3J5RGVzY3JpYmVkTWFwW2NhdC5uYW1lXSA9IGNhdDtcclxuICAgICAgICBvTWRsLmNhdGVnb3J5RGVzY3JpYmVkLnB1c2goY2F0KTtcclxuICAgICAgICByZXR1cm4gY2F0Lm5hbWU7XHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBhZGQgdGhlIGNhdGVnb3JpZXMgdG8gdGhlIG1vZGVsOlxyXG4gICAgb01kbC5jYXRlZ29yeS5mb3JFYWNoKGZ1bmN0aW9uIChjYXRlZ29yeSkge1xyXG4gICAgICAgIGluc2VydFJ1bGVJZk5vdFByZXNlbnQob01vZGVsLm1SdWxlcywge1xyXG4gICAgICAgICAgICBjYXRlZ29yeTogXCJjYXRlZ29yeVwiLFxyXG4gICAgICAgICAgICBtYXRjaGVkU3RyaW5nOiBjYXRlZ29yeSxcclxuICAgICAgICAgICAgdHlwZTogSU1hdGNoLkVudW1SdWxlVHlwZS5XT1JELFxyXG4gICAgICAgICAgICB3b3JkOiBjYXRlZ29yeSxcclxuICAgICAgICAgICAgbG93ZXJjYXNld29yZDogY2F0ZWdvcnkudG9Mb3dlckNhc2UoKSxcclxuICAgICAgICAgICAgYml0aW5kZXg6IG9NZGwuYml0aW5kZXgsXHJcbiAgICAgICAgICAgIF9yYW5raW5nOiAwLjk1XHJcbiAgICAgICAgfSwgb01vZGVsLnNlZW5SdWxlcyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpZiAob01vZGVsLmRvbWFpbnMuaW5kZXhPZihvTWRsLmRvbWFpbikgPj0gMCkge1xyXG4gICAgICAgIGRlYnVnbG9nKFwiKioqKioqKioqKipoZXJlIG1kbFwiICsgSlNPTi5zdHJpbmdpZnkob01kbCwgdW5kZWZpbmVkLCAyKSk7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdEb21haW4gJyArIG9NZGwuZG9tYWluICsgJyBhbHJlYWR5IGxvYWRlZCB3aGlsZSBsb2FkaW5nICcgKyBzTW9kZWxOYW1lICsgJz8nKTtcclxuICAgIH1cclxuICAgIC8vIGNoZWNrIHByb3BlcnRpZXMgb2YgbW9kZWxcclxuICAgIE9iamVjdC5rZXlzKG9NZGwpLnNvcnQoKS5mb3JFYWNoKGZ1bmN0aW9uIChzUHJvcGVydHkpIHtcclxuICAgICAgICBpZiAoQVJSX01PREVMX1BST1BFUlRJRVMuaW5kZXhPZihzUHJvcGVydHkpIDwgMCkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ01vZGVsIHByb3BlcnR5IFwiJyArIHNQcm9wZXJ0eSArICdcIiBub3QgYSBrbm93biBtb2RlbCBwcm9wZXJ0eSBpbiBtb2RlbCBvZiBkb21haW4gJyArIG9NZGwuZG9tYWluICsgJyAnKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuICAgIC8vIGNvbnNpZGVyIHN0cmVhbWxpbmluZyB0aGUgY2F0ZWdvcmllc1xyXG4gICAgb01vZGVsLnJhd01vZGVsc1tvTWRsLmRvbWFpbl0gPSBvTWRsO1xyXG5cclxuICAgIG9Nb2RlbC5mdWxsLmRvbWFpbltvTWRsLmRvbWFpbl0gPSB7XHJcbiAgICAgICAgZGVzY3JpcHRpb246IG9NZGwuZGVzY3JpcHRpb24sXHJcbiAgICAgICAgY2F0ZWdvcmllczogY2F0ZWdvcnlEZXNjcmliZWRNYXAsXHJcbiAgICAgICAgYml0aW5kZXg6IG9NZGwuYml0aW5kZXhcclxuICAgIH07XHJcblxyXG4gICAgLy8gY2hlY2sgdGhhdFxyXG5cclxuXHJcbiAgICAvLyBjaGVjayB0aGF0IG1lbWJlcnMgb2Ygd29yZGluZGV4IGFyZSBpbiBjYXRlZ29yaWVzLFxyXG4gICAgb01kbC53b3JkaW5kZXggPSBvTWRsLndvcmRpbmRleCB8fCBbXTtcclxuICAgIG9NZGwud29yZGluZGV4LmZvckVhY2goZnVuY3Rpb24gKHNXb3JkSW5kZXgpIHtcclxuICAgICAgICBpZiAob01kbC5jYXRlZ29yeS5pbmRleE9mKHNXb3JkSW5kZXgpIDwgMCkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ01vZGVsIHdvcmRpbmRleCBcIicgKyBzV29yZEluZGV4ICsgJ1wiIG5vdCBhIGNhdGVnb3J5IG9mIGRvbWFpbiAnICsgb01kbC5kb21haW4gKyAnICcpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgb01kbC5leGFjdG1hdGNoID0gb01kbC5leGFjdG1hdGNoIHx8IFtdO1xyXG4gICAgb01kbC5leGFjdG1hdGNoLmZvckVhY2goZnVuY3Rpb24gKHNFeGFjdE1hdGNoKSB7XHJcbiAgICAgICAgaWYgKG9NZGwuY2F0ZWdvcnkuaW5kZXhPZihzRXhhY3RNYXRjaCkgPCAwKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTW9kZWwgZXhhY3RtYXRjaCBcIicgKyBzRXhhY3RNYXRjaCArICdcIiBub3QgYSBjYXRlZ29yeSBvZiBkb21haW4gJyArIG9NZGwuZG9tYWluICsgJyAnKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuICAgIG9NZGwuY29sdW1ucyA9IG9NZGwuY29sdW1ucyB8fCBbXTtcclxuICAgIG9NZGwuY29sdW1ucy5mb3JFYWNoKGZ1bmN0aW9uIChzRXhhY3RNYXRjaCkge1xyXG4gICAgICAgIGlmIChvTWRsLmNhdGVnb3J5LmluZGV4T2Yoc0V4YWN0TWF0Y2gpIDwgMCkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ01vZGVsIGNvbHVtbiBcIicgKyBzRXhhY3RNYXRjaCArICdcIiBub3QgYSBjYXRlZ29yeSBvZiBkb21haW4gJyArIG9NZGwuZG9tYWluICsgJyAnKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuXHJcblxyXG4gICAgLy8gYWRkIHJlbGF0aW9uIGRvbWFpbiAtPiBjYXRlZ29yeVxyXG4gICAgdmFyIGRvbWFpblN0ciA9IE1ldGFGLkRvbWFpbihvTWRsLmRvbWFpbikudG9GdWxsU3RyaW5nKCk7XHJcbiAgICB2YXIgcmVsYXRpb25TdHIgPSBNZXRhRi5SZWxhdGlvbihNZXRhLlJFTEFUSU9OX2hhc0NhdGVnb3J5KS50b0Z1bGxTdHJpbmcoKTtcclxuICAgIHZhciByZXZlcnNlUmVsYXRpb25TdHIgPSBNZXRhRi5SZWxhdGlvbihNZXRhLlJFTEFUSU9OX2lzQ2F0ZWdvcnlPZikudG9GdWxsU3RyaW5nKCk7XHJcbiAgICBvTWRsLmNhdGVnb3J5LmZvckVhY2goZnVuY3Rpb24gKHNDYXRlZ29yeSkge1xyXG5cclxuICAgICAgICB2YXIgQ2F0ZWdvcnlTdHJpbmcgPSBNZXRhRi5DYXRlZ29yeShzQ2F0ZWdvcnkpLnRvRnVsbFN0cmluZygpO1xyXG4gICAgICAgIG9Nb2RlbC5tZXRhLnQzW2RvbWFpblN0cl0gPSBvTW9kZWwubWV0YS50M1tkb21haW5TdHJdIHx8IHt9O1xyXG4gICAgICAgIG9Nb2RlbC5tZXRhLnQzW2RvbWFpblN0cl1bcmVsYXRpb25TdHJdID0gb01vZGVsLm1ldGEudDNbZG9tYWluU3RyXVtyZWxhdGlvblN0cl0gfHwge307XHJcbiAgICAgICAgb01vZGVsLm1ldGEudDNbZG9tYWluU3RyXVtyZWxhdGlvblN0cl1bQ2F0ZWdvcnlTdHJpbmddID0ge307XHJcblxyXG4gICAgICAgIG9Nb2RlbC5tZXRhLnQzW0NhdGVnb3J5U3RyaW5nXSA9IG9Nb2RlbC5tZXRhLnQzW0NhdGVnb3J5U3RyaW5nXSB8fCB7fTtcclxuICAgICAgICBvTW9kZWwubWV0YS50M1tDYXRlZ29yeVN0cmluZ11bcmV2ZXJzZVJlbGF0aW9uU3RyXSA9IG9Nb2RlbC5tZXRhLnQzW0NhdGVnb3J5U3RyaW5nXVtyZXZlcnNlUmVsYXRpb25TdHJdIHx8IHt9O1xyXG4gICAgICAgIG9Nb2RlbC5tZXRhLnQzW0NhdGVnb3J5U3RyaW5nXVtyZXZlcnNlUmVsYXRpb25TdHJdW2RvbWFpblN0cl0gPSB7fTtcclxuXHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBhZGQgYSBwcmVjaWNlIGRvbWFpbiBtYXRjaHJ1bGVcclxuICAgIGluc2VydFJ1bGVJZk5vdFByZXNlbnQob01vZGVsLm1SdWxlcywge1xyXG4gICAgICAgIGNhdGVnb3J5OiBcImRvbWFpblwiLFxyXG4gICAgICAgIG1hdGNoZWRTdHJpbmc6IG9NZGwuZG9tYWluLFxyXG4gICAgICAgIHR5cGU6IElNYXRjaC5FbnVtUnVsZVR5cGUuV09SRCxcclxuICAgICAgICB3b3JkOiBvTWRsLmRvbWFpbixcclxuICAgICAgICBiaXRpbmRleDogb01kbC5iaXRpbmRleCxcclxuICAgICAgICBfcmFua2luZzogMC45NVxyXG4gICAgfSwgb01vZGVsLnNlZW5SdWxlcyk7XHJcblxyXG4gICAgLy8gY2hlY2sgdGhlIHRvb2xcclxuICAgIGlmIChvTWRsLnRvb2wgJiYgb01kbC50b29sLnJlcXVpcmVzKSB7XHJcbiAgICAgICAgdmFyIHJlcXVpcmVzID0gT2JqZWN0LmtleXMob01kbC50b29sLnJlcXVpcmVzIHx8IHt9KTtcclxuICAgICAgICB2YXIgZGlmZiA9IF8uZGlmZmVyZW5jZShyZXF1aXJlcywgb01kbC5jYXRlZ29yeSk7XHJcbiAgICAgICAgaWYgKGRpZmYubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhgICR7b01kbC5kb21haW59IDogVW5rb3duIGNhdGVnb3J5IGluIHJlcXVpcmVzIG9mIHRvb2w6IFwiYCArIGRpZmYuam9pbignXCInKSArICdcIicpO1xyXG4gICAgICAgICAgICBwcm9jZXNzLmV4aXQoLTEpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB2YXIgb3B0aW9uYWwgPSBPYmplY3Qua2V5cyhvTWRsLnRvb2wub3B0aW9uYWwpO1xyXG4gICAgICAgIGRpZmYgPSBfLmRpZmZlcmVuY2Uob3B0aW9uYWwsIG9NZGwuY2F0ZWdvcnkpO1xyXG4gICAgICAgIGlmIChkaWZmLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coYCAke29NZGwuZG9tYWlufSA6IFVua293biBjYXRlZ29yeSBvcHRpb25hbCBvZiB0b29sOiBcImAgKyBkaWZmLmpvaW4oJ1wiJykgKyAnXCInKTtcclxuICAgICAgICAgICAgcHJvY2Vzcy5leGl0KC0xKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgT2JqZWN0LmtleXMob01kbC50b29sLnNldHMgfHwge30pLmZvckVhY2goZnVuY3Rpb24gKHNldElEKSB7XHJcbiAgICAgICAgICAgIHZhciBkaWZmID0gXy5kaWZmZXJlbmNlKG9NZGwudG9vbC5zZXRzW3NldElEXS5zZXQsIG9NZGwuY2F0ZWdvcnkpO1xyXG4gICAgICAgICAgICBpZiAoZGlmZi5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgICR7b01kbC5kb21haW59IDogVW5rb3duIGNhdGVnb3J5IGluIHNldElkICR7c2V0SUR9IG9mIHRvb2w6IFwiYCArIGRpZmYuam9pbignXCInKSArICdcIicpO1xyXG4gICAgICAgICAgICAgICAgcHJvY2Vzcy5leGl0KC0xKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyBleHRyYWN0IHRvb2xzIGFuIGFkZCB0byB0b29sczpcclxuICAgICAgICBvTW9kZWwudG9vbHMuZmlsdGVyKGZ1bmN0aW9uIChvRW50cnkpIHtcclxuICAgICAgICAgICAgaWYgKG9FbnRyeS5uYW1lID09PSAob01kbC50b29sICYmIG9NZGwudG9vbC5uYW1lKSkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJUb29sIFwiICsgb01kbC50b29sLm5hbWUgKyBcIiBhbHJlYWR5IHByZXNlbnQgd2hlbiBsb2FkaW5nIFwiICsgc01vZGVsTmFtZSk7XHJcbiAgICAgICAgICAgICAgICAvL3Rocm93IG5ldyBFcnJvcignRG9tYWluIGFscmVhZHkgbG9hZGVkPycpO1xyXG4gICAgICAgICAgICAgICAgcHJvY2Vzcy5leGl0KC0xKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgICBvTWRsLnRvb2xoaWRkZW4gPSB0cnVlO1xyXG4gICAgICAgIG9NZGwudG9vbC5yZXF1aXJlcyA9IHsgXCJpbXBvc3NpYmxlXCI6IHt9IH07XHJcbiAgICB9XHJcbiAgICAvLyBhZGQgdGhlIHRvb2wgbmFtZSBhcyBydWxlIHVubGVzcyBoaWRkZW5cclxuICAgIGlmICghb01kbC50b29saGlkZGVuICYmIG9NZGwudG9vbCAmJiBvTWRsLnRvb2wubmFtZSkge1xyXG4gICAgICAgIGluc2VydFJ1bGVJZk5vdFByZXNlbnQob01vZGVsLm1SdWxlcywge1xyXG4gICAgICAgICAgICBjYXRlZ29yeTogXCJ0b29sXCIsXHJcbiAgICAgICAgICAgIG1hdGNoZWRTdHJpbmc6IG9NZGwudG9vbC5uYW1lLFxyXG4gICAgICAgICAgICB0eXBlOiBJTWF0Y2guRW51bVJ1bGVUeXBlLldPUkQsXHJcbiAgICAgICAgICAgIHdvcmQ6IG9NZGwudG9vbC5uYW1lLFxyXG4gICAgICAgICAgICBiaXRpbmRleDogb01kbC5iaXRpbmRleCxcclxuICAgICAgICAgICAgX3Jhbmtpbmc6IDAuOTVcclxuICAgICAgICB9LCBvTW9kZWwuc2VlblJ1bGVzKTtcclxuICAgIH07XHJcbiAgICBpZiAob01kbC5zeW5vbnltcyAmJiBvTWRsLnN5bm9ueW1zW1widG9vbFwiXSkge1xyXG4gICAgICAgIGFkZFN5bm9ueW1zKG9NZGwuc3lub255bXNbXCJ0b29sXCJdLCBcInRvb2xcIiwgb01kbC50b29sLm5hbWUsIG9NZGwuYml0aW5kZXgsIG9Nb2RlbC5tUnVsZXMsIG9Nb2RlbC5zZWVuUnVsZXMpO1xyXG4gICAgfTtcclxuICAgIGlmIChvTWRsLnN5bm9ueW1zKSB7XHJcbiAgICAgICAgT2JqZWN0LmtleXMob01kbC5zeW5vbnltcykuZm9yRWFjaChmdW5jdGlvbiAoc3N5bmtleSkge1xyXG4gICAgICAgICAgICBpZiAob01kbC5jYXRlZ29yeS5pbmRleE9mKHNzeW5rZXkpID49IDAgJiYgc3N5bmtleSAhPT0gXCJ0b29sXCIpIHtcclxuICAgICAgICAgICAgICAgIGlmIChvTW9kZWwuZnVsbC5kb21haW5bb01kbC5kb21haW5dLmNhdGVnb3JpZXNbc3N5bmtleV0pIHtcclxuICAgICAgICAgICAgICAgICAgICBvTW9kZWwuZnVsbC5kb21haW5bb01kbC5kb21haW5dLmNhdGVnb3JpZXNbc3N5bmtleV0uc3lub255bXMgPSBvTWRsLnN5bm9ueW1zW3NzeW5rZXldO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGFkZFN5bm9ueW1zKG9NZGwuc3lub255bXNbc3N5bmtleV0sIFwiY2F0ZWdvcnlcIiwgc3N5bmtleSwgb01kbC5iaXRpbmRleCwgb01vZGVsLm1SdWxlcywgb01vZGVsLnNlZW5SdWxlcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIG9Nb2RlbC5kb21haW5zLnB1c2gob01kbC5kb21haW4pO1xyXG4gICAgaWYgKG9NZGwudG9vbC5uYW1lKSB7XHJcbiAgICAgICAgb01vZGVsLnRvb2xzLnB1c2gob01kbC50b29sKTtcclxuICAgIH1cclxuICAgIG9Nb2RlbC5jYXRlZ29yeSA9IG9Nb2RlbC5jYXRlZ29yeS5jb25jYXQob01kbC5jYXRlZ29yeSk7XHJcbiAgICBvTW9kZWwuY2F0ZWdvcnkuc29ydCgpO1xyXG4gICAgb01vZGVsLmNhdGVnb3J5ID0gb01vZGVsLmNhdGVnb3J5LmZpbHRlcihmdW5jdGlvbiAoc3RyaW5nLCBpbmRleCkge1xyXG4gICAgICAgIHJldHVybiBvTW9kZWwuY2F0ZWdvcnlbaW5kZXhdICE9PSBvTW9kZWwuY2F0ZWdvcnlbaW5kZXggKyAxXTtcclxuICAgIH0pO1xyXG5cclxufSAvLyBsb2FkbW9kZWxcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBzcGxpdFJ1bGVzKHJ1bGVzOiBJTWF0Y2gubVJ1bGVbXSk6IElNYXRjaC5TcGxpdFJ1bGVzIHtcclxuICAgIHZhciByZXMgPSB7fTtcclxuICAgIHZhciBub25Xb3JkUnVsZXMgPSBbXTtcclxuICAgIHJ1bGVzLmZvckVhY2goZnVuY3Rpb24gKHJ1bGUpIHtcclxuICAgICAgICBpZiAocnVsZS50eXBlID09PSBJTWF0Y2guRW51bVJ1bGVUeXBlLldPUkQpIHtcclxuICAgICAgICAgICAgaWYgKCFydWxlLmxvd2VyY2FzZXdvcmQpIHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlJ1bGUgaGFzIG5vIG1lbWJlciBsb3dlcmNhc2V3b3JkXCIgKyBKU09OLnN0cmluZ2lmeShydWxlKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmVzW3J1bGUubG93ZXJjYXNld29yZF0gPSByZXNbcnVsZS5sb3dlcmNhc2V3b3JkXSB8fCB7IGJpdGluZGV4OiAwLCBydWxlczogW10gfTtcclxuICAgICAgICAgICAgcmVzW3J1bGUubG93ZXJjYXNld29yZF0uYml0aW5kZXggPSByZXNbcnVsZS5sb3dlcmNhc2V3b3JkXS5iaXRpbmRleCB8IHJ1bGUuYml0aW5kZXg7XHJcbiAgICAgICAgICAgIHJlc1tydWxlLmxvd2VyY2FzZXdvcmRdLnJ1bGVzLnB1c2gocnVsZSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgbm9uV29yZFJ1bGVzLnB1c2gocnVsZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIHdvcmRNYXA6IHJlcyxcclxuICAgICAgICBub25Xb3JkUnVsZXM6IG5vbldvcmRSdWxlcyxcclxuICAgICAgICBhbGxSdWxlczogcnVsZXMsXHJcbiAgICAgICAgd29yZENhY2hlIDoge31cclxuICAgIH07XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGNtcExlbmd0aFNvcnQoYTogc3RyaW5nLCBiOiBzdHJpbmcpIHtcclxuICAgIHZhciBkID0gYS5sZW5ndGggLSBiLmxlbmd0aDtcclxuICAgIGlmIChkKSB7XHJcbiAgICAgICAgcmV0dXJuIGQ7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gYS5sb2NhbGVDb21wYXJlKGIpO1xyXG59XHJcblxyXG5pbXBvcnQgKiBhcyBEaXN0YW5jZSBmcm9tICcuLi91dGlscy9kYW1lcmF1TGV2ZW5zaHRlaW4nO1xyXG5pbXBvcnQgKiBhcyBBbGdvbCBmcm9tICcuLi9tYXRjaC9hbGdvbCc7XHJcbi8vIG9mZnNldFswXSA6IGxlbi0yXHJcbi8vICAgICAgICAgICAgIGxlbiAtMVxyXG4vLyAgICAgICAgICAgICBsZW5cclxuLy8gICAgICAgICAgICAgbGVuICsxXHJcbi8vICAgICAgICAgICAgIGxlbiArMlxyXG4vLyAgICAgICAgICAgICBsZW4gKzNcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBmaW5kTmV4dExlbih0YXJnZXRMZW46IG51bWJlciwgYXJyOiBzdHJpbmdbXSwgb2Zmc2V0czogbnVtYmVyW10pIHtcclxuICAgIG9mZnNldHMuc2hpZnQoKTtcclxuICAgIGZvciAodmFyIGkgPSBvZmZzZXRzWzRdOyAoaSA8IGFyci5sZW5ndGgpICYmIChhcnJbaV0ubGVuZ3RoIDw9IHRhcmdldExlbik7ICsraSkge1xyXG4gICAgICAgIC8qIGVtcHR5Ki9cclxuICAgIH1cclxuICAgIC8vY29uc29sZS5sb2coXCJwdXNoaW5nIFwiICsgaSk7XHJcbiAgICBvZmZzZXRzLnB1c2goaSk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBhZGRSYW5nZVJ1bGVzVW5sZXNzUHJlc2VudChydWxlczogSU1hdGNoLm1SdWxlW10sIGxjd29yZDogc3RyaW5nLCByYW5nZVJ1bGVzOiBJTWF0Y2gubVJ1bGVbXSwgcHJlc2VudFJ1bGVzRm9yS2V5OiBJTWF0Y2gubVJ1bGVbXSwgc2VlblJ1bGVzKSB7XHJcbiAgICByYW5nZVJ1bGVzLmZvckVhY2gocmFuZ2VSdWxlID0+IHtcclxuICAgICAgICB2YXIgbmV3UnVsZSA9IE9iamVjdC5hc3NpZ24oe30sIHJhbmdlUnVsZSk7XHJcbiAgICAgICAgbmV3UnVsZS5sb3dlcmNhc2V3b3JkID0gbGN3b3JkO1xyXG4gICAgICAgIG5ld1J1bGUud29yZCA9IGxjd29yZDtcclxuICAgICAgICAvL2lmKChsY3dvcmQgPT09ICdzZXJ2aWNlcycgfHwgbGN3b3JkID09PSAnc2VydmljZScpICYmIG5ld1J1bGUucmFuZ2UucnVsZS5sb3dlcmNhc2V3b3JkLmluZGV4T2YoJ29kYXRhJyk+PTApIHtcclxuICAgICAgICAvLyAgICBjb25zb2xlLmxvZyhcImFkZGluZyBcIisgSlNPTi5zdHJpbmdpZnkobmV3UnVsZSkgKyBcIlxcblwiKTtcclxuICAgICAgICAvL31cclxuICAgICAgICAvL3RvZG86IGNoZWNrIHdoZXRoZXIgYW4gZXF1aXZhbGVudCBydWxlIGlzIGFscmVhZHkgcHJlc2VudD9cclxuICAgICAgICB2YXIgY250ID0gcnVsZXMubGVuZ3RoO1xyXG4gICAgICAgIGluc2VydFJ1bGVJZk5vdFByZXNlbnQocnVsZXMsIG5ld1J1bGUsIHNlZW5SdWxlcyk7XHJcbiAgICB9KVxyXG59XHJcblxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGFkZENsb3NlRXhhY3RSYW5nZVJ1bGVzKHJ1bGVzOiBJTWF0Y2gubVJ1bGVbXSwgc2VlblJ1bGVzKSB7XHJcbiAgICB2YXIga2V5c01hcCA9IHt9IGFzIHsgW2tleTogc3RyaW5nXTogSU1hdGNoLm1SdWxlW10gfTtcclxuICAgIHZhciByYW5nZUtleXNNYXAgPSB7fSBhcyB7IFtrZXk6IHN0cmluZ106IElNYXRjaC5tUnVsZVtdIH07XHJcbiAgICBydWxlcy5mb3JFYWNoKHJ1bGUgPT4ge1xyXG4gICAgICAgIGlmIChydWxlLnR5cGUgPT09IElNYXRjaC5FbnVtUnVsZVR5cGUuV09SRCkge1xyXG4gICAgICAgICAgICAvL2tleXNNYXBbcnVsZS5sb3dlcmNhc2V3b3JkXSA9IDE7XHJcbiAgICAgICAgICAgIGtleXNNYXBbcnVsZS5sb3dlcmNhc2V3b3JkXSA9IGtleXNNYXBbcnVsZS5sb3dlcmNhc2V3b3JkXSB8fCBbXTtcclxuICAgICAgICAgICAga2V5c01hcFtydWxlLmxvd2VyY2FzZXdvcmRdLnB1c2gocnVsZSk7XHJcbiAgICAgICAgICAgIGlmICghcnVsZS5leGFjdE9ubHkgJiYgcnVsZS5yYW5nZSkge1xyXG4gICAgICAgICAgICAgICAgcmFuZ2VLZXlzTWFwW3J1bGUubG93ZXJjYXNld29yZF0gPSByYW5nZUtleXNNYXBbcnVsZS5sb3dlcmNhc2V3b3JkXSB8fCBbXTtcclxuICAgICAgICAgICAgICAgIHJhbmdlS2V5c01hcFtydWxlLmxvd2VyY2FzZXdvcmRdLnB1c2gocnVsZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXMoa2V5c01hcCk7XHJcbiAgICBrZXlzLnNvcnQoY21wTGVuZ3RoU29ydCk7XHJcbiAgICB2YXIgbGVuID0gMDtcclxuICAgIGtleXMuZm9yRWFjaCgoa2V5LCBpbmRleCkgPT4ge1xyXG4gICAgICAgIGlmIChrZXkubGVuZ3RoICE9IGxlbikge1xyXG4gICAgICAgICAgICAvL2NvbnNvbGUubG9nKFwic2hpZnQgdG8gbGVuXCIgKyBrZXkubGVuZ3RoICsgJyBhdCAnICsgaW5kZXggKyAnICcgKyBrZXkgKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbGVuID0ga2V5Lmxlbmd0aDtcclxuICAgIH0pO1xyXG4gICAgLy8gICBrZXlzID0ga2V5cy5zbGljZSgwLDIwMDApO1xyXG4gICAgdmFyIHJhbmdlS2V5cyA9IE9iamVjdC5rZXlzKHJhbmdlS2V5c01hcCk7XHJcbiAgICByYW5nZUtleXMuc29ydChjbXBMZW5ndGhTb3J0KTtcclxuICAgIC8vY29uc29sZS5sb2coYCAke2tleXMubGVuZ3RofSBrZXlzIGFuZCAke3JhbmdlS2V5cy5sZW5ndGh9IHJhbmdla2V5cyBgKTtcclxuICAgIHZhciBsb3cgPSAwO1xyXG4gICAgdmFyIGhpZ2ggPSAwO1xyXG4gICAgdmFyIGxhc3RsZW4gPSAwO1xyXG4gICAgdmFyIG9mZnNldHMgPSBbMCwgMCwgMCwgMCwgMCwgMF07XHJcbiAgICB2YXIgbGVuID0gcmFuZ2VLZXlzLmxlbmd0aDtcclxuICAgIGZpbmROZXh0TGVuKDAsIGtleXMsIG9mZnNldHMpO1xyXG4gICAgZmluZE5leHRMZW4oMSwga2V5cywgb2Zmc2V0cyk7XHJcbiAgICBmaW5kTmV4dExlbigyLCBrZXlzLCBvZmZzZXRzKTtcclxuXHJcbiAgICByYW5nZUtleXMuZm9yRWFjaChmdW5jdGlvbiAocmFuZ2VLZXkpIHtcclxuICAgICAgICBpZiAocmFuZ2VLZXkubGVuZ3RoICE9PSBsYXN0bGVuKSB7XHJcbiAgICAgICAgICAgIGZvciAoaSA9IGxhc3RsZW4gKyAxOyBpIDw9IHJhbmdlS2V5Lmxlbmd0aDsgKytpKSB7XHJcbiAgICAgICAgICAgICAgICBmaW5kTmV4dExlbihpICsgMiwga2V5cywgb2Zmc2V0cyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gICBjb25zb2xlLmxvZyhgIHNoaWZ0ZWQgdG8gJHtyYW5nZUtleS5sZW5ndGh9IHdpdGggb2Zmc2V0cyBiZWVpbmcgJHtvZmZzZXRzLmpvaW4oJyAnKX1gKTtcclxuICAgICAgICAgICAgLy8gICBjb25zb2xlLmxvZyhgIGhlcmUgMCAke29mZnNldHNbMF19IDogJHtrZXlzW01hdGgubWluKGtleXMubGVuZ3RoLTEsIG9mZnNldHNbMF0pXS5sZW5ndGh9ICAke2tleXNbTWF0aC5taW4oa2V5cy5sZW5ndGgtMSwgb2Zmc2V0c1swXSldfSBgKTtcclxuICAgICAgICAgICAgLy8gIGNvbnNvbGUubG9nKGAgaGVyZSA1LTEgICR7a2V5c1tvZmZzZXRzWzVdLTFdLmxlbmd0aH0gICR7a2V5c1tvZmZzZXRzWzVdLTFdfSBgKTtcclxuICAgICAgICAgICAgLy8gICBjb25zb2xlLmxvZyhgIGhlcmUgNSAke29mZnNldHNbNV19IDogJHtrZXlzW01hdGgubWluKGtleXMubGVuZ3RoLTEsIG9mZnNldHNbNV0pXS5sZW5ndGh9ICAke2tleXNbTWF0aC5taW4oa2V5cy5sZW5ndGgtMSwgb2Zmc2V0c1s1XSldfSBgKTtcclxuICAgICAgICAgICAgbGFzdGxlbiA9IHJhbmdlS2V5Lmxlbmd0aDtcclxuICAgICAgICB9XHJcbiAgICAgICAgZm9yICh2YXIgaSA9IG9mZnNldHNbMF07IGkgPCBvZmZzZXRzWzVdOyArK2kpIHtcclxuICAgICAgICAgICAgdmFyIGQgPSBEaXN0YW5jZS5jYWxjRGlzdGFuY2VBZGp1c3RlZChyYW5nZUtleSwga2V5c1tpXSk7XHJcbiAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKGAke3JhbmdlS2V5Lmxlbmd0aC1rZXlzW2ldLmxlbmd0aH0gJHtkfSAke3JhbmdlS2V5fSBhbmQgJHtrZXlzW2ldfSAgYCk7XHJcbiAgICAgICAgICAgIGlmICgoZCAhPT0gMS4wKSAmJiAoZCA+PSBBbGdvbC5DdXRvZmZfcmFuZ2VDbG9zZU1hdGNoKSkge1xyXG4gICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhgd291bGQgYWRkICR7cmFuZ2VLZXl9IGZvciAke2tleXNbaV19ICR7ZH1gKTtcclxuICAgICAgICAgICAgICAgIHZhciBjbnQgPSBydWxlcy5sZW5ndGg7XHJcbiAgICAgICAgICAgICAgICAvLyB3ZSBvbmx5IGhhdmUgdG8gYWRkIGlmIHRoZXJlIGlzIG5vdCB5ZXQgYSBtYXRjaCBydWxlIGhlcmUgd2hpY2ggcG9pbnRzIHRvIHRoZSBzYW1lXHJcbiAgICAgICAgICAgICAgICBhZGRSYW5nZVJ1bGVzVW5sZXNzUHJlc2VudChydWxlcywga2V5c1tpXSwgcmFuZ2VLZXlzTWFwW3JhbmdlS2V5XSwga2V5c01hcFtrZXlzW2ldXSwgc2VlblJ1bGVzKTtcclxuICAgICAgICAgICAgICAgIGlmIChydWxlcy5sZW5ndGggPiBjbnQpIHtcclxuICAgICAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKGAgYWRkZWQgJHsocnVsZXMubGVuZ3RoIC0gY250KX0gcmVjb3JkcyBhdCR7cmFuZ2VLZXl9IGZvciAke2tleXNbaV19ICR7ZH1gKTtcclxuICAgICAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuICAgIC8qXHJcbiAgICBbXHJcbiAgICAgICAgWydhRUZHJywnYUVGR0gnXSxcclxuICAgICAgICBbJ2FFRkdIJywnYUVGR0hJJ10sXHJcbiAgICAgICAgWydPZGF0YScsJ09EYXRhcyddLFxyXG4gICBbJ09kYXRhJywnT2RhdGFzJ10sXHJcbiAgIFsnT2RhdGEnLCdPZGF0YiddLFxyXG4gICBbJ09kYXRhJywnVURhdGEnXSxcclxuICAgWydzZXJ2aWNlJywnc2VydmljZXMnXSxcclxuICAgWyd0aGlzIGlzZnVubnkgYW5kIG1vcmUnLCd0aGlzIGlzZnVubnkgYW5kIG1vcmVzJ10sXHJcbiAgICBdLmZvckVhY2gocmVjID0+IHtcclxuICAgICAgICBjb25zb2xlLmxvZyhgZGlzdGFuY2UgJHtyZWNbMF19ICR7cmVjWzFdfSA6ICR7RGlzdGFuY2UuY2FsY0Rpc3RhbmNlKHJlY1swXSxyZWNbMV0pfSAgYWRmICR7RGlzdGFuY2UuY2FsY0Rpc3RhbmNlQWRqdXN0ZWQocmVjWzBdLHJlY1sxXSl9IGApO1xyXG5cclxuICAgIH0pO1xyXG4gICAgY29uc29sZS5sb2coXCJkaXN0YW5jZSBPZGF0YSBVZGF0YVwiKyBEaXN0YW5jZS5jYWxjRGlzdGFuY2UoJ09EYXRhJywnVURhdGEnKSk7XHJcbiAgICBjb25zb2xlLmxvZyhcImRpc3RhbmNlIE9kYXRhIE9kYXRiXCIrIERpc3RhbmNlLmNhbGNEaXN0YW5jZSgnT0RhdGEnLCdPRGF0YicpKTtcclxuICAgIGNvbnNvbGUubG9nKFwiZGlzdGFuY2UgT2RhdGFzIE9kYXRhXCIrIERpc3RhbmNlLmNhbGNEaXN0YW5jZSgnT0RhdGEnLCdPRGF0YWEnKSk7XHJcbiAgICBjb25zb2xlLmxvZyhcImRpc3RhbmNlIE9kYXRhcyBhYmNkZVwiKyBEaXN0YW5jZS5jYWxjRGlzdGFuY2UoJ2FiY2RlJywnYWJjZGVmJykpO1xyXG4gICAgY29uc29sZS5sb2coXCJkaXN0YW5jZSBzZXJ2aWNlcyBcIisgRGlzdGFuY2UuY2FsY0Rpc3RhbmNlKCdzZXJ2aWNlcycsJ3NlcnZpY2UnKSk7XHJcbiAgICAqL1xyXG59XHJcbnZhciBuID0gMDtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBsb2FkTW9kZWxzKG1vZGVsUGF0aD86IHN0cmluZyk6IElNYXRjaC5JTW9kZWxzIHtcclxuICAgIHZhciBvTW9kZWw6IElNYXRjaC5JTW9kZWxzO1xyXG4gICAgb01vZGVsID0ge1xyXG4gICAgICAgIGZ1bGw6IHsgZG9tYWluOiB7fSB9LFxyXG4gICAgICAgIHJhd01vZGVsczoge30sXHJcbiAgICAgICAgZG9tYWluczogW10sXHJcbiAgICAgICAgdG9vbHM6IFtdLFxyXG4gICAgICAgIHJ1bGVzOiB1bmRlZmluZWQsXHJcbiAgICAgICAgY2F0ZWdvcnk6IFtdLFxyXG4gICAgICAgIG9wZXJhdG9yczoge30sXHJcbiAgICAgICAgbVJ1bGVzOiBbXSxcclxuICAgICAgICBzZWVuUnVsZXM6IHt9LFxyXG4gICAgICAgIHJlY29yZHM6IFtdLFxyXG4gICAgICAgIG1ldGE6IHsgdDM6IHt9IH1cclxuICAgIH1cclxuICAgIHZhciB0ID0gRGF0ZS5ub3coKTtcclxuICAgIG1vZGVsUGF0aCA9IG1vZGVsUGF0aCB8fCBlbnZNb2RlbFBhdGg7XHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgICB2YXIgYSA9IENpcmN1bGFyU2VyLmxvYWQoJy4vJyArIG1vZGVsUGF0aCArICcvX2NhY2hlZmFsc2UuanMnKTtcclxuICAgICAgICAvL2NvbnNvbGUubG9nKFwiZm91bmQgYSBjYWNoZSA/ICBcIiArICEhYSk7XHJcbiAgICAgICAgLy9hID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIGlmIChhKSB7XHJcbiAgICAgICAgICAgIGRlYnVnbG9nKFwiIHJldHVybiBwcmVwYXJlc2UgbW9kZWwgXCIpO1xyXG4gICAgICAgICAgICBpZiAocHJvY2Vzcy5lbnYuQUJPVF9FTUFJTF9VU0VSKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImxvYWRlZCBtb2RlbHMgZnJvbSBjYWNoZSBpbiBcIiArIChEYXRlLm5vdygpIC0gdCkgKyBcIiBcIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgcmV0dXJuIGE7XHJcbiAgICAgICAgfVxyXG4gICAgfSBjYXRjaCAoZSkge1xyXG4gICAgICAgIC8vY29uc29sZS5sb2coJ2Vycm9yJyArIGUpO1xyXG4gICAgICAgIC8vIG5vIGNhY2hlIGZpbGUsXHJcbiAgICB9XHJcbiAgICB2YXIgc21kbHMgPSBmcy5yZWFkRmlsZVN5bmMoJy4vJyArIG1vZGVsUGF0aCArICcvbW9kZWxzLmpzb24nLCAndXRmLTgnKTtcclxuICAgIHZhciBtZGxzID0gSlNPTi5wYXJzZShcIlwiICsgc21kbHMpO1xyXG4gICAgbWRscy5mb3JFYWNoKGZ1bmN0aW9uIChzTW9kZWxOYW1lKSB7XHJcbiAgICAgICAgbG9hZE1vZGVsKG1vZGVsUGF0aCwgc01vZGVsTmFtZSwgb01vZGVsKVxyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gYWRkIHRoZSBjYXRlZ29yaWVzIHRvIHRoZSBtb2RlbDpcclxuICAgIC8qXHJcbiAgICBvTW9kZWwuY2F0ZWdvcnkuZm9yRWFjaChmdW5jdGlvbiAoY2F0ZWdvcnkpIHtcclxuICAgICAgICBpbnNlcnRSdWxlSWZOb3RQcmVzZW50KG9Nb2RlbC5tUnVsZXMsIHtcclxuICAgICAgICAgICAgY2F0ZWdvcnk6IFwiY2F0ZWdvcnlcIixcclxuICAgICAgICAgICAgbWF0Y2hlZFN0cmluZzogY2F0ZWdvcnksXHJcbiAgICAgICAgICAgIHR5cGU6IElNYXRjaC5FbnVtUnVsZVR5cGUuV09SRCxcclxuICAgICAgICAgICAgd29yZDogY2F0ZWdvcnksXHJcbiAgICAgICAgICAgIGxvd2VyY2FzZXdvcmQ6IGNhdGVnb3J5LnRvTG93ZXJDYXNlKCksXHJcbiAgICAgICAgICAgIGJpdGluZGV4IDogb01kbC5cclxuICAgICAgICAgICAgX3Jhbmtpbmc6IDAuOTVcclxuICAgICAgICB9LCBvTW9kZWwuc2VlblJ1bGVzKTtcclxuICAgIH0pO1xyXG4gICAgKi9cclxuXHJcbiAgICB2YXIgbWV0YUJpdEluZGV4ID0gZ2V0RG9tYWluQml0SW5kZXgoJ21ldGEnLCBvTW9kZWwpO1xyXG5cclxuICAgIC8vIGFkZCB0aGUgZG9tYWluIG1ldGEgcnVsZVxyXG4gICAgaW5zZXJ0UnVsZUlmTm90UHJlc2VudChvTW9kZWwubVJ1bGVzLCB7XHJcbiAgICAgICAgY2F0ZWdvcnk6IFwibWV0YVwiLFxyXG4gICAgICAgIG1hdGNoZWRTdHJpbmc6IFwiZG9tYWluXCIsXHJcbiAgICAgICAgdHlwZTogSU1hdGNoLkVudW1SdWxlVHlwZS5XT1JELFxyXG4gICAgICAgIHdvcmQ6IFwiZG9tYWluXCIsXHJcbiAgICAgICAgYml0aW5kZXg6IG1ldGFCaXRJbmRleCxcclxuICAgICAgICBfcmFua2luZzogMC45NVxyXG4gICAgfSwgb01vZGVsLnNlZW5SdWxlcyk7XHJcblxyXG5cclxuICAgIHZhciBmaWxsZXJCaXRJbmRleCA9IGdldERvbWFpbkJpdEluZGV4KCdtZXRhJywgb01vZGVsKTtcclxuICAgIC8vYWRkIGEgZmlsbGVyIHJ1bGVcclxuICAgIHZhciBzZmlsbGVycyA9IGZzLnJlYWRGaWxlU3luYygnLi8nICsgbW9kZWxQYXRoICsgJy9maWxsZXIuanNvbicsICd1dGYtOCcpO1xyXG4gICAgdmFyIGZpbGxlcnMgPSBKU09OLnBhcnNlKHNmaWxsZXJzKTtcclxuICAgIHZhciByZSA9IFwiXigoXCIgKyBmaWxsZXJzLmpvaW4oXCIpfChcIikgKyBcIikpJFwiO1xyXG4gICAgb01vZGVsLm1SdWxlcy5wdXNoKHtcclxuICAgICAgICBjYXRlZ29yeTogXCJmaWxsZXJcIixcclxuICAgICAgICB0eXBlOiBJTWF0Y2guRW51bVJ1bGVUeXBlLlJFR0VYUCxcclxuICAgICAgICByZWdleHA6IG5ldyBSZWdFeHAocmUsIFwiaVwiKSxcclxuICAgICAgICBtYXRjaGVkU3RyaW5nOiBcImZpbGxlclwiLFxyXG4gICAgICAgIGJpdGluZGV4OiBmaWxsZXJCaXRJbmRleCxcclxuICAgICAgICBfcmFua2luZzogMC45XHJcbiAgICB9KTtcclxuXHJcbiAgICAvL2FkZCBvcGVyYXRvcnNcclxuICAgIHZhciBzT3BlcmF0b3JzID0gZnMucmVhZEZpbGVTeW5jKCcuL3Jlc291cmNlcy9tb2RlbC9vcGVyYXRvcnMuanNvbicsICd1dGYtOCcpO1xyXG4gICAgdmFyIG9wZXJhdG9ycyA9IEpTT04ucGFyc2Uoc09wZXJhdG9ycyk7XHJcbiAgICB2YXIgb3BlcmF0b3JCaXRJbmRleCA9IGdldERvbWFpbkJpdEluZGV4KCdvcGVyYXRvcnMnLCBvTW9kZWwpO1xyXG4gICAgT2JqZWN0LmtleXMob3BlcmF0b3JzLm9wZXJhdG9ycykuZm9yRWFjaChmdW5jdGlvbiAob3BlcmF0b3IpIHtcclxuICAgICAgICBpZiAoSU1hdGNoLmFPcGVyYXRvck5hbWVzLmluZGV4T2Yob3BlcmF0b3IpIDwgMCkge1xyXG4gICAgICAgICAgICBkZWJ1Z2xvZyhcInVua25vd24gb3BlcmF0b3IgXCIgKyBvcGVyYXRvcik7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcInVua25vd24gb3BlcmF0b3IgXCIgKyBvcGVyYXRvcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG9Nb2RlbC5vcGVyYXRvcnNbb3BlcmF0b3JdID0gb3BlcmF0b3JzLm9wZXJhdG9yc1tvcGVyYXRvcl07XHJcbiAgICAgICAgb01vZGVsLm9wZXJhdG9yc1tvcGVyYXRvcl0ub3BlcmF0b3IgPSA8SU1hdGNoLk9wZXJhdG9yTmFtZT5vcGVyYXRvcjtcclxuICAgICAgICBPYmplY3QuZnJlZXplKG9Nb2RlbC5vcGVyYXRvcnNbb3BlcmF0b3JdKTtcclxuICAgICAgICB2YXIgd29yZCA9IG9wZXJhdG9yO1xyXG4gICAgICAgIGluc2VydFJ1bGVJZk5vdFByZXNlbnQob01vZGVsLm1SdWxlcywge1xyXG4gICAgICAgICAgICBjYXRlZ29yeTogXCJvcGVyYXRvclwiLFxyXG4gICAgICAgICAgICB3b3JkOiB3b3JkLnRvTG93ZXJDYXNlKCksXHJcbiAgICAgICAgICAgIGxvd2VyY2FzZXdvcmQ6IHdvcmQudG9Mb3dlckNhc2UoKSxcclxuICAgICAgICAgICAgdHlwZTogSU1hdGNoLkVudW1SdWxlVHlwZS5XT1JELFxyXG4gICAgICAgICAgICBtYXRjaGVkU3RyaW5nOiB3b3JkLFxyXG4gICAgICAgICAgICBiaXRpbmRleDogb3BlcmF0b3JCaXRJbmRleCxcclxuICAgICAgICAgICAgX3Jhbmtpbmc6IDAuOVxyXG4gICAgICAgIH0sIG9Nb2RlbC5zZWVuUnVsZXMpO1xyXG4gICAgICAgIC8vIGFkZCBhbGwgc3lub255bXNcclxuICAgICAgICBpZiAob3BlcmF0b3JzLnN5bm9ueW1zW29wZXJhdG9yXSkge1xyXG4gICAgICAgICAgICBPYmplY3Qua2V5cyhvcGVyYXRvcnMuc3lub255bXNbb3BlcmF0b3JdKS5mb3JFYWNoKGZ1bmN0aW9uIChzeW5vbnltKSB7XHJcbiAgICAgICAgICAgICAgICBpbnNlcnRSdWxlSWZOb3RQcmVzZW50KG9Nb2RlbC5tUnVsZXMsIHtcclxuICAgICAgICAgICAgICAgICAgICBjYXRlZ29yeTogXCJvcGVyYXRvclwiLFxyXG4gICAgICAgICAgICAgICAgICAgIHdvcmQ6IHN5bm9ueW0udG9Mb3dlckNhc2UoKSxcclxuICAgICAgICAgICAgICAgICAgICBsb3dlcmNhc2V3b3JkOiBzeW5vbnltLnRvTG93ZXJDYXNlKCksXHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogSU1hdGNoLkVudW1SdWxlVHlwZS5XT1JELFxyXG4gICAgICAgICAgICAgICAgICAgIG1hdGNoZWRTdHJpbmc6IG9wZXJhdG9yLFxyXG4gICAgICAgICAgICAgICAgICAgIGJpdGluZGV4OiBvcGVyYXRvckJpdEluZGV4LFxyXG4gICAgICAgICAgICAgICAgICAgIF9yYW5raW5nOiAwLjlcclxuICAgICAgICAgICAgICAgIH0sIG9Nb2RlbC5zZWVuUnVsZXMpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuICAgIC8qXHJcbiAgICAgICAgfSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgY2F0ZWdvcnk6IFwiZmlsbGVyXCIsXHJcbiAgICAgICAgICB0eXBlOiAxLFxyXG4gICAgICAgICAgcmVnZXhwOiAvXigoc3RhcnQpfChzaG93KXwoZnJvbSl8KGluKSkkL2ksXHJcbiAgICAgICAgICBtYXRjaGVkU3RyaW5nOiBcImZpbGxlclwiLFxyXG4gICAgICAgICAgX3Jhbmtpbmc6IDAuOVxyXG4gICAgICAgIH0sXHJcbiAgICAqL1xyXG4gICAgb01vZGVsLm1SdWxlcyA9IG9Nb2RlbC5tUnVsZXMuc29ydChJbnB1dEZpbHRlclJ1bGVzLmNtcE1SdWxlKTtcclxuICAgIGFkZENsb3NlRXhhY3RSYW5nZVJ1bGVzKG9Nb2RlbC5tUnVsZXMsIG9Nb2RlbC5zZWVuUnVsZXMpO1xyXG4gICAgb01vZGVsLm1SdWxlcyA9IG9Nb2RlbC5tUnVsZXMuc29ydChJbnB1dEZpbHRlclJ1bGVzLmNtcE1SdWxlKTtcclxuICAgIGlmIChnbG9iYWwgJiYgZ2xvYmFsLmdjKSB7XHJcbiAgICAgICAgZ2xvYmFsLmdjKCk7XHJcbiAgICB9XHJcbiAgICBvTW9kZWwucnVsZXMgPSBzcGxpdFJ1bGVzKG9Nb2RlbC5tUnVsZXMpO1xyXG4gICAgaWYgKGdsb2JhbCAmJiBnbG9iYWwuZ2MpIHtcclxuICAgICAgICBnbG9iYWwuZ2MoKTtcclxuICAgIH1cclxuICAgIG9Nb2RlbC50b29scyA9IG9Nb2RlbC50b29scy5zb3J0KFRvb2xzLmNtcFRvb2xzKTtcclxuICAgIGRlbGV0ZSBvTW9kZWwuc2VlblJ1bGVzO1xyXG4gICAgZGVidWdsb2coJ3NhdmluZycpO1xyXG4gICAgaWYgKGdsb2JhbCAmJiBnbG9iYWwuZ2MpIHtcclxuICAgICAgICBnbG9iYWwuZ2MoKTtcclxuICAgIH1cclxuICAgIENpcmN1bGFyU2VyLnNhdmUoJy4vJyArIG1vZGVsUGF0aCArICcvX2NhY2hlZmFsc2UuanMnLCBvTW9kZWwpO1xyXG4gICAgaWYgKGdsb2JhbCAmJiBnbG9iYWwuZ2MpIHtcclxuICAgICAgICBnbG9iYWwuZ2MoKTtcclxuICAgIH1cclxuICAgIGlmIChwcm9jZXNzLmVudi5BQk9UX0VNQUlMX1VTRVIpIHtcclxuICAgICAgICBjb25zb2xlLmxvZyhcImxvYWRlZCBtb2RlbHMgYnkgY2FsY3VsYXRpb24gaW4gXCIgKyAoRGF0ZS5ub3coKSAtIHQpICsgXCIgXCIpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIG9Nb2RlbDtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHNvcnRDYXRlZ29yaWVzQnlJbXBvcnRhbmNlKG1hcDogeyBba2V5OiBzdHJpbmddOiBJTWF0Y2guSUNhdGVnb3J5RGVzYyB9LCBjYXRzOiBzdHJpbmdbXSk6IHN0cmluZ1tdIHtcclxuICAgIHZhciByZXMgPSBjYXRzLnNsaWNlKDApO1xyXG4gICAgcmVzLnNvcnQocmFua0NhdGVnb3J5QnlJbXBvcnRhbmNlLmJpbmQodW5kZWZpbmVkLCBtYXApKTtcclxuICAgIHJldHVybiByZXM7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiByYW5rQ2F0ZWdvcnlCeUltcG9ydGFuY2UobWFwOiB7IFtrZXk6IHN0cmluZ106IElNYXRjaC5JQ2F0ZWdvcnlEZXNjIH0sIGNhdGE6IHN0cmluZywgY2F0Yjogc3RyaW5nKTogbnVtYmVyIHtcclxuICAgIHZhciBjYXRBRGVzYyA9IG1hcFtjYXRhXTtcclxuICAgIHZhciBjYXRCRGVzYyA9IG1hcFtjYXRiXTtcclxuICAgIGlmIChjYXRhID09PSBjYXRiKSB7XHJcbiAgICAgICAgcmV0dXJuIDA7XHJcbiAgICB9XHJcbiAgICAvLyBpZiBhIGlzIGJlZm9yZSBiLCByZXR1cm4gLTFcclxuICAgIGlmIChjYXRBRGVzYyAmJiAhY2F0QkRlc2MpIHtcclxuICAgICAgICByZXR1cm4gLTE7XHJcbiAgICB9XHJcbiAgICBpZiAoIWNhdEFEZXNjICYmIGNhdEJEZXNjKSB7XHJcbiAgICAgICAgcmV0dXJuICsxO1xyXG4gICAgfVxyXG5cclxuICAgIHZhciBwcmlvQSA9IChjYXRBRGVzYyAmJiBjYXRBRGVzYy5pbXBvcnRhbmNlKSB8fCA5OTtcclxuICAgIHZhciBwcmlvQiA9IChjYXRCRGVzYyAmJiBjYXRCRGVzYy5pbXBvcnRhbmNlKSB8fCA5OTtcclxuICAgIC8vIGxvd2VyIHByaW8gZ29lcyB0byBmcm9udFxyXG4gICAgdmFyIHIgPSBwcmlvQSAtIHByaW9CO1xyXG4gICAgaWYgKHIpIHtcclxuICAgICAgICByZXR1cm4gcjtcclxuICAgIH1cclxuICAgIHJldHVybiBjYXRhLmxvY2FsZUNvbXBhcmUoY2F0Yik7XHJcbn1cclxuXHJcbmNvbnN0IE1ldGFGID0gTWV0YS5nZXRNZXRhRmFjdG9yeSgpO1xyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldE9wZXJhdG9yKG1kbDogSU1hdGNoLklNb2RlbHMsIG9wZXJhdG9yOiBzdHJpbmcpOiBJTWF0Y2guSU9wZXJhdG9yIHtcclxuICAgIHJldHVybiBtZGwub3BlcmF0b3JzW29wZXJhdG9yXTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldFJlc3VsdEFzQXJyYXkobWRsOiBJTWF0Y2guSU1vZGVscywgYTogTWV0YS5JTWV0YSwgcmVsOiBNZXRhLklNZXRhKTogTWV0YS5JTWV0YVtdIHtcclxuICAgIGlmIChyZWwudG9UeXBlKCkgIT09ICdyZWxhdGlvbicpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJleHBlY3QgcmVsYXRpb24gYXMgMm5kIGFyZ1wiKTtcclxuICAgIH1cclxuXHJcbiAgICB2YXIgcmVzID0gbWRsLm1ldGEudDNbYS50b0Z1bGxTdHJpbmcoKV0gJiZcclxuICAgICAgICBtZGwubWV0YS50M1thLnRvRnVsbFN0cmluZygpXVtyZWwudG9GdWxsU3RyaW5nKCldO1xyXG4gICAgaWYgKCFyZXMpIHtcclxuICAgICAgICByZXR1cm4gW107XHJcbiAgICB9XHJcbiAgICByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMocmVzKS5zb3J0KCkubWFwKE1ldGFGLnBhcnNlSU1ldGEpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0Q2F0ZWdvcmllc0ZvckRvbWFpbih0aGVNb2RlbDogSU1hdGNoLklNb2RlbHMsIGRvbWFpbjogc3RyaW5nKTogc3RyaW5nW10ge1xyXG4gICAgaWYgKHRoZU1vZGVsLmRvbWFpbnMuaW5kZXhPZihkb21haW4pIDwgMCkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkRvbWFpbiBcXFwiXCIgKyBkb21haW4gKyBcIlxcXCIgbm90IHBhcnQgb2YgbW9kZWxcIik7XHJcbiAgICB9XHJcbiAgICB2YXIgcmVzID0gZ2V0UmVzdWx0QXNBcnJheSh0aGVNb2RlbCwgTWV0YUYuRG9tYWluKGRvbWFpbiksIE1ldGFGLlJlbGF0aW9uKE1ldGEuUkVMQVRJT05faGFzQ2F0ZWdvcnkpKTtcclxuICAgIHJldHVybiBNZXRhLmdldFN0cmluZ0FycmF5KHJlcyk7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRUYWJsZUNvbHVtbnModGhlTW9kZWw6IElNYXRjaC5JTW9kZWxzLCBkb21haW46IHN0cmluZyk6IHN0cmluZ1tdIHtcclxuICAgIGlmICh0aGVNb2RlbC5kb21haW5zLmluZGV4T2YoZG9tYWluKSA8IDApIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEb21haW4gXFxcIlwiICsgZG9tYWluICsgXCJcXFwiIG5vdCBwYXJ0IG9mIG1vZGVsXCIpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHRoZU1vZGVsLnJhd01vZGVsc1tkb21haW5dLmNvbHVtbnMuc2xpY2UoMCk7XHJcbn1cclxuXHJcblxyXG4vKipcclxuICogUmV0dXJuIGFsbCBjYXRlZ29yaWVzIG9mIGEgZG9tYWluIHdoaWNoIGNhbiBhcHBlYXIgb24gYSB3b3JkLFxyXG4gKiB0aGVzZSBhcmUgdHlwaWNhbGx5IHRoZSB3b3JkaW5kZXggZG9tYWlucyArIGVudHJpZXMgZ2VuZXJhdGVkIGJ5IGdlbmVyaWMgcnVsZXNcclxuICpcclxuICogVGhlIGN1cnJlbnQgaW1wbGVtZW50YXRpb24gaXMgYSBzaW1wbGlmaWNhdGlvblxyXG4gKi9cclxuZXhwb3J0IGZ1bmN0aW9uIGdldFBvdGVudGlhbFdvcmRDYXRlZ29yaWVzRm9yRG9tYWluKHRoZU1vZGVsOiBJTWF0Y2guSU1vZGVscywgZG9tYWluOiBzdHJpbmcpOiBzdHJpbmdbXSB7XHJcbiAgICAvLyB0aGlzIGlzIGEgc2ltcGxpZmllZCB2ZXJzaW9uXHJcbiAgICByZXR1cm4gZ2V0Q2F0ZWdvcmllc0ZvckRvbWFpbih0aGVNb2RlbCwgZG9tYWluKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldERvbWFpbnNGb3JDYXRlZ29yeSh0aGVNb2RlbDogSU1hdGNoLklNb2RlbHMsIGNhdGVnb3J5OiBzdHJpbmcpOiBzdHJpbmdbXSB7XHJcbiAgICBpZiAodGhlTW9kZWwuY2F0ZWdvcnkuaW5kZXhPZihjYXRlZ29yeSkgPCAwKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ2F0ZWdvcnkgXFxcIlwiICsgY2F0ZWdvcnkgKyBcIlxcXCIgbm90IHBhcnQgb2YgbW9kZWxcIik7XHJcbiAgICB9XHJcbiAgICB2YXIgcmVzID0gZ2V0UmVzdWx0QXNBcnJheSh0aGVNb2RlbCwgTWV0YUYuQ2F0ZWdvcnkoY2F0ZWdvcnkpLCBNZXRhRi5SZWxhdGlvbihNZXRhLlJFTEFUSU9OX2lzQ2F0ZWdvcnlPZikpO1xyXG4gICAgcmV0dXJuIE1ldGEuZ2V0U3RyaW5nQXJyYXkocmVzKTtcclxufVxyXG5cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRBbGxSZWNvcmRDYXRlZ29yaWVzRm9yVGFyZ2V0Q2F0ZWdvcnkobW9kZWw6IElNYXRjaC5JTW9kZWxzLCBjYXRlZ29yeTogc3RyaW5nLCB3b3Jkc29ubHk6IGJvb2xlYW4pOiB7IFtrZXk6IHN0cmluZ106IGJvb2xlYW4gfSB7XHJcbiAgICB2YXIgcmVzID0ge307XHJcbiAgICAvL1xyXG4gICAgdmFyIGZuID0gd29yZHNvbmx5ID8gZ2V0UG90ZW50aWFsV29yZENhdGVnb3JpZXNGb3JEb21haW4gOiBnZXRDYXRlZ29yaWVzRm9yRG9tYWluO1xyXG4gICAgdmFyIGRvbWFpbnMgPSBnZXREb21haW5zRm9yQ2F0ZWdvcnkobW9kZWwsIGNhdGVnb3J5KTtcclxuICAgIGRvbWFpbnMuZm9yRWFjaChmdW5jdGlvbiAoZG9tYWluKSB7XHJcbiAgICAgICAgZm4obW9kZWwsIGRvbWFpbikuZm9yRWFjaChmdW5jdGlvbiAod29yZGNhdCkge1xyXG4gICAgICAgICAgICByZXNbd29yZGNhdF0gPSB0cnVlO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZnJlZXplKHJlcyk7XHJcbiAgICByZXR1cm4gcmVzO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0QWxsUmVjb3JkQ2F0ZWdvcmllc0ZvclRhcmdldENhdGVnb3JpZXMobW9kZWw6IElNYXRjaC5JTW9kZWxzLCBjYXRlZ29yaWVzOiBzdHJpbmdbXSwgd29yZHNvbmx5OiBib29sZWFuKTogeyBba2V5OiBzdHJpbmddOiBib29sZWFuIH0ge1xyXG4gICAgdmFyIHJlcyA9IHt9O1xyXG4gICAgLy9cclxuICAgIHZhciBmbiA9IHdvcmRzb25seSA/IGdldFBvdGVudGlhbFdvcmRDYXRlZ29yaWVzRm9yRG9tYWluIDogZ2V0Q2F0ZWdvcmllc0ZvckRvbWFpbjtcclxuICAgIHZhciBkb21haW5zID0gdW5kZWZpbmVkO1xyXG4gICAgY2F0ZWdvcmllcy5mb3JFYWNoKGZ1bmN0aW9uIChjYXRlZ29yeSkge1xyXG4gICAgICAgIHZhciBjYXRkb21haW5zID0gZ2V0RG9tYWluc0ZvckNhdGVnb3J5KG1vZGVsLCBjYXRlZ29yeSlcclxuICAgICAgICBpZiAoIWRvbWFpbnMpIHtcclxuICAgICAgICAgICAgZG9tYWlucyA9IGNhdGRvbWFpbnM7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgZG9tYWlucyA9IF8uaW50ZXJzZWN0aW9uKGRvbWFpbnMsIGNhdGRvbWFpbnMpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgaWYgKGRvbWFpbnMubGVuZ3RoID09PSAwKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdjYXRlZ29yaWVzICcgKyBVdGlscy5saXN0VG9RdW90ZWRDb21tYUFuZChjYXRlZ29yaWVzKSArICcgaGF2ZSBubyBjb21tb24gZG9tYWluLicpXHJcbiAgICB9XHJcbiAgICBkb21haW5zLmZvckVhY2goZnVuY3Rpb24gKGRvbWFpbikge1xyXG4gICAgICAgIGZuKG1vZGVsLCBkb21haW4pLmZvckVhY2goZnVuY3Rpb24gKHdvcmRjYXQpIHtcclxuICAgICAgICAgICAgcmVzW3dvcmRjYXRdID0gdHJ1ZTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmZyZWV6ZShyZXMpO1xyXG4gICAgcmV0dXJuIHJlcztcclxufVxyXG5cclxuXHJcbiIsIi8qKlxuICogRnVuY3Rpb25hbGl0eSBtYW5hZ2luZyB0aGUgbWF0Y2ggbW9kZWxzXG4gKlxuICogQGZpbGVcbiAqL1xuXCJ1c2Ugc3RyaWN0XCI7XG52YXIgZGVidWcgPSByZXF1aXJlKFwiZGVidWdcIik7XG52YXIgZGVidWdsb2cgPSBkZWJ1ZygnbW9kZWwnKTtcbnZhciBsb2dnZXIgPSByZXF1aXJlKFwiLi4vdXRpbHMvbG9nZ2VyXCIpO1xudmFyIGxvYWRsb2cgPSBsb2dnZXIubG9nZ2VyKCdtb2RlbGxvYWQnLCAnJyk7XG52YXIgSU1hdGNoID0gcmVxdWlyZShcIi4uL21hdGNoL2lmbWF0Y2hcIik7XG52YXIgSW5wdXRGaWx0ZXJSdWxlcyA9IHJlcXVpcmUoXCIuLi9tYXRjaC9pbnB1dEZpbHRlclJ1bGVzXCIpO1xudmFyIFRvb2xzID0gcmVxdWlyZShcIi4uL21hdGNoL3Rvb2xzXCIpO1xudmFyIGZzID0gcmVxdWlyZShcImZzXCIpO1xudmFyIE1ldGEgPSByZXF1aXJlKFwiLi9tZXRhXCIpO1xudmFyIFV0aWxzID0gcmVxdWlyZShcIi4uL3V0aWxzL3V0aWxzXCIpO1xudmFyIENpcmN1bGFyU2VyID0gcmVxdWlyZShcIi4uL3V0aWxzL2NpcmN1bGFyc2VyXCIpO1xudmFyIHByb2Nlc3MgPSByZXF1aXJlKFwicHJvY2Vzc1wiKTtcbnZhciBfID0gcmVxdWlyZShcImxvZGFzaFwiKTtcbi8qKlxuICogdGhlIG1vZGVsIHBhdGgsIG1heSBiZSBjb250cm9sbGVkIHZpYSBlbnZpcm9ubWVudCB2YXJpYWJsZVxuICovXG52YXIgZW52TW9kZWxQYXRoID0gcHJvY2Vzcy5lbnZbXCJBQk9UX01PREVMUEFUSFwiXSB8fCBcInRlc3Rtb2RlbFwiO1xudmFyIEFSUl9NT0RFTF9QUk9QRVJUSUVTID0gW1wiZG9tYWluXCIsIFwiYml0aW5kZXhcIiwgXCJkZWZhdWx0a2V5Y29sdW1uXCIsIFwiZGVmYXVsdHVyaVwiLCBcImNhdGVnb3J5RGVzY3JpYmVkXCIsIFwiY29sdW1uc1wiLCBcImRlc2NyaXB0aW9uXCIsIFwidG9vbFwiLCBcInRvb2xoaWRkZW5cIiwgXCJzeW5vbnltc1wiLCBcImNhdGVnb3J5XCIsIFwid29yZGluZGV4XCIsIFwiZXhhY3RtYXRjaFwiLCBcImhpZGRlblwiXTtcbmZ1bmN0aW9uIGFkZFN5bm9ueW1zKHN5bm9ueW1zLCBjYXRlZ29yeSwgc3lub255bUZvciwgYml0aW5kZXgsIG1SdWxlcywgc2Vlbikge1xuICAgIHN5bm9ueW1zLmZvckVhY2goZnVuY3Rpb24gKHN5bikge1xuICAgICAgICB2YXIgb1J1bGUgPSB7XG4gICAgICAgICAgICBjYXRlZ29yeTogY2F0ZWdvcnksXG4gICAgICAgICAgICBtYXRjaGVkU3RyaW5nOiBzeW5vbnltRm9yLFxuICAgICAgICAgICAgdHlwZTogMCAvKiBXT1JEICovLFxuICAgICAgICAgICAgd29yZDogc3luLFxuICAgICAgICAgICAgYml0aW5kZXg6IGJpdGluZGV4LFxuICAgICAgICAgICAgX3Jhbmtpbmc6IDAuOTVcbiAgICAgICAgfTtcbiAgICAgICAgZGVidWdsb2coZGVidWdsb2cuZW5hYmxlZCA/IChcImluc2VydGluZyBzeW5vbnltXCIgKyBKU09OLnN0cmluZ2lmeShvUnVsZSkpIDogJy0nKTtcbiAgICAgICAgaW5zZXJ0UnVsZUlmTm90UHJlc2VudChtUnVsZXMsIG9SdWxlLCBzZWVuKTtcbiAgICB9KTtcbn1cbmZ1bmN0aW9uIGdldFJ1bGVLZXkocnVsZSkge1xuICAgIHZhciByMSA9IHJ1bGUubWF0Y2hlZFN0cmluZyArIFwiLXwtXCIgKyBydWxlLmNhdGVnb3J5ICsgXCIgLXwtIFwiICsgcnVsZS50eXBlICsgXCIgLXwtIFwiICsgcnVsZS53b3JkICsgXCIgXCI7XG4gICAgaWYgKHJ1bGUucmFuZ2UpIHtcbiAgICAgICAgdmFyIHIyID0gZ2V0UnVsZUtleShydWxlLnJhbmdlLnJ1bGUpO1xuICAgICAgICByMSArPSBcIiAtfC0gXCIgKyBydWxlLnJhbmdlLmxvdyArIFwiL1wiICsgcnVsZS5yYW5nZS5oaWdoICsgXCIgLXwtIFwiICsgcjI7XG4gICAgfVxuICAgIHJldHVybiByMTtcbn1cbnZhciBCcmVha2Rvd24gPSByZXF1aXJlKFwiLi4vbWF0Y2gvYnJlYWtkb3duXCIpO1xuLyogZ2l2ZW4gYSBydWxlIHdoaWNoIHJlcHJlc2VudHMgYSB3b3JkIHNlcXVlbmNlIHdoaWNoIGlzIHNwbGl0IGR1cmluZyB0b2tlbml6YXRpb24gKi9cbmZ1bmN0aW9uIGFkZEJlc3RTcGxpdChtUnVsZXMsIHJ1bGUsIHNlZW5SdWxlcykge1xuICAgIC8vaWYoIWdsb2JhbF9BZGRTcGxpdHMpIHtcbiAgICAvLyAgICByZXR1cm47XG4gICAgLy99XG4gICAgaWYgKHJ1bGUudHlwZSAhPT0gMCAvKiBXT1JEICovKSB7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdmFyIGJlc3QgPSBCcmVha2Rvd24ubWFrZU1hdGNoUGF0dGVybihydWxlLmxvd2VyY2FzZXdvcmQpO1xuICAgIGlmICghYmVzdCkge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIHZhciBuZXdSdWxlID0ge1xuICAgICAgICBjYXRlZ29yeTogcnVsZS5jYXRlZ29yeSxcbiAgICAgICAgbWF0Y2hlZFN0cmluZzogcnVsZS5tYXRjaGVkU3RyaW5nLFxuICAgICAgICBiaXRpbmRleDogcnVsZS5iaXRpbmRleCxcbiAgICAgICAgd29yZDogYmVzdC5sb25nZXN0VG9rZW4sXG4gICAgICAgIHR5cGU6IDAsXG4gICAgICAgIGxvd2VyY2FzZXdvcmQ6IGJlc3QubG9uZ2VzdFRva2VuLFxuICAgICAgICBfcmFua2luZzogMC45NSxcbiAgICAgICAgLy8gICAgZXhhY3RPbmx5IDogcnVsZS5leGFjdE9ubHksXG4gICAgICAgIHJhbmdlOiBiZXN0LnNwYW5cbiAgICB9O1xuICAgIGlmIChydWxlLmV4YWN0T25seSkge1xuICAgICAgICBuZXdSdWxlLmV4YWN0T25seSA9IHJ1bGUuZXhhY3RPbmx5O1xuICAgIH1cbiAgICA7XG4gICAgbmV3UnVsZS5yYW5nZS5ydWxlID0gcnVsZTtcbiAgICBpbnNlcnRSdWxlSWZOb3RQcmVzZW50KG1SdWxlcywgbmV3UnVsZSwgc2VlblJ1bGVzKTtcbn1cbmV4cG9ydHMuYWRkQmVzdFNwbGl0ID0gYWRkQmVzdFNwbGl0O1xuZnVuY3Rpb24gaW5zZXJ0UnVsZUlmTm90UHJlc2VudChtUnVsZXMsIHJ1bGUsIHNlZW5SdWxlcykge1xuICAgIGlmIChydWxlLnR5cGUgIT09IDAgLyogV09SRCAqLykge1xuICAgICAgICBtUnVsZXMucHVzaChydWxlKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoKHJ1bGUud29yZCA9PT0gdW5kZWZpbmVkKSB8fCAocnVsZS5tYXRjaGVkU3RyaW5nID09PSB1bmRlZmluZWQpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignaWxsZWdhbCBydWxlJyArIEpTT04uc3RyaW5naWZ5KHJ1bGUsIHVuZGVmaW5lZCwgMikpO1xuICAgIH1cbiAgICB2YXIgciA9IGdldFJ1bGVLZXkocnVsZSk7XG4gICAgLyogaWYoIChydWxlLndvcmQgPT09IFwic2VydmljZVwiIHx8IHJ1bGUud29yZD09PSBcInNlcnZpY2VzXCIpICYmIHIuaW5kZXhPZignT0RhdGEnKSA+PSAwKSB7XG4gICAgICAgICBjb25zb2xlLmxvZyhcInJ1bGVrZXkgaXNcIiArIHIpO1xuICAgICAgICAgY29uc29sZS5sb2coXCJwcmVzZW5jZSBpcyBcIiArIEpTT04uc3RyaW5naWZ5KHNlZW5SdWxlc1tyXSkpO1xuICAgICB9Ki9cbiAgICBydWxlLmxvd2VyY2FzZXdvcmQgPSBydWxlLndvcmQudG9Mb3dlckNhc2UoKTtcbiAgICBpZiAoc2VlblJ1bGVzW3JdKSB7XG4gICAgICAgIGRlYnVnbG9nKGRlYnVnbG9nLmVuYWJsZWQgPyAoXCJBdHRlbXB0aW5nIHRvIGluc2VydCBkdXBsaWNhdGVcIiArIEpTT04uc3RyaW5naWZ5KHJ1bGUsIHVuZGVmaW5lZCwgMikpIDogXCItXCIpO1xuICAgICAgICB2YXIgZHVwbGljYXRlcyA9IHNlZW5SdWxlc1tyXS5maWx0ZXIoZnVuY3Rpb24gKG9FbnRyeSkge1xuICAgICAgICAgICAgcmV0dXJuIDAgPT09IElucHV0RmlsdGVyUnVsZXMuY29tcGFyZU1SdWxlRnVsbChvRW50cnksIHJ1bGUpO1xuICAgICAgICB9KTtcbiAgICAgICAgaWYgKGR1cGxpY2F0ZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgfVxuICAgIHNlZW5SdWxlc1tyXSA9IChzZWVuUnVsZXNbcl0gfHwgW10pO1xuICAgIHNlZW5SdWxlc1tyXS5wdXNoKHJ1bGUpO1xuICAgIGlmIChydWxlLndvcmQgPT09IFwiXCIpIHtcbiAgICAgICAgZGVidWdsb2coZGVidWdsb2cuZW5hYmxlZCA/ICgnU2tpcHBpbmcgcnVsZSB3aXRoIGVtdHB5IHdvcmQgJyArIEpTT04uc3RyaW5naWZ5KHJ1bGUsIHVuZGVmaW5lZCwgMikpIDogJy0nKTtcbiAgICAgICAgbG9hZGxvZygnU2tpcHBpbmcgcnVsZSB3aXRoIGVtdHB5IHdvcmQgJyArIEpTT04uc3RyaW5naWZ5KHJ1bGUsIHVuZGVmaW5lZCwgMikpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIG1SdWxlcy5wdXNoKHJ1bGUpO1xuICAgIGFkZEJlc3RTcGxpdChtUnVsZXMsIHJ1bGUsIHNlZW5SdWxlcyk7XG4gICAgcmV0dXJuO1xufVxuZnVuY3Rpb24gbG9hZE1vZGVsRGF0YShtb2RlbFBhdGgsIG9NZGwsIHNNb2RlbE5hbWUsIG9Nb2RlbCkge1xuICAgIC8vIHJlYWQgdGhlIGRhdGEgLT5cbiAgICAvLyBkYXRhIGlzIHByb2Nlc3NlZCBpbnRvIG1SdWxlcyBkaXJlY3RseSxcbiAgICB2YXIgYml0aW5kZXggPSBvTWRsLmJpdGluZGV4O1xuICAgIHZhciBzRmlsZU5hbWUgPSAoJy4vJyArIG1vZGVsUGF0aCArICcvJyArIHNNb2RlbE5hbWUgKyBcIi5kYXRhLmpzb25cIik7XG4gICAgdmFyIG1kbGRhdGEgPSBmcy5yZWFkRmlsZVN5bmMoc0ZpbGVOYW1lLCAndXRmLTgnKTtcbiAgICB2YXIgb01kbERhdGEgPSBKU09OLnBhcnNlKG1kbGRhdGEpO1xuICAgIG9NZGxEYXRhLmZvckVhY2goZnVuY3Rpb24gKG9FbnRyeSkge1xuICAgICAgICBpZiAoIW9FbnRyeS50b29sKSB7XG4gICAgICAgICAgICBvRW50cnkuX2RvbWFpbiA9IG9NZGwuZG9tYWluO1xuICAgICAgICB9XG4gICAgICAgIGlmICghb0VudHJ5LnRvb2wgJiYgb01kbC50b29sLm5hbWUpIHtcbiAgICAgICAgICAgIG9FbnRyeS50b29sID0gb01kbC50b29sLm5hbWU7XG4gICAgICAgIH1cbiAgICAgICAgb01vZGVsLnJlY29yZHMucHVzaChvRW50cnkpO1xuICAgICAgICBvTWRsLmNhdGVnb3J5LmZvckVhY2goZnVuY3Rpb24gKGNhdCkge1xuICAgICAgICAgICAgaWYgKG9FbnRyeVtjYXRdID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIG9FbnRyeVtjYXRdID0gXCJuL2FcIjtcbiAgICAgICAgICAgICAgICB2YXIgYnVnID0gXCJJTkNPTlNJU1RFTlQqPiBNb2RlbERhdGEgXCIgKyBzRmlsZU5hbWUgKyBcIiBkb2VzIG5vdCBjb250YWluIGNhdGVnb3J5IFwiICsgY2F0ICsgXCIgd2l0aCB2YWx1ZSAndW5kZWZpbmVkJywgdW5kZWZpbmVkIGlzIGlsbGVnYWwgdmFsdWUsIHVzZSBuL2EgXCIgKyBKU09OLnN0cmluZ2lmeShvRW50cnkpICsgXCJcIjtcbiAgICAgICAgICAgICAgICBkZWJ1Z2xvZyhidWcpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgb01kbC53b3JkaW5kZXguZm9yRWFjaChmdW5jdGlvbiAoY2F0ZWdvcnkpIHtcbiAgICAgICAgICAgIGlmIChvRW50cnlbY2F0ZWdvcnldID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBkZWJ1Z2xvZyhcIklOQ09OU0lTVEVOVCo+IE1vZGVsRGF0YSBcIiArIHNGaWxlTmFtZSArIFwiIGRvZXMgbm90IGNvbnRhaW4gY2F0ZWdvcnkgXCIgKyBjYXRlZ29yeSArIFwiIG9mIHdvcmRpbmRleFwiICsgSlNPTi5zdHJpbmdpZnkob0VudHJ5KSArIFwiXCIpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChvRW50cnlbY2F0ZWdvcnldICE9PSBcIipcIikge1xuICAgICAgICAgICAgICAgIHZhciBzU3RyaW5nID0gb0VudHJ5W2NhdGVnb3J5XTtcbiAgICAgICAgICAgICAgICBkZWJ1Z2xvZyhcInB1c2hpbmcgcnVsZSB3aXRoIFwiICsgY2F0ZWdvcnkgKyBcIiAtPiBcIiArIHNTdHJpbmcpO1xuICAgICAgICAgICAgICAgIHZhciBvUnVsZSA9IHtcbiAgICAgICAgICAgICAgICAgICAgY2F0ZWdvcnk6IGNhdGVnb3J5LFxuICAgICAgICAgICAgICAgICAgICBtYXRjaGVkU3RyaW5nOiBzU3RyaW5nLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAwIC8qIFdPUkQgKi8sXG4gICAgICAgICAgICAgICAgICAgIHdvcmQ6IHNTdHJpbmcsXG4gICAgICAgICAgICAgICAgICAgIGJpdGluZGV4OiBiaXRpbmRleCxcbiAgICAgICAgICAgICAgICAgICAgX3Jhbmtpbmc6IDAuOTVcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICAgICAgICAgIGlmIChvTWRsLmV4YWN0bWF0Y2ggJiYgb01kbC5leGFjdG1hdGNoLmluZGV4T2YoY2F0ZWdvcnkpID49IDApIHtcbiAgICAgICAgICAgICAgICAgICAgb1J1bGUuZXhhY3RPbmx5ID0gdHJ1ZTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaW5zZXJ0UnVsZUlmTm90UHJlc2VudChvTW9kZWwubVJ1bGVzLCBvUnVsZSwgb01vZGVsLnNlZW5SdWxlcyk7XG4gICAgICAgICAgICAgICAgaWYgKG9NZGxEYXRhLnN5bm9ueW1zICYmIG9NZGxEYXRhLnN5bm9ueW1zW2NhdGVnb3J5XSkge1xuICAgICAgICAgICAgICAgICAgICBhZGRTeW5vbnltcyhvTWRsRGF0YS5zeW5vbnltc1tjYXRlZ29yeV0sIGNhdGVnb3J5LCBzU3RyaW5nLCBiaXRpbmRleCwgb01vZGVsLm1SdWxlcywgb01vZGVsLnNlZW5SdWxlcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChvRW50cnkuc3lub255bXMgJiYgb0VudHJ5LnN5bm9ueW1zW2NhdGVnb3J5XSkge1xuICAgICAgICAgICAgICAgICAgICBhZGRTeW5vbnltcyhvRW50cnkuc3lub255bXNbY2F0ZWdvcnldLCBjYXRlZ29yeSwgc1N0cmluZywgYml0aW5kZXgsIG9Nb2RlbC5tUnVsZXMsIG9Nb2RlbC5zZWVuUnVsZXMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfSk7XG59XG5mdW5jdGlvbiBsb2FkTW9kZWwobW9kZWxQYXRoLCBzTW9kZWxOYW1lLCBvTW9kZWwpIHtcbiAgICBkZWJ1Z2xvZyhcIiBsb2FkaW5nIFwiICsgc01vZGVsTmFtZSArIFwiIC4uLi5cIik7XG4gICAgdmFyIG1kbCA9IGZzLnJlYWRGaWxlU3luYygnLi8nICsgbW9kZWxQYXRoICsgJy8nICsgc01vZGVsTmFtZSArIFwiLm1vZGVsLmpzb25cIiwgJ3V0Zi04Jyk7XG4gICAgdmFyIG9NZGwgPSBKU09OLnBhcnNlKG1kbCk7XG4gICAgbWVyZ2VNb2RlbEpzb24oc01vZGVsTmFtZSwgb01kbCwgb01vZGVsKTtcbiAgICBsb2FkTW9kZWxEYXRhKG1vZGVsUGF0aCwgb01kbCwgc01vZGVsTmFtZSwgb01vZGVsKTtcbn1cbmZ1bmN0aW9uIGdldERvbWFpbkJpdEluZGV4KGRvbWFpbiwgb01vZGVsKSB7XG4gICAgdmFyIGluZGV4ID0gb01vZGVsLmRvbWFpbnMuaW5kZXhPZihkb21haW4pO1xuICAgIGlmIChpbmRleCA8IDApIHtcbiAgICAgICAgaW5kZXggPSBvTW9kZWwuZG9tYWlucy5sZW5ndGg7XG4gICAgfVxuICAgIGlmIChpbmRleCA+PSAzMikge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJ0b28gbWFueSBkb21haW4gZm9yIHNpbmdsZSAzMiBiaXQgaW5kZXhcIik7XG4gICAgfVxuICAgIHJldHVybiAweDAwMDEgPDwgaW5kZXg7XG59XG5leHBvcnRzLmdldERvbWFpbkJpdEluZGV4ID0gZ2V0RG9tYWluQml0SW5kZXg7XG5mdW5jdGlvbiBtZXJnZU1vZGVsSnNvbihzTW9kZWxOYW1lLCBvTWRsLCBvTW9kZWwpIHtcbiAgICB2YXIgY2F0ZWdvcnlEZXNjcmliZWRNYXAgPSB7fTtcbiAgICBvTWRsLmJpdGluZGV4ID0gZ2V0RG9tYWluQml0SW5kZXgob01kbC5kb21haW4sIG9Nb2RlbCk7XG4gICAgb01kbC5jYXRlZ29yeURlc2NyaWJlZCA9IFtdO1xuICAgIC8vIHJlY3RpZnkgY2F0ZWdvcnlcbiAgICBvTWRsLmNhdGVnb3J5ID0gb01kbC5jYXRlZ29yeS5tYXAoZnVuY3Rpb24gKGNhdCkge1xuICAgICAgICBpZiAodHlwZW9mIGNhdCA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgcmV0dXJuIGNhdDtcbiAgICAgICAgfVxuICAgICAgICBpZiAodHlwZW9mIGNhdC5uYW1lICE9PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIk1pc3NpbmcgbmFtZSBpbiBvYmplY3QgdHlwZWQgY2F0ZWdvcnkgaW4gXCIgKyBKU09OLnN0cmluZ2lmeShjYXQpICsgXCIgaW4gbW9kZWwgXCIgKyBzTW9kZWxOYW1lKTtcbiAgICAgICAgICAgIHByb2Nlc3MuZXhpdCgtMSk7XG4gICAgICAgIH1cbiAgICAgICAgY2F0ZWdvcnlEZXNjcmliZWRNYXBbY2F0Lm5hbWVdID0gY2F0O1xuICAgICAgICBvTWRsLmNhdGVnb3J5RGVzY3JpYmVkLnB1c2goY2F0KTtcbiAgICAgICAgcmV0dXJuIGNhdC5uYW1lO1xuICAgIH0pO1xuICAgIC8vIGFkZCB0aGUgY2F0ZWdvcmllcyB0byB0aGUgbW9kZWw6XG4gICAgb01kbC5jYXRlZ29yeS5mb3JFYWNoKGZ1bmN0aW9uIChjYXRlZ29yeSkge1xuICAgICAgICBpbnNlcnRSdWxlSWZOb3RQcmVzZW50KG9Nb2RlbC5tUnVsZXMsIHtcbiAgICAgICAgICAgIGNhdGVnb3J5OiBcImNhdGVnb3J5XCIsXG4gICAgICAgICAgICBtYXRjaGVkU3RyaW5nOiBjYXRlZ29yeSxcbiAgICAgICAgICAgIHR5cGU6IDAgLyogV09SRCAqLyxcbiAgICAgICAgICAgIHdvcmQ6IGNhdGVnb3J5LFxuICAgICAgICAgICAgbG93ZXJjYXNld29yZDogY2F0ZWdvcnkudG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgIGJpdGluZGV4OiBvTWRsLmJpdGluZGV4LFxuICAgICAgICAgICAgX3Jhbmtpbmc6IDAuOTVcbiAgICAgICAgfSwgb01vZGVsLnNlZW5SdWxlcyk7XG4gICAgfSk7XG4gICAgaWYgKG9Nb2RlbC5kb21haW5zLmluZGV4T2Yob01kbC5kb21haW4pID49IDApIHtcbiAgICAgICAgZGVidWdsb2coXCIqKioqKioqKioqKmhlcmUgbWRsXCIgKyBKU09OLnN0cmluZ2lmeShvTWRsLCB1bmRlZmluZWQsIDIpKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdEb21haW4gJyArIG9NZGwuZG9tYWluICsgJyBhbHJlYWR5IGxvYWRlZCB3aGlsZSBsb2FkaW5nICcgKyBzTW9kZWxOYW1lICsgJz8nKTtcbiAgICB9XG4gICAgLy8gY2hlY2sgcHJvcGVydGllcyBvZiBtb2RlbFxuICAgIE9iamVjdC5rZXlzKG9NZGwpLnNvcnQoKS5mb3JFYWNoKGZ1bmN0aW9uIChzUHJvcGVydHkpIHtcbiAgICAgICAgaWYgKEFSUl9NT0RFTF9QUk9QRVJUSUVTLmluZGV4T2Yoc1Byb3BlcnR5KSA8IDApIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTW9kZWwgcHJvcGVydHkgXCInICsgc1Byb3BlcnR5ICsgJ1wiIG5vdCBhIGtub3duIG1vZGVsIHByb3BlcnR5IGluIG1vZGVsIG9mIGRvbWFpbiAnICsgb01kbC5kb21haW4gKyAnICcpO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgLy8gY29uc2lkZXIgc3RyZWFtbGluaW5nIHRoZSBjYXRlZ29yaWVzXG4gICAgb01vZGVsLnJhd01vZGVsc1tvTWRsLmRvbWFpbl0gPSBvTWRsO1xuICAgIG9Nb2RlbC5mdWxsLmRvbWFpbltvTWRsLmRvbWFpbl0gPSB7XG4gICAgICAgIGRlc2NyaXB0aW9uOiBvTWRsLmRlc2NyaXB0aW9uLFxuICAgICAgICBjYXRlZ29yaWVzOiBjYXRlZ29yeURlc2NyaWJlZE1hcCxcbiAgICAgICAgYml0aW5kZXg6IG9NZGwuYml0aW5kZXhcbiAgICB9O1xuICAgIC8vIGNoZWNrIHRoYXRcbiAgICAvLyBjaGVjayB0aGF0IG1lbWJlcnMgb2Ygd29yZGluZGV4IGFyZSBpbiBjYXRlZ29yaWVzLFxuICAgIG9NZGwud29yZGluZGV4ID0gb01kbC53b3JkaW5kZXggfHwgW107XG4gICAgb01kbC53b3JkaW5kZXguZm9yRWFjaChmdW5jdGlvbiAoc1dvcmRJbmRleCkge1xuICAgICAgICBpZiAob01kbC5jYXRlZ29yeS5pbmRleE9mKHNXb3JkSW5kZXgpIDwgMCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdNb2RlbCB3b3JkaW5kZXggXCInICsgc1dvcmRJbmRleCArICdcIiBub3QgYSBjYXRlZ29yeSBvZiBkb21haW4gJyArIG9NZGwuZG9tYWluICsgJyAnKTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIG9NZGwuZXhhY3RtYXRjaCA9IG9NZGwuZXhhY3RtYXRjaCB8fCBbXTtcbiAgICBvTWRsLmV4YWN0bWF0Y2guZm9yRWFjaChmdW5jdGlvbiAoc0V4YWN0TWF0Y2gpIHtcbiAgICAgICAgaWYgKG9NZGwuY2F0ZWdvcnkuaW5kZXhPZihzRXhhY3RNYXRjaCkgPCAwKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ01vZGVsIGV4YWN0bWF0Y2ggXCInICsgc0V4YWN0TWF0Y2ggKyAnXCIgbm90IGEgY2F0ZWdvcnkgb2YgZG9tYWluICcgKyBvTWRsLmRvbWFpbiArICcgJyk7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICBvTWRsLmNvbHVtbnMgPSBvTWRsLmNvbHVtbnMgfHwgW107XG4gICAgb01kbC5jb2x1bW5zLmZvckVhY2goZnVuY3Rpb24gKHNFeGFjdE1hdGNoKSB7XG4gICAgICAgIGlmIChvTWRsLmNhdGVnb3J5LmluZGV4T2Yoc0V4YWN0TWF0Y2gpIDwgMCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdNb2RlbCBjb2x1bW4gXCInICsgc0V4YWN0TWF0Y2ggKyAnXCIgbm90IGEgY2F0ZWdvcnkgb2YgZG9tYWluICcgKyBvTWRsLmRvbWFpbiArICcgJyk7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICAvLyBhZGQgcmVsYXRpb24gZG9tYWluIC0+IGNhdGVnb3J5XG4gICAgdmFyIGRvbWFpblN0ciA9IE1ldGFGLkRvbWFpbihvTWRsLmRvbWFpbikudG9GdWxsU3RyaW5nKCk7XG4gICAgdmFyIHJlbGF0aW9uU3RyID0gTWV0YUYuUmVsYXRpb24oTWV0YS5SRUxBVElPTl9oYXNDYXRlZ29yeSkudG9GdWxsU3RyaW5nKCk7XG4gICAgdmFyIHJldmVyc2VSZWxhdGlvblN0ciA9IE1ldGFGLlJlbGF0aW9uKE1ldGEuUkVMQVRJT05faXNDYXRlZ29yeU9mKS50b0Z1bGxTdHJpbmcoKTtcbiAgICBvTWRsLmNhdGVnb3J5LmZvckVhY2goZnVuY3Rpb24gKHNDYXRlZ29yeSkge1xuICAgICAgICB2YXIgQ2F0ZWdvcnlTdHJpbmcgPSBNZXRhRi5DYXRlZ29yeShzQ2F0ZWdvcnkpLnRvRnVsbFN0cmluZygpO1xuICAgICAgICBvTW9kZWwubWV0YS50M1tkb21haW5TdHJdID0gb01vZGVsLm1ldGEudDNbZG9tYWluU3RyXSB8fCB7fTtcbiAgICAgICAgb01vZGVsLm1ldGEudDNbZG9tYWluU3RyXVtyZWxhdGlvblN0cl0gPSBvTW9kZWwubWV0YS50M1tkb21haW5TdHJdW3JlbGF0aW9uU3RyXSB8fCB7fTtcbiAgICAgICAgb01vZGVsLm1ldGEudDNbZG9tYWluU3RyXVtyZWxhdGlvblN0cl1bQ2F0ZWdvcnlTdHJpbmddID0ge307XG4gICAgICAgIG9Nb2RlbC5tZXRhLnQzW0NhdGVnb3J5U3RyaW5nXSA9IG9Nb2RlbC5tZXRhLnQzW0NhdGVnb3J5U3RyaW5nXSB8fCB7fTtcbiAgICAgICAgb01vZGVsLm1ldGEudDNbQ2F0ZWdvcnlTdHJpbmddW3JldmVyc2VSZWxhdGlvblN0cl0gPSBvTW9kZWwubWV0YS50M1tDYXRlZ29yeVN0cmluZ11bcmV2ZXJzZVJlbGF0aW9uU3RyXSB8fCB7fTtcbiAgICAgICAgb01vZGVsLm1ldGEudDNbQ2F0ZWdvcnlTdHJpbmddW3JldmVyc2VSZWxhdGlvblN0cl1bZG9tYWluU3RyXSA9IHt9O1xuICAgIH0pO1xuICAgIC8vIGFkZCBhIHByZWNpY2UgZG9tYWluIG1hdGNocnVsZVxuICAgIGluc2VydFJ1bGVJZk5vdFByZXNlbnQob01vZGVsLm1SdWxlcywge1xuICAgICAgICBjYXRlZ29yeTogXCJkb21haW5cIixcbiAgICAgICAgbWF0Y2hlZFN0cmluZzogb01kbC5kb21haW4sXG4gICAgICAgIHR5cGU6IDAgLyogV09SRCAqLyxcbiAgICAgICAgd29yZDogb01kbC5kb21haW4sXG4gICAgICAgIGJpdGluZGV4OiBvTWRsLmJpdGluZGV4LFxuICAgICAgICBfcmFua2luZzogMC45NVxuICAgIH0sIG9Nb2RlbC5zZWVuUnVsZXMpO1xuICAgIC8vIGNoZWNrIHRoZSB0b29sXG4gICAgaWYgKG9NZGwudG9vbCAmJiBvTWRsLnRvb2wucmVxdWlyZXMpIHtcbiAgICAgICAgdmFyIHJlcXVpcmVzID0gT2JqZWN0LmtleXMob01kbC50b29sLnJlcXVpcmVzIHx8IHt9KTtcbiAgICAgICAgdmFyIGRpZmYgPSBfLmRpZmZlcmVuY2UocmVxdWlyZXMsIG9NZGwuY2F0ZWdvcnkpO1xuICAgICAgICBpZiAoZGlmZi5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIiBcIiArIG9NZGwuZG9tYWluICsgXCIgOiBVbmtvd24gY2F0ZWdvcnkgaW4gcmVxdWlyZXMgb2YgdG9vbDogXFxcIlwiICsgZGlmZi5qb2luKCdcIicpICsgJ1wiJyk7XG4gICAgICAgICAgICBwcm9jZXNzLmV4aXQoLTEpO1xuICAgICAgICB9XG4gICAgICAgIHZhciBvcHRpb25hbCA9IE9iamVjdC5rZXlzKG9NZGwudG9vbC5vcHRpb25hbCk7XG4gICAgICAgIGRpZmYgPSBfLmRpZmZlcmVuY2Uob3B0aW9uYWwsIG9NZGwuY2F0ZWdvcnkpO1xuICAgICAgICBpZiAoZGlmZi5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIiBcIiArIG9NZGwuZG9tYWluICsgXCIgOiBVbmtvd24gY2F0ZWdvcnkgb3B0aW9uYWwgb2YgdG9vbDogXFxcIlwiICsgZGlmZi5qb2luKCdcIicpICsgJ1wiJyk7XG4gICAgICAgICAgICBwcm9jZXNzLmV4aXQoLTEpO1xuICAgICAgICB9XG4gICAgICAgIE9iamVjdC5rZXlzKG9NZGwudG9vbC5zZXRzIHx8IHt9KS5mb3JFYWNoKGZ1bmN0aW9uIChzZXRJRCkge1xuICAgICAgICAgICAgdmFyIGRpZmYgPSBfLmRpZmZlcmVuY2Uob01kbC50b29sLnNldHNbc2V0SURdLnNldCwgb01kbC5jYXRlZ29yeSk7XG4gICAgICAgICAgICBpZiAoZGlmZi5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCIgXCIgKyBvTWRsLmRvbWFpbiArIFwiIDogVW5rb3duIGNhdGVnb3J5IGluIHNldElkIFwiICsgc2V0SUQgKyBcIiBvZiB0b29sOiBcXFwiXCIgKyBkaWZmLmpvaW4oJ1wiJykgKyAnXCInKTtcbiAgICAgICAgICAgICAgICBwcm9jZXNzLmV4aXQoLTEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgLy8gZXh0cmFjdCB0b29scyBhbiBhZGQgdG8gdG9vbHM6XG4gICAgICAgIG9Nb2RlbC50b29scy5maWx0ZXIoZnVuY3Rpb24gKG9FbnRyeSkge1xuICAgICAgICAgICAgaWYgKG9FbnRyeS5uYW1lID09PSAob01kbC50b29sICYmIG9NZGwudG9vbC5uYW1lKSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiVG9vbCBcIiArIG9NZGwudG9vbC5uYW1lICsgXCIgYWxyZWFkeSBwcmVzZW50IHdoZW4gbG9hZGluZyBcIiArIHNNb2RlbE5hbWUpO1xuICAgICAgICAgICAgICAgIC8vdGhyb3cgbmV3IEVycm9yKCdEb21haW4gYWxyZWFkeSBsb2FkZWQ/Jyk7XG4gICAgICAgICAgICAgICAgcHJvY2Vzcy5leGl0KC0xKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBvTWRsLnRvb2xoaWRkZW4gPSB0cnVlO1xuICAgICAgICBvTWRsLnRvb2wucmVxdWlyZXMgPSB7IFwiaW1wb3NzaWJsZVwiOiB7fSB9O1xuICAgIH1cbiAgICAvLyBhZGQgdGhlIHRvb2wgbmFtZSBhcyBydWxlIHVubGVzcyBoaWRkZW5cbiAgICBpZiAoIW9NZGwudG9vbGhpZGRlbiAmJiBvTWRsLnRvb2wgJiYgb01kbC50b29sLm5hbWUpIHtcbiAgICAgICAgaW5zZXJ0UnVsZUlmTm90UHJlc2VudChvTW9kZWwubVJ1bGVzLCB7XG4gICAgICAgICAgICBjYXRlZ29yeTogXCJ0b29sXCIsXG4gICAgICAgICAgICBtYXRjaGVkU3RyaW5nOiBvTWRsLnRvb2wubmFtZSxcbiAgICAgICAgICAgIHR5cGU6IDAgLyogV09SRCAqLyxcbiAgICAgICAgICAgIHdvcmQ6IG9NZGwudG9vbC5uYW1lLFxuICAgICAgICAgICAgYml0aW5kZXg6IG9NZGwuYml0aW5kZXgsXG4gICAgICAgICAgICBfcmFua2luZzogMC45NVxuICAgICAgICB9LCBvTW9kZWwuc2VlblJ1bGVzKTtcbiAgICB9XG4gICAgO1xuICAgIGlmIChvTWRsLnN5bm9ueW1zICYmIG9NZGwuc3lub255bXNbXCJ0b29sXCJdKSB7XG4gICAgICAgIGFkZFN5bm9ueW1zKG9NZGwuc3lub255bXNbXCJ0b29sXCJdLCBcInRvb2xcIiwgb01kbC50b29sLm5hbWUsIG9NZGwuYml0aW5kZXgsIG9Nb2RlbC5tUnVsZXMsIG9Nb2RlbC5zZWVuUnVsZXMpO1xuICAgIH1cbiAgICA7XG4gICAgaWYgKG9NZGwuc3lub255bXMpIHtcbiAgICAgICAgT2JqZWN0LmtleXMob01kbC5zeW5vbnltcykuZm9yRWFjaChmdW5jdGlvbiAoc3N5bmtleSkge1xuICAgICAgICAgICAgaWYgKG9NZGwuY2F0ZWdvcnkuaW5kZXhPZihzc3lua2V5KSA+PSAwICYmIHNzeW5rZXkgIT09IFwidG9vbFwiKSB7XG4gICAgICAgICAgICAgICAgaWYgKG9Nb2RlbC5mdWxsLmRvbWFpbltvTWRsLmRvbWFpbl0uY2F0ZWdvcmllc1tzc3lua2V5XSkge1xuICAgICAgICAgICAgICAgICAgICBvTW9kZWwuZnVsbC5kb21haW5bb01kbC5kb21haW5dLmNhdGVnb3JpZXNbc3N5bmtleV0uc3lub255bXMgPSBvTWRsLnN5bm9ueW1zW3NzeW5rZXldO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBhZGRTeW5vbnltcyhvTWRsLnN5bm9ueW1zW3NzeW5rZXldLCBcImNhdGVnb3J5XCIsIHNzeW5rZXksIG9NZGwuYml0aW5kZXgsIG9Nb2RlbC5tUnVsZXMsIG9Nb2RlbC5zZWVuUnVsZXMpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgb01vZGVsLmRvbWFpbnMucHVzaChvTWRsLmRvbWFpbik7XG4gICAgaWYgKG9NZGwudG9vbC5uYW1lKSB7XG4gICAgICAgIG9Nb2RlbC50b29scy5wdXNoKG9NZGwudG9vbCk7XG4gICAgfVxuICAgIG9Nb2RlbC5jYXRlZ29yeSA9IG9Nb2RlbC5jYXRlZ29yeS5jb25jYXQob01kbC5jYXRlZ29yeSk7XG4gICAgb01vZGVsLmNhdGVnb3J5LnNvcnQoKTtcbiAgICBvTW9kZWwuY2F0ZWdvcnkgPSBvTW9kZWwuY2F0ZWdvcnkuZmlsdGVyKGZ1bmN0aW9uIChzdHJpbmcsIGluZGV4KSB7XG4gICAgICAgIHJldHVybiBvTW9kZWwuY2F0ZWdvcnlbaW5kZXhdICE9PSBvTW9kZWwuY2F0ZWdvcnlbaW5kZXggKyAxXTtcbiAgICB9KTtcbn0gLy8gbG9hZG1vZGVsXG5mdW5jdGlvbiBzcGxpdFJ1bGVzKHJ1bGVzKSB7XG4gICAgdmFyIHJlcyA9IHt9O1xuICAgIHZhciBub25Xb3JkUnVsZXMgPSBbXTtcbiAgICBydWxlcy5mb3JFYWNoKGZ1bmN0aW9uIChydWxlKSB7XG4gICAgICAgIGlmIChydWxlLnR5cGUgPT09IDAgLyogV09SRCAqLykge1xuICAgICAgICAgICAgaWYgKCFydWxlLmxvd2VyY2FzZXdvcmQpIHtcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJSdWxlIGhhcyBubyBtZW1iZXIgbG93ZXJjYXNld29yZFwiICsgSlNPTi5zdHJpbmdpZnkocnVsZSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmVzW3J1bGUubG93ZXJjYXNld29yZF0gPSByZXNbcnVsZS5sb3dlcmNhc2V3b3JkXSB8fCB7IGJpdGluZGV4OiAwLCBydWxlczogW10gfTtcbiAgICAgICAgICAgIHJlc1tydWxlLmxvd2VyY2FzZXdvcmRdLmJpdGluZGV4ID0gcmVzW3J1bGUubG93ZXJjYXNld29yZF0uYml0aW5kZXggfCBydWxlLmJpdGluZGV4O1xuICAgICAgICAgICAgcmVzW3J1bGUubG93ZXJjYXNld29yZF0ucnVsZXMucHVzaChydWxlKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIG5vbldvcmRSdWxlcy5wdXNoKHJ1bGUpO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIHtcbiAgICAgICAgd29yZE1hcDogcmVzLFxuICAgICAgICBub25Xb3JkUnVsZXM6IG5vbldvcmRSdWxlcyxcbiAgICAgICAgYWxsUnVsZXM6IHJ1bGVzLFxuICAgICAgICB3b3JkQ2FjaGU6IHt9XG4gICAgfTtcbn1cbmV4cG9ydHMuc3BsaXRSdWxlcyA9IHNwbGl0UnVsZXM7XG5mdW5jdGlvbiBjbXBMZW5ndGhTb3J0KGEsIGIpIHtcbiAgICB2YXIgZCA9IGEubGVuZ3RoIC0gYi5sZW5ndGg7XG4gICAgaWYgKGQpIHtcbiAgICAgICAgcmV0dXJuIGQ7XG4gICAgfVxuICAgIHJldHVybiBhLmxvY2FsZUNvbXBhcmUoYik7XG59XG52YXIgRGlzdGFuY2UgPSByZXF1aXJlKFwiLi4vdXRpbHMvZGFtZXJhdUxldmVuc2h0ZWluXCIpO1xudmFyIEFsZ29sID0gcmVxdWlyZShcIi4uL21hdGNoL2FsZ29sXCIpO1xuLy8gb2Zmc2V0WzBdIDogbGVuLTJcbi8vICAgICAgICAgICAgIGxlbiAtMVxuLy8gICAgICAgICAgICAgbGVuXG4vLyAgICAgICAgICAgICBsZW4gKzFcbi8vICAgICAgICAgICAgIGxlbiArMlxuLy8gICAgICAgICAgICAgbGVuICszXG5mdW5jdGlvbiBmaW5kTmV4dExlbih0YXJnZXRMZW4sIGFyciwgb2Zmc2V0cykge1xuICAgIG9mZnNldHMuc2hpZnQoKTtcbiAgICBmb3IgKHZhciBpID0gb2Zmc2V0c1s0XTsgKGkgPCBhcnIubGVuZ3RoKSAmJiAoYXJyW2ldLmxlbmd0aCA8PSB0YXJnZXRMZW4pOyArK2kpIHtcbiAgICB9XG4gICAgLy9jb25zb2xlLmxvZyhcInB1c2hpbmcgXCIgKyBpKTtcbiAgICBvZmZzZXRzLnB1c2goaSk7XG59XG5leHBvcnRzLmZpbmROZXh0TGVuID0gZmluZE5leHRMZW47XG5mdW5jdGlvbiBhZGRSYW5nZVJ1bGVzVW5sZXNzUHJlc2VudChydWxlcywgbGN3b3JkLCByYW5nZVJ1bGVzLCBwcmVzZW50UnVsZXNGb3JLZXksIHNlZW5SdWxlcykge1xuICAgIHJhbmdlUnVsZXMuZm9yRWFjaChmdW5jdGlvbiAocmFuZ2VSdWxlKSB7XG4gICAgICAgIHZhciBuZXdSdWxlID0gT2JqZWN0LmFzc2lnbih7fSwgcmFuZ2VSdWxlKTtcbiAgICAgICAgbmV3UnVsZS5sb3dlcmNhc2V3b3JkID0gbGN3b3JkO1xuICAgICAgICBuZXdSdWxlLndvcmQgPSBsY3dvcmQ7XG4gICAgICAgIC8vaWYoKGxjd29yZCA9PT0gJ3NlcnZpY2VzJyB8fCBsY3dvcmQgPT09ICdzZXJ2aWNlJykgJiYgbmV3UnVsZS5yYW5nZS5ydWxlLmxvd2VyY2FzZXdvcmQuaW5kZXhPZignb2RhdGEnKT49MCkge1xuICAgICAgICAvLyAgICBjb25zb2xlLmxvZyhcImFkZGluZyBcIisgSlNPTi5zdHJpbmdpZnkobmV3UnVsZSkgKyBcIlxcblwiKTtcbiAgICAgICAgLy99XG4gICAgICAgIC8vdG9kbzogY2hlY2sgd2hldGhlciBhbiBlcXVpdmFsZW50IHJ1bGUgaXMgYWxyZWFkeSBwcmVzZW50P1xuICAgICAgICB2YXIgY250ID0gcnVsZXMubGVuZ3RoO1xuICAgICAgICBpbnNlcnRSdWxlSWZOb3RQcmVzZW50KHJ1bGVzLCBuZXdSdWxlLCBzZWVuUnVsZXMpO1xuICAgIH0pO1xufVxuZXhwb3J0cy5hZGRSYW5nZVJ1bGVzVW5sZXNzUHJlc2VudCA9IGFkZFJhbmdlUnVsZXNVbmxlc3NQcmVzZW50O1xuZnVuY3Rpb24gYWRkQ2xvc2VFeGFjdFJhbmdlUnVsZXMocnVsZXMsIHNlZW5SdWxlcykge1xuICAgIHZhciBrZXlzTWFwID0ge307XG4gICAgdmFyIHJhbmdlS2V5c01hcCA9IHt9O1xuICAgIHJ1bGVzLmZvckVhY2goZnVuY3Rpb24gKHJ1bGUpIHtcbiAgICAgICAgaWYgKHJ1bGUudHlwZSA9PT0gMCAvKiBXT1JEICovKSB7XG4gICAgICAgICAgICAvL2tleXNNYXBbcnVsZS5sb3dlcmNhc2V3b3JkXSA9IDE7XG4gICAgICAgICAgICBrZXlzTWFwW3J1bGUubG93ZXJjYXNld29yZF0gPSBrZXlzTWFwW3J1bGUubG93ZXJjYXNld29yZF0gfHwgW107XG4gICAgICAgICAgICBrZXlzTWFwW3J1bGUubG93ZXJjYXNld29yZF0ucHVzaChydWxlKTtcbiAgICAgICAgICAgIGlmICghcnVsZS5leGFjdE9ubHkgJiYgcnVsZS5yYW5nZSkge1xuICAgICAgICAgICAgICAgIHJhbmdlS2V5c01hcFtydWxlLmxvd2VyY2FzZXdvcmRdID0gcmFuZ2VLZXlzTWFwW3J1bGUubG93ZXJjYXNld29yZF0gfHwgW107XG4gICAgICAgICAgICAgICAgcmFuZ2VLZXlzTWFwW3J1bGUubG93ZXJjYXNld29yZF0ucHVzaChydWxlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH0pO1xuICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXMoa2V5c01hcCk7XG4gICAga2V5cy5zb3J0KGNtcExlbmd0aFNvcnQpO1xuICAgIHZhciBsZW4gPSAwO1xuICAgIGtleXMuZm9yRWFjaChmdW5jdGlvbiAoa2V5LCBpbmRleCkge1xuICAgICAgICBpZiAoa2V5Lmxlbmd0aCAhPSBsZW4pIHtcbiAgICAgICAgfVxuICAgICAgICBsZW4gPSBrZXkubGVuZ3RoO1xuICAgIH0pO1xuICAgIC8vICAga2V5cyA9IGtleXMuc2xpY2UoMCwyMDAwKTtcbiAgICB2YXIgcmFuZ2VLZXlzID0gT2JqZWN0LmtleXMocmFuZ2VLZXlzTWFwKTtcbiAgICByYW5nZUtleXMuc29ydChjbXBMZW5ndGhTb3J0KTtcbiAgICAvL2NvbnNvbGUubG9nKGAgJHtrZXlzLmxlbmd0aH0ga2V5cyBhbmQgJHtyYW5nZUtleXMubGVuZ3RofSByYW5nZWtleXMgYCk7XG4gICAgdmFyIGxvdyA9IDA7XG4gICAgdmFyIGhpZ2ggPSAwO1xuICAgIHZhciBsYXN0bGVuID0gMDtcbiAgICB2YXIgb2Zmc2V0cyA9IFswLCAwLCAwLCAwLCAwLCAwXTtcbiAgICB2YXIgbGVuID0gcmFuZ2VLZXlzLmxlbmd0aDtcbiAgICBmaW5kTmV4dExlbigwLCBrZXlzLCBvZmZzZXRzKTtcbiAgICBmaW5kTmV4dExlbigxLCBrZXlzLCBvZmZzZXRzKTtcbiAgICBmaW5kTmV4dExlbigyLCBrZXlzLCBvZmZzZXRzKTtcbiAgICByYW5nZUtleXMuZm9yRWFjaChmdW5jdGlvbiAocmFuZ2VLZXkpIHtcbiAgICAgICAgaWYgKHJhbmdlS2V5Lmxlbmd0aCAhPT0gbGFzdGxlbikge1xuICAgICAgICAgICAgZm9yIChpID0gbGFzdGxlbiArIDE7IGkgPD0gcmFuZ2VLZXkubGVuZ3RoOyArK2kpIHtcbiAgICAgICAgICAgICAgICBmaW5kTmV4dExlbihpICsgMiwga2V5cywgb2Zmc2V0cyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyAgIGNvbnNvbGUubG9nKGAgc2hpZnRlZCB0byAke3JhbmdlS2V5Lmxlbmd0aH0gd2l0aCBvZmZzZXRzIGJlZWluZyAke29mZnNldHMuam9pbignICcpfWApO1xuICAgICAgICAgICAgLy8gICBjb25zb2xlLmxvZyhgIGhlcmUgMCAke29mZnNldHNbMF19IDogJHtrZXlzW01hdGgubWluKGtleXMubGVuZ3RoLTEsIG9mZnNldHNbMF0pXS5sZW5ndGh9ICAke2tleXNbTWF0aC5taW4oa2V5cy5sZW5ndGgtMSwgb2Zmc2V0c1swXSldfSBgKTtcbiAgICAgICAgICAgIC8vICBjb25zb2xlLmxvZyhgIGhlcmUgNS0xICAke2tleXNbb2Zmc2V0c1s1XS0xXS5sZW5ndGh9ICAke2tleXNbb2Zmc2V0c1s1XS0xXX0gYCk7XG4gICAgICAgICAgICAvLyAgIGNvbnNvbGUubG9nKGAgaGVyZSA1ICR7b2Zmc2V0c1s1XX0gOiAke2tleXNbTWF0aC5taW4oa2V5cy5sZW5ndGgtMSwgb2Zmc2V0c1s1XSldLmxlbmd0aH0gICR7a2V5c1tNYXRoLm1pbihrZXlzLmxlbmd0aC0xLCBvZmZzZXRzWzVdKV19IGApO1xuICAgICAgICAgICAgbGFzdGxlbiA9IHJhbmdlS2V5Lmxlbmd0aDtcbiAgICAgICAgfVxuICAgICAgICBmb3IgKHZhciBpID0gb2Zmc2V0c1swXTsgaSA8IG9mZnNldHNbNV07ICsraSkge1xuICAgICAgICAgICAgdmFyIGQgPSBEaXN0YW5jZS5jYWxjRGlzdGFuY2VBZGp1c3RlZChyYW5nZUtleSwga2V5c1tpXSk7XG4gICAgICAgICAgICAvLyBjb25zb2xlLmxvZyhgJHtyYW5nZUtleS5sZW5ndGgta2V5c1tpXS5sZW5ndGh9ICR7ZH0gJHtyYW5nZUtleX0gYW5kICR7a2V5c1tpXX0gIGApO1xuICAgICAgICAgICAgaWYgKChkICE9PSAxLjApICYmIChkID49IEFsZ29sLkN1dG9mZl9yYW5nZUNsb3NlTWF0Y2gpKSB7XG4gICAgICAgICAgICAgICAgLy9jb25zb2xlLmxvZyhgd291bGQgYWRkICR7cmFuZ2VLZXl9IGZvciAke2tleXNbaV19ICR7ZH1gKTtcbiAgICAgICAgICAgICAgICB2YXIgY250ID0gcnVsZXMubGVuZ3RoO1xuICAgICAgICAgICAgICAgIC8vIHdlIG9ubHkgaGF2ZSB0byBhZGQgaWYgdGhlcmUgaXMgbm90IHlldCBhIG1hdGNoIHJ1bGUgaGVyZSB3aGljaCBwb2ludHMgdG8gdGhlIHNhbWVcbiAgICAgICAgICAgICAgICBhZGRSYW5nZVJ1bGVzVW5sZXNzUHJlc2VudChydWxlcywga2V5c1tpXSwgcmFuZ2VLZXlzTWFwW3JhbmdlS2V5XSwga2V5c01hcFtrZXlzW2ldXSwgc2VlblJ1bGVzKTtcbiAgICAgICAgICAgICAgICBpZiAocnVsZXMubGVuZ3RoID4gY250KSB7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG4gICAgLypcbiAgICBbXG4gICAgICAgIFsnYUVGRycsJ2FFRkdIJ10sXG4gICAgICAgIFsnYUVGR0gnLCdhRUZHSEknXSxcbiAgICAgICAgWydPZGF0YScsJ09EYXRhcyddLFxuICAgWydPZGF0YScsJ09kYXRhcyddLFxuICAgWydPZGF0YScsJ09kYXRiJ10sXG4gICBbJ09kYXRhJywnVURhdGEnXSxcbiAgIFsnc2VydmljZScsJ3NlcnZpY2VzJ10sXG4gICBbJ3RoaXMgaXNmdW5ueSBhbmQgbW9yZScsJ3RoaXMgaXNmdW5ueSBhbmQgbW9yZXMnXSxcbiAgICBdLmZvckVhY2gocmVjID0+IHtcbiAgICAgICAgY29uc29sZS5sb2coYGRpc3RhbmNlICR7cmVjWzBdfSAke3JlY1sxXX0gOiAke0Rpc3RhbmNlLmNhbGNEaXN0YW5jZShyZWNbMF0scmVjWzFdKX0gIGFkZiAke0Rpc3RhbmNlLmNhbGNEaXN0YW5jZUFkanVzdGVkKHJlY1swXSxyZWNbMV0pfSBgKTtcblxuICAgIH0pO1xuICAgIGNvbnNvbGUubG9nKFwiZGlzdGFuY2UgT2RhdGEgVWRhdGFcIisgRGlzdGFuY2UuY2FsY0Rpc3RhbmNlKCdPRGF0YScsJ1VEYXRhJykpO1xuICAgIGNvbnNvbGUubG9nKFwiZGlzdGFuY2UgT2RhdGEgT2RhdGJcIisgRGlzdGFuY2UuY2FsY0Rpc3RhbmNlKCdPRGF0YScsJ09EYXRiJykpO1xuICAgIGNvbnNvbGUubG9nKFwiZGlzdGFuY2UgT2RhdGFzIE9kYXRhXCIrIERpc3RhbmNlLmNhbGNEaXN0YW5jZSgnT0RhdGEnLCdPRGF0YWEnKSk7XG4gICAgY29uc29sZS5sb2coXCJkaXN0YW5jZSBPZGF0YXMgYWJjZGVcIisgRGlzdGFuY2UuY2FsY0Rpc3RhbmNlKCdhYmNkZScsJ2FiY2RlZicpKTtcbiAgICBjb25zb2xlLmxvZyhcImRpc3RhbmNlIHNlcnZpY2VzIFwiKyBEaXN0YW5jZS5jYWxjRGlzdGFuY2UoJ3NlcnZpY2VzJywnc2VydmljZScpKTtcbiAgICAqL1xufVxuZXhwb3J0cy5hZGRDbG9zZUV4YWN0UmFuZ2VSdWxlcyA9IGFkZENsb3NlRXhhY3RSYW5nZVJ1bGVzO1xudmFyIG4gPSAwO1xuZnVuY3Rpb24gbG9hZE1vZGVscyhtb2RlbFBhdGgpIHtcbiAgICB2YXIgb01vZGVsO1xuICAgIG9Nb2RlbCA9IHtcbiAgICAgICAgZnVsbDogeyBkb21haW46IHt9IH0sXG4gICAgICAgIHJhd01vZGVsczoge30sXG4gICAgICAgIGRvbWFpbnM6IFtdLFxuICAgICAgICB0b29sczogW10sXG4gICAgICAgIHJ1bGVzOiB1bmRlZmluZWQsXG4gICAgICAgIGNhdGVnb3J5OiBbXSxcbiAgICAgICAgb3BlcmF0b3JzOiB7fSxcbiAgICAgICAgbVJ1bGVzOiBbXSxcbiAgICAgICAgc2VlblJ1bGVzOiB7fSxcbiAgICAgICAgcmVjb3JkczogW10sXG4gICAgICAgIG1ldGE6IHsgdDM6IHt9IH1cbiAgICB9O1xuICAgIHZhciB0ID0gRGF0ZS5ub3coKTtcbiAgICBtb2RlbFBhdGggPSBtb2RlbFBhdGggfHwgZW52TW9kZWxQYXRoO1xuICAgIHRyeSB7XG4gICAgICAgIHZhciBhID0gQ2lyY3VsYXJTZXIubG9hZCgnLi8nICsgbW9kZWxQYXRoICsgJy9fY2FjaGVmYWxzZS5qcycpO1xuICAgICAgICAvL2NvbnNvbGUubG9nKFwiZm91bmQgYSBjYWNoZSA/ICBcIiArICEhYSk7XG4gICAgICAgIC8vYSA9IHVuZGVmaW5lZDtcbiAgICAgICAgaWYgKGEpIHtcbiAgICAgICAgICAgIGRlYnVnbG9nKFwiIHJldHVybiBwcmVwYXJlc2UgbW9kZWwgXCIpO1xuICAgICAgICAgICAgaWYgKHByb2Nlc3MuZW52LkFCT1RfRU1BSUxfVVNFUikge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwibG9hZGVkIG1vZGVscyBmcm9tIGNhY2hlIGluIFwiICsgKERhdGUubm93KCkgLSB0KSArIFwiIFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBhO1xuICAgICAgICB9XG4gICAgfVxuICAgIGNhdGNoIChlKSB7XG4gICAgfVxuICAgIHZhciBzbWRscyA9IGZzLnJlYWRGaWxlU3luYygnLi8nICsgbW9kZWxQYXRoICsgJy9tb2RlbHMuanNvbicsICd1dGYtOCcpO1xuICAgIHZhciBtZGxzID0gSlNPTi5wYXJzZShcIlwiICsgc21kbHMpO1xuICAgIG1kbHMuZm9yRWFjaChmdW5jdGlvbiAoc01vZGVsTmFtZSkge1xuICAgICAgICBsb2FkTW9kZWwobW9kZWxQYXRoLCBzTW9kZWxOYW1lLCBvTW9kZWwpO1xuICAgIH0pO1xuICAgIC8vIGFkZCB0aGUgY2F0ZWdvcmllcyB0byB0aGUgbW9kZWw6XG4gICAgLypcbiAgICBvTW9kZWwuY2F0ZWdvcnkuZm9yRWFjaChmdW5jdGlvbiAoY2F0ZWdvcnkpIHtcbiAgICAgICAgaW5zZXJ0UnVsZUlmTm90UHJlc2VudChvTW9kZWwubVJ1bGVzLCB7XG4gICAgICAgICAgICBjYXRlZ29yeTogXCJjYXRlZ29yeVwiLFxuICAgICAgICAgICAgbWF0Y2hlZFN0cmluZzogY2F0ZWdvcnksXG4gICAgICAgICAgICB0eXBlOiBJTWF0Y2guRW51bVJ1bGVUeXBlLldPUkQsXG4gICAgICAgICAgICB3b3JkOiBjYXRlZ29yeSxcbiAgICAgICAgICAgIGxvd2VyY2FzZXdvcmQ6IGNhdGVnb3J5LnRvTG93ZXJDYXNlKCksXG4gICAgICAgICAgICBiaXRpbmRleCA6IG9NZGwuXG4gICAgICAgICAgICBfcmFua2luZzogMC45NVxuICAgICAgICB9LCBvTW9kZWwuc2VlblJ1bGVzKTtcbiAgICB9KTtcbiAgICAqL1xuICAgIHZhciBtZXRhQml0SW5kZXggPSBnZXREb21haW5CaXRJbmRleCgnbWV0YScsIG9Nb2RlbCk7XG4gICAgLy8gYWRkIHRoZSBkb21haW4gbWV0YSBydWxlXG4gICAgaW5zZXJ0UnVsZUlmTm90UHJlc2VudChvTW9kZWwubVJ1bGVzLCB7XG4gICAgICAgIGNhdGVnb3J5OiBcIm1ldGFcIixcbiAgICAgICAgbWF0Y2hlZFN0cmluZzogXCJkb21haW5cIixcbiAgICAgICAgdHlwZTogMCAvKiBXT1JEICovLFxuICAgICAgICB3b3JkOiBcImRvbWFpblwiLFxuICAgICAgICBiaXRpbmRleDogbWV0YUJpdEluZGV4LFxuICAgICAgICBfcmFua2luZzogMC45NVxuICAgIH0sIG9Nb2RlbC5zZWVuUnVsZXMpO1xuICAgIHZhciBmaWxsZXJCaXRJbmRleCA9IGdldERvbWFpbkJpdEluZGV4KCdtZXRhJywgb01vZGVsKTtcbiAgICAvL2FkZCBhIGZpbGxlciBydWxlXG4gICAgdmFyIHNmaWxsZXJzID0gZnMucmVhZEZpbGVTeW5jKCcuLycgKyBtb2RlbFBhdGggKyAnL2ZpbGxlci5qc29uJywgJ3V0Zi04Jyk7XG4gICAgdmFyIGZpbGxlcnMgPSBKU09OLnBhcnNlKHNmaWxsZXJzKTtcbiAgICB2YXIgcmUgPSBcIl4oKFwiICsgZmlsbGVycy5qb2luKFwiKXwoXCIpICsgXCIpKSRcIjtcbiAgICBvTW9kZWwubVJ1bGVzLnB1c2goe1xuICAgICAgICBjYXRlZ29yeTogXCJmaWxsZXJcIixcbiAgICAgICAgdHlwZTogMSAvKiBSRUdFWFAgKi8sXG4gICAgICAgIHJlZ2V4cDogbmV3IFJlZ0V4cChyZSwgXCJpXCIpLFxuICAgICAgICBtYXRjaGVkU3RyaW5nOiBcImZpbGxlclwiLFxuICAgICAgICBiaXRpbmRleDogZmlsbGVyQml0SW5kZXgsXG4gICAgICAgIF9yYW5raW5nOiAwLjlcbiAgICB9KTtcbiAgICAvL2FkZCBvcGVyYXRvcnNcbiAgICB2YXIgc09wZXJhdG9ycyA9IGZzLnJlYWRGaWxlU3luYygnLi9yZXNvdXJjZXMvbW9kZWwvb3BlcmF0b3JzLmpzb24nLCAndXRmLTgnKTtcbiAgICB2YXIgb3BlcmF0b3JzID0gSlNPTi5wYXJzZShzT3BlcmF0b3JzKTtcbiAgICB2YXIgb3BlcmF0b3JCaXRJbmRleCA9IGdldERvbWFpbkJpdEluZGV4KCdvcGVyYXRvcnMnLCBvTW9kZWwpO1xuICAgIE9iamVjdC5rZXlzKG9wZXJhdG9ycy5vcGVyYXRvcnMpLmZvckVhY2goZnVuY3Rpb24gKG9wZXJhdG9yKSB7XG4gICAgICAgIGlmIChJTWF0Y2guYU9wZXJhdG9yTmFtZXMuaW5kZXhPZihvcGVyYXRvcikgPCAwKSB7XG4gICAgICAgICAgICBkZWJ1Z2xvZyhcInVua25vd24gb3BlcmF0b3IgXCIgKyBvcGVyYXRvcik7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJ1bmtub3duIG9wZXJhdG9yIFwiICsgb3BlcmF0b3IpO1xuICAgICAgICB9XG4gICAgICAgIG9Nb2RlbC5vcGVyYXRvcnNbb3BlcmF0b3JdID0gb3BlcmF0b3JzLm9wZXJhdG9yc1tvcGVyYXRvcl07XG4gICAgICAgIG9Nb2RlbC5vcGVyYXRvcnNbb3BlcmF0b3JdLm9wZXJhdG9yID0gb3BlcmF0b3I7XG4gICAgICAgIE9iamVjdC5mcmVlemUob01vZGVsLm9wZXJhdG9yc1tvcGVyYXRvcl0pO1xuICAgICAgICB2YXIgd29yZCA9IG9wZXJhdG9yO1xuICAgICAgICBpbnNlcnRSdWxlSWZOb3RQcmVzZW50KG9Nb2RlbC5tUnVsZXMsIHtcbiAgICAgICAgICAgIGNhdGVnb3J5OiBcIm9wZXJhdG9yXCIsXG4gICAgICAgICAgICB3b3JkOiB3b3JkLnRvTG93ZXJDYXNlKCksXG4gICAgICAgICAgICBsb3dlcmNhc2V3b3JkOiB3b3JkLnRvTG93ZXJDYXNlKCksXG4gICAgICAgICAgICB0eXBlOiAwIC8qIFdPUkQgKi8sXG4gICAgICAgICAgICBtYXRjaGVkU3RyaW5nOiB3b3JkLFxuICAgICAgICAgICAgYml0aW5kZXg6IG9wZXJhdG9yQml0SW5kZXgsXG4gICAgICAgICAgICBfcmFua2luZzogMC45XG4gICAgICAgIH0sIG9Nb2RlbC5zZWVuUnVsZXMpO1xuICAgICAgICAvLyBhZGQgYWxsIHN5bm9ueW1zXG4gICAgICAgIGlmIChvcGVyYXRvcnMuc3lub255bXNbb3BlcmF0b3JdKSB7XG4gICAgICAgICAgICBPYmplY3Qua2V5cyhvcGVyYXRvcnMuc3lub255bXNbb3BlcmF0b3JdKS5mb3JFYWNoKGZ1bmN0aW9uIChzeW5vbnltKSB7XG4gICAgICAgICAgICAgICAgaW5zZXJ0UnVsZUlmTm90UHJlc2VudChvTW9kZWwubVJ1bGVzLCB7XG4gICAgICAgICAgICAgICAgICAgIGNhdGVnb3J5OiBcIm9wZXJhdG9yXCIsXG4gICAgICAgICAgICAgICAgICAgIHdvcmQ6IHN5bm9ueW0udG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgICAgICAgICAgbG93ZXJjYXNld29yZDogc3lub255bS50b0xvd2VyQ2FzZSgpLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAwIC8qIFdPUkQgKi8sXG4gICAgICAgICAgICAgICAgICAgIG1hdGNoZWRTdHJpbmc6IG9wZXJhdG9yLFxuICAgICAgICAgICAgICAgICAgICBiaXRpbmRleDogb3BlcmF0b3JCaXRJbmRleCxcbiAgICAgICAgICAgICAgICAgICAgX3Jhbmtpbmc6IDAuOVxuICAgICAgICAgICAgICAgIH0sIG9Nb2RlbC5zZWVuUnVsZXMpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICAvKlxuICAgICAgICB9KVxuICAgICAgICAgICAge1xuICAgICAgICAgIGNhdGVnb3J5OiBcImZpbGxlclwiLFxuICAgICAgICAgIHR5cGU6IDEsXG4gICAgICAgICAgcmVnZXhwOiAvXigoc3RhcnQpfChzaG93KXwoZnJvbSl8KGluKSkkL2ksXG4gICAgICAgICAgbWF0Y2hlZFN0cmluZzogXCJmaWxsZXJcIixcbiAgICAgICAgICBfcmFua2luZzogMC45XG4gICAgICAgIH0sXG4gICAgKi9cbiAgICBvTW9kZWwubVJ1bGVzID0gb01vZGVsLm1SdWxlcy5zb3J0KElucHV0RmlsdGVyUnVsZXMuY21wTVJ1bGUpO1xuICAgIGFkZENsb3NlRXhhY3RSYW5nZVJ1bGVzKG9Nb2RlbC5tUnVsZXMsIG9Nb2RlbC5zZWVuUnVsZXMpO1xuICAgIG9Nb2RlbC5tUnVsZXMgPSBvTW9kZWwubVJ1bGVzLnNvcnQoSW5wdXRGaWx0ZXJSdWxlcy5jbXBNUnVsZSk7XG4gICAgaWYgKGdsb2JhbCAmJiBnbG9iYWwuZ2MpIHtcbiAgICAgICAgZ2xvYmFsLmdjKCk7XG4gICAgfVxuICAgIG9Nb2RlbC5ydWxlcyA9IHNwbGl0UnVsZXMob01vZGVsLm1SdWxlcyk7XG4gICAgaWYgKGdsb2JhbCAmJiBnbG9iYWwuZ2MpIHtcbiAgICAgICAgZ2xvYmFsLmdjKCk7XG4gICAgfVxuICAgIG9Nb2RlbC50b29scyA9IG9Nb2RlbC50b29scy5zb3J0KFRvb2xzLmNtcFRvb2xzKTtcbiAgICBkZWxldGUgb01vZGVsLnNlZW5SdWxlcztcbiAgICBkZWJ1Z2xvZygnc2F2aW5nJyk7XG4gICAgaWYgKGdsb2JhbCAmJiBnbG9iYWwuZ2MpIHtcbiAgICAgICAgZ2xvYmFsLmdjKCk7XG4gICAgfVxuICAgIENpcmN1bGFyU2VyLnNhdmUoJy4vJyArIG1vZGVsUGF0aCArICcvX2NhY2hlZmFsc2UuanMnLCBvTW9kZWwpO1xuICAgIGlmIChnbG9iYWwgJiYgZ2xvYmFsLmdjKSB7XG4gICAgICAgIGdsb2JhbC5nYygpO1xuICAgIH1cbiAgICBpZiAocHJvY2Vzcy5lbnYuQUJPVF9FTUFJTF9VU0VSKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwibG9hZGVkIG1vZGVscyBieSBjYWxjdWxhdGlvbiBpbiBcIiArIChEYXRlLm5vdygpIC0gdCkgKyBcIiBcIik7XG4gICAgfVxuICAgIHJldHVybiBvTW9kZWw7XG59XG5leHBvcnRzLmxvYWRNb2RlbHMgPSBsb2FkTW9kZWxzO1xuZnVuY3Rpb24gc29ydENhdGVnb3JpZXNCeUltcG9ydGFuY2UobWFwLCBjYXRzKSB7XG4gICAgdmFyIHJlcyA9IGNhdHMuc2xpY2UoMCk7XG4gICAgcmVzLnNvcnQocmFua0NhdGVnb3J5QnlJbXBvcnRhbmNlLmJpbmQodW5kZWZpbmVkLCBtYXApKTtcbiAgICByZXR1cm4gcmVzO1xufVxuZXhwb3J0cy5zb3J0Q2F0ZWdvcmllc0J5SW1wb3J0YW5jZSA9IHNvcnRDYXRlZ29yaWVzQnlJbXBvcnRhbmNlO1xuZnVuY3Rpb24gcmFua0NhdGVnb3J5QnlJbXBvcnRhbmNlKG1hcCwgY2F0YSwgY2F0Yikge1xuICAgIHZhciBjYXRBRGVzYyA9IG1hcFtjYXRhXTtcbiAgICB2YXIgY2F0QkRlc2MgPSBtYXBbY2F0Yl07XG4gICAgaWYgKGNhdGEgPT09IGNhdGIpIHtcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgfVxuICAgIC8vIGlmIGEgaXMgYmVmb3JlIGIsIHJldHVybiAtMVxuICAgIGlmIChjYXRBRGVzYyAmJiAhY2F0QkRlc2MpIHtcbiAgICAgICAgcmV0dXJuIC0xO1xuICAgIH1cbiAgICBpZiAoIWNhdEFEZXNjICYmIGNhdEJEZXNjKSB7XG4gICAgICAgIHJldHVybiArMTtcbiAgICB9XG4gICAgdmFyIHByaW9BID0gKGNhdEFEZXNjICYmIGNhdEFEZXNjLmltcG9ydGFuY2UpIHx8IDk5O1xuICAgIHZhciBwcmlvQiA9IChjYXRCRGVzYyAmJiBjYXRCRGVzYy5pbXBvcnRhbmNlKSB8fCA5OTtcbiAgICAvLyBsb3dlciBwcmlvIGdvZXMgdG8gZnJvbnRcbiAgICB2YXIgciA9IHByaW9BIC0gcHJpb0I7XG4gICAgaWYgKHIpIHtcbiAgICAgICAgcmV0dXJuIHI7XG4gICAgfVxuICAgIHJldHVybiBjYXRhLmxvY2FsZUNvbXBhcmUoY2F0Yik7XG59XG5leHBvcnRzLnJhbmtDYXRlZ29yeUJ5SW1wb3J0YW5jZSA9IHJhbmtDYXRlZ29yeUJ5SW1wb3J0YW5jZTtcbnZhciBNZXRhRiA9IE1ldGEuZ2V0TWV0YUZhY3RvcnkoKTtcbmZ1bmN0aW9uIGdldE9wZXJhdG9yKG1kbCwgb3BlcmF0b3IpIHtcbiAgICByZXR1cm4gbWRsLm9wZXJhdG9yc1tvcGVyYXRvcl07XG59XG5leHBvcnRzLmdldE9wZXJhdG9yID0gZ2V0T3BlcmF0b3I7XG5mdW5jdGlvbiBnZXRSZXN1bHRBc0FycmF5KG1kbCwgYSwgcmVsKSB7XG4gICAgaWYgKHJlbC50b1R5cGUoKSAhPT0gJ3JlbGF0aW9uJykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJleHBlY3QgcmVsYXRpb24gYXMgMm5kIGFyZ1wiKTtcbiAgICB9XG4gICAgdmFyIHJlcyA9IG1kbC5tZXRhLnQzW2EudG9GdWxsU3RyaW5nKCldICYmXG4gICAgICAgIG1kbC5tZXRhLnQzW2EudG9GdWxsU3RyaW5nKCldW3JlbC50b0Z1bGxTdHJpbmcoKV07XG4gICAgaWYgKCFyZXMpIHtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgICByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMocmVzKS5zb3J0KCkubWFwKE1ldGFGLnBhcnNlSU1ldGEpO1xufVxuZXhwb3J0cy5nZXRSZXN1bHRBc0FycmF5ID0gZ2V0UmVzdWx0QXNBcnJheTtcbmZ1bmN0aW9uIGdldENhdGVnb3JpZXNGb3JEb21haW4odGhlTW9kZWwsIGRvbWFpbikge1xuICAgIGlmICh0aGVNb2RlbC5kb21haW5zLmluZGV4T2YoZG9tYWluKSA8IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRG9tYWluIFxcXCJcIiArIGRvbWFpbiArIFwiXFxcIiBub3QgcGFydCBvZiBtb2RlbFwiKTtcbiAgICB9XG4gICAgdmFyIHJlcyA9IGdldFJlc3VsdEFzQXJyYXkodGhlTW9kZWwsIE1ldGFGLkRvbWFpbihkb21haW4pLCBNZXRhRi5SZWxhdGlvbihNZXRhLlJFTEFUSU9OX2hhc0NhdGVnb3J5KSk7XG4gICAgcmV0dXJuIE1ldGEuZ2V0U3RyaW5nQXJyYXkocmVzKTtcbn1cbmV4cG9ydHMuZ2V0Q2F0ZWdvcmllc0ZvckRvbWFpbiA9IGdldENhdGVnb3JpZXNGb3JEb21haW47XG5mdW5jdGlvbiBnZXRUYWJsZUNvbHVtbnModGhlTW9kZWwsIGRvbWFpbikge1xuICAgIGlmICh0aGVNb2RlbC5kb21haW5zLmluZGV4T2YoZG9tYWluKSA8IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRG9tYWluIFxcXCJcIiArIGRvbWFpbiArIFwiXFxcIiBub3QgcGFydCBvZiBtb2RlbFwiKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoZU1vZGVsLnJhd01vZGVsc1tkb21haW5dLmNvbHVtbnMuc2xpY2UoMCk7XG59XG5leHBvcnRzLmdldFRhYmxlQ29sdW1ucyA9IGdldFRhYmxlQ29sdW1ucztcbi8qKlxuICogUmV0dXJuIGFsbCBjYXRlZ29yaWVzIG9mIGEgZG9tYWluIHdoaWNoIGNhbiBhcHBlYXIgb24gYSB3b3JkLFxuICogdGhlc2UgYXJlIHR5cGljYWxseSB0aGUgd29yZGluZGV4IGRvbWFpbnMgKyBlbnRyaWVzIGdlbmVyYXRlZCBieSBnZW5lcmljIHJ1bGVzXG4gKlxuICogVGhlIGN1cnJlbnQgaW1wbGVtZW50YXRpb24gaXMgYSBzaW1wbGlmaWNhdGlvblxuICovXG5mdW5jdGlvbiBnZXRQb3RlbnRpYWxXb3JkQ2F0ZWdvcmllc0ZvckRvbWFpbih0aGVNb2RlbCwgZG9tYWluKSB7XG4gICAgLy8gdGhpcyBpcyBhIHNpbXBsaWZpZWQgdmVyc2lvblxuICAgIHJldHVybiBnZXRDYXRlZ29yaWVzRm9yRG9tYWluKHRoZU1vZGVsLCBkb21haW4pO1xufVxuZXhwb3J0cy5nZXRQb3RlbnRpYWxXb3JkQ2F0ZWdvcmllc0ZvckRvbWFpbiA9IGdldFBvdGVudGlhbFdvcmRDYXRlZ29yaWVzRm9yRG9tYWluO1xuZnVuY3Rpb24gZ2V0RG9tYWluc0ZvckNhdGVnb3J5KHRoZU1vZGVsLCBjYXRlZ29yeSkge1xuICAgIGlmICh0aGVNb2RlbC5jYXRlZ29yeS5pbmRleE9mKGNhdGVnb3J5KSA8IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ2F0ZWdvcnkgXFxcIlwiICsgY2F0ZWdvcnkgKyBcIlxcXCIgbm90IHBhcnQgb2YgbW9kZWxcIik7XG4gICAgfVxuICAgIHZhciByZXMgPSBnZXRSZXN1bHRBc0FycmF5KHRoZU1vZGVsLCBNZXRhRi5DYXRlZ29yeShjYXRlZ29yeSksIE1ldGFGLlJlbGF0aW9uKE1ldGEuUkVMQVRJT05faXNDYXRlZ29yeU9mKSk7XG4gICAgcmV0dXJuIE1ldGEuZ2V0U3RyaW5nQXJyYXkocmVzKTtcbn1cbmV4cG9ydHMuZ2V0RG9tYWluc0ZvckNhdGVnb3J5ID0gZ2V0RG9tYWluc0ZvckNhdGVnb3J5O1xuZnVuY3Rpb24gZ2V0QWxsUmVjb3JkQ2F0ZWdvcmllc0ZvclRhcmdldENhdGVnb3J5KG1vZGVsLCBjYXRlZ29yeSwgd29yZHNvbmx5KSB7XG4gICAgdmFyIHJlcyA9IHt9O1xuICAgIC8vXG4gICAgdmFyIGZuID0gd29yZHNvbmx5ID8gZ2V0UG90ZW50aWFsV29yZENhdGVnb3JpZXNGb3JEb21haW4gOiBnZXRDYXRlZ29yaWVzRm9yRG9tYWluO1xuICAgIHZhciBkb21haW5zID0gZ2V0RG9tYWluc0ZvckNhdGVnb3J5KG1vZGVsLCBjYXRlZ29yeSk7XG4gICAgZG9tYWlucy5mb3JFYWNoKGZ1bmN0aW9uIChkb21haW4pIHtcbiAgICAgICAgZm4obW9kZWwsIGRvbWFpbikuZm9yRWFjaChmdW5jdGlvbiAod29yZGNhdCkge1xuICAgICAgICAgICAgcmVzW3dvcmRjYXRdID0gdHJ1ZTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gICAgT2JqZWN0LmZyZWV6ZShyZXMpO1xuICAgIHJldHVybiByZXM7XG59XG5leHBvcnRzLmdldEFsbFJlY29yZENhdGVnb3JpZXNGb3JUYXJnZXRDYXRlZ29yeSA9IGdldEFsbFJlY29yZENhdGVnb3JpZXNGb3JUYXJnZXRDYXRlZ29yeTtcbmZ1bmN0aW9uIGdldEFsbFJlY29yZENhdGVnb3JpZXNGb3JUYXJnZXRDYXRlZ29yaWVzKG1vZGVsLCBjYXRlZ29yaWVzLCB3b3Jkc29ubHkpIHtcbiAgICB2YXIgcmVzID0ge307XG4gICAgLy9cbiAgICB2YXIgZm4gPSB3b3Jkc29ubHkgPyBnZXRQb3RlbnRpYWxXb3JkQ2F0ZWdvcmllc0ZvckRvbWFpbiA6IGdldENhdGVnb3JpZXNGb3JEb21haW47XG4gICAgdmFyIGRvbWFpbnMgPSB1bmRlZmluZWQ7XG4gICAgY2F0ZWdvcmllcy5mb3JFYWNoKGZ1bmN0aW9uIChjYXRlZ29yeSkge1xuICAgICAgICB2YXIgY2F0ZG9tYWlucyA9IGdldERvbWFpbnNGb3JDYXRlZ29yeShtb2RlbCwgY2F0ZWdvcnkpO1xuICAgICAgICBpZiAoIWRvbWFpbnMpIHtcbiAgICAgICAgICAgIGRvbWFpbnMgPSBjYXRkb21haW5zO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgZG9tYWlucyA9IF8uaW50ZXJzZWN0aW9uKGRvbWFpbnMsIGNhdGRvbWFpbnMpO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgaWYgKGRvbWFpbnMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignY2F0ZWdvcmllcyAnICsgVXRpbHMubGlzdFRvUXVvdGVkQ29tbWFBbmQoY2F0ZWdvcmllcykgKyAnIGhhdmUgbm8gY29tbW9uIGRvbWFpbi4nKTtcbiAgICB9XG4gICAgZG9tYWlucy5mb3JFYWNoKGZ1bmN0aW9uIChkb21haW4pIHtcbiAgICAgICAgZm4obW9kZWwsIGRvbWFpbikuZm9yRWFjaChmdW5jdGlvbiAod29yZGNhdCkge1xuICAgICAgICAgICAgcmVzW3dvcmRjYXRdID0gdHJ1ZTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG4gICAgT2JqZWN0LmZyZWV6ZShyZXMpO1xuICAgIHJldHVybiByZXM7XG59XG5leHBvcnRzLmdldEFsbFJlY29yZENhdGVnb3JpZXNGb3JUYXJnZXRDYXRlZ29yaWVzID0gZ2V0QWxsUmVjb3JkQ2F0ZWdvcmllc0ZvclRhcmdldENhdGVnb3JpZXM7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
