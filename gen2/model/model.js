/**
 * Functionality managing the match models
 *
 * @file
 */
"use strict";

var debug = require("debug");
var debuglog = debug('model');
var logger = require("../utils/logger");
var loadlog = logger.logger('modelload', '');
var IMatch = require("../match/ifmatch");
var InputFilterRules = require("../match/inputFilterRules");
var Tools = require("../match/tools");
var fs = require("fs");
var Meta = require("./meta");
var Utils = require("../utils/utils");
var process = require("process");
var _ = require("lodash");
/**
 * the model path, may be controlled via environment variable
 */
var envModelPath = process.env["ABOT_MODELPATH"] || "testmodel";
;
var ARR_MODEL_PROPERTIES = ["domain", "bitindex", "categoryDescribed", "description", "tool", "toolhidden", "synonyms", "category", "wordindex", "exactmatch", "hidden"];
function addSynonyms(synonyms, category, synonymFor, bitindex, mRules, seen) {
    synonyms.forEach(function (syn) {
        var oRule = {
            category: category,
            matchedString: synonymFor,
            type: 0 /* WORD */
            , word: syn,
            bitindex: bitindex,
            _ranking: 0.95
        };
        debuglog("inserting synonym" + JSON.stringify(oRule));
        insertRuleIfNotPresent(mRules, oRule, seen);
    });
}
function getRuleKey(rule) {
    return rule.matchedString + "-|-" + rule.category + " -|- " + rule.type + " -|- " + rule.word + " ";
}
function insertRuleIfNotPresent(mRules, rule, seenRules) {
    if (rule.type !== 0 /* WORD */) {
            mRules.push(rule);
            return;
        }
    if (rule.word === undefined || rule.matchedString === undefined) {
        throw new Error('illegal rule' + JSON.stringify(rule, undefined, 2));
    }
    var r = getRuleKey(rule);
    rule.lowercaseword = rule.word.toLowerCase();
    if (seenRules[r]) {
        debuglog("Attempting to insert duplicate" + JSON.stringify(rule, undefined, 2));
        var duplicates = seenRules[r].filter(function (oEntry) {
            return 0 === InputFilterRules.compareMRuleFull(oEntry, rule);
        });
        if (duplicates.length > 0) {
            return;
        }
    }
    seenRules[r] = seenRules[r] || [];
    seenRules[r].push(rule);
    if (rule.word === "") {
        debuglog('Skipping rule with emtpy word ' + JSON.stringify(rule, undefined, 2));
        loadlog('Skipping rule with emtpy word ' + JSON.stringify(rule, undefined, 2));
        return;
    }
    mRules.push(rule);
    return;
}
function loadModelData(modelPath, oMdl, sModelName, oModel) {
    // read the data ->
    // data is processed into mRules directly,
    var bitindex = oMdl.bitindex;
    var sFileName = './' + modelPath + '/' + sModelName + ".data.json";
    var mdldata = fs.readFileSync(sFileName, 'utf-8');
    var oMdlData = JSON.parse(mdldata);
    oMdlData.forEach(function (oEntry) {
        if (!oEntry.tool) {
            oEntry._domain = oMdl.domain;
        }
        if (!oEntry.tool && oMdl.tool.name) {
            oEntry.tool = oMdl.tool.name;
        }
        oModel.records.push(oEntry);
        oMdl.category.forEach(function (cat) {
            if (oEntry[cat] === 'undefined') {
                oEntry[cat] = "n/a";
                var bug = "INCONSISTENT*> ModelData " + sFileName + " does not contain category " + cat + " with value 'undefined', undefined is illegal value, use n/a " + JSON.stringify(oEntry) + "";
                debuglog(bug);
            }
        });
        oMdl.wordindex.forEach(function (category) {
            if (oEntry[category] === undefined) {
                debuglog("INCONSISTENT*> ModelData " + sFileName + " does not contain category " + category + " of wordindex" + JSON.stringify(oEntry) + "");
                return;
            }
            if (oEntry[category] !== "*") {
                var sString = oEntry[category];
                debuglog("pushing rule with " + category + " -> " + sString);
                var oRule = {
                    category: category,
                    matchedString: sString,
                    type: 0 /* WORD */
                    , word: sString,
                    bitindex: bitindex,
                    _ranking: 0.95
                };
                if (oMdl.exactmatch && oMdl.exactmatch.indexOf(category) >= 0) {
                    oRule.exactOnly = true;
                }
                insertRuleIfNotPresent(oModel.mRules, oRule, oModel.seenRules);
                if (oMdlData.synonyms && oMdlData.synonyms[category]) {
                    addSynonyms(oMdlData.synonyms[category], category, sString, bitindex, oModel.mRules, oModel.seenRules);
                }
                if (oEntry.synonyms && oEntry.synonyms[category]) {
                    addSynonyms(oEntry.synonyms[category], category, sString, bitindex, oModel.mRules, oModel.seenRules);
                }
            }
        });
    });
}
function loadModel(modelPath, sModelName, oModel) {
    debuglog(" loading " + sModelName + " ....");
    var mdl = fs.readFileSync('./' + modelPath + '/' + sModelName + ".model.json", 'utf-8');
    var oMdl = JSON.parse(mdl);
    mergeModelJson(sModelName, oMdl, oModel);
    loadModelData(modelPath, oMdl, sModelName, oModel);
}
function getDomainBitIndex(domain, oModel) {
    var index = oModel.domains.indexOf(domain);
    if (index < 0) {
        index = oModel.domains.length;
    }
    if (index >= 32) {
        throw new Error("too many domain for single 32 bit index");
    }
    return 0x0001 << index;
}
exports.getDomainBitIndex = getDomainBitIndex;
function mergeModelJson(sModelName, oMdl, oModel) {
    var categoryDescribedMap = {};
    oMdl.bitindex = getDomainBitIndex(oMdl.domain, oModel);
    oMdl.categoryDescribed = [];
    // rectify category
    oMdl.category = oMdl.category.map(function (cat) {
        if (typeof cat === "string") {
            return cat;
        }
        if (typeof cat.name !== "string") {
            console.log("Missing name in object typed category in " + JSON.stringify(cat) + " in model " + sModelName);
            process.exit(-1);
        }
        categoryDescribedMap[cat.name] = cat;
        oMdl.categoryDescribed.push(cat);
        return cat.name;
    });
    // add the categories to the model:
    oMdl.category.forEach(function (category) {
        insertRuleIfNotPresent(oModel.mRules, {
            category: "category",
            matchedString: category,
            type: 0 /* WORD */
            , word: category,
            lowercaseword: category.toLowerCase(),
            bitindex: oMdl.bitindex,
            _ranking: 0.95
        }, oModel.seenRules);
    });
    if (oModel.domains.indexOf(oMdl.domain) >= 0) {
        debuglog("***********here mdl" + JSON.stringify(oMdl, undefined, 2));
        throw new Error('Domain ' + oMdl.domain + ' already loaded while loading ' + sModelName + '?');
    }
    // check properties of model
    Object.keys(oMdl).sort().forEach(function (sProperty) {
        if (ARR_MODEL_PROPERTIES.indexOf(sProperty) < 0) {
            throw new Error('Model property "' + sProperty + '" not a known model property in model of domain ' + oMdl.domain + ' ');
        }
    });
    oModel.full.domain[oMdl.domain] = {
        description: oMdl.description,
        categories: categoryDescribedMap,
        bitindex: oMdl.bitindex
    };
    // check that members of wordindex are in categories,
    oMdl.wordindex = oMdl.wordindex || [];
    oMdl.wordindex.forEach(function (sWordIndex) {
        if (oMdl.category.indexOf(sWordIndex) < 0) {
            throw new Error('Model wordindex "' + sWordIndex + '" not a category of domain ' + oMdl.domain + ' ');
        }
    });
    oMdl.exactmatch = oMdl.exactmatch || [];
    oMdl.exactmatch.forEach(function (sExactMatch) {
        if (oMdl.category.indexOf(sExactMatch) < 0) {
            throw new Error('Model exactmatch "' + sExactMatch + '" not a category of domain ' + oMdl.domain + ' ');
        }
    });
    // add relation domain -> category
    var domainStr = MetaF.Domain(oMdl.domain).toFullString();
    var relationStr = MetaF.Relation(Meta.RELATION_hasCategory).toFullString();
    var reverseRelationStr = MetaF.Relation(Meta.RELATION_isCategoryOf).toFullString();
    oMdl.category.forEach(function (sCategory) {
        var CategoryString = MetaF.Category(sCategory).toFullString();
        oModel.meta.t3[domainStr] = oModel.meta.t3[domainStr] || {};
        oModel.meta.t3[domainStr][relationStr] = oModel.meta.t3[domainStr][relationStr] || {};
        oModel.meta.t3[domainStr][relationStr][CategoryString] = {};
        oModel.meta.t3[CategoryString] = oModel.meta.t3[CategoryString] || {};
        oModel.meta.t3[CategoryString][reverseRelationStr] = oModel.meta.t3[CategoryString][reverseRelationStr] || {};
        oModel.meta.t3[CategoryString][reverseRelationStr][domainStr] = {};
    });
    // add a precice domain matchrule
    insertRuleIfNotPresent(oModel.mRules, {
        category: "domain",
        matchedString: oMdl.domain,
        type: 0 /* WORD */
        , word: oMdl.domain,
        bitindex: oMdl.bitindex,
        _ranking: 0.95
    }, oModel.seenRules);
    // check the tool
    if (oMdl.tool && oMdl.tool.requires) {
        var requires = Object.keys(oMdl.tool.requires || {});
        var diff = _.difference(requires, oMdl.category);
        if (diff.length > 0) {
            console.log(" " + oMdl.domain + " : Unkown category in requires of tool: \"" + diff.join('"') + '"');
            process.exit(-1);
        }
        var optional = Object.keys(oMdl.tool.optional);
        diff = _.difference(optional, oMdl.category);
        if (diff.length > 0) {
            console.log(" " + oMdl.domain + " : Unkown category optional of tool: \"" + diff.join('"') + '"');
            process.exit(-1);
        }
        Object.keys(oMdl.tool.sets || {}).forEach(function (setID) {
            var diff = _.difference(oMdl.tool.sets[setID].set, oMdl.category);
            if (diff.length > 0) {
                console.log(" " + oMdl.domain + " : Unkown category in setId " + setID + " of tool: \"" + diff.join('"') + '"');
                process.exit(-1);
            }
        });
        // extract tools an add to tools:
        oModel.tools.filter(function (oEntry) {
            if (oEntry.name === (oMdl.tool && oMdl.tool.name)) {
                console.log("Tool " + oMdl.tool.name + " already present when loading " + sModelName);
                //throw new Error('Domain already loaded?');
                process.exit(-1);
            }
        });
    } else {
        oMdl.toolhidden = true;
        oMdl.tool.requires = { "impossible": {} };
    }
    // add the tool name as rule unless hidden
    if (!oMdl.toolhidden && oMdl.tool && oMdl.tool.name) {
        insertRuleIfNotPresent(oModel.mRules, {
            category: "tool",
            matchedString: oMdl.tool.name,
            type: 0 /* WORD */
            , word: oMdl.tool.name,
            bitindex: oMdl.bitindex,
            _ranking: 0.95
        }, oModel.seenRules);
    }
    ;
    if (oMdl.synonyms && oMdl.synonyms["tool"]) {
        addSynonyms(oMdl.synonyms["tool"], "tool", oMdl.tool.name, oMdl.bitindex, oModel.mRules, oModel.seenRules);
    }
    ;
    if (oMdl.synonyms) {
        Object.keys(oMdl.synonyms).forEach(function (ssynkey) {
            if (oMdl.category.indexOf(ssynkey) >= 0 && ssynkey !== "tool") {
                if (oModel.full.domain[oMdl.domain].categories[ssynkey]) {
                    oModel.full.domain[oMdl.domain].categories[ssynkey].synonyms = oMdl.synonyms[ssynkey];
                }
                addSynonyms(oMdl.synonyms[ssynkey], "category", ssynkey, oMdl.bitindex, oModel.mRules, oModel.seenRules);
            }
        });
    }
    oModel.domains.push(oMdl.domain);
    if (oMdl.tool.name) {
        oModel.tools.push(oMdl.tool);
    }
    oModel.category = oModel.category.concat(oMdl.category);
    oModel.category.sort();
    oModel.category = oModel.category.filter(function (string, index) {
        return oModel.category[index] !== oModel.category[index + 1];
    });
} // loadmodel
function splitRules(rules) {
    var res = {};
    var nonWordRules = [];
    rules.forEach(function (rule) {
        if (rule.type === 0 /* WORD */) {
                if (!rule.lowercaseword) {
                    throw new Error("Rule has no member lowercaseword" + JSON.stringify(rule));
                }
                res[rule.lowercaseword] = res[rule.lowercaseword] || { bitindex: 0, rules: [] };
                res[rule.lowercaseword].bitindex = res[rule.lowercaseword].bitindex | rule.bitindex;
                res[rule.lowercaseword].rules.push(rule);
            } else {
            nonWordRules.push(rule);
        }
    });
    return {
        wordMap: res,
        nonWordRules: nonWordRules,
        allRules: rules
    };
}
exports.splitRules = splitRules;
function loadModels(modelPath) {
    var oModel;
    oModel = {
        full: { domain: {} },
        domains: [],
        tools: [],
        rules: undefined,
        category: [],
        operators: {},
        mRules: [],
        seenRules: {},
        records: [],
        meta: { t3: {} }
    };
    modelPath = modelPath || envModelPath;
    var smdls = fs.readFileSync('./' + modelPath + '/models.json', 'utf-8');
    var mdls = JSON.parse("" + smdls);
    mdls.forEach(function (sModelName) {
        loadModel(modelPath, sModelName, oModel);
    });
    // add the categories to the model:
    /*
    oModel.category.forEach(function (category) {
        insertRuleIfNotPresent(oModel.mRules, {
            category: "category",
            matchedString: category,
            type: IMatch.EnumRuleType.WORD,
            word: category,
            lowercaseword: category.toLowerCase(),
            bitindex : oMdl.
            _ranking: 0.95
        }, oModel.seenRules);
    });
    */
    var metaBitIndex = getDomainBitIndex('meta', oModel);
    // add the domain meta rule
    insertRuleIfNotPresent(oModel.mRules, {
        category: "meta",
        matchedString: "domain",
        type: 0 /* WORD */
        , word: "domain",
        bitindex: metaBitIndex,
        _ranking: 0.95
    }, oModel.seenRules);
    var fillerBitIndex = getDomainBitIndex('meta', oModel);
    //add a filler rule
    var sfillers = fs.readFileSync('./' + modelPath + '/filler.json', 'utf-8');
    var fillers = JSON.parse(sfillers);
    var re = "^((" + fillers.join(")|(") + "))$";
    oModel.mRules.push({
        category: "filler",
        type: 1 /* REGEXP */
        , regexp: new RegExp(re, "i"),
        matchedString: "filler",
        bitindex: fillerBitIndex,
        _ranking: 0.9
    });
    //add operators
    var sOperators = fs.readFileSync('./resources/model/operators.json', 'utf-8');
    var operators = JSON.parse(sOperators);
    var operatorBitIndex = getDomainBitIndex('operators', oModel);
    Object.keys(operators.operators).forEach(function (operator) {
        if (IMatch.aOperatorNames.indexOf(operator) < 0) {
            debuglog("unknown operator " + operator);
            throw new Error("unknown operator " + operator);
        }
        oModel.operators[operator] = operators.operators[operator];
        oModel.operators[operator].operator = operator;
        Object.freeze(oModel.operators[operator]);
        var word = operator;
        insertRuleIfNotPresent(oModel.mRules, {
            category: "operator",
            word: word.toLowerCase(),
            lowercaseword: word.toLowerCase(),
            type: 0 /* WORD */
            , matchedString: word,
            bitindex: operatorBitIndex,
            _ranking: 0.9
        }, oModel.seenRules);
        // add all synonyms
        if (operators.synonyms[operator]) {
            Object.keys(operators.synonyms[operator]).forEach(function (synonym) {
                insertRuleIfNotPresent(oModel.mRules, {
                    category: "operator",
                    word: synonym.toLowerCase(),
                    lowercaseword: synonym.toLowerCase(),
                    type: 0 /* WORD */
                    , matchedString: operator,
                    bitindex: operatorBitIndex,
                    _ranking: 0.9
                }, oModel.seenRules);
            });
        }
    });
    /*
        })
            {
          category: "filler",
          type: 1,
          regexp: /^((start)|(show)|(from)|(in))$/i,
          matchedString: "filler",
          _ranking: 0.9
        },
    */
    oModel.mRules = oModel.mRules.sort(InputFilterRules.cmpMRule);
    oModel.rules = splitRules(oModel.mRules);
    oModel.tools = oModel.tools.sort(Tools.cmpTools);
    delete oModel.seenRules;
    return oModel;
}
exports.loadModels = loadModels;
function sortCategoriesByImportance(map, cats) {
    var res = cats.slice(0);
    res.sort(rankCategoryByImportance.bind(undefined, map));
    return res;
}
exports.sortCategoriesByImportance = sortCategoriesByImportance;
function rankCategoryByImportance(map, cata, catb) {
    var catADesc = map[cata];
    var catBDesc = map[catb];
    if (cata === catb) {
        return 0;
    }
    // if a is before b, return -1
    if (catADesc && !catBDesc) {
        return -1;
    }
    if (!catADesc && catBDesc) {
        return +1;
    }
    var prioA = catADesc && catADesc.importance || 99;
    var prioB = catBDesc && catBDesc.importance || 99;
    // lower prio goes to front
    var r = prioA - prioB;
    if (r) {
        return r;
    }
    return cata.localeCompare(catb);
}
exports.rankCategoryByImportance = rankCategoryByImportance;
var MetaF = Meta.getMetaFactory();
function getOperator(mdl, operator) {
    return mdl.operators[operator];
}
exports.getOperator = getOperator;
function getResultAsArray(mdl, a, rel) {
    if (rel.toType() !== 'relation') {
        throw new Error("expect relation as 2nd arg");
    }
    var res = mdl.meta.t3[a.toFullString()] && mdl.meta.t3[a.toFullString()][rel.toFullString()];
    if (!res) {
        return [];
    }
    return Object.getOwnPropertyNames(res).sort().map(MetaF.parseIMeta);
}
exports.getResultAsArray = getResultAsArray;
function getCategoriesForDomain(theModel, domain) {
    if (theModel.domains.indexOf(domain) < 0) {
        throw new Error("Domain \"" + domain + "\" not part of model");
    }
    var res = getResultAsArray(theModel, MetaF.Domain(domain), MetaF.Relation(Meta.RELATION_hasCategory));
    return Meta.getStringArray(res);
}
exports.getCategoriesForDomain = getCategoriesForDomain;
/**
 * Return all categories of a domain which can appear on a word,
 * these are typically the wordindex domains + entries generated by generic rules
 *
 * The current implementation is a simplification
 */
function getPotentialWordCategoriesForDomain(theModel, domain) {
    // this is a simplified version
    return getCategoriesForDomain(theModel, domain);
}
exports.getPotentialWordCategoriesForDomain = getPotentialWordCategoriesForDomain;
function getDomainsForCategory(theModel, category) {
    if (theModel.category.indexOf(category) < 0) {
        throw new Error("Category \"" + category + "\" not part of model");
    }
    var res = getResultAsArray(theModel, MetaF.Category(category), MetaF.Relation(Meta.RELATION_isCategoryOf));
    return Meta.getStringArray(res);
}
exports.getDomainsForCategory = getDomainsForCategory;
function getAllRecordCategoriesForTargetCategory(model, category, wordsonly) {
    var res = {};
    //
    var fn = wordsonly ? getPotentialWordCategoriesForDomain : getCategoriesForDomain;
    var domains = getDomainsForCategory(model, category);
    domains.forEach(function (domain) {
        fn(model, domain).forEach(function (wordcat) {
            res[wordcat] = true;
        });
    });
    Object.freeze(res);
    return res;
}
exports.getAllRecordCategoriesForTargetCategory = getAllRecordCategoriesForTargetCategory;
function getAllRecordCategoriesForTargetCategories(model, categories, wordsonly) {
    var res = {};
    //
    var fn = wordsonly ? getPotentialWordCategoriesForDomain : getCategoriesForDomain;
    var domains = undefined;
    categories.forEach(function (category) {
        var catdomains = getDomainsForCategory(model, category);
        if (!domains) {
            domains = catdomains;
        } else {
            domains = _.intersection(domains, catdomains);
        }
    });
    if (domains.length === 0) {
        throw new Error('categories ' + Utils.listToQuotedCommaAnd(categories) + ' have no common domain.');
    }
    domains.forEach(function (domain) {
        fn(model, domain).forEach(function (wordcat) {
            res[wordcat] = true;
        });
    });
    Object.freeze(res);
    return res;
}
exports.getAllRecordCategoriesForTargetCategories = getAllRecordCategoriesForTargetCategories;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9tb2RlbC9tb2RlbC50cyIsIm1vZGVsL21vZGVsLmpzIl0sIm5hbWVzIjpbImRlYnVnIiwicmVxdWlyZSIsImRlYnVnbG9nIiwibG9nZ2VyIiwibG9hZGxvZyIsIklNYXRjaCIsIklucHV0RmlsdGVyUnVsZXMiLCJUb29scyIsImZzIiwiTWV0YSIsIlV0aWxzIiwicHJvY2VzcyIsIl8iLCJlbnZNb2RlbFBhdGgiLCJlbnYiLCJBUlJfTU9ERUxfUFJPUEVSVElFUyIsImFkZFN5bm9ueW1zIiwic3lub255bXMiLCJjYXRlZ29yeSIsInN5bm9ueW1Gb3IiLCJiaXRpbmRleCIsIm1SdWxlcyIsInNlZW4iLCJmb3JFYWNoIiwic3luIiwib1J1bGUiLCJtYXRjaGVkU3RyaW5nIiwidHlwZSIsIndvcmQiLCJfcmFua2luZyIsIkpTT04iLCJzdHJpbmdpZnkiLCJpbnNlcnRSdWxlSWZOb3RQcmVzZW50IiwiZ2V0UnVsZUtleSIsInJ1bGUiLCJzZWVuUnVsZXMiLCJwdXNoIiwidW5kZWZpbmVkIiwiRXJyb3IiLCJyIiwibG93ZXJjYXNld29yZCIsInRvTG93ZXJDYXNlIiwiZHVwbGljYXRlcyIsImZpbHRlciIsIm9FbnRyeSIsImNvbXBhcmVNUnVsZUZ1bGwiLCJsZW5ndGgiLCJsb2FkTW9kZWxEYXRhIiwibW9kZWxQYXRoIiwib01kbCIsInNNb2RlbE5hbWUiLCJvTW9kZWwiLCJzRmlsZU5hbWUiLCJtZGxkYXRhIiwicmVhZEZpbGVTeW5jIiwib01kbERhdGEiLCJwYXJzZSIsInRvb2wiLCJfZG9tYWluIiwiZG9tYWluIiwibmFtZSIsInJlY29yZHMiLCJjYXQiLCJidWciLCJ3b3JkaW5kZXgiLCJzU3RyaW5nIiwiZXhhY3RtYXRjaCIsImluZGV4T2YiLCJleGFjdE9ubHkiLCJsb2FkTW9kZWwiLCJtZGwiLCJtZXJnZU1vZGVsSnNvbiIsImdldERvbWFpbkJpdEluZGV4IiwiaW5kZXgiLCJkb21haW5zIiwiZXhwb3J0cyIsImNhdGVnb3J5RGVzY3JpYmVkTWFwIiwiY2F0ZWdvcnlEZXNjcmliZWQiLCJtYXAiLCJjb25zb2xlIiwibG9nIiwiZXhpdCIsIk9iamVjdCIsImtleXMiLCJzb3J0Iiwic1Byb3BlcnR5IiwiZnVsbCIsImRlc2NyaXB0aW9uIiwiY2F0ZWdvcmllcyIsInNXb3JkSW5kZXgiLCJzRXhhY3RNYXRjaCIsImRvbWFpblN0ciIsIk1ldGFGIiwiRG9tYWluIiwidG9GdWxsU3RyaW5nIiwicmVsYXRpb25TdHIiLCJSZWxhdGlvbiIsIlJFTEFUSU9OX2hhc0NhdGVnb3J5IiwicmV2ZXJzZVJlbGF0aW9uU3RyIiwiUkVMQVRJT05faXNDYXRlZ29yeU9mIiwic0NhdGVnb3J5IiwiQ2F0ZWdvcnlTdHJpbmciLCJDYXRlZ29yeSIsIm1ldGEiLCJ0MyIsInJlcXVpcmVzIiwiZGlmZiIsImRpZmZlcmVuY2UiLCJqb2luIiwib3B0aW9uYWwiLCJzZXRzIiwic2V0SUQiLCJzZXQiLCJ0b29scyIsInRvb2xoaWRkZW4iLCJzc3lua2V5IiwiY29uY2F0Iiwic3RyaW5nIiwic3BsaXRSdWxlcyIsInJ1bGVzIiwicmVzIiwibm9uV29yZFJ1bGVzIiwid29yZE1hcCIsImFsbFJ1bGVzIiwibG9hZE1vZGVscyIsIm9wZXJhdG9ycyIsInNtZGxzIiwibWRscyIsIm1ldGFCaXRJbmRleCIsImZpbGxlckJpdEluZGV4Iiwic2ZpbGxlcnMiLCJmaWxsZXJzIiwicmUiLCJyZWdleHAiLCJSZWdFeHAiLCJzT3BlcmF0b3JzIiwib3BlcmF0b3JCaXRJbmRleCIsIm9wZXJhdG9yIiwiYU9wZXJhdG9yTmFtZXMiLCJmcmVlemUiLCJzeW5vbnltIiwiY21wTVJ1bGUiLCJjbXBUb29scyIsInNvcnRDYXRlZ29yaWVzQnlJbXBvcnRhbmNlIiwiY2F0cyIsInNsaWNlIiwicmFua0NhdGVnb3J5QnlJbXBvcnRhbmNlIiwiYmluZCIsImNhdGEiLCJjYXRiIiwiY2F0QURlc2MiLCJjYXRCRGVzYyIsInByaW9BIiwiaW1wb3J0YW5jZSIsInByaW9CIiwibG9jYWxlQ29tcGFyZSIsImdldE1ldGFGYWN0b3J5IiwiZ2V0T3BlcmF0b3IiLCJnZXRSZXN1bHRBc0FycmF5IiwiYSIsInJlbCIsInRvVHlwZSIsImdldE93blByb3BlcnR5TmFtZXMiLCJwYXJzZUlNZXRhIiwiZ2V0Q2F0ZWdvcmllc0ZvckRvbWFpbiIsInRoZU1vZGVsIiwiZ2V0U3RyaW5nQXJyYXkiLCJnZXRQb3RlbnRpYWxXb3JkQ2F0ZWdvcmllc0ZvckRvbWFpbiIsImdldERvbWFpbnNGb3JDYXRlZ29yeSIsImdldEFsbFJlY29yZENhdGVnb3JpZXNGb3JUYXJnZXRDYXRlZ29yeSIsIm1vZGVsIiwid29yZHNvbmx5IiwiZm4iLCJ3b3JkY2F0IiwiZ2V0QWxsUmVjb3JkQ2F0ZWdvcmllc0ZvclRhcmdldENhdGVnb3JpZXMiLCJjYXRkb21haW5zIiwiaW50ZXJzZWN0aW9uIiwibGlzdFRvUXVvdGVkQ29tbWFBbmQiXSwibWFwcGluZ3MiOiJBQUFBOzs7OztBQ0tBOztBREVBLElBQUFBLFFBQUFDLFFBQUEsT0FBQSxDQUFBO0FBRUEsSUFBSUMsV0FBV0YsTUFBTSxPQUFOLENBQWY7QUFFQSxJQUFBRyxTQUFBRixRQUFBLGlCQUFBLENBQUE7QUFFQSxJQUFNRyxVQUFVRCxPQUFPQSxNQUFQLENBQWMsV0FBZCxFQUEyQixFQUEzQixDQUFoQjtBQUVBLElBQUFFLFNBQUFKLFFBQUEsa0JBQUEsQ0FBQTtBQUVBLElBQUFLLG1CQUFBTCxRQUFBLDJCQUFBLENBQUE7QUFDQSxJQUFBTSxRQUFBTixRQUFBLGdCQUFBLENBQUE7QUFDQSxJQUFBTyxLQUFBUCxRQUFBLElBQUEsQ0FBQTtBQUNBLElBQUFRLE9BQUFSLFFBQUEsUUFBQSxDQUFBO0FBQ0EsSUFBQVMsUUFBQVQsUUFBQSxnQkFBQSxDQUFBO0FBQ0EsSUFBQVUsVUFBQVYsUUFBQSxTQUFBLENBQUE7QUFDQSxJQUFBVyxJQUFBWCxRQUFBLFFBQUEsQ0FBQTtBQUVBOzs7QUFHQSxJQUFJWSxlQUFlRixRQUFRRyxHQUFSLENBQVksZ0JBQVosS0FBaUMsV0FBcEQ7QUFnQ0M7QUFFRCxJ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bUYsU0FBekcsRUFBNEg7QUFDekgsUUFBSW5ELE1BQU0sRUFBVjtBQUNBO0FBQ0EsUUFBSW9ELEtBQUtELFlBQVlKLG1DQUFaLEdBQWtESCxzQkFBM0Q7QUFDQSxRQUFJMUYsVUFBVXJDLFNBQWQ7QUFDQW1ELGVBQVdqRSxPQUFYLENBQW1CLFVBQVNMLFFBQVQsRUFBaUI7QUFDaEMsWUFBSTZKLGFBQWFQLHNCQUFzQkUsS0FBdEIsRUFBNkJ4SixRQUE3QixDQUFqQjtBQUNBLFlBQUcsQ0FBQ3dELE9BQUosRUFBYTtBQUNUQSxzQkFBVXFHLFVBQVY7QUFDSCxTQUZELE1BRU87QUFDSHJHLHNCQUFVOUQsRUFBRW9LLFlBQUYsQ0FBZXRHLE9BQWYsRUFBd0JxRyxVQUF4QixDQUFWO0FBQ0g7QUFDSixLQVBEO0FBUUEsUUFBR3JHLFFBQVE1QixNQUFSLEtBQW1CLENBQXRCLEVBQXlCO0FBQ3JCLGNBQU0sSUFBSVIsS0FBSixDQUFVLGdCQUFnQjVCLE1BQU11SyxvQkFBTixDQUEyQnpGLFVBQTNCLENBQWhCLEdBQXlELHlCQUFuRSxDQUFOO0FBQ0g7QUFDRGQsWUFBUW5ELE9BQVIsQ0FBZ0IsVUFBU29DLE1BQVQsRUFBZTtBQUMzQmlILFdBQUdGLEtBQUgsRUFBVS9HLE1BQVYsRUFBa0JwQyxPQUFsQixDQUEwQixVQUFTc0osT0FBVCxFQUFnQjtBQUN0Q3JELGdCQUFJcUQsT0FBSixJQUFlLElBQWY7QUFDSCxTQUZEO0FBR0gsS0FKRDtBQUtBM0YsV0FBT3lELE1BQVAsQ0FBY25CLEdBQWQ7QUFDQSxXQUFPQSxHQUFQO0FBQ0Y7QUF2QkQ3QyxRQUFBbUcseUNBQUEsR0FBQUEseUNBQUEiLCJmaWxlIjoibW9kZWwvbW9kZWwuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogRnVuY3Rpb25hbGl0eSBtYW5hZ2luZyB0aGUgbWF0Y2ggbW9kZWxzXHJcbiAqXHJcbiAqIEBmaWxlXHJcbiAqL1xyXG5cclxuaW1wb3J0ICogYXMgaW50ZiBmcm9tICdjb25zdGFudHMnO1xyXG5pbXBvcnQgKiBhcyBkZWJ1ZyBmcm9tICdkZWJ1Zyc7XHJcblxyXG52YXIgZGVidWdsb2cgPSBkZWJ1ZygnbW9kZWwnKTtcclxuXHJcbmltcG9ydCAqIGFzIGxvZ2dlciBmcm9tICcuLi91dGlscy9sb2dnZXInO1xyXG5cclxuY29uc3QgbG9hZGxvZyA9IGxvZ2dlci5sb2dnZXIoJ21vZGVsbG9hZCcsICcnKTtcclxuXHJcbmltcG9ydCAqICBhcyBJTWF0Y2ggZnJvbSAnLi4vbWF0Y2gvaWZtYXRjaCc7XHJcbmltcG9ydCAqIGFzIE1hdGNoIGZyb20gJy4uL21hdGNoL21hdGNoJztcclxuaW1wb3J0ICogYXMgSW5wdXRGaWx0ZXJSdWxlcyBmcm9tICcuLi9tYXRjaC9pbnB1dEZpbHRlclJ1bGVzJztcclxuaW1wb3J0ICogYXMgVG9vbHMgZnJvbSAnLi4vbWF0Y2gvdG9vbHMnO1xyXG5pbXBvcnQgKiBhcyBmcyBmcm9tICdmcyc7XHJcbmltcG9ydCAqIGFzIE1ldGEgZnJvbSAnLi9tZXRhJztcclxuaW1wb3J0ICogYXMgVXRpbHMgZnJvbSAnLi4vdXRpbHMvdXRpbHMnO1xyXG5pbXBvcnQgKiBhcyBwcm9jZXNzIGZyb20gJ3Byb2Nlc3MnO1xyXG5pbXBvcnQgKiBhcyBfIGZyb20gJ2xvZGFzaCc7XHJcblxyXG4vKipcclxuICogdGhlIG1vZGVsIHBhdGgsIG1heSBiZSBjb250cm9sbGVkIHZpYSBlbnZpcm9ubWVudCB2YXJpYWJsZVxyXG4gKi9cclxudmFyIGVudk1vZGVsUGF0aCA9IHByb2Nlc3MuZW52W1wiQUJPVF9NT0RFTFBBVEhcIl0gfHwgXCJ0ZXN0bW9kZWxcIjtcclxuXHJcbi8vZXhwb3J0IGludGVyZmFjZSBJTW9kZWxzID0gTWF0Y2guSU1vZGVscztcclxuXHJcbi8qXHJcbmV4cG9ydCBpbnRlcmZhY2UgSU1vZGVscyB7XHJcbiAgICBkb21haW5zOiBzdHJpbmdbXSxcclxuICAgIHRvb2xzOiBJTWF0Y2guSVRvb2xbXSxcclxuICAgIGNhdGVnb3J5OiBzdHJpbmdbXSxcclxuICAgIG1SdWxlczogSU1hdGNoLm1SdWxlW10sXHJcbiAgICByZWNvcmRzOiBhbnlbXVxyXG4gICAgc2VlblJ1bGVzPzogeyBba2V5OiBzdHJpbmddOiBJTWF0Y2gubVJ1bGUgfSxcclxuICAgIG1ldGEgOiB7XHJcbiAgICAgICAgLy8gZW50aXR5IC0+IHJlbGF0aW9uIC0+IHRhcmdldFxyXG4gICAgICAgIHQzIDogeyBba2V5OiBzdHJpbmddIDogeyBba2V5IDogc3RyaW5nXSA6IGFueSB9fVxyXG4gICAgfVxyXG59Ki9cclxuXHJcbmludGVyZmFjZSBJTW9kZWwge1xyXG4gICAgZG9tYWluOiBzdHJpbmcsXHJcbiAgICBiaXRpbmRleCA6IG51bWJlcixcclxuICAgIGRlc2NyaXB0aW9uPyA6IHN0cmluZyxcclxuICAgIHRvb2w6IElNYXRjaC5JVG9vbCxcclxuICAgIHRvb2xoaWRkZW4/OiBib29sZWFuLFxyXG4gICAgc3lub255bXM/OiB7IFtrZXk6IHN0cmluZ106IHN0cmluZ1tdIH0sXHJcbiAgICBjYXRlZ29yeURlc2NyaWJlZCA6ICB7IG5hbWUgOiBzdHJpbmcsXHJcbiAgICAgICAgZGVzY3JpcHRpb24/IDogc3RyaW5nLFxyXG4gICAgICAgIGtleT8gOiBzdHJpbmcgfVtdLFxyXG4gICAgY2F0ZWdvcnk6IHN0cmluZ1tdLFxyXG4gICAgd29yZGluZGV4OiBzdHJpbmdbXSxcclxuICAgIGV4YWN0bWF0Y2g/IDogc3RyaW5nW10sXHJcbiAgICBoaWRkZW46IHN0cmluZ1tdXHJcbn07XHJcblxyXG5jb25zdCBBUlJfTU9ERUxfUFJPUEVSVElFUyA9IFtcImRvbWFpblwiLCBcImJpdGluZGV4XCIsIFwiY2F0ZWdvcnlEZXNjcmliZWRcIiwgXCJkZXNjcmlwdGlvblwiLCBcInRvb2xcIiwgXCJ0b29saGlkZGVuXCIsIFwic3lub255bXNcIiwgXCJjYXRlZ29yeVwiLCBcIndvcmRpbmRleFwiLCBcImV4YWN0bWF0Y2hcIiwgXCJoaWRkZW5cIl07XHJcblxyXG5mdW5jdGlvbiBhZGRTeW5vbnltcyhzeW5vbnltczogc3RyaW5nW10sIGNhdGVnb3J5OiBzdHJpbmcsIHN5bm9ueW1Gb3I6IHN0cmluZywgYml0aW5kZXggOiBudW1iZXIsIG1SdWxlczogQXJyYXk8SU1hdGNoLm1SdWxlPiwgc2VlbjogeyBba2V5OiBzdHJpbmddOiBJTWF0Y2gubVJ1bGVbXSB9KSB7XHJcbiAgICBzeW5vbnltcy5mb3JFYWNoKGZ1bmN0aW9uIChzeW4pIHtcclxuICAgICAgICB2YXIgb1J1bGUgPSB7XHJcbiAgICAgICAgICAgIGNhdGVnb3J5OiBjYXRlZ29yeSxcclxuICAgICAgICAgICAgbWF0Y2hlZFN0cmluZzogc3lub255bUZvcixcclxuICAgICAgICAgICAgdHlwZTogSU1hdGNoLkVudW1SdWxlVHlwZS5XT1JELFxyXG4gICAgICAgICAgICB3b3JkOiBzeW4sXHJcbiAgICAgICAgICAgIGJpdGluZGV4IDogYml0aW5kZXgsXHJcbiAgICAgICAgICAgIF9yYW5raW5nOiAwLjk1XHJcbiAgICAgICAgfTtcclxuICAgICAgICBkZWJ1Z2xvZyhcImluc2VydGluZyBzeW5vbnltXCIgKyBKU09OLnN0cmluZ2lmeShvUnVsZSkpO1xyXG4gICAgICAgIGluc2VydFJ1bGVJZk5vdFByZXNlbnQobVJ1bGVzLCBvUnVsZSwgc2Vlbik7XHJcbiAgICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gZ2V0UnVsZUtleShydWxlKSB7XHJcbiAgICByZXR1cm4gcnVsZS5tYXRjaGVkU3RyaW5nICsgXCItfC1cIiArIHJ1bGUuY2F0ZWdvcnkgKyBcIiAtfC0gXCIgKyBydWxlLnR5cGUgICsgXCIgLXwtIFwiICsgcnVsZS53b3JkICsgXCIgXCI7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGluc2VydFJ1bGVJZk5vdFByZXNlbnQobVJ1bGVzOiBBcnJheTxJTWF0Y2gubVJ1bGU+LCBydWxlOiBJTWF0Y2gubVJ1bGUsXHJcbiAgICBzZWVuUnVsZXM6IHsgW2tleTogc3RyaW5nXTogSU1hdGNoLm1SdWxlW10gfSkge1xyXG5cclxuICAgIGlmIChydWxlLnR5cGUgIT09IElNYXRjaC5FbnVtUnVsZVR5cGUuV09SRCkge1xyXG4gICAgICAgIG1SdWxlcy5wdXNoKHJ1bGUpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIGlmICgocnVsZS53b3JkID09PSB1bmRlZmluZWQpIHx8IChydWxlLm1hdGNoZWRTdHJpbmcgPT09IHVuZGVmaW5lZCkpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2lsbGVnYWwgcnVsZScgKyBKU09OLnN0cmluZ2lmeShydWxlLCB1bmRlZmluZWQsIDIpKTtcclxuICAgIH1cclxuICAgIHZhciByID0gZ2V0UnVsZUtleShydWxlKTtcclxuICAgIHJ1bGUubG93ZXJjYXNld29yZCA9IHJ1bGUud29yZC50b0xvd2VyQ2FzZSgpO1xyXG4gICAgaWYgKHNlZW5SdWxlc1tyXSkge1xyXG4gICAgICAgIGRlYnVnbG9nKFwiQXR0ZW1wdGluZyB0byBpbnNlcnQgZHVwbGljYXRlXCIgKyBKU09OLnN0cmluZ2lmeShydWxlLCB1bmRlZmluZWQsIDIpKTtcclxuICAgICAgICB2YXIgZHVwbGljYXRlcyA9IHNlZW5SdWxlc1tyXS5maWx0ZXIoZnVuY3Rpb24oIG9FbnRyeSkge1xyXG4gICAgICAgICAgICByZXR1cm4gMCA9PT0gSW5wdXRGaWx0ZXJSdWxlcy5jb21wYXJlTVJ1bGVGdWxsKG9FbnRyeSxydWxlKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBpZihkdXBsaWNhdGVzLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHNlZW5SdWxlc1tyXSA9IChzZWVuUnVsZXNbcl0gfHwgW10pO1xyXG4gICAgc2VlblJ1bGVzW3JdLnB1c2gocnVsZSk7XHJcbiAgICBpZiAocnVsZS53b3JkID09PSBcIlwiKSB7XHJcbiAgICAgICAgZGVidWdsb2coJ1NraXBwaW5nIHJ1bGUgd2l0aCBlbXRweSB3b3JkICcgKyBKU09OLnN0cmluZ2lmeShydWxlLCB1bmRlZmluZWQsIDIpKTtcclxuICAgICAgICBsb2FkbG9nKCdTa2lwcGluZyBydWxlIHdpdGggZW10cHkgd29yZCAnICsgSlNPTi5zdHJpbmdpZnkocnVsZSwgdW5kZWZpbmVkLCAyKSk7XHJcbiAgICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG4gICAgbVJ1bGVzLnB1c2gocnVsZSk7XHJcbiAgICByZXR1cm47XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGxvYWRNb2RlbERhdGEobW9kZWxQYXRoOiBzdHJpbmcsIG9NZGw6IElNb2RlbCwgc01vZGVsTmFtZTogc3RyaW5nLCBvTW9kZWw6IElNYXRjaC5JTW9kZWxzKSB7XHJcbiAgICAvLyByZWFkIHRoZSBkYXRhIC0+XHJcbiAgICAvLyBkYXRhIGlzIHByb2Nlc3NlZCBpbnRvIG1SdWxlcyBkaXJlY3RseSxcclxuICAgIHZhciBiaXRpbmRleCA9IG9NZGwuYml0aW5kZXg7XHJcbiAgICBjb25zdCBzRmlsZU5hbWUgPSAoJy4vJyArIG1vZGVsUGF0aCArICcvJyArIHNNb2RlbE5hbWUgKyBcIi5kYXRhLmpzb25cIik7XHJcbiAgICB2YXIgbWRsZGF0YSA9IGZzLnJlYWRGaWxlU3luYyhzRmlsZU5hbWUsICd1dGYtOCcpO1xyXG4gICAgdmFyIG9NZGxEYXRhID0gSlNPTi5wYXJzZShtZGxkYXRhKTtcclxuICAgIG9NZGxEYXRhLmZvckVhY2goZnVuY3Rpb24gKG9FbnRyeSkge1xyXG4gICAgICAgIGlmKCFvRW50cnkudG9vbCkge1xyXG4gICAgICAgICAgICBvRW50cnkuX2RvbWFpbiA9IG9NZGwuZG9tYWluO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIW9FbnRyeS50b29sICYmIG9NZGwudG9vbC5uYW1lKSB7XHJcbiAgICAgICAgICAgIG9FbnRyeS50b29sID0gb01kbC50b29sLm5hbWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG9Nb2RlbC5yZWNvcmRzLnB1c2gob0VudHJ5KTtcclxuICAgICAgICBvTWRsLmNhdGVnb3J5LmZvckVhY2goZnVuY3Rpb24oY2F0KSB7XHJcbiAgICAgICAgICAgIGlmKG9FbnRyeVtjYXRdID09PSAndW5kZWZpbmVkJykge1xyXG4gICAgICAgICAgICAgICAgb0VudHJ5W2NhdF0gPSBcIm4vYVwiO1xyXG4gICAgICAgICAgICAgICAgdmFyIGJ1ZyA9XHJcbiAgICAgICAgICAgICAgICAgICAgXCJJTkNPTlNJU1RFTlQqPiBNb2RlbERhdGEgXCIgKyBzRmlsZU5hbWUgKyBcIiBkb2VzIG5vdCBjb250YWluIGNhdGVnb3J5IFwiICsgY2F0ICsgXCIgd2l0aCB2YWx1ZSAndW5kZWZpbmVkJywgdW5kZWZpbmVkIGlzIGlsbGVnYWwgdmFsdWUsIHVzZSBuL2EgXCIgKyBKU09OLnN0cmluZ2lmeShvRW50cnkpICsgXCJcIjtcclxuICAgICAgICAgICAgICAgIGRlYnVnbG9nKGJ1Zyk7XHJcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKGJ1Zyk7XHJcbiAgICAgICAgICAgICAgICAvL3Byb2Nlc3MuZXhpdCgtMSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG5cclxuICAgICAgICBvTWRsLndvcmRpbmRleC5mb3JFYWNoKGZ1bmN0aW9uIChjYXRlZ29yeSkge1xyXG4gICAgICAgICAgICBpZiAob0VudHJ5W2NhdGVnb3J5XSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICBkZWJ1Z2xvZyhcIklOQ09OU0lTVEVOVCo+IE1vZGVsRGF0YSBcIiArIHNGaWxlTmFtZSArIFwiIGRvZXMgbm90IGNvbnRhaW4gY2F0ZWdvcnkgXCIgKyBjYXRlZ29yeSArIFwiIG9mIHdvcmRpbmRleFwiICsgSlNPTi5zdHJpbmdpZnkob0VudHJ5KSArIFwiXCIpXHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKG9FbnRyeVtjYXRlZ29yeV0gIT09IFwiKlwiKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgc1N0cmluZyA9IG9FbnRyeVtjYXRlZ29yeV07XHJcbiAgICAgICAgICAgICAgICBkZWJ1Z2xvZyhcInB1c2hpbmcgcnVsZSB3aXRoIFwiICsgY2F0ZWdvcnkgKyBcIiAtPiBcIiArIHNTdHJpbmcpO1xyXG4gICAgICAgICAgICAgICAgdmFyIG9SdWxlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXRlZ29yeTogY2F0ZWdvcnksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoZWRTdHJpbmc6IHNTdHJpbmcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IElNYXRjaC5FbnVtUnVsZVR5cGUuV09SRCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgd29yZDogc1N0cmluZyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgYml0aW5kZXggOiBiaXRpbmRleCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgX3Jhbmtpbmc6IDAuOTVcclxuICAgICAgICAgICAgICAgICAgICB9IGFzIElNYXRjaC5tUnVsZTtcclxuICAgICAgICAgICAgICAgIGlmKG9NZGwuZXhhY3RtYXRjaCAmJiBvTWRsLmV4YWN0bWF0Y2guaW5kZXhPZihjYXRlZ29yeSkgPj0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG9SdWxlLmV4YWN0T25seSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpbnNlcnRSdWxlSWZOb3RQcmVzZW50KG9Nb2RlbC5tUnVsZXMsb1J1bGUsIG9Nb2RlbC5zZWVuUnVsZXMpO1xyXG4gICAgICAgICAgICAgICAgaWYgKG9NZGxEYXRhLnN5bm9ueW1zICYmIG9NZGxEYXRhLnN5bm9ueW1zW2NhdGVnb3J5XSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGFkZFN5bm9ueW1zKG9NZGxEYXRhLnN5bm9ueW1zW2NhdGVnb3J5XSwgY2F0ZWdvcnksIHNTdHJpbmcsIGJpdGluZGV4LCBvTW9kZWwubVJ1bGVzLCBvTW9kZWwuc2VlblJ1bGVzKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChvRW50cnkuc3lub255bXMgJiYgb0VudHJ5LnN5bm9ueW1zW2NhdGVnb3J5XSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGFkZFN5bm9ueW1zKG9FbnRyeS5zeW5vbnltc1tjYXRlZ29yeV0sIGNhdGVnb3J5LCBzU3RyaW5nLCBiaXRpbmRleCwgb01vZGVsLm1SdWxlcywgb01vZGVsLnNlZW5SdWxlcyk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG59XHJcblxyXG5cclxuXHJcblxyXG5mdW5jdGlvbiBsb2FkTW9kZWwobW9kZWxQYXRoIDogc3RyaW5nLCBzTW9kZWxOYW1lOiBzdHJpbmcsIG9Nb2RlbDogSU1hdGNoLklNb2RlbHMpIHtcclxuICAgIGRlYnVnbG9nKFwiIGxvYWRpbmcgXCIgKyBzTW9kZWxOYW1lICsgXCIgLi4uLlwiKTtcclxuICAgIHZhciBtZGwgPSBmcy5yZWFkRmlsZVN5bmMoJy4vJyArIG1vZGVsUGF0aCArICcvJyArIHNNb2RlbE5hbWUgKyBcIi5tb2RlbC5qc29uXCIsICd1dGYtOCcpO1xyXG4gICAgdmFyIG9NZGwgPSBKU09OLnBhcnNlKG1kbCkgYXMgSU1vZGVsO1xyXG4gICAgbWVyZ2VNb2RlbEpzb24oc01vZGVsTmFtZSwgb01kbCwgb01vZGVsKTtcclxuICAgIGxvYWRNb2RlbERhdGEobW9kZWxQYXRoLCBvTWRsLCBzTW9kZWxOYW1lLCBvTW9kZWwpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0RG9tYWluQml0SW5kZXgoZG9tYWluOiBzdHJpbmcsIG9Nb2RlbDogSU1hdGNoLklNb2RlbHMpIDogbnVtYmVyIHtcclxuICAgIHZhciBpbmRleCA9IG9Nb2RlbC5kb21haW5zLmluZGV4T2YoZG9tYWluKTtcclxuICAgIGlmKGluZGV4IDwgMCkge1xyXG4gICAgICAgIGluZGV4ID0gb01vZGVsLmRvbWFpbnMubGVuZ3RoO1xyXG4gICAgfVxyXG4gICAgaWYoaW5kZXggPj0gMzIpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJ0b28gbWFueSBkb21haW4gZm9yIHNpbmdsZSAzMiBiaXQgaW5kZXhcIik7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gMHgwMDAxIDw8IGluZGV4O1xyXG59XHJcblxyXG5mdW5jdGlvbiBtZXJnZU1vZGVsSnNvbihzTW9kZWxOYW1lOiBzdHJpbmcsIG9NZGw6IElNb2RlbCwgb01vZGVsOiBJTWF0Y2guSU1vZGVscykge1xyXG4gICAgdmFyIGNhdGVnb3J5RGVzY3JpYmVkTWFwID0ge30gYXMgeyBba2V5OiBzdHJpbmddIDogSU1hdGNoLklDYXRlZ29yeURlc2MgfTtcclxuICAgIG9NZGwuYml0aW5kZXggPSBnZXREb21haW5CaXRJbmRleChvTWRsLmRvbWFpbiwgb01vZGVsKTtcclxuICAgIG9NZGwuY2F0ZWdvcnlEZXNjcmliZWQgPSBbXTtcclxuICAgIC8vIHJlY3RpZnkgY2F0ZWdvcnlcclxuICAgIG9NZGwuY2F0ZWdvcnkgPSBvTWRsLmNhdGVnb3J5Lm1hcChmdW5jdGlvbihjYXQgOiBhbnkpIHtcclxuICAgICAgICBpZih0eXBlb2YgY2F0ID09PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBjYXQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmKHR5cGVvZiBjYXQubmFtZSAhPT0gXCJzdHJpbmdcIikge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIk1pc3NpbmcgbmFtZSBpbiBvYmplY3QgdHlwZWQgY2F0ZWdvcnkgaW4gXCIgKyBKU09OLnN0cmluZ2lmeShjYXQpICsgXCIgaW4gbW9kZWwgXCIgKyBzTW9kZWxOYW1lICk7XHJcbiAgICAgICAgICAgIHByb2Nlc3MuZXhpdCgtMSk7XHJcbiAgICAgICAgICAgIC8vdGhyb3cgbmV3IEVycm9yKCdEb21haW4gJyArIG9NZGwuZG9tYWluICsgJyBhbHJlYWR5IGxvYWRlZCB3aGlsZSBsb2FkaW5nICcgKyBzTW9kZWxOYW1lICsgJz8nKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY2F0ZWdvcnlEZXNjcmliZWRNYXBbY2F0Lm5hbWVdID0gY2F0O1xyXG4gICAgICAgIG9NZGwuY2F0ZWdvcnlEZXNjcmliZWQucHVzaChjYXQpO1xyXG4gICAgICAgIHJldHVybiBjYXQubmFtZTtcclxuICAgIH0pO1xyXG5cclxuICAgICAgIC8vIGFkZCB0aGUgY2F0ZWdvcmllcyB0byB0aGUgbW9kZWw6XHJcbiAgICBvTWRsLmNhdGVnb3J5LmZvckVhY2goZnVuY3Rpb24gKGNhdGVnb3J5KSB7XHJcbiAgICAgICAgaW5zZXJ0UnVsZUlmTm90UHJlc2VudChvTW9kZWwubVJ1bGVzLCB7XHJcbiAgICAgICAgICAgIGNhdGVnb3J5OiBcImNhdGVnb3J5XCIsXHJcbiAgICAgICAgICAgIG1hdGNoZWRTdHJpbmc6IGNhdGVnb3J5LFxyXG4gICAgICAgICAgICB0eXBlOiBJTWF0Y2guRW51bVJ1bGVUeXBlLldPUkQsXHJcbiAgICAgICAgICAgIHdvcmQ6IGNhdGVnb3J5LFxyXG4gICAgICAgICAgICBsb3dlcmNhc2V3b3JkOiBjYXRlZ29yeS50b0xvd2VyQ2FzZSgpLFxyXG4gICAgICAgICAgICBiaXRpbmRleCA6IG9NZGwuYml0aW5kZXgsXHJcbiAgICAgICAgICAgIF9yYW5raW5nOiAwLjk1XHJcbiAgICAgICAgfSwgb01vZGVsLnNlZW5SdWxlcyk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpZiAob01vZGVsLmRvbWFpbnMuaW5kZXhPZihvTWRsLmRvbWFpbikgPj0gMCkge1xyXG4gICAgICAgIGRlYnVnbG9nKFwiKioqKioqKioqKipoZXJlIG1kbFwiICsgSlNPTi5zdHJpbmdpZnkob01kbCwgdW5kZWZpbmVkLCAyKSk7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdEb21haW4gJyArIG9NZGwuZG9tYWluICsgJyBhbHJlYWR5IGxvYWRlZCB3aGlsZSBsb2FkaW5nICcgKyBzTW9kZWxOYW1lICsgJz8nKTtcclxuICAgIH1cclxuICAgIC8vIGNoZWNrIHByb3BlcnRpZXMgb2YgbW9kZWxcclxuICAgIE9iamVjdC5rZXlzKG9NZGwpLnNvcnQoKS5mb3JFYWNoKGZ1bmN0aW9uKHNQcm9wZXJ0eSkge1xyXG4gICAgICAgIGlmKEFSUl9NT0RFTF9QUk9QRVJUSUVTLmluZGV4T2Yoc1Byb3BlcnR5KSA8IDApIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdNb2RlbCBwcm9wZXJ0eSBcIicgKyBzUHJvcGVydHkgKyAnXCIgbm90IGEga25vd24gbW9kZWwgcHJvcGVydHkgaW4gbW9kZWwgb2YgZG9tYWluICcgKyBvTWRsLmRvbWFpbiArICcgJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICBvTW9kZWwuZnVsbC5kb21haW5bb01kbC5kb21haW5dID0ge1xyXG4gICAgICAgIGRlc2NyaXB0aW9uIDogb01kbC5kZXNjcmlwdGlvbixcclxuICAgICAgICBjYXRlZ29yaWVzIDogY2F0ZWdvcnlEZXNjcmliZWRNYXAsXHJcbiAgICAgICAgYml0aW5kZXggOiBvTWRsLmJpdGluZGV4XHJcbiAgICB9O1xyXG5cclxuXHJcbiAgICAvLyBjaGVjayB0aGF0IG1lbWJlcnMgb2Ygd29yZGluZGV4IGFyZSBpbiBjYXRlZ29yaWVzLFxyXG4gICAgb01kbC53b3JkaW5kZXggPSBvTWRsLndvcmRpbmRleCB8fCBbXTtcclxuICAgIG9NZGwud29yZGluZGV4LmZvckVhY2goZnVuY3Rpb24oc1dvcmRJbmRleCkge1xyXG4gICAgICAgIGlmKG9NZGwuY2F0ZWdvcnkuaW5kZXhPZihzV29yZEluZGV4KSA8IDApIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdNb2RlbCB3b3JkaW5kZXggXCInICsgc1dvcmRJbmRleCArICdcIiBub3QgYSBjYXRlZ29yeSBvZiBkb21haW4gJyArIG9NZGwuZG9tYWluICsgJyAnKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuICAgIG9NZGwuZXhhY3RtYXRjaCA9IG9NZGwuZXhhY3RtYXRjaCB8fCBbXTtcclxuICAgIG9NZGwuZXhhY3RtYXRjaC5mb3JFYWNoKGZ1bmN0aW9uKHNFeGFjdE1hdGNoKSB7XHJcbiAgICAgICAgaWYob01kbC5jYXRlZ29yeS5pbmRleE9mKHNFeGFjdE1hdGNoKSA8IDApIHtcclxuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdNb2RlbCBleGFjdG1hdGNoIFwiJyArIHNFeGFjdE1hdGNoICsgJ1wiIG5vdCBhIGNhdGVnb3J5IG9mIGRvbWFpbiAnICsgb01kbC5kb21haW4gKyAnICcpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuXHJcbiAgICAvLyBhZGQgcmVsYXRpb24gZG9tYWluIC0+IGNhdGVnb3J5XHJcbiAgICB2YXIgZG9tYWluU3RyID0gTWV0YUYuRG9tYWluKG9NZGwuZG9tYWluKS50b0Z1bGxTdHJpbmcoKTtcclxuICAgIHZhciByZWxhdGlvblN0ciA9IE1ldGFGLlJlbGF0aW9uKE1ldGEuUkVMQVRJT05faGFzQ2F0ZWdvcnkpLnRvRnVsbFN0cmluZygpO1xyXG4gICAgdmFyIHJldmVyc2VSZWxhdGlvblN0ciA9IE1ldGFGLlJlbGF0aW9uKE1ldGEuUkVMQVRJT05faXNDYXRlZ29yeU9mKS50b0Z1bGxTdHJpbmcoKTtcclxuICAgIG9NZGwuY2F0ZWdvcnkuZm9yRWFjaChmdW5jdGlvbihzQ2F0ZWdvcnkpIHtcclxuXHJcbiAgICAgICAgdmFyIENhdGVnb3J5U3RyaW5nID0gTWV0YUYuQ2F0ZWdvcnkoc0NhdGVnb3J5KS50b0Z1bGxTdHJpbmcoKTtcclxuICAgICAgICBvTW9kZWwubWV0YS50M1tkb21haW5TdHJdID0gb01vZGVsLm1ldGEudDNbZG9tYWluU3RyXSB8fCB7fTtcclxuICAgICAgICBvTW9kZWwubWV0YS50M1tkb21haW5TdHJdW3JlbGF0aW9uU3RyXSA9IG9Nb2RlbC5tZXRhLnQzW2RvbWFpblN0cl1bcmVsYXRpb25TdHJdIHx8IHt9O1xyXG4gICAgICAgIG9Nb2RlbC5tZXRhLnQzW2RvbWFpblN0cl1bcmVsYXRpb25TdHJdW0NhdGVnb3J5U3RyaW5nXSAgPSB7fTtcclxuXHJcbiAgICAgICAgb01vZGVsLm1ldGEudDNbQ2F0ZWdvcnlTdHJpbmddID0gb01vZGVsLm1ldGEudDNbQ2F0ZWdvcnlTdHJpbmddIHx8IHt9O1xyXG4gICAgICAgIG9Nb2RlbC5tZXRhLnQzW0NhdGVnb3J5U3RyaW5nXVtyZXZlcnNlUmVsYXRpb25TdHJdID0gb01vZGVsLm1ldGEudDNbQ2F0ZWdvcnlTdHJpbmddW3JldmVyc2VSZWxhdGlvblN0cl0gfHwge307XHJcbiAgICAgICAgb01vZGVsLm1ldGEudDNbQ2F0ZWdvcnlTdHJpbmddW3JldmVyc2VSZWxhdGlvblN0cl1bZG9tYWluU3RyXSAgPSB7fTtcclxuXHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBhZGQgYSBwcmVjaWNlIGRvbWFpbiBtYXRjaHJ1bGVcclxuICAgIGluc2VydFJ1bGVJZk5vdFByZXNlbnQob01vZGVsLm1SdWxlcywge1xyXG4gICAgICAgICAgICBjYXRlZ29yeTogXCJkb21haW5cIixcclxuICAgICAgICAgICAgbWF0Y2hlZFN0cmluZzogb01kbC5kb21haW4sXHJcbiAgICAgICAgICAgIHR5cGU6IElNYXRjaC5FbnVtUnVsZVR5cGUuV09SRCxcclxuICAgICAgICAgICAgd29yZDogb01kbC5kb21haW4sXHJcbiAgICAgICAgICAgIGJpdGluZGV4IDogb01kbC5iaXRpbmRleCxcclxuICAgICAgICAgICAgX3Jhbmtpbmc6IDAuOTVcclxuICAgICAgICB9LCBvTW9kZWwuc2VlblJ1bGVzKTtcclxuXHJcbiAgICAvLyBjaGVjayB0aGUgdG9vbFxyXG4gICAgaWYob01kbC50b29sICYmIG9NZGwudG9vbC5yZXF1aXJlcykge1xyXG4gICAgICAgIHZhciByZXF1aXJlcyA9IE9iamVjdC5rZXlzKG9NZGwudG9vbC5yZXF1aXJlcyB8fCB7fSk7XHJcbiAgICAgICAgdmFyIGRpZmYgPSBfLmRpZmZlcmVuY2UocmVxdWlyZXMsIG9NZGwuY2F0ZWdvcnkpO1xyXG4gICAgICAgICAgICBpZihkaWZmLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGAgJHtvTWRsLmRvbWFpbn0gOiBVbmtvd24gY2F0ZWdvcnkgaW4gcmVxdWlyZXMgb2YgdG9vbDogXCJgICsgZGlmZi5qb2luKCdcIicpICsgJ1wiJyk7XHJcbiAgICAgICAgICAgICAgICBwcm9jZXNzLmV4aXQoLTEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgdmFyIG9wdGlvbmFsID0gT2JqZWN0LmtleXMob01kbC50b29sLm9wdGlvbmFsKTtcclxuICAgICAgICBkaWZmID0gXy5kaWZmZXJlbmNlKG9wdGlvbmFsLCBvTWRsLmNhdGVnb3J5KTtcclxuICAgICAgICAgICAgaWYoZGlmZi5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhgICR7b01kbC5kb21haW59IDogVW5rb3duIGNhdGVnb3J5IG9wdGlvbmFsIG9mIHRvb2w6IFwiYCArIGRpZmYuam9pbignXCInKSArICdcIicpO1xyXG4gICAgICAgICAgICAgICAgcHJvY2Vzcy5leGl0KC0xKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIE9iamVjdC5rZXlzKG9NZGwudG9vbC5zZXRzIHx8IHt9KS5mb3JFYWNoKGZ1bmN0aW9uKHNldElEKSB7XHJcbiAgICAgICAgICAgIHZhciBkaWZmID0gXy5kaWZmZXJlbmNlKG9NZGwudG9vbC5zZXRzW3NldElEXS5zZXQsIG9NZGwuY2F0ZWdvcnkpO1xyXG4gICAgICAgICAgICBpZihkaWZmLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGAgJHtvTWRsLmRvbWFpbn0gOiBVbmtvd24gY2F0ZWdvcnkgaW4gc2V0SWQgJHtzZXRJRH0gb2YgdG9vbDogXCJgICsgZGlmZi5qb2luKCdcIicpICsgJ1wiJyk7XHJcbiAgICAgICAgICAgICAgICBwcm9jZXNzLmV4aXQoLTEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIGV4dHJhY3QgdG9vbHMgYW4gYWRkIHRvIHRvb2xzOlxyXG4gICAgICAgIG9Nb2RlbC50b29scy5maWx0ZXIoZnVuY3Rpb24gKG9FbnRyeSkge1xyXG4gICAgICAgICAgICBpZiAob0VudHJ5Lm5hbWUgPT09IChvTWRsLnRvb2wgJiYgb01kbC50b29sLm5hbWUpKSB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIlRvb2wgXCIgKyBvTWRsLnRvb2wubmFtZSArIFwiIGFscmVhZHkgcHJlc2VudCB3aGVuIGxvYWRpbmcgXCIgKyBzTW9kZWxOYW1lKTtcclxuICAgICAgICAgICAgICAgIC8vdGhyb3cgbmV3IEVycm9yKCdEb21haW4gYWxyZWFkeSBsb2FkZWQ/Jyk7XHJcbiAgICAgICAgICAgICAgICBwcm9jZXNzLmV4aXQoLTEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIG9NZGwudG9vbGhpZGRlbiA9IHRydWU7XHJcbiAgICAgICAgb01kbC50b29sLnJlcXVpcmVzID0geyBcImltcG9zc2libGVcIiA6IHt9fTtcclxuICAgIH1cclxuICAgIC8vIGFkZCB0aGUgdG9vbCBuYW1lIGFzIHJ1bGUgdW5sZXNzIGhpZGRlblxyXG4gICAgaWYgKCFvTWRsLnRvb2xoaWRkZW4gJiYgb01kbC50b29sICYmIG9NZGwudG9vbC5uYW1lKSB7XHJcbiAgICAgICAgaW5zZXJ0UnVsZUlmTm90UHJlc2VudChvTW9kZWwubVJ1bGVzLCB7XHJcbiAgICAgICAgICAgIGNhdGVnb3J5OiBcInRvb2xcIixcclxuICAgICAgICAgICAgbWF0Y2hlZFN0cmluZzogb01kbC50b29sLm5hbWUsXHJcbiAgICAgICAgICAgIHR5cGU6IElNYXRjaC5FbnVtUnVsZVR5cGUuV09SRCxcclxuICAgICAgICAgICAgd29yZDogb01kbC50b29sLm5hbWUsXHJcbiAgICAgICAgICAgIGJpdGluZGV4IDogb01kbC5iaXRpbmRleCxcclxuICAgICAgICAgICAgX3Jhbmtpbmc6IDAuOTVcclxuICAgICAgICB9LCBvTW9kZWwuc2VlblJ1bGVzKTtcclxuICAgIH07XHJcbiAgICBpZiAob01kbC5zeW5vbnltcyAmJiBvTWRsLnN5bm9ueW1zW1widG9vbFwiXSkge1xyXG4gICAgICAgIGFkZFN5bm9ueW1zKG9NZGwuc3lub255bXNbXCJ0b29sXCJdLCBcInRvb2xcIiwgb01kbC50b29sLm5hbWUsIG9NZGwuYml0aW5kZXgsIG9Nb2RlbC5tUnVsZXMsIG9Nb2RlbC5zZWVuUnVsZXMpO1xyXG4gICAgfTtcclxuICAgIGlmIChvTWRsLnN5bm9ueW1zKSB7XHJcbiAgICAgICAgT2JqZWN0LmtleXMob01kbC5zeW5vbnltcykuZm9yRWFjaChmdW5jdGlvbiAoc3N5bmtleSkge1xyXG4gICAgICAgICAgICBpZiAob01kbC5jYXRlZ29yeS5pbmRleE9mKHNzeW5rZXkpID49IDAgJiYgc3N5bmtleSAhPT0gXCJ0b29sXCIpIHtcclxuICAgICAgICAgICAgICAgIGlmIChvTW9kZWwuZnVsbC5kb21haW5bb01kbC5kb21haW5dLmNhdGVnb3JpZXNbc3N5bmtleV0pICB7XHJcbiAgICAgICAgICAgICAgICAgICBvTW9kZWwuZnVsbC5kb21haW5bb01kbC5kb21haW5dLmNhdGVnb3JpZXNbc3N5bmtleV0uc3lub255bXMgPSBvTWRsLnN5bm9ueW1zW3NzeW5rZXldO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGFkZFN5bm9ueW1zKG9NZGwuc3lub255bXNbc3N5bmtleV0sIFwiY2F0ZWdvcnlcIiwgc3N5bmtleSwgb01kbC5iaXRpbmRleCwgb01vZGVsLm1SdWxlcywgb01vZGVsLnNlZW5SdWxlcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIG9Nb2RlbC5kb21haW5zLnB1c2gob01kbC5kb21haW4pO1xyXG4gICAgaWYob01kbC50b29sLm5hbWUpIHtcclxuICAgICAgb01vZGVsLnRvb2xzLnB1c2gob01kbC50b29sKTtcclxuICAgIH1cclxuICAgIG9Nb2RlbC5jYXRlZ29yeSA9IG9Nb2RlbC5jYXRlZ29yeS5jb25jYXQob01kbC5jYXRlZ29yeSk7XHJcbiAgICBvTW9kZWwuY2F0ZWdvcnkuc29ydCgpO1xyXG4gICAgb01vZGVsLmNhdGVnb3J5ID0gb01vZGVsLmNhdGVnb3J5LmZpbHRlcihmdW5jdGlvbiAoc3RyaW5nLCBpbmRleCkge1xyXG4gICAgICAgIHJldHVybiBvTW9kZWwuY2F0ZWdvcnlbaW5kZXhdICE9PSBvTW9kZWwuY2F0ZWdvcnlbaW5kZXggKyAxXTtcclxuICAgIH0pO1xyXG5cclxufSAvLyBsb2FkbW9kZWxcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBzcGxpdFJ1bGVzKHJ1bGVzIDogSU1hdGNoLm1SdWxlW10pIDogSU1hdGNoLlNwbGl0UnVsZXMge1xyXG4gICAgdmFyIHJlcyA9IHt9O1xyXG4gICAgdmFyIG5vbldvcmRSdWxlcyA9IFtdO1xyXG4gICAgcnVsZXMuZm9yRWFjaChmdW5jdGlvbihydWxlKSB7XHJcbiAgICAgICAgaWYocnVsZS50eXBlID09PSBJTWF0Y2guRW51bVJ1bGVUeXBlLldPUkQpIHtcclxuICAgICAgICAgICAgaWYoIXJ1bGUubG93ZXJjYXNld29yZCkge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiUnVsZSBoYXMgbm8gbWVtYmVyIGxvd2VyY2FzZXdvcmRcIiArIEpTT04uc3RyaW5naWZ5KHJ1bGUpKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXNbcnVsZS5sb3dlcmNhc2V3b3JkXSA9IHJlc1tydWxlLmxvd2VyY2FzZXdvcmRdIHx8IHsgYml0aW5kZXggOiAwLCBydWxlcyA6W10gfTtcclxuICAgICAgICAgICAgcmVzW3J1bGUubG93ZXJjYXNld29yZF0uYml0aW5kZXggPSByZXNbcnVsZS5sb3dlcmNhc2V3b3JkXS5iaXRpbmRleCB8IHJ1bGUuYml0aW5kZXg7XHJcbiAgICAgICAgICAgIHJlc1tydWxlLmxvd2VyY2FzZXdvcmRdLnJ1bGVzLnB1c2gocnVsZSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgbm9uV29yZFJ1bGVzLnB1c2gocnVsZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIHdvcmRNYXA6IHJlcyxcclxuICAgICAgICBub25Xb3JkUnVsZXMgOiBub25Xb3JkUnVsZXMsXHJcbiAgICAgICAgYWxsUnVsZXMgOiBydWxlc1xyXG4gICAgfTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGxvYWRNb2RlbHMobW9kZWxQYXRoPyA6IHN0cmluZykgOiBJTWF0Y2guSU1vZGVscyB7XHJcbiAgICB2YXIgb01vZGVsOiBJTWF0Y2guSU1vZGVscztcclxuICAgIG9Nb2RlbCA9IHtcclxuICAgICAgICBmdWxsIDogeyBkb21haW4gOiB7fX0sXHJcbiAgICAgICAgZG9tYWluczogW10sXHJcbiAgICAgICAgdG9vbHM6IFtdLFxyXG4gICAgICAgIHJ1bGVzIDogdW5kZWZpbmVkLFxyXG4gICAgICAgIGNhdGVnb3J5OiBbXSxcclxuICAgICAgICBvcGVyYXRvcnMgOiB7fSxcclxuICAgICAgICBtUnVsZXM6IFtdLFxyXG4gICAgICAgIHNlZW5SdWxlcyA6IHt9LFxyXG4gICAgICAgIHJlY29yZHM6IFtdLFxyXG4gICAgICAgIG1ldGEgOiB7IHQzIDoge30gfVxyXG4gICAgfVxyXG4gICAgbW9kZWxQYXRoID0gbW9kZWxQYXRoIHx8IGVudk1vZGVsUGF0aDtcclxuICAgIHZhciBzbWRscyA9IGZzLnJlYWRGaWxlU3luYygnLi8nICsgbW9kZWxQYXRoICsgJy9tb2RlbHMuanNvbicsICd1dGYtOCcpO1xyXG4gICAgdmFyIG1kbHMgPSBKU09OLnBhcnNlKFwiXCIgKyBzbWRscyk7XHJcbiAgICBtZGxzLmZvckVhY2goZnVuY3Rpb24gKHNNb2RlbE5hbWUpIHtcclxuICAgICAgICBsb2FkTW9kZWwobW9kZWxQYXRoLCBzTW9kZWxOYW1lLCBvTW9kZWwpXHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBhZGQgdGhlIGNhdGVnb3JpZXMgdG8gdGhlIG1vZGVsOlxyXG4gICAgLypcclxuICAgIG9Nb2RlbC5jYXRlZ29yeS5mb3JFYWNoKGZ1bmN0aW9uIChjYXRlZ29yeSkge1xyXG4gICAgICAgIGluc2VydFJ1bGVJZk5vdFByZXNlbnQob01vZGVsLm1SdWxlcywge1xyXG4gICAgICAgICAgICBjYXRlZ29yeTogXCJjYXRlZ29yeVwiLFxyXG4gICAgICAgICAgICBtYXRjaGVkU3RyaW5nOiBjYXRlZ29yeSxcclxuICAgICAgICAgICAgdHlwZTogSU1hdGNoLkVudW1SdWxlVHlwZS5XT1JELFxyXG4gICAgICAgICAgICB3b3JkOiBjYXRlZ29yeSxcclxuICAgICAgICAgICAgbG93ZXJjYXNld29yZDogY2F0ZWdvcnkudG9Mb3dlckNhc2UoKSxcclxuICAgICAgICAgICAgYml0aW5kZXggOiBvTWRsLlxyXG4gICAgICAgICAgICBfcmFua2luZzogMC45NVxyXG4gICAgICAgIH0sIG9Nb2RlbC5zZWVuUnVsZXMpO1xyXG4gICAgfSk7XHJcbiAgICAqL1xyXG5cclxuICAgIHZhciBtZXRhQml0SW5kZXggPSBnZXREb21haW5CaXRJbmRleCgnbWV0YScsb01vZGVsKTtcclxuXHJcbiAgICAvLyBhZGQgdGhlIGRvbWFpbiBtZXRhIHJ1bGVcclxuICAgIGluc2VydFJ1bGVJZk5vdFByZXNlbnQob01vZGVsLm1SdWxlcywge1xyXG4gICAgICAgICAgICBjYXRlZ29yeTogXCJtZXRhXCIsXHJcbiAgICAgICAgICAgIG1hdGNoZWRTdHJpbmc6IFwiZG9tYWluXCIsXHJcbiAgICAgICAgICAgIHR5cGU6IElNYXRjaC5FbnVtUnVsZVR5cGUuV09SRCxcclxuICAgICAgICAgICAgd29yZDogXCJkb21haW5cIixcclxuICAgICAgICAgICAgYml0aW5kZXggOiBtZXRhQml0SW5kZXgsXHJcbiAgICAgICAgICAgIF9yYW5raW5nOiAwLjk1XHJcbiAgICAgICAgfSwgb01vZGVsLnNlZW5SdWxlcyk7XHJcblxyXG5cclxuICAgIHZhciBmaWxsZXJCaXRJbmRleCA9IGdldERvbWFpbkJpdEluZGV4KCdtZXRhJyxvTW9kZWwpO1xyXG4gICAgLy9hZGQgYSBmaWxsZXIgcnVsZVxyXG4gICAgdmFyIHNmaWxsZXJzID0gZnMucmVhZEZpbGVTeW5jKCcuLycgKyBtb2RlbFBhdGggKyAnL2ZpbGxlci5qc29uJywgJ3V0Zi04Jyk7XHJcbiAgICB2YXIgZmlsbGVycyA9IEpTT04ucGFyc2Uoc2ZpbGxlcnMpO1xyXG4gICAgdmFyIHJlID0gXCJeKChcIiArIGZpbGxlcnMuam9pbihcIil8KFwiKSArIFwiKSkkXCI7XHJcbiAgICBvTW9kZWwubVJ1bGVzLnB1c2goe1xyXG4gICAgICAgIGNhdGVnb3J5OiBcImZpbGxlclwiLFxyXG4gICAgICAgIHR5cGU6IElNYXRjaC5FbnVtUnVsZVR5cGUuUkVHRVhQLFxyXG4gICAgICAgIHJlZ2V4cDogbmV3IFJlZ0V4cChyZSwgXCJpXCIpLFxyXG4gICAgICAgIG1hdGNoZWRTdHJpbmc6IFwiZmlsbGVyXCIsXHJcbiAgICAgICAgYml0aW5kZXggOiBmaWxsZXJCaXRJbmRleCxcclxuICAgICAgICBfcmFua2luZzogMC45XHJcbiAgICB9KTtcclxuXHJcbiAgICAvL2FkZCBvcGVyYXRvcnNcclxuICAgIHZhciBzT3BlcmF0b3JzID0gZnMucmVhZEZpbGVTeW5jKCcuL3Jlc291cmNlcy9tb2RlbC9vcGVyYXRvcnMuanNvbicsICd1dGYtOCcpO1xyXG4gICAgdmFyIG9wZXJhdG9ycyA9IEpTT04ucGFyc2Uoc09wZXJhdG9ycyk7XHJcbiAgICB2YXIgb3BlcmF0b3JCaXRJbmRleCA9IGdldERvbWFpbkJpdEluZGV4KCdvcGVyYXRvcnMnLG9Nb2RlbCk7XHJcbiAgICBPYmplY3Qua2V5cyhvcGVyYXRvcnMub3BlcmF0b3JzKS5mb3JFYWNoKGZ1bmN0aW9uKG9wZXJhdG9yKSB7XHJcbiAgICAgICAgaWYoSU1hdGNoLmFPcGVyYXRvck5hbWVzLmluZGV4T2Yob3BlcmF0b3IpIDwgMCkge1xyXG4gICAgICAgICAgICBkZWJ1Z2xvZyhcInVua25vd24gb3BlcmF0b3IgXCIgKyBvcGVyYXRvcik7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcInVua25vd24gb3BlcmF0b3IgXCIgKyBvcGVyYXRvcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG9Nb2RlbC5vcGVyYXRvcnNbb3BlcmF0b3JdID0gb3BlcmF0b3JzLm9wZXJhdG9yc1tvcGVyYXRvcl07XHJcbiAgICAgICAgb01vZGVsLm9wZXJhdG9yc1tvcGVyYXRvcl0ub3BlcmF0b3IgPSA8SU1hdGNoLk9wZXJhdG9yTmFtZT4gb3BlcmF0b3I7XHJcbiAgICAgICAgT2JqZWN0LmZyZWV6ZShvTW9kZWwub3BlcmF0b3JzW29wZXJhdG9yXSk7XHJcbiAgICAgICAgdmFyIHdvcmQgPSBvcGVyYXRvcjtcclxuICAgICAgICBpbnNlcnRSdWxlSWZOb3RQcmVzZW50KG9Nb2RlbC5tUnVsZXMsIHtcclxuICAgICAgICAgICAgY2F0ZWdvcnk6IFwib3BlcmF0b3JcIixcclxuICAgICAgICAgICAgd29yZCA6IHdvcmQudG9Mb3dlckNhc2UoKSxcclxuICAgICAgICAgICAgbG93ZXJjYXNld29yZCA6IHdvcmQudG9Mb3dlckNhc2UoKSxcclxuICAgICAgICAgICAgdHlwZTogSU1hdGNoLkVudW1SdWxlVHlwZS5XT1JELFxyXG4gICAgICAgICAgICBtYXRjaGVkU3RyaW5nIDogd29yZCxcclxuICAgICAgICAgICAgYml0aW5kZXggOiBvcGVyYXRvckJpdEluZGV4LFxyXG4gICAgICAgICAgICBfcmFua2luZzogMC45XHJcbiAgICAgICAgfSwgb01vZGVsLnNlZW5SdWxlcyk7XHJcbiAgICAgICAgLy8gYWRkIGFsbCBzeW5vbnltc1xyXG4gICAgICAgIGlmKG9wZXJhdG9ycy5zeW5vbnltc1tvcGVyYXRvcl0pIHtcclxuICAgICAgICAgICAgT2JqZWN0LmtleXMob3BlcmF0b3JzLnN5bm9ueW1zW29wZXJhdG9yXSkuZm9yRWFjaChmdW5jdGlvbihzeW5vbnltKSB7XHJcbiAgICAgICAgICAgICAgICBpbnNlcnRSdWxlSWZOb3RQcmVzZW50KG9Nb2RlbC5tUnVsZXMse1xyXG4gICAgICAgICAgICAgICAgICAgIGNhdGVnb3J5OiBcIm9wZXJhdG9yXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgd29yZCA6IHN5bm9ueW0udG9Mb3dlckNhc2UoKSxcclxuICAgICAgICAgICAgICAgICAgICBsb3dlcmNhc2V3b3JkIDogc3lub255bS50b0xvd2VyQ2FzZSgpLFxyXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IElNYXRjaC5FbnVtUnVsZVR5cGUuV09SRCxcclxuICAgICAgICAgICAgICAgICAgICBtYXRjaGVkU3RyaW5nIDogb3BlcmF0b3IsXHJcbiAgICAgICAgICAgICAgICAgICAgYml0aW5kZXggOiBvcGVyYXRvckJpdEluZGV4LFxyXG4gICAgICAgICAgICAgICAgICAgIF9yYW5raW5nOiAwLjlcclxuICAgICAgICAgICAgICAgIH0sIG9Nb2RlbC5zZWVuUnVsZXMpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuICAgIC8qXHJcbiAgICAgICAgfSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgY2F0ZWdvcnk6IFwiZmlsbGVyXCIsXHJcbiAgICAgICAgICB0eXBlOiAxLFxyXG4gICAgICAgICAgcmVnZXhwOiAvXigoc3RhcnQpfChzaG93KXwoZnJvbSl8KGluKSkkL2ksXHJcbiAgICAgICAgICBtYXRjaGVkU3RyaW5nOiBcImZpbGxlclwiLFxyXG4gICAgICAgICAgX3Jhbmtpbmc6IDAuOVxyXG4gICAgICAgIH0sXHJcbiAgICAqL1xyXG4gICAgb01vZGVsLm1SdWxlcyA9IG9Nb2RlbC5tUnVsZXMuc29ydChJbnB1dEZpbHRlclJ1bGVzLmNtcE1SdWxlKTtcclxuICAgIG9Nb2RlbC5ydWxlcyA9IHNwbGl0UnVsZXMob01vZGVsLm1SdWxlcyk7XHJcbiAgICBvTW9kZWwudG9vbHMgPSBvTW9kZWwudG9vbHMuc29ydChUb29scy5jbXBUb29scyk7XHJcbiAgICBkZWxldGUgb01vZGVsLnNlZW5SdWxlcztcclxuICAgIHJldHVybiBvTW9kZWw7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBzb3J0Q2F0ZWdvcmllc0J5SW1wb3J0YW5jZSggbWFwIDoge1trZXkgOiBzdHJpbmddIDogSU1hdGNoLklDYXRlZ29yeURlc2MgfSwgY2F0cyA6IHN0cmluZ1tdKSA6IHN0cmluZ1tdIHtcclxuICAgIHZhciByZXMgPSBjYXRzLnNsaWNlKDApO1xyXG4gICAgcmVzLnNvcnQocmFua0NhdGVnb3J5QnlJbXBvcnRhbmNlLmJpbmQodW5kZWZpbmVkLG1hcCkpO1xyXG4gICAgcmV0dXJuIHJlcztcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHJhbmtDYXRlZ29yeUJ5SW1wb3J0YW5jZShtYXAgOiB7W2tleSA6IHN0cmluZ10gOiBJTWF0Y2guSUNhdGVnb3J5RGVzYyB9LCBjYXRhIDogc3RyaW5nLCBjYXRiIDogc3RyaW5nKSA6IG51bWJlciB7XHJcbiAgICB2YXIgY2F0QURlc2MgPSBtYXBbY2F0YV07XHJcbiAgICB2YXIgY2F0QkRlc2MgPSBtYXBbY2F0Yl07XHJcbiAgICBpZiAoY2F0YSA9PT0gY2F0Yikge1xyXG4gICAgICAgIHJldHVybiAwO1xyXG4gICAgfVxyXG4gICAgLy8gaWYgYSBpcyBiZWZvcmUgYiwgcmV0dXJuIC0xXHJcbiAgICBpZihjYXRBRGVzYyAmJiAhY2F0QkRlc2MpIHtcclxuICAgICAgICByZXR1cm4gLTE7XHJcbiAgICB9XHJcbiAgICBpZighY2F0QURlc2MgJiYgY2F0QkRlc2MpIHtcclxuICAgICAgICByZXR1cm4gKzE7XHJcbiAgICB9XHJcblxyXG4gICAgdmFyIHByaW9BID0gKGNhdEFEZXNjICYmIGNhdEFEZXNjLmltcG9ydGFuY2UpIHx8IDk5O1xyXG4gICAgdmFyIHByaW9CID0gKGNhdEJEZXNjICYmIGNhdEJEZXNjLmltcG9ydGFuY2UpIHx8IDk5O1xyXG4gICAgLy8gbG93ZXIgcHJpbyBnb2VzIHRvIGZyb250XHJcbiAgICB2YXIgciA9IHByaW9BIC0gcHJpb0I7XHJcbiAgICBpZihyKSB7XHJcbiAgICAgICAgcmV0dXJuIHI7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gY2F0YS5sb2NhbGVDb21wYXJlKGNhdGIpO1xyXG59XHJcblxyXG5jb25zdCBNZXRhRiA9IE1ldGEuZ2V0TWV0YUZhY3RvcnkoKTtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRPcGVyYXRvcihtZGw6IElNYXRjaC5JTW9kZWxzLCBvcGVyYXRvciA6IHN0cmluZykgOiBJTWF0Y2guSU9wZXJhdG9yIHtcclxuICAgIHJldHVybiBtZGwub3BlcmF0b3JzW29wZXJhdG9yXTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldFJlc3VsdEFzQXJyYXkobWRsIDogSU1hdGNoLklNb2RlbHMsIGEgOiBNZXRhLklNZXRhLCByZWwgOiBNZXRhLklNZXRhKSA6IE1ldGEuSU1ldGFbXSB7XHJcbiAgICBpZihyZWwudG9UeXBlKCkgIT09ICdyZWxhdGlvbicpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJleHBlY3QgcmVsYXRpb24gYXMgMm5kIGFyZ1wiKTtcclxuICAgIH1cclxuXHJcbiAgICB2YXIgcmVzID0gbWRsLm1ldGEudDNbYS50b0Z1bGxTdHJpbmcoKV0gJiZcclxuICAgIG1kbC5tZXRhLnQzW2EudG9GdWxsU3RyaW5nKCldW3JlbC50b0Z1bGxTdHJpbmcoKV07XHJcbiAgICBpZighcmVzKSB7XHJcbiAgICAgICAgcmV0dXJuIFtdO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKHJlcykuc29ydCgpLm1hcChNZXRhRi5wYXJzZUlNZXRhKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldENhdGVnb3JpZXNGb3JEb21haW4odGhlTW9kZWwgOiBJTWF0Y2guSU1vZGVscywgZG9tYWluIDogc3RyaW5nKSA6IHN0cmluZ1tdIHtcclxuICAgIGlmKHRoZU1vZGVsLmRvbWFpbnMuaW5kZXhPZihkb21haW4pIDwgMCkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkRvbWFpbiBcXFwiXCIgKyBkb21haW4gKyBcIlxcXCIgbm90IHBhcnQgb2YgbW9kZWxcIik7XHJcbiAgICB9XHJcbiAgICB2YXIgcmVzID0gZ2V0UmVzdWx0QXNBcnJheSh0aGVNb2RlbCwgTWV0YUYuRG9tYWluKGRvbWFpbiksIE1ldGFGLlJlbGF0aW9uKE1ldGEuUkVMQVRJT05faGFzQ2F0ZWdvcnkpKTtcclxuICAgIHJldHVybiBNZXRhLmdldFN0cmluZ0FycmF5KHJlcyk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBSZXR1cm4gYWxsIGNhdGVnb3JpZXMgb2YgYSBkb21haW4gd2hpY2ggY2FuIGFwcGVhciBvbiBhIHdvcmQsXHJcbiAqIHRoZXNlIGFyZSB0eXBpY2FsbHkgdGhlIHdvcmRpbmRleCBkb21haW5zICsgZW50cmllcyBnZW5lcmF0ZWQgYnkgZ2VuZXJpYyBydWxlc1xyXG4gKlxyXG4gKiBUaGUgY3VycmVudCBpbXBsZW1lbnRhdGlvbiBpcyBhIHNpbXBsaWZpY2F0aW9uXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gZ2V0UG90ZW50aWFsV29yZENhdGVnb3JpZXNGb3JEb21haW4odGhlTW9kZWwgOiBJTWF0Y2guSU1vZGVscywgZG9tYWluIDogc3RyaW5nKSA6IHN0cmluZ1tdIHtcclxuICAgIC8vIHRoaXMgaXMgYSBzaW1wbGlmaWVkIHZlcnNpb25cclxuICAgIHJldHVybiBnZXRDYXRlZ29yaWVzRm9yRG9tYWluKHRoZU1vZGVsLCBkb21haW4pO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0RG9tYWluc0ZvckNhdGVnb3J5KHRoZU1vZGVsIDogSU1hdGNoLklNb2RlbHMsIGNhdGVnb3J5IDogc3RyaW5nKSA6IHN0cmluZ1tdIHtcclxuICAgIGlmKHRoZU1vZGVsLmNhdGVnb3J5LmluZGV4T2YoY2F0ZWdvcnkpIDwgMCkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhdGVnb3J5IFxcXCJcIiArIGNhdGVnb3J5ICsgXCJcXFwiIG5vdCBwYXJ0IG9mIG1vZGVsXCIpO1xyXG4gICAgfVxyXG4gICAgdmFyIHJlcyA9IGdldFJlc3VsdEFzQXJyYXkodGhlTW9kZWwsIE1ldGFGLkNhdGVnb3J5KGNhdGVnb3J5KSwgTWV0YUYuUmVsYXRpb24oTWV0YS5SRUxBVElPTl9pc0NhdGVnb3J5T2YpKTtcclxuICAgIHJldHVybiBNZXRhLmdldFN0cmluZ0FycmF5KHJlcyk7XHJcbn1cclxuXHJcblxyXG4gZXhwb3J0IGZ1bmN0aW9uIGdldEFsbFJlY29yZENhdGVnb3JpZXNGb3JUYXJnZXRDYXRlZ29yeShtb2RlbCA6IElNYXRjaC5JTW9kZWxzLCBjYXRlZ29yeSA6IHN0cmluZywgd29yZHNvbmx5IDogYm9vbGVhbikgOiB7W2tleTogc3RyaW5nXSA6IGJvb2xlYW59IHtcclxuICAgIHZhciByZXMgPSB7fTtcclxuICAgIC8vXHJcbiAgICB2YXIgZm4gPSB3b3Jkc29ubHkgPyBnZXRQb3RlbnRpYWxXb3JkQ2F0ZWdvcmllc0ZvckRvbWFpbiA6IGdldENhdGVnb3JpZXNGb3JEb21haW47XHJcbiAgICB2YXIgZG9tYWlucyA9IGdldERvbWFpbnNGb3JDYXRlZ29yeShtb2RlbCwgY2F0ZWdvcnkpO1xyXG4gICAgZG9tYWlucy5mb3JFYWNoKGZ1bmN0aW9uKGRvbWFpbikge1xyXG4gICAgICAgIGZuKG1vZGVsLCBkb21haW4pLmZvckVhY2goZnVuY3Rpb24od29yZGNhdCkge1xyXG4gICAgICAgICAgICByZXNbd29yZGNhdF0gPSB0cnVlO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZnJlZXplKHJlcyk7XHJcbiAgICByZXR1cm4gcmVzO1xyXG4gfVxyXG5cclxuIGV4cG9ydCBmdW5jdGlvbiBnZXRBbGxSZWNvcmRDYXRlZ29yaWVzRm9yVGFyZ2V0Q2F0ZWdvcmllcyhtb2RlbCA6IElNYXRjaC5JTW9kZWxzLCBjYXRlZ29yaWVzIDogc3RyaW5nW10sIHdvcmRzb25seSA6IGJvb2xlYW4pIDoge1trZXk6IHN0cmluZ10gOiBib29sZWFufSB7XHJcbiAgICB2YXIgcmVzID0ge307XHJcbiAgICAvL1xyXG4gICAgdmFyIGZuID0gd29yZHNvbmx5ID8gZ2V0UG90ZW50aWFsV29yZENhdGVnb3JpZXNGb3JEb21haW4gOiBnZXRDYXRlZ29yaWVzRm9yRG9tYWluO1xyXG4gICAgdmFyIGRvbWFpbnMgPSB1bmRlZmluZWQ7XHJcbiAgICBjYXRlZ29yaWVzLmZvckVhY2goZnVuY3Rpb24oY2F0ZWdvcnkpIHtcclxuICAgICAgICB2YXIgY2F0ZG9tYWlucyA9IGdldERvbWFpbnNGb3JDYXRlZ29yeShtb2RlbCwgY2F0ZWdvcnkpXHJcbiAgICAgICAgaWYoIWRvbWFpbnMpIHtcclxuICAgICAgICAgICAgZG9tYWlucyA9IGNhdGRvbWFpbnM7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgZG9tYWlucyA9IF8uaW50ZXJzZWN0aW9uKGRvbWFpbnMsIGNhdGRvbWFpbnMpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgaWYoZG9tYWlucy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2NhdGVnb3JpZXMgJyArIFV0aWxzLmxpc3RUb1F1b3RlZENvbW1hQW5kKGNhdGVnb3JpZXMpICsgJyBoYXZlIG5vIGNvbW1vbiBkb21haW4uJylcclxuICAgIH1cclxuICAgIGRvbWFpbnMuZm9yRWFjaChmdW5jdGlvbihkb21haW4pIHtcclxuICAgICAgICBmbihtb2RlbCwgZG9tYWluKS5mb3JFYWNoKGZ1bmN0aW9uKHdvcmRjYXQpIHtcclxuICAgICAgICAgICAgcmVzW3dvcmRjYXRdID0gdHJ1ZTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmZyZWV6ZShyZXMpO1xyXG4gICAgcmV0dXJuIHJlcztcclxuIH1cclxuXHJcblxyXG4iLCIvKipcbiAqIEZ1bmN0aW9uYWxpdHkgbWFuYWdpbmcgdGhlIG1hdGNoIG1vZGVsc1xuICpcbiAqIEBmaWxlXG4gKi9cblwidXNlIHN0cmljdFwiO1xudmFyIGRlYnVnID0gcmVxdWlyZShcImRlYnVnXCIpO1xudmFyIGRlYnVnbG9nID0gZGVidWcoJ21vZGVsJyk7XG52YXIgbG9nZ2VyID0gcmVxdWlyZShcIi4uL3V0aWxzL2xvZ2dlclwiKTtcbnZhciBsb2FkbG9nID0gbG9nZ2VyLmxvZ2dlcignbW9kZWxsb2FkJywgJycpO1xudmFyIElNYXRjaCA9IHJlcXVpcmUoXCIuLi9tYXRjaC9pZm1hdGNoXCIpO1xudmFyIElucHV0RmlsdGVyUnVsZXMgPSByZXF1aXJlKFwiLi4vbWF0Y2gvaW5wdXRGaWx0ZXJSdWxlc1wiKTtcbnZhciBUb29scyA9IHJlcXVpcmUoXCIuLi9tYXRjaC90b29sc1wiKTtcbnZhciBmcyA9IHJlcXVpcmUoXCJmc1wiKTtcbnZhciBNZXRhID0gcmVxdWlyZShcIi4vbWV0YVwiKTtcbnZhciBVdGlscyA9IHJlcXVpcmUoXCIuLi91dGlscy91dGlsc1wiKTtcbnZhciBwcm9jZXNzID0gcmVxdWlyZShcInByb2Nlc3NcIik7XG52YXIgXyA9IHJlcXVpcmUoXCJsb2Rhc2hcIik7XG4vKipcbiAqIHRoZSBtb2RlbCBwYXRoLCBtYXkgYmUgY29udHJvbGxlZCB2aWEgZW52aXJvbm1lbnQgdmFyaWFibGVcbiAqL1xudmFyIGVudk1vZGVsUGF0aCA9IHByb2Nlc3MuZW52W1wiQUJPVF9NT0RFTFBBVEhcIl0gfHwgXCJ0ZXN0bW9kZWxcIjtcbjtcbnZhciBBUlJfTU9ERUxfUFJPUEVSVElFUyA9IFtcImRvbWFpblwiLCBcImJpdGluZGV4XCIsIFwiY2F0ZWdvcnlEZXNjcmliZWRcIiwgXCJkZXNjcmlwdGlvblwiLCBcInRvb2xcIiwgXCJ0b29saGlkZGVuXCIsIFwic3lub255bXNcIiwgXCJjYXRlZ29yeVwiLCBcIndvcmRpbmRleFwiLCBcImV4YWN0bWF0Y2hcIiwgXCJoaWRkZW5cIl07XG5mdW5jdGlvbiBhZGRTeW5vbnltcyhzeW5vbnltcywgY2F0ZWdvcnksIHN5bm9ueW1Gb3IsIGJpdGluZGV4LCBtUnVsZXMsIHNlZW4pIHtcbiAgICBzeW5vbnltcy5mb3JFYWNoKGZ1bmN0aW9uIChzeW4pIHtcbiAgICAgICAgdmFyIG9SdWxlID0ge1xuICAgICAgICAgICAgY2F0ZWdvcnk6IGNhdGVnb3J5LFxuICAgICAgICAgICAgbWF0Y2hlZFN0cmluZzogc3lub255bUZvcixcbiAgICAgICAgICAgIHR5cGU6IDAgLyogV09SRCAqLyxcbiAgICAgICAgICAgIHdvcmQ6IHN5bixcbiAgICAgICAgICAgIGJpdGluZGV4OiBiaXRpbmRleCxcbiAgICAgICAgICAgIF9yYW5raW5nOiAwLjk1XG4gICAgICAgIH07XG4gICAgICAgIGRlYnVnbG9nKFwiaW5zZXJ0aW5nIHN5bm9ueW1cIiArIEpTT04uc3RyaW5naWZ5KG9SdWxlKSk7XG4gICAgICAgIGluc2VydFJ1bGVJZk5vdFByZXNlbnQobVJ1bGVzLCBvUnVsZSwgc2Vlbik7XG4gICAgfSk7XG59XG5mdW5jdGlvbiBnZXRSdWxlS2V5KHJ1bGUpIHtcbiAgICByZXR1cm4gcnVsZS5tYXRjaGVkU3RyaW5nICsgXCItfC1cIiArIHJ1bGUuY2F0ZWdvcnkgKyBcIiAtfC0gXCIgKyBydWxlLnR5cGUgKyBcIiAtfC0gXCIgKyBydWxlLndvcmQgKyBcIiBcIjtcbn1cbmZ1bmN0aW9uIGluc2VydFJ1bGVJZk5vdFByZXNlbnQobVJ1bGVzLCBydWxlLCBzZWVuUnVsZXMpIHtcbiAgICBpZiAocnVsZS50eXBlICE9PSAwIC8qIFdPUkQgKi8pIHtcbiAgICAgICAgbVJ1bGVzLnB1c2gocnVsZSk7XG4gICAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKChydWxlLndvcmQgPT09IHVuZGVmaW5lZCkgfHwgKHJ1bGUubWF0Y2hlZFN0cmluZyA9PT0gdW5kZWZpbmVkKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2lsbGVnYWwgcnVsZScgKyBKU09OLnN0cmluZ2lmeShydWxlLCB1bmRlZmluZWQsIDIpKTtcbiAgICB9XG4gICAgdmFyIHIgPSBnZXRSdWxlS2V5KHJ1bGUpO1xuICAgIHJ1bGUubG93ZXJjYXNld29yZCA9IHJ1bGUud29yZC50b0xvd2VyQ2FzZSgpO1xuICAgIGlmIChzZWVuUnVsZXNbcl0pIHtcbiAgICAgICAgZGVidWdsb2coXCJBdHRlbXB0aW5nIHRvIGluc2VydCBkdXBsaWNhdGVcIiArIEpTT04uc3RyaW5naWZ5KHJ1bGUsIHVuZGVmaW5lZCwgMikpO1xuICAgICAgICB2YXIgZHVwbGljYXRlcyA9IHNlZW5SdWxlc1tyXS5maWx0ZXIoZnVuY3Rpb24gKG9FbnRyeSkge1xuICAgICAgICAgICAgcmV0dXJuIDAgPT09IElucHV0RmlsdGVyUnVsZXMuY29tcGFyZU1SdWxlRnVsbChvRW50cnksIHJ1bGUpO1xuICAgICAgICB9KTtcbiAgICAgICAgaWYgKGR1cGxpY2F0ZXMubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgfVxuICAgIHNlZW5SdWxlc1tyXSA9IChzZWVuUnVsZXNbcl0gfHwgW10pO1xuICAgIHNlZW5SdWxlc1tyXS5wdXNoKHJ1bGUpO1xuICAgIGlmIChydWxlLndvcmQgPT09IFwiXCIpIHtcbiAgICAgICAgZGVidWdsb2coJ1NraXBwaW5nIHJ1bGUgd2l0aCBlbXRweSB3b3JkICcgKyBKU09OLnN0cmluZ2lmeShydWxlLCB1bmRlZmluZWQsIDIpKTtcbiAgICAgICAgbG9hZGxvZygnU2tpcHBpbmcgcnVsZSB3aXRoIGVtdHB5IHdvcmQgJyArIEpTT04uc3RyaW5naWZ5KHJ1bGUsIHVuZGVmaW5lZCwgMikpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIG1SdWxlcy5wdXNoKHJ1bGUpO1xuICAgIHJldHVybjtcbn1cbmZ1bmN0aW9uIGxvYWRNb2RlbERhdGEobW9kZWxQYXRoLCBvTWRsLCBzTW9kZWxOYW1lLCBvTW9kZWwpIHtcbiAgICAvLyByZWFkIHRoZSBkYXRhIC0+XG4gICAgLy8gZGF0YSBpcyBwcm9jZXNzZWQgaW50byBtUnVsZXMgZGlyZWN0bHksXG4gICAgdmFyIGJpdGluZGV4ID0gb01kbC5iaXRpbmRleDtcbiAgICB2YXIgc0ZpbGVOYW1lID0gKCcuLycgKyBtb2RlbFBhdGggKyAnLycgKyBzTW9kZWxOYW1lICsgXCIuZGF0YS5qc29uXCIpO1xuICAgIHZhciBtZGxkYXRhID0gZnMucmVhZEZpbGVTeW5jKHNGaWxlTmFtZSwgJ3V0Zi04Jyk7XG4gICAgdmFyIG9NZGxEYXRhID0gSlNPTi5wYXJzZShtZGxkYXRhKTtcbiAgICBvTWRsRGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChvRW50cnkpIHtcbiAgICAgICAgaWYgKCFvRW50cnkudG9vbCkge1xuICAgICAgICAgICAgb0VudHJ5Ll9kb21haW4gPSBvTWRsLmRvbWFpbjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIW9FbnRyeS50b29sICYmIG9NZGwudG9vbC5uYW1lKSB7XG4gICAgICAgICAgICBvRW50cnkudG9vbCA9IG9NZGwudG9vbC5uYW1lO1xuICAgICAgICB9XG4gICAgICAgIG9Nb2RlbC5yZWNvcmRzLnB1c2gob0VudHJ5KTtcbiAgICAgICAgb01kbC5jYXRlZ29yeS5mb3JFYWNoKGZ1bmN0aW9uIChjYXQpIHtcbiAgICAgICAgICAgIGlmIChvRW50cnlbY2F0XSA9PT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAgICAgICAgICAgICBvRW50cnlbY2F0XSA9IFwibi9hXCI7XG4gICAgICAgICAgICAgICAgdmFyIGJ1ZyA9IFwiSU5DT05TSVNURU5UKj4gTW9kZWxEYXRhIFwiICsgc0ZpbGVOYW1lICsgXCIgZG9lcyBub3QgY29udGFpbiBjYXRlZ29yeSBcIiArIGNhdCArIFwiIHdpdGggdmFsdWUgJ3VuZGVmaW5lZCcsIHVuZGVmaW5lZCBpcyBpbGxlZ2FsIHZhbHVlLCB1c2Ugbi9hIFwiICsgSlNPTi5zdHJpbmdpZnkob0VudHJ5KSArIFwiXCI7XG4gICAgICAgICAgICAgICAgZGVidWdsb2coYnVnKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgICAgIG9NZGwud29yZGluZGV4LmZvckVhY2goZnVuY3Rpb24gKGNhdGVnb3J5KSB7XG4gICAgICAgICAgICBpZiAob0VudHJ5W2NhdGVnb3J5XSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICAgICAgICAgICAgZGVidWdsb2coXCJJTkNPTlNJU1RFTlQqPiBNb2RlbERhdGEgXCIgKyBzRmlsZU5hbWUgKyBcIiBkb2VzIG5vdCBjb250YWluIGNhdGVnb3J5IFwiICsgY2F0ZWdvcnkgKyBcIiBvZiB3b3JkaW5kZXhcIiArIEpTT04uc3RyaW5naWZ5KG9FbnRyeSkgKyBcIlwiKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAob0VudHJ5W2NhdGVnb3J5XSAhPT0gXCIqXCIpIHtcbiAgICAgICAgICAgICAgICB2YXIgc1N0cmluZyA9IG9FbnRyeVtjYXRlZ29yeV07XG4gICAgICAgICAgICAgICAgZGVidWdsb2coXCJwdXNoaW5nIHJ1bGUgd2l0aCBcIiArIGNhdGVnb3J5ICsgXCIgLT4gXCIgKyBzU3RyaW5nKTtcbiAgICAgICAgICAgICAgICB2YXIgb1J1bGUgPSB7XG4gICAgICAgICAgICAgICAgICAgIGNhdGVnb3J5OiBjYXRlZ29yeSxcbiAgICAgICAgICAgICAgICAgICAgbWF0Y2hlZFN0cmluZzogc1N0cmluZyxcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogMCAvKiBXT1JEICovLFxuICAgICAgICAgICAgICAgICAgICB3b3JkOiBzU3RyaW5nLFxuICAgICAgICAgICAgICAgICAgICBiaXRpbmRleDogYml0aW5kZXgsXG4gICAgICAgICAgICAgICAgICAgIF9yYW5raW5nOiAwLjk1XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBpZiAob01kbC5leGFjdG1hdGNoICYmIG9NZGwuZXhhY3RtYXRjaC5pbmRleE9mKGNhdGVnb3J5KSA+PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIG9SdWxlLmV4YWN0T25seSA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGluc2VydFJ1bGVJZk5vdFByZXNlbnQob01vZGVsLm1SdWxlcywgb1J1bGUsIG9Nb2RlbC5zZWVuUnVsZXMpO1xuICAgICAgICAgICAgICAgIGlmIChvTWRsRGF0YS5zeW5vbnltcyAmJiBvTWRsRGF0YS5zeW5vbnltc1tjYXRlZ29yeV0pIHtcbiAgICAgICAgICAgICAgICAgICAgYWRkU3lub255bXMob01kbERhdGEuc3lub255bXNbY2F0ZWdvcnldLCBjYXRlZ29yeSwgc1N0cmluZywgYml0aW5kZXgsIG9Nb2RlbC5tUnVsZXMsIG9Nb2RlbC5zZWVuUnVsZXMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAob0VudHJ5LnN5bm9ueW1zICYmIG9FbnRyeS5zeW5vbnltc1tjYXRlZ29yeV0pIHtcbiAgICAgICAgICAgICAgICAgICAgYWRkU3lub255bXMob0VudHJ5LnN5bm9ueW1zW2NhdGVnb3J5XSwgY2F0ZWdvcnksIHNTdHJpbmcsIGJpdGluZGV4LCBvTW9kZWwubVJ1bGVzLCBvTW9kZWwuc2VlblJ1bGVzKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0pO1xufVxuZnVuY3Rpb24gbG9hZE1vZGVsKG1vZGVsUGF0aCwgc01vZGVsTmFtZSwgb01vZGVsKSB7XG4gICAgZGVidWdsb2coXCIgbG9hZGluZyBcIiArIHNNb2RlbE5hbWUgKyBcIiAuLi4uXCIpO1xuICAgIHZhciBtZGwgPSBmcy5yZWFkRmlsZVN5bmMoJy4vJyArIG1vZGVsUGF0aCArICcvJyArIHNNb2RlbE5hbWUgKyBcIi5tb2RlbC5qc29uXCIsICd1dGYtOCcpO1xuICAgIHZhciBvTWRsID0gSlNPTi5wYXJzZShtZGwpO1xuICAgIG1lcmdlTW9kZWxKc29uKHNNb2RlbE5hbWUsIG9NZGwsIG9Nb2RlbCk7XG4gICAgbG9hZE1vZGVsRGF0YShtb2RlbFBhdGgsIG9NZGwsIHNNb2RlbE5hbWUsIG9Nb2RlbCk7XG59XG5mdW5jdGlvbiBnZXREb21haW5CaXRJbmRleChkb21haW4sIG9Nb2RlbCkge1xuICAgIHZhciBpbmRleCA9IG9Nb2RlbC5kb21haW5zLmluZGV4T2YoZG9tYWluKTtcbiAgICBpZiAoaW5kZXggPCAwKSB7XG4gICAgICAgIGluZGV4ID0gb01vZGVsLmRvbWFpbnMubGVuZ3RoO1xuICAgIH1cbiAgICBpZiAoaW5kZXggPj0gMzIpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwidG9vIG1hbnkgZG9tYWluIGZvciBzaW5nbGUgMzIgYml0IGluZGV4XCIpO1xuICAgIH1cbiAgICByZXR1cm4gMHgwMDAxIDw8IGluZGV4O1xufVxuZXhwb3J0cy5nZXREb21haW5CaXRJbmRleCA9IGdldERvbWFpbkJpdEluZGV4O1xuZnVuY3Rpb24gbWVyZ2VNb2RlbEpzb24oc01vZGVsTmFtZSwgb01kbCwgb01vZGVsKSB7XG4gICAgdmFyIGNhdGVnb3J5RGVzY3JpYmVkTWFwID0ge307XG4gICAgb01kbC5iaXRpbmRleCA9IGdldERvbWFpbkJpdEluZGV4KG9NZGwuZG9tYWluLCBvTW9kZWwpO1xuICAgIG9NZGwuY2F0ZWdvcnlEZXNjcmliZWQgPSBbXTtcbiAgICAvLyByZWN0aWZ5IGNhdGVnb3J5XG4gICAgb01kbC5jYXRlZ29yeSA9IG9NZGwuY2F0ZWdvcnkubWFwKGZ1bmN0aW9uIChjYXQpIHtcbiAgICAgICAgaWYgKHR5cGVvZiBjYXQgPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICAgIHJldHVybiBjYXQ7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiBjYXQubmFtZSAhPT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJNaXNzaW5nIG5hbWUgaW4gb2JqZWN0IHR5cGVkIGNhdGVnb3J5IGluIFwiICsgSlNPTi5zdHJpbmdpZnkoY2F0KSArIFwiIGluIG1vZGVsIFwiICsgc01vZGVsTmFtZSk7XG4gICAgICAgICAgICBwcm9jZXNzLmV4aXQoLTEpO1xuICAgICAgICB9XG4gICAgICAgIGNhdGVnb3J5RGVzY3JpYmVkTWFwW2NhdC5uYW1lXSA9IGNhdDtcbiAgICAgICAgb01kbC5jYXRlZ29yeURlc2NyaWJlZC5wdXNoKGNhdCk7XG4gICAgICAgIHJldHVybiBjYXQubmFtZTtcbiAgICB9KTtcbiAgICAvLyBhZGQgdGhlIGNhdGVnb3JpZXMgdG8gdGhlIG1vZGVsOlxuICAgIG9NZGwuY2F0ZWdvcnkuZm9yRWFjaChmdW5jdGlvbiAoY2F0ZWdvcnkpIHtcbiAgICAgICAgaW5zZXJ0UnVsZUlmTm90UHJlc2VudChvTW9kZWwubVJ1bGVzLCB7XG4gICAgICAgICAgICBjYXRlZ29yeTogXCJjYXRlZ29yeVwiLFxuICAgICAgICAgICAgbWF0Y2hlZFN0cmluZzogY2F0ZWdvcnksXG4gICAgICAgICAgICB0eXBlOiAwIC8qIFdPUkQgKi8sXG4gICAgICAgICAgICB3b3JkOiBjYXRlZ29yeSxcbiAgICAgICAgICAgIGxvd2VyY2FzZXdvcmQ6IGNhdGVnb3J5LnRvTG93ZXJDYXNlKCksXG4gICAgICAgICAgICBiaXRpbmRleDogb01kbC5iaXRpbmRleCxcbiAgICAgICAgICAgIF9yYW5raW5nOiAwLjk1XG4gICAgICAgIH0sIG9Nb2RlbC5zZWVuUnVsZXMpO1xuICAgIH0pO1xuICAgIGlmIChvTW9kZWwuZG9tYWlucy5pbmRleE9mKG9NZGwuZG9tYWluKSA+PSAwKSB7XG4gICAgICAgIGRlYnVnbG9nKFwiKioqKioqKioqKipoZXJlIG1kbFwiICsgSlNPTi5zdHJpbmdpZnkob01kbCwgdW5kZWZpbmVkLCAyKSk7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignRG9tYWluICcgKyBvTWRsLmRvbWFpbiArICcgYWxyZWFkeSBsb2FkZWQgd2hpbGUgbG9hZGluZyAnICsgc01vZGVsTmFtZSArICc/Jyk7XG4gICAgfVxuICAgIC8vIGNoZWNrIHByb3BlcnRpZXMgb2YgbW9kZWxcbiAgICBPYmplY3Qua2V5cyhvTWRsKS5zb3J0KCkuZm9yRWFjaChmdW5jdGlvbiAoc1Byb3BlcnR5KSB7XG4gICAgICAgIGlmIChBUlJfTU9ERUxfUFJPUEVSVElFUy5pbmRleE9mKHNQcm9wZXJ0eSkgPCAwKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ01vZGVsIHByb3BlcnR5IFwiJyArIHNQcm9wZXJ0eSArICdcIiBub3QgYSBrbm93biBtb2RlbCBwcm9wZXJ0eSBpbiBtb2RlbCBvZiBkb21haW4gJyArIG9NZGwuZG9tYWluICsgJyAnKTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIG9Nb2RlbC5mdWxsLmRvbWFpbltvTWRsLmRvbWFpbl0gPSB7XG4gICAgICAgIGRlc2NyaXB0aW9uOiBvTWRsLmRlc2NyaXB0aW9uLFxuICAgICAgICBjYXRlZ29yaWVzOiBjYXRlZ29yeURlc2NyaWJlZE1hcCxcbiAgICAgICAgYml0aW5kZXg6IG9NZGwuYml0aW5kZXhcbiAgICB9O1xuICAgIC8vIGNoZWNrIHRoYXQgbWVtYmVycyBvZiB3b3JkaW5kZXggYXJlIGluIGNhdGVnb3JpZXMsXG4gICAgb01kbC53b3JkaW5kZXggPSBvTWRsLndvcmRpbmRleCB8fCBbXTtcbiAgICBvTWRsLndvcmRpbmRleC5mb3JFYWNoKGZ1bmN0aW9uIChzV29yZEluZGV4KSB7XG4gICAgICAgIGlmIChvTWRsLmNhdGVnb3J5LmluZGV4T2Yoc1dvcmRJbmRleCkgPCAwKSB7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ01vZGVsIHdvcmRpbmRleCBcIicgKyBzV29yZEluZGV4ICsgJ1wiIG5vdCBhIGNhdGVnb3J5IG9mIGRvbWFpbiAnICsgb01kbC5kb21haW4gKyAnICcpO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgb01kbC5leGFjdG1hdGNoID0gb01kbC5leGFjdG1hdGNoIHx8IFtdO1xuICAgIG9NZGwuZXhhY3RtYXRjaC5mb3JFYWNoKGZ1bmN0aW9uIChzRXhhY3RNYXRjaCkge1xuICAgICAgICBpZiAob01kbC5jYXRlZ29yeS5pbmRleE9mKHNFeGFjdE1hdGNoKSA8IDApIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTW9kZWwgZXhhY3RtYXRjaCBcIicgKyBzRXhhY3RNYXRjaCArICdcIiBub3QgYSBjYXRlZ29yeSBvZiBkb21haW4gJyArIG9NZGwuZG9tYWluICsgJyAnKTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIC8vIGFkZCByZWxhdGlvbiBkb21haW4gLT4gY2F0ZWdvcnlcbiAgICB2YXIgZG9tYWluU3RyID0gTWV0YUYuRG9tYWluKG9NZGwuZG9tYWluKS50b0Z1bGxTdHJpbmcoKTtcbiAgICB2YXIgcmVsYXRpb25TdHIgPSBNZXRhRi5SZWxhdGlvbihNZXRhLlJFTEFUSU9OX2hhc0NhdGVnb3J5KS50b0Z1bGxTdHJpbmcoKTtcbiAgICB2YXIgcmV2ZXJzZVJlbGF0aW9uU3RyID0gTWV0YUYuUmVsYXRpb24oTWV0YS5SRUxBVElPTl9pc0NhdGVnb3J5T2YpLnRvRnVsbFN0cmluZygpO1xuICAgIG9NZGwuY2F0ZWdvcnkuZm9yRWFjaChmdW5jdGlvbiAoc0NhdGVnb3J5KSB7XG4gICAgICAgIHZhciBDYXRlZ29yeVN0cmluZyA9IE1ldGFGLkNhdGVnb3J5KHNDYXRlZ29yeSkudG9GdWxsU3RyaW5nKCk7XG4gICAgICAgIG9Nb2RlbC5tZXRhLnQzW2RvbWFpblN0cl0gPSBvTW9kZWwubWV0YS50M1tkb21haW5TdHJdIHx8IHt9O1xuICAgICAgICBvTW9kZWwubWV0YS50M1tkb21haW5TdHJdW3JlbGF0aW9uU3RyXSA9IG9Nb2RlbC5tZXRhLnQzW2RvbWFpblN0cl1bcmVsYXRpb25TdHJdIHx8IHt9O1xuICAgICAgICBvTW9kZWwubWV0YS50M1tkb21haW5TdHJdW3JlbGF0aW9uU3RyXVtDYXRlZ29yeVN0cmluZ10gPSB7fTtcbiAgICAgICAgb01vZGVsLm1ldGEudDNbQ2F0ZWdvcnlTdHJpbmddID0gb01vZGVsLm1ldGEudDNbQ2F0ZWdvcnlTdHJpbmddIHx8IHt9O1xuICAgICAgICBvTW9kZWwubWV0YS50M1tDYXRlZ29yeVN0cmluZ11bcmV2ZXJzZVJlbGF0aW9uU3RyXSA9IG9Nb2RlbC5tZXRhLnQzW0NhdGVnb3J5U3RyaW5nXVtyZXZlcnNlUmVsYXRpb25TdHJdIHx8IHt9O1xuICAgICAgICBvTW9kZWwubWV0YS50M1tDYXRlZ29yeVN0cmluZ11bcmV2ZXJzZVJlbGF0aW9uU3RyXVtkb21haW5TdHJdID0ge307XG4gICAgfSk7XG4gICAgLy8gYWRkIGEgcHJlY2ljZSBkb21haW4gbWF0Y2hydWxlXG4gICAgaW5zZXJ0UnVsZUlmTm90UHJlc2VudChvTW9kZWwubVJ1bGVzLCB7XG4gICAgICAgIGNhdGVnb3J5OiBcImRvbWFpblwiLFxuICAgICAgICBtYXRjaGVkU3RyaW5nOiBvTWRsLmRvbWFpbixcbiAgICAgICAgdHlwZTogMCAvKiBXT1JEICovLFxuICAgICAgICB3b3JkOiBvTWRsLmRvbWFpbixcbiAgICAgICAgYml0aW5kZXg6IG9NZGwuYml0aW5kZXgsXG4gICAgICAgIF9yYW5raW5nOiAwLjk1XG4gICAgfSwgb01vZGVsLnNlZW5SdWxlcyk7XG4gICAgLy8gY2hlY2sgdGhlIHRvb2xcbiAgICBpZiAob01kbC50b29sICYmIG9NZGwudG9vbC5yZXF1aXJlcykge1xuICAgICAgICB2YXIgcmVxdWlyZXMgPSBPYmplY3Qua2V5cyhvTWRsLnRvb2wucmVxdWlyZXMgfHwge30pO1xuICAgICAgICB2YXIgZGlmZiA9IF8uZGlmZmVyZW5jZShyZXF1aXJlcywgb01kbC5jYXRlZ29yeSk7XG4gICAgICAgIGlmIChkaWZmLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiIFwiICsgb01kbC5kb21haW4gKyBcIiA6IFVua293biBjYXRlZ29yeSBpbiByZXF1aXJlcyBvZiB0b29sOiBcXFwiXCIgKyBkaWZmLmpvaW4oJ1wiJykgKyAnXCInKTtcbiAgICAgICAgICAgIHByb2Nlc3MuZXhpdCgtMSk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIG9wdGlvbmFsID0gT2JqZWN0LmtleXMob01kbC50b29sLm9wdGlvbmFsKTtcbiAgICAgICAgZGlmZiA9IF8uZGlmZmVyZW5jZShvcHRpb25hbCwgb01kbC5jYXRlZ29yeSk7XG4gICAgICAgIGlmIChkaWZmLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiIFwiICsgb01kbC5kb21haW4gKyBcIiA6IFVua293biBjYXRlZ29yeSBvcHRpb25hbCBvZiB0b29sOiBcXFwiXCIgKyBkaWZmLmpvaW4oJ1wiJykgKyAnXCInKTtcbiAgICAgICAgICAgIHByb2Nlc3MuZXhpdCgtMSk7XG4gICAgICAgIH1cbiAgICAgICAgT2JqZWN0LmtleXMob01kbC50b29sLnNldHMgfHwge30pLmZvckVhY2goZnVuY3Rpb24gKHNldElEKSB7XG4gICAgICAgICAgICB2YXIgZGlmZiA9IF8uZGlmZmVyZW5jZShvTWRsLnRvb2wuc2V0c1tzZXRJRF0uc2V0LCBvTWRsLmNhdGVnb3J5KTtcbiAgICAgICAgICAgIGlmIChkaWZmLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcIiBcIiArIG9NZGwuZG9tYWluICsgXCIgOiBVbmtvd24gY2F0ZWdvcnkgaW4gc2V0SWQgXCIgKyBzZXRJRCArIFwiIG9mIHRvb2w6IFxcXCJcIiArIGRpZmYuam9pbignXCInKSArICdcIicpO1xuICAgICAgICAgICAgICAgIHByb2Nlc3MuZXhpdCgtMSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICAvLyBleHRyYWN0IHRvb2xzIGFuIGFkZCB0byB0b29sczpcbiAgICAgICAgb01vZGVsLnRvb2xzLmZpbHRlcihmdW5jdGlvbiAob0VudHJ5KSB7XG4gICAgICAgICAgICBpZiAob0VudHJ5Lm5hbWUgPT09IChvTWRsLnRvb2wgJiYgb01kbC50b29sLm5hbWUpKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJUb29sIFwiICsgb01kbC50b29sLm5hbWUgKyBcIiBhbHJlYWR5IHByZXNlbnQgd2hlbiBsb2FkaW5nIFwiICsgc01vZGVsTmFtZSk7XG4gICAgICAgICAgICAgICAgLy90aHJvdyBuZXcgRXJyb3IoJ0RvbWFpbiBhbHJlYWR5IGxvYWRlZD8nKTtcbiAgICAgICAgICAgICAgICBwcm9jZXNzLmV4aXQoLTEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIG9NZGwudG9vbGhpZGRlbiA9IHRydWU7XG4gICAgICAgIG9NZGwudG9vbC5yZXF1aXJlcyA9IHsgXCJpbXBvc3NpYmxlXCI6IHt9IH07XG4gICAgfVxuICAgIC8vIGFkZCB0aGUgdG9vbCBuYW1lIGFzIHJ1bGUgdW5sZXNzIGhpZGRlblxuICAgIGlmICghb01kbC50b29saGlkZGVuICYmIG9NZGwudG9vbCAmJiBvTWRsLnRvb2wubmFtZSkge1xuICAgICAgICBpbnNlcnRSdWxlSWZOb3RQcmVzZW50KG9Nb2RlbC5tUnVsZXMsIHtcbiAgICAgICAgICAgIGNhdGVnb3J5OiBcInRvb2xcIixcbiAgICAgICAgICAgIG1hdGNoZWRTdHJpbmc6IG9NZGwudG9vbC5uYW1lLFxuICAgICAgICAgICAgdHlwZTogMCAvKiBXT1JEICovLFxuICAgICAgICAgICAgd29yZDogb01kbC50b29sLm5hbWUsXG4gICAgICAgICAgICBiaXRpbmRleDogb01kbC5iaXRpbmRleCxcbiAgICAgICAgICAgIF9yYW5raW5nOiAwLjk1XG4gICAgICAgIH0sIG9Nb2RlbC5zZWVuUnVsZXMpO1xuICAgIH1cbiAgICA7XG4gICAgaWYgKG9NZGwuc3lub255bXMgJiYgb01kbC5zeW5vbnltc1tcInRvb2xcIl0pIHtcbiAgICAgICAgYWRkU3lub255bXMob01kbC5zeW5vbnltc1tcInRvb2xcIl0sIFwidG9vbFwiLCBvTWRsLnRvb2wubmFtZSwgb01kbC5iaXRpbmRleCwgb01vZGVsLm1SdWxlcywgb01vZGVsLnNlZW5SdWxlcyk7XG4gICAgfVxuICAgIDtcbiAgICBpZiAob01kbC5zeW5vbnltcykge1xuICAgICAgICBPYmplY3Qua2V5cyhvTWRsLnN5bm9ueW1zKS5mb3JFYWNoKGZ1bmN0aW9uIChzc3lua2V5KSB7XG4gICAgICAgICAgICBpZiAob01kbC5jYXRlZ29yeS5pbmRleE9mKHNzeW5rZXkpID49IDAgJiYgc3N5bmtleSAhPT0gXCJ0b29sXCIpIHtcbiAgICAgICAgICAgICAgICBpZiAob01vZGVsLmZ1bGwuZG9tYWluW29NZGwuZG9tYWluXS5jYXRlZ29yaWVzW3NzeW5rZXldKSB7XG4gICAgICAgICAgICAgICAgICAgIG9Nb2RlbC5mdWxsLmRvbWFpbltvTWRsLmRvbWFpbl0uY2F0ZWdvcmllc1tzc3lua2V5XS5zeW5vbnltcyA9IG9NZGwuc3lub255bXNbc3N5bmtleV07XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGFkZFN5bm9ueW1zKG9NZGwuc3lub255bXNbc3N5bmtleV0sIFwiY2F0ZWdvcnlcIiwgc3N5bmtleSwgb01kbC5iaXRpbmRleCwgb01vZGVsLm1SdWxlcywgb01vZGVsLnNlZW5SdWxlcyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH1cbiAgICBvTW9kZWwuZG9tYWlucy5wdXNoKG9NZGwuZG9tYWluKTtcbiAgICBpZiAob01kbC50b29sLm5hbWUpIHtcbiAgICAgICAgb01vZGVsLnRvb2xzLnB1c2gob01kbC50b29sKTtcbiAgICB9XG4gICAgb01vZGVsLmNhdGVnb3J5ID0gb01vZGVsLmNhdGVnb3J5LmNvbmNhdChvTWRsLmNhdGVnb3J5KTtcbiAgICBvTW9kZWwuY2F0ZWdvcnkuc29ydCgpO1xuICAgIG9Nb2RlbC5jYXRlZ29yeSA9IG9Nb2RlbC5jYXRlZ29yeS5maWx0ZXIoZnVuY3Rpb24gKHN0cmluZywgaW5kZXgpIHtcbiAgICAgICAgcmV0dXJuIG9Nb2RlbC5jYXRlZ29yeVtpbmRleF0gIT09IG9Nb2RlbC5jYXRlZ29yeVtpbmRleCArIDFdO1xuICAgIH0pO1xufSAvLyBsb2FkbW9kZWxcbmZ1bmN0aW9uIHNwbGl0UnVsZXMocnVsZXMpIHtcbiAgICB2YXIgcmVzID0ge307XG4gICAgdmFyIG5vbldvcmRSdWxlcyA9IFtdO1xuICAgIHJ1bGVzLmZvckVhY2goZnVuY3Rpb24gKHJ1bGUpIHtcbiAgICAgICAgaWYgKHJ1bGUudHlwZSA9PT0gMCAvKiBXT1JEICovKSB7XG4gICAgICAgICAgICBpZiAoIXJ1bGUubG93ZXJjYXNld29yZCkge1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIlJ1bGUgaGFzIG5vIG1lbWJlciBsb3dlcmNhc2V3b3JkXCIgKyBKU09OLnN0cmluZ2lmeShydWxlKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXNbcnVsZS5sb3dlcmNhc2V3b3JkXSA9IHJlc1tydWxlLmxvd2VyY2FzZXdvcmRdIHx8IHsgYml0aW5kZXg6IDAsIHJ1bGVzOiBbXSB9O1xuICAgICAgICAgICAgcmVzW3J1bGUubG93ZXJjYXNld29yZF0uYml0aW5kZXggPSByZXNbcnVsZS5sb3dlcmNhc2V3b3JkXS5iaXRpbmRleCB8IHJ1bGUuYml0aW5kZXg7XG4gICAgICAgICAgICByZXNbcnVsZS5sb3dlcmNhc2V3b3JkXS5ydWxlcy5wdXNoKHJ1bGUpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgbm9uV29yZFJ1bGVzLnB1c2gocnVsZSk7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4ge1xuICAgICAgICB3b3JkTWFwOiByZXMsXG4gICAgICAgIG5vbldvcmRSdWxlczogbm9uV29yZFJ1bGVzLFxuICAgICAgICBhbGxSdWxlczogcnVsZXNcbiAgICB9O1xufVxuZXhwb3J0cy5zcGxpdFJ1bGVzID0gc3BsaXRSdWxlcztcbmZ1bmN0aW9uIGxvYWRNb2RlbHMobW9kZWxQYXRoKSB7XG4gICAgdmFyIG9Nb2RlbDtcbiAgICBvTW9kZWwgPSB7XG4gICAgICAgIGZ1bGw6IHsgZG9tYWluOiB7fSB9LFxuICAgICAgICBkb21haW5zOiBbXSxcbiAgICAgICAgdG9vbHM6IFtdLFxuICAgICAgICBydWxlczogdW5kZWZpbmVkLFxuICAgICAgICBjYXRlZ29yeTogW10sXG4gICAgICAgIG9wZXJhdG9yczoge30sXG4gICAgICAgIG1SdWxlczogW10sXG4gICAgICAgIHNlZW5SdWxlczoge30sXG4gICAgICAgIHJlY29yZHM6IFtdLFxuICAgICAgICBtZXRhOiB7IHQzOiB7fSB9XG4gICAgfTtcbiAgICBtb2RlbFBhdGggPSBtb2RlbFBhdGggfHwgZW52TW9kZWxQYXRoO1xuICAgIHZhciBzbWRscyA9IGZzLnJlYWRGaWxlU3luYygnLi8nICsgbW9kZWxQYXRoICsgJy9tb2RlbHMuanNvbicsICd1dGYtOCcpO1xuICAgIHZhciBtZGxzID0gSlNPTi5wYXJzZShcIlwiICsgc21kbHMpO1xuICAgIG1kbHMuZm9yRWFjaChmdW5jdGlvbiAoc01vZGVsTmFtZSkge1xuICAgICAgICBsb2FkTW9kZWwobW9kZWxQYXRoLCBzTW9kZWxOYW1lLCBvTW9kZWwpO1xuICAgIH0pO1xuICAgIC8vIGFkZCB0aGUgY2F0ZWdvcmllcyB0byB0aGUgbW9kZWw6XG4gICAgLypcbiAgICBvTW9kZWwuY2F0ZWdvcnkuZm9yRWFjaChmdW5jdGlvbiAoY2F0ZWdvcnkpIHtcbiAgICAgICAgaW5zZXJ0UnVsZUlmTm90UHJlc2VudChvTW9kZWwubVJ1bGVzLCB7XG4gICAgICAgICAgICBjYXRlZ29yeTogXCJjYXRlZ29yeVwiLFxuICAgICAgICAgICAgbWF0Y2hlZFN0cmluZzogY2F0ZWdvcnksXG4gICAgICAgICAgICB0eXBlOiBJTWF0Y2guRW51bVJ1bGVUeXBlLldPUkQsXG4gICAgICAgICAgICB3b3JkOiBjYXRlZ29yeSxcbiAgICAgICAgICAgIGxvd2VyY2FzZXdvcmQ6IGNhdGVnb3J5LnRvTG93ZXJDYXNlKCksXG4gICAgICAgICAgICBiaXRpbmRleCA6IG9NZGwuXG4gICAgICAgICAgICBfcmFua2luZzogMC45NVxuICAgICAgICB9LCBvTW9kZWwuc2VlblJ1bGVzKTtcbiAgICB9KTtcbiAgICAqL1xuICAgIHZhciBtZXRhQml0SW5kZXggPSBnZXREb21haW5CaXRJbmRleCgnbWV0YScsIG9Nb2RlbCk7XG4gICAgLy8gYWRkIHRoZSBkb21haW4gbWV0YSBydWxlXG4gICAgaW5zZXJ0UnVsZUlmTm90UHJlc2VudChvTW9kZWwubVJ1bGVzLCB7XG4gICAgICAgIGNhdGVnb3J5OiBcIm1ldGFcIixcbiAgICAgICAgbWF0Y2hlZFN0cmluZzogXCJkb21haW5cIixcbiAgICAgICAgdHlwZTogMCAvKiBXT1JEICovLFxuICAgICAgICB3b3JkOiBcImRvbWFpblwiLFxuICAgICAgICBiaXRpbmRleDogbWV0YUJpdEluZGV4LFxuICAgICAgICBfcmFua2luZzogMC45NVxuICAgIH0sIG9Nb2RlbC5zZWVuUnVsZXMpO1xuICAgIHZhciBmaWxsZXJCaXRJbmRleCA9IGdldERvbWFpbkJpdEluZGV4KCdtZXRhJywgb01vZGVsKTtcbiAgICAvL2FkZCBhIGZpbGxlciBydWxlXG4gICAgdmFyIHNmaWxsZXJzID0gZnMucmVhZEZpbGVTeW5jKCcuLycgKyBtb2RlbFBhdGggKyAnL2ZpbGxlci5qc29uJywgJ3V0Zi04Jyk7XG4gICAgdmFyIGZpbGxlcnMgPSBKU09OLnBhcnNlKHNmaWxsZXJzKTtcbiAgICB2YXIgcmUgPSBcIl4oKFwiICsgZmlsbGVycy5qb2luKFwiKXwoXCIpICsgXCIpKSRcIjtcbiAgICBvTW9kZWwubVJ1bGVzLnB1c2goe1xuICAgICAgICBjYXRlZ29yeTogXCJmaWxsZXJcIixcbiAgICAgICAgdHlwZTogMSAvKiBSRUdFWFAgKi8sXG4gICAgICAgIHJlZ2V4cDogbmV3IFJlZ0V4cChyZSwgXCJpXCIpLFxuICAgICAgICBtYXRjaGVkU3RyaW5nOiBcImZpbGxlclwiLFxuICAgICAgICBiaXRpbmRleDogZmlsbGVyQml0SW5kZXgsXG4gICAgICAgIF9yYW5raW5nOiAwLjlcbiAgICB9KTtcbiAgICAvL2FkZCBvcGVyYXRvcnNcbiAgICB2YXIgc09wZXJhdG9ycyA9IGZzLnJlYWRGaWxlU3luYygnLi9yZXNvdXJjZXMvbW9kZWwvb3BlcmF0b3JzLmpzb24nLCAndXRmLTgnKTtcbiAgICB2YXIgb3BlcmF0b3JzID0gSlNPTi5wYXJzZShzT3BlcmF0b3JzKTtcbiAgICB2YXIgb3BlcmF0b3JCaXRJbmRleCA9IGdldERvbWFpbkJpdEluZGV4KCdvcGVyYXRvcnMnLCBvTW9kZWwpO1xuICAgIE9iamVjdC5rZXlzKG9wZXJhdG9ycy5vcGVyYXRvcnMpLmZvckVhY2goZnVuY3Rpb24gKG9wZXJhdG9yKSB7XG4gICAgICAgIGlmIChJTWF0Y2guYU9wZXJhdG9yTmFtZXMuaW5kZXhPZihvcGVyYXRvcikgPCAwKSB7XG4gICAgICAgICAgICBkZWJ1Z2xvZyhcInVua25vd24gb3BlcmF0b3IgXCIgKyBvcGVyYXRvcik7XG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJ1bmtub3duIG9wZXJhdG9yIFwiICsgb3BlcmF0b3IpO1xuICAgICAgICB9XG4gICAgICAgIG9Nb2RlbC5vcGVyYXRvcnNbb3BlcmF0b3JdID0gb3BlcmF0b3JzLm9wZXJhdG9yc1tvcGVyYXRvcl07XG4gICAgICAgIG9Nb2RlbC5vcGVyYXRvcnNbb3BlcmF0b3JdLm9wZXJhdG9yID0gb3BlcmF0b3I7XG4gICAgICAgIE9iamVjdC5mcmVlemUob01vZGVsLm9wZXJhdG9yc1tvcGVyYXRvcl0pO1xuICAgICAgICB2YXIgd29yZCA9IG9wZXJhdG9yO1xuICAgICAgICBpbnNlcnRSdWxlSWZOb3RQcmVzZW50KG9Nb2RlbC5tUnVsZXMsIHtcbiAgICAgICAgICAgIGNhdGVnb3J5OiBcIm9wZXJhdG9yXCIsXG4gICAgICAgICAgICB3b3JkOiB3b3JkLnRvTG93ZXJDYXNlKCksXG4gICAgICAgICAgICBsb3dlcmNhc2V3b3JkOiB3b3JkLnRvTG93ZXJDYXNlKCksXG4gICAgICAgICAgICB0eXBlOiAwIC8qIFdPUkQgKi8sXG4gICAgICAgICAgICBtYXRjaGVkU3RyaW5nOiB3b3JkLFxuICAgICAgICAgICAgYml0aW5kZXg6IG9wZXJhdG9yQml0SW5kZXgsXG4gICAgICAgICAgICBfcmFua2luZzogMC45XG4gICAgICAgIH0sIG9Nb2RlbC5zZWVuUnVsZXMpO1xuICAgICAgICAvLyBhZGQgYWxsIHN5bm9ueW1zXG4gICAgICAgIGlmIChvcGVyYXRvcnMuc3lub255bXNbb3BlcmF0b3JdKSB7XG4gICAgICAgICAgICBPYmplY3Qua2V5cyhvcGVyYXRvcnMuc3lub255bXNbb3BlcmF0b3JdKS5mb3JFYWNoKGZ1bmN0aW9uIChzeW5vbnltKSB7XG4gICAgICAgICAgICAgICAgaW5zZXJ0UnVsZUlmTm90UHJlc2VudChvTW9kZWwubVJ1bGVzLCB7XG4gICAgICAgICAgICAgICAgICAgIGNhdGVnb3J5OiBcIm9wZXJhdG9yXCIsXG4gICAgICAgICAgICAgICAgICAgIHdvcmQ6IHN5bm9ueW0udG9Mb3dlckNhc2UoKSxcbiAgICAgICAgICAgICAgICAgICAgbG93ZXJjYXNld29yZDogc3lub255bS50b0xvd2VyQ2FzZSgpLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAwIC8qIFdPUkQgKi8sXG4gICAgICAgICAgICAgICAgICAgIG1hdGNoZWRTdHJpbmc6IG9wZXJhdG9yLFxuICAgICAgICAgICAgICAgICAgICBiaXRpbmRleDogb3BlcmF0b3JCaXRJbmRleCxcbiAgICAgICAgICAgICAgICAgICAgX3Jhbmtpbmc6IDAuOVxuICAgICAgICAgICAgICAgIH0sIG9Nb2RlbC5zZWVuUnVsZXMpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICAvKlxuICAgICAgICB9KVxuICAgICAgICAgICAge1xuICAgICAgICAgIGNhdGVnb3J5OiBcImZpbGxlclwiLFxuICAgICAgICAgIHR5cGU6IDEsXG4gICAgICAgICAgcmVnZXhwOiAvXigoc3RhcnQpfChzaG93KXwoZnJvbSl8KGluKSkkL2ksXG4gICAgICAgICAgbWF0Y2hlZFN0cmluZzogXCJmaWxsZXJcIixcbiAgICAgICAgICBfcmFua2luZzogMC45XG4gICAgICAgIH0sXG4gICAgKi9cbiAgICBvTW9kZWwubVJ1bGVzID0gb01vZGVsLm1SdWxlcy5zb3J0KElucHV0RmlsdGVyUnVsZXMuY21wTVJ1bGUpO1xuICAgIG9Nb2RlbC5ydWxlcyA9IHNwbGl0UnVsZXMob01vZGVsLm1SdWxlcyk7XG4gICAgb01vZGVsLnRvb2xzID0gb01vZGVsLnRvb2xzLnNvcnQoVG9vbHMuY21wVG9vbHMpO1xuICAgIGRlbGV0ZSBvTW9kZWwuc2VlblJ1bGVzO1xuICAgIHJldHVybiBvTW9kZWw7XG59XG5leHBvcnRzLmxvYWRNb2RlbHMgPSBsb2FkTW9kZWxzO1xuZnVuY3Rpb24gc29ydENhdGVnb3JpZXNCeUltcG9ydGFuY2UobWFwLCBjYXRzKSB7XG4gICAgdmFyIHJlcyA9IGNhdHMuc2xpY2UoMCk7XG4gICAgcmVzLnNvcnQocmFua0NhdGVnb3J5QnlJbXBvcnRhbmNlLmJpbmQodW5kZWZpbmVkLCBtYXApKTtcbiAgICByZXR1cm4gcmVzO1xufVxuZXhwb3J0cy5zb3J0Q2F0ZWdvcmllc0J5SW1wb3J0YW5jZSA9IHNvcnRDYXRlZ29yaWVzQnlJbXBvcnRhbmNlO1xuZnVuY3Rpb24gcmFua0NhdGVnb3J5QnlJbXBvcnRhbmNlKG1hcCwgY2F0YSwgY2F0Yikge1xuICAgIHZhciBjYXRBRGVzYyA9IG1hcFtjYXRhXTtcbiAgICB2YXIgY2F0QkRlc2MgPSBtYXBbY2F0Yl07XG4gICAgaWYgKGNhdGEgPT09IGNhdGIpIHtcbiAgICAgICAgcmV0dXJuIDA7XG4gICAgfVxuICAgIC8vIGlmIGEgaXMgYmVmb3JlIGIsIHJldHVybiAtMVxuICAgIGlmIChjYXRBRGVzYyAmJiAhY2F0QkRlc2MpIHtcbiAgICAgICAgcmV0dXJuIC0xO1xuICAgIH1cbiAgICBpZiAoIWNhdEFEZXNjICYmIGNhdEJEZXNjKSB7XG4gICAgICAgIHJldHVybiArMTtcbiAgICB9XG4gICAgdmFyIHByaW9BID0gKGNhdEFEZXNjICYmIGNhdEFEZXNjLmltcG9ydGFuY2UpIHx8IDk5O1xuICAgIHZhciBwcmlvQiA9IChjYXRCRGVzYyAmJiBjYXRCRGVzYy5pbXBvcnRhbmNlKSB8fCA5OTtcbiAgICAvLyBsb3dlciBwcmlvIGdvZXMgdG8gZnJvbnRcbiAgICB2YXIgciA9IHByaW9BIC0gcHJpb0I7XG4gICAgaWYgKHIpIHtcbiAgICAgICAgcmV0dXJuIHI7XG4gICAgfVxuICAgIHJldHVybiBjYXRhLmxvY2FsZUNvbXBhcmUoY2F0Yik7XG59XG5leHBvcnRzLnJhbmtDYXRlZ29yeUJ5SW1wb3J0YW5jZSA9IHJhbmtDYXRlZ29yeUJ5SW1wb3J0YW5jZTtcbnZhciBNZXRhRiA9IE1ldGEuZ2V0TWV0YUZhY3RvcnkoKTtcbmZ1bmN0aW9uIGdldE9wZXJhdG9yKG1kbCwgb3BlcmF0b3IpIHtcbiAgICByZXR1cm4gbWRsLm9wZXJhdG9yc1tvcGVyYXRvcl07XG59XG5leHBvcnRzLmdldE9wZXJhdG9yID0gZ2V0T3BlcmF0b3I7XG5mdW5jdGlvbiBnZXRSZXN1bHRBc0FycmF5KG1kbCwgYSwgcmVsKSB7XG4gICAgaWYgKHJlbC50b1R5cGUoKSAhPT0gJ3JlbGF0aW9uJykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJleHBlY3QgcmVsYXRpb24gYXMgMm5kIGFyZ1wiKTtcbiAgICB9XG4gICAgdmFyIHJlcyA9IG1kbC5tZXRhLnQzW2EudG9GdWxsU3RyaW5nKCldICYmXG4gICAgICAgIG1kbC5tZXRhLnQzW2EudG9GdWxsU3RyaW5nKCldW3JlbC50b0Z1bGxTdHJpbmcoKV07XG4gICAgaWYgKCFyZXMpIHtcbiAgICAgICAgcmV0dXJuIFtdO1xuICAgIH1cbiAgICByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMocmVzKS5zb3J0KCkubWFwKE1ldGFGLnBhcnNlSU1ldGEpO1xufVxuZXhwb3J0cy5nZXRSZXN1bHRBc0FycmF5ID0gZ2V0UmVzdWx0QXNBcnJheTtcbmZ1bmN0aW9uIGdldENhdGVnb3JpZXNGb3JEb21haW4odGhlTW9kZWwsIGRvbWFpbikge1xuICAgIGlmICh0aGVNb2RlbC5kb21haW5zLmluZGV4T2YoZG9tYWluKSA8IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRG9tYWluIFxcXCJcIiArIGRvbWFpbiArIFwiXFxcIiBub3QgcGFydCBvZiBtb2RlbFwiKTtcbiAgICB9XG4gICAgdmFyIHJlcyA9IGdldFJlc3VsdEFzQXJyYXkodGhlTW9kZWwsIE1ldGFGLkRvbWFpbihkb21haW4pLCBNZXRhRi5SZWxhdGlvbihNZXRhLlJFTEFUSU9OX2hhc0NhdGVnb3J5KSk7XG4gICAgcmV0dXJuIE1ldGEuZ2V0U3RyaW5nQXJyYXkocmVzKTtcbn1cbmV4cG9ydHMuZ2V0Q2F0ZWdvcmllc0ZvckRvbWFpbiA9IGdldENhdGVnb3JpZXNGb3JEb21haW47XG4vKipcbiAqIFJldHVybiBhbGwgY2F0ZWdvcmllcyBvZiBhIGRvbWFpbiB3aGljaCBjYW4gYXBwZWFyIG9uIGEgd29yZCxcbiAqIHRoZXNlIGFyZSB0eXBpY2FsbHkgdGhlIHdvcmRpbmRleCBkb21haW5zICsgZW50cmllcyBnZW5lcmF0ZWQgYnkgZ2VuZXJpYyBydWxlc1xuICpcbiAqIFRoZSBjdXJyZW50IGltcGxlbWVudGF0aW9uIGlzIGEgc2ltcGxpZmljYXRpb25cbiAqL1xuZnVuY3Rpb24gZ2V0UG90ZW50aWFsV29yZENhdGVnb3JpZXNGb3JEb21haW4odGhlTW9kZWwsIGRvbWFpbikge1xuICAgIC8vIHRoaXMgaXMgYSBzaW1wbGlmaWVkIHZlcnNpb25cbiAgICByZXR1cm4gZ2V0Q2F0ZWdvcmllc0ZvckRvbWFpbih0aGVNb2RlbCwgZG9tYWluKTtcbn1cbmV4cG9ydHMuZ2V0UG90ZW50aWFsV29yZENhdGVnb3JpZXNGb3JEb21haW4gPSBnZXRQb3RlbnRpYWxXb3JkQ2F0ZWdvcmllc0ZvckRvbWFpbjtcbmZ1bmN0aW9uIGdldERvbWFpbnNGb3JDYXRlZ29yeSh0aGVNb2RlbCwgY2F0ZWdvcnkpIHtcbiAgICBpZiAodGhlTW9kZWwuY2F0ZWdvcnkuaW5kZXhPZihjYXRlZ29yeSkgPCAwKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhdGVnb3J5IFxcXCJcIiArIGNhdGVnb3J5ICsgXCJcXFwiIG5vdCBwYXJ0IG9mIG1vZGVsXCIpO1xuICAgIH1cbiAgICB2YXIgcmVzID0gZ2V0UmVzdWx0QXNBcnJheSh0aGVNb2RlbCwgTWV0YUYuQ2F0ZWdvcnkoY2F0ZWdvcnkpLCBNZXRhRi5SZWxhdGlvbihNZXRhLlJFTEFUSU9OX2lzQ2F0ZWdvcnlPZikpO1xuICAgIHJldHVybiBNZXRhLmdldFN0cmluZ0FycmF5KHJlcyk7XG59XG5leHBvcnRzLmdldERvbWFpbnNGb3JDYXRlZ29yeSA9IGdldERvbWFpbnNGb3JDYXRlZ29yeTtcbmZ1bmN0aW9uIGdldEFsbFJlY29yZENhdGVnb3JpZXNGb3JUYXJnZXRDYXRlZ29yeShtb2RlbCwgY2F0ZWdvcnksIHdvcmRzb25seSkge1xuICAgIHZhciByZXMgPSB7fTtcbiAgICAvL1xuICAgIHZhciBmbiA9IHdvcmRzb25seSA/IGdldFBvdGVudGlhbFdvcmRDYXRlZ29yaWVzRm9yRG9tYWluIDogZ2V0Q2F0ZWdvcmllc0ZvckRvbWFpbjtcbiAgICB2YXIgZG9tYWlucyA9IGdldERvbWFpbnNGb3JDYXRlZ29yeShtb2RlbCwgY2F0ZWdvcnkpO1xuICAgIGRvbWFpbnMuZm9yRWFjaChmdW5jdGlvbiAoZG9tYWluKSB7XG4gICAgICAgIGZuKG1vZGVsLCBkb21haW4pLmZvckVhY2goZnVuY3Rpb24gKHdvcmRjYXQpIHtcbiAgICAgICAgICAgIHJlc1t3b3JkY2F0XSA9IHRydWU7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuICAgIE9iamVjdC5mcmVlemUocmVzKTtcbiAgICByZXR1cm4gcmVzO1xufVxuZXhwb3J0cy5nZXRBbGxSZWNvcmRDYXRlZ29yaWVzRm9yVGFyZ2V0Q2F0ZWdvcnkgPSBnZXRBbGxSZWNvcmRDYXRlZ29yaWVzRm9yVGFyZ2V0Q2F0ZWdvcnk7XG5mdW5jdGlvbiBnZXRBbGxSZWNvcmRDYXRlZ29yaWVzRm9yVGFyZ2V0Q2F0ZWdvcmllcyhtb2RlbCwgY2F0ZWdvcmllcywgd29yZHNvbmx5KSB7XG4gICAgdmFyIHJlcyA9IHt9O1xuICAgIC8vXG4gICAgdmFyIGZuID0gd29yZHNvbmx5ID8gZ2V0UG90ZW50aWFsV29yZENhdGVnb3JpZXNGb3JEb21haW4gOiBnZXRDYXRlZ29yaWVzRm9yRG9tYWluO1xuICAgIHZhciBkb21haW5zID0gdW5kZWZpbmVkO1xuICAgIGNhdGVnb3JpZXMuZm9yRWFjaChmdW5jdGlvbiAoY2F0ZWdvcnkpIHtcbiAgICAgICAgdmFyIGNhdGRvbWFpbnMgPSBnZXREb21haW5zRm9yQ2F0ZWdvcnkobW9kZWwsIGNhdGVnb3J5KTtcbiAgICAgICAgaWYgKCFkb21haW5zKSB7XG4gICAgICAgICAgICBkb21haW5zID0gY2F0ZG9tYWlucztcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIGRvbWFpbnMgPSBfLmludGVyc2VjdGlvbihkb21haW5zLCBjYXRkb21haW5zKTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIGlmIChkb21haW5zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2NhdGVnb3JpZXMgJyArIFV0aWxzLmxpc3RUb1F1b3RlZENvbW1hQW5kKGNhdGVnb3JpZXMpICsgJyBoYXZlIG5vIGNvbW1vbiBkb21haW4uJyk7XG4gICAgfVxuICAgIGRvbWFpbnMuZm9yRWFjaChmdW5jdGlvbiAoZG9tYWluKSB7XG4gICAgICAgIGZuKG1vZGVsLCBkb21haW4pLmZvckVhY2goZnVuY3Rpb24gKHdvcmRjYXQpIHtcbiAgICAgICAgICAgIHJlc1t3b3JkY2F0XSA9IHRydWU7XG4gICAgICAgIH0pO1xuICAgIH0pO1xuICAgIE9iamVjdC5mcmVlemUocmVzKTtcbiAgICByZXR1cm4gcmVzO1xufVxuZXhwb3J0cy5nZXRBbGxSZWNvcmRDYXRlZ29yaWVzRm9yVGFyZ2V0Q2F0ZWdvcmllcyA9IGdldEFsbFJlY29yZENhdGVnb3JpZXNGb3JUYXJnZXRDYXRlZ29yaWVzO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
