/**
 * Functionality managing the match models
 *
 * @file
 */
"use strict";

var debug = require('debug');
var debuglog = debug('model');
var logger = require('../utils/logger');
var loadlog = logger.logger('modelload', '');
var IMatch = require('../match/ifmatch');
var InputFilterRules = require('../match/inputFilterRules');
var Tools = require('../match/tools');
var fs = require('fs');
var Meta = require('./meta');
var Utils = require('../utils/utils');
var process = require('process');
var _ = require('lodash');
/**
 * the model path, may be controlled via environment variable
 */
var envModelPath = process.env["ABOT_MODELPATH"] || "testmodel";
;
var ARR_MODEL_PROPERTIES = ["domain", "categoryDescribed", "description", "tool", "toolhidden", "synonyms", "category", "wordindex", "exactmatch", "hidden"];
function addSynonyms(synonyms, category, synonymFor, mRules, seen) {
    synonyms.forEach(function (syn) {
        var oRule = {
            category: category,
            matchedString: synonymFor,
            type: 0 /* WORD */
            , word: syn,
            _ranking: 0.95
        };
        debuglog("inserting synonym" + JSON.stringify(oRule));
        insertRuleIfNotPresent(mRules, oRule, seen);
    });
}
function getRuleKey(rule) {
    return rule.matchedString + "-|-" + rule.category + " -|- " + rule.type + " -|- " + rule.word + " ";
}
function insertRuleIfNotPresent(mRules, rule, seenRules) {
    if (rule.type !== 0 /* WORD */) {
            mRules.push(rule);
            return;
        }
    if (rule.word === undefined || rule.matchedString === undefined) {
        throw new Error('illegal rule' + JSON.stringify(rule, undefined, 2));
    }
    var r = getRuleKey(rule);
    rule.lowercaseword = rule.word.toLowerCase();
    if (seenRules[r]) {
        debuglog("Attempting to insert duplicate" + JSON.stringify(rule, undefined, 2));
        var duplicates = seenRules[r].filter(function (oEntry) {
            return 0 === InputFilterRules.compareMRuleFull(oEntry, rule);
        });
        if (duplicates.length > 0) {
            return;
        }
    }
    seenRules[r] = seenRules[r] || [];
    seenRules[r].push(rule);
    if (rule.word === "") {
        debuglog('Skipping rule with emtpy word ' + JSON.stringify(rule, undefined, 2));
        loadlog('Skipping rule with emtpy word ' + JSON.stringify(rule, undefined, 2));
        return;
    }
    mRules.push(rule);
    return;
}
function loadModelData(modelPath, oMdl, sModelName, oModel) {
    // read the data ->
    // data is processed into mRules directly,
    var sFileName = './' + modelPath + '/' + sModelName + ".data.json";
    var mdldata = fs.readFileSync(sFileName, 'utf-8');
    var oMdlData = JSON.parse(mdldata);
    oMdlData.forEach(function (oEntry) {
        if (!oEntry.tool) {
            oEntry._domain = oMdl.domain;
        }
        if (!oEntry.tool && oMdl.tool.name) {
            oEntry.tool = oMdl.tool.name;
        }
        oModel.records.push(oEntry);
        oMdl.category.forEach(function (cat) {
            if (oEntry[cat] === 'undefined') {
                oEntry[cat] = "n/a";
                var bug = "INCONSISTENT*> ModelData " + sFileName + " does not contain category " + cat + " with value 'undefined', undefined is illegal value, use n/a " + JSON.stringify(oEntry) + "";
                debuglog(bug);
            }
        });
        oMdl.wordindex.forEach(function (category) {
            if (oEntry[category] === undefined) {
                debuglog("INCONSISTENT*> ModelData " + sFileName + " does not contain category " + category + " of wordindex" + JSON.stringify(oEntry) + "");
                return;
            }
            if (oEntry[category] !== "*") {
                var sString = oEntry[category];
                debuglog("pushing rule with " + category + " -> " + sString);
                var oRule = {
                    category: category,
                    matchedString: sString,
                    type: 0 /* WORD */
                    , word: sString,
                    _ranking: 0.95
                };
                if (oMdl.exactmatch && oMdl.exactmatch.indexOf(category) >= 0) {
                    oRule.exactOnly = true;
                }
                insertRuleIfNotPresent(oModel.mRules, oRule, oModel.seenRules);
                if (oMdlData.synonyms && oMdlData.synonyms[category]) {
                    addSynonyms(oMdlData.synonyms[category], category, sString, oModel.mRules, oModel.seenRules);
                }
                if (oEntry.synonyms && oEntry.synonyms[category]) {
                    addSynonyms(oEntry.synonyms[category], category, sString, oModel.mRules, oModel.seenRules);
                }
            }
        });
    });
}
function loadModel(modelPath, sModelName, oModel) {
    debuglog(" loading " + sModelName + " ....");
    var mdl = fs.readFileSync('./' + modelPath + '/' + sModelName + ".model.json", 'utf-8');
    var oMdl = JSON.parse(mdl);
    var categoryDescribedMap = {};
    oMdl.categoryDescribed = [];
    // rectify category
    oMdl.category = oMdl.category.map(function (cat) {
        if (typeof cat === "string") {
            return cat;
        }
        if (typeof cat.name !== "string") {
            console.log("Missing name in object typed category in " + JSON.stringify(cat) + " in model " + sModelName);
            process.exit(-1);
        }
        categoryDescribedMap[cat.name] = cat;
        oMdl.categoryDescribed.push(cat);
        return cat.name;
    });
    if (oModel.domains.indexOf(oMdl.domain) >= 0) {
        debuglog("***********here mdl" + JSON.stringify(oMdl, undefined, 2));
        throw new Error('Domain ' + oMdl.domain + ' already loaded while loading ' + sModelName + '?');
    }
    // check properties of model
    Object.keys(oMdl).sort().forEach(function (sProperty) {
        if (ARR_MODEL_PROPERTIES.indexOf(sProperty) < 0) {
            throw new Error('Model property "' + sProperty + '" not a known model property in model of domain ' + oMdl.domain + ' ');
        }
    });
    oModel.full.domain[oMdl.domain] = { description: oMdl.description,
        categories: categoryDescribedMap };
    // check that members of wordindex are in categories,
    oMdl.wordindex = oMdl.wordindex || [];
    oMdl.wordindex.forEach(function (sWordIndex) {
        if (oMdl.category.indexOf(sWordIndex) < 0) {
            throw new Error('Model wordindex "' + sWordIndex + '" not a category of domain ' + oMdl.domain + ' ');
        }
    });
    oMdl.exactmatch = oMdl.exactmatch || [];
    oMdl.exactmatch.forEach(function (sExactMatch) {
        if (oMdl.category.indexOf(sExactMatch) < 0) {
            throw new Error('Model exactmatch "' + sExactMatch + '" not a category of domain ' + oMdl.domain + ' ');
        }
    });
    // add relation domain -> category
    var domainStr = MetaF.Domain(oMdl.domain).toFullString();
    var relationStr = MetaF.Relation(Meta.RELATION_hasCategory).toFullString();
    var reverseRelationStr = MetaF.Relation(Meta.RELATION_isCategoryOf).toFullString();
    oMdl.category.forEach(function (sCategory) {
        var CategoryString = MetaF.Category(sCategory).toFullString();
        oModel.meta.t3[domainStr] = oModel.meta.t3[domainStr] || {};
        oModel.meta.t3[domainStr][relationStr] = oModel.meta.t3[domainStr][relationStr] || {};
        oModel.meta.t3[domainStr][relationStr][CategoryString] = {};
        oModel.meta.t3[CategoryString] = oModel.meta.t3[CategoryString] || {};
        oModel.meta.t3[CategoryString][reverseRelationStr] = oModel.meta.t3[CategoryString][reverseRelationStr] || {};
        oModel.meta.t3[CategoryString][reverseRelationStr][domainStr] = {};
    });
    // add a precice domain matchrule
    insertRuleIfNotPresent(oModel.mRules, {
        category: "domain",
        matchedString: oMdl.domain,
        type: 0 /* WORD */
        , word: oMdl.domain,
        _ranking: 0.95
    }, oModel.seenRules);
    // check the tool
    if (oMdl.tool && oMdl.tool.requires) {
        var requires = Object.keys(oMdl.tool.requires || {});
        var diff = _.difference(requires, oMdl.category);
        if (diff.length > 0) {
            console.log(" " + oMdl.domain + " : Unkown category in requires of tool: \"" + diff.join('"') + '"');
            process.exit(-1);
        }
        var optional = Object.keys(oMdl.tool.optional);
        diff = _.difference(optional, oMdl.category);
        if (diff.length > 0) {
            console.log(" " + oMdl.domain + " : Unkown category optional of tool: \"" + diff.join('"') + '"');
            process.exit(-1);
        }
        Object.keys(oMdl.tool.sets || {}).forEach(function (setID) {
            var diff = _.difference(oMdl.tool.sets[setID].set, oMdl.category);
            if (diff.length > 0) {
                console.log(" " + oMdl.domain + " : Unkown category in setId " + setID + " of tool: \"" + diff.join('"') + '"');
                process.exit(-1);
            }
        });
        // extract tools an add to tools:
        oModel.tools.filter(function (oEntry) {
            if (oEntry.name === (oMdl.tool && oMdl.tool.name)) {
                console.log("Tool " + oMdl.tool.name + " already present when loading " + sModelName);
                //throw new Error('Domain already loaded?');
                process.exit(-1);
            }
        });
    } else {
        oMdl.toolhidden = true;
        oMdl.tool.requires = { "impossible": {} };
    }
    // add the tool name as rule unless hidden
    if (!oMdl.toolhidden && oMdl.tool && oMdl.tool.name) {
        insertRuleIfNotPresent(oModel.mRules, {
            category: "tool",
            matchedString: oMdl.tool.name,
            type: 0 /* WORD */
            , word: oMdl.tool.name,
            _ranking: 0.95
        }, oModel.seenRules);
    }
    ;
    if (oMdl.synonyms && oMdl.synonyms["tool"]) {
        addSynonyms(oMdl.synonyms["tool"], "tool", oMdl.tool.name, oModel.mRules, oModel.seenRules);
    }
    ;
    if (oMdl.synonyms) {
        Object.keys(oMdl.synonyms).forEach(function (ssynkey) {
            if (oMdl.category.indexOf(ssynkey) >= 0 && ssynkey !== "tool") {
                if (oModel.full.domain[oMdl.domain].categories[ssynkey]) {
                    oModel.full.domain[oMdl.domain].categories[ssynkey].synonyms = oMdl.synonyms[ssynkey];
                }
                addSynonyms(oMdl.synonyms[ssynkey], "category", ssynkey, oModel.mRules, oModel.seenRules);
            }
        });
    }
    oModel.domains.push(oMdl.domain);
    if (oMdl.tool.name) {
        oModel.tools.push(oMdl.tool);
    }
    oModel.category = oModel.category.concat(oMdl.category);
    oModel.category.sort();
    oModel.category = oModel.category.filter(function (string, index) {
        return oModel.category[index] !== oModel.category[index + 1];
    });
    loadModelData(modelPath, oMdl, sModelName, oModel);
} // loadmodel
function splitRules(rules) {
    var res = {};
    var nonWordRules = [];
    rules.forEach(function (rule) {
        if (rule.type === 0 /* WORD */) {
                if (!rule.lowercaseword) {
                    throw new Error("Rule has no member lowercaseword" + JSON.stringify(rule));
                }
                res[rule.lowercaseword] = res[rule.lowercaseword] || [];
                res[rule.lowercaseword].push(rule);
            } else {
            nonWordRules.push(rule);
        }
    });
    return {
        wordMap: res,
        nonWordRules: nonWordRules,
        allRules: rules
    };
}
exports.splitRules = splitRules;
function loadModels(modelPath) {
    var oModel;
    oModel = {
        full: { domain: {} },
        domains: [],
        tools: [],
        rules: undefined,
        category: [],
        operators: {},
        mRules: [],
        seenRules: {},
        records: [],
        meta: { t3: {} }
    };
    modelPath = modelPath || envModelPath;
    var smdls = fs.readFileSync('./' + modelPath + '/models.json', 'utf-8');
    var mdls = JSON.parse("" + smdls);
    mdls.forEach(function (sModelName) {
        loadModel(modelPath, sModelName, oModel);
    });
    // add the categories to the model:
    oModel.category.forEach(function (category) {
        insertRuleIfNotPresent(oModel.mRules, {
            category: "category",
            matchedString: category,
            type: 0 /* WORD */
            , word: category,
            lowercaseword: category.toLowerCase(),
            _ranking: 0.95
        }, oModel.seenRules);
    });
    // add the domain meta rule
    insertRuleIfNotPresent(oModel.mRules, {
        category: "meta",
        matchedString: "domain",
        type: 0 /* WORD */
        , word: "domain",
        _ranking: 0.95
    }, oModel.seenRules);
    //add a filler rule
    var sfillers = fs.readFileSync('./' + modelPath + '/filler.json', 'utf-8');
    var fillers = JSON.parse(sfillers);
    var re = "^((" + fillers.join(")|(") + "))$";
    oModel.mRules.push({
        category: "filler",
        type: 1 /* REGEXP */
        , regexp: new RegExp(re, "i"),
        matchedString: "filler",
        _ranking: 0.9
    });
    //add operators
    var sOperators = fs.readFileSync('./resources/model/operators.json', 'utf-8');
    var operators = JSON.parse(sOperators);
    Object.keys(operators.operators).forEach(function (operator) {
        if (IMatch.aOperatorNames.indexOf(operator) < 0) {
            debuglog("unknown operator " + operator);
            throw new Error("unknown operator " + operator);
        }
        oModel.operators[operator] = operators.operators[operator];
        oModel.operators[operator].operator = operator;
        Object.freeze(oModel.operators[operator]);
        var word = operator;
        insertRuleIfNotPresent(oModel.mRules, {
            category: "operator",
            word: word.toLowerCase(),
            lowercaseword: word.toLowerCase(),
            type: 0 /* WORD */
            , matchedString: word,
            _ranking: 0.9
        }, oModel.seenRules);
        // add all synonyms
        if (operators.synonyms[operator]) {
            Object.keys(operators.synonyms[operator]).forEach(function (synonym) {
                insertRuleIfNotPresent(oModel.mRules, {
                    category: "operator",
                    word: synonym.toLowerCase(),
                    lowercaseword: synonym.toLowerCase(),
                    type: 0 /* WORD */
                    , matchedString: operator,
                    _ranking: 0.9
                }, oModel.seenRules);
            });
        }
    });
    /*
        })
            {
          category: "filler",
          type: 1,
          regexp: /^((start)|(show)|(from)|(in))$/i,
          matchedString: "filler",
          _ranking: 0.9
        },
    */
    oModel.mRules = oModel.mRules.sort(InputFilterRules.cmpMRule);
    oModel.rules = splitRules(oModel.mRules);
    oModel.tools = oModel.tools.sort(Tools.cmpTools);
    delete oModel.seenRules;
    return oModel;
}
exports.loadModels = loadModels;
function sortCategoriesByImportance(map, cats) {
    var res = cats.slice(0);
    res.sort(rankCategoryByImportance.bind(undefined, map));
    return res;
}
exports.sortCategoriesByImportance = sortCategoriesByImportance;
function rankCategoryByImportance(map, cata, catb) {
    var catADesc = map[cata];
    var catBDesc = map[catb];
    if (cata === catb) {
        return 0;
    }
    // if a is before b, return -1
    if (catADesc && !catBDesc) {
        return -1;
    }
    if (!catADesc && catBDesc) {
        return +1;
    }
    var prioA = catADesc && catADesc.importance || 99;
    var prioB = catBDesc && catBDesc.importance || 99;
    // lower prio goes to front
    var r = prioA - prioB;
    if (r) {
        return r;
    }
    return cata.localeCompare(catb);
}
exports.rankCategoryByImportance = rankCategoryByImportance;
var MetaF = Meta.getMetaFactory();
function getOperator(mdl, operator) {
    return mdl.operators[operator];
}
exports.getOperator = getOperator;
function getResultAsArray(mdl, a, rel) {
    if (rel.toType() !== 'relation') {
        throw new Error("expect relation as 2nd arg");
    }
    var res = mdl.meta.t3[a.toFullString()] && mdl.meta.t3[a.toFullString()][rel.toFullString()];
    if (!res) {
        return [];
    }
    return Object.getOwnPropertyNames(res).sort().map(MetaF.parseIMeta);
}
exports.getResultAsArray = getResultAsArray;
function getCategoriesForDomain(theModel, domain) {
    if (theModel.domains.indexOf(domain) < 0) {
        throw new Error("Domain \"" + domain + "\" not part of model");
    }
    var res = getResultAsArray(theModel, MetaF.Domain(domain), MetaF.Relation(Meta.RELATION_hasCategory));
    return Meta.getStringArray(res);
}
exports.getCategoriesForDomain = getCategoriesForDomain;
/**
 * Return all categories of a domain which can appear on a word,
 * these are typically the wordindex domains + entries generated by generic rules
 *
 * The current implementation is a simplification
 */
function getPotentialWordCategoriesForDomain(theModel, domain) {
    // this is a simplified version
    return getCategoriesForDomain(theModel, domain);
}
exports.getPotentialWordCategoriesForDomain = getPotentialWordCategoriesForDomain;
function getDomainsForCategory(theModel, category) {
    if (theModel.category.indexOf(category) < 0) {
        throw new Error("Category \"" + category + "\" not part of model");
    }
    var res = getResultAsArray(theModel, MetaF.Category(category), MetaF.Relation(Meta.RELATION_isCategoryOf));
    return Meta.getStringArray(res);
}
exports.getDomainsForCategory = getDomainsForCategory;
function getAllRecordCategoriesForTargetCategory(model, category, wordsonly) {
    var res = {};
    //
    var fn = wordsonly ? getPotentialWordCategoriesForDomain : getCategoriesForDomain;
    var domains = getDomainsForCategory(model, category);
    domains.forEach(function (domain) {
        fn(model, domain).forEach(function (wordcat) {
            res[wordcat] = true;
        });
    });
    Object.freeze(res);
    return res;
}
exports.getAllRecordCategoriesForTargetCategory = getAllRecordCategoriesForTargetCategory;
function getAllRecordCategoriesForTargetCategories(model, categories, wordsonly) {
    var res = {};
    //
    var fn = wordsonly ? getPotentialWordCategoriesForDomain : getCategoriesForDomain;
    var domains = undefined;
    categories.forEach(function (category) {
        var catdomains = getDomainsForCategory(model, category);
        if (!domains) {
            domains = catdomains;
        } else {
            domains = _.intersection(domains, catdomains);
        }
    });
    if (domains.length === 0) {
        throw new Error('categories ' + Utils.listToQuotedCommaAnd(categories) + ' have no common domain.');
    }
    domains.forEach(function (domain) {
        fn(model, domain).forEach(function (wordcat) {
            res[wordcat] = true;
        });
    });
    Object.freeze(res);
    return res;
}
exports.getAllRecordCategoriesForTargetCategories = getAllRecordCategoriesForTargetCategories;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9tb2RlbC9tb2RlbC50cyIsIm1vZGVsL21vZGVsLmpzIl0sIm5hbWVzIjpbImRlYnVnIiwicmVxdWlyZSIsImRlYnVnbG9nIiwibG9nZ2VyIiwibG9hZGxvZyIsIklNYXRjaCIsIklucHV0RmlsdGVyUnVsZXMiLCJUb29scyIsImZzIiwiTWV0YSIsIlV0aWxzIiwicHJvY2VzcyIsIl8iLCJlbnZNb2RlbFBhdGgiLCJlbnYiLCJBUlJfTU9ERUxfUFJPUEVSVElFUyIsImFkZFN5bm9ueW1zIiwic3lub255bXMiLCJjYXRlZ29yeSIsInN5bm9ueW1Gb3IiLCJtUnVsZXMiLCJzZWVuIiwiZm9yRWFjaCIsInN5biIsIm9SdWxlIiwibWF0Y2hlZFN0cmluZyIsInR5cGUiLCJ3b3JkIiwiX3JhbmtpbmciLCJKU09OIiwic3RyaW5naWZ5IiwiaW5zZXJ0UnVsZUlmTm90UHJlc2VudCIsImdldFJ1bGVLZXkiLCJydWxlIiwic2VlblJ1bGVzIiwicHVzaCIsInVuZGVmaW5lZCIsIkVycm9yIiwiciIsImxvd2VyY2FzZXdvcmQiLCJ0b0xvd2VyQ2FzZSIsImR1cGxpY2F0ZXMiLCJmaWx0ZXIiLCJvRW50cnkiLCJjb21wYXJlTVJ1bGVGdWxsIiwibGVuZ3RoIiwibG9hZE1vZGVsRGF0YSIsIm1vZGVsUGF0aCIsIm9NZGwiLCJzTW9kZWxOYW1lIiwib01vZGVsIiwic0ZpbGVOYW1lIiwibWRsZGF0YSIsInJlYWRGaWxlU3luYyIsIm9NZGxEYXRhIiwicGFyc2UiLCJ0b29sIiwiX2RvbWFpbiIsImRvbWFpbiIsIm5hbWUiLCJyZWNvcmRzIiwiY2F0IiwiYnVnIiwid29yZGluZGV4Iiwic1N0cmluZyIsImV4YWN0bWF0Y2giLCJpbmRleE9mIiwiZXhhY3RPbmx5IiwibG9hZE1vZGVsIiwibWRsIiwiY2F0ZWdvcnlEZXNjcmliZWRNYXAiLCJjYXRlZ29yeURlc2NyaWJlZCIsIm1hcCIsImNvbnNvbGUiLCJsb2ciLCJleGl0IiwiZG9tYWlucyIsIk9iamVjdCIsImtleXMiLCJzb3J0Iiwic1Byb3BlcnR5IiwiZnVsbCIsImRlc2NyaXB0aW9uIiwiY2F0ZWdvcmllcyIsInNXb3JkSW5kZXgiLCJzRXhhY3RNYXRjaCIsImRvbWFpblN0ciIsIk1ldGFGIiwiRG9tYWluIiwidG9GdWxsU3RyaW5nIiwicmVsYXRpb25TdHIiLCJSZWxhdGlvbiIsIlJFTEFUSU9OX2hhc0NhdGVnb3J5IiwicmV2ZXJzZVJlbGF0aW9uU3RyIiwiUkVMQVRJT05faXNDYXRlZ29yeU9mIiwic0NhdGVnb3J5IiwiQ2F0ZWdvcnlTdHJpbmciLCJDYXRlZ29yeSIsIm1ldGEiLCJ0MyIsInJlcXVpcmVzIiwiZGlmZiIsImRpZmZlcmVuY2UiLCJqb2luIiwib3B0aW9uYWwiLCJzZXRzIiwic2V0SUQiLCJzZXQiLCJ0b29scyIsInRvb2xoaWRkZW4iLCJzc3lua2V5IiwiY29uY2F0Iiwic3RyaW5nIiwiaW5kZXgiLCJzcGxpdFJ1bGVzIiwicnVsZXMiLCJyZXMiLCJub25Xb3JkUnVsZXMiLCJ3b3JkTWFwIiwiYWxsUnVsZXMiLCJleHBvcnRzIiwibG9hZE1vZGVscyIsIm9wZXJhdG9ycyIsInNtZGxzIiwibWRscyIsInNmaWxsZXJzIiwiZmlsbGVycyIsInJlIiwicmVnZXhwIiwiUmVnRXhwIiwic09wZXJhdG9ycyIsIm9wZXJhdG9yIiwiYU9wZXJhdG9yTmFtZXMiLCJmcmVlemUiLCJzeW5vbnltIiwiY21wTVJ1bGUiLCJjbXBUb29scyIsInNvcnRDYXRlZ29yaWVzQnlJbXBvcnRhbmNlIiwiY2F0cyIsInNsaWNlIiwicmFua0NhdGVnb3J5QnlJbXBvcnRhbmNlIiwiYmluZCIsImNhdGEiLCJjYXRiIiwiY2F0QURlc2MiLCJjYXRCRGVzYyIsInByaW9BIiwiaW1wb3J0YW5jZSIsInByaW9CIiwibG9jYWxlQ29tcGFyZSIsImdldE1ldGFGYWN0b3J5IiwiZ2V0T3BlcmF0b3IiLCJnZXRSZXN1bHRBc0FycmF5IiwiYSIsInJlbCIsInRvVHlwZSIsImdldE93blByb3BlcnR5TmFtZXMiLCJwYXJzZUlNZXRhIiwiZ2V0Q2F0ZWdvcmllc0ZvckRvbWFpbiIsInRoZU1vZGVsIiwiZ2V0U3RyaW5nQXJyYXkiLCJnZXRQb3RlbnRpYWxXb3JkQ2F0ZWdvcmllc0ZvckRvbWFpbiIsImdldERvbWFpbnNGb3JDYXRlZ29yeSIsImdldEFsbFJlY29yZENhdGVnb3JpZXNGb3JUYXJnZXRDYXRlZ29yeSIsIm1vZGVsIiwid29yZHNvbmx5IiwiZm4iLCJ3b3JkY2F0IiwiZ2V0QWxsUmVjb3JkQ2F0ZWdvcmllc0ZvclRhcmdldENhdGVnb3JpZXMiLCJjYXRkb21haW5zIiwiaW50ZXJzZWN0aW9uIiwibGlzdFRvUXVvdGVkQ29tbWFBbmQiXSwibWFwcGluZ3MiOiJBQUFBOzs7OztBQ0tBOztBREVBLElBQVlBLFFBQUtDLFFBQU0sT0FBTixDQUFqQjtBQUVBLElBQUlDLFdBQVdGLE1BQU0sT0FBTixDQUFmO0FBRUEsSUFBWUcsU0FBTUYsUUFBTSxpQkFBTixDQUFsQjtBQUVBLElBQU1HLFVBQVVELE9BQU9BLE1BQVAsQ0FBYyxXQUFkLEVBQTJCLEVBQTNCLENBQWhCO0FBRUEsSUFBYUUsU0FBTUosUUFBTSxrQkFBTixDQUFuQjtBQUVBLElBQVlLLG1CQUFnQkwsUUFBTSwyQkFBTixDQUE1QjtBQUNBLElBQVlNLFFBQUtOLFFBQU0sZ0JBQU4sQ0FBakI7QUFDQSxJQUFZTyxLQUFFUCxRQUFNLElBQU4sQ0FBZDtBQUNBLElBQVlRLE9BQUlSLFFBQU0sUUFBTixDQUFoQjtBQUNBLElBQVlTLFFBQUtULFFBQU0sZ0JBQU4sQ0FBakI7QUFDQSxJQUFZVSxVQUFPVixRQUFNLFNBQU4sQ0FBbkI7QUFDQSxJQUFZVyxJQUFDWCxRQUFNLFFBQU4sQ0FBYjtBQUVBOzs7QUFHQSxJQUFJWSxlQUFlRixRQUFRRyxHQUFSLENBQVksZ0JBQVosS0FBaUMsV0FBcEQ7QUErQkM7QUFFRCxJQUFNQyx1QkFBdUIsQ0FBQyxRQUFELEVBQVcsbUJBQVgsRUFBZ0MsYUFBaEMsRUFBK0MsTUFBL0MsRUFBdUQsWUFBdkQsRUFBcUUsVUFBckUsRUFBaUYsVUFB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bUIsQ0FBdEIsRUFBeUI7QUFDckIsY0FBTSxJQUFJUixLQUFKLENBQVUsZ0JBQWdCM0IsTUFBTWlLLG9CQUFOLENBQTJCeEYsVUFBM0IsQ0FBaEIsR0FBeUQseUJBQW5FLENBQU47QUFDSDtBQUNEUCxZQUFRdEQsT0FBUixDQUFnQixVQUFTb0MsTUFBVCxFQUFlO0FBQzNCNEcsV0FBR0YsS0FBSCxFQUFVMUcsTUFBVixFQUFrQnBDLE9BQWxCLENBQTBCLFVBQVNpSixPQUFULEVBQWdCO0FBQ3RDbkQsZ0JBQUltRCxPQUFKLElBQWUsSUFBZjtBQUNILFNBRkQ7QUFHSCxLQUpEO0FBS0ExRixXQUFPd0QsTUFBUCxDQUFjakIsR0FBZDtBQUNBLFdBQU9BLEdBQVA7QUFDRjtBQXZCZUksUUFBQWdELHlDQUFBLEdBQXlDQSx5Q0FBekMiLCJmaWxlIjoibW9kZWwvbW9kZWwuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcclxuICogRnVuY3Rpb25hbGl0eSBtYW5hZ2luZyB0aGUgbWF0Y2ggbW9kZWxzXHJcbiAqXHJcbiAqIEBmaWxlXHJcbiAqL1xyXG5cclxuaW1wb3J0ICogYXMgaW50ZiBmcm9tICdjb25zdGFudHMnO1xyXG5pbXBvcnQgKiBhcyBkZWJ1ZyBmcm9tICdkZWJ1Zyc7XHJcblxyXG52YXIgZGVidWdsb2cgPSBkZWJ1ZygnbW9kZWwnKTtcclxuXHJcbmltcG9ydCAqIGFzIGxvZ2dlciBmcm9tICcuLi91dGlscy9sb2dnZXInO1xyXG5cclxuY29uc3QgbG9hZGxvZyA9IGxvZ2dlci5sb2dnZXIoJ21vZGVsbG9hZCcsICcnKTtcclxuXHJcbmltcG9ydCAqICBhcyBJTWF0Y2ggZnJvbSAnLi4vbWF0Y2gvaWZtYXRjaCc7XHJcbmltcG9ydCAqIGFzIE1hdGNoIGZyb20gJy4uL21hdGNoL21hdGNoJztcclxuaW1wb3J0ICogYXMgSW5wdXRGaWx0ZXJSdWxlcyBmcm9tICcuLi9tYXRjaC9pbnB1dEZpbHRlclJ1bGVzJztcclxuaW1wb3J0ICogYXMgVG9vbHMgZnJvbSAnLi4vbWF0Y2gvdG9vbHMnO1xyXG5pbXBvcnQgKiBhcyBmcyBmcm9tICdmcyc7XHJcbmltcG9ydCAqIGFzIE1ldGEgZnJvbSAnLi9tZXRhJztcclxuaW1wb3J0ICogYXMgVXRpbHMgZnJvbSAnLi4vdXRpbHMvdXRpbHMnO1xyXG5pbXBvcnQgKiBhcyBwcm9jZXNzIGZyb20gJ3Byb2Nlc3MnO1xyXG5pbXBvcnQgKiBhcyBfIGZyb20gJ2xvZGFzaCc7XHJcblxyXG4vKipcclxuICogdGhlIG1vZGVsIHBhdGgsIG1heSBiZSBjb250cm9sbGVkIHZpYSBlbnZpcm9ubWVudCB2YXJpYWJsZVxyXG4gKi9cclxudmFyIGVudk1vZGVsUGF0aCA9IHByb2Nlc3MuZW52W1wiQUJPVF9NT0RFTFBBVEhcIl0gfHwgXCJ0ZXN0bW9kZWxcIjtcclxuXHJcbi8vZXhwb3J0IGludGVyZmFjZSBJTW9kZWxzID0gTWF0Y2guSU1vZGVscztcclxuXHJcbi8qXHJcbmV4cG9ydCBpbnRlcmZhY2UgSU1vZGVscyB7XHJcbiAgICBkb21haW5zOiBzdHJpbmdbXSxcclxuICAgIHRvb2xzOiBJTWF0Y2guSVRvb2xbXSxcclxuICAgIGNhdGVnb3J5OiBzdHJpbmdbXSxcclxuICAgIG1SdWxlczogSU1hdGNoLm1SdWxlW10sXHJcbiAgICByZWNvcmRzOiBhbnlbXVxyXG4gICAgc2VlblJ1bGVzPzogeyBba2V5OiBzdHJpbmddOiBJTWF0Y2gubVJ1bGUgfSxcclxuICAgIG1ldGEgOiB7XHJcbiAgICAgICAgLy8gZW50aXR5IC0+IHJlbGF0aW9uIC0+IHRhcmdldFxyXG4gICAgICAgIHQzIDogeyBba2V5OiBzdHJpbmddIDogeyBba2V5IDogc3RyaW5nXSA6IGFueSB9fVxyXG4gICAgfVxyXG59Ki9cclxuXHJcbmludGVyZmFjZSBJTW9kZWwge1xyXG4gICAgZG9tYWluOiBzdHJpbmcsXHJcbiAgICBkZXNjcmlwdGlvbj8gOiBzdHJpbmcsXHJcbiAgICB0b29sOiBJTWF0Y2guSVRvb2wsXHJcbiAgICB0b29saGlkZGVuPzogYm9vbGVhbixcclxuICAgIHN5bm9ueW1zPzogeyBba2V5OiBzdHJpbmddOiBzdHJpbmdbXSB9LFxyXG4gICAgY2F0ZWdvcnlEZXNjcmliZWQgOiAgeyBuYW1lIDogc3RyaW5nLFxyXG4gICAgICAgIGRlc2NyaXB0aW9uPyA6IHN0cmluZyxcclxuICAgICAgICBrZXk/IDogc3RyaW5nIH1bXSxcclxuICAgIGNhdGVnb3J5OiBzdHJpbmdbXSxcclxuICAgIHdvcmRpbmRleDogc3RyaW5nW10sXHJcbiAgICBleGFjdG1hdGNoPyA6IHN0cmluZ1tdLFxyXG4gICAgaGlkZGVuOiBzdHJpbmdbXVxyXG59O1xyXG5cclxuY29uc3QgQVJSX01PREVMX1BST1BFUlRJRVMgPSBbXCJkb21haW5cIiwgXCJjYXRlZ29yeURlc2NyaWJlZFwiLCBcImRlc2NyaXB0aW9uXCIsIFwidG9vbFwiLCBcInRvb2xoaWRkZW5cIiwgXCJzeW5vbnltc1wiLCBcImNhdGVnb3J5XCIsIFwid29yZGluZGV4XCIsIFwiZXhhY3RtYXRjaFwiLCBcImhpZGRlblwiXTtcclxuXHJcbmZ1bmN0aW9uIGFkZFN5bm9ueW1zKHN5bm9ueW1zOiBzdHJpbmdbXSwgY2F0ZWdvcnk6IHN0cmluZywgc3lub255bUZvcjogc3RyaW5nLCBtUnVsZXM6IEFycmF5PElNYXRjaC5tUnVsZT4sIHNlZW46IHsgW2tleTogc3RyaW5nXTogSU1hdGNoLm1SdWxlW10gfSkge1xyXG4gICAgc3lub255bXMuZm9yRWFjaChmdW5jdGlvbiAoc3luKSB7XHJcbiAgICAgICAgdmFyIG9SdWxlID0ge1xyXG4gICAgICAgICAgICBjYXRlZ29yeTogY2F0ZWdvcnksXHJcbiAgICAgICAgICAgIG1hdGNoZWRTdHJpbmc6IHN5bm9ueW1Gb3IsXHJcbiAgICAgICAgICAgIHR5cGU6IElNYXRjaC5FbnVtUnVsZVR5cGUuV09SRCxcclxuICAgICAgICAgICAgd29yZDogc3luLFxyXG4gICAgICAgICAgICBfcmFua2luZzogMC45NVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgZGVidWdsb2coXCJpbnNlcnRpbmcgc3lub255bVwiICsgSlNPTi5zdHJpbmdpZnkob1J1bGUpKTtcclxuICAgICAgICBpbnNlcnRSdWxlSWZOb3RQcmVzZW50KG1SdWxlcywgb1J1bGUsIHNlZW4pO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdldFJ1bGVLZXkocnVsZSkge1xyXG4gICAgcmV0dXJuIHJ1bGUubWF0Y2hlZFN0cmluZyArIFwiLXwtXCIgKyBydWxlLmNhdGVnb3J5ICsgXCIgLXwtIFwiICsgcnVsZS50eXBlICArIFwiIC18LSBcIiArIHJ1bGUud29yZCArIFwiIFwiO1xyXG59XHJcblxyXG5mdW5jdGlvbiBpbnNlcnRSdWxlSWZOb3RQcmVzZW50KG1SdWxlczogQXJyYXk8SU1hdGNoLm1SdWxlPiwgcnVsZTogSU1hdGNoLm1SdWxlLFxyXG4gICAgc2VlblJ1bGVzOiB7IFtrZXk6IHN0cmluZ106IElNYXRjaC5tUnVsZVtdIH0pIHtcclxuXHJcbiAgICBpZiAocnVsZS50eXBlICE9PSBJTWF0Y2guRW51bVJ1bGVUeXBlLldPUkQpIHtcclxuICAgICAgICBtUnVsZXMucHVzaChydWxlKTtcclxuICAgICAgICByZXR1cm47XHJcbiAgICB9XHJcbiAgICBpZiAoKHJ1bGUud29yZCA9PT0gdW5kZWZpbmVkKSB8fCAocnVsZS5tYXRjaGVkU3RyaW5nID09PSB1bmRlZmluZWQpKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbGxlZ2FsIHJ1bGUnICsgSlNPTi5zdHJpbmdpZnkocnVsZSwgdW5kZWZpbmVkLCAyKSk7XHJcbiAgICB9XHJcbiAgICB2YXIgciA9IGdldFJ1bGVLZXkocnVsZSk7XHJcbiAgICBydWxlLmxvd2VyY2FzZXdvcmQgPSBydWxlLndvcmQudG9Mb3dlckNhc2UoKTtcclxuICAgIGlmIChzZWVuUnVsZXNbcl0pIHtcclxuICAgICAgICBkZWJ1Z2xvZyhcIkF0dGVtcHRpbmcgdG8gaW5zZXJ0IGR1cGxpY2F0ZVwiICsgSlNPTi5zdHJpbmdpZnkocnVsZSwgdW5kZWZpbmVkLCAyKSk7XHJcbiAgICAgICAgdmFyIGR1cGxpY2F0ZXMgPSBzZWVuUnVsZXNbcl0uZmlsdGVyKGZ1bmN0aW9uKCBvRW50cnkpIHtcclxuICAgICAgICAgICAgcmV0dXJuIDAgPT09IElucHV0RmlsdGVyUnVsZXMuY29tcGFyZU1SdWxlRnVsbChvRW50cnkscnVsZSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgaWYoZHVwbGljYXRlcy5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBzZWVuUnVsZXNbcl0gPSAoc2VlblJ1bGVzW3JdIHx8IFtdKTtcclxuICAgIHNlZW5SdWxlc1tyXS5wdXNoKHJ1bGUpO1xyXG4gICAgaWYgKHJ1bGUud29yZCA9PT0gXCJcIikge1xyXG4gICAgICAgIGRlYnVnbG9nKCdTa2lwcGluZyBydWxlIHdpdGggZW10cHkgd29yZCAnICsgSlNPTi5zdHJpbmdpZnkocnVsZSwgdW5kZWZpbmVkLCAyKSk7XHJcbiAgICAgICAgbG9hZGxvZygnU2tpcHBpbmcgcnVsZSB3aXRoIGVtdHB5IHdvcmQgJyArIEpTT04uc3RyaW5naWZ5KHJ1bGUsIHVuZGVmaW5lZCwgMikpO1xyXG4gICAgICAgIHJldHVybjtcclxuICAgIH1cclxuICAgIG1SdWxlcy5wdXNoKHJ1bGUpO1xyXG4gICAgcmV0dXJuO1xyXG59XHJcblxyXG5mdW5jdGlvbiBsb2FkTW9kZWxEYXRhKG1vZGVsUGF0aDogc3RyaW5nLCBvTWRsOiBJTW9kZWwsIHNNb2RlbE5hbWU6IHN0cmluZywgb01vZGVsOiBJTWF0Y2guSU1vZGVscykge1xyXG4gICAgLy8gcmVhZCB0aGUgZGF0YSAtPlxyXG4gICAgLy8gZGF0YSBpcyBwcm9jZXNzZWQgaW50byBtUnVsZXMgZGlyZWN0bHksXHJcbiAgICBjb25zdCBzRmlsZU5hbWUgPSAoJy4vJyArIG1vZGVsUGF0aCArICcvJyArIHNNb2RlbE5hbWUgKyBcIi5kYXRhLmpzb25cIik7XHJcbiAgICB2YXIgbWRsZGF0YSA9IGZzLnJlYWRGaWxlU3luYyhzRmlsZU5hbWUsICd1dGYtOCcpO1xyXG4gICAgdmFyIG9NZGxEYXRhID0gSlNPTi5wYXJzZShtZGxkYXRhKTtcclxuICAgIG9NZGxEYXRhLmZvckVhY2goZnVuY3Rpb24gKG9FbnRyeSkge1xyXG4gICAgICAgIGlmKCFvRW50cnkudG9vbCkge1xyXG4gICAgICAgICAgICBvRW50cnkuX2RvbWFpbiA9IG9NZGwuZG9tYWluO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIW9FbnRyeS50b29sICYmIG9NZGwudG9vbC5uYW1lKSB7XHJcbiAgICAgICAgICAgIG9FbnRyeS50b29sID0gb01kbC50b29sLm5hbWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG9Nb2RlbC5yZWNvcmRzLnB1c2gob0VudHJ5KTtcclxuICAgICAgICBvTWRsLmNhdGVnb3J5LmZvckVhY2goZnVuY3Rpb24oY2F0KSB7XHJcbiAgICAgICAgICAgIGlmKG9FbnRyeVtjYXRdID09PSAndW5kZWZpbmVkJykge1xyXG4gICAgICAgICAgICAgICAgb0VudHJ5W2NhdF0gPSBcIm4vYVwiO1xyXG4gICAgICAgICAgICAgICAgdmFyIGJ1ZyA9XHJcbiAgICAgICAgICAgICAgICAgICAgXCJJTkNPTlNJU1RFTlQqPiBNb2RlbERhdGEgXCIgKyBzRmlsZU5hbWUgKyBcIiBkb2VzIG5vdCBjb250YWluIGNhdGVnb3J5IFwiICsgY2F0ICsgXCIgd2l0aCB2YWx1ZSAndW5kZWZpbmVkJywgdW5kZWZpbmVkIGlzIGlsbGVnYWwgdmFsdWUsIHVzZSBuL2EgXCIgKyBKU09OLnN0cmluZ2lmeShvRW50cnkpICsgXCJcIjtcclxuICAgICAgICAgICAgICAgIGRlYnVnbG9nKGJ1Zyk7XHJcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKGJ1Zyk7XHJcbiAgICAgICAgICAgICAgICAvL3Byb2Nlc3MuZXhpdCgtMSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KVxyXG5cclxuICAgICAgICBvTWRsLndvcmRpbmRleC5mb3JFYWNoKGZ1bmN0aW9uIChjYXRlZ29yeSkge1xyXG4gICAgICAgICAgICBpZiAob0VudHJ5W2NhdGVnb3J5XSA9PT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICBkZWJ1Z2xvZyhcIklOQ09OU0lTVEVOVCo+IE1vZGVsRGF0YSBcIiArIHNGaWxlTmFtZSArIFwiIGRvZXMgbm90IGNvbnRhaW4gY2F0ZWdvcnkgXCIgKyBjYXRlZ29yeSArIFwiIG9mIHdvcmRpbmRleFwiICsgSlNPTi5zdHJpbmdpZnkob0VudHJ5KSArIFwiXCIpXHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKG9FbnRyeVtjYXRlZ29yeV0gIT09IFwiKlwiKSB7XHJcbiAgICAgICAgICAgICAgICB2YXIgc1N0cmluZyA9IG9FbnRyeVtjYXRlZ29yeV07XHJcbiAgICAgICAgICAgICAgICBkZWJ1Z2xvZyhcInB1c2hpbmcgcnVsZSB3aXRoIFwiICsgY2F0ZWdvcnkgKyBcIiAtPiBcIiArIHNTdHJpbmcpO1xyXG4gICAgICAgICAgICAgICAgdmFyIG9SdWxlID0ge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBjYXRlZ29yeTogY2F0ZWdvcnksXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hdGNoZWRTdHJpbmc6IHNTdHJpbmcsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHR5cGU6IElNYXRjaC5FbnVtUnVsZVR5cGUuV09SRCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgd29yZDogc1N0cmluZyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgX3Jhbmtpbmc6IDAuOTVcclxuICAgICAgICAgICAgICAgICAgICB9IGFzIElNYXRjaC5tUnVsZTtcclxuICAgICAgICAgICAgICAgIGlmKG9NZGwuZXhhY3RtYXRjaCAmJiBvTWRsLmV4YWN0bWF0Y2guaW5kZXhPZihjYXRlZ29yeSkgPj0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgIG9SdWxlLmV4YWN0T25seSA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpbnNlcnRSdWxlSWZOb3RQcmVzZW50KG9Nb2RlbC5tUnVsZXMsb1J1bGUsIG9Nb2RlbC5zZWVuUnVsZXMpO1xyXG4gICAgICAgICAgICAgICAgaWYgKG9NZGxEYXRhLnN5bm9ueW1zICYmIG9NZGxEYXRhLnN5bm9ueW1zW2NhdGVnb3J5XSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGFkZFN5bm9ueW1zKG9NZGxEYXRhLnN5bm9ueW1zW2NhdGVnb3J5XSwgY2F0ZWdvcnksIHNTdHJpbmcsIG9Nb2RlbC5tUnVsZXMsIG9Nb2RlbC5zZWVuUnVsZXMpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKG9FbnRyeS5zeW5vbnltcyAmJiBvRW50cnkuc3lub255bXNbY2F0ZWdvcnldKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgYWRkU3lub255bXMob0VudHJ5LnN5bm9ueW1zW2NhdGVnb3J5XSwgY2F0ZWdvcnksIHNTdHJpbmcsIG9Nb2RlbC5tUnVsZXMsIG9Nb2RlbC5zZWVuUnVsZXMpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTtcclxufVxyXG5cclxuZnVuY3Rpb24gbG9hZE1vZGVsKG1vZGVsUGF0aCA6IHN0cmluZywgc01vZGVsTmFtZTogc3RyaW5nLCBvTW9kZWw6IElNYXRjaC5JTW9kZWxzKSB7XHJcbiAgICBkZWJ1Z2xvZyhcIiBsb2FkaW5nIFwiICsgc01vZGVsTmFtZSArIFwiIC4uLi5cIik7XHJcbiAgICB2YXIgbWRsID0gZnMucmVhZEZpbGVTeW5jKCcuLycgKyBtb2RlbFBhdGggKyAnLycgKyBzTW9kZWxOYW1lICsgXCIubW9kZWwuanNvblwiLCAndXRmLTgnKTtcclxuICAgIHZhciBvTWRsID0gSlNPTi5wYXJzZShtZGwpIGFzIElNb2RlbDtcclxuXHJcbiAgICB2YXIgY2F0ZWdvcnlEZXNjcmliZWRNYXAgPSB7fSBhcyB7IFtrZXk6IHN0cmluZ10gOiBJTWF0Y2guSUNhdGVnb3J5RGVzYyB9O1xyXG4gICAgb01kbC5jYXRlZ29yeURlc2NyaWJlZCA9IFtdO1xyXG4gICAgLy8gcmVjdGlmeSBjYXRlZ29yeVxyXG4gICAgb01kbC5jYXRlZ29yeSA9IG9NZGwuY2F0ZWdvcnkubWFwKGZ1bmN0aW9uKGNhdCA6IGFueSkge1xyXG4gICAgICAgIGlmKHR5cGVvZiBjYXQgPT09IFwic3RyaW5nXCIpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGNhdDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYodHlwZW9mIGNhdC5uYW1lICE9PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiTWlzc2luZyBuYW1lIGluIG9iamVjdCB0eXBlZCBjYXRlZ29yeSBpbiBcIiArIEpTT04uc3RyaW5naWZ5KGNhdCkgKyBcIiBpbiBtb2RlbCBcIiArIHNNb2RlbE5hbWUgKTtcclxuICAgICAgICAgICAgcHJvY2Vzcy5leGl0KC0xKTtcclxuICAgICAgICAgICAgLy90aHJvdyBuZXcgRXJyb3IoJ0RvbWFpbiAnICsgb01kbC5kb21haW4gKyAnIGFscmVhZHkgbG9hZGVkIHdoaWxlIGxvYWRpbmcgJyArIHNNb2RlbE5hbWUgKyAnPycpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjYXRlZ29yeURlc2NyaWJlZE1hcFtjYXQubmFtZV0gPSBjYXQ7XHJcbiAgICAgICAgb01kbC5jYXRlZ29yeURlc2NyaWJlZC5wdXNoKGNhdCk7XHJcbiAgICAgICAgcmV0dXJuIGNhdC5uYW1lO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaWYgKG9Nb2RlbC5kb21haW5zLmluZGV4T2Yob01kbC5kb21haW4pID49IDApIHtcclxuICAgICAgICBkZWJ1Z2xvZyhcIioqKioqKioqKioqaGVyZSBtZGxcIiArIEpTT04uc3RyaW5naWZ5KG9NZGwsIHVuZGVmaW5lZCwgMikpO1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcignRG9tYWluICcgKyBvTWRsLmRvbWFpbiArICcgYWxyZWFkeSBsb2FkZWQgd2hpbGUgbG9hZGluZyAnICsgc01vZGVsTmFtZSArICc/Jyk7XHJcbiAgICB9XHJcbiAgICAvLyBjaGVjayBwcm9wZXJ0aWVzIG9mIG1vZGVsXHJcbiAgICBPYmplY3Qua2V5cyhvTWRsKS5zb3J0KCkuZm9yRWFjaChmdW5jdGlvbihzUHJvcGVydHkpIHtcclxuICAgICAgICBpZihBUlJfTU9ERUxfUFJPUEVSVElFUy5pbmRleE9mKHNQcm9wZXJ0eSkgPCAwKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTW9kZWwgcHJvcGVydHkgXCInICsgc1Byb3BlcnR5ICsgJ1wiIG5vdCBhIGtub3duIG1vZGVsIHByb3BlcnR5IGluIG1vZGVsIG9mIGRvbWFpbiAnICsgb01kbC5kb21haW4gKyAnICcpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG5cclxuXHJcbiAgICBvTW9kZWwuZnVsbC5kb21haW5bb01kbC5kb21haW5dID0geyBkZXNjcmlwdGlvbiA6IG9NZGwuZGVzY3JpcHRpb24sXHJcbiAgICBjYXRlZ29yaWVzIDogY2F0ZWdvcnlEZXNjcmliZWRNYXAgfTtcclxuXHJcblxyXG4gICAgLy8gY2hlY2sgdGhhdCBtZW1iZXJzIG9mIHdvcmRpbmRleCBhcmUgaW4gY2F0ZWdvcmllcyxcclxuICAgIG9NZGwud29yZGluZGV4ID0gb01kbC53b3JkaW5kZXggfHwgW107XHJcbiAgICBvTWRsLndvcmRpbmRleC5mb3JFYWNoKGZ1bmN0aW9uKHNXb3JkSW5kZXgpIHtcclxuICAgICAgICBpZihvTWRsLmNhdGVnb3J5LmluZGV4T2Yoc1dvcmRJbmRleCkgPCAwKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTW9kZWwgd29yZGluZGV4IFwiJyArIHNXb3JkSW5kZXggKyAnXCIgbm90IGEgY2F0ZWdvcnkgb2YgZG9tYWluICcgKyBvTWRsLmRvbWFpbiArICcgJyk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICBvTWRsLmV4YWN0bWF0Y2ggPSBvTWRsLmV4YWN0bWF0Y2ggfHwgW107XHJcbiAgICBvTWRsLmV4YWN0bWF0Y2guZm9yRWFjaChmdW5jdGlvbihzRXhhY3RNYXRjaCkge1xyXG4gICAgICAgIGlmKG9NZGwuY2F0ZWdvcnkuaW5kZXhPZihzRXhhY3RNYXRjaCkgPCAwKSB7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTW9kZWwgZXhhY3RtYXRjaCBcIicgKyBzRXhhY3RNYXRjaCArICdcIiBub3QgYSBjYXRlZ29yeSBvZiBkb21haW4gJyArIG9NZGwuZG9tYWluICsgJyAnKTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuXHJcblxyXG4gICAgLy8gYWRkIHJlbGF0aW9uIGRvbWFpbiAtPiBjYXRlZ29yeVxyXG4gICAgdmFyIGRvbWFpblN0ciA9IE1ldGFGLkRvbWFpbihvTWRsLmRvbWFpbikudG9GdWxsU3RyaW5nKCk7XHJcbiAgICB2YXIgcmVsYXRpb25TdHIgPSBNZXRhRi5SZWxhdGlvbihNZXRhLlJFTEFUSU9OX2hhc0NhdGVnb3J5KS50b0Z1bGxTdHJpbmcoKTtcclxuICAgIHZhciByZXZlcnNlUmVsYXRpb25TdHIgPSBNZXRhRi5SZWxhdGlvbihNZXRhLlJFTEFUSU9OX2lzQ2F0ZWdvcnlPZikudG9GdWxsU3RyaW5nKCk7XHJcbiAgICBvTWRsLmNhdGVnb3J5LmZvckVhY2goZnVuY3Rpb24oc0NhdGVnb3J5KSB7XHJcblxyXG4gICAgICAgIHZhciBDYXRlZ29yeVN0cmluZyA9IE1ldGFGLkNhdGVnb3J5KHNDYXRlZ29yeSkudG9GdWxsU3RyaW5nKCk7XHJcbiAgICAgICAgb01vZGVsLm1ldGEudDNbZG9tYWluU3RyXSA9IG9Nb2RlbC5tZXRhLnQzW2RvbWFpblN0cl0gfHwge307XHJcbiAgICAgICAgb01vZGVsLm1ldGEudDNbZG9tYWluU3RyXVtyZWxhdGlvblN0cl0gPSBvTW9kZWwubWV0YS50M1tkb21haW5TdHJdW3JlbGF0aW9uU3RyXSB8fCB7fTtcclxuICAgICAgICBvTW9kZWwubWV0YS50M1tkb21haW5TdHJdW3JlbGF0aW9uU3RyXVtDYXRlZ29yeVN0cmluZ10gID0ge307XHJcblxyXG4gICAgICAgIG9Nb2RlbC5tZXRhLnQzW0NhdGVnb3J5U3RyaW5nXSA9IG9Nb2RlbC5tZXRhLnQzW0NhdGVnb3J5U3RyaW5nXSB8fCB7fTtcclxuICAgICAgICBvTW9kZWwubWV0YS50M1tDYXRlZ29yeVN0cmluZ11bcmV2ZXJzZVJlbGF0aW9uU3RyXSA9IG9Nb2RlbC5tZXRhLnQzW0NhdGVnb3J5U3RyaW5nXVtyZXZlcnNlUmVsYXRpb25TdHJdIHx8IHt9O1xyXG4gICAgICAgIG9Nb2RlbC5tZXRhLnQzW0NhdGVnb3J5U3RyaW5nXVtyZXZlcnNlUmVsYXRpb25TdHJdW2RvbWFpblN0cl0gID0ge307XHJcblxyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gYWRkIGEgcHJlY2ljZSBkb21haW4gbWF0Y2hydWxlXHJcbiAgICBpbnNlcnRSdWxlSWZOb3RQcmVzZW50KG9Nb2RlbC5tUnVsZXMsIHtcclxuICAgICAgICAgICAgY2F0ZWdvcnk6IFwiZG9tYWluXCIsXHJcbiAgICAgICAgICAgIG1hdGNoZWRTdHJpbmc6IG9NZGwuZG9tYWluLFxyXG4gICAgICAgICAgICB0eXBlOiBJTWF0Y2guRW51bVJ1bGVUeXBlLldPUkQsXHJcbiAgICAgICAgICAgIHdvcmQ6IG9NZGwuZG9tYWluLFxyXG4gICAgICAgICAgICBfcmFua2luZzogMC45NVxyXG4gICAgICAgIH0sIG9Nb2RlbC5zZWVuUnVsZXMpO1xyXG5cclxuICAgIC8vIGNoZWNrIHRoZSB0b29sXHJcbiAgICBpZihvTWRsLnRvb2wgJiYgb01kbC50b29sLnJlcXVpcmVzKSB7XHJcbiAgICAgICAgdmFyIHJlcXVpcmVzID0gT2JqZWN0LmtleXMob01kbC50b29sLnJlcXVpcmVzIHx8IHt9KTtcclxuICAgICAgICB2YXIgZGlmZiA9IF8uZGlmZmVyZW5jZShyZXF1aXJlcywgb01kbC5jYXRlZ29yeSk7XHJcbiAgICAgICAgICAgIGlmKGRpZmYubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coYCAke29NZGwuZG9tYWlufSA6IFVua293biBjYXRlZ29yeSBpbiByZXF1aXJlcyBvZiB0b29sOiBcImAgKyBkaWZmLmpvaW4oJ1wiJykgKyAnXCInKTtcclxuICAgICAgICAgICAgICAgIHByb2Nlc3MuZXhpdCgtMSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB2YXIgb3B0aW9uYWwgPSBPYmplY3Qua2V5cyhvTWRsLnRvb2wub3B0aW9uYWwpO1xyXG4gICAgICAgIGRpZmYgPSBfLmRpZmZlcmVuY2Uob3B0aW9uYWwsIG9NZGwuY2F0ZWdvcnkpO1xyXG4gICAgICAgICAgICBpZihkaWZmLmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKGAgJHtvTWRsLmRvbWFpbn0gOiBVbmtvd24gY2F0ZWdvcnkgb3B0aW9uYWwgb2YgdG9vbDogXCJgICsgZGlmZi5qb2luKCdcIicpICsgJ1wiJyk7XHJcbiAgICAgICAgICAgICAgICBwcm9jZXNzLmV4aXQoLTEpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgT2JqZWN0LmtleXMob01kbC50b29sLnNldHMgfHwge30pLmZvckVhY2goZnVuY3Rpb24oc2V0SUQpIHtcclxuICAgICAgICAgICAgdmFyIGRpZmYgPSBfLmRpZmZlcmVuY2Uob01kbC50b29sLnNldHNbc2V0SURdLnNldCwgb01kbC5jYXRlZ29yeSk7XHJcbiAgICAgICAgICAgIGlmKGRpZmYubGVuZ3RoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coYCAke29NZGwuZG9tYWlufSA6IFVua293biBjYXRlZ29yeSBpbiBzZXRJZCAke3NldElEfSBvZiB0b29sOiBcImAgKyBkaWZmLmpvaW4oJ1wiJykgKyAnXCInKTtcclxuICAgICAgICAgICAgICAgIHByb2Nlc3MuZXhpdCgtMSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gZXh0cmFjdCB0b29scyBhbiBhZGQgdG8gdG9vbHM6XHJcbiAgICAgICAgb01vZGVsLnRvb2xzLmZpbHRlcihmdW5jdGlvbiAob0VudHJ5KSB7XHJcbiAgICAgICAgICAgIGlmIChvRW50cnkubmFtZSA9PT0gKG9NZGwudG9vbCAmJiBvTWRsLnRvb2wubmFtZSkpIHtcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiVG9vbCBcIiArIG9NZGwudG9vbC5uYW1lICsgXCIgYWxyZWFkeSBwcmVzZW50IHdoZW4gbG9hZGluZyBcIiArIHNNb2RlbE5hbWUpO1xyXG4gICAgICAgICAgICAgICAgLy90aHJvdyBuZXcgRXJyb3IoJ0RvbWFpbiBhbHJlYWR5IGxvYWRlZD8nKTtcclxuICAgICAgICAgICAgICAgIHByb2Nlc3MuZXhpdCgtMSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgb01kbC50b29saGlkZGVuID0gdHJ1ZTtcclxuICAgICAgICBvTWRsLnRvb2wucmVxdWlyZXMgPSB7IFwiaW1wb3NzaWJsZVwiIDoge319O1xyXG4gICAgfVxyXG4gICAgLy8gYWRkIHRoZSB0b29sIG5hbWUgYXMgcnVsZSB1bmxlc3MgaGlkZGVuXHJcbiAgICBpZiAoIW9NZGwudG9vbGhpZGRlbiAmJiBvTWRsLnRvb2wgJiYgb01kbC50b29sLm5hbWUpIHtcclxuICAgICAgICBpbnNlcnRSdWxlSWZOb3RQcmVzZW50KG9Nb2RlbC5tUnVsZXMsIHtcclxuICAgICAgICAgICAgY2F0ZWdvcnk6IFwidG9vbFwiLFxyXG4gICAgICAgICAgICBtYXRjaGVkU3RyaW5nOiBvTWRsLnRvb2wubmFtZSxcclxuICAgICAgICAgICAgdHlwZTogSU1hdGNoLkVudW1SdWxlVHlwZS5XT1JELFxyXG4gICAgICAgICAgICB3b3JkOiBvTWRsLnRvb2wubmFtZSxcclxuICAgICAgICAgICAgX3Jhbmtpbmc6IDAuOTVcclxuICAgICAgICB9LCBvTW9kZWwuc2VlblJ1bGVzKTtcclxuICAgIH07XHJcbiAgICBpZiAob01kbC5zeW5vbnltcyAmJiBvTWRsLnN5bm9ueW1zW1widG9vbFwiXSkge1xyXG4gICAgICAgIGFkZFN5bm9ueW1zKG9NZGwuc3lub255bXNbXCJ0b29sXCJdLCBcInRvb2xcIiwgb01kbC50b29sLm5hbWUsIG9Nb2RlbC5tUnVsZXMsIG9Nb2RlbC5zZWVuUnVsZXMpO1xyXG4gICAgfTtcclxuICAgIGlmIChvTWRsLnN5bm9ueW1zKSB7XHJcbiAgICAgICAgT2JqZWN0LmtleXMob01kbC5zeW5vbnltcykuZm9yRWFjaChmdW5jdGlvbiAoc3N5bmtleSkge1xyXG4gICAgICAgICAgICBpZiAob01kbC5jYXRlZ29yeS5pbmRleE9mKHNzeW5rZXkpID49IDAgJiYgc3N5bmtleSAhPT0gXCJ0b29sXCIpIHtcclxuICAgICAgICAgICAgICAgIGlmIChvTW9kZWwuZnVsbC5kb21haW5bb01kbC5kb21haW5dLmNhdGVnb3JpZXNbc3N5bmtleV0pICB7XHJcbiAgICAgICAgICAgICAgICAgICBvTW9kZWwuZnVsbC5kb21haW5bb01kbC5kb21haW5dLmNhdGVnb3JpZXNbc3N5bmtleV0uc3lub255bXMgPSBvTWRsLnN5bm9ueW1zW3NzeW5rZXldO1xyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgICAgIGFkZFN5bm9ueW1zKG9NZGwuc3lub255bXNbc3N5bmtleV0sIFwiY2F0ZWdvcnlcIiwgc3N5bmtleSwgb01vZGVsLm1SdWxlcywgb01vZGVsLnNlZW5SdWxlcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIG9Nb2RlbC5kb21haW5zLnB1c2gob01kbC5kb21haW4pO1xyXG4gICAgaWYob01kbC50b29sLm5hbWUpIHtcclxuICAgICAgb01vZGVsLnRvb2xzLnB1c2gob01kbC50b29sKTtcclxuICAgIH1cclxuICAgIG9Nb2RlbC5jYXRlZ29yeSA9IG9Nb2RlbC5jYXRlZ29yeS5jb25jYXQob01kbC5jYXRlZ29yeSk7XHJcbiAgICBvTW9kZWwuY2F0ZWdvcnkuc29ydCgpO1xyXG4gICAgb01vZGVsLmNhdGVnb3J5ID0gb01vZGVsLmNhdGVnb3J5LmZpbHRlcihmdW5jdGlvbiAoc3RyaW5nLCBpbmRleCkge1xyXG4gICAgICAgIHJldHVybiBvTW9kZWwuY2F0ZWdvcnlbaW5kZXhdICE9PSBvTW9kZWwuY2F0ZWdvcnlbaW5kZXggKyAxXTtcclxuICAgIH0pO1xyXG4gICAgbG9hZE1vZGVsRGF0YShtb2RlbFBhdGgsIG9NZGwsIHNNb2RlbE5hbWUsIG9Nb2RlbCk7XHJcbn0gLy8gbG9hZG1vZGVsXHJcblxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHNwbGl0UnVsZXMocnVsZXMgOiBJTWF0Y2gubVJ1bGVbXSkgOiBJTWF0Y2guU3BsaXRSdWxlcyB7XHJcbiAgICB2YXIgcmVzID0ge307XHJcbiAgICB2YXIgbm9uV29yZFJ1bGVzID0gW107XHJcbiAgICBydWxlcy5mb3JFYWNoKGZ1bmN0aW9uKHJ1bGUpIHtcclxuICAgICAgICBpZihydWxlLnR5cGUgPT09IElNYXRjaC5FbnVtUnVsZVR5cGUuV09SRCkge1xyXG4gICAgICAgICAgICBpZighcnVsZS5sb3dlcmNhc2V3b3JkKSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJSdWxlIGhhcyBubyBtZW1iZXIgbG93ZXJjYXNld29yZFwiICsgSlNPTi5zdHJpbmdpZnkocnVsZSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHJlc1tydWxlLmxvd2VyY2FzZXdvcmRdID0gcmVzW3J1bGUubG93ZXJjYXNld29yZF0gfHwgW107XHJcbiAgICAgICAgICAgIHJlc1tydWxlLmxvd2VyY2FzZXdvcmRdLnB1c2gocnVsZSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgbm9uV29yZFJ1bGVzLnB1c2gocnVsZSk7XHJcbiAgICAgICAgfVxyXG4gICAgfSk7XHJcbiAgICByZXR1cm4ge1xyXG4gICAgICAgIHdvcmRNYXA6IHJlcyxcclxuICAgICAgICBub25Xb3JkUnVsZXMgOiBub25Xb3JkUnVsZXMsXHJcbiAgICAgICAgYWxsUnVsZXMgOiBydWxlc1xyXG4gICAgfTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGxvYWRNb2RlbHMobW9kZWxQYXRoPyA6IHN0cmluZykgOiBJTWF0Y2guSU1vZGVscyB7XHJcbiAgICB2YXIgb01vZGVsOiBJTWF0Y2guSU1vZGVscztcclxuICAgIG9Nb2RlbCA9IHtcclxuICAgICAgICBmdWxsIDogeyBkb21haW4gOiB7fX0sXHJcbiAgICAgICAgZG9tYWluczogW10sXHJcbiAgICAgICAgdG9vbHM6IFtdLFxyXG4gICAgICAgIHJ1bGVzIDogdW5kZWZpbmVkLFxyXG4gICAgICAgIGNhdGVnb3J5OiBbXSxcclxuICAgICAgICBvcGVyYXRvcnMgOiB7fSxcclxuICAgICAgICBtUnVsZXM6IFtdLFxyXG4gICAgICAgIHNlZW5SdWxlcyA6IHt9LFxyXG4gICAgICAgIHJlY29yZHM6IFtdLFxyXG4gICAgICAgIG1ldGEgOiB7IHQzIDoge30gfVxyXG4gICAgfVxyXG4gICAgbW9kZWxQYXRoID0gbW9kZWxQYXRoIHx8IGVudk1vZGVsUGF0aDtcclxuICAgIHZhciBzbWRscyA9IGZzLnJlYWRGaWxlU3luYygnLi8nICsgbW9kZWxQYXRoICsgJy9tb2RlbHMuanNvbicsICd1dGYtOCcpO1xyXG4gICAgdmFyIG1kbHMgPSBKU09OLnBhcnNlKFwiXCIgKyBzbWRscyk7XHJcbiAgICBtZGxzLmZvckVhY2goZnVuY3Rpb24gKHNNb2RlbE5hbWUpIHtcclxuICAgICAgICBsb2FkTW9kZWwobW9kZWxQYXRoLCBzTW9kZWxOYW1lLCBvTW9kZWwpXHJcbiAgICB9KTtcclxuXHJcbiAgICAvLyBhZGQgdGhlIGNhdGVnb3JpZXMgdG8gdGhlIG1vZGVsOlxyXG4gICAgb01vZGVsLmNhdGVnb3J5LmZvckVhY2goZnVuY3Rpb24gKGNhdGVnb3J5KSB7XHJcbiAgICAgICAgaW5zZXJ0UnVsZUlmTm90UHJlc2VudChvTW9kZWwubVJ1bGVzLCB7XHJcbiAgICAgICAgICAgIGNhdGVnb3J5OiBcImNhdGVnb3J5XCIsXHJcbiAgICAgICAgICAgIG1hdGNoZWRTdHJpbmc6IGNhdGVnb3J5LFxyXG4gICAgICAgICAgICB0eXBlOiBJTWF0Y2guRW51bVJ1bGVUeXBlLldPUkQsXHJcbiAgICAgICAgICAgIHdvcmQ6IGNhdGVnb3J5LFxyXG4gICAgICAgICAgICBsb3dlcmNhc2V3b3JkOiBjYXRlZ29yeS50b0xvd2VyQ2FzZSgpLFxyXG4gICAgICAgICAgICBfcmFua2luZzogMC45NVxyXG4gICAgICAgIH0sIG9Nb2RlbC5zZWVuUnVsZXMpO1xyXG4gICAgfSk7XHJcblxyXG4gICAgLy8gYWRkIHRoZSBkb21haW4gbWV0YSBydWxlXHJcbiAgICBpbnNlcnRSdWxlSWZOb3RQcmVzZW50KG9Nb2RlbC5tUnVsZXMsIHtcclxuICAgICAgICAgICAgY2F0ZWdvcnk6IFwibWV0YVwiLFxyXG4gICAgICAgICAgICBtYXRjaGVkU3RyaW5nOiBcImRvbWFpblwiLFxyXG4gICAgICAgICAgICB0eXBlOiBJTWF0Y2guRW51bVJ1bGVUeXBlLldPUkQsXHJcbiAgICAgICAgICAgIHdvcmQ6IFwiZG9tYWluXCIsXHJcbiAgICAgICAgICAgIF9yYW5raW5nOiAwLjk1XHJcbiAgICAgICAgfSwgb01vZGVsLnNlZW5SdWxlcyk7XHJcblxyXG5cclxuXHJcbiAgICAvL2FkZCBhIGZpbGxlciBydWxlXHJcbiAgICB2YXIgc2ZpbGxlcnMgPSBmcy5yZWFkRmlsZVN5bmMoJy4vJyArIG1vZGVsUGF0aCArICcvZmlsbGVyLmpzb24nLCAndXRmLTgnKTtcclxuICAgIHZhciBmaWxsZXJzID0gSlNPTi5wYXJzZShzZmlsbGVycyk7XHJcbiAgICB2YXIgcmUgPSBcIl4oKFwiICsgZmlsbGVycy5qb2luKFwiKXwoXCIpICsgXCIpKSRcIjtcclxuICAgIG9Nb2RlbC5tUnVsZXMucHVzaCh7XHJcbiAgICAgICAgY2F0ZWdvcnk6IFwiZmlsbGVyXCIsXHJcbiAgICAgICAgdHlwZTogSU1hdGNoLkVudW1SdWxlVHlwZS5SRUdFWFAsXHJcbiAgICAgICAgcmVnZXhwOiBuZXcgUmVnRXhwKHJlLCBcImlcIiksXHJcbiAgICAgICAgbWF0Y2hlZFN0cmluZzogXCJmaWxsZXJcIixcclxuICAgICAgICBfcmFua2luZzogMC45XHJcbiAgICB9KTtcclxuXHJcbiAgICAvL2FkZCBvcGVyYXRvcnNcclxuICAgIHZhciBzT3BlcmF0b3JzID0gZnMucmVhZEZpbGVTeW5jKCcuL3Jlc291cmNlcy9tb2RlbC9vcGVyYXRvcnMuanNvbicsICd1dGYtOCcpO1xyXG4gICAgdmFyIG9wZXJhdG9ycyA9IEpTT04ucGFyc2Uoc09wZXJhdG9ycyk7XHJcbiAgICBPYmplY3Qua2V5cyhvcGVyYXRvcnMub3BlcmF0b3JzKS5mb3JFYWNoKGZ1bmN0aW9uKG9wZXJhdG9yKSB7XHJcbiAgICAgICAgaWYoSU1hdGNoLmFPcGVyYXRvck5hbWVzLmluZGV4T2Yob3BlcmF0b3IpIDwgMCkge1xyXG4gICAgICAgICAgICBkZWJ1Z2xvZyhcInVua25vd24gb3BlcmF0b3IgXCIgKyBvcGVyYXRvcik7XHJcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcInVua25vd24gb3BlcmF0b3IgXCIgKyBvcGVyYXRvcik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIG9Nb2RlbC5vcGVyYXRvcnNbb3BlcmF0b3JdID0gb3BlcmF0b3JzLm9wZXJhdG9yc1tvcGVyYXRvcl07XHJcbiAgICAgICAgb01vZGVsLm9wZXJhdG9yc1tvcGVyYXRvcl0ub3BlcmF0b3IgPSA8SU1hdGNoLk9wZXJhdG9yTmFtZT4gb3BlcmF0b3I7XHJcbiAgICAgICAgT2JqZWN0LmZyZWV6ZShvTW9kZWwub3BlcmF0b3JzW29wZXJhdG9yXSk7XHJcbiAgICAgICAgdmFyIHdvcmQgPSBvcGVyYXRvcjtcclxuICAgICAgICBpbnNlcnRSdWxlSWZOb3RQcmVzZW50KG9Nb2RlbC5tUnVsZXMsIHtcclxuICAgICAgICAgICAgY2F0ZWdvcnk6IFwib3BlcmF0b3JcIixcclxuICAgICAgICAgICAgd29yZCA6IHdvcmQudG9Mb3dlckNhc2UoKSxcclxuICAgICAgICAgICAgbG93ZXJjYXNld29yZCA6IHdvcmQudG9Mb3dlckNhc2UoKSxcclxuICAgICAgICAgICAgdHlwZTogSU1hdGNoLkVudW1SdWxlVHlwZS5XT1JELFxyXG4gICAgICAgICAgICBtYXRjaGVkU3RyaW5nIDogd29yZCxcclxuICAgICAgICAgICAgX3Jhbmtpbmc6IDAuOVxyXG4gICAgICAgIH0sIG9Nb2RlbC5zZWVuUnVsZXMpO1xyXG4gICAgICAgIC8vIGFkZCBhbGwgc3lub255bXNcclxuICAgICAgICBpZihvcGVyYXRvcnMuc3lub255bXNbb3BlcmF0b3JdKSB7XHJcbiAgICAgICAgICAgIE9iamVjdC5rZXlzKG9wZXJhdG9ycy5zeW5vbnltc1tvcGVyYXRvcl0pLmZvckVhY2goZnVuY3Rpb24oc3lub255bSkge1xyXG4gICAgICAgICAgICAgICAgaW5zZXJ0UnVsZUlmTm90UHJlc2VudChvTW9kZWwubVJ1bGVzLHtcclxuICAgICAgICAgICAgICAgICAgICBjYXRlZ29yeTogXCJvcGVyYXRvclwiLFxyXG4gICAgICAgICAgICAgICAgICAgIHdvcmQgOiBzeW5vbnltLnRvTG93ZXJDYXNlKCksXHJcbiAgICAgICAgICAgICAgICAgICAgbG93ZXJjYXNld29yZCA6IHN5bm9ueW0udG9Mb3dlckNhc2UoKSxcclxuICAgICAgICAgICAgICAgICAgICB0eXBlOiBJTWF0Y2guRW51bVJ1bGVUeXBlLldPUkQsXHJcbiAgICAgICAgICAgICAgICAgICAgbWF0Y2hlZFN0cmluZyA6IG9wZXJhdG9yLFxyXG4gICAgICAgICAgICAgICAgICAgIF9yYW5raW5nOiAwLjlcclxuICAgICAgICAgICAgICAgIH0sIG9Nb2RlbC5zZWVuUnVsZXMpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICB9KTtcclxuICAgIC8qXHJcbiAgICAgICAgfSlcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgY2F0ZWdvcnk6IFwiZmlsbGVyXCIsXHJcbiAgICAgICAgICB0eXBlOiAxLFxyXG4gICAgICAgICAgcmVnZXhwOiAvXigoc3RhcnQpfChzaG93KXwoZnJvbSl8KGluKSkkL2ksXHJcbiAgICAgICAgICBtYXRjaGVkU3RyaW5nOiBcImZpbGxlclwiLFxyXG4gICAgICAgICAgX3Jhbmtpbmc6IDAuOVxyXG4gICAgICAgIH0sXHJcbiAgICAqL1xyXG4gICAgb01vZGVsLm1SdWxlcyA9IG9Nb2RlbC5tUnVsZXMuc29ydChJbnB1dEZpbHRlclJ1bGVzLmNtcE1SdWxlKTtcclxuICAgIG9Nb2RlbC5ydWxlcyA9IHNwbGl0UnVsZXMob01vZGVsLm1SdWxlcyk7XHJcbiAgICBvTW9kZWwudG9vbHMgPSBvTW9kZWwudG9vbHMuc29ydChUb29scy5jbXBUb29scyk7XHJcbiAgICBkZWxldGUgb01vZGVsLnNlZW5SdWxlcztcclxuICAgIHJldHVybiBvTW9kZWw7XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBzb3J0Q2F0ZWdvcmllc0J5SW1wb3J0YW5jZSggbWFwIDoge1trZXkgOiBzdHJpbmddIDogSU1hdGNoLklDYXRlZ29yeURlc2MgfSwgY2F0cyA6IHN0cmluZ1tdKSA6IHN0cmluZ1tdIHtcclxuICAgIHZhciByZXMgPSBjYXRzLnNsaWNlKDApO1xyXG4gICAgcmVzLnNvcnQocmFua0NhdGVnb3J5QnlJbXBvcnRhbmNlLmJpbmQodW5kZWZpbmVkLG1hcCkpO1xyXG4gICAgcmV0dXJuIHJlcztcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHJhbmtDYXRlZ29yeUJ5SW1wb3J0YW5jZShtYXAgOiB7W2tleSA6IHN0cmluZ10gOiBJTWF0Y2guSUNhdGVnb3J5RGVzYyB9LCBjYXRhIDogc3RyaW5nLCBjYXRiIDogc3RyaW5nKSA6IG51bWJlciB7XHJcbiAgICB2YXIgY2F0QURlc2MgPSBtYXBbY2F0YV07XHJcbiAgICB2YXIgY2F0QkRlc2MgPSBtYXBbY2F0Yl07XHJcbiAgICBpZiAoY2F0YSA9PT0gY2F0Yikge1xyXG4gICAgICAgIHJldHVybiAwO1xyXG4gICAgfVxyXG4gICAgLy8gaWYgYSBpcyBiZWZvcmUgYiwgcmV0dXJuIC0xXHJcbiAgICBpZihjYXRBRGVzYyAmJiAhY2F0QkRlc2MpIHtcclxuICAgICAgICByZXR1cm4gLTE7XHJcbiAgICB9XHJcbiAgICBpZighY2F0QURlc2MgJiYgY2F0QkRlc2MpIHtcclxuICAgICAgICByZXR1cm4gKzE7XHJcbiAgICB9XHJcblxyXG4gICAgdmFyIHByaW9BID0gKGNhdEFEZXNjICYmIGNhdEFEZXNjLmltcG9ydGFuY2UpIHx8IDk5O1xyXG4gICAgdmFyIHByaW9CID0gKGNhdEJEZXNjICYmIGNhdEJEZXNjLmltcG9ydGFuY2UpIHx8IDk5O1xyXG4gICAgLy8gbG93ZXIgcHJpbyBnb2VzIHRvIGZyb250XHJcbiAgICB2YXIgciA9IHByaW9BIC0gcHJpb0I7XHJcbiAgICBpZihyKSB7XHJcbiAgICAgICAgcmV0dXJuIHI7XHJcbiAgICB9XHJcbiAgICByZXR1cm4gY2F0YS5sb2NhbGVDb21wYXJlKGNhdGIpO1xyXG59XHJcblxyXG5jb25zdCBNZXRhRiA9IE1ldGEuZ2V0TWV0YUZhY3RvcnkoKTtcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRPcGVyYXRvcihtZGw6IElNYXRjaC5JTW9kZWxzLCBvcGVyYXRvciA6IHN0cmluZykgOiBJTWF0Y2guSU9wZXJhdG9yIHtcclxuICAgIHJldHVybiBtZGwub3BlcmF0b3JzW29wZXJhdG9yXTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldFJlc3VsdEFzQXJyYXkobWRsIDogSU1hdGNoLklNb2RlbHMsIGEgOiBNZXRhLklNZXRhLCByZWwgOiBNZXRhLklNZXRhKSA6IE1ldGEuSU1ldGFbXSB7XHJcbiAgICBpZihyZWwudG9UeXBlKCkgIT09ICdyZWxhdGlvbicpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJleHBlY3QgcmVsYXRpb24gYXMgMm5kIGFyZ1wiKTtcclxuICAgIH1cclxuXHJcbiAgICB2YXIgcmVzID0gbWRsLm1ldGEudDNbYS50b0Z1bGxTdHJpbmcoKV0gJiZcclxuICAgIG1kbC5tZXRhLnQzW2EudG9GdWxsU3RyaW5nKCldW3JlbC50b0Z1bGxTdHJpbmcoKV07XHJcbiAgICBpZighcmVzKSB7XHJcbiAgICAgICAgcmV0dXJuIFtdO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKHJlcykuc29ydCgpLm1hcChNZXRhRi5wYXJzZUlNZXRhKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGdldENhdGVnb3JpZXNGb3JEb21haW4odGhlTW9kZWwgOiBJTWF0Y2guSU1vZGVscywgZG9tYWluIDogc3RyaW5nKSA6IHN0cmluZ1tdIHtcclxuICAgIGlmKHRoZU1vZGVsLmRvbWFpbnMuaW5kZXhPZihkb21haW4pIDwgMCkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkRvbWFpbiBcXFwiXCIgKyBkb21haW4gKyBcIlxcXCIgbm90IHBhcnQgb2YgbW9kZWxcIik7XHJcbiAgICB9XHJcbiAgICB2YXIgcmVzID0gZ2V0UmVzdWx0QXNBcnJheSh0aGVNb2RlbCwgTWV0YUYuRG9tYWluKGRvbWFpbiksIE1ldGFGLlJlbGF0aW9uKE1ldGEuUkVMQVRJT05faGFzQ2F0ZWdvcnkpKTtcclxuICAgIHJldHVybiBNZXRhLmdldFN0cmluZ0FycmF5KHJlcyk7XHJcbn1cclxuXHJcbi8qKlxyXG4gKiBSZXR1cm4gYWxsIGNhdGVnb3JpZXMgb2YgYSBkb21haW4gd2hpY2ggY2FuIGFwcGVhciBvbiBhIHdvcmQsXHJcbiAqIHRoZXNlIGFyZSB0eXBpY2FsbHkgdGhlIHdvcmRpbmRleCBkb21haW5zICsgZW50cmllcyBnZW5lcmF0ZWQgYnkgZ2VuZXJpYyBydWxlc1xyXG4gKlxyXG4gKiBUaGUgY3VycmVudCBpbXBsZW1lbnRhdGlvbiBpcyBhIHNpbXBsaWZpY2F0aW9uXHJcbiAqL1xyXG5leHBvcnQgZnVuY3Rpb24gZ2V0UG90ZW50aWFsV29yZENhdGVnb3JpZXNGb3JEb21haW4odGhlTW9kZWwgOiBJTWF0Y2guSU1vZGVscywgZG9tYWluIDogc3RyaW5nKSA6IHN0cmluZ1tdIHtcclxuICAgIC8vIHRoaXMgaXMgYSBzaW1wbGlmaWVkIHZlcnNpb25cclxuICAgIHJldHVybiBnZXRDYXRlZ29yaWVzRm9yRG9tYWluKHRoZU1vZGVsLCBkb21haW4pO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0RG9tYWluc0ZvckNhdGVnb3J5KHRoZU1vZGVsIDogSU1hdGNoLklNb2RlbHMsIGNhdGVnb3J5IDogc3RyaW5nKSA6IHN0cmluZ1tdIHtcclxuICAgIGlmKHRoZU1vZGVsLmNhdGVnb3J5LmluZGV4T2YoY2F0ZWdvcnkpIDwgMCkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkNhdGVnb3J5IFxcXCJcIiArIGNhdGVnb3J5ICsgXCJcXFwiIG5vdCBwYXJ0IG9mIG1vZGVsXCIpO1xyXG4gICAgfVxyXG4gICAgdmFyIHJlcyA9IGdldFJlc3VsdEFzQXJyYXkodGhlTW9kZWwsIE1ldGFGLkNhdGVnb3J5KGNhdGVnb3J5KSwgTWV0YUYuUmVsYXRpb24oTWV0YS5SRUxBVElPTl9pc0NhdGVnb3J5T2YpKTtcclxuICAgIHJldHVybiBNZXRhLmdldFN0cmluZ0FycmF5KHJlcyk7XHJcbn1cclxuXHJcblxyXG4gZXhwb3J0IGZ1bmN0aW9uIGdldEFsbFJlY29yZENhdGVnb3JpZXNGb3JUYXJnZXRDYXRlZ29yeShtb2RlbCA6IElNYXRjaC5JTW9kZWxzLCBjYXRlZ29yeSA6IHN0cmluZywgd29yZHNvbmx5IDogYm9vbGVhbikgOiB7W2tleTogc3RyaW5nXSA6IGJvb2xlYW59IHtcclxuICAgIHZhciByZXMgPSB7fTtcclxuICAgIC8vXHJcbiAgICB2YXIgZm4gPSB3b3Jkc29ubHkgPyBnZXRQb3RlbnRpYWxXb3JkQ2F0ZWdvcmllc0ZvckRvbWFpbiA6IGdldENhdGVnb3JpZXNGb3JEb21haW47XHJcbiAgICB2YXIgZG9tYWlucyA9IGdldERvbWFpbnNGb3JDYXRlZ29yeShtb2RlbCwgY2F0ZWdvcnkpO1xyXG4gICAgZG9tYWlucy5mb3JFYWNoKGZ1bmN0aW9uKGRvbWFpbikge1xyXG4gICAgICAgIGZuKG1vZGVsLCBkb21haW4pLmZvckVhY2goZnVuY3Rpb24od29yZGNhdCkge1xyXG4gICAgICAgICAgICByZXNbd29yZGNhdF0gPSB0cnVlO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcbiAgICBPYmplY3QuZnJlZXplKHJlcyk7XHJcbiAgICByZXR1cm4gcmVzO1xyXG4gfVxyXG5cclxuIGV4cG9ydCBmdW5jdGlvbiBnZXRBbGxSZWNvcmRDYXRlZ29yaWVzRm9yVGFyZ2V0Q2F0ZWdvcmllcyhtb2RlbCA6IElNYXRjaC5JTW9kZWxzLCBjYXRlZ29yaWVzIDogc3RyaW5nW10sIHdvcmRzb25seSA6IGJvb2xlYW4pIDoge1trZXk6IHN0cmluZ10gOiBib29sZWFufSB7XHJcbiAgICB2YXIgcmVzID0ge307XHJcbiAgICAvL1xyXG4gICAgdmFyIGZuID0gd29yZHNvbmx5ID8gZ2V0UG90ZW50aWFsV29yZENhdGVnb3JpZXNGb3JEb21haW4gOiBnZXRDYXRlZ29yaWVzRm9yRG9tYWluO1xyXG4gICAgdmFyIGRvbWFpbnMgPSB1bmRlZmluZWQ7XHJcbiAgICBjYXRlZ29yaWVzLmZvckVhY2goZnVuY3Rpb24oY2F0ZWdvcnkpIHtcclxuICAgICAgICB2YXIgY2F0ZG9tYWlucyA9IGdldERvbWFpbnNGb3JDYXRlZ29yeShtb2RlbCwgY2F0ZWdvcnkpXHJcbiAgICAgICAgaWYoIWRvbWFpbnMpIHtcclxuICAgICAgICAgICAgZG9tYWlucyA9IGNhdGRvbWFpbnM7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgZG9tYWlucyA9IF8uaW50ZXJzZWN0aW9uKGRvbWFpbnMsIGNhdGRvbWFpbnMpO1xyXG4gICAgICAgIH1cclxuICAgIH0pO1xyXG4gICAgaWYoZG9tYWlucy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ2NhdGVnb3JpZXMgJyArIFV0aWxzLmxpc3RUb1F1b3RlZENvbW1hQW5kKGNhdGVnb3JpZXMpICsgJyBoYXZlIG5vIGNvbW1vbiBkb21haW4uJylcclxuICAgIH1cclxuICAgIGRvbWFpbnMuZm9yRWFjaChmdW5jdGlvbihkb21haW4pIHtcclxuICAgICAgICBmbihtb2RlbCwgZG9tYWluKS5mb3JFYWNoKGZ1bmN0aW9uKHdvcmRjYXQpIHtcclxuICAgICAgICAgICAgcmVzW3dvcmRjYXRdID0gdHJ1ZTtcclxuICAgICAgICB9KTtcclxuICAgIH0pO1xyXG4gICAgT2JqZWN0LmZyZWV6ZShyZXMpO1xyXG4gICAgcmV0dXJuIHJlcztcclxuIH1cclxuXHJcblxyXG4iLCIvKipcbiAqIEZ1bmN0aW9uYWxpdHkgbWFuYWdpbmcgdGhlIG1hdGNoIG1vZGVsc1xuICpcbiAqIEBmaWxlXG4gKi9cblwidXNlIHN0cmljdFwiO1xudmFyIGRlYnVnID0gcmVxdWlyZSgnZGVidWcnKTtcbnZhciBkZWJ1Z2xvZyA9IGRlYnVnKCdtb2RlbCcpO1xudmFyIGxvZ2dlciA9IHJlcXVpcmUoJy4uL3V0aWxzL2xvZ2dlcicpO1xudmFyIGxvYWRsb2cgPSBsb2dnZXIubG9nZ2VyKCdtb2RlbGxvYWQnLCAnJyk7XG52YXIgSU1hdGNoID0gcmVxdWlyZSgnLi4vbWF0Y2gvaWZtYXRjaCcpO1xudmFyIElucHV0RmlsdGVyUnVsZXMgPSByZXF1aXJlKCcuLi9tYXRjaC9pbnB1dEZpbHRlclJ1bGVzJyk7XG52YXIgVG9vbHMgPSByZXF1aXJlKCcuLi9tYXRjaC90b29scycpO1xudmFyIGZzID0gcmVxdWlyZSgnZnMnKTtcbnZhciBNZXRhID0gcmVxdWlyZSgnLi9tZXRhJyk7XG52YXIgVXRpbHMgPSByZXF1aXJlKCcuLi91dGlscy91dGlscycpO1xudmFyIHByb2Nlc3MgPSByZXF1aXJlKCdwcm9jZXNzJyk7XG52YXIgXyA9IHJlcXVpcmUoJ2xvZGFzaCcpO1xuLyoqXG4gKiB0aGUgbW9kZWwgcGF0aCwgbWF5IGJlIGNvbnRyb2xsZWQgdmlhIGVudmlyb25tZW50IHZhcmlhYmxlXG4gKi9cbnZhciBlbnZNb2RlbFBhdGggPSBwcm9jZXNzLmVudltcIkFCT1RfTU9ERUxQQVRIXCJdIHx8IFwidGVzdG1vZGVsXCI7XG47XG52YXIgQVJSX01PREVMX1BST1BFUlRJRVMgPSBbXCJkb21haW5cIiwgXCJjYXRlZ29yeURlc2NyaWJlZFwiLCBcImRlc2NyaXB0aW9uXCIsIFwidG9vbFwiLCBcInRvb2xoaWRkZW5cIiwgXCJzeW5vbnltc1wiLCBcImNhdGVnb3J5XCIsIFwid29yZGluZGV4XCIsIFwiZXhhY3RtYXRjaFwiLCBcImhpZGRlblwiXTtcbmZ1bmN0aW9uIGFkZFN5bm9ueW1zKHN5bm9ueW1zLCBjYXRlZ29yeSwgc3lub255bUZvciwgbVJ1bGVzLCBzZWVuKSB7XG4gICAgc3lub255bXMuZm9yRWFjaChmdW5jdGlvbiAoc3luKSB7XG4gICAgICAgIHZhciBvUnVsZSA9IHtcbiAgICAgICAgICAgIGNhdGVnb3J5OiBjYXRlZ29yeSxcbiAgICAgICAgICAgIG1hdGNoZWRTdHJpbmc6IHN5bm9ueW1Gb3IsXG4gICAgICAgICAgICB0eXBlOiAwIC8qIFdPUkQgKi8sXG4gICAgICAgICAgICB3b3JkOiBzeW4sXG4gICAgICAgICAgICBfcmFua2luZzogMC45NVxuICAgICAgICB9O1xuICAgICAgICBkZWJ1Z2xvZyhcImluc2VydGluZyBzeW5vbnltXCIgKyBKU09OLnN0cmluZ2lmeShvUnVsZSkpO1xuICAgICAgICBpbnNlcnRSdWxlSWZOb3RQcmVzZW50KG1SdWxlcywgb1J1bGUsIHNlZW4pO1xuICAgIH0pO1xufVxuZnVuY3Rpb24gZ2V0UnVsZUtleShydWxlKSB7XG4gICAgcmV0dXJuIHJ1bGUubWF0Y2hlZFN0cmluZyArIFwiLXwtXCIgKyBydWxlLmNhdGVnb3J5ICsgXCIgLXwtIFwiICsgcnVsZS50eXBlICsgXCIgLXwtIFwiICsgcnVsZS53b3JkICsgXCIgXCI7XG59XG5mdW5jdGlvbiBpbnNlcnRSdWxlSWZOb3RQcmVzZW50KG1SdWxlcywgcnVsZSwgc2VlblJ1bGVzKSB7XG4gICAgaWYgKHJ1bGUudHlwZSAhPT0gMCAvKiBXT1JEICovKSB7XG4gICAgICAgIG1SdWxlcy5wdXNoKHJ1bGUpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmICgocnVsZS53b3JkID09PSB1bmRlZmluZWQpIHx8IChydWxlLm1hdGNoZWRTdHJpbmcgPT09IHVuZGVmaW5lZCkpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdpbGxlZ2FsIHJ1bGUnICsgSlNPTi5zdHJpbmdpZnkocnVsZSwgdW5kZWZpbmVkLCAyKSk7XG4gICAgfVxuICAgIHZhciByID0gZ2V0UnVsZUtleShydWxlKTtcbiAgICBydWxlLmxvd2VyY2FzZXdvcmQgPSBydWxlLndvcmQudG9Mb3dlckNhc2UoKTtcbiAgICBpZiAoc2VlblJ1bGVzW3JdKSB7XG4gICAgICAgIGRlYnVnbG9nKFwiQXR0ZW1wdGluZyB0byBpbnNlcnQgZHVwbGljYXRlXCIgKyBKU09OLnN0cmluZ2lmeShydWxlLCB1bmRlZmluZWQsIDIpKTtcbiAgICAgICAgdmFyIGR1cGxpY2F0ZXMgPSBzZWVuUnVsZXNbcl0uZmlsdGVyKGZ1bmN0aW9uIChvRW50cnkpIHtcbiAgICAgICAgICAgIHJldHVybiAwID09PSBJbnB1dEZpbHRlclJ1bGVzLmNvbXBhcmVNUnVsZUZ1bGwob0VudHJ5LCBydWxlKTtcbiAgICAgICAgfSk7XG4gICAgICAgIGlmIChkdXBsaWNhdGVzLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgIH1cbiAgICBzZWVuUnVsZXNbcl0gPSAoc2VlblJ1bGVzW3JdIHx8IFtdKTtcbiAgICBzZWVuUnVsZXNbcl0ucHVzaChydWxlKTtcbiAgICBpZiAocnVsZS53b3JkID09PSBcIlwiKSB7XG4gICAgICAgIGRlYnVnbG9nKCdTa2lwcGluZyBydWxlIHdpdGggZW10cHkgd29yZCAnICsgSlNPTi5zdHJpbmdpZnkocnVsZSwgdW5kZWZpbmVkLCAyKSk7XG4gICAgICAgIGxvYWRsb2coJ1NraXBwaW5nIHJ1bGUgd2l0aCBlbXRweSB3b3JkICcgKyBKU09OLnN0cmluZ2lmeShydWxlLCB1bmRlZmluZWQsIDIpKTtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBtUnVsZXMucHVzaChydWxlKTtcbiAgICByZXR1cm47XG59XG5mdW5jdGlvbiBsb2FkTW9kZWxEYXRhKG1vZGVsUGF0aCwgb01kbCwgc01vZGVsTmFtZSwgb01vZGVsKSB7XG4gICAgLy8gcmVhZCB0aGUgZGF0YSAtPlxuICAgIC8vIGRhdGEgaXMgcHJvY2Vzc2VkIGludG8gbVJ1bGVzIGRpcmVjdGx5LFxuICAgIHZhciBzRmlsZU5hbWUgPSAoJy4vJyArIG1vZGVsUGF0aCArICcvJyArIHNNb2RlbE5hbWUgKyBcIi5kYXRhLmpzb25cIik7XG4gICAgdmFyIG1kbGRhdGEgPSBmcy5yZWFkRmlsZVN5bmMoc0ZpbGVOYW1lLCAndXRmLTgnKTtcbiAgICB2YXIgb01kbERhdGEgPSBKU09OLnBhcnNlKG1kbGRhdGEpO1xuICAgIG9NZGxEYXRhLmZvckVhY2goZnVuY3Rpb24gKG9FbnRyeSkge1xuICAgICAgICBpZiAoIW9FbnRyeS50b29sKSB7XG4gICAgICAgICAgICBvRW50cnkuX2RvbWFpbiA9IG9NZGwuZG9tYWluO1xuICAgICAgICB9XG4gICAgICAgIGlmICghb0VudHJ5LnRvb2wgJiYgb01kbC50b29sLm5hbWUpIHtcbiAgICAgICAgICAgIG9FbnRyeS50b29sID0gb01kbC50b29sLm5hbWU7XG4gICAgICAgIH1cbiAgICAgICAgb01vZGVsLnJlY29yZHMucHVzaChvRW50cnkpO1xuICAgICAgICBvTWRsLmNhdGVnb3J5LmZvckVhY2goZnVuY3Rpb24gKGNhdCkge1xuICAgICAgICAgICAgaWYgKG9FbnRyeVtjYXRdID09PSAndW5kZWZpbmVkJykge1xuICAgICAgICAgICAgICAgIG9FbnRyeVtjYXRdID0gXCJuL2FcIjtcbiAgICAgICAgICAgICAgICB2YXIgYnVnID0gXCJJTkNPTlNJU1RFTlQqPiBNb2RlbERhdGEgXCIgKyBzRmlsZU5hbWUgKyBcIiBkb2VzIG5vdCBjb250YWluIGNhdGVnb3J5IFwiICsgY2F0ICsgXCIgd2l0aCB2YWx1ZSAndW5kZWZpbmVkJywgdW5kZWZpbmVkIGlzIGlsbGVnYWwgdmFsdWUsIHVzZSBuL2EgXCIgKyBKU09OLnN0cmluZ2lmeShvRW50cnkpICsgXCJcIjtcbiAgICAgICAgICAgICAgICBkZWJ1Z2xvZyhidWcpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgb01kbC53b3JkaW5kZXguZm9yRWFjaChmdW5jdGlvbiAoY2F0ZWdvcnkpIHtcbiAgICAgICAgICAgIGlmIChvRW50cnlbY2F0ZWdvcnldID09PSB1bmRlZmluZWQpIHtcbiAgICAgICAgICAgICAgICBkZWJ1Z2xvZyhcIklOQ09OU0lTVEVOVCo+IE1vZGVsRGF0YSBcIiArIHNGaWxlTmFtZSArIFwiIGRvZXMgbm90IGNvbnRhaW4gY2F0ZWdvcnkgXCIgKyBjYXRlZ29yeSArIFwiIG9mIHdvcmRpbmRleFwiICsgSlNPTi5zdHJpbmdpZnkob0VudHJ5KSArIFwiXCIpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChvRW50cnlbY2F0ZWdvcnldICE9PSBcIipcIikge1xuICAgICAgICAgICAgICAgIHZhciBzU3RyaW5nID0gb0VudHJ5W2NhdGVnb3J5XTtcbiAgICAgICAgICAgICAgICBkZWJ1Z2xvZyhcInB1c2hpbmcgcnVsZSB3aXRoIFwiICsgY2F0ZWdvcnkgKyBcIiAtPiBcIiArIHNTdHJpbmcpO1xuICAgICAgICAgICAgICAgIHZhciBvUnVsZSA9IHtcbiAgICAgICAgICAgICAgICAgICAgY2F0ZWdvcnk6IGNhdGVnb3J5LFxuICAgICAgICAgICAgICAgICAgICBtYXRjaGVkU3RyaW5nOiBzU3RyaW5nLFxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAwIC8qIFdPUkQgKi8sXG4gICAgICAgICAgICAgICAgICAgIHdvcmQ6IHNTdHJpbmcsXG4gICAgICAgICAgICAgICAgICAgIF9yYW5raW5nOiAwLjk1XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICBpZiAob01kbC5leGFjdG1hdGNoICYmIG9NZGwuZXhhY3RtYXRjaC5pbmRleE9mKGNhdGVnb3J5KSA+PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIG9SdWxlLmV4YWN0T25seSA9IHRydWU7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGluc2VydFJ1bGVJZk5vdFByZXNlbnQob01vZGVsLm1SdWxlcywgb1J1bGUsIG9Nb2RlbC5zZWVuUnVsZXMpO1xuICAgICAgICAgICAgICAgIGlmIChvTWRsRGF0YS5zeW5vbnltcyAmJiBvTWRsRGF0YS5zeW5vbnltc1tjYXRlZ29yeV0pIHtcbiAgICAgICAgICAgICAgICAgICAgYWRkU3lub255bXMob01kbERhdGEuc3lub255bXNbY2F0ZWdvcnldLCBjYXRlZ29yeSwgc1N0cmluZywgb01vZGVsLm1SdWxlcywgb01vZGVsLnNlZW5SdWxlcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChvRW50cnkuc3lub255bXMgJiYgb0VudHJ5LnN5bm9ueW1zW2NhdGVnb3J5XSkge1xuICAgICAgICAgICAgICAgICAgICBhZGRTeW5vbnltcyhvRW50cnkuc3lub255bXNbY2F0ZWdvcnldLCBjYXRlZ29yeSwgc1N0cmluZywgb01vZGVsLm1SdWxlcywgb01vZGVsLnNlZW5SdWxlcyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICB9KTtcbn1cbmZ1bmN0aW9uIGxvYWRNb2RlbChtb2RlbFBhdGgsIHNNb2RlbE5hbWUsIG9Nb2RlbCkge1xuICAgIGRlYnVnbG9nKFwiIGxvYWRpbmcgXCIgKyBzTW9kZWxOYW1lICsgXCIgLi4uLlwiKTtcbiAgICB2YXIgbWRsID0gZnMucmVhZEZpbGVTeW5jKCcuLycgKyBtb2RlbFBhdGggKyAnLycgKyBzTW9kZWxOYW1lICsgXCIubW9kZWwuanNvblwiLCAndXRmLTgnKTtcbiAgICB2YXIgb01kbCA9IEpTT04ucGFyc2UobWRsKTtcbiAgICB2YXIgY2F0ZWdvcnlEZXNjcmliZWRNYXAgPSB7fTtcbiAgICBvTWRsLmNhdGVnb3J5RGVzY3JpYmVkID0gW107XG4gICAgLy8gcmVjdGlmeSBjYXRlZ29yeVxuICAgIG9NZGwuY2F0ZWdvcnkgPSBvTWRsLmNhdGVnb3J5Lm1hcChmdW5jdGlvbiAoY2F0KSB7XG4gICAgICAgIGlmICh0eXBlb2YgY2F0ID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgICAgICByZXR1cm4gY2F0O1xuICAgICAgICB9XG4gICAgICAgIGlmICh0eXBlb2YgY2F0Lm5hbWUgIT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiTWlzc2luZyBuYW1lIGluIG9iamVjdCB0eXBlZCBjYXRlZ29yeSBpbiBcIiArIEpTT04uc3RyaW5naWZ5KGNhdCkgKyBcIiBpbiBtb2RlbCBcIiArIHNNb2RlbE5hbWUpO1xuICAgICAgICAgICAgcHJvY2Vzcy5leGl0KC0xKTtcbiAgICAgICAgfVxuICAgICAgICBjYXRlZ29yeURlc2NyaWJlZE1hcFtjYXQubmFtZV0gPSBjYXQ7XG4gICAgICAgIG9NZGwuY2F0ZWdvcnlEZXNjcmliZWQucHVzaChjYXQpO1xuICAgICAgICByZXR1cm4gY2F0Lm5hbWU7XG4gICAgfSk7XG4gICAgaWYgKG9Nb2RlbC5kb21haW5zLmluZGV4T2Yob01kbC5kb21haW4pID49IDApIHtcbiAgICAgICAgZGVidWdsb2coXCIqKioqKioqKioqKmhlcmUgbWRsXCIgKyBKU09OLnN0cmluZ2lmeShvTWRsLCB1bmRlZmluZWQsIDIpKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdEb21haW4gJyArIG9NZGwuZG9tYWluICsgJyBhbHJlYWR5IGxvYWRlZCB3aGlsZSBsb2FkaW5nICcgKyBzTW9kZWxOYW1lICsgJz8nKTtcbiAgICB9XG4gICAgLy8gY2hlY2sgcHJvcGVydGllcyBvZiBtb2RlbFxuICAgIE9iamVjdC5rZXlzKG9NZGwpLnNvcnQoKS5mb3JFYWNoKGZ1bmN0aW9uIChzUHJvcGVydHkpIHtcbiAgICAgICAgaWYgKEFSUl9NT0RFTF9QUk9QRVJUSUVTLmluZGV4T2Yoc1Byb3BlcnR5KSA8IDApIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTW9kZWwgcHJvcGVydHkgXCInICsgc1Byb3BlcnR5ICsgJ1wiIG5vdCBhIGtub3duIG1vZGVsIHByb3BlcnR5IGluIG1vZGVsIG9mIGRvbWFpbiAnICsgb01kbC5kb21haW4gKyAnICcpO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgb01vZGVsLmZ1bGwuZG9tYWluW29NZGwuZG9tYWluXSA9IHsgZGVzY3JpcHRpb246IG9NZGwuZGVzY3JpcHRpb24sXG4gICAgICAgIGNhdGVnb3JpZXM6IGNhdGVnb3J5RGVzY3JpYmVkTWFwIH07XG4gICAgLy8gY2hlY2sgdGhhdCBtZW1iZXJzIG9mIHdvcmRpbmRleCBhcmUgaW4gY2F0ZWdvcmllcyxcbiAgICBvTWRsLndvcmRpbmRleCA9IG9NZGwud29yZGluZGV4IHx8IFtdO1xuICAgIG9NZGwud29yZGluZGV4LmZvckVhY2goZnVuY3Rpb24gKHNXb3JkSW5kZXgpIHtcbiAgICAgICAgaWYgKG9NZGwuY2F0ZWdvcnkuaW5kZXhPZihzV29yZEluZGV4KSA8IDApIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcignTW9kZWwgd29yZGluZGV4IFwiJyArIHNXb3JkSW5kZXggKyAnXCIgbm90IGEgY2F0ZWdvcnkgb2YgZG9tYWluICcgKyBvTWRsLmRvbWFpbiArICcgJyk7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICBvTWRsLmV4YWN0bWF0Y2ggPSBvTWRsLmV4YWN0bWF0Y2ggfHwgW107XG4gICAgb01kbC5leGFjdG1hdGNoLmZvckVhY2goZnVuY3Rpb24gKHNFeGFjdE1hdGNoKSB7XG4gICAgICAgIGlmIChvTWRsLmNhdGVnb3J5LmluZGV4T2Yoc0V4YWN0TWF0Y2gpIDwgMCkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdNb2RlbCBleGFjdG1hdGNoIFwiJyArIHNFeGFjdE1hdGNoICsgJ1wiIG5vdCBhIGNhdGVnb3J5IG9mIGRvbWFpbiAnICsgb01kbC5kb21haW4gKyAnICcpO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgLy8gYWRkIHJlbGF0aW9uIGRvbWFpbiAtPiBjYXRlZ29yeVxuICAgIHZhciBkb21haW5TdHIgPSBNZXRhRi5Eb21haW4ob01kbC5kb21haW4pLnRvRnVsbFN0cmluZygpO1xuICAgIHZhciByZWxhdGlvblN0ciA9IE1ldGFGLlJlbGF0aW9uKE1ldGEuUkVMQVRJT05faGFzQ2F0ZWdvcnkpLnRvRnVsbFN0cmluZygpO1xuICAgIHZhciByZXZlcnNlUmVsYXRpb25TdHIgPSBNZXRhRi5SZWxhdGlvbihNZXRhLlJFTEFUSU9OX2lzQ2F0ZWdvcnlPZikudG9GdWxsU3RyaW5nKCk7XG4gICAgb01kbC5jYXRlZ29yeS5mb3JFYWNoKGZ1bmN0aW9uIChzQ2F0ZWdvcnkpIHtcbiAgICAgICAgdmFyIENhdGVnb3J5U3RyaW5nID0gTWV0YUYuQ2F0ZWdvcnkoc0NhdGVnb3J5KS50b0Z1bGxTdHJpbmcoKTtcbiAgICAgICAgb01vZGVsLm1ldGEudDNbZG9tYWluU3RyXSA9IG9Nb2RlbC5tZXRhLnQzW2RvbWFpblN0cl0gfHwge307XG4gICAgICAgIG9Nb2RlbC5tZXRhLnQzW2RvbWFpblN0cl1bcmVsYXRpb25TdHJdID0gb01vZGVsLm1ldGEudDNbZG9tYWluU3RyXVtyZWxhdGlvblN0cl0gfHwge307XG4gICAgICAgIG9Nb2RlbC5tZXRhLnQzW2RvbWFpblN0cl1bcmVsYXRpb25TdHJdW0NhdGVnb3J5U3RyaW5nXSA9IHt9O1xuICAgICAgICBvTW9kZWwubWV0YS50M1tDYXRlZ29yeVN0cmluZ10gPSBvTW9kZWwubWV0YS50M1tDYXRlZ29yeVN0cmluZ10gfHwge307XG4gICAgICAgIG9Nb2RlbC5tZXRhLnQzW0NhdGVnb3J5U3RyaW5nXVtyZXZlcnNlUmVsYXRpb25TdHJdID0gb01vZGVsLm1ldGEudDNbQ2F0ZWdvcnlTdHJpbmddW3JldmVyc2VSZWxhdGlvblN0cl0gfHwge307XG4gICAgICAgIG9Nb2RlbC5tZXRhLnQzW0NhdGVnb3J5U3RyaW5nXVtyZXZlcnNlUmVsYXRpb25TdHJdW2RvbWFpblN0cl0gPSB7fTtcbiAgICB9KTtcbiAgICAvLyBhZGQgYSBwcmVjaWNlIGRvbWFpbiBtYXRjaHJ1bGVcbiAgICBpbnNlcnRSdWxlSWZOb3RQcmVzZW50KG9Nb2RlbC5tUnVsZXMsIHtcbiAgICAgICAgY2F0ZWdvcnk6IFwiZG9tYWluXCIsXG4gICAgICAgIG1hdGNoZWRTdHJpbmc6IG9NZGwuZG9tYWluLFxuICAgICAgICB0eXBlOiAwIC8qIFdPUkQgKi8sXG4gICAgICAgIHdvcmQ6IG9NZGwuZG9tYWluLFxuICAgICAgICBfcmFua2luZzogMC45NVxuICAgIH0sIG9Nb2RlbC5zZWVuUnVsZXMpO1xuICAgIC8vIGNoZWNrIHRoZSB0b29sXG4gICAgaWYgKG9NZGwudG9vbCAmJiBvTWRsLnRvb2wucmVxdWlyZXMpIHtcbiAgICAgICAgdmFyIHJlcXVpcmVzID0gT2JqZWN0LmtleXMob01kbC50b29sLnJlcXVpcmVzIHx8IHt9KTtcbiAgICAgICAgdmFyIGRpZmYgPSBfLmRpZmZlcmVuY2UocmVxdWlyZXMsIG9NZGwuY2F0ZWdvcnkpO1xuICAgICAgICBpZiAoZGlmZi5sZW5ndGggPiAwKSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygoXCIgXCIgKyBvTWRsLmRvbWFpbiArIFwiIDogVW5rb3duIGNhdGVnb3J5IGluIHJlcXVpcmVzIG9mIHRvb2w6IFxcXCJcIikgKyBkaWZmLmpvaW4oJ1wiJykgKyAnXCInKTtcbiAgICAgICAgICAgIHByb2Nlc3MuZXhpdCgtMSk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIG9wdGlvbmFsID0gT2JqZWN0LmtleXMob01kbC50b29sLm9wdGlvbmFsKTtcbiAgICAgICAgZGlmZiA9IF8uZGlmZmVyZW5jZShvcHRpb25hbCwgb01kbC5jYXRlZ29yeSk7XG4gICAgICAgIGlmIChkaWZmLmxlbmd0aCA+IDApIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKChcIiBcIiArIG9NZGwuZG9tYWluICsgXCIgOiBVbmtvd24gY2F0ZWdvcnkgb3B0aW9uYWwgb2YgdG9vbDogXFxcIlwiKSArIGRpZmYuam9pbignXCInKSArICdcIicpO1xuICAgICAgICAgICAgcHJvY2Vzcy5leGl0KC0xKTtcbiAgICAgICAgfVxuICAgICAgICBPYmplY3Qua2V5cyhvTWRsLnRvb2wuc2V0cyB8fCB7fSkuZm9yRWFjaChmdW5jdGlvbiAoc2V0SUQpIHtcbiAgICAgICAgICAgIHZhciBkaWZmID0gXy5kaWZmZXJlbmNlKG9NZGwudG9vbC5zZXRzW3NldElEXS5zZXQsIG9NZGwuY2F0ZWdvcnkpO1xuICAgICAgICAgICAgaWYgKGRpZmYubGVuZ3RoID4gMCkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKChcIiBcIiArIG9NZGwuZG9tYWluICsgXCIgOiBVbmtvd24gY2F0ZWdvcnkgaW4gc2V0SWQgXCIgKyBzZXRJRCArIFwiIG9mIHRvb2w6IFxcXCJcIikgKyBkaWZmLmpvaW4oJ1wiJykgKyAnXCInKTtcbiAgICAgICAgICAgICAgICBwcm9jZXNzLmV4aXQoLTEpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgLy8gZXh0cmFjdCB0b29scyBhbiBhZGQgdG8gdG9vbHM6XG4gICAgICAgIG9Nb2RlbC50b29scy5maWx0ZXIoZnVuY3Rpb24gKG9FbnRyeSkge1xuICAgICAgICAgICAgaWYgKG9FbnRyeS5uYW1lID09PSAob01kbC50b29sICYmIG9NZGwudG9vbC5uYW1lKSkge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiVG9vbCBcIiArIG9NZGwudG9vbC5uYW1lICsgXCIgYWxyZWFkeSBwcmVzZW50IHdoZW4gbG9hZGluZyBcIiArIHNNb2RlbE5hbWUpO1xuICAgICAgICAgICAgICAgIC8vdGhyb3cgbmV3IEVycm9yKCdEb21haW4gYWxyZWFkeSBsb2FkZWQ/Jyk7XG4gICAgICAgICAgICAgICAgcHJvY2Vzcy5leGl0KC0xKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBvTWRsLnRvb2xoaWRkZW4gPSB0cnVlO1xuICAgICAgICBvTWRsLnRvb2wucmVxdWlyZXMgPSB7IFwiaW1wb3NzaWJsZVwiOiB7fSB9O1xuICAgIH1cbiAgICAvLyBhZGQgdGhlIHRvb2wgbmFtZSBhcyBydWxlIHVubGVzcyBoaWRkZW5cbiAgICBpZiAoIW9NZGwudG9vbGhpZGRlbiAmJiBvTWRsLnRvb2wgJiYgb01kbC50b29sLm5hbWUpIHtcbiAgICAgICAgaW5zZXJ0UnVsZUlmTm90UHJlc2VudChvTW9kZWwubVJ1bGVzLCB7XG4gICAgICAgICAgICBjYXRlZ29yeTogXCJ0b29sXCIsXG4gICAgICAgICAgICBtYXRjaGVkU3RyaW5nOiBvTWRsLnRvb2wubmFtZSxcbiAgICAgICAgICAgIHR5cGU6IDAgLyogV09SRCAqLyxcbiAgICAgICAgICAgIHdvcmQ6IG9NZGwudG9vbC5uYW1lLFxuICAgICAgICAgICAgX3Jhbmtpbmc6IDAuOTVcbiAgICAgICAgfSwgb01vZGVsLnNlZW5SdWxlcyk7XG4gICAgfVxuICAgIDtcbiAgICBpZiAob01kbC5zeW5vbnltcyAmJiBvTWRsLnN5bm9ueW1zW1widG9vbFwiXSkge1xuICAgICAgICBhZGRTeW5vbnltcyhvTWRsLnN5bm9ueW1zW1widG9vbFwiXSwgXCJ0b29sXCIsIG9NZGwudG9vbC5uYW1lLCBvTW9kZWwubVJ1bGVzLCBvTW9kZWwuc2VlblJ1bGVzKTtcbiAgICB9XG4gICAgO1xuICAgIGlmIChvTWRsLnN5bm9ueW1zKSB7XG4gICAgICAgIE9iamVjdC5rZXlzKG9NZGwuc3lub255bXMpLmZvckVhY2goZnVuY3Rpb24gKHNzeW5rZXkpIHtcbiAgICAgICAgICAgIGlmIChvTWRsLmNhdGVnb3J5LmluZGV4T2Yoc3N5bmtleSkgPj0gMCAmJiBzc3lua2V5ICE9PSBcInRvb2xcIikge1xuICAgICAgICAgICAgICAgIGlmIChvTW9kZWwuZnVsbC5kb21haW5bb01kbC5kb21haW5dLmNhdGVnb3JpZXNbc3N5bmtleV0pIHtcbiAgICAgICAgICAgICAgICAgICAgb01vZGVsLmZ1bGwuZG9tYWluW29NZGwuZG9tYWluXS5jYXRlZ29yaWVzW3NzeW5rZXldLnN5bm9ueW1zID0gb01kbC5zeW5vbnltc1tzc3lua2V5XTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYWRkU3lub255bXMob01kbC5zeW5vbnltc1tzc3lua2V5XSwgXCJjYXRlZ29yeVwiLCBzc3lua2V5LCBvTW9kZWwubVJ1bGVzLCBvTW9kZWwuc2VlblJ1bGVzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfVxuICAgIG9Nb2RlbC5kb21haW5zLnB1c2gob01kbC5kb21haW4pO1xuICAgIGlmIChvTWRsLnRvb2wubmFtZSkge1xuICAgICAgICBvTW9kZWwudG9vbHMucHVzaChvTWRsLnRvb2wpO1xuICAgIH1cbiAgICBvTW9kZWwuY2F0ZWdvcnkgPSBvTW9kZWwuY2F0ZWdvcnkuY29uY2F0KG9NZGwuY2F0ZWdvcnkpO1xuICAgIG9Nb2RlbC5jYXRlZ29yeS5zb3J0KCk7XG4gICAgb01vZGVsLmNhdGVnb3J5ID0gb01vZGVsLmNhdGVnb3J5LmZpbHRlcihmdW5jdGlvbiAoc3RyaW5nLCBpbmRleCkge1xuICAgICAgICByZXR1cm4gb01vZGVsLmNhdGVnb3J5W2luZGV4XSAhPT0gb01vZGVsLmNhdGVnb3J5W2luZGV4ICsgMV07XG4gICAgfSk7XG4gICAgbG9hZE1vZGVsRGF0YShtb2RlbFBhdGgsIG9NZGwsIHNNb2RlbE5hbWUsIG9Nb2RlbCk7XG59IC8vIGxvYWRtb2RlbFxuZnVuY3Rpb24gc3BsaXRSdWxlcyhydWxlcykge1xuICAgIHZhciByZXMgPSB7fTtcbiAgICB2YXIgbm9uV29yZFJ1bGVzID0gW107XG4gICAgcnVsZXMuZm9yRWFjaChmdW5jdGlvbiAocnVsZSkge1xuICAgICAgICBpZiAocnVsZS50eXBlID09PSAwIC8qIFdPUkQgKi8pIHtcbiAgICAgICAgICAgIGlmICghcnVsZS5sb3dlcmNhc2V3b3JkKSB7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiUnVsZSBoYXMgbm8gbWVtYmVyIGxvd2VyY2FzZXdvcmRcIiArIEpTT04uc3RyaW5naWZ5KHJ1bGUpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJlc1tydWxlLmxvd2VyY2FzZXdvcmRdID0gcmVzW3J1bGUubG93ZXJjYXNld29yZF0gfHwgW107XG4gICAgICAgICAgICByZXNbcnVsZS5sb3dlcmNhc2V3b3JkXS5wdXNoKHJ1bGUpO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgbm9uV29yZFJ1bGVzLnB1c2gocnVsZSk7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4ge1xuICAgICAgICB3b3JkTWFwOiByZXMsXG4gICAgICAgIG5vbldvcmRSdWxlczogbm9uV29yZFJ1bGVzLFxuICAgICAgICBhbGxSdWxlczogcnVsZXNcbiAgICB9O1xufVxuZXhwb3J0cy5zcGxpdFJ1bGVzID0gc3BsaXRSdWxlcztcbmZ1bmN0aW9uIGxvYWRNb2RlbHMobW9kZWxQYXRoKSB7XG4gICAgdmFyIG9Nb2RlbDtcbiAgICBvTW9kZWwgPSB7XG4gICAgICAgIGZ1bGw6IHsgZG9tYWluOiB7fSB9LFxuICAgICAgICBkb21haW5zOiBbXSxcbiAgICAgICAgdG9vbHM6IFtdLFxuICAgICAgICBydWxlczogdW5kZWZpbmVkLFxuICAgICAgICBjYXRlZ29yeTogW10sXG4gICAgICAgIG9wZXJhdG9yczoge30sXG4gICAgICAgIG1SdWxlczogW10sXG4gICAgICAgIHNlZW5SdWxlczoge30sXG4gICAgICAgIHJlY29yZHM6IFtdLFxuICAgICAgICBtZXRhOiB7IHQzOiB7fSB9XG4gICAgfTtcbiAgICBtb2RlbFBhdGggPSBtb2RlbFBhdGggfHwgZW52TW9kZWxQYXRoO1xuICAgIHZhciBzbWRscyA9IGZzLnJlYWRGaWxlU3luYygnLi8nICsgbW9kZWxQYXRoICsgJy9tb2RlbHMuanNvbicsICd1dGYtOCcpO1xuICAgIHZhciBtZGxzID0gSlNPTi5wYXJzZShcIlwiICsgc21kbHMpO1xuICAgIG1kbHMuZm9yRWFjaChmdW5jdGlvbiAoc01vZGVsTmFtZSkge1xuICAgICAgICBsb2FkTW9kZWwobW9kZWxQYXRoLCBzTW9kZWxOYW1lLCBvTW9kZWwpO1xuICAgIH0pO1xuICAgIC8vIGFkZCB0aGUgY2F0ZWdvcmllcyB0byB0aGUgbW9kZWw6XG4gICAgb01vZGVsLmNhdGVnb3J5LmZvckVhY2goZnVuY3Rpb24gKGNhdGVnb3J5KSB7XG4gICAgICAgIGluc2VydFJ1bGVJZk5vdFByZXNlbnQob01vZGVsLm1SdWxlcywge1xuICAgICAgICAgICAgY2F0ZWdvcnk6IFwiY2F0ZWdvcnlcIixcbiAgICAgICAgICAgIG1hdGNoZWRTdHJpbmc6IGNhdGVnb3J5LFxuICAgICAgICAgICAgdHlwZTogMCAvKiBXT1JEICovLFxuICAgICAgICAgICAgd29yZDogY2F0ZWdvcnksXG4gICAgICAgICAgICBsb3dlcmNhc2V3b3JkOiBjYXRlZ29yeS50b0xvd2VyQ2FzZSgpLFxuICAgICAgICAgICAgX3Jhbmtpbmc6IDAuOTVcbiAgICAgICAgfSwgb01vZGVsLnNlZW5SdWxlcyk7XG4gICAgfSk7XG4gICAgLy8gYWRkIHRoZSBkb21haW4gbWV0YSBydWxlXG4gICAgaW5zZXJ0UnVsZUlmTm90UHJlc2VudChvTW9kZWwubVJ1bGVzLCB7XG4gICAgICAgIGNhdGVnb3J5OiBcIm1ldGFcIixcbiAgICAgICAgbWF0Y2hlZFN0cmluZzogXCJkb21haW5cIixcbiAgICAgICAgdHlwZTogMCAvKiBXT1JEICovLFxuICAgICAgICB3b3JkOiBcImRvbWFpblwiLFxuICAgICAgICBfcmFua2luZzogMC45NVxuICAgIH0sIG9Nb2RlbC5zZWVuUnVsZXMpO1xuICAgIC8vYWRkIGEgZmlsbGVyIHJ1bGVcbiAgICB2YXIgc2ZpbGxlcnMgPSBmcy5yZWFkRmlsZVN5bmMoJy4vJyArIG1vZGVsUGF0aCArICcvZmlsbGVyLmpzb24nLCAndXRmLTgnKTtcbiAgICB2YXIgZmlsbGVycyA9IEpTT04ucGFyc2Uoc2ZpbGxlcnMpO1xuICAgIHZhciByZSA9IFwiXigoXCIgKyBmaWxsZXJzLmpvaW4oXCIpfChcIikgKyBcIikpJFwiO1xuICAgIG9Nb2RlbC5tUnVsZXMucHVzaCh7XG4gICAgICAgIGNhdGVnb3J5OiBcImZpbGxlclwiLFxuICAgICAgICB0eXBlOiAxIC8qIFJFR0VYUCAqLyxcbiAgICAgICAgcmVnZXhwOiBuZXcgUmVnRXhwKHJlLCBcImlcIiksXG4gICAgICAgIG1hdGNoZWRTdHJpbmc6IFwiZmlsbGVyXCIsXG4gICAgICAgIF9yYW5raW5nOiAwLjlcbiAgICB9KTtcbiAgICAvL2FkZCBvcGVyYXRvcnNcbiAgICB2YXIgc09wZXJhdG9ycyA9IGZzLnJlYWRGaWxlU3luYygnLi9yZXNvdXJjZXMvbW9kZWwvb3BlcmF0b3JzLmpzb24nLCAndXRmLTgnKTtcbiAgICB2YXIgb3BlcmF0b3JzID0gSlNPTi5wYXJzZShzT3BlcmF0b3JzKTtcbiAgICBPYmplY3Qua2V5cyhvcGVyYXRvcnMub3BlcmF0b3JzKS5mb3JFYWNoKGZ1bmN0aW9uIChvcGVyYXRvcikge1xuICAgICAgICBpZiAoSU1hdGNoLmFPcGVyYXRvck5hbWVzLmluZGV4T2Yob3BlcmF0b3IpIDwgMCkge1xuICAgICAgICAgICAgZGVidWdsb2coXCJ1bmtub3duIG9wZXJhdG9yIFwiICsgb3BlcmF0b3IpO1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwidW5rbm93biBvcGVyYXRvciBcIiArIG9wZXJhdG9yKTtcbiAgICAgICAgfVxuICAgICAgICBvTW9kZWwub3BlcmF0b3JzW29wZXJhdG9yXSA9IG9wZXJhdG9ycy5vcGVyYXRvcnNbb3BlcmF0b3JdO1xuICAgICAgICBvTW9kZWwub3BlcmF0b3JzW29wZXJhdG9yXS5vcGVyYXRvciA9IG9wZXJhdG9yO1xuICAgICAgICBPYmplY3QuZnJlZXplKG9Nb2RlbC5vcGVyYXRvcnNbb3BlcmF0b3JdKTtcbiAgICAgICAgdmFyIHdvcmQgPSBvcGVyYXRvcjtcbiAgICAgICAgaW5zZXJ0UnVsZUlmTm90UHJlc2VudChvTW9kZWwubVJ1bGVzLCB7XG4gICAgICAgICAgICBjYXRlZ29yeTogXCJvcGVyYXRvclwiLFxuICAgICAgICAgICAgd29yZDogd29yZC50b0xvd2VyQ2FzZSgpLFxuICAgICAgICAgICAgbG93ZXJjYXNld29yZDogd29yZC50b0xvd2VyQ2FzZSgpLFxuICAgICAgICAgICAgdHlwZTogMCAvKiBXT1JEICovLFxuICAgICAgICAgICAgbWF0Y2hlZFN0cmluZzogd29yZCxcbiAgICAgICAgICAgIF9yYW5raW5nOiAwLjlcbiAgICAgICAgfSwgb01vZGVsLnNlZW5SdWxlcyk7XG4gICAgICAgIC8vIGFkZCBhbGwgc3lub255bXNcbiAgICAgICAgaWYgKG9wZXJhdG9ycy5zeW5vbnltc1tvcGVyYXRvcl0pIHtcbiAgICAgICAgICAgIE9iamVjdC5rZXlzKG9wZXJhdG9ycy5zeW5vbnltc1tvcGVyYXRvcl0pLmZvckVhY2goZnVuY3Rpb24gKHN5bm9ueW0pIHtcbiAgICAgICAgICAgICAgICBpbnNlcnRSdWxlSWZOb3RQcmVzZW50KG9Nb2RlbC5tUnVsZXMsIHtcbiAgICAgICAgICAgICAgICAgICAgY2F0ZWdvcnk6IFwib3BlcmF0b3JcIixcbiAgICAgICAgICAgICAgICAgICAgd29yZDogc3lub255bS50b0xvd2VyQ2FzZSgpLFxuICAgICAgICAgICAgICAgICAgICBsb3dlcmNhc2V3b3JkOiBzeW5vbnltLnRvTG93ZXJDYXNlKCksXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6IDAgLyogV09SRCAqLyxcbiAgICAgICAgICAgICAgICAgICAgbWF0Y2hlZFN0cmluZzogb3BlcmF0b3IsXG4gICAgICAgICAgICAgICAgICAgIF9yYW5raW5nOiAwLjlcbiAgICAgICAgICAgICAgICB9LCBvTW9kZWwuc2VlblJ1bGVzKTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgfSk7XG4gICAgLypcbiAgICAgICAgfSlcbiAgICAgICAgICAgIHtcbiAgICAgICAgICBjYXRlZ29yeTogXCJmaWxsZXJcIixcbiAgICAgICAgICB0eXBlOiAxLFxuICAgICAgICAgIHJlZ2V4cDogL14oKHN0YXJ0KXwoc2hvdyl8KGZyb20pfChpbikpJC9pLFxuICAgICAgICAgIG1hdGNoZWRTdHJpbmc6IFwiZmlsbGVyXCIsXG4gICAgICAgICAgX3Jhbmtpbmc6IDAuOVxuICAgICAgICB9LFxuICAgICovXG4gICAgb01vZGVsLm1SdWxlcyA9IG9Nb2RlbC5tUnVsZXMuc29ydChJbnB1dEZpbHRlclJ1bGVzLmNtcE1SdWxlKTtcbiAgICBvTW9kZWwucnVsZXMgPSBzcGxpdFJ1bGVzKG9Nb2RlbC5tUnVsZXMpO1xuICAgIG9Nb2RlbC50b29scyA9IG9Nb2RlbC50b29scy5zb3J0KFRvb2xzLmNtcFRvb2xzKTtcbiAgICBkZWxldGUgb01vZGVsLnNlZW5SdWxlcztcbiAgICByZXR1cm4gb01vZGVsO1xufVxuZXhwb3J0cy5sb2FkTW9kZWxzID0gbG9hZE1vZGVscztcbmZ1bmN0aW9uIHNvcnRDYXRlZ29yaWVzQnlJbXBvcnRhbmNlKG1hcCwgY2F0cykge1xuICAgIHZhciByZXMgPSBjYXRzLnNsaWNlKDApO1xuICAgIHJlcy5zb3J0KHJhbmtDYXRlZ29yeUJ5SW1wb3J0YW5jZS5iaW5kKHVuZGVmaW5lZCwgbWFwKSk7XG4gICAgcmV0dXJuIHJlcztcbn1cbmV4cG9ydHMuc29ydENhdGVnb3JpZXNCeUltcG9ydGFuY2UgPSBzb3J0Q2F0ZWdvcmllc0J5SW1wb3J0YW5jZTtcbmZ1bmN0aW9uIHJhbmtDYXRlZ29yeUJ5SW1wb3J0YW5jZShtYXAsIGNhdGEsIGNhdGIpIHtcbiAgICB2YXIgY2F0QURlc2MgPSBtYXBbY2F0YV07XG4gICAgdmFyIGNhdEJEZXNjID0gbWFwW2NhdGJdO1xuICAgIGlmIChjYXRhID09PSBjYXRiKSB7XG4gICAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgICAvLyBpZiBhIGlzIGJlZm9yZSBiLCByZXR1cm4gLTFcbiAgICBpZiAoY2F0QURlc2MgJiYgIWNhdEJEZXNjKSB7XG4gICAgICAgIHJldHVybiAtMTtcbiAgICB9XG4gICAgaWYgKCFjYXRBRGVzYyAmJiBjYXRCRGVzYykge1xuICAgICAgICByZXR1cm4gKzE7XG4gICAgfVxuICAgIHZhciBwcmlvQSA9IChjYXRBRGVzYyAmJiBjYXRBRGVzYy5pbXBvcnRhbmNlKSB8fCA5OTtcbiAgICB2YXIgcHJpb0IgPSAoY2F0QkRlc2MgJiYgY2F0QkRlc2MuaW1wb3J0YW5jZSkgfHwgOTk7XG4gICAgLy8gbG93ZXIgcHJpbyBnb2VzIHRvIGZyb250XG4gICAgdmFyIHIgPSBwcmlvQSAtIHByaW9CO1xuICAgIGlmIChyKSB7XG4gICAgICAgIHJldHVybiByO1xuICAgIH1cbiAgICByZXR1cm4gY2F0YS5sb2NhbGVDb21wYXJlKGNhdGIpO1xufVxuZXhwb3J0cy5yYW5rQ2F0ZWdvcnlCeUltcG9ydGFuY2UgPSByYW5rQ2F0ZWdvcnlCeUltcG9ydGFuY2U7XG52YXIgTWV0YUYgPSBNZXRhLmdldE1ldGFGYWN0b3J5KCk7XG5mdW5jdGlvbiBnZXRPcGVyYXRvcihtZGwsIG9wZXJhdG9yKSB7XG4gICAgcmV0dXJuIG1kbC5vcGVyYXRvcnNbb3BlcmF0b3JdO1xufVxuZXhwb3J0cy5nZXRPcGVyYXRvciA9IGdldE9wZXJhdG9yO1xuZnVuY3Rpb24gZ2V0UmVzdWx0QXNBcnJheShtZGwsIGEsIHJlbCkge1xuICAgIGlmIChyZWwudG9UeXBlKCkgIT09ICdyZWxhdGlvbicpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiZXhwZWN0IHJlbGF0aW9uIGFzIDJuZCBhcmdcIik7XG4gICAgfVxuICAgIHZhciByZXMgPSBtZGwubWV0YS50M1thLnRvRnVsbFN0cmluZygpXSAmJlxuICAgICAgICBtZGwubWV0YS50M1thLnRvRnVsbFN0cmluZygpXVtyZWwudG9GdWxsU3RyaW5nKCldO1xuICAgIGlmICghcmVzKSB7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gICAgcmV0dXJuIE9iamVjdC5nZXRPd25Qcm9wZXJ0eU5hbWVzKHJlcykuc29ydCgpLm1hcChNZXRhRi5wYXJzZUlNZXRhKTtcbn1cbmV4cG9ydHMuZ2V0UmVzdWx0QXNBcnJheSA9IGdldFJlc3VsdEFzQXJyYXk7XG5mdW5jdGlvbiBnZXRDYXRlZ29yaWVzRm9yRG9tYWluKHRoZU1vZGVsLCBkb21haW4pIHtcbiAgICBpZiAodGhlTW9kZWwuZG9tYWlucy5pbmRleE9mKGRvbWFpbikgPCAwKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkRvbWFpbiBcXFwiXCIgKyBkb21haW4gKyBcIlxcXCIgbm90IHBhcnQgb2YgbW9kZWxcIik7XG4gICAgfVxuICAgIHZhciByZXMgPSBnZXRSZXN1bHRBc0FycmF5KHRoZU1vZGVsLCBNZXRhRi5Eb21haW4oZG9tYWluKSwgTWV0YUYuUmVsYXRpb24oTWV0YS5SRUxBVElPTl9oYXNDYXRlZ29yeSkpO1xuICAgIHJldHVybiBNZXRhLmdldFN0cmluZ0FycmF5KHJlcyk7XG59XG5leHBvcnRzLmdldENhdGVnb3JpZXNGb3JEb21haW4gPSBnZXRDYXRlZ29yaWVzRm9yRG9tYWluO1xuLyoqXG4gKiBSZXR1cm4gYWxsIGNhdGVnb3JpZXMgb2YgYSBkb21haW4gd2hpY2ggY2FuIGFwcGVhciBvbiBhIHdvcmQsXG4gKiB0aGVzZSBhcmUgdHlwaWNhbGx5IHRoZSB3b3JkaW5kZXggZG9tYWlucyArIGVudHJpZXMgZ2VuZXJhdGVkIGJ5IGdlbmVyaWMgcnVsZXNcbiAqXG4gKiBUaGUgY3VycmVudCBpbXBsZW1lbnRhdGlvbiBpcyBhIHNpbXBsaWZpY2F0aW9uXG4gKi9cbmZ1bmN0aW9uIGdldFBvdGVudGlhbFdvcmRDYXRlZ29yaWVzRm9yRG9tYWluKHRoZU1vZGVsLCBkb21haW4pIHtcbiAgICAvLyB0aGlzIGlzIGEgc2ltcGxpZmllZCB2ZXJzaW9uXG4gICAgcmV0dXJuIGdldENhdGVnb3JpZXNGb3JEb21haW4odGhlTW9kZWwsIGRvbWFpbik7XG59XG5leHBvcnRzLmdldFBvdGVudGlhbFdvcmRDYXRlZ29yaWVzRm9yRG9tYWluID0gZ2V0UG90ZW50aWFsV29yZENhdGVnb3JpZXNGb3JEb21haW47XG5mdW5jdGlvbiBnZXREb21haW5zRm9yQ2F0ZWdvcnkodGhlTW9kZWwsIGNhdGVnb3J5KSB7XG4gICAgaWYgKHRoZU1vZGVsLmNhdGVnb3J5LmluZGV4T2YoY2F0ZWdvcnkpIDwgMCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDYXRlZ29yeSBcXFwiXCIgKyBjYXRlZ29yeSArIFwiXFxcIiBub3QgcGFydCBvZiBtb2RlbFwiKTtcbiAgICB9XG4gICAgdmFyIHJlcyA9IGdldFJlc3VsdEFzQXJyYXkodGhlTW9kZWwsIE1ldGFGLkNhdGVnb3J5KGNhdGVnb3J5KSwgTWV0YUYuUmVsYXRpb24oTWV0YS5SRUxBVElPTl9pc0NhdGVnb3J5T2YpKTtcbiAgICByZXR1cm4gTWV0YS5nZXRTdHJpbmdBcnJheShyZXMpO1xufVxuZXhwb3J0cy5nZXREb21haW5zRm9yQ2F0ZWdvcnkgPSBnZXREb21haW5zRm9yQ2F0ZWdvcnk7XG5mdW5jdGlvbiBnZXRBbGxSZWNvcmRDYXRlZ29yaWVzRm9yVGFyZ2V0Q2F0ZWdvcnkobW9kZWwsIGNhdGVnb3J5LCB3b3Jkc29ubHkpIHtcbiAgICB2YXIgcmVzID0ge307XG4gICAgLy9cbiAgICB2YXIgZm4gPSB3b3Jkc29ubHkgPyBnZXRQb3RlbnRpYWxXb3JkQ2F0ZWdvcmllc0ZvckRvbWFpbiA6IGdldENhdGVnb3JpZXNGb3JEb21haW47XG4gICAgdmFyIGRvbWFpbnMgPSBnZXREb21haW5zRm9yQ2F0ZWdvcnkobW9kZWwsIGNhdGVnb3J5KTtcbiAgICBkb21haW5zLmZvckVhY2goZnVuY3Rpb24gKGRvbWFpbikge1xuICAgICAgICBmbihtb2RlbCwgZG9tYWluKS5mb3JFYWNoKGZ1bmN0aW9uICh3b3JkY2F0KSB7XG4gICAgICAgICAgICByZXNbd29yZGNhdF0gPSB0cnVlO1xuICAgICAgICB9KTtcbiAgICB9KTtcbiAgICBPYmplY3QuZnJlZXplKHJlcyk7XG4gICAgcmV0dXJuIHJlcztcbn1cbmV4cG9ydHMuZ2V0QWxsUmVjb3JkQ2F0ZWdvcmllc0ZvclRhcmdldENhdGVnb3J5ID0gZ2V0QWxsUmVjb3JkQ2F0ZWdvcmllc0ZvclRhcmdldENhdGVnb3J5O1xuZnVuY3Rpb24gZ2V0QWxsUmVjb3JkQ2F0ZWdvcmllc0ZvclRhcmdldENhdGVnb3JpZXMobW9kZWwsIGNhdGVnb3JpZXMsIHdvcmRzb25seSkge1xuICAgIHZhciByZXMgPSB7fTtcbiAgICAvL1xuICAgIHZhciBmbiA9IHdvcmRzb25seSA/IGdldFBvdGVudGlhbFdvcmRDYXRlZ29yaWVzRm9yRG9tYWluIDogZ2V0Q2F0ZWdvcmllc0ZvckRvbWFpbjtcbiAgICB2YXIgZG9tYWlucyA9IHVuZGVmaW5lZDtcbiAgICBjYXRlZ29yaWVzLmZvckVhY2goZnVuY3Rpb24gKGNhdGVnb3J5KSB7XG4gICAgICAgIHZhciBjYXRkb21haW5zID0gZ2V0RG9tYWluc0ZvckNhdGVnb3J5KG1vZGVsLCBjYXRlZ29yeSk7XG4gICAgICAgIGlmICghZG9tYWlucykge1xuICAgICAgICAgICAgZG9tYWlucyA9IGNhdGRvbWFpbnM7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBkb21haW5zID0gXy5pbnRlcnNlY3Rpb24oZG9tYWlucywgY2F0ZG9tYWlucyk7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICBpZiAoZG9tYWlucy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdjYXRlZ29yaWVzICcgKyBVdGlscy5saXN0VG9RdW90ZWRDb21tYUFuZChjYXRlZ29yaWVzKSArICcgaGF2ZSBubyBjb21tb24gZG9tYWluLicpO1xuICAgIH1cbiAgICBkb21haW5zLmZvckVhY2goZnVuY3Rpb24gKGRvbWFpbikge1xuICAgICAgICBmbihtb2RlbCwgZG9tYWluKS5mb3JFYWNoKGZ1bmN0aW9uICh3b3JkY2F0KSB7XG4gICAgICAgICAgICByZXNbd29yZGNhdF0gPSB0cnVlO1xuICAgICAgICB9KTtcbiAgICB9KTtcbiAgICBPYmplY3QuZnJlZXplKHJlcyk7XG4gICAgcmV0dXJuIHJlcztcbn1cbmV4cG9ydHMuZ2V0QWxsUmVjb3JkQ2F0ZWdvcmllc0ZvclRhcmdldENhdGVnb3JpZXMgPSBnZXRBbGxSZWNvcmRDYXRlZ29yaWVzRm9yVGFyZ2V0Q2F0ZWdvcmllcztcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
