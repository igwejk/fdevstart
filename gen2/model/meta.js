/**
 * Functionality managing the match models
 *
 * @file
 */
"use strict";

var debug = require("debug");
var debuglog = debug('meta');
var logger = require("../utils/logger");
var loadlog = logger.logger('modelload', '');
/**
 * the model path, may be controlled via environment variable
 */
var modelPath = process.env["ABOT_MODELPATH"] || "testmodel";
var separator = " -:- ";
var validTypes = ["relation", "category", "domain"];
var AMeta = function () {
    function AMeta(type, name) {
        if (validTypes.indexOf(type) < 0) {
            throw new Error("Illegal Type " + type);
        }
        this.name = name;
        this.type = type;
    }
    AMeta.prototype.toName = function () {
        return this.name;
    };
    AMeta.prototype.toFullString = function () {
        return this.type + separator + this.name;
    };
    AMeta.prototype.toType = function () {
        return this.type;
    };
    return AMeta;
}();
exports.AMeta = AMeta;
function getStringArray(arr) {
    return arr.map(function (oMeta) {
        return oMeta.toName();
    });
}
exports.getStringArray = getStringArray;
exports.RELATION_hasCategory = "hasCategory";
exports.RELATION_isCategoryOf = "isCategoryOf";
function parseAMeta(a) {
    var r = a.split(separator);
    if (!r || r.length !== 2) {
        throw new Error("cannot parse " + a + " as Meta");
    }
    switch (r[0]) {
        case "category":
            return getMetaFactory().Category(r[1]);
        case "relation":
            return getMetaFactory().Relation(r[1]);
        case "domain":
            return getMetaFactory().Domain(r[1]);
        default:
            throw new Error("unknown meta type" + r[0]);
    }
}
function getMetaFactory() {
    return {
        Domain: function Domain(a) {
            return new AMeta("domain", a);
        },
        Category: function Category(a) {
            return new AMeta("category", a);
        },
        Relation: function Relation(a) {
            return new AMeta("relation", a);
        },
        parseIMeta: parseAMeta
    };
}
exports.getMetaFactory = getMetaFactory;
/*
export function getCategoriesForDomain(theModel : IModels, domain : string) : string[] {
    if(theModel.domains.indexOf(domain) < 0) {
        throw new Error("Domain " + domain + " not part of model");
    }
    theModel.meta.get(Meta.Domain(domain), Meta.Relation("hasCategory"));
}
*/
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9tb2RlbC9tZXRhLnRzIiwibW9kZWwvbWV0YS5qcyJdLCJuYW1lcyI6WyJkZWJ1ZyIsInJlcXVpcmUiLCJkZWJ1Z2xvZyIsImxvZ2dlciIsImxvYWRsb2ciLCJtb2RlbFBhdGgiLCJwcm9jZXNzIiwiZW52Iiwic2VwYXJhdG9yIiwidmFsaWRUeXBlcyIsIkFNZXRhIiwidHlwZSIsIm5hbWUiLCJpbmRleE9mIiwiRXJyb3IiLCJwcm90b3R5cGUiLCJ0b05hbWUiLCJ0b0Z1bGxTdHJpbmciLCJ0b1R5cGUiLCJleHBvcnRzIiwiZ2V0U3RyaW5nQXJyYXkiLCJhcnIiLCJtYXAiLCJvTWV0YSIsIlJFTEFUSU9OX2hhc0NhdGVnb3J5IiwiUkVMQVRJT05faXNDYXRlZ29yeU9mIiwicGFyc2VBTWV0YSIsImEiLCJyIiwic3BsaXQiLCJsZW5ndGgiLCJnZXRNZXRhRmFjdG9yeSIsIkNhdGVnb3J5IiwiUmVsYXRpb24iLCJEb21haW4iLCJwYXJzZUlNZXRhIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7QUNLQTs7QURHQSxJQUFBQSxRQUFBQyxRQUFBLE9BQUEsQ0FBQTtBQUVBLElBQUlDLFdBQVdGLE1BQU0sTUFBTixDQUFmO0FBR0EsSUFBQUcsU0FBQUYsUUFBQSxpQkFBQSxDQUFBO0FBQ0EsSUFBTUcsVUFBVUQsT0FBT0EsTUFBUCxDQUFjLFdBQWQsRUFBMkIsRUFBM0IsQ0FBaEI7QUFNQTs7O0FBR0EsSUFBSUUsWUFBWUMsUUFBUUMsR0FBUixDQUFZLGdCQUFaLEtBQWlDLFdBQWpEO0FBU0EsSUFBTUMsWUFBWSxPQUFsQjtBQUNBLElBQU1DLGFBQWEsQ0FBQyxVQUFELEVBQWEsVUFBYixFQUF5QixRQUF6QixDQUFuQjtBQUVBLElBQUFDLFFBQUEsWUFBQTtBQUdJLGFBQUFBLEtBQUEsQ0FBWUMsSUFBWixFQUEyQkMsSUFBM0IsRUFBd0M7QUFDcEMsWUFBR0gsV0FBV0ksT0FBWCxDQUFtQkYsSUFBbkIsSUFBMkIsQ0FBOUIsRUFBaUM7QUFDN0Isa0JBQU0sSUFBSUcsS0FBSixDQUFVLGtCQUFrQkgsSUFBNUIsQ0FBTjtBQUNIO0FBQ0QsYUFBS0MsSUFBTCxHQUFZQSxJQUFaO0FBQ0EsYUFBS0QsSUFBTCxHQUFZQSxJQUFaO0FBQ0g7QUFDREQsVUFBQUssU0FBQSxDQUFBQyxNQUFBLEdBQUEsWUFBQTtBQUNJLGVBQU8sS0FBS0osSUFBWjtBQUNILEtBRkQ7QUFHQUYsVUFBQUssU0FBQSxDQUFBRSxZQUFBLEdBQUEsWUFBQTtBQUNJLGVBQU8sS0FBS04sSUFBTCxHQUFZSCxTQUFaLEdBQXdCLEtBQUtJLElBQXBDO0FBQ0gsS0FGRDtBQUdBRixVQUFBSyxTQUFBLENBQUFHLE1BQUEsR0FBQSxZQUFBO0FBQ0ksZUFBTyxLQUFLUCxJQUFaO0FBQ0gsS0FGRDtBQUdKLFdBQUFELEtBQUE7QUFuQkEsQ0FBQSxFQUFBO0FBQWFTLFFBQUFULEtBQUEsR0FBQUEsS0FBQTtBQThCYixTQUFBVSxjQUFBLENBQStCQyxHQUEvQixFQUE0QztBQUN4QyxXQUFPQSxJQUFJQyxHQUFKLENBQVEsVUFBU0MsS0FBVCxFQUFzQjtBQUNqQyxlQUFPQSxNQUFNUCxNQUFOLEVBQVA7QUFDSCxLQUZNLENBQVA7QUFHSDtBQUpERyxRQUFBQyxjQUFBLEdBQUFBLGNBQUE7QUFNYUQsUUFBQUssb0JBQUEsR0FBdUIsYUFBdkI7QUFDQUwsUUFBQU0scUJBQUEsR0FBd0IsY0FBeEI7QUFFYixTQUFBQyxVQUFBLENBQW9CQyxDQUFwQixFQUE4QjtBQUNsQixRQUFJQyxJQUFJRCxFQUFFRSxLQUFGLENBQVFyQixTQUFSLENBQVI7QUFDQSxRQUFHLENBQUNvQixDQUFELElBQU1BLEVBQUVFLE1BQUYsS0FBYSxDQUF0QixFQUF5QjtBQUNyQixjQUFNLElBQUloQixLQUFKLENBQVUsa0JBQWtCYSxDQUFsQixHQUFzQixVQUFoQyxDQUFOO0FBQ0g7QUFDRCxZQUFPQyxFQUFFLENBQUYsQ0FBUDtBQUNJLGFBQUssVUFBTDtBQUNJLG1CQUFPRyxpQkFBaUJDLFFBQWpCLENBQTBCSixFQUFFLENBQUYsQ0FBMUIsQ0FBUDtBQUNKLGFBQUssVUFBTDtBQUNJLG1CQUFPRyxpQkFBaUJFLFFBQWpCLENBQTBCTCxFQUFFLENBQUYsQ0FBMUIsQ0FBUDtBQUNKLGFBQUssUUFBTDtBQUNJLG1CQUFPRyxpQkFBaUJHLE1BQWpCLENBQXdCTixFQUFFLENBQUYsQ0FBeEIsQ0FBUDtBQUNKO0FBQ0ksa0JBQU0sSUFBSWQsS0FBSixDQUFVLHNCQUFzQmMsRUFBRSxDQUFGLENBQWhDLENBQU47QUFSUjtBQVVYO0FBRUQsU0FBQUcsY0FBQSxHQUFBO0FBQ0UsV0FBTztBQUNERyxnQkFBUyxnQkFBU1AsQ0FBVCxFQUFtQjtBQUN4QixtQkFBTyxJQUFJakIsS0FBSixDQUFVLFFBQVYsRUFBb0JpQixDQUFwQixDQUFQO0FBQ0gsU0FIQTtBQUlESyxrQkFBVyxrQkFBU0wsQ0FBVCxFQUFtQjtBQUMxQixtQkFBTyxJQUFJakIsS0FBSixDQUFVLFVBQVYsRUFBcUJpQixDQUFyQixDQUFQO0FBQ0gsU0FOQTtBQU9ETSxrQkFBVyxrQkFBU04sQ0FBVCxFQUFtQjtBQUMxQixtQkFBTyxJQUFJakIsS0FBSixDQUFVLFVBQVYsRUFBcUJpQixDQUFyQixDQUFQO0FBQ0gsU0FUQTtBQVVEUSxvQkFBYVQ7QUFWWixLQUFQO0FBWUQ7QUFiRFAsUUFBQVksY0FBQSxHQUFBQSxjQUFBO0FBZUEiLCJmaWxlIjoibW9kZWwvbWV0YS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBGdW5jdGlvbmFsaXR5IG1hbmFnaW5nIHRoZSBtYXRjaCBtb2RlbHNcclxuICpcclxuICogQGZpbGVcclxuICovXHJcblxyXG5pbXBvcnQgKiBhcyBpbnRmIGZyb20gJ2NvbnN0YW50cyc7XHJcblxyXG5pbXBvcnQgKiBhcyBkZWJ1ZyBmcm9tICdkZWJ1Zyc7XHJcblxyXG52YXIgZGVidWdsb2cgPSBkZWJ1ZygnbWV0YScpO1xyXG5cclxuXHJcbmltcG9ydCAqIGFzIGxvZ2dlciBmcm9tICcuLi91dGlscy9sb2dnZXInO1xyXG5jb25zdCBsb2FkbG9nID0gbG9nZ2VyLmxvZ2dlcignbW9kZWxsb2FkJywgJycpO1xyXG5pbXBvcnQgKiAgYXMgSU1hdGNoIGZyb20gJy4uL21hdGNoL2lmbWF0Y2gnO1xyXG5pbXBvcnQgKiBhcyBUb29scyBmcm9tICcuLi9tYXRjaC90b29scyc7XHJcbmltcG9ydCAqIGFzIE1vZGVsIGZyb20gJy4vbW9kZWwnO1xyXG5cclxuXHJcbi8qKlxyXG4gKiB0aGUgbW9kZWwgcGF0aCwgbWF5IGJlIGNvbnRyb2xsZWQgdmlhIGVudmlyb25tZW50IHZhcmlhYmxlXHJcbiAqL1xyXG52YXIgbW9kZWxQYXRoID0gcHJvY2Vzcy5lbnZbXCJBQk9UX01PREVMUEFUSFwiXSB8fCBcInRlc3Rtb2RlbFwiO1xyXG5cclxuZXhwb3J0IGludGVyZmFjZSBJTWV0YSB7XHJcbiAgICB0b05hbWUoKSAgOiBzdHJpbmcsXHJcbiAgICB0b1R5cGUoKSAgOiBzdHJpbmcsXHJcbiAgICB0b0Z1bGxTdHJpbmcoKSA6IHN0cmluZ1xyXG59XHJcblxyXG5cclxuY29uc3Qgc2VwYXJhdG9yID0gXCIgLTotIFwiO1xyXG5jb25zdCB2YWxpZFR5cGVzID0gW1wicmVsYXRpb25cIiwgXCJjYXRlZ29yeVwiLCBcImRvbWFpblwiXTtcclxuXHJcbmV4cG9ydCBjbGFzcyBBTWV0YSBpbXBsZW1lbnRzIElNZXRhIHtcclxuICAgIG5hbWU6IHN0cmluZztcclxuICAgIHR5cGUgOiBzdHJpbmc7XHJcbiAgICBjb25zdHJ1Y3Rvcih0eXBlIDogc3RyaW5nLCBuYW1lIDogc3RyaW5nKSB7XHJcbiAgICAgICAgaWYodmFsaWRUeXBlcy5pbmRleE9mKHR5cGUpIDwgMCkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbGxlZ2FsIFR5cGUgXCIgKyB0eXBlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcclxuICAgICAgICB0aGlzLnR5cGUgPSB0eXBlO1xyXG4gICAgfVxyXG4gICAgdG9OYW1lKCkge1xyXG4gICAgICAgIHJldHVybiB0aGlzLm5hbWU7XHJcbiAgICB9XHJcbiAgICB0b0Z1bGxTdHJpbmcoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMudHlwZSArIHNlcGFyYXRvciArIHRoaXMubmFtZTtcclxuICAgIH1cclxuICAgIHRvVHlwZSgpIHtcclxuICAgICAgICByZXR1cm4gdGhpcy50eXBlO1xyXG4gICAgfVxyXG59XHJcblxyXG5cclxuaW50ZXJmYWNlIE1ldGEge1xyXG4gICAgcGFyc2VJTWV0YSA6IChzdHJpbmcpID0+IElNZXRhLFxyXG4gICAgLy8gY29uc3RydWN0b3JzXHJcbiAgICBEb21haW4gOiAoc3RyaW5nKSA9PiBJTWV0YSxcclxuICAgIENhdGVnb3J5IDogKHN0cmluZykgPT4gSU1ldGEsXHJcbiAgICBSZWxhdGlvbiA6IChzdHJpbmcpID0+IElNZXRhXHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRTdHJpbmdBcnJheShhcnIgOiBJTWV0YVtdKSB7XHJcbiAgICByZXR1cm4gYXJyLm1hcChmdW5jdGlvbihvTWV0YSA6IElNZXRhKSB7XHJcbiAgICAgICAgcmV0dXJuIG9NZXRhLnRvTmFtZSgpO1xyXG4gICAgfSk7XHJcbn1cclxuXHJcbmV4cG9ydCBjb25zdCBSRUxBVElPTl9oYXNDYXRlZ29yeSA9IFwiaGFzQ2F0ZWdvcnlcIjtcclxuZXhwb3J0IGNvbnN0IFJFTEFUSU9OX2lzQ2F0ZWdvcnlPZiA9IFwiaXNDYXRlZ29yeU9mXCI7XHJcblxyXG5mdW5jdGlvbiBwYXJzZUFNZXRhKGEgOiBzdHJpbmcpIDogSU1ldGEge1xyXG4gICAgICAgICAgICB2YXIgciA9IGEuc3BsaXQoc2VwYXJhdG9yKTtcclxuICAgICAgICAgICAgaWYoIXIgfHwgci5sZW5ndGggIT09IDIpIHtcclxuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcImNhbm5vdCBwYXJzZSBcIiArIGEgKyBcIiBhcyBNZXRhXCIpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHN3aXRjaChyWzBdKSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIFwiY2F0ZWdvcnlcIjpcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gZ2V0TWV0YUZhY3RvcnkoKS5DYXRlZ29yeShyWzFdKTtcclxuICAgICAgICAgICAgICAgIGNhc2UgXCJyZWxhdGlvblwiOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRNZXRhRmFjdG9yeSgpLlJlbGF0aW9uKHJbMV0pO1xyXG4gICAgICAgICAgICAgICAgY2FzZSBcImRvbWFpblwiOlxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBnZXRNZXRhRmFjdG9yeSgpLkRvbWFpbihyWzFdKTtcclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwidW5rbm93biBtZXRhIHR5cGVcIiArIHJbMF0pO1xyXG4gICAgICAgICAgICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBnZXRNZXRhRmFjdG9yeSgpIDogTWV0YSB7XHJcbiAgcmV0dXJuIHtcclxuICAgICAgICBEb21haW4gOiBmdW5jdGlvbihhIDogc3RyaW5nKSA6IElNZXRhIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBBTWV0YShcImRvbWFpblwiLCBhKTtcclxuICAgICAgICB9LFxyXG4gICAgICAgIENhdGVnb3J5IDogZnVuY3Rpb24oYSA6IHN0cmluZykgOiBJTWV0YSB7XHJcbiAgICAgICAgICAgIHJldHVybiBuZXcgQU1ldGEoXCJjYXRlZ29yeVwiLGEpO1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAgUmVsYXRpb24gOiBmdW5jdGlvbihhIDogc3RyaW5nKSA6IElNZXRhIHtcclxuICAgICAgICAgICAgcmV0dXJuIG5ldyBBTWV0YShcInJlbGF0aW9uXCIsYSk7XHJcbiAgICAgICAgfSxcclxuICAgICAgICBwYXJzZUlNZXRhIDogcGFyc2VBTWV0YVxyXG4gICB9O1xyXG59XHJcblxyXG4vKlxyXG5leHBvcnQgZnVuY3Rpb24gZ2V0Q2F0ZWdvcmllc0ZvckRvbWFpbih0aGVNb2RlbCA6IElNb2RlbHMsIGRvbWFpbiA6IHN0cmluZykgOiBzdHJpbmdbXSB7XHJcbiAgICBpZih0aGVNb2RlbC5kb21haW5zLmluZGV4T2YoZG9tYWluKSA8IDApIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJEb21haW4gXCIgKyBkb21haW4gKyBcIiBub3QgcGFydCBvZiBtb2RlbFwiKTtcclxuICAgIH1cclxuICAgIHRoZU1vZGVsLm1ldGEuZ2V0KE1ldGEuRG9tYWluKGRvbWFpbiksIE1ldGEuUmVsYXRpb24oXCJoYXNDYXRlZ29yeVwiKSk7XHJcbn1cclxuKi8iLCIvKipcbiAqIEZ1bmN0aW9uYWxpdHkgbWFuYWdpbmcgdGhlIG1hdGNoIG1vZGVsc1xuICpcbiAqIEBmaWxlXG4gKi9cblwidXNlIHN0cmljdFwiO1xudmFyIGRlYnVnID0gcmVxdWlyZShcImRlYnVnXCIpO1xudmFyIGRlYnVnbG9nID0gZGVidWcoJ21ldGEnKTtcbnZhciBsb2dnZXIgPSByZXF1aXJlKFwiLi4vdXRpbHMvbG9nZ2VyXCIpO1xudmFyIGxvYWRsb2cgPSBsb2dnZXIubG9nZ2VyKCdtb2RlbGxvYWQnLCAnJyk7XG4vKipcbiAqIHRoZSBtb2RlbCBwYXRoLCBtYXkgYmUgY29udHJvbGxlZCB2aWEgZW52aXJvbm1lbnQgdmFyaWFibGVcbiAqL1xudmFyIG1vZGVsUGF0aCA9IHByb2Nlc3MuZW52W1wiQUJPVF9NT0RFTFBBVEhcIl0gfHwgXCJ0ZXN0bW9kZWxcIjtcbnZhciBzZXBhcmF0b3IgPSBcIiAtOi0gXCI7XG52YXIgdmFsaWRUeXBlcyA9IFtcInJlbGF0aW9uXCIsIFwiY2F0ZWdvcnlcIiwgXCJkb21haW5cIl07XG52YXIgQU1ldGEgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIEFNZXRhKHR5cGUsIG5hbWUpIHtcbiAgICAgICAgaWYgKHZhbGlkVHlwZXMuaW5kZXhPZih0eXBlKSA8IDApIHtcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcIklsbGVnYWwgVHlwZSBcIiArIHR5cGUpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubmFtZSA9IG5hbWU7XG4gICAgICAgIHRoaXMudHlwZSA9IHR5cGU7XG4gICAgfVxuICAgIEFNZXRhLnByb3RvdHlwZS50b05hbWUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHJldHVybiB0aGlzLm5hbWU7XG4gICAgfTtcbiAgICBBTWV0YS5wcm90b3R5cGUudG9GdWxsU3RyaW5nID0gZnVuY3Rpb24gKCkge1xuICAgICAgICByZXR1cm4gdGhpcy50eXBlICsgc2VwYXJhdG9yICsgdGhpcy5uYW1lO1xuICAgIH07XG4gICAgQU1ldGEucHJvdG90eXBlLnRvVHlwZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudHlwZTtcbiAgICB9O1xuICAgIHJldHVybiBBTWV0YTtcbn0oKSk7XG5leHBvcnRzLkFNZXRhID0gQU1ldGE7XG5mdW5jdGlvbiBnZXRTdHJpbmdBcnJheShhcnIpIHtcbiAgICByZXR1cm4gYXJyLm1hcChmdW5jdGlvbiAob01ldGEpIHtcbiAgICAgICAgcmV0dXJuIG9NZXRhLnRvTmFtZSgpO1xuICAgIH0pO1xufVxuZXhwb3J0cy5nZXRTdHJpbmdBcnJheSA9IGdldFN0cmluZ0FycmF5O1xuZXhwb3J0cy5SRUxBVElPTl9oYXNDYXRlZ29yeSA9IFwiaGFzQ2F0ZWdvcnlcIjtcbmV4cG9ydHMuUkVMQVRJT05faXNDYXRlZ29yeU9mID0gXCJpc0NhdGVnb3J5T2ZcIjtcbmZ1bmN0aW9uIHBhcnNlQU1ldGEoYSkge1xuICAgIHZhciByID0gYS5zcGxpdChzZXBhcmF0b3IpO1xuICAgIGlmICghciB8fCByLmxlbmd0aCAhPT0gMikge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJjYW5ub3QgcGFyc2UgXCIgKyBhICsgXCIgYXMgTWV0YVwiKTtcbiAgICB9XG4gICAgc3dpdGNoIChyWzBdKSB7XG4gICAgICAgIGNhc2UgXCJjYXRlZ29yeVwiOlxuICAgICAgICAgICAgcmV0dXJuIGdldE1ldGFGYWN0b3J5KCkuQ2F0ZWdvcnkoclsxXSk7XG4gICAgICAgIGNhc2UgXCJyZWxhdGlvblwiOlxuICAgICAgICAgICAgcmV0dXJuIGdldE1ldGFGYWN0b3J5KCkuUmVsYXRpb24oclsxXSk7XG4gICAgICAgIGNhc2UgXCJkb21haW5cIjpcbiAgICAgICAgICAgIHJldHVybiBnZXRNZXRhRmFjdG9yeSgpLkRvbWFpbihyWzFdKTtcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihcInVua25vd24gbWV0YSB0eXBlXCIgKyByWzBdKTtcbiAgICB9XG59XG5mdW5jdGlvbiBnZXRNZXRhRmFjdG9yeSgpIHtcbiAgICByZXR1cm4ge1xuICAgICAgICBEb21haW46IGZ1bmN0aW9uIChhKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IEFNZXRhKFwiZG9tYWluXCIsIGEpO1xuICAgICAgICB9LFxuICAgICAgICBDYXRlZ29yeTogZnVuY3Rpb24gKGEpIHtcbiAgICAgICAgICAgIHJldHVybiBuZXcgQU1ldGEoXCJjYXRlZ29yeVwiLCBhKTtcbiAgICAgICAgfSxcbiAgICAgICAgUmVsYXRpb246IGZ1bmN0aW9uIChhKSB7XG4gICAgICAgICAgICByZXR1cm4gbmV3IEFNZXRhKFwicmVsYXRpb25cIiwgYSk7XG4gICAgICAgIH0sXG4gICAgICAgIHBhcnNlSU1ldGE6IHBhcnNlQU1ldGFcbiAgICB9O1xufVxuZXhwb3J0cy5nZXRNZXRhRmFjdG9yeSA9IGdldE1ldGFGYWN0b3J5O1xuLypcbmV4cG9ydCBmdW5jdGlvbiBnZXRDYXRlZ29yaWVzRm9yRG9tYWluKHRoZU1vZGVsIDogSU1vZGVscywgZG9tYWluIDogc3RyaW5nKSA6IHN0cmluZ1tdIHtcbiAgICBpZih0aGVNb2RlbC5kb21haW5zLmluZGV4T2YoZG9tYWluKSA8IDApIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRG9tYWluIFwiICsgZG9tYWluICsgXCIgbm90IHBhcnQgb2YgbW9kZWxcIik7XG4gICAgfVxuICAgIHRoZU1vZGVsLm1ldGEuZ2V0KE1ldGEuRG9tYWluKGRvbWFpbiksIE1ldGEuUmVsYXRpb24oXCJoYXNDYXRlZ29yeVwiKSk7XG59XG4qLyBcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
