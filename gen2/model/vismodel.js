/**
 * visualize a model and calculate some statistics
 */
"use strict";

var fs = require('fs');
var Model = require('./model');
var Util = require('../utils/utils');
var Describe = require('../match/describe');
var _ = require('lodash');
var debug = require('debug');
var debuglog = debug('vismodel.ts');
;
function calcCategoryRecord(m, category, domain) {
    var otherdomains = Model.getDomainsForCategory(m, category);
    _.pull(otherdomains, domain);
    var res = {
        otherdomains: otherdomains,
        nrDistinctValues: 0,
        nrDistinctValuesInDomain: 0,
        nrRecords: 0,
        nrRecordsInDomain: 0,
        nrTotalRecordsInDomain: 0
    };
    var values = [];
    var valuesInDomain = [];
    var nrRecordsInDomain = 0;
    var distinctValues = m.records.forEach(function (oEntry) {
        if (oEntry._domain === domain) {
            res.nrTotalRecordsInDomain += 1;
        }
        if (oEntry[category]) {
            var value = oEntry[category];
            if (oEntry._domain === domain) {
                valuesInDomain[value] = (valuesInDomain[value] || 0) + 1;
                res.nrRecordsInDomain += 1;
            }
            values[value] = (values[value] || 0) + 1;
            res.nrRecords += 1;
        }
    });
    res.nrDistinctValues = Object.keys(values).length;
    res.nrDistinctValuesInDomain = Object.keys(valuesInDomain).length;
    return res;
}
exports.calcCategoryRecord = calcCategoryRecord;
function graphDomain(domain, m) {
    // draw a model domains
    var res = "\n    digraph sdsu {\n\tsize=\"36,36\";\n   rankdir=LR\n\tnode [color=yellow, style=filled];\n    \"" + domain + "\"\n  ";
    // add all category nodes
    res += "node [shape=record, color=yellow, style=filled];\n ";
    var cats = Model.getCategoriesForDomain(m, domain);
    var categoryResults = {};
    var otherdomains = [];
    cats.forEach(function (cat) {
        var catResult = calcCategoryRecord(m, cat, domain);
        categoryResults[cat] = catResult;
        otherdomains = _.union(otherdomains, categoryResults[cat].otherDomains);
        res += "\"" + cat + "\" [label=\"{ " + cat + " | " + catResult.nrDistinctValuesInDomain + " Values in " + catResult.nrRecordsInDomain + " ";
        if (catResult.nrRecordsInDomain !== catResult.nrRecords) {
            res += "|  " + (catResult.nrDistinctValues - catResult.nrDistinctValuesInDomain) + " other values in " + (catResult.nrRecords - catResult.nrRecordsInDomain) + " other records";
        } else {
            res += " ";
        }
        res += "}\"]\n";
    });
    // calculate other domains.
    // draw "other categories"
    res += "node [color=purple, style=filled]; \n";
    otherdomains.forEach(function (otherdomain) {
        res += "\"" + otherdomain + "\" \n";
    });
    // count records in domain :
    var nrRecords = m.records.reduce(function (prev, entry) {
        return prev + (entry._domain === domain ? 1 : 0);
    }, 0);
    res += "node [shape=record]; \n";
    res += " \"record\" [label=\"{<f0> " + domain + " | " + nrRecords + "}\"] \n";
    res += " \"r_other\" [label=\"{<f0> other | " + nrRecords + "}\"] \n ";
    res += "# relation from categories to domain\n";
    cats.forEach(function (cat) {
        res += " \"" + cat + "\" -> \"" + domain + "\" \n";
    });
    res += "# relation from categories to records\n";
    cats.forEach(function (cat) {
        var rec = categoryResults[cat];
        res += " \"" + cat + "\" -> \"record\" \n";
    });
    //other domains to this
    cats.forEach(function (cat) {});
    /*
    cats fo
      digraph sdsu {
      size="36,36";
      node [color=yellow, style=filled];
      FLPD FLP "BOM Editor", "WIKIURL" "UI5 Documentation", "UI5 Example", "STARTTA"
      BCP
      node [color=grey, style=filled];
      node [fontname="Verdana", size="30,30"];
      node [color=grey, style=filled];
      graph [ fontname = "Arial",
    */
    res += "}\n";
    return res;
}
exports.graphDomain = graphDomain;
/*
    categoryDesc : theModel.full.domain[filterdomain].categories[category],
    distinct : distinct,
    delta : delta,
    presentRecords : recordCount.presentrecords,
    percPresent : percent,
    sampleValues : valuesList
  }
*/
function replaceBr(string) {
    string = string.replace(/\n/g, "\n\t\t\t\t\t\t\t\t\t\t\tbr\n\t\t\t\t\t\t\t\t\t\t\t| ");
    return string;
}
/**
 * generate a textual representation of a domain
 */
function tabDomain(domain, m) {
    // draw a model domains
    var cats = Model.getCategoriesForDomain(m, domain);
    //console.log(cats.join("\n"));
    var catdesc = Describe.getCategoryStatsInDomain(cats[0], domain, m);
    var catResult = calcCategoryRecord(m, cats[0], domain);
    var domainDescr = m.full.domain[domain].description || "";
    domainDescr = replaceBr(domainDescr);
    var res = "\n\n// preset form values if we receive a userdata object //\n- user = user\n\nextends ../layout_p\n\nblock content\n\n\tnav.navbar.navbar-default.navbar-fixed-top\n\t\t.container\n\t\t\t.navbar-header\n\t\t\t\t.navbar-brand(style='bgcolor:orange;color:darkblue;font-family:Arial Black;font-size:15.118px') wosap domain " + domain + "\n\t\t\tul.nav.navbar-nav.navbar-right #{uid}\n\t\t\t\tli\n\t\t\t\t\t.navbar-btn#btn-logout.btn.btn-default(onclick=\"location.href='/home'\")\n\t\t\t\t\t\t| back to home\n\n\tp  &nbsp;\n\tp &nbsp;\n\tp\n\n\tdiv.well\n\t\th3 domain \"" + domain + "\"\n\t\t\tspan.pull-right " + catResult.nrTotalRecordsInDomain + " records\n\t\tp\n\t\tspan " + domainDescr + "\n\n\t\ttable.table.table-condensed.table-striped\n\t\t\tthead\n\t\t\t\ttr\n\t\t\t\t\tth category\n\t\t\t\t\tth(style=\"width:10%\") count\n\t\t\t\t\tth\n\t\t\t\t\t\ttable\n\t\t\t\t\t\t\ttr\n\t\t\t\t\t\t\t\ttd synonyms\n\t\t\t\t\t\t\ttr\n\t\t\t\t\t\t\t\ttd description\n\t\t\t\t\t\t\ttr\n\t\t\t\t\t\t\t\ttd example values\n\t\t\ttbody\n";
    var categoryResults = {};
    var otherdomains = [];
    cats.forEach(function (cat) {
        var catdesc = Describe.getCategoryStatsInDomain(cat, domain, m);
        //console.log(JSON.stringify(catdesc));
        var catResult = calcCategoryRecord(m, cat, domain);
        categoryResults[cat] = catResult;
        otherdomains = _.union(otherdomains, categoryResults[cat].otherDomains);
        /*
            res += `"${cat}" [label="{ ${cat} | ${catResult.nrDistinctValuesInDomain} Values in ${catResult.nrRecordsInDomain} `;
            if(catResult.nrRecordsInDomain !== catResult.nrRecords) {
              res +=  `|  ${catResult.nrDistinctValues - catResult.nrDistinctValuesInDomain} other values in ${catResult.nrRecords - catResult.nrRecordsInDomain} other records`;
            } else {
              res += ` `;
            }
            res += `}"]\n`;
        */
        //console.log(JSON.stringify(m.full.domain[domain]));
        if (m.full.domain[domain].categories[cat]) {
            var synonymsString = Util.listToCommaAnd(catdesc.categoryDesc && catdesc.categoryDesc.synonyms && catdesc.categoryDesc.synonyms || []) || "&nbsp;";
            res += "\n\t\t\ttr\n\t\t\t\t\ttd.cat_count " + cat + "\n\t\t\t\t\ttd " + catdesc.presentRecords + " distinct values in " + catdesc.percPresent + "% of records\n\t\t\t\t\ttd\n\t\t\t\t\t\ttable\n\t\t\t\t\t\t\ttr.cat_synonyms\n\t\t\t\t\t\t\t\ttd " + synonymsString + "\n\t\t\t\t\t\t\ttr.cat_description\n\t\t\t\t\t\t\t\ttd " + replaceBr(catdesc.categoryDesc && catdesc.categoryDesc.description || "") + "\n\t\t\t\t\t\t\ttr.cat_samplevalues\n\t\t\t\t\t\t\t\ttd " + replaceBr(catdesc.sampleValues) + "\n      ";
        }
    });
    var othercats = cats.length - Object.keys(m.full.domain[domain].categories).length;
    if (othercats > 0) {
        res += "\n\t\tp   and " + othercats + " other categories\n       ";
    }
    /*
      // calculate other domains.
      // draw "other categories"
      res += `node [color=purple, style=filled]; \n`
      otherdomains.forEach(function(otherdomain) {
        res += `"${otherdomain}" \n`;
      });
      // count records in domain :
      var nrRecords = m.records.reduce(function(prev,entry) {
      return prev + ((entry._domain === domain) ? 1 : 0);
      },0);
      res += `node [shape=record]; \n`
      res += ` "record" [label="{<f0> ${domain} | ${nrRecords}}"] \n`;
    
      res += ` "r_other" [label="{<f0> other | ${nrRecords}}"] \n `;
    
      res += `# relation from categories to domain\n`;
      cats.forEach(function(cat) {
        res += ` "${cat}" -> "${domain}" \n`;
      })
    
    
      res += `# relation from categories to records\n`;
      cats.forEach(function(cat) {
        var rec = categoryResults[cat];
        res += ` "${cat}" -> "record" \n`;
      })
    
    
      //other domains to this
      cats.forEach(function(cat) {
    
    
      })
    */
    /*
    cats fo
      digraph sdsu {
      size="36,36";
      node [color=yellow, style=filled];
      FLPD FLP "BOM Editor", "WIKIURL" "UI5 Documentation", "UI5 Example", "STARTTA"
      BCP
      node [color=grey, style=filled];
      node [fontname="Verdana", size="30,30"];
      node [color=grey, style=filled];
      graph [ fontname = "Arial",
    */
    res += "\n\t\th3 Version\n\t\t\ta.small(href=\"/whatsnew\")\n\n\nblock scripts\n\tscript(src='/vendor/jquery-2.2.3.min.js')\n\tscript(src='/vendor/bootstrap.min.js')\n\tscript(src='/js/views/settings.js')\n";
    return res;
}
exports.tabDomain = tabDomain;
var child_process_1 = require('child_process');
function execCmd(cmd) {
    child_process_1.exec(cmd, function (error, stdout, stderr) {
        if (error) {
            console.error("exec error: " + error);
            return;
        }
        console.log("stdout: " + stdout);
        console.log("stderr: " + stderr);
    });
}
;
function visModels(m, folderOut) {
    m.domains.forEach(function (sDomain) {
        var s = graphDomain(sDomain, m);
        var fnGraph = folderOut + "/" + sDomain.replace(/ /g, '_') + ".gv";
        fs.writeFileSync(fnGraph, s);
        if (process.env.GRAPHVIZ) {
            console.log("here the file " + fnGraph);
            execCmd(process.env.GRAPHVIZ + " -Tjpeg -O " + fnGraph);
        }
    });
}
exports.visModels = visModels;
function tabModels(m, folderOut) {
    m.domains.forEach(function (sDomain) {
        var s = tabDomain(sDomain, m);
        var fnGraph = folderOut + "/" + sDomain.replace(/ /g, '_') + ".jade";
        debuglog("here the file " + fnGraph);
        fs.writeFileSync(fnGraph, s);
    });
}
exports.tabModels = tabModels;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9tb2RlbC92aXNtb2RlbC50cyIsIm1vZGVsL3Zpc21vZGVsLmpzIl0sIm5hbWVzIjpbImZzIiwicmVxdWlyZSIsIk1vZGVsIiwiVXRpbCIsIkRlc2NyaWJlIiwiXyIsImRlYnVnIiwiZGVidWdsb2ciLCJjYWxjQ2F0ZWdvcnlSZWNvcmQiLCJtIiwiY2F0ZWdvcnkiLCJkb21haW4iLCJvdGhlcmRvbWFpbnMiLCJnZXREb21haW5zRm9yQ2F0ZWdvcnkiLCJwdWxsIiwicmVzIiwibnJEaXN0aW5jdFZhbHVlcyIsIm5yRGlzdGluY3RWYWx1ZXNJbkRvbWFpbiIsIm5yUmVjb3JkcyIsIm5yUmVjb3Jkc0luRG9tYWluIiwibnJUb3RhbFJlY29yZHNJbkRvbWFpbiIsInZhbHVlcyIsInZhbHVlc0luRG9tYWluIiwiZGlzdGluY3RWYWx1ZXMiLCJyZWNvcmRzIiwiZm9yRWFjaCIsIm9FbnRyeSIsIl9kb21haW4iLCJ2YWx1ZSIsIk9iamVjdCIsImtleXMiLCJsZW5ndGgiLCJleHBvcnRzIiwiZ3JhcGhEb21haW4iLCJjYXRzIiwiZ2V0Q2F0ZWdvcmllc0ZvckRvbWFpbiIsImNhdGVnb3J5UmVzdWx0cyIsImNhdCIsImNhdFJlc3VsdCIsInVuaW9uIiwib3RoZXJEb21haW5zIiwib3RoZXJkb21haW4iLCJyZWR1Y2UiLCJwcmV2IiwiZW50cnkiLCJyZWMiLCJyZXBsYWNlQnIiLCJzdHJpbmciLCJyZXBsYWNlIiwidGFiRG9tYWluIiwiY2F0ZGVzYyIsImdldENhdGVnb3J5U3RhdHNJbkRvbWFpbiIsImRvbWFpbkRlc2NyIiwiZnVsbCIsImRlc2NyaXB0aW9uIiwiY2F0ZWdvcmllcyIsInN5bm9ueW1zU3RyaW5nIiwibGlzdFRvQ29tbWFBbmQiLCJjYXRlZ29yeURlc2MiLCJzeW5vbnltcyIsInByZXNlbnRSZWNvcmRzIiwicGVyY1ByZXNlbnQiLCJzYW1wbGVWYWx1ZXMiLCJvdGhlcmNhdHMiLCJjaGlsZF9wcm9jZXNzXzEiLCJleGVjQ21kIiwiY21kIiwiZXhlYyIsImVycm9yIiwic3Rkb3V0Iiwic3RkZXJyIiwiY29uc29sZSIsImxvZyIsInZpc01vZGVscyIsImZvbGRlck91dCIsImRvbWFpbnMiLCJzRG9tYWluIiwicyIsImZuR3JhcGgiLCJ3cml0ZUZpbGVTeW5jIiwicHJvY2VzcyIsImVudiIsIkdSQVBIVklaIiwidGFiTW9kZWxzIl0sIm1hcHBpbmdzIjoiQUFBQTs7O0FDR0E7O0FETUEsSUFBWUEsS0FBRUMsUUFBTSxJQUFOLENBQWQ7QUFFQSxJQUFZQyxRQUFLRCxRQUFNLFNBQU4sQ0FBakI7QUFDQSxJQUFZRSxPQUFJRixRQUFNLGdCQUFOLENBQWhCO0FBRUEsSUFBWUcsV0FBUUgsUUFBTSxtQkFBTixDQUFwQjtBQUVBLElBQVlJLElBQUNKLFFBQU0sUUFBTixDQUFiO0FBQ0EsSUFBWUssUUFBS0wsUUFBTSxPQUFOLENBQWpCO0FBQ0EsSUFBSU0sV0FBV0QsTUFBTSxhQUFOLENBQWY7QUFTRztBQUVILFNBQUFFLGtCQUFBLENBQW1DQyxDQUFuQyxFQUF1REMsUUFBdkQsRUFBMEVDLE1BQTFFLEVBQXlGO0FBRXZGLFFBQUlDLGVBQWVWLE1BQU1XLHFCQUFOLENBQTRCSixDQUE1QixFQUE4QkMsUUFBOUIsQ0FBbkI7QUFDQ0wsTUFBRVMsSUFBRixDQUFPRixZQUFQLEVBQXFCRCxNQUFyQjtBQUNBLFFBQUlJLE1BQU07QUFDVEgsc0JBQWVBLFlBRE47QUFFVEksMEJBQW1CLENBRlY7QUFHVEMsa0NBQTJCLENBSGxCO0FBSVRDLG1CQUFZLENBSkg7QUFLVEMsMkJBQW1CLENBTFY7QUFNVEMsZ0NBQXlCO0FBTmhCLEtBQVY7QUFTQSxRQUFJQyxTQUFTLEVBQWI7QUFDQSxRQUFJQyxpQkFBaUIsRUFBckI7QUFDQSxRQUFJSCxvQkFBb0IsQ0FBeEI7QUFDQSxRQUFJSSxpQkFBaUJkLEVBQUVlLE9BQUYsQ0FBVUMsT0FBVixDQUFrQixVQUFTQyxNQUFULEVBQWU7QUFDcEQsWUFBR0EsT0FBT0MsT0FBUCxLQUFtQmhCLE1BQXRCLEVBQThCO0FBQzVCSSxn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QUFrQkUsUUFBUTVCLE9BQVIsQ0FBZ0IsSUFBaEIsRUFBcUIsR0FBckIsQ0FBbEIsR0FBOEMsS0FBNUQ7QUFDQWhELFdBQUcrRSxhQUFILENBQWlCRCxPQUFqQixFQUEwQkQsQ0FBMUI7QUFDQSxZQUFHRyxRQUFRQyxHQUFSLENBQVlDLFFBQWYsRUFBeUI7QUFDdkJYLG9CQUFRQyxHQUFSLENBQVksbUJBQW1CTSxPQUEvQjtBQUNBYixvQkFBUWUsUUFBUUMsR0FBUixDQUFZQyxRQUFaLEdBQXVCLGFBQXZCLEdBQXVDSixPQUEvQztBQUNEO0FBQ0YsS0FSRDtBQVNEO0FBVmU5QyxRQUFBeUMsU0FBQSxHQUFTQSxTQUFUO0FBWWhCLFNBQUFVLFNBQUEsQ0FBMEIxRSxDQUExQixFQUE4Q2lFLFNBQTlDLEVBQWdFO0FBQzlEakUsTUFBRWtFLE9BQUYsQ0FBVWxELE9BQVYsQ0FBa0IsVUFBU21ELE9BQVQsRUFBZ0I7QUFDaEMsWUFBSUMsSUFBSTVCLFVBQVUyQixPQUFWLEVBQWtCbkUsQ0FBbEIsQ0FBUjtBQUNBLFlBQUlxRSxVQUFVSixZQUFZLEdBQVosR0FBa0JFLFFBQVE1QixPQUFSLENBQWdCLElBQWhCLEVBQXFCLEdBQXJCLENBQWxCLEdBQThDLE9BQTVEO0FBQ0F6QyxpQkFBUyxtQkFBbUJ1RSxPQUE1QjtBQUNBOUUsV0FBRytFLGFBQUgsQ0FBaUJELE9BQWpCLEVBQTBCRCxDQUExQjtBQUNELEtBTEQ7QUFNRDtBQVBlN0MsUUFBQW1ELFNBQUEsR0FBU0EsU0FBVCIsImZpbGUiOiJtb2RlbC92aXNtb2RlbC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogdmlzdWFsaXplIGEgbW9kZWwgYW5kIGNhbGN1bGF0ZSBzb21lIHN0YXRpc3RpY3NcbiAqL1xuXG5cblxuaW1wb3J0ICogYXMgSU1hdGNoIGZyb20gJy4uL21hdGNoL2lmbWF0Y2gnO1xuXG5cbmltcG9ydCAqIGFzIGZzIGZyb20gJ2ZzJztcblxuaW1wb3J0ICogYXMgTW9kZWwgZnJvbSAnLi9tb2RlbCc7XG5pbXBvcnQgKiBhcyBVdGlsIGZyb20gJy4uL3V0aWxzL3V0aWxzJztcblxuaW1wb3J0ICogYXMgRGVzY3JpYmUgZnJvbSAnLi4vbWF0Y2gvZGVzY3JpYmUnO1xuXG5pbXBvcnQgKiBhcyBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgKiBhcyBkZWJ1ZyBmcm9tICdkZWJ1Zyc7XG52YXIgZGVidWdsb2cgPSBkZWJ1ZygndmlzbW9kZWwudHMnKTtcblxuaW50ZXJmYWNlIENhdGVnb3J5UmVjb3JkIHtcbiAgICBvdGhlcmRvbWFpbnMgOiBzdHJpbmdbXSxcbiAgICBuckRpc3RpbmN0VmFsdWVzIDogbnVtYmVyLFxuICAgIG5yRGlzdGluY3RWYWx1ZXNJbkRvbWFpbiA6IG51bWJlcixcbiAgICBuclJlY29yZHMgOiBudW1iZXIsXG4gICAgbnJSZWNvcmRzSW5Eb21haW46IG51bWJlcixcbiAgICBuclRvdGFsUmVjb3Jkc0luRG9tYWluIDogbnVtYmVyXG4gIH07XG5cbmV4cG9ydCBmdW5jdGlvbiBjYWxjQ2F0ZWdvcnlSZWNvcmQobSA6IElNYXRjaC5JTW9kZWxzLCBjYXRlZ29yeSA6IHN0cmluZywgZG9tYWluIDogc3RyaW5nKSAgOiBDYXRlZ29yeVJlY29yZCB7XG5cbiAgdmFyIG90aGVyZG9tYWlucyA9IE1vZGVsLmdldERvbWFpbnNGb3JDYXRlZ29yeShtLGNhdGVnb3J5KTtcbiAgIF8ucHVsbChvdGhlcmRvbWFpbnMsIGRvbWFpbik7XG4gICB2YXIgcmVzID0ge1xuICAgIG90aGVyZG9tYWlucyA6IG90aGVyZG9tYWlucyxcbiAgICBuckRpc3RpbmN0VmFsdWVzIDogMCxcbiAgICBuckRpc3RpbmN0VmFsdWVzSW5Eb21haW4gOiAwLFxuICAgIG5yUmVjb3JkcyA6IDAsXG4gICAgbnJSZWNvcmRzSW5Eb21haW46IDAsXG4gICAgbnJUb3RhbFJlY29yZHNJbkRvbWFpbiA6IDAsXG4gIH0gYXMgQ2F0ZWdvcnlSZWNvcmQ7XG5cbiAgIHZhciB2YWx1ZXMgPSBbXTtcbiAgIHZhciB2YWx1ZXNJbkRvbWFpbiA9IFtdO1xuICAgdmFyIG5yUmVjb3Jkc0luRG9tYWluID0gMDtcbiAgIHZhciBkaXN0aW5jdFZhbHVlcyA9IG0ucmVjb3Jkcy5mb3JFYWNoKGZ1bmN0aW9uKG9FbnRyeSkge1xuICAgICBpZihvRW50cnkuX2RvbWFpbiA9PT0gZG9tYWluKSB7XG4gICAgICAgcmVzLm5yVG90YWxSZWNvcmRzSW5Eb21haW4gKz0gMTtcbiAgICAgfVxuICAgICBpZiAob0VudHJ5W2NhdGVnb3J5XSkge1xuICAgICAgIHZhciB2YWx1ZSA9IG9FbnRyeVtjYXRlZ29yeV07XG4gICAgICAgaWYob0VudHJ5Ll9kb21haW4gPT09IGRvbWFpbikge1xuICAgICAgICAgdmFsdWVzSW5Eb21haW5bdmFsdWVdID0gKHZhbHVlc0luRG9tYWluW3ZhbHVlXSB8fCAwKSArIDE7XG4gICAgICAgICByZXMubnJSZWNvcmRzSW5Eb21haW4gKz0gMTtcbiAgICAgICB9XG4gICAgICB2YWx1ZXNbdmFsdWVdID0gKHZhbHVlc1t2YWx1ZV0gfHwgMCkgKyAxO1xuICAgICAgIHJlcy5uclJlY29yZHMgKz0gMTtcbiAgICAgfVxuICAgfSk7XG4gICByZXMubnJEaXN0aW5jdFZhbHVlcyA9IE9iamVjdC5rZXlzKHZhbHVlcykubGVuZ3RoO1xuICAgcmVzLm5yRGlzdGluY3RWYWx1ZXNJbkRvbWFpbiA9IE9iamVjdC5rZXlzKHZhbHVlc0luRG9tYWluKS5sZW5ndGg7XG4gICByZXR1cm4gcmVzO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZ3JhcGhEb21haW4oZG9tYWluIDogc3RyaW5nLCBtIDogSU1hdGNoLklNb2RlbHMpIHtcbiAgLy8gZHJhdyBhIG1vZGVsIGRvbWFpbnNcbiAgdmFyIHJlcyA9IGBcbiAgICBkaWdyYXBoIHNkc3Uge1xuXHRzaXplPVwiMzYsMzZcIjtcbiAgIHJhbmtkaXI9TFJcblx0bm9kZSBbY29sb3I9eWVsbG93LCBzdHlsZT1maWxsZWRdO1xuICAgIFwiJHtkb21haW59XCJcbiAgYDtcbiAgLy8gYWRkIGFsbCBjYXRlZ29yeSBub2Rlc1xuICByZXMgKz0gYG5vZGUgW3NoYXBlPXJlY29yZCwgY29sb3I9eWVsbG93LCBzdHlsZT1maWxsZWRdO1xcbiBgXG4gIHZhciBjYXRzID0gTW9kZWwuZ2V0Q2F0ZWdvcmllc0ZvckRvbWFpbihtLGRvbWFpbik7XG5cbiAgdmFyIGNhdGVnb3J5UmVzdWx0cyA9IHt9O1xuICB2YXIgb3RoZXJkb21haW5zID0gW107XG4gIGNhdHMuZm9yRWFjaChmdW5jdGlvbihjYXQpIHtcbiAgICB2YXIgY2F0UmVzdWx0ID0gY2FsY0NhdGVnb3J5UmVjb3JkKG0sIGNhdCwgZG9tYWluKTtcbiAgICBjYXRlZ29yeVJlc3VsdHNbY2F0XSA9IGNhdFJlc3VsdDtcbiAgICBvdGhlcmRvbWFpbnMgPSBfLnVuaW9uKG90aGVyZG9tYWlucywgY2F0ZWdvcnlSZXN1bHRzW2NhdF0ub3RoZXJEb21haW5zKTtcbiAgICByZXMgKz0gYFwiJHtjYXR9XCIgW2xhYmVsPVwieyAke2NhdH0gfCAke2NhdFJlc3VsdC5uckRpc3RpbmN0VmFsdWVzSW5Eb21haW59IFZhbHVlcyBpbiAke2NhdFJlc3VsdC5uclJlY29yZHNJbkRvbWFpbn0gYDtcbiAgICBpZihjYXRSZXN1bHQubnJSZWNvcmRzSW5Eb21haW4gIT09IGNhdFJlc3VsdC5uclJlY29yZHMpIHtcbiAgICAgIHJlcyArPSAgYHwgICR7Y2F0UmVzdWx0Lm5yRGlzdGluY3RWYWx1ZXMgLSBjYXRSZXN1bHQubnJEaXN0aW5jdFZhbHVlc0luRG9tYWlufSBvdGhlciB2YWx1ZXMgaW4gJHtjYXRSZXN1bHQubnJSZWNvcmRzIC0gY2F0UmVzdWx0Lm5yUmVjb3Jkc0luRG9tYWlufSBvdGhlciByZWNvcmRzYDtcbiAgICB9IGVsc2Uge1xuICAgICAgcmVzICs9IGAgYDtcbiAgICB9XG4gICAgcmVzICs9IGB9XCJdXFxuYDtcbiAgfSk7XG5cbiAgLy8gY2FsY3VsYXRlIG90aGVyIGRvbWFpbnMuXG4gIC8vIGRyYXcgXCJvdGhlciBjYXRlZ29yaWVzXCJcbiAgcmVzICs9IGBub2RlIFtjb2xvcj1wdXJwbGUsIHN0eWxlPWZpbGxlZF07IFxcbmBcbiAgb3RoZXJkb21haW5zLmZvckVhY2goZnVuY3Rpb24ob3RoZXJkb21haW4pIHtcbiAgICByZXMgKz0gYFwiJHtvdGhlcmRvbWFpbn1cIiBcXG5gO1xuICB9KTtcbiAgLy8gY291bnQgcmVjb3JkcyBpbiBkb21haW4gOlxuICB2YXIgbnJSZWNvcmRzID0gbS5yZWNvcmRzLnJlZHVjZShmdW5jdGlvbihwcmV2LGVudHJ5KSB7XG4gIHJldHVybiBwcmV2ICsgKChlbnRyeS5fZG9tYWluID09PSBkb21haW4pID8gMSA6IDApO1xuICB9LDApO1xuICByZXMgKz0gYG5vZGUgW3NoYXBlPXJlY29yZF07IFxcbmBcbiAgcmVzICs9IGAgXCJyZWNvcmRcIiBbbGFiZWw9XCJ7PGYwPiAke2RvbWFpbn0gfCAke25yUmVjb3Jkc319XCJdIFxcbmA7XG5cbiAgcmVzICs9IGAgXCJyX290aGVyXCIgW2xhYmVsPVwiezxmMD4gb3RoZXIgfCAke25yUmVjb3Jkc319XCJdIFxcbiBgO1xuXG4gIHJlcyArPSBgIyByZWxhdGlvbiBmcm9tIGNhdGVnb3JpZXMgdG8gZG9tYWluXFxuYDtcbiAgY2F0cy5mb3JFYWNoKGZ1bmN0aW9uKGNhdCkge1xuICAgIHJlcyArPSBgIFwiJHtjYXR9XCIgLT4gXCIke2RvbWFpbn1cIiBcXG5gO1xuICB9KVxuXG5cbiAgcmVzICs9IGAjIHJlbGF0aW9uIGZyb20gY2F0ZWdvcmllcyB0byByZWNvcmRzXFxuYDtcbiAgY2F0cy5mb3JFYWNoKGZ1bmN0aW9uKGNhdCkge1xuICAgIHZhciByZWMgPSBjYXRlZ29yeVJlc3VsdHNbY2F0XTtcbiAgICByZXMgKz0gYCBcIiR7Y2F0fVwiIC0+IFwicmVjb3JkXCIgXFxuYDtcbiAgfSlcblxuXG4gIC8vb3RoZXIgZG9tYWlucyB0byB0aGlzXG4gIGNhdHMuZm9yRWFjaChmdW5jdGlvbihjYXQpIHtcblxuXG4gIH0pXG5cbiAgLypcbiAgY2F0cyBmb1xuICAgIGRpZ3JhcGggc2RzdSB7XG5cdHNpemU9XCIzNiwzNlwiO1xuXHRub2RlIFtjb2xvcj15ZWxsb3csIHN0eWxlPWZpbGxlZF07XG5cdEZMUEQgRkxQIFwiQk9NIEVkaXRvclwiLCBcIldJS0lVUkxcIiBcIlVJNSBEb2N1bWVudGF0aW9uXCIsIFwiVUk1IEV4YW1wbGVcIiwgXCJTVEFSVFRBXCJcblx0QkNQXG5cdG5vZGUgW2NvbG9yPWdyZXksIHN0eWxlPWZpbGxlZF07XG5cdG5vZGUgW2ZvbnRuYW1lPVwiVmVyZGFuYVwiLCBzaXplPVwiMzAsMzBcIl07XG5cdG5vZGUgW2NvbG9yPWdyZXksIHN0eWxlPWZpbGxlZF07XG5cdGdyYXBoIFsgZm9udG5hbWUgPSBcIkFyaWFsXCIsXG4gICovXG4gIHJlcyArPSBgfVxcbmA7XG4gIHJldHVybiByZXM7XG59XG4vKlxuICAgIGNhdGVnb3J5RGVzYyA6IHRoZU1vZGVsLmZ1bGwuZG9tYWluW2ZpbHRlcmRvbWFpbl0uY2F0ZWdvcmllc1tjYXRlZ29yeV0sXG4gICAgZGlzdGluY3QgOiBkaXN0aW5jdCxcbiAgICBkZWx0YSA6IGRlbHRhLFxuICAgIHByZXNlbnRSZWNvcmRzIDogcmVjb3JkQ291bnQucHJlc2VudHJlY29yZHMsXG4gICAgcGVyY1ByZXNlbnQgOiBwZXJjZW50LFxuICAgIHNhbXBsZVZhbHVlcyA6IHZhbHVlc0xpc3RcbiAgfVxuKi9cblxuZnVuY3Rpb24gcmVwbGFjZUJyKHN0cmluZyA6IHN0cmluZyApIDogc3RyaW5nIHtcbiAgc3RyaW5nID0gc3RyaW5nLnJlcGxhY2UoL1xcbi9nLFxuICAgYFxuXFx0XFx0XFx0XFx0XFx0XFx0XFx0XFx0XFx0XFx0XFx0YnJcblxcdFxcdFxcdFxcdFxcdFxcdFxcdFxcdFxcdFxcdFxcdHwgYFxuICAgKTtcbiAgIHJldHVybiBzdHJpbmc7XG59XG5cbi8qKlxuICogZ2VuZXJhdGUgYSB0ZXh0dWFsIHJlcHJlc2VudGF0aW9uIG9mIGEgZG9tYWluXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB0YWJEb21haW4oZG9tYWluIDogc3RyaW5nLCBtIDogSU1hdGNoLklNb2RlbHMpIHtcbiAgLy8gZHJhdyBhIG1vZGVsIGRvbWFpbnNcblxuICB2YXIgY2F0cyA9IE1vZGVsLmdldENhdGVnb3JpZXNGb3JEb21haW4obSxkb21haW4pO1xuICAvL2NvbnNvbGUubG9nKGNhdHMuam9pbihcIlxcblwiKSk7XG4gIHZhciBjYXRkZXNjID0gRGVzY3JpYmUuZ2V0Q2F0ZWdvcnlTdGF0c0luRG9tYWluKGNhdHNbMF0sZG9tYWluLG0pO1xuICB2YXIgY2F0UmVzdWx0ID0gY2FsY0NhdGVnb3J5UmVjb3JkKG0sIGNhdHNbMF0sIGRvbWFpbik7XG5cbiAgdmFyIGRvbWFpbkRlc2NyID0gbS5mdWxsLmRvbWFpbltkb21haW5dLmRlc2NyaXB0aW9uIHx8IFwiXCI7XG4gIGRvbWFpbkRlc2NyID0gcmVwbGFjZUJyKGRvbWFpbkRlc2NyKTtcbiAgdmFyIHJlcyA9IGBcblxuLy8gcHJlc2V0IGZvcm0gdmFsdWVzIGlmIHdlIHJlY2VpdmUgYSB1c2VyZGF0YSBvYmplY3QgLy9cbi0gdXNlciA9IHVzZXJcblxuZXh0ZW5kcyAuLi9sYXlvdXRfcFxuXG5ibG9jayBjb250ZW50XG5cblx0bmF2Lm5hdmJhci5uYXZiYXItZGVmYXVsdC5uYXZiYXItZml4ZWQtdG9wXG5cdFx0LmNvbnRhaW5lclxuXHRcdFx0Lm5hdmJhci1oZWFkZXJcblx0XHRcdFx0Lm5hdmJhci1icmFuZChzdHlsZT0nYmdjb2xvcjpvcmFuZ2U7Y29sb3I6ZGFya2JsdWU7Zm9udC1mYW1pbHk6QXJpYWwgQmxhY2s7Zm9udC1zaXplOjE1LjExOHB4Jykgd29zYXAgZG9tYWluICR7ZG9tYWlufVxuXHRcdFx0dWwubmF2Lm5hdmJhci1uYXYubmF2YmFyLXJpZ2h0ICN7dWlkfVxuXHRcdFx0XHRsaVxuXHRcdFx0XHRcdC5uYXZiYXItYnRuI2J0bi1sb2dvdXQuYnRuLmJ0bi1kZWZhdWx0KG9uY2xpY2s9XCJsb2NhdGlvbi5ocmVmPScvaG9tZSdcIilcblx0XHRcdFx0XHRcdHwgYmFjayB0byBob21lXG5cblx0cCAgJm5ic3A7XG5cdHAgJm5ic3A7XG5cdHBcblxuXHRkaXYud2VsbFxuXHRcdGgzIGRvbWFpbiBcIiR7ZG9tYWlufVwiXG5cdFx0XHRzcGFuLnB1bGwtcmlnaHQgJHtjYXRSZXN1bHQubnJUb3RhbFJlY29yZHNJbkRvbWFpbn0gcmVjb3Jkc1xuXHRcdHBcblx0XHRzcGFuICR7ZG9tYWluRGVzY3J9XG5cblx0XHR0YWJsZS50YWJsZS50YWJsZS1jb25kZW5zZWQudGFibGUtc3RyaXBlZFxuXHRcdFx0dGhlYWRcblx0XHRcdFx0dHJcblx0XHRcdFx0XHR0aCBjYXRlZ29yeVxuXHRcdFx0XHRcdHRoKHN0eWxlPVwid2lkdGg6MTAlXCIpIGNvdW50XG5cdFx0XHRcdFx0dGhcblx0XHRcdFx0XHRcdHRhYmxlXG5cdFx0XHRcdFx0XHRcdHRyXG5cdFx0XHRcdFx0XHRcdFx0dGQgc3lub255bXNcblx0XHRcdFx0XHRcdFx0dHJcblx0XHRcdFx0XHRcdFx0XHR0ZCBkZXNjcmlwdGlvblxuXHRcdFx0XHRcdFx0XHR0clxuXHRcdFx0XHRcdFx0XHRcdHRkIGV4YW1wbGUgdmFsdWVzXG5cdFx0XHR0Ym9keVxuYDtcblxuICB2YXIgY2F0ZWdvcnlSZXN1bHRzID0ge307XG4gIHZhciBvdGhlcmRvbWFpbnMgPSBbXTtcbiAgY2F0cy5mb3JFYWNoKGZ1bmN0aW9uKGNhdCkge1xuICAgIHZhciBjYXRkZXNjID0gRGVzY3JpYmUuZ2V0Q2F0ZWdvcnlTdGF0c0luRG9tYWluKGNhdCxkb21haW4sbSk7XG4gICAgLy9jb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeShjYXRkZXNjKSk7XG4gICAgdmFyIGNhdFJlc3VsdCA9IGNhbGNDYXRlZ29yeVJlY29yZChtLCBjYXQsIGRvbWFpbik7XG4gICAgY2F0ZWdvcnlSZXN1bHRzW2NhdF0gPSBjYXRSZXN1bHQ7XG4gICAgb3RoZXJkb21haW5zID0gXy51bmlvbihvdGhlcmRvbWFpbnMsIGNhdGVnb3J5UmVzdWx0c1tjYXRdLm90aGVyRG9tYWlucyk7XG4vKlxuICAgIHJlcyArPSBgXCIke2NhdH1cIiBbbGFiZWw9XCJ7ICR7Y2F0fSB8ICR7Y2F0UmVzdWx0Lm5yRGlzdGluY3RWYWx1ZXNJbkRvbWFpbn0gVmFsdWVzIGluICR7Y2F0UmVzdWx0Lm5yUmVjb3Jkc0luRG9tYWlufSBgO1xuICAgIGlmKGNhdFJlc3VsdC5uclJlY29yZHNJbkRvbWFpbiAhPT0gY2F0UmVzdWx0Lm5yUmVjb3Jkcykge1xuICAgICAgcmVzICs9ICBgfCAgJHtjYXRSZXN1bHQubnJEaXN0aW5jdFZhbHVlcyAtIGNhdFJlc3VsdC5uckRpc3RpbmN0VmFsdWVzSW5Eb21haW59IG90aGVyIHZhbHVlcyBpbiAke2NhdFJlc3VsdC5uclJlY29yZHMgLSBjYXRSZXN1bHQubnJSZWNvcmRzSW5Eb21haW59IG90aGVyIHJlY29yZHNgO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXMgKz0gYCBgO1xuICAgIH1cbiAgICByZXMgKz0gYH1cIl1cXG5gO1xuKi9cbiAgICAvL2NvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KG0uZnVsbC5kb21haW5bZG9tYWluXSkpO1xuICAgIGlmKG0uZnVsbC5kb21haW5bZG9tYWluXS5jYXRlZ29yaWVzW2NhdF0pIHtcblxuICAgIHZhciBzeW5vbnltc1N0cmluZyA9IFV0aWwubGlzdFRvQ29tbWFBbmQoIGNhdGRlc2MuY2F0ZWdvcnlEZXNjICYmIGNhdGRlc2MuY2F0ZWdvcnlEZXNjLnN5bm9ueW1zICYmIGNhdGRlc2MuY2F0ZWdvcnlEZXNjLnN5bm9ueW1zIHx8IFtdICkgfHwgXCImbmJzcDtcIjtcblxuICAgIHJlcyArPSBgXG5cdFx0XHR0clxuXHRcdFx0XHRcdHRkLmNhdF9jb3VudCAke2NhdH1cblxcdFxcdFxcdFxcdFxcdHRkICR7Y2F0ZGVzYy5wcmVzZW50UmVjb3Jkc30gZGlzdGluY3QgdmFsdWVzIGluICR7Y2F0ZGVzYy5wZXJjUHJlc2VudH0lIG9mIHJlY29yZHNcblxcdFxcdFxcdFxcdFxcdHRkXG5cXHRcXHRcXHRcXHRcXHRcXHR0YWJsZVxuXFx0XFx0XFx0XFx0XFx0XFx0XFx0dHIuY2F0X3N5bm9ueW1zXG5cXHRcXHRcXHRcXHRcXHRcXHRcXHRcXHR0ZCAke3N5bm9ueW1zU3RyaW5nfVxuXFx0XFx0XFx0XFx0XFx0XFx0XFx0dHIuY2F0X2Rlc2NyaXB0aW9uXG5cXHRcXHRcXHRcXHRcXHRcXHRcXHRcXHR0ZCAke3JlcGxhY2VCcihjYXRkZXNjLmNhdGVnb3J5RGVzYyAmJiBjYXRkZXNjLmNhdGVnb3J5RGVzYy5kZXNjcmlwdGlvbiB8fCBcIlwiKX1cblxcdFxcdFxcdFxcdFxcdFxcdFxcdHRyLmNhdF9zYW1wbGV2YWx1ZXNcblxcdFxcdFxcdFxcdFxcdFxcdFxcdFxcdHRkICR7cmVwbGFjZUJyKGNhdGRlc2Muc2FtcGxlVmFsdWVzKX1cbiAgICAgIGA7XG4gICAgfVxuXG4gIH0pO1xuXG4gIHZhciBvdGhlcmNhdHMgPSBjYXRzLmxlbmd0aCAtIE9iamVjdC5rZXlzKG0uZnVsbC5kb21haW5bZG9tYWluXS5jYXRlZ29yaWVzKS5sZW5ndGggO1xuICBpZiAoKG90aGVyY2F0cykgPiAwKSB7XG4gICAgcmVzICs9IGBcblxcdFxcdHAgICBhbmQgJHtvdGhlcmNhdHN9IG90aGVyIGNhdGVnb3JpZXNcbiAgICAgICBgXG5cbiAgfVxuLypcbiAgLy8gY2FsY3VsYXRlIG90aGVyIGRvbWFpbnMuXG4gIC8vIGRyYXcgXCJvdGhlciBjYXRlZ29yaWVzXCJcbiAgcmVzICs9IGBub2RlIFtjb2xvcj1wdXJwbGUsIHN0eWxlPWZpbGxlZF07IFxcbmBcbiAgb3RoZXJkb21haW5zLmZvckVhY2goZnVuY3Rpb24ob3RoZXJkb21haW4pIHtcbiAgICByZXMgKz0gYFwiJHtvdGhlcmRvbWFpbn1cIiBcXG5gO1xuICB9KTtcbiAgLy8gY291bnQgcmVjb3JkcyBpbiBkb21haW4gOlxuICB2YXIgbnJSZWNvcmRzID0gbS5yZWNvcmRzLnJlZHVjZShmdW5jdGlvbihwcmV2LGVudHJ5KSB7XG4gIHJldHVybiBwcmV2ICsgKChlbnRyeS5fZG9tYWluID09PSBkb21haW4pID8gMSA6IDApO1xuICB9LDApO1xuICByZXMgKz0gYG5vZGUgW3NoYXBlPXJlY29yZF07IFxcbmBcbiAgcmVzICs9IGAgXCJyZWNvcmRcIiBbbGFiZWw9XCJ7PGYwPiAke2RvbWFpbn0gfCAke25yUmVjb3Jkc319XCJdIFxcbmA7XG5cbiAgcmVzICs9IGAgXCJyX290aGVyXCIgW2xhYmVsPVwiezxmMD4gb3RoZXIgfCAke25yUmVjb3Jkc319XCJdIFxcbiBgO1xuXG4gIHJlcyArPSBgIyByZWxhdGlvbiBmcm9tIGNhdGVnb3JpZXMgdG8gZG9tYWluXFxuYDtcbiAgY2F0cy5mb3JFYWNoKGZ1bmN0aW9uKGNhdCkge1xuICAgIHJlcyArPSBgIFwiJHtjYXR9XCIgLT4gXCIke2RvbWFpbn1cIiBcXG5gO1xuICB9KVxuXG5cbiAgcmVzICs9IGAjIHJlbGF0aW9uIGZyb20gY2F0ZWdvcmllcyB0byByZWNvcmRzXFxuYDtcbiAgY2F0cy5mb3JFYWNoKGZ1bmN0aW9uKGNhdCkge1xuICAgIHZhciByZWMgPSBjYXRlZ29yeVJlc3VsdHNbY2F0XTtcbiAgICByZXMgKz0gYCBcIiR7Y2F0fVwiIC0+IFwicmVjb3JkXCIgXFxuYDtcbiAgfSlcblxuXG4gIC8vb3RoZXIgZG9tYWlucyB0byB0aGlzXG4gIGNhdHMuZm9yRWFjaChmdW5jdGlvbihjYXQpIHtcblxuXG4gIH0pXG4qL1xuICAvKlxuICBjYXRzIGZvXG4gICAgZGlncmFwaCBzZHN1IHtcblx0c2l6ZT1cIjM2LDM2XCI7XG5cdG5vZGUgW2NvbG9yPXllbGxvdywgc3R5bGU9ZmlsbGVkXTtcblx0RkxQRCBGTFAgXCJCT00gRWRpdG9yXCIsIFwiV0lLSVVSTFwiIFwiVUk1IERvY3VtZW50YXRpb25cIiwgXCJVSTUgRXhhbXBsZVwiLCBcIlNUQVJUVEFcIlxuXHRCQ1Bcblx0bm9kZSBbY29sb3I9Z3JleSwgc3R5bGU9ZmlsbGVkXTtcblx0bm9kZSBbZm9udG5hbWU9XCJWZXJkYW5hXCIsIHNpemU9XCIzMCwzMFwiXTtcblx0bm9kZSBbY29sb3I9Z3JleSwgc3R5bGU9ZmlsbGVkXTtcblx0Z3JhcGggWyBmb250bmFtZSA9IFwiQXJpYWxcIixcbiAgKi9cbiAgcmVzICs9IGBcblx0XHRoMyBWZXJzaW9uXG5cdFx0XHRhLnNtYWxsKGhyZWY9XCIvd2hhdHNuZXdcIilcblxuXG5ibG9jayBzY3JpcHRzXG5cdHNjcmlwdChzcmM9Jy92ZW5kb3IvanF1ZXJ5LTIuMi4zLm1pbi5qcycpXG5cdHNjcmlwdChzcmM9Jy92ZW5kb3IvYm9vdHN0cmFwLm1pbi5qcycpXG5cdHNjcmlwdChzcmM9Jy9qcy92aWV3cy9zZXR0aW5ncy5qcycpXG5gO1xuICByZXR1cm4gcmVzO1xufVxuXG5cblxuaW1wb3J0IHsgZXhlYyB9IGZyb20gJ2NoaWxkX3Byb2Nlc3MnO1xuXG5cbmZ1bmN0aW9uIGV4ZWNDbWQoY21kIDogc3RyaW5nKSB7XG4gZXhlYyhjbWQsIGZ1bmN0aW9uIChlcnJvciwgc3Rkb3V0LCBzdGRlcnIpIHtcbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoYGV4ZWMgZXJyb3I6ICR7ZXJyb3J9YClcbiAgICAgIHJldHVyblxuICAgIH1cbiAgICBjb25zb2xlLmxvZyhgc3Rkb3V0OiAke3N0ZG91dH1gKVxuICAgIGNvbnNvbGUubG9nKGBzdGRlcnI6ICR7c3RkZXJyfWApXG4gIH0pXG59O1xuXG5leHBvcnQgZnVuY3Rpb24gdmlzTW9kZWxzKG0gOiBJTWF0Y2guSU1vZGVscywgZm9sZGVyT3V0IDogc3RyaW5nICkge1xuICBtLmRvbWFpbnMuZm9yRWFjaChmdW5jdGlvbihzRG9tYWluKSB7XG4gICAgdmFyIHMgPSBncmFwaERvbWFpbihzRG9tYWluLG0pO1xuICAgIHZhciBmbkdyYXBoID0gZm9sZGVyT3V0ICsgXCIvXCIgKyBzRG9tYWluLnJlcGxhY2UoLyAvZywnXycpICsgXCIuZ3ZcIjtcbiAgICBmcy53cml0ZUZpbGVTeW5jKGZuR3JhcGgsIHMpO1xuICAgIGlmKHByb2Nlc3MuZW52LkdSQVBIVklaKSB7XG4gICAgICBjb25zb2xlLmxvZyhcImhlcmUgdGhlIGZpbGUgXCIgKyBmbkdyYXBoKTtcbiAgICAgIGV4ZWNDbWQocHJvY2Vzcy5lbnYuR1JBUEhWSVogKyBcIiAtVGpwZWcgLU8gXCIgKyBmbkdyYXBoKTtcbiAgICB9XG4gIH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gdGFiTW9kZWxzKG0gOiBJTWF0Y2guSU1vZGVscywgZm9sZGVyT3V0IDogc3RyaW5nICkge1xuICBtLmRvbWFpbnMuZm9yRWFjaChmdW5jdGlvbihzRG9tYWluKSB7XG4gICAgdmFyIHMgPSB0YWJEb21haW4oc0RvbWFpbixtKTtcbiAgICB2YXIgZm5HcmFwaCA9IGZvbGRlck91dCArIFwiL1wiICsgc0RvbWFpbi5yZXBsYWNlKC8gL2csJ18nKSArIFwiLmphZGVcIjtcbiAgICBkZWJ1Z2xvZyhcImhlcmUgdGhlIGZpbGUgXCIgKyBmbkdyYXBoKTtcbiAgICBmcy53cml0ZUZpbGVTeW5jKGZuR3JhcGgsIHMpO1xuICB9KTtcbn1cbiIsIi8qKlxuICogdmlzdWFsaXplIGEgbW9kZWwgYW5kIGNhbGN1bGF0ZSBzb21lIHN0YXRpc3RpY3NcbiAqL1xuXCJ1c2Ugc3RyaWN0XCI7XG52YXIgZnMgPSByZXF1aXJlKCdmcycpO1xudmFyIE1vZGVsID0gcmVxdWlyZSgnLi9tb2RlbCcpO1xudmFyIFV0aWwgPSByZXF1aXJlKCcuLi91dGlscy91dGlscycpO1xudmFyIERlc2NyaWJlID0gcmVxdWlyZSgnLi4vbWF0Y2gvZGVzY3JpYmUnKTtcbnZhciBfID0gcmVxdWlyZSgnbG9kYXNoJyk7XG52YXIgZGVidWcgPSByZXF1aXJlKCdkZWJ1ZycpO1xudmFyIGRlYnVnbG9nID0gZGVidWcoJ3Zpc21vZGVsLnRzJyk7XG47XG5mdW5jdGlvbiBjYWxjQ2F0ZWdvcnlSZWNvcmQobSwgY2F0ZWdvcnksIGRvbWFpbikge1xuICAgIHZhciBvdGhlcmRvbWFpbnMgPSBNb2RlbC5nZXREb21haW5zRm9yQ2F0ZWdvcnkobSwgY2F0ZWdvcnkpO1xuICAgIF8ucHVsbChvdGhlcmRvbWFpbnMsIGRvbWFpbik7XG4gICAgdmFyIHJlcyA9IHtcbiAgICAgICAgb3RoZXJkb21haW5zOiBvdGhlcmRvbWFpbnMsXG4gICAgICAgIG5yRGlzdGluY3RWYWx1ZXM6IDAsXG4gICAgICAgIG5yRGlzdGluY3RWYWx1ZXNJbkRvbWFpbjogMCxcbiAgICAgICAgbnJSZWNvcmRzOiAwLFxuICAgICAgICBuclJlY29yZHNJbkRvbWFpbjogMCxcbiAgICAgICAgbnJUb3RhbFJlY29yZHNJbkRvbWFpbjogMCxcbiAgICB9O1xuICAgIHZhciB2YWx1ZXMgPSBbXTtcbiAgICB2YXIgdmFsdWVzSW5Eb21haW4gPSBbXTtcbiAgICB2YXIgbnJSZWNvcmRzSW5Eb21haW4gPSAwO1xuICAgIHZhciBkaXN0aW5jdFZhbHVlcyA9IG0ucmVjb3Jkcy5mb3JFYWNoKGZ1bmN0aW9uIChvRW50cnkpIHtcbiAgICAgICAgaWYgKG9FbnRyeS5fZG9tYWluID09PSBkb21haW4pIHtcbiAgICAgICAgICAgIHJlcy5uclRvdGFsUmVjb3Jkc0luRG9tYWluICs9IDE7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKG9FbnRyeVtjYXRlZ29yeV0pIHtcbiAgICAgICAgICAgIHZhciB2YWx1ZSA9IG9FbnRyeVtjYXRlZ29yeV07XG4gICAgICAgICAgICBpZiAob0VudHJ5Ll9kb21haW4gPT09IGRvbWFpbikge1xuICAgICAgICAgICAgICAgIHZhbHVlc0luRG9tYWluW3ZhbHVlXSA9ICh2YWx1ZXNJbkRvbWFpblt2YWx1ZV0gfHwgMCkgKyAxO1xuICAgICAgICAgICAgICAgIHJlcy5uclJlY29yZHNJbkRvbWFpbiArPSAxO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFsdWVzW3ZhbHVlXSA9ICh2YWx1ZXNbdmFsdWVdIHx8IDApICsgMTtcbiAgICAgICAgICAgIHJlcy5uclJlY29yZHMgKz0gMTtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIHJlcy5uckRpc3RpbmN0VmFsdWVzID0gT2JqZWN0LmtleXModmFsdWVzKS5sZW5ndGg7XG4gICAgcmVzLm5yRGlzdGluY3RWYWx1ZXNJbkRvbWFpbiA9IE9iamVjdC5rZXlzKHZhbHVlc0luRG9tYWluKS5sZW5ndGg7XG4gICAgcmV0dXJuIHJlcztcbn1cbmV4cG9ydHMuY2FsY0NhdGVnb3J5UmVjb3JkID0gY2FsY0NhdGVnb3J5UmVjb3JkO1xuZnVuY3Rpb24gZ3JhcGhEb21haW4oZG9tYWluLCBtKSB7XG4gICAgLy8gZHJhdyBhIG1vZGVsIGRvbWFpbnNcbiAgICB2YXIgcmVzID0gXCJcXG4gICAgZGlncmFwaCBzZHN1IHtcXG5cXHRzaXplPVxcXCIzNiwzNlxcXCI7XFxuICAgcmFua2Rpcj1MUlxcblxcdG5vZGUgW2NvbG9yPXllbGxvdywgc3R5bGU9ZmlsbGVkXTtcXG4gICAgXFxcIlwiICsgZG9tYWluICsgXCJcXFwiXFxuICBcIjtcbiAgICAvLyBhZGQgYWxsIGNhdGVnb3J5IG5vZGVzXG4gICAgcmVzICs9IFwibm9kZSBbc2hhcGU9cmVjb3JkLCBjb2xvcj15ZWxsb3csIHN0eWxlPWZpbGxlZF07XFxuIFwiO1xuICAgIHZhciBjYXRzID0gTW9kZWwuZ2V0Q2F0ZWdvcmllc0ZvckRvbWFpbihtLCBkb21haW4pO1xuICAgIHZhciBjYXRlZ29yeVJlc3VsdHMgPSB7fTtcbiAgICB2YXIgb3RoZXJkb21haW5zID0gW107XG4gICAgY2F0cy5mb3JFYWNoKGZ1bmN0aW9uIChjYXQpIHtcbiAgICAgICAgdmFyIGNhdFJlc3VsdCA9IGNhbGNDYXRlZ29yeVJlY29yZChtLCBjYXQsIGRvbWFpbik7XG4gICAgICAgIGNhdGVnb3J5UmVzdWx0c1tjYXRdID0gY2F0UmVzdWx0O1xuICAgICAgICBvdGhlcmRvbWFpbnMgPSBfLnVuaW9uKG90aGVyZG9tYWlucywgY2F0ZWdvcnlSZXN1bHRzW2NhdF0ub3RoZXJEb21haW5zKTtcbiAgICAgICAgcmVzICs9IFwiXFxcIlwiICsgY2F0ICsgXCJcXFwiIFtsYWJlbD1cXFwieyBcIiArIGNhdCArIFwiIHwgXCIgKyBjYXRSZXN1bHQubnJEaXN0aW5jdFZhbHVlc0luRG9tYWluICsgXCIgVmFsdWVzIGluIFwiICsgY2F0UmVzdWx0Lm5yUmVjb3Jkc0luRG9tYWluICsgXCIgXCI7XG4gICAgICAgIGlmIChjYXRSZXN1bHQubnJSZWNvcmRzSW5Eb21haW4gIT09IGNhdFJlc3VsdC5uclJlY29yZHMpIHtcbiAgICAgICAgICAgIHJlcyArPSBcInwgIFwiICsgKGNhdFJlc3VsdC5uckRpc3RpbmN0VmFsdWVzIC0gY2F0UmVzdWx0Lm5yRGlzdGluY3RWYWx1ZXNJbkRvbWFpbikgKyBcIiBvdGhlciB2YWx1ZXMgaW4gXCIgKyAoY2F0UmVzdWx0Lm5yUmVjb3JkcyAtIGNhdFJlc3VsdC5uclJlY29yZHNJbkRvbWFpbikgKyBcIiBvdGhlciByZWNvcmRzXCI7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICByZXMgKz0gXCIgXCI7XG4gICAgICAgIH1cbiAgICAgICAgcmVzICs9IFwifVxcXCJdXFxuXCI7XG4gICAgfSk7XG4gICAgLy8gY2FsY3VsYXRlIG90aGVyIGRvbWFpbnMuXG4gICAgLy8gZHJhdyBcIm90aGVyIGNhdGVnb3JpZXNcIlxuICAgIHJlcyArPSBcIm5vZGUgW2NvbG9yPXB1cnBsZSwgc3R5bGU9ZmlsbGVkXTsgXFxuXCI7XG4gICAgb3RoZXJkb21haW5zLmZvckVhY2goZnVuY3Rpb24gKG90aGVyZG9tYWluKSB7XG4gICAgICAgIHJlcyArPSBcIlxcXCJcIiArIG90aGVyZG9tYWluICsgXCJcXFwiIFxcblwiO1xuICAgIH0pO1xuICAgIC8vIGNvdW50IHJlY29yZHMgaW4gZG9tYWluIDpcbiAgICB2YXIgbnJSZWNvcmRzID0gbS5yZWNvcmRzLnJlZHVjZShmdW5jdGlvbiAocHJldiwgZW50cnkpIHtcbiAgICAgICAgcmV0dXJuIHByZXYgKyAoKGVudHJ5Ll9kb21haW4gPT09IGRvbWFpbikgPyAxIDogMCk7XG4gICAgfSwgMCk7XG4gICAgcmVzICs9IFwibm9kZSBbc2hhcGU9cmVjb3JkXTsgXFxuXCI7XG4gICAgcmVzICs9IFwiIFxcXCJyZWNvcmRcXFwiIFtsYWJlbD1cXFwiezxmMD4gXCIgKyBkb21haW4gKyBcIiB8IFwiICsgbnJSZWNvcmRzICsgXCJ9XFxcIl0gXFxuXCI7XG4gICAgcmVzICs9IFwiIFxcXCJyX290aGVyXFxcIiBbbGFiZWw9XFxcIns8ZjA+IG90aGVyIHwgXCIgKyBuclJlY29yZHMgKyBcIn1cXFwiXSBcXG4gXCI7XG4gICAgcmVzICs9IFwiIyByZWxhdGlvbiBmcm9tIGNhdGVnb3JpZXMgdG8gZG9tYWluXFxuXCI7XG4gICAgY2F0cy5mb3JFYWNoKGZ1bmN0aW9uIChjYXQpIHtcbiAgICAgICAgcmVzICs9IFwiIFxcXCJcIiArIGNhdCArIFwiXFxcIiAtPiBcXFwiXCIgKyBkb21haW4gKyBcIlxcXCIgXFxuXCI7XG4gICAgfSk7XG4gICAgcmVzICs9IFwiIyByZWxhdGlvbiBmcm9tIGNhdGVnb3JpZXMgdG8gcmVjb3Jkc1xcblwiO1xuICAgIGNhdHMuZm9yRWFjaChmdW5jdGlvbiAoY2F0KSB7XG4gICAgICAgIHZhciByZWMgPSBjYXRlZ29yeVJlc3VsdHNbY2F0XTtcbiAgICAgICAgcmVzICs9IFwiIFxcXCJcIiArIGNhdCArIFwiXFxcIiAtPiBcXFwicmVjb3JkXFxcIiBcXG5cIjtcbiAgICB9KTtcbiAgICAvL290aGVyIGRvbWFpbnMgdG8gdGhpc1xuICAgIGNhdHMuZm9yRWFjaChmdW5jdGlvbiAoY2F0KSB7XG4gICAgfSk7XG4gICAgLypcbiAgICBjYXRzIGZvXG4gICAgICBkaWdyYXBoIHNkc3Uge1xuICAgICAgc2l6ZT1cIjM2LDM2XCI7XG4gICAgICBub2RlIFtjb2xvcj15ZWxsb3csIHN0eWxlPWZpbGxlZF07XG4gICAgICBGTFBEIEZMUCBcIkJPTSBFZGl0b3JcIiwgXCJXSUtJVVJMXCIgXCJVSTUgRG9jdW1lbnRhdGlvblwiLCBcIlVJNSBFeGFtcGxlXCIsIFwiU1RBUlRUQVwiXG4gICAgICBCQ1BcbiAgICAgIG5vZGUgW2NvbG9yPWdyZXksIHN0eWxlPWZpbGxlZF07XG4gICAgICBub2RlIFtmb250bmFtZT1cIlZlcmRhbmFcIiwgc2l6ZT1cIjMwLDMwXCJdO1xuICAgICAgbm9kZSBbY29sb3I9Z3JleSwgc3R5bGU9ZmlsbGVkXTtcbiAgICAgIGdyYXBoIFsgZm9udG5hbWUgPSBcIkFyaWFsXCIsXG4gICAgKi9cbiAgICByZXMgKz0gXCJ9XFxuXCI7XG4gICAgcmV0dXJuIHJlcztcbn1cbmV4cG9ydHMuZ3JhcGhEb21haW4gPSBncmFwaERvbWFpbjtcbi8qXG4gICAgY2F0ZWdvcnlEZXNjIDogdGhlTW9kZWwuZnVsbC5kb21haW5bZmlsdGVyZG9tYWluXS5jYXRlZ29yaWVzW2NhdGVnb3J5XSxcbiAgICBkaXN0aW5jdCA6IGRpc3RpbmN0LFxuICAgIGRlbHRhIDogZGVsdGEsXG4gICAgcHJlc2VudFJlY29yZHMgOiByZWNvcmRDb3VudC5wcmVzZW50cmVjb3JkcyxcbiAgICBwZXJjUHJlc2VudCA6IHBlcmNlbnQsXG4gICAgc2FtcGxlVmFsdWVzIDogdmFsdWVzTGlzdFxuICB9XG4qL1xuZnVuY3Rpb24gcmVwbGFjZUJyKHN0cmluZykge1xuICAgIHN0cmluZyA9IHN0cmluZy5yZXBsYWNlKC9cXG4vZywgXCJcXG5cXHRcXHRcXHRcXHRcXHRcXHRcXHRcXHRcXHRcXHRcXHRiclxcblxcdFxcdFxcdFxcdFxcdFxcdFxcdFxcdFxcdFxcdFxcdHwgXCIpO1xuICAgIHJldHVybiBzdHJpbmc7XG59XG4vKipcbiAqIGdlbmVyYXRlIGEgdGV4dHVhbCByZXByZXNlbnRhdGlvbiBvZiBhIGRvbWFpblxuICovXG5mdW5jdGlvbiB0YWJEb21haW4oZG9tYWluLCBtKSB7XG4gICAgLy8gZHJhdyBhIG1vZGVsIGRvbWFpbnNcbiAgICB2YXIgY2F0cyA9IE1vZGVsLmdldENhdGVnb3JpZXNGb3JEb21haW4obSwgZG9tYWluKTtcbiAgICAvL2NvbnNvbGUubG9nKGNhdHMuam9pbihcIlxcblwiKSk7XG4gICAgdmFyIGNhdGRlc2MgPSBEZXNjcmliZS5nZXRDYXRlZ29yeVN0YXRzSW5Eb21haW4oY2F0c1swXSwgZG9tYWluLCBtKTtcbiAgICB2YXIgY2F0UmVzdWx0ID0gY2FsY0NhdGVnb3J5UmVjb3JkKG0sIGNhdHNbMF0sIGRvbWFpbik7XG4gICAgdmFyIGRvbWFpbkRlc2NyID0gbS5mdWxsLmRvbWFpbltkb21haW5dLmRlc2NyaXB0aW9uIHx8IFwiXCI7XG4gICAgZG9tYWluRGVzY3IgPSByZXBsYWNlQnIoZG9tYWluRGVzY3IpO1xuICAgIHZhciByZXMgPSBcIlxcblxcbi8vIHByZXNldCBmb3JtIHZhbHVlcyBpZiB3ZSByZWNlaXZlIGEgdXNlcmRhdGEgb2JqZWN0IC8vXFxuLSB1c2VyID0gdXNlclxcblxcbmV4dGVuZHMgLi4vbGF5b3V0X3BcXG5cXG5ibG9jayBjb250ZW50XFxuXFxuXFx0bmF2Lm5hdmJhci5uYXZiYXItZGVmYXVsdC5uYXZiYXItZml4ZWQtdG9wXFxuXFx0XFx0LmNvbnRhaW5lclxcblxcdFxcdFxcdC5uYXZiYXItaGVhZGVyXFxuXFx0XFx0XFx0XFx0Lm5hdmJhci1icmFuZChzdHlsZT0nYmdjb2xvcjpvcmFuZ2U7Y29sb3I6ZGFya2JsdWU7Zm9udC1mYW1pbHk6QXJpYWwgQmxhY2s7Zm9udC1zaXplOjE1LjExOHB4Jykgd29zYXAgZG9tYWluIFwiICsgZG9tYWluICsgXCJcXG5cXHRcXHRcXHR1bC5uYXYubmF2YmFyLW5hdi5uYXZiYXItcmlnaHQgI3t1aWR9XFxuXFx0XFx0XFx0XFx0bGlcXG5cXHRcXHRcXHRcXHRcXHQubmF2YmFyLWJ0biNidG4tbG9nb3V0LmJ0bi5idG4tZGVmYXVsdChvbmNsaWNrPVxcXCJsb2NhdGlvbi5ocmVmPScvaG9tZSdcXFwiKVxcblxcdFxcdFxcdFxcdFxcdFxcdHwgYmFjayB0byBob21lXFxuXFxuXFx0cCAgJm5ic3A7XFxuXFx0cCAmbmJzcDtcXG5cXHRwXFxuXFxuXFx0ZGl2LndlbGxcXG5cXHRcXHRoMyBkb21haW4gXFxcIlwiICsgZG9tYWluICsgXCJcXFwiXFxuXFx0XFx0XFx0c3Bhbi5wdWxsLXJpZ2h0IFwiICsgY2F0UmVzdWx0Lm5yVG90YWxSZWNvcmRzSW5Eb21haW4gKyBcIiByZWNvcmRzXFxuXFx0XFx0cFxcblxcdFxcdHNwYW4gXCIgKyBkb21haW5EZXNjciArIFwiXFxuXFxuXFx0XFx0dGFibGUudGFibGUudGFibGUtY29uZGVuc2VkLnRhYmxlLXN0cmlwZWRcXG5cXHRcXHRcXHR0aGVhZFxcblxcdFxcdFxcdFxcdHRyXFxuXFx0XFx0XFx0XFx0XFx0dGggY2F0ZWdvcnlcXG5cXHRcXHRcXHRcXHRcXHR0aChzdHlsZT1cXFwid2lkdGg6MTAlXFxcIikgY291bnRcXG5cXHRcXHRcXHRcXHRcXHR0aFxcblxcdFxcdFxcdFxcdFxcdFxcdHRhYmxlXFxuXFx0XFx0XFx0XFx0XFx0XFx0XFx0dHJcXG5cXHRcXHRcXHRcXHRcXHRcXHRcXHRcXHR0ZCBzeW5vbnltc1xcblxcdFxcdFxcdFxcdFxcdFxcdFxcdHRyXFxuXFx0XFx0XFx0XFx0XFx0XFx0XFx0XFx0dGQgZGVzY3JpcHRpb25cXG5cXHRcXHRcXHRcXHRcXHRcXHRcXHR0clxcblxcdFxcdFxcdFxcdFxcdFxcdFxcdFxcdHRkIGV4YW1wbGUgdmFsdWVzXFxuXFx0XFx0XFx0dGJvZHlcXG5cIjtcbiAgICB2YXIgY2F0ZWdvcnlSZXN1bHRzID0ge307XG4gICAgdmFyIG90aGVyZG9tYWlucyA9IFtdO1xuICAgIGNhdHMuZm9yRWFjaChmdW5jdGlvbiAoY2F0KSB7XG4gICAgICAgIHZhciBjYXRkZXNjID0gRGVzY3JpYmUuZ2V0Q2F0ZWdvcnlTdGF0c0luRG9tYWluKGNhdCwgZG9tYWluLCBtKTtcbiAgICAgICAgLy9jb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeShjYXRkZXNjKSk7XG4gICAgICAgIHZhciBjYXRSZXN1bHQgPSBjYWxjQ2F0ZWdvcnlSZWNvcmQobSwgY2F0LCBkb21haW4pO1xuICAgICAgICBjYXRlZ29yeVJlc3VsdHNbY2F0XSA9IGNhdFJlc3VsdDtcbiAgICAgICAgb3RoZXJkb21haW5zID0gXy51bmlvbihvdGhlcmRvbWFpbnMsIGNhdGVnb3J5UmVzdWx0c1tjYXRdLm90aGVyRG9tYWlucyk7XG4gICAgICAgIC8qXG4gICAgICAgICAgICByZXMgKz0gYFwiJHtjYXR9XCIgW2xhYmVsPVwieyAke2NhdH0gfCAke2NhdFJlc3VsdC5uckRpc3RpbmN0VmFsdWVzSW5Eb21haW59IFZhbHVlcyBpbiAke2NhdFJlc3VsdC5uclJlY29yZHNJbkRvbWFpbn0gYDtcbiAgICAgICAgICAgIGlmKGNhdFJlc3VsdC5uclJlY29yZHNJbkRvbWFpbiAhPT0gY2F0UmVzdWx0Lm5yUmVjb3Jkcykge1xuICAgICAgICAgICAgICByZXMgKz0gIGB8ICAke2NhdFJlc3VsdC5uckRpc3RpbmN0VmFsdWVzIC0gY2F0UmVzdWx0Lm5yRGlzdGluY3RWYWx1ZXNJbkRvbWFpbn0gb3RoZXIgdmFsdWVzIGluICR7Y2F0UmVzdWx0Lm5yUmVjb3JkcyAtIGNhdFJlc3VsdC5uclJlY29yZHNJbkRvbWFpbn0gb3RoZXIgcmVjb3Jkc2A7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICByZXMgKz0gYCBgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmVzICs9IGB9XCJdXFxuYDtcbiAgICAgICAgKi9cbiAgICAgICAgLy9jb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeShtLmZ1bGwuZG9tYWluW2RvbWFpbl0pKTtcbiAgICAgICAgaWYgKG0uZnVsbC5kb21haW5bZG9tYWluXS5jYXRlZ29yaWVzW2NhdF0pIHtcbiAgICAgICAgICAgIHZhciBzeW5vbnltc1N0cmluZyA9IFV0aWwubGlzdFRvQ29tbWFBbmQoY2F0ZGVzYy5jYXRlZ29yeURlc2MgJiYgY2F0ZGVzYy5jYXRlZ29yeURlc2Muc3lub255bXMgJiYgY2F0ZGVzYy5jYXRlZ29yeURlc2Muc3lub255bXMgfHwgW10pIHx8IFwiJm5ic3A7XCI7XG4gICAgICAgICAgICByZXMgKz0gXCJcXG5cXHRcXHRcXHR0clxcblxcdFxcdFxcdFxcdFxcdHRkLmNhdF9jb3VudCBcIiArIGNhdCArIFwiXFxuXFx0XFx0XFx0XFx0XFx0dGQgXCIgKyBjYXRkZXNjLnByZXNlbnRSZWNvcmRzICsgXCIgZGlzdGluY3QgdmFsdWVzIGluIFwiICsgY2F0ZGVzYy5wZXJjUHJlc2VudCArIFwiJSBvZiByZWNvcmRzXFxuXFx0XFx0XFx0XFx0XFx0dGRcXG5cXHRcXHRcXHRcXHRcXHRcXHR0YWJsZVxcblxcdFxcdFxcdFxcdFxcdFxcdFxcdHRyLmNhdF9zeW5vbnltc1xcblxcdFxcdFxcdFxcdFxcdFxcdFxcdFxcdHRkIFwiICsgc3lub255bXNTdHJpbmcgKyBcIlxcblxcdFxcdFxcdFxcdFxcdFxcdFxcdHRyLmNhdF9kZXNjcmlwdGlvblxcblxcdFxcdFxcdFxcdFxcdFxcdFxcdFxcdHRkIFwiICsgcmVwbGFjZUJyKGNhdGRlc2MuY2F0ZWdvcnlEZXNjICYmIGNhdGRlc2MuY2F0ZWdvcnlEZXNjLmRlc2NyaXB0aW9uIHx8IFwiXCIpICsgXCJcXG5cXHRcXHRcXHRcXHRcXHRcXHRcXHR0ci5jYXRfc2FtcGxldmFsdWVzXFxuXFx0XFx0XFx0XFx0XFx0XFx0XFx0XFx0dGQgXCIgKyByZXBsYWNlQnIoY2F0ZGVzYy5zYW1wbGVWYWx1ZXMpICsgXCJcXG4gICAgICBcIjtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIHZhciBvdGhlcmNhdHMgPSBjYXRzLmxlbmd0aCAtIE9iamVjdC5rZXlzKG0uZnVsbC5kb21haW5bZG9tYWluXS5jYXRlZ29yaWVzKS5sZW5ndGg7XG4gICAgaWYgKChvdGhlcmNhdHMpID4gMCkge1xuICAgICAgICByZXMgKz0gXCJcXG5cXHRcXHRwICAgYW5kIFwiICsgb3RoZXJjYXRzICsgXCIgb3RoZXIgY2F0ZWdvcmllc1xcbiAgICAgICBcIjtcbiAgICB9XG4gICAgLypcbiAgICAgIC8vIGNhbGN1bGF0ZSBvdGhlciBkb21haW5zLlxuICAgICAgLy8gZHJhdyBcIm90aGVyIGNhdGVnb3JpZXNcIlxuICAgICAgcmVzICs9IGBub2RlIFtjb2xvcj1wdXJwbGUsIHN0eWxlPWZpbGxlZF07IFxcbmBcbiAgICAgIG90aGVyZG9tYWlucy5mb3JFYWNoKGZ1bmN0aW9uKG90aGVyZG9tYWluKSB7XG4gICAgICAgIHJlcyArPSBgXCIke290aGVyZG9tYWlufVwiIFxcbmA7XG4gICAgICB9KTtcbiAgICAgIC8vIGNvdW50IHJlY29yZHMgaW4gZG9tYWluIDpcbiAgICAgIHZhciBuclJlY29yZHMgPSBtLnJlY29yZHMucmVkdWNlKGZ1bmN0aW9uKHByZXYsZW50cnkpIHtcbiAgICAgIHJldHVybiBwcmV2ICsgKChlbnRyeS5fZG9tYWluID09PSBkb21haW4pID8gMSA6IDApO1xuICAgICAgfSwwKTtcbiAgICAgIHJlcyArPSBgbm9kZSBbc2hhcGU9cmVjb3JkXTsgXFxuYFxuICAgICAgcmVzICs9IGAgXCJyZWNvcmRcIiBbbGFiZWw9XCJ7PGYwPiAke2RvbWFpbn0gfCAke25yUmVjb3Jkc319XCJdIFxcbmA7XG4gICAgXG4gICAgICByZXMgKz0gYCBcInJfb3RoZXJcIiBbbGFiZWw9XCJ7PGYwPiBvdGhlciB8ICR7bnJSZWNvcmRzfX1cIl0gXFxuIGA7XG4gICAgXG4gICAgICByZXMgKz0gYCMgcmVsYXRpb24gZnJvbSBjYXRlZ29yaWVzIHRvIGRvbWFpblxcbmA7XG4gICAgICBjYXRzLmZvckVhY2goZnVuY3Rpb24oY2F0KSB7XG4gICAgICAgIHJlcyArPSBgIFwiJHtjYXR9XCIgLT4gXCIke2RvbWFpbn1cIiBcXG5gO1xuICAgICAgfSlcbiAgICBcbiAgICBcbiAgICAgIHJlcyArPSBgIyByZWxhdGlvbiBmcm9tIGNhdGVnb3JpZXMgdG8gcmVjb3Jkc1xcbmA7XG4gICAgICBjYXRzLmZvckVhY2goZnVuY3Rpb24oY2F0KSB7XG4gICAgICAgIHZhciByZWMgPSBjYXRlZ29yeVJlc3VsdHNbY2F0XTtcbiAgICAgICAgcmVzICs9IGAgXCIke2NhdH1cIiAtPiBcInJlY29yZFwiIFxcbmA7XG4gICAgICB9KVxuICAgIFxuICAgIFxuICAgICAgLy9vdGhlciBkb21haW5zIHRvIHRoaXNcbiAgICAgIGNhdHMuZm9yRWFjaChmdW5jdGlvbihjYXQpIHtcbiAgICBcbiAgICBcbiAgICAgIH0pXG4gICAgKi9cbiAgICAvKlxuICAgIGNhdHMgZm9cbiAgICAgIGRpZ3JhcGggc2RzdSB7XG4gICAgICBzaXplPVwiMzYsMzZcIjtcbiAgICAgIG5vZGUgW2NvbG9yPXllbGxvdywgc3R5bGU9ZmlsbGVkXTtcbiAgICAgIEZMUEQgRkxQIFwiQk9NIEVkaXRvclwiLCBcIldJS0lVUkxcIiBcIlVJNSBEb2N1bWVudGF0aW9uXCIsIFwiVUk1IEV4YW1wbGVcIiwgXCJTVEFSVFRBXCJcbiAgICAgIEJDUFxuICAgICAgbm9kZSBbY29sb3I9Z3JleSwgc3R5bGU9ZmlsbGVkXTtcbiAgICAgIG5vZGUgW2ZvbnRuYW1lPVwiVmVyZGFuYVwiLCBzaXplPVwiMzAsMzBcIl07XG4gICAgICBub2RlIFtjb2xvcj1ncmV5LCBzdHlsZT1maWxsZWRdO1xuICAgICAgZ3JhcGggWyBmb250bmFtZSA9IFwiQXJpYWxcIixcbiAgICAqL1xuICAgIHJlcyArPSBcIlxcblxcdFxcdGgzIFZlcnNpb25cXG5cXHRcXHRcXHRhLnNtYWxsKGhyZWY9XFxcIi93aGF0c25ld1xcXCIpXFxuXFxuXFxuYmxvY2sgc2NyaXB0c1xcblxcdHNjcmlwdChzcmM9Jy92ZW5kb3IvanF1ZXJ5LTIuMi4zLm1pbi5qcycpXFxuXFx0c2NyaXB0KHNyYz0nL3ZlbmRvci9ib290c3RyYXAubWluLmpzJylcXG5cXHRzY3JpcHQoc3JjPScvanMvdmlld3Mvc2V0dGluZ3MuanMnKVxcblwiO1xuICAgIHJldHVybiByZXM7XG59XG5leHBvcnRzLnRhYkRvbWFpbiA9IHRhYkRvbWFpbjtcbnZhciBjaGlsZF9wcm9jZXNzXzEgPSByZXF1aXJlKCdjaGlsZF9wcm9jZXNzJyk7XG5mdW5jdGlvbiBleGVjQ21kKGNtZCkge1xuICAgIGNoaWxkX3Byb2Nlc3NfMS5leGVjKGNtZCwgZnVuY3Rpb24gKGVycm9yLCBzdGRvdXQsIHN0ZGVycikge1xuICAgICAgICBpZiAoZXJyb3IpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoXCJleGVjIGVycm9yOiBcIiArIGVycm9yKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zb2xlLmxvZyhcInN0ZG91dDogXCIgKyBzdGRvdXQpO1xuICAgICAgICBjb25zb2xlLmxvZyhcInN0ZGVycjogXCIgKyBzdGRlcnIpO1xuICAgIH0pO1xufVxuO1xuZnVuY3Rpb24gdmlzTW9kZWxzKG0sIGZvbGRlck91dCkge1xuICAgIG0uZG9tYWlucy5mb3JFYWNoKGZ1bmN0aW9uIChzRG9tYWluKSB7XG4gICAgICAgIHZhciBzID0gZ3JhcGhEb21haW4oc0RvbWFpbiwgbSk7XG4gICAgICAgIHZhciBmbkdyYXBoID0gZm9sZGVyT3V0ICsgXCIvXCIgKyBzRG9tYWluLnJlcGxhY2UoLyAvZywgJ18nKSArIFwiLmd2XCI7XG4gICAgICAgIGZzLndyaXRlRmlsZVN5bmMoZm5HcmFwaCwgcyk7XG4gICAgICAgIGlmIChwcm9jZXNzLmVudi5HUkFQSFZJWikge1xuICAgICAgICAgICAgY29uc29sZS5sb2coXCJoZXJlIHRoZSBmaWxlIFwiICsgZm5HcmFwaCk7XG4gICAgICAgICAgICBleGVjQ21kKHByb2Nlc3MuZW52LkdSQVBIVklaICsgXCIgLVRqcGVnIC1PIFwiICsgZm5HcmFwaCk7XG4gICAgICAgIH1cbiAgICB9KTtcbn1cbmV4cG9ydHMudmlzTW9kZWxzID0gdmlzTW9kZWxzO1xuZnVuY3Rpb24gdGFiTW9kZWxzKG0sIGZvbGRlck91dCkge1xuICAgIG0uZG9tYWlucy5mb3JFYWNoKGZ1bmN0aW9uIChzRG9tYWluKSB7XG4gICAgICAgIHZhciBzID0gdGFiRG9tYWluKHNEb21haW4sIG0pO1xuICAgICAgICB2YXIgZm5HcmFwaCA9IGZvbGRlck91dCArIFwiL1wiICsgc0RvbWFpbi5yZXBsYWNlKC8gL2csICdfJykgKyBcIi5qYWRlXCI7XG4gICAgICAgIGRlYnVnbG9nKFwiaGVyZSB0aGUgZmlsZSBcIiArIGZuR3JhcGgpO1xuICAgICAgICBmcy53cml0ZUZpbGVTeW5jKGZuR3JhcGgsIHMpO1xuICAgIH0pO1xufVxuZXhwb3J0cy50YWJNb2RlbHMgPSB0YWJNb2RlbHM7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
