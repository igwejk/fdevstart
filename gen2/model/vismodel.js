/**
 * visualize a model and calculate some statistics
 */
"use strict";

var fs = require("fs");
var Model = require("./model");
var Util = require("../utils/utils");
var Describe = require("../match/describe");
var _ = require("lodash");
var debug = require("debug");
//import * as elasticlunr from 'elasticlunr';
var debuglog = debug('vismodel.ts');
;
var elasticlunr = require('elasticlunr');
function JSONEscape(s) {
    return s.replace(/\\/g, "\\\\").replace(/\n/g, "\\n").replace(/\'/g, "\\'").replace(/\"/g, '\\"').replace(/\&/g, "\\&").replace(/\r/g, "\\r").replace(/\t/g, "\\t");
    // .replace(/\b/g, "\\b")
    // .replace(/\f/g, "\\f");
}
exports.JSONEscape = JSONEscape;
;
function makeLunrIndex(modelpath, output, silent) {
    var mdl = JSON.parse('' + fs.readFileSync(modelpath + '.model.json'));
    var data = JSON.parse('' + fs.readFileSync(modelpath + '.data.json'));
    var cats = mdl.category.filter(function (a) {
        return typeof a !== 'string';
    });
    var qbeDataObjects = cats.filter(function (cat) {
        return cat.QBE || cat.QBEInclude;
    });
    //console.log("here cats" + JSON.stringify(cats));
    //console.log("\nhere data objects" + JSON.stringify(qbeDataObjects));
    var qbeDataNames = qbeDataObjects.map(function (cat) {
        return cat.name;
    });
    qbeDataNames = _.union(qbeDataNames, mdl.columns);
    var LUNRIndex = cats.filter(function (cat) {
        return cat.LUNRIndex;
    }).map(function (cat) {
        return cat.name;
    });
    //var elasticlunr = require('lunr');
    var bomdata = data;
    // index all LUNR properties
    var index = elasticlunr(function () {
        var that = this;
        LUNRIndex /*
                  ["appId",
                  "AppKey",
                  "AppName",
                    "ApplicationComponent",
                    "RoleName",
                    "ApplicationType",
                    "BSPName",
                    "BSPApplicationURL",
                    "releaseName",
                    "BusinessCatalog",
                    "TechnicalCatalog"] */
        .forEach(function (field) {
            that.addField(field);
        });
        this.setRef('id');
        this.saveDocument(false);
    });
    bomdata.forEach(function (o, index) {
        o.id = index;
    });
    bomdata.forEach(function (record) {
        index.addDoc(record);
    });
    var elastic = index;
    // dump the lunr index
    //
    var theIndex = index.toJSON();
    var columns = mdl.columns.map(function (colname) {
        var res = cats.filter(function (cat) {
            return cat.name === colname;
        });
        if (res.length !== 1) {
            throw new Error("undefined or non-object column : " + colname);
        }
        ;
        return res[0];
    });
    var columnNames = columns.map(function (col) {
        return col.name;
    });
    var jsonp = "var mdldata = {};\n//columns \n mdldata.columns = [\"" + columns.map(function (col) {
        return col.name;
    }).join('","') + "\"];";
    var json = "{ \"columns\"  : [\"" + columns.map(function (col) {
        return JSONEscape(col.name);
    }).join('","') + "\"],";
    // jsonp += `\n mdldata.fulldata = ${JSON.stringify(bomdata)};\n`;
    //jsonp += `\n//columns info \n mdldata.lunrcolumns = ["{${LUNRIndex.join('","')}"];`;
    jsonp += "\n//columns info \n mdldata.columnsDescription = {" + columns.map(function (col) {
        return " \n \"" + col.name + "\" :  \"" + JSONEscape(col.description || col.name) + "\" ";
    }).join(',') + "\n      };";
    json += "\"columnsDescription\" : {" + columns.map(function (col) {
        return " \n \"" + col.name + "\" :  \"" + JSONEscape(col.description || col.name) + "\" ";
    }).join(',') + "\n      },";
    jsonp += "\n//columns info \n mdldata.columnsDefaultWidth = {" + columns.map(function (col) {
        return " \n \"" + col.name + "\" : " + (col.defaultWidth || 150) + " ";
    }).join(',') + "\n      };";
    json += "\n\"columnsDefaultWidth\" : {" + columns.map(function (col) {
        return " \n \"" + col.name + "\" : " + (col.defaultWidth || 150) + " ";
    }).join(',') + "\n      },";
    var theIndexStr = JSON.stringify(theIndex);
    jsonp += "\nvar serIndex =\"" + JSONEscape(theIndexStr) + "\";\n";
    // jsonp += "\nvar serIndex =" + JSON.stringify(theIndex) + ";\n";
    json += '\n"serIndex" :' + theIndexStr + ',';
    //console.log("here all names " + JSON.stringify(qbeDataNames));
    var cleanseddata = bomdata.map(function (o) {
        var res = {};
        qbeDataNames.forEach(function (key) {
            res[key] = o[key];
        });
        return res;
    });
    if (!silent) {
        console.log("dumping " + output);
        console.log("length of index str" + theIndexStr.length);
        console.log("available          " + columns.length + " columns");
        console.log("returning as data  " + qbeDataNames.length + " columns");
        console.log("indexing           " + LUNRIndex.length + " columns");
        console.log('returned but not available', _.difference(qbeDataNames, columnNames).join(", "));
        console.log('returned but not indexed', _.difference(qbeDataNames, LUNRIndex).join(", "));
    }
    jsonp += "var data=" + JSON.stringify(cleanseddata) + ";";
    json += '"data":' + JSON.stringify(cleanseddata) + "\n}";
    jsonp += "\n\n           // var elastic = elasticlunr.Index.load(serIndex);\n\n  ";
    //fs.writeFileSync(output + ".lunr.js", jsonp);
    fs.writeFileSync(output + ".lunr.json", json);
}
exports.makeLunrIndex = makeLunrIndex;
/*

  var index = elastilunr.Index.load(obj);


}

 "QBE" : false,
      "QBEInclude" : true,
      "LUNRIndex": false
*/
function calcCategoryRecord(m, category, domain) {
    var otherdomains = Model.getDomainsForCategory(m, category);
    _.pull(otherdomains, domain);
    var res = {
        otherdomains: otherdomains,
        nrDistinctValues: 0,
        nrDistinctValuesInDomain: 0,
        nrRecords: 0,
        nrRecordsInDomain: 0,
        nrTotalRecordsInDomain: 0
    };
    var values = [];
    var valuesInDomain = [];
    var nrRecordsInDomain = 0;
    var distinctValues = m.records.forEach(function (oEntry) {
        if (oEntry._domain === domain) {
            res.nrTotalRecordsInDomain += 1;
        }
        if (oEntry[category]) {
            var value = oEntry[category];
            if (oEntry._domain === domain) {
                valuesInDomain[value] = (valuesInDomain[value] || 0) + 1;
                res.nrRecordsInDomain += 1;
            }
            values[value] = (values[value] || 0) + 1;
            res.nrRecords += 1;
        }
    });
    res.nrDistinctValues = Object.keys(values).length;
    res.nrDistinctValuesInDomain = Object.keys(valuesInDomain).length;
    return res;
}
exports.calcCategoryRecord = calcCategoryRecord;
function graphDomain(domain, m) {
    // draw a model domains
    var res = "\n    digraph sdsu {\n\tsize=\"36,36\";\n   rankdir=LR\n\tnode [color=yellow, style=filled];\n    \"" + domain + "\"\n  ";
    // add all category nodes
    res += "node [shape=record, color=yellow, style=filled];\n ";
    var cats = Model.getCategoriesForDomain(m, domain);
    var categoryResults = {};
    var otherdomains = [];
    cats.forEach(function (cat) {
        var catResult = calcCategoryRecord(m, cat, domain);
        categoryResults[cat] = catResult;
        otherdomains = _.union(otherdomains, categoryResults[cat].otherDomains);
        res += "\"" + cat + "\" [label=\"{ " + cat + " | " + catResult.nrDistinctValuesInDomain + " Values in " + catResult.nrRecordsInDomain + " ";
        if (catResult.nrRecordsInDomain !== catResult.nrRecords) {
            res += "|  " + (catResult.nrDistinctValues - catResult.nrDistinctValuesInDomain) + " other values in " + (catResult.nrRecords - catResult.nrRecordsInDomain) + " other records";
        } else {
            res += " ";
        }
        res += "}\"]\n";
    });
    // calculate other domains.
    // draw "other categories"
    res += "node [color=purple, style=filled]; \n";
    otherdomains.forEach(function (otherdomain) {
        res += "\"" + otherdomain + "\" \n";
    });
    // count records in domain :
    var nrRecords = m.records.reduce(function (prev, entry) {
        return prev + (entry._domain === domain ? 1 : 0);
    }, 0);
    res += "node [shape=record]; \n";
    res += " \"record\" [label=\"{<f0> " + domain + " | " + nrRecords + "}\"] \n";
    res += " \"r_other\" [label=\"{<f0> other | " + nrRecords + "}\"] \n ";
    res += "# relation from categories to domain\n";
    cats.forEach(function (cat) {
        res += " \"" + cat + "\" -> \"" + domain + "\" \n";
    });
    res += "# relation from categories to records\n";
    cats.forEach(function (cat) {
        var rec = categoryResults[cat];
        res += " \"" + cat + "\" -> \"record\" \n";
    });
    //other domains to this
    cats.forEach(function (cat) {});
    /*
    cats fo
      digraph sdsu {
      size="36,36";
      node [color=yellow, style=filled];
      FLPD FLP "BOM Editor", "WIKIURL" "UI5 Documentation", "UI5 Example", "STARTTA"
      BCP
      node [color=grey, style=filled];
      node [fontname="Verdana", size="30,30"];
      node [color=grey, style=filled];
      graph [ fontname = "Arial",
    */
    res += "}\n";
    return res;
}
exports.graphDomain = graphDomain;
/*
    categoryDesc : theModel.full.domain[filterdomain].categories[category],
    distinct : distinct,
    delta : delta,
    presentRecords : recordCount.presentrecords,
    percPresent : percent,
    sampleValues : valuesList
  }
*/
function replaceBr(string) {
    string = string.replace(/\n/g, "\n\t\t\t\t\t\t\t\t\t\t\tbr\n\t\t\t\t\t\t\t\t\t\t\t| ");
    return string;
}
/**
 * generate a textual representation of a domain
 */
function tabDomain(domain, m) {
    // draw a model domains
    var cats = Model.getCategoriesForDomain(m, domain);
    cats = Model.sortCategoriesByImportance(m.full.domain[domain].categories || {}, cats);
    //console.log(cats.join("\n"));
    var catdesc = Describe.getCategoryStatsInDomain(cats[0], domain, m);
    var catResult = calcCategoryRecord(m, cats[0], domain);
    var domainDescr = m.full.domain[domain].description || "";
    domainDescr = replaceBr(domainDescr);
    var res = "\n\n// preset form values if we receive a userdata object //\n- user = user\n\nextends ../layout_p\n\nblock content\n\n\tnav.navbar.navbar-default.navbar-fixed-top\n\t\t.container\n\t\t\t.navbar-header\n\t\t\t\t.navbar-brand(style='bgcolor:orange;color:darkblue;font-family:Arial Black;font-size:15.118px') wosap domain " + domain + "\n\t\t\tul.nav.navbar-nav.navbar-right #{uid}\n\t\t\t\tli\n\t\t\t\t\t.navbar-btn#btn-logout.btn.btn-default(onclick=\"location.href='/home'\")\n\t\t\t\t\t\t| back to home\n\n\tp  &nbsp;\n\tp &nbsp;\n\tp\n\n\tdiv.well\n\t\th3 domain \"" + domain + "\"\n\t\t\tspan.pull-right " + catResult.nrTotalRecordsInDomain + " records\n\t\tp\n\t\tspan " + domainDescr + "\n\n\t\ttable.table.table-condensed.table-striped\n\t\t\tthead\n\t\t\t\ttr\n\t\t\t\t\tth category\n\t\t\t\t\tth(style=\"width:10%\") count\n\t\t\t\t\tth\n\t\t\t\t\t\ttable\n\t\t\t\t\t\t\ttr\n\t\t\t\t\t\t\t\ttd synonyms\n\t\t\t\t\t\t\ttr\n\t\t\t\t\t\t\t\ttd description\n\t\t\t\t\t\t\ttr\n\t\t\t\t\t\t\t\ttd example values\n\t\t\ttbody\n";
    var categoryResults = {};
    var otherdomains = [];
    var categoryMap = m.full.domain[domain].categories || {};
    cats.forEach(function (cat) {
        var catdesc = Describe.getCategoryStatsInDomain(cat, domain, m);
        //console.log(JSON.stringify(catdesc));
        var catResult = calcCategoryRecord(m, cat, domain);
        categoryResults[cat] = catResult;
        otherdomains = _.union(otherdomains, categoryResults[cat].otherDomains);
        /*
            res += `"${cat}" [label="{ ${cat} | ${catResult.nrDistinctValuesInDomain} Values in ${catResult.nrRecordsInDomain} `;
            if(catResult.nrRecordsInDomain !== catResult.nrRecords) {
              res +=  `|  ${catResult.nrDistinctValues - catResult.nrDistinctValuesInDomain} other values in ${catResult.nrRecords - catResult.nrRecordsInDomain} other records`;
            } else {
              res += ` `;
            }
            res += `}"]\n`;
        */
        //console.log(JSON.stringify(m.full.domain[domain]));
        if (m.full.domain[domain].categories[cat]) {
            var synonymsString = Util.listToCommaAnd(catdesc.categoryDesc && catdesc.categoryDesc.synonyms && catdesc.categoryDesc.synonyms || []) || "&nbsp;";
            res += "\n\t\t\ttr\n\t\t\t\t\ttd.cat_count " + cat + "\n\t\t\t\t\ttd " + catdesc.presentRecords + " distinct values in " + catdesc.percPresent + "% of records\n\t\t\t\t\ttd\n\t\t\t\t\t\ttable\n\t\t\t\t\t\t\ttr.cat_synonyms\n\t\t\t\t\t\t\t\ttd " + synonymsString + "\n\t\t\t\t\t\t\ttr.cat_description\n\t\t\t\t\t\t\t\ttd " + replaceBr(catdesc.categoryDesc && catdesc.categoryDesc.description || "") + "\n\t\t\t\t\t\t\ttr.cat_samplevalues\n\t\t\t\t\t\t\t\ttd " + replaceBr(catdesc.sampleValues) + "\n      ";
        }
    });
    var othercats = cats.length - Object.keys(m.full.domain[domain].categories).length;
    var remainingCategories = _.difference(cats, Object.keys(m.full.domain[domain].categories));
    if (othercats > 0) {
        res += "\n\t\tp   and " + othercats + " other categories\n\t\t| " + Util.listToCommaAnd(remainingCategories) + "\n       ";
    }
    /*
      // calculate other domains.
      // draw "other categories"
      res += `node [color=purple, style=filled]; \n`
      otherdomains.forEach(function(otherdomain) {
        res += `"${otherdomain}" \n`;
      });
      // count records in domain :
      var nrRecords = m.records.reduce(function(prev,entry) {
      return prev + ((entry._domain === domain) ? 1 : 0);
      },0);
      res += `node [shape=record]; \n`
      res += ` "record" [label="{<f0> ${domain} | ${nrRecords}}"] \n`;
         res += ` "r_other" [label="{<f0> other | ${nrRecords}}"] \n `;
         res += `# relation from categories to domain\n`;
      cats.forEach(function(cat) {
        res += ` "${cat}" -> "${domain}" \n`;
      })
     
      res += `# relation from categories to records\n`;
      cats.forEach(function(cat) {
        var rec = categoryResults[cat];
        res += ` "${cat}" -> "record" \n`;
      })
     
      //other domains to this
      cats.forEach(function(cat) {
     
      })
    */
    /*
    cats fo
      digraph sdsu {
      size="36,36";
      node [color=yellow, style=filled];
      FLPD FLP "BOM Editor", "WIKIURL" "UI5 Documentation", "UI5 Example", "STARTTA"
      BCP
      node [color=grey, style=filled];
      node [fontname="Verdana", size="30,30"];
      node [color=grey, style=filled];
      graph [ fontname = "Arial",
    */
    res += "\n\t\th3 Version\n\t\t\ta.small(href=\"/whatsnew\")\n\n\nblock scripts\n\tscript(src='/vendor/jquery-2.2.3.min.js')\n\tscript(src='/vendor/bootstrap.min.js')\n\tscript(src='/js/views/settings.js')\n";
    return res;
}
exports.tabDomain = tabDomain;
var child_process_1 = require("child_process");
function execCmd(cmd) {
    child_process_1.exec(cmd, function (error, stdout, stderr) {
        if (error) {
            console.error("exec error: " + error);
            return;
        }
        console.log("stdout: " + stdout);
        console.log("stderr: " + stderr);
    });
}
;
function visModels(m, folderOut) {
    m.domains.forEach(function (sDomain) {
        var s = graphDomain(sDomain, m);
        var fnGraph = folderOut + "/" + sDomain.replace(/ /g, '_') + ".gv";
        fs.writeFileSync(fnGraph, s);
        if (process.env.GRAPHVIZ) {
            console.log("here the file " + fnGraph);
            execCmd(process.env.GRAPHVIZ + " -Tjpeg -O " + fnGraph);
        }
    });
}
exports.visModels = visModels;
function tabModels(m, folderOut) {
    m.domains.forEach(function (sDomain) {
        var s = tabDomain(sDomain, m);
        var fnGraph = folderOut + "/" + sDomain.replace(/ /g, '_') + ".jade";
        debuglog("here the file " + fnGraph);
        fs.writeFileSync(fnGraph, s);
    });
}
exports.tabModels = tabModels;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9tb2RlbC92aXNtb2RlbC50cyIsIm1vZGVsL3Zpc21vZGVsLmpzIl0sIm5hbWVzIjpbImZzIiwicmVxdWlyZSIsIk1vZGVsIiwiVXRpbCIsIkRlc2NyaWJlIiwiXyIsImRlYnVnIiwiZGVidWdsb2ciLCJlbGFzdGljbHVuciIsIkpTT05Fc2NhcGUiLCJzIiwicmVwbGFjZSIsImV4cG9ydHMiLCJtYWtlTHVuckluZGV4IiwibW9kZWxwYXRoIiwib3V0cHV0Iiwic2lsZW50IiwibWRsIiwiSlNPTiIsInBhcnNlIiwicmVhZEZpbGVTeW5jIiwiZGF0YSIsImNhdHMiLCJjYXRlZ29yeSIsImZpbHRlciIsImEiLCJxYmVEYXRhT2JqZWN0cyIsImNhdCIsIlFCRSIsIlFCRUluY2x1ZGUiLCJxYmVEYXRhTmFtZXMiLCJtYXAiLCJuYW1lIiwidW5pb24iLCJjb2x1bW5zIiwiTFVOUkluZGV4IiwiYm9tZGF0YSIsImluZGV4IiwidGhhdCIsImZvckVhY2giLCJmaWVsZCIsImFkZEZpZWxkIiwic2V0UmVmIiwic2F2ZURvY3VtZW50IiwibyIsImlkIiwicmVjb3JkIiwiYWRkRG9jIiwiZWxhc3RpYyIsInRoZUluZGV4IiwidG9KU09OIiwiY29sbmFtZSIsInJlcyIsImxlbmd0aCIsIkVycm9yIiwiY29sdW1uTmFtZXMiLCJjb2wiLCJqc29ucCIsImpvaW4iLCJqc29uIiwiZGVzY3JpcHRpb24iLCJkZWZhdWx0V2lkdGgiLCJ0aGVJbmRleFN0ciIsInN0cmluZ2lmeSIsImNsZWFuc2VkZGF0YSIsImtleSIsImNvbnNvbGUiLCJsb2ciLCJkaWZmZXJlbmNlIiwid3JpdGVGaWxlU3luYyIsImNhbGNDYXRlZ29yeVJlY29yZCIsIm0iLCJkb21haW4iLCJvdGhlcmRvbWFpbnMiLCJnZXREb21haW5zRm9yQ2F0ZWdvcnkiLCJwdWxsIiwibnJEaXN0aW5jdFZhbHVlcyIsIm5yRGlzdGluY3RWYWx1ZXNJbkRvbWFpbiIsIm5yUmVjb3JkcyIsIm5yUmVjb3Jkc0luRG9tYWluIiwibnJUb3RhbFJlY29yZHNJbkRvbWFpbiIsInZhbHVlcyIsInZhbHVlc0luRG9tYWluIiwiZGlzdGluY3RWYWx1ZXMiLCJyZWNvcmRzIiwib0VudHJ5IiwiX2RvbWFpbiIsInZhbHVlIiwiT2JqZWN0Iiwia2V5cyIsImdyYXBoRG9tYWluIiwiZ2V0Q2F0ZWdvcmllc0ZvckRvbWFpbiIsImNhdGVnb3J5UmVzdWx0cyIsImNhdFJlc3VsdCIsIm90aGVyRG9tYWlucyIsIm90aGVyZG9tYWluIiwicmVkdWNlIiwicHJldiIsImVudHJ5IiwicmVjIiwicmVwbGFjZUJyIiwic3RyaW5nIiwidGFiRG9tYWluIiwic29ydENhdGVnb3JpZXNCeUltcG9ydGFuY2UiLCJmdWxsIiwiY2F0ZWdvcmllcyIsImNhdGRlc2MiLCJnZXRDYXRlZ29yeVN0YXRzSW5Eb21haW4iLCJkb21haW5EZXNjciIsImNhdGVnb3J5TWFwIiwic3lub255bXNTdHJpbmciLCJsaXN0VG9Db21tYUFuZCIsImNhdGVnb3J5RGVzYyIsInN5bm9ueW1zIiwicHJlc2VudFJlY29yZHMiLCJwZXJjUHJlc2VudCIsInNhbXBsZVZhbHVlcyIsIm90aGVyY2F0cyIsInJlbWFpbmluZ0NhdGVnb3JpZXMiLCJjaGlsZF9wcm9jZXNzXzEiLCJleGVjQ21kIiwiY21kIiwiZXhlYyIsImVycm9yIiwic3Rkb3V0Iiwic3RkZXJyIiwidmlzTW9kZWxzIiwiZm9sZGVyT3V0IiwiZG9tYWlucyIsInNEb21haW4iLCJmbkdyYXBoIiwicHJvY2VzcyIsImVudiIsIkdSQVBIVklaIiwidGFiTW9kZWxzIl0sIm1hcHBpbmdzIjoiQUFBQTs7O0FDR0E7O0FETUEsSUFBQUEsS0FBQUMsUUFBQSxJQUFBLENBQUE7QUFFQSxJQUFBQyxRQUFBRCxRQUFBLFNBQUEsQ0FBQTtBQUNBLElBQUFFLE9BQUFGLFFBQUEsZ0JBQUEsQ0FBQTtBQUVBLElBQUFHLFdBQUFILFFBQUEsbUJBQUEsQ0FBQTtBQUVBLElBQUFJLElBQUFKLFFBQUEsUUFBQSxDQUFBO0FBQ0EsSUFBQUss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O0FBQ0YsS0FSRDtBQVNEO0FBVkR0SCxRQUFBa0gsU0FBQSxHQUFBQSxTQUFBO0FBWUEsU0FBQVEsU0FBQSxDQUEwQi9ELENBQTFCLEVBQTZDd0QsU0FBN0MsRUFBOEQ7QUFDNUR4RCxNQUFFeUQsT0FBRixDQUFVekYsT0FBVixDQUFrQixVQUFVMEYsT0FBVixFQUFpQjtBQUNqQyxZQUFJdkgsSUFBSTRGLFVBQVUyQixPQUFWLEVBQW1CMUQsQ0FBbkIsQ0FBUjtBQUNBLFlBQUkyRCxVQUFVSCxZQUFZLEdBQVosR0FBa0JFLFFBQVF0SCxPQUFSLENBQWdCLElBQWhCLEVBQXNCLEdBQXRCLENBQWxCLEdBQStDLE9BQTdEO0FBQ0FKLGlCQUFTLG1CQUFtQjJILE9BQTVCO0FBQ0FsSSxXQUFHcUUsYUFBSCxDQUFpQjZELE9BQWpCLEVBQTBCeEgsQ0FBMUI7QUFDRCxLQUxEO0FBTUQ7QUFQREUsUUFBQTBILFNBQUEsR0FBQUEsU0FBQSIsImZpbGUiOiJtb2RlbC92aXNtb2RlbC5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogdmlzdWFsaXplIGEgbW9kZWwgYW5kIGNhbGN1bGF0ZSBzb21lIHN0YXRpc3RpY3NcbiAqL1xuXG5cblxuaW1wb3J0ICogYXMgSU1hdGNoIGZyb20gJy4uL21hdGNoL2lmbWF0Y2gnO1xuXG5cbmltcG9ydCAqIGFzIGZzIGZyb20gJ2ZzJztcblxuaW1wb3J0ICogYXMgTW9kZWwgZnJvbSAnLi9tb2RlbCc7XG5pbXBvcnQgKiBhcyBVdGlsIGZyb20gJy4uL3V0aWxzL3V0aWxzJztcblxuaW1wb3J0ICogYXMgRGVzY3JpYmUgZnJvbSAnLi4vbWF0Y2gvZGVzY3JpYmUnO1xuXG5pbXBvcnQgKiBhcyBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgKiBhcyBkZWJ1ZyBmcm9tICdkZWJ1Zyc7XG5cbi8vaW1wb3J0ICogYXMgZWxhc3RpY2x1bnIgZnJvbSAnZWxhc3RpY2x1bnInO1xuXG52YXIgZGVidWdsb2cgPSBkZWJ1ZygndmlzbW9kZWwudHMnKTtcblxuaW50ZXJmYWNlIENhdGVnb3J5UmVjb3JkIHtcbiAgb3RoZXJkb21haW5zOiBzdHJpbmdbXSxcbiAgbnJEaXN0aW5jdFZhbHVlczogbnVtYmVyLFxuICBuckRpc3RpbmN0VmFsdWVzSW5Eb21haW46IG51bWJlcixcbiAgbnJSZWNvcmRzOiBudW1iZXIsXG4gIG5yUmVjb3Jkc0luRG9tYWluOiBudW1iZXIsXG4gIG5yVG90YWxSZWNvcmRzSW5Eb21haW46IG51bWJlclxufTtcblxudmFyIGVsYXN0aWNsdW5yID0gcmVxdWlyZSgnZWxhc3RpY2x1bnInKTtcblxuXG5leHBvcnQgZnVuY3Rpb24gSlNPTkVzY2FwZShzOiBzdHJpbmcpIHtcblxuICByZXR1cm4gcy5yZXBsYWNlKC9cXFxcL2csIFwiXFxcXFxcXFxcIikucmVwbGFjZSgvXFxuL2csIFwiXFxcXG5cIilcbiAgICAucmVwbGFjZSgvXFwnL2csIFwiXFxcXCdcIilcbiAgICAucmVwbGFjZSgvXFxcIi9nLCAnXFxcXFwiJylcbiAgICAucmVwbGFjZSgvXFwmL2csIFwiXFxcXCZcIilcbiAgICAucmVwbGFjZSgvXFxyL2csIFwiXFxcXHJcIilcbiAgICAucmVwbGFjZSgvXFx0L2csIFwiXFxcXHRcIik7XG4gIC8vIC5yZXBsYWNlKC9cXGIvZywgXCJcXFxcYlwiKVxuICAvLyAucmVwbGFjZSgvXFxmL2csIFwiXFxcXGZcIik7XG59O1xuXG5cbmV4cG9ydCBmdW5jdGlvbiBtYWtlTHVuckluZGV4KG1vZGVscGF0aDogc3RyaW5nLCBvdXRwdXQ6IHN0cmluZywgc2lsZW50ID8gOiBib29sZWFuKSB7XG4gIHZhciBtZGwgPSBKU09OLnBhcnNlKCcnICsgZnMucmVhZEZpbGVTeW5jKG1vZGVscGF0aCArICcubW9kZWwuanNvbicpKTtcbiAgdmFyIGRhdGEgPSBKU09OLnBhcnNlKCcnICsgZnMucmVhZEZpbGVTeW5jKG1vZGVscGF0aCArICcuZGF0YS5qc29uJykpO1xuXG4gIHZhciBjYXRzID0gbWRsLmNhdGVnb3J5LmZpbHRlcihhID0+IHR5cGVvZiBhICE9PSAnc3RyaW5nJyk7XG5cbiAgdmFyIHFiZURhdGFPYmplY3RzID0gY2F0cy5maWx0ZXIoY2F0ID0+IChjYXQuUUJFIHx8IGNhdC5RQkVJbmNsdWRlKSk7XG5cbiAgLy9jb25zb2xlLmxvZyhcImhlcmUgY2F0c1wiICsgSlNPTi5zdHJpbmdpZnkoY2F0cykpO1xuICAvL2NvbnNvbGUubG9nKFwiXFxuaGVyZSBkYXRhIG9iamVjdHNcIiArIEpTT04uc3RyaW5naWZ5KHFiZURhdGFPYmplY3RzKSk7XG4gIHZhciBxYmVEYXRhTmFtZXMgPSBxYmVEYXRhT2JqZWN0cy5tYXAoY2F0ID0+IGNhdC5uYW1lKTtcblxuICBxYmVEYXRhTmFtZXMgPSBfLnVuaW9uKHFiZURhdGFOYW1lcywgbWRsLmNvbHVtbnMpXG5cblxuICB2YXIgTFVOUkluZGV4ID0gY2F0cy5maWx0ZXIoY2F0ID0+IGNhdC5MVU5SSW5kZXgpLm1hcChjYXQgPT4gY2F0Lm5hbWUpO1xuICAvL3ZhciBlbGFzdGljbHVuciA9IHJlcXVpcmUoJ2x1bnInKTtcbiAgdmFyIGJvbWRhdGEgPSBkYXRhO1xuICAvLyBpbmRleCBhbGwgTFVOUiBwcm9wZXJ0aWVzXG4gIHZhciBpbmRleCA9IGVsYXN0aWNsdW5yKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgdGhhdCA9IHRoaXM7XG4gICAgTFVOUkluZGV4IC8qXG4gICAgICAgICAgICBbXCJhcHBJZFwiLFxuICAgICAgICAgICAgXCJBcHBLZXlcIixcbiAgICAgICAgICAgIFwiQXBwTmFtZVwiLFxuICAgICAgICAgICAgICAgIFwiQXBwbGljYXRpb25Db21wb25lbnRcIixcbiAgICAgICAgICAgICAgICBcIlJvbGVOYW1lXCIsXG4gICAgICAgICAgICAgICAgXCJBcHBsaWNhdGlvblR5cGVcIixcbiAgICAgICAgICAgICAgICBcIkJTUE5hbWVcIixcbiAgICAgICAgICAgICAgICBcIkJTUEFwcGxpY2F0aW9uVVJMXCIsXG4gICAgICAgICAgICAgICAgXCJyZWxlYXNlTmFtZVwiLFxuICAgICAgICAgICAgICAgIFwiQnVzaW5lc3NDYXRhbG9nXCIsXG4gICAgICAgICAgICAgICAgXCJUZWNobmljYWxDYXRhbG9nXCJdICovIC5mb3JFYWNoKGZ1bmN0aW9uIChmaWVsZCkge1xuICAgICAgICB0aGF0LmFkZEZpZWxkKGZpZWxkKTtcbiAgICAgIH0pO1xuICAgIHRoaXMuc2V0UmVmKCdpZCcpO1xuICAgIHRoaXMuc2F2ZURvY3VtZW50KGZhbHNlKTtcbiAgfSk7XG4gIGJvbWRhdGEuZm9yRWFjaChmdW5jdGlvbiAobywgaW5kZXgpIHtcbiAgICBvLmlkID0gaW5kZXg7XG4gIH0pO1xuICBib21kYXRhLmZvckVhY2goZnVuY3Rpb24gKHJlY29yZCkge1xuICAgIGluZGV4LmFkZERvYyhyZWNvcmQpO1xuICB9KTtcbiAgdmFyIGVsYXN0aWMgPSBpbmRleDtcblxuICAvLyBkdW1wIHRoZSBsdW5yIGluZGV4XG4gIC8vXG4gIHZhciB0aGVJbmRleCA9IGluZGV4LnRvSlNPTigpO1xuICB2YXIgY29sdW1ucyA9IG1kbC5jb2x1bW5zLm1hcChjb2xuYW1lID0+ICB7XG4gICAgdmFyIHJlcyA9IGNhdHMuZmlsdGVyKGNhdCA9PiBjYXQubmFtZSA9PT0gY29sbmFtZSk7XG4gICAgaWYocmVzLmxlbmd0aCAhPT0gMSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwidW5kZWZpbmVkIG9yIG5vbi1vYmplY3QgY29sdW1uIDogXCIgKyBjb2xuYW1lICk7XG4gICAgfTtcbiAgICByZXR1cm4gcmVzWzBdO1xuICB9KTtcblxuICB2YXIgY29sdW1uTmFtZXMgPSBjb2x1bW5zLm1hcChjb2wgPT4gY29sLm5hbWUpO1xuXG4gIHZhciBqc29ucCA9IGB2YXIgbWRsZGF0YSA9IHt9O1xcbi8vY29sdW1ucyBcXG4gbWRsZGF0YS5jb2x1bW5zID0gW1wiJHtjb2x1bW5zLm1hcChjb2wgPT4gY29sLm5hbWUpLmpvaW4oJ1wiLFwiJyl9XCJdO2A7XG5cbiAgdmFyIGpzb24gPSBgeyBcImNvbHVtbnNcIiAgOiBbXCIke2NvbHVtbnMubWFwKGNvbCA9PiBKU09ORXNjYXBlKGNvbC5uYW1lKSkuam9pbignXCIsXCInKX1cIl0sYDtcbiAgLy8ganNvbnAgKz0gYFxcbiBtZGxkYXRhLmZ1bGxkYXRhID0gJHtKU09OLnN0cmluZ2lmeShib21kYXRhKX07XFxuYDtcbiAgLy9qc29ucCArPSBgXFxuLy9jb2x1bW5zIGluZm8gXFxuIG1kbGRhdGEubHVucmNvbHVtbnMgPSBbXCJ7JHtMVU5SSW5kZXguam9pbignXCIsXCInKX1cIl07YDtcblxuICBqc29ucCArPSBgXFxuLy9jb2x1bW5zIGluZm8gXFxuIG1kbGRhdGEuY29sdW1uc0Rlc2NyaXB0aW9uID0geyR7Y29sdW1ucy5tYXAoY29sID0+XG4gICAgYCBcXG4gXCIke2NvbC5uYW1lfVwiIDogIFwiJHtKU09ORXNjYXBlKGNvbC5kZXNjcmlwdGlvbiB8fCBjb2wubmFtZSl9XCIgYFxuICApLmpvaW4oJywnKX1cbiAgICAgIH07YDtcblxuICBqc29uICs9IGBcImNvbHVtbnNEZXNjcmlwdGlvblwiIDogeyR7Y29sdW1ucy5tYXAoY29sID0+XG4gICAgYCBcXG4gXCIke2NvbC5uYW1lfVwiIDogIFwiJHtKU09ORXNjYXBlKGNvbC5kZXNjcmlwdGlvbiB8fCBjb2wubmFtZSl9XCIgYFxuICApLmpvaW4oJywnKX1cbiAgICAgIH0sYDtcblxuXG4gIGpzb25wICs9IGBcXG4vL2NvbHVtbnMgaW5mbyBcXG4gbWRsZGF0YS5jb2x1bW5zRGVmYXVsdFdpZHRoID0geyR7Y29sdW1ucy5tYXAoY29sID0+XG4gICAgYCBcXG4gXCIke2NvbC5uYW1lfVwiIDogJHtjb2wuZGVmYXVsdFdpZHRoIHx8IDE1MH0gYFxuICApLmpvaW4oJywnKX1cbiAgICAgIH07YDtcblxuICBqc29uICs9IGBcXG5cImNvbHVtbnNEZWZhdWx0V2lkdGhcIiA6IHske2NvbHVtbnMubWFwKGNvbCA9PlxuICAgIGAgXFxuIFwiJHtjb2wubmFtZX1cIiA6ICR7Y29sLmRlZmF1bHRXaWR0aCB8fCAxNTB9IGBcbiAgKS5qb2luKCcsJyl9XG4gICAgICB9LGA7XG5cblxuXG4gIHZhciB0aGVJbmRleFN0ciA9IEpTT04uc3RyaW5naWZ5KHRoZUluZGV4KTtcblxuICBqc29ucCArPSBcIlxcbnZhciBzZXJJbmRleCA9XFxcIlwiICsgSlNPTkVzY2FwZSh0aGVJbmRleFN0cikgKyBcIlxcXCI7XFxuXCI7XG4gIC8vIGpzb25wICs9IFwiXFxudmFyIHNlckluZGV4ID1cIiArIEpTT04uc3RyaW5naWZ5KHRoZUluZGV4KSArIFwiO1xcblwiO1xuXG5cbiAganNvbiArPSAnXFxuXCJzZXJJbmRleFwiIDonICsgdGhlSW5kZXhTdHIgKyAgJywnO1xuXG4gIC8vY29uc29sZS5sb2coXCJoZXJlIGFsbCBuYW1lcyBcIiArIEpTT04uc3RyaW5naWZ5KHFiZURhdGFOYW1lcykpO1xuICB2YXIgY2xlYW5zZWRkYXRhID0gYm9tZGF0YS5tYXAobyA9PiB7XG4gICAgdmFyIHJlcyA9IHt9O1xuICAgIHFiZURhdGFOYW1lcy5mb3JFYWNoKGtleSA9PiB7XG4gICAgICByZXNba2V5XSA9IG9ba2V5XTtcbiAgICB9KTtcbiAgICByZXR1cm4gcmVzO1xuICB9KTtcblxuICBpZighc2lsZW50KSB7XG4gICAgY29uc29sZS5sb2coXCJkdW1waW5nIFwiICsgb3V0cHV0KTtcbiAgICBjb25zb2xlLmxvZyhcImxlbmd0aCBvZiBpbmRleCBzdHJcIiArIHRoZUluZGV4U3RyLmxlbmd0aClcbiAgICBjb25zb2xlLmxvZyhcImF2YWlsYWJsZSAgICAgICAgICBcIiArIGNvbHVtbnMubGVuZ3RoICsgXCIgY29sdW1uc1wiKTtcbiAgICBjb25zb2xlLmxvZyhcInJldHVybmluZyBhcyBkYXRhICBcIiArIHFiZURhdGFOYW1lcy5sZW5ndGggKyBcIiBjb2x1bW5zXCIpO1xuICAgIGNvbnNvbGUubG9nKFwiaW5kZXhpbmcgICAgICAgICAgIFwiICsgTFVOUkluZGV4Lmxlbmd0aCArIFwiIGNvbHVtbnNcIik7XG4gICAgY29uc29sZS5sb2coJ3JldHVybmVkIGJ1dCBub3QgYXZhaWxhYmxlJyAsIF8uZGlmZmVyZW5jZShxYmVEYXRhTmFtZXMsIGNvbHVtbk5hbWVzKS5qb2luKFwiLCBcIikpO1xuICAgIGNvbnNvbGUubG9nKCdyZXR1cm5lZCBidXQgbm90IGluZGV4ZWQnICwgXy5kaWZmZXJlbmNlKHFiZURhdGFOYW1lcywgTFVOUkluZGV4KS5qb2luKFwiLCBcIikpO1xuICB9XG5cbiAganNvbnAgKz0gXCJ2YXIgZGF0YT1cIiArIEpTT04uc3RyaW5naWZ5KGNsZWFuc2VkZGF0YSkgKyBcIjtcIjtcblxuICBqc29uICs9ICdcImRhdGFcIjonICsgSlNPTi5zdHJpbmdpZnkoY2xlYW5zZWRkYXRhKSArIFwiXFxufVwiO1xuXG4gIGpzb25wICs9IGBcblxuICAgICAgICAgICAvLyB2YXIgZWxhc3RpYyA9IGVsYXN0aWNsdW5yLkluZGV4LmxvYWQoc2VySW5kZXgpO1xuXG4gIGA7XG5cbiAgLy9mcy53cml0ZUZpbGVTeW5jKG91dHB1dCArIFwiLmx1bnIuanNcIiwganNvbnApO1xuICBmcy53cml0ZUZpbGVTeW5jKG91dHB1dCArIFwiLmx1bnIuanNvblwiLCBqc29uKTtcbn1cblxuXG5cblxuXG4vKlxuXG4gIHZhciBpbmRleCA9IGVsYXN0aWx1bnIuSW5kZXgubG9hZChvYmopO1xuXG5cbn1cblxuIFwiUUJFXCIgOiBmYWxzZSxcbiAgICAgIFwiUUJFSW5jbHVkZVwiIDogdHJ1ZSxcbiAgICAgIFwiTFVOUkluZGV4XCI6IGZhbHNlXG4qL1xuXG5cblxuZXhwb3J0IGZ1bmN0aW9uIGNhbGNDYXRlZ29yeVJlY29yZChtOiBJTWF0Y2guSU1vZGVscywgY2F0ZWdvcnk6IHN0cmluZywgZG9tYWluOiBzdHJpbmcpOiBDYXRlZ29yeVJlY29yZCB7XG5cbiAgdmFyIG90aGVyZG9tYWlucyA9IE1vZGVsLmdldERvbWFpbnNGb3JDYXRlZ29yeShtLCBjYXRlZ29yeSk7XG4gIF8ucHVsbChvdGhlcmRvbWFpbnMsIGRvbWFpbik7XG4gIHZhciByZXMgPSB7XG4gICAgb3RoZXJkb21haW5zOiBvdGhlcmRvbWFpbnMsXG4gICAgbnJEaXN0aW5jdFZhbHVlczogMCxcbiAgICBuckRpc3RpbmN0VmFsdWVzSW5Eb21haW46IDAsXG4gICAgbnJSZWNvcmRzOiAwLFxuICAgIG5yUmVjb3Jkc0luRG9tYWluOiAwLFxuICAgIG5yVG90YWxSZWNvcmRzSW5Eb21haW46IDAsXG4gIH0gYXMgQ2F0ZWdvcnlSZWNvcmQ7XG5cbiAgdmFyIHZhbHVlcyA9IFtdO1xuICB2YXIgdmFsdWVzSW5Eb21haW4gPSBbXTtcbiAgdmFyIG5yUmVjb3Jkc0luRG9tYWluID0gMDtcbiAgdmFyIGRpc3RpbmN0VmFsdWVzID0gbS5yZWNvcmRzLmZvckVhY2goZnVuY3Rpb24gKG9FbnRyeSkge1xuICAgIGlmIChvRW50cnkuX2RvbWFpbiA9PT0gZG9tYWluKSB7XG4gICAgICByZXMubnJUb3RhbFJlY29yZHNJbkRvbWFpbiArPSAxO1xuICAgIH1cbiAgICBpZiAob0VudHJ5W2NhdGVnb3J5XSkge1xuICAgICAgdmFyIHZhbHVlID0gb0VudHJ5W2NhdGVnb3J5XTtcbiAgICAgIGlmIChvRW50cnkuX2RvbWFpbiA9PT0gZG9tYWluKSB7XG4gICAgICAgIHZhbHVlc0luRG9tYWluW3ZhbHVlXSA9ICh2YWx1ZXNJbkRvbWFpblt2YWx1ZV0gfHwgMCkgKyAxO1xuICAgICAgICByZXMubnJSZWNvcmRzSW5Eb21haW4gKz0gMTtcbiAgICAgIH1cbiAgICAgIHZhbHVlc1t2YWx1ZV0gPSAodmFsdWVzW3ZhbHVlXSB8fCAwKSArIDE7XG4gICAgICByZXMubnJSZWNvcmRzICs9IDE7XG4gICAgfVxuICB9KTtcbiAgcmVzLm5yRGlzdGluY3RWYWx1ZXMgPSBPYmplY3Qua2V5cyh2YWx1ZXMpLmxlbmd0aDtcbiAgcmVzLm5yRGlzdGluY3RWYWx1ZXNJbkRvbWFpbiA9IE9iamVjdC5rZXlzKHZhbHVlc0luRG9tYWluKS5sZW5ndGg7XG4gIHJldHVybiByZXM7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBncmFwaERvbWFpbihkb21haW46IHN0cmluZywgbTogSU1hdGNoLklNb2RlbHMpIHtcbiAgLy8gZHJhdyBhIG1vZGVsIGRvbWFpbnNcbiAgdmFyIHJlcyA9IGBcbiAgICBkaWdyYXBoIHNkc3Uge1xuXHRzaXplPVwiMzYsMzZcIjtcbiAgIHJhbmtkaXI9TFJcblx0bm9kZSBbY29sb3I9eWVsbG93LCBzdHlsZT1maWxsZWRdO1xuICAgIFwiJHtkb21haW59XCJcbiAgYDtcbiAgLy8gYWRkIGFsbCBjYXRlZ29yeSBub2Rlc1xuICByZXMgKz0gYG5vZGUgW3NoYXBlPXJlY29yZCwgY29sb3I9eWVsbG93LCBzdHlsZT1maWxsZWRdO1xcbiBgXG4gIHZhciBjYXRzID0gTW9kZWwuZ2V0Q2F0ZWdvcmllc0ZvckRvbWFpbihtLCBkb21haW4pO1xuXG4gIHZhciBjYXRlZ29yeVJlc3VsdHMgPSB7fTtcbiAgdmFyIG90aGVyZG9tYWlucyA9IFtdO1xuICBjYXRzLmZvckVhY2goZnVuY3Rpb24gKGNhdCkge1xuICAgIHZhciBjYXRSZXN1bHQgPSBjYWxjQ2F0ZWdvcnlSZWNvcmQobSwgY2F0LCBkb21haW4pO1xuICAgIGNhdGVnb3J5UmVzdWx0c1tjYXRdID0gY2F0UmVzdWx0O1xuICAgIG90aGVyZG9tYWlucyA9IF8udW5pb24ob3RoZXJkb21haW5zLCBjYXRlZ29yeVJlc3VsdHNbY2F0XS5vdGhlckRvbWFpbnMpO1xuICAgIHJlcyArPSBgXCIke2NhdH1cIiBbbGFiZWw9XCJ7ICR7Y2F0fSB8ICR7Y2F0UmVzdWx0Lm5yRGlzdGluY3RWYWx1ZXNJbkRvbWFpbn0gVmFsdWVzIGluICR7Y2F0UmVzdWx0Lm5yUmVjb3Jkc0luRG9tYWlufSBgO1xuICAgIGlmIChjYXRSZXN1bHQubnJSZWNvcmRzSW5Eb21haW4gIT09IGNhdFJlc3VsdC5uclJlY29yZHMpIHtcbiAgICAgIHJlcyArPSBgfCAgJHtjYXRSZXN1bHQubnJEaXN0aW5jdFZhbHVlcyAtIGNhdFJlc3VsdC5uckRpc3RpbmN0VmFsdWVzSW5Eb21haW59IG90aGVyIHZhbHVlcyBpbiAke2NhdFJlc3VsdC5uclJlY29yZHMgLSBjYXRSZXN1bHQubnJSZWNvcmRzSW5Eb21haW59IG90aGVyIHJlY29yZHNgO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXMgKz0gYCBgO1xuICAgIH1cbiAgICByZXMgKz0gYH1cIl1cXG5gO1xuICB9KTtcblxuICAvLyBjYWxjdWxhdGUgb3RoZXIgZG9tYWlucy5cbiAgLy8gZHJhdyBcIm90aGVyIGNhdGVnb3JpZXNcIlxuICByZXMgKz0gYG5vZGUgW2NvbG9yPXB1cnBsZSwgc3R5bGU9ZmlsbGVkXTsgXFxuYFxuICBvdGhlcmRvbWFpbnMuZm9yRWFjaChmdW5jdGlvbiAob3RoZXJkb21haW4pIHtcbiAgICByZXMgKz0gYFwiJHtvdGhlcmRvbWFpbn1cIiBcXG5gO1xuICB9KTtcbiAgLy8gY291bnQgcmVjb3JkcyBpbiBkb21haW4gOlxuICB2YXIgbnJSZWNvcmRzID0gbS5yZWNvcmRzLnJlZHVjZShmdW5jdGlvbiAocHJldiwgZW50cnkpIHtcbiAgICByZXR1cm4gcHJldiArICgoZW50cnkuX2RvbWFpbiA9PT0gZG9tYWluKSA/IDEgOiAwKTtcbiAgfSwgMCk7XG4gIHJlcyArPSBgbm9kZSBbc2hhcGU9cmVjb3JkXTsgXFxuYFxuICByZXMgKz0gYCBcInJlY29yZFwiIFtsYWJlbD1cIns8ZjA+ICR7ZG9tYWlufSB8ICR7bnJSZWNvcmRzfX1cIl0gXFxuYDtcblxuICByZXMgKz0gYCBcInJfb3RoZXJcIiBbbGFiZWw9XCJ7PGYwPiBvdGhlciB8ICR7bnJSZWNvcmRzfX1cIl0gXFxuIGA7XG5cbiAgcmVzICs9IGAjIHJlbGF0aW9uIGZyb20gY2F0ZWdvcmllcyB0byBkb21haW5cXG5gO1xuICBjYXRzLmZvckVhY2goZnVuY3Rpb24gKGNhdCkge1xuICAgIHJlcyArPSBgIFwiJHtjYXR9XCIgLT4gXCIke2RvbWFpbn1cIiBcXG5gO1xuICB9KVxuXG5cbiAgcmVzICs9IGAjIHJlbGF0aW9uIGZyb20gY2F0ZWdvcmllcyB0byByZWNvcmRzXFxuYDtcbiAgY2F0cy5mb3JFYWNoKGZ1bmN0aW9uIChjYXQpIHtcbiAgICB2YXIgcmVjID0gY2F0ZWdvcnlSZXN1bHRzW2NhdF07XG4gICAgcmVzICs9IGAgXCIke2NhdH1cIiAtPiBcInJlY29yZFwiIFxcbmA7XG4gIH0pXG5cblxuICAvL290aGVyIGRvbWFpbnMgdG8gdGhpc1xuICBjYXRzLmZvckVhY2goZnVuY3Rpb24gKGNhdCkge1xuXG5cbiAgfSlcblxuICAvKlxuICBjYXRzIGZvXG4gICAgZGlncmFwaCBzZHN1IHtcblx0c2l6ZT1cIjM2LDM2XCI7XG5cdG5vZGUgW2NvbG9yPXllbGxvdywgc3R5bGU9ZmlsbGVkXTtcblx0RkxQRCBGTFAgXCJCT00gRWRpdG9yXCIsIFwiV0lLSVVSTFwiIFwiVUk1IERvY3VtZW50YXRpb25cIiwgXCJVSTUgRXhhbXBsZVwiLCBcIlNUQVJUVEFcIlxuXHRCQ1Bcblx0bm9kZSBbY29sb3I9Z3JleSwgc3R5bGU9ZmlsbGVkXTtcblx0bm9kZSBbZm9udG5hbWU9XCJWZXJkYW5hXCIsIHNpemU9XCIzMCwzMFwiXTtcblx0bm9kZSBbY29sb3I9Z3JleSwgc3R5bGU9ZmlsbGVkXTtcblx0Z3JhcGggWyBmb250bmFtZSA9IFwiQXJpYWxcIixcbiAgKi9cbiAgcmVzICs9IGB9XFxuYDtcbiAgcmV0dXJuIHJlcztcbn1cbi8qXG4gICAgY2F0ZWdvcnlEZXNjIDogdGhlTW9kZWwuZnVsbC5kb21haW5bZmlsdGVyZG9tYWluXS5jYXRlZ29yaWVzW2NhdGVnb3J5XSxcbiAgICBkaXN0aW5jdCA6IGRpc3RpbmN0LFxuICAgIGRlbHRhIDogZGVsdGEsXG4gICAgcHJlc2VudFJlY29yZHMgOiByZWNvcmRDb3VudC5wcmVzZW50cmVjb3JkcyxcbiAgICBwZXJjUHJlc2VudCA6IHBlcmNlbnQsXG4gICAgc2FtcGxlVmFsdWVzIDogdmFsdWVzTGlzdFxuICB9XG4qL1xuXG5mdW5jdGlvbiByZXBsYWNlQnIoc3RyaW5nOiBzdHJpbmcpOiBzdHJpbmcge1xuICBzdHJpbmcgPSBzdHJpbmcucmVwbGFjZSgvXFxuL2csXG4gICAgYFxuXFx0XFx0XFx0XFx0XFx0XFx0XFx0XFx0XFx0XFx0XFx0YnJcblxcdFxcdFxcdFxcdFxcdFxcdFxcdFxcdFxcdFxcdFxcdHwgYFxuICApO1xuICByZXR1cm4gc3RyaW5nO1xufVxuXG5cblxuXG4vKipcbiAqIGdlbmVyYXRlIGEgdGV4dHVhbCByZXByZXNlbnRhdGlvbiBvZiBhIGRvbWFpblxuICovXG5leHBvcnQgZnVuY3Rpb24gdGFiRG9tYWluKGRvbWFpbjogc3RyaW5nLCBtOiBJTWF0Y2guSU1vZGVscykge1xuICAvLyBkcmF3IGEgbW9kZWwgZG9tYWluc1xuXG4gIHZhciBjYXRzID0gTW9kZWwuZ2V0Q2F0ZWdvcmllc0ZvckRvbWFpbihtLCBkb21haW4pO1xuICBjYXRzID0gTW9kZWwuc29ydENhdGVnb3JpZXNCeUltcG9ydGFuY2UobS5mdWxsLmRvbWFpbltkb21haW5dLmNhdGVnb3JpZXMgfHwge30sIGNhdHMpO1xuICAvL2NvbnNvbGUubG9nKGNhdHMuam9pbihcIlxcblwiKSk7XG4gIHZhciBjYXRkZXNjID0gRGVzY3JpYmUuZ2V0Q2F0ZWdvcnlTdGF0c0luRG9tYWluKGNhdHNbMF0sIGRvbWFpbiwgbSk7XG4gIHZhciBjYXRSZXN1bHQgPSBjYWxjQ2F0ZWdvcnlSZWNvcmQobSwgY2F0c1swXSwgZG9tYWluKTtcblxuICB2YXIgZG9tYWluRGVzY3IgPSBtLmZ1bGwuZG9tYWluW2RvbWFpbl0uZGVzY3JpcHRpb24gfHwgXCJcIjtcbiAgZG9tYWluRGVzY3IgPSByZXBsYWNlQnIoZG9tYWluRGVzY3IpO1xuICB2YXIgcmVzID0gYFxuXG4vLyBwcmVzZXQgZm9ybSB2YWx1ZXMgaWYgd2UgcmVjZWl2ZSBhIHVzZXJkYXRhIG9iamVjdCAvL1xuLSB1c2VyID0gdXNlclxuXG5leHRlbmRzIC4uL2xheW91dF9wXG5cbmJsb2NrIGNvbnRlbnRcblxuXHRuYXYubmF2YmFyLm5hdmJhci1kZWZhdWx0Lm5hdmJhci1maXhlZC10b3Bcblx0XHQuY29udGFpbmVyXG5cdFx0XHQubmF2YmFyLWhlYWRlclxuXHRcdFx0XHQubmF2YmFyLWJyYW5kKHN0eWxlPSdiZ2NvbG9yOm9yYW5nZTtjb2xvcjpkYXJrYmx1ZTtmb250LWZhbWlseTpBcmlhbCBCbGFjaztmb250LXNpemU6MTUuMTE4cHgnKSB3b3NhcCBkb21haW4gJHtkb21haW59XG5cdFx0XHR1bC5uYXYubmF2YmFyLW5hdi5uYXZiYXItcmlnaHQgI3t1aWR9XG5cdFx0XHRcdGxpXG5cdFx0XHRcdFx0Lm5hdmJhci1idG4jYnRuLWxvZ291dC5idG4uYnRuLWRlZmF1bHQob25jbGljaz1cImxvY2F0aW9uLmhyZWY9Jy9ob21lJ1wiKVxuXHRcdFx0XHRcdFx0fCBiYWNrIHRvIGhvbWVcblxuXHRwICAmbmJzcDtcblx0cCAmbmJzcDtcblx0cFxuXG5cdGRpdi53ZWxsXG5cdFx0aDMgZG9tYWluIFwiJHtkb21haW59XCJcblx0XHRcdHNwYW4ucHVsbC1yaWdodCAke2NhdFJlc3VsdC5uclRvdGFsUmVjb3Jkc0luRG9tYWlufSByZWNvcmRzXG5cdFx0cFxuXHRcdHNwYW4gJHtkb21haW5EZXNjcn1cblxuXHRcdHRhYmxlLnRhYmxlLnRhYmxlLWNvbmRlbnNlZC50YWJsZS1zdHJpcGVkXG5cdFx0XHR0aGVhZFxuXHRcdFx0XHR0clxuXHRcdFx0XHRcdHRoIGNhdGVnb3J5XG5cdFx0XHRcdFx0dGgoc3R5bGU9XCJ3aWR0aDoxMCVcIikgY291bnRcblx0XHRcdFx0XHR0aFxuXHRcdFx0XHRcdFx0dGFibGVcblx0XHRcdFx0XHRcdFx0dHJcblx0XHRcdFx0XHRcdFx0XHR0ZCBzeW5vbnltc1xuXHRcdFx0XHRcdFx0XHR0clxuXHRcdFx0XHRcdFx0XHRcdHRkIGRlc2NyaXB0aW9uXG5cdFx0XHRcdFx0XHRcdHRyXG5cdFx0XHRcdFx0XHRcdFx0dGQgZXhhbXBsZSB2YWx1ZXNcblx0XHRcdHRib2R5XG5gO1xuXG4gIHZhciBjYXRlZ29yeVJlc3VsdHMgPSB7fTtcbiAgdmFyIG90aGVyZG9tYWlucyA9IFtdO1xuICB2YXIgY2F0ZWdvcnlNYXAgPSBtLmZ1bGwuZG9tYWluW2RvbWFpbl0uY2F0ZWdvcmllcyB8fCB7fTtcbiAgY2F0cy5mb3JFYWNoKGZ1bmN0aW9uIChjYXQpIHtcbiAgICB2YXIgY2F0ZGVzYyA9IERlc2NyaWJlLmdldENhdGVnb3J5U3RhdHNJbkRvbWFpbihjYXQsIGRvbWFpbiwgbSk7XG4gICAgLy9jb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeShjYXRkZXNjKSk7XG4gICAgdmFyIGNhdFJlc3VsdCA9IGNhbGNDYXRlZ29yeVJlY29yZChtLCBjYXQsIGRvbWFpbik7XG4gICAgY2F0ZWdvcnlSZXN1bHRzW2NhdF0gPSBjYXRSZXN1bHQ7XG4gICAgb3RoZXJkb21haW5zID0gXy51bmlvbihvdGhlcmRvbWFpbnMsIGNhdGVnb3J5UmVzdWx0c1tjYXRdLm90aGVyRG9tYWlucyk7XG4gICAgLypcbiAgICAgICAgcmVzICs9IGBcIiR7Y2F0fVwiIFtsYWJlbD1cInsgJHtjYXR9IHwgJHtjYXRSZXN1bHQubnJEaXN0aW5jdFZhbHVlc0luRG9tYWlufSBWYWx1ZXMgaW4gJHtjYXRSZXN1bHQubnJSZWNvcmRzSW5Eb21haW59IGA7XG4gICAgICAgIGlmKGNhdFJlc3VsdC5uclJlY29yZHNJbkRvbWFpbiAhPT0gY2F0UmVzdWx0Lm5yUmVjb3Jkcykge1xuICAgICAgICAgIHJlcyArPSAgYHwgICR7Y2F0UmVzdWx0Lm5yRGlzdGluY3RWYWx1ZXMgLSBjYXRSZXN1bHQubnJEaXN0aW5jdFZhbHVlc0luRG9tYWlufSBvdGhlciB2YWx1ZXMgaW4gJHtjYXRSZXN1bHQubnJSZWNvcmRzIC0gY2F0UmVzdWx0Lm5yUmVjb3Jkc0luRG9tYWlufSBvdGhlciByZWNvcmRzYDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXMgKz0gYCBgO1xuICAgICAgICB9XG4gICAgICAgIHJlcyArPSBgfVwiXVxcbmA7XG4gICAgKi9cbiAgICAvL2NvbnNvbGUubG9nKEpTT04uc3RyaW5naWZ5KG0uZnVsbC5kb21haW5bZG9tYWluXSkpO1xuICAgIGlmIChtLmZ1bGwuZG9tYWluW2RvbWFpbl0uY2F0ZWdvcmllc1tjYXRdKSB7XG5cbiAgICAgIHZhciBzeW5vbnltc1N0cmluZyA9IFV0aWwubGlzdFRvQ29tbWFBbmQoY2F0ZGVzYy5jYXRlZ29yeURlc2MgJiYgY2F0ZGVzYy5jYXRlZ29yeURlc2Muc3lub255bXMgJiYgY2F0ZGVzYy5jYXRlZ29yeURlc2Muc3lub255bXMgfHwgW10pIHx8IFwiJm5ic3A7XCI7XG5cbiAgICAgIHJlcyArPSBgXG5cdFx0XHR0clxuXHRcdFx0XHRcdHRkLmNhdF9jb3VudCAke2NhdH1cblxcdFxcdFxcdFxcdFxcdHRkICR7Y2F0ZGVzYy5wcmVzZW50UmVjb3Jkc30gZGlzdGluY3QgdmFsdWVzIGluICR7Y2F0ZGVzYy5wZXJjUHJlc2VudH0lIG9mIHJlY29yZHNcblxcdFxcdFxcdFxcdFxcdHRkXG5cXHRcXHRcXHRcXHRcXHRcXHR0YWJsZVxuXFx0XFx0XFx0XFx0XFx0XFx0XFx0dHIuY2F0X3N5bm9ueW1zXG5cXHRcXHRcXHRcXHRcXHRcXHRcXHRcXHR0ZCAke3N5bm9ueW1zU3RyaW5nfVxuXFx0XFx0XFx0XFx0XFx0XFx0XFx0dHIuY2F0X2Rlc2NyaXB0aW9uXG5cXHRcXHRcXHRcXHRcXHRcXHRcXHRcXHR0ZCAke3JlcGxhY2VCcihjYXRkZXNjLmNhdGVnb3J5RGVzYyAmJiBjYXRkZXNjLmNhdGVnb3J5RGVzYy5kZXNjcmlwdGlvbiB8fCBcIlwiKX1cblxcdFxcdFxcdFxcdFxcdFxcdFxcdHRyLmNhdF9zYW1wbGV2YWx1ZXNcblxcdFxcdFxcdFxcdFxcdFxcdFxcdFxcdHRkICR7cmVwbGFjZUJyKGNhdGRlc2Muc2FtcGxlVmFsdWVzKX1cbiAgICAgIGA7XG4gICAgfVxuXG4gIH0pO1xuXG4gIHZhciBvdGhlcmNhdHMgPSBjYXRzLmxlbmd0aCAtIE9iamVjdC5rZXlzKG0uZnVsbC5kb21haW5bZG9tYWluXS5jYXRlZ29yaWVzKS5sZW5ndGg7XG4gIHZhciByZW1haW5pbmdDYXRlZ29yaWVzID0gXy5kaWZmZXJlbmNlKGNhdHMsIE9iamVjdC5rZXlzKG0uZnVsbC5kb21haW5bZG9tYWluXS5jYXRlZ29yaWVzKSk7XG4gIGlmICgob3RoZXJjYXRzKSA+IDApIHtcbiAgICByZXMgKz0gYFxuXFx0XFx0cCAgIGFuZCAke290aGVyY2F0c30gb3RoZXIgY2F0ZWdvcmllc1xuXFx0XFx0fCAke1V0aWwubGlzdFRvQ29tbWFBbmQocmVtYWluaW5nQ2F0ZWdvcmllcyl9XG4gICAgICAgYFxuXG4gIH1cbiAgLypcbiAgICAvLyBjYWxjdWxhdGUgb3RoZXIgZG9tYWlucy5cbiAgICAvLyBkcmF3IFwib3RoZXIgY2F0ZWdvcmllc1wiXG4gICAgcmVzICs9IGBub2RlIFtjb2xvcj1wdXJwbGUsIHN0eWxlPWZpbGxlZF07IFxcbmBcbiAgICBvdGhlcmRvbWFpbnMuZm9yRWFjaChmdW5jdGlvbihvdGhlcmRvbWFpbikge1xuICAgICAgcmVzICs9IGBcIiR7b3RoZXJkb21haW59XCIgXFxuYDtcbiAgICB9KTtcbiAgICAvLyBjb3VudCByZWNvcmRzIGluIGRvbWFpbiA6XG4gICAgdmFyIG5yUmVjb3JkcyA9IG0ucmVjb3Jkcy5yZWR1Y2UoZnVuY3Rpb24ocHJldixlbnRyeSkge1xuICAgIHJldHVybiBwcmV2ICsgKChlbnRyeS5fZG9tYWluID09PSBkb21haW4pID8gMSA6IDApO1xuICAgIH0sMCk7XG4gICAgcmVzICs9IGBub2RlIFtzaGFwZT1yZWNvcmRdOyBcXG5gXG4gICAgcmVzICs9IGAgXCJyZWNvcmRcIiBbbGFiZWw9XCJ7PGYwPiAke2RvbWFpbn0gfCAke25yUmVjb3Jkc319XCJdIFxcbmA7XG5cbiAgICByZXMgKz0gYCBcInJfb3RoZXJcIiBbbGFiZWw9XCJ7PGYwPiBvdGhlciB8ICR7bnJSZWNvcmRzfX1cIl0gXFxuIGA7XG5cbiAgICByZXMgKz0gYCMgcmVsYXRpb24gZnJvbSBjYXRlZ29yaWVzIHRvIGRvbWFpblxcbmA7XG4gICAgY2F0cy5mb3JFYWNoKGZ1bmN0aW9uKGNhdCkge1xuICAgICAgcmVzICs9IGAgXCIke2NhdH1cIiAtPiBcIiR7ZG9tYWlufVwiIFxcbmA7XG4gICAgfSlcblxuXG4gICAgcmVzICs9IGAjIHJlbGF0aW9uIGZyb20gY2F0ZWdvcmllcyB0byByZWNvcmRzXFxuYDtcbiAgICBjYXRzLmZvckVhY2goZnVuY3Rpb24oY2F0KSB7XG4gICAgICB2YXIgcmVjID0gY2F0ZWdvcnlSZXN1bHRzW2NhdF07XG4gICAgICByZXMgKz0gYCBcIiR7Y2F0fVwiIC0+IFwicmVjb3JkXCIgXFxuYDtcbiAgICB9KVxuXG5cbiAgICAvL290aGVyIGRvbWFpbnMgdG8gdGhpc1xuICAgIGNhdHMuZm9yRWFjaChmdW5jdGlvbihjYXQpIHtcblxuXG4gICAgfSlcbiAgKi9cbiAgLypcbiAgY2F0cyBmb1xuICAgIGRpZ3JhcGggc2RzdSB7XG5cdHNpemU9XCIzNiwzNlwiO1xuXHRub2RlIFtjb2xvcj15ZWxsb3csIHN0eWxlPWZpbGxlZF07XG5cdEZMUEQgRkxQIFwiQk9NIEVkaXRvclwiLCBcIldJS0lVUkxcIiBcIlVJNSBEb2N1bWVudGF0aW9uXCIsIFwiVUk1IEV4YW1wbGVcIiwgXCJTVEFSVFRBXCJcblx0QkNQXG5cdG5vZGUgW2NvbG9yPWdyZXksIHN0eWxlPWZpbGxlZF07XG5cdG5vZGUgW2ZvbnRuYW1lPVwiVmVyZGFuYVwiLCBzaXplPVwiMzAsMzBcIl07XG5cdG5vZGUgW2NvbG9yPWdyZXksIHN0eWxlPWZpbGxlZF07XG5cdGdyYXBoIFsgZm9udG5hbWUgPSBcIkFyaWFsXCIsXG4gICovXG4gIHJlcyArPSBgXG5cdFx0aDMgVmVyc2lvblxuXHRcdFx0YS5zbWFsbChocmVmPVwiL3doYXRzbmV3XCIpXG5cblxuYmxvY2sgc2NyaXB0c1xuXHRzY3JpcHQoc3JjPScvdmVuZG9yL2pxdWVyeS0yLjIuMy5taW4uanMnKVxuXHRzY3JpcHQoc3JjPScvdmVuZG9yL2Jvb3RzdHJhcC5taW4uanMnKVxuXHRzY3JpcHQoc3JjPScvanMvdmlld3Mvc2V0dGluZ3MuanMnKVxuYDtcbiAgcmV0dXJuIHJlcztcbn1cblxuXG5cbmltcG9ydCB7IGV4ZWMgfSBmcm9tICdjaGlsZF9wcm9jZXNzJztcblxuXG5mdW5jdGlvbiBleGVjQ21kKGNtZDogc3RyaW5nKSB7XG4gIGV4ZWMoY21kLCBmdW5jdGlvbiAoZXJyb3IsIHN0ZG91dCwgc3RkZXJyKSB7XG4gICAgaWYgKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKGBleGVjIGVycm9yOiAke2Vycm9yfWApXG4gICAgICByZXR1cm5cbiAgICB9XG4gICAgY29uc29sZS5sb2coYHN0ZG91dDogJHtzdGRvdXR9YClcbiAgICBjb25zb2xlLmxvZyhgc3RkZXJyOiAke3N0ZGVycn1gKVxuICB9KVxufTtcblxuZXhwb3J0IGZ1bmN0aW9uIHZpc01vZGVscyhtOiBJTWF0Y2guSU1vZGVscywgZm9sZGVyT3V0OiBzdHJpbmcpIHtcbiAgbS5kb21haW5zLmZvckVhY2goZnVuY3Rpb24gKHNEb21haW4pIHtcbiAgICB2YXIgcyA9IGdyYXBoRG9tYWluKHNEb21haW4sIG0pO1xuICAgIHZhciBmbkdyYXBoID0gZm9sZGVyT3V0ICsgXCIvXCIgKyBzRG9tYWluLnJlcGxhY2UoLyAvZywgJ18nKSArIFwiLmd2XCI7XG4gICAgZnMud3JpdGVGaWxlU3luYyhmbkdyYXBoLCBzKTtcbiAgICBpZiAocHJvY2Vzcy5lbnYuR1JBUEhWSVopIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiaGVyZSB0aGUgZmlsZSBcIiArIGZuR3JhcGgpO1xuICAgICAgZXhlY0NtZChwcm9jZXNzLmVudi5HUkFQSFZJWiArIFwiIC1UanBlZyAtTyBcIiArIGZuR3JhcGgpO1xuICAgIH1cbiAgfSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB0YWJNb2RlbHMobTogSU1hdGNoLklNb2RlbHMsIGZvbGRlck91dDogc3RyaW5nKSB7XG4gIG0uZG9tYWlucy5mb3JFYWNoKGZ1bmN0aW9uIChzRG9tYWluKSB7XG4gICAgdmFyIHMgPSB0YWJEb21haW4oc0RvbWFpbiwgbSk7XG4gICAgdmFyIGZuR3JhcGggPSBmb2xkZXJPdXQgKyBcIi9cIiArIHNEb21haW4ucmVwbGFjZSgvIC9nLCAnXycpICsgXCIuamFkZVwiO1xuICAgIGRlYnVnbG9nKFwiaGVyZSB0aGUgZmlsZSBcIiArIGZuR3JhcGgpO1xuICAgIGZzLndyaXRlRmlsZVN5bmMoZm5HcmFwaCwgcyk7XG4gIH0pO1xufVxuIiwiLyoqXG4gKiB2aXN1YWxpemUgYSBtb2RlbCBhbmQgY2FsY3VsYXRlIHNvbWUgc3RhdGlzdGljc1xuICovXG5cInVzZSBzdHJpY3RcIjtcbnZhciBmcyA9IHJlcXVpcmUoXCJmc1wiKTtcbnZhciBNb2RlbCA9IHJlcXVpcmUoXCIuL21vZGVsXCIpO1xudmFyIFV0aWwgPSByZXF1aXJlKFwiLi4vdXRpbHMvdXRpbHNcIik7XG52YXIgRGVzY3JpYmUgPSByZXF1aXJlKFwiLi4vbWF0Y2gvZGVzY3JpYmVcIik7XG52YXIgXyA9IHJlcXVpcmUoXCJsb2Rhc2hcIik7XG52YXIgZGVidWcgPSByZXF1aXJlKFwiZGVidWdcIik7XG4vL2ltcG9ydCAqIGFzIGVsYXN0aWNsdW5yIGZyb20gJ2VsYXN0aWNsdW5yJztcbnZhciBkZWJ1Z2xvZyA9IGRlYnVnKCd2aXNtb2RlbC50cycpO1xuO1xudmFyIGVsYXN0aWNsdW5yID0gcmVxdWlyZSgnZWxhc3RpY2x1bnInKTtcbmZ1bmN0aW9uIEpTT05Fc2NhcGUocykge1xuICAgIHJldHVybiBzLnJlcGxhY2UoL1xcXFwvZywgXCJcXFxcXFxcXFwiKS5yZXBsYWNlKC9cXG4vZywgXCJcXFxcblwiKVxuICAgICAgICAucmVwbGFjZSgvXFwnL2csIFwiXFxcXCdcIilcbiAgICAgICAgLnJlcGxhY2UoL1xcXCIvZywgJ1xcXFxcIicpXG4gICAgICAgIC5yZXBsYWNlKC9cXCYvZywgXCJcXFxcJlwiKVxuICAgICAgICAucmVwbGFjZSgvXFxyL2csIFwiXFxcXHJcIilcbiAgICAgICAgLnJlcGxhY2UoL1xcdC9nLCBcIlxcXFx0XCIpO1xuICAgIC8vIC5yZXBsYWNlKC9cXGIvZywgXCJcXFxcYlwiKVxuICAgIC8vIC5yZXBsYWNlKC9cXGYvZywgXCJcXFxcZlwiKTtcbn1cbmV4cG9ydHMuSlNPTkVzY2FwZSA9IEpTT05Fc2NhcGU7XG47XG5mdW5jdGlvbiBtYWtlTHVuckluZGV4KG1vZGVscGF0aCwgb3V0cHV0LCBzaWxlbnQpIHtcbiAgICB2YXIgbWRsID0gSlNPTi5wYXJzZSgnJyArIGZzLnJlYWRGaWxlU3luYyhtb2RlbHBhdGggKyAnLm1vZGVsLmpzb24nKSk7XG4gICAgdmFyIGRhdGEgPSBKU09OLnBhcnNlKCcnICsgZnMucmVhZEZpbGVTeW5jKG1vZGVscGF0aCArICcuZGF0YS5qc29uJykpO1xuICAgIHZhciBjYXRzID0gbWRsLmNhdGVnb3J5LmZpbHRlcihmdW5jdGlvbiAoYSkgeyByZXR1cm4gdHlwZW9mIGEgIT09ICdzdHJpbmcnOyB9KTtcbiAgICB2YXIgcWJlRGF0YU9iamVjdHMgPSBjYXRzLmZpbHRlcihmdW5jdGlvbiAoY2F0KSB7IHJldHVybiAoY2F0LlFCRSB8fCBjYXQuUUJFSW5jbHVkZSk7IH0pO1xuICAgIC8vY29uc29sZS5sb2coXCJoZXJlIGNhdHNcIiArIEpTT04uc3RyaW5naWZ5KGNhdHMpKTtcbiAgICAvL2NvbnNvbGUubG9nKFwiXFxuaGVyZSBkYXRhIG9iamVjdHNcIiArIEpTT04uc3RyaW5naWZ5KHFiZURhdGFPYmplY3RzKSk7XG4gICAgdmFyIHFiZURhdGFOYW1lcyA9IHFiZURhdGFPYmplY3RzLm1hcChmdW5jdGlvbiAoY2F0KSB7IHJldHVybiBjYXQubmFtZTsgfSk7XG4gICAgcWJlRGF0YU5hbWVzID0gXy51bmlvbihxYmVEYXRhTmFtZXMsIG1kbC5jb2x1bW5zKTtcbiAgICB2YXIgTFVOUkluZGV4ID0gY2F0cy5maWx0ZXIoZnVuY3Rpb24gKGNhdCkgeyByZXR1cm4gY2F0LkxVTlJJbmRleDsgfSkubWFwKGZ1bmN0aW9uIChjYXQpIHsgcmV0dXJuIGNhdC5uYW1lOyB9KTtcbiAgICAvL3ZhciBlbGFzdGljbHVuciA9IHJlcXVpcmUoJ2x1bnInKTtcbiAgICB2YXIgYm9tZGF0YSA9IGRhdGE7XG4gICAgLy8gaW5kZXggYWxsIExVTlIgcHJvcGVydGllc1xuICAgIHZhciBpbmRleCA9IGVsYXN0aWNsdW5yKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHRoYXQgPSB0aGlzO1xuICAgICAgICBMVU5SSW5kZXggLypcbiAgICAgICAgICAgICAgICBbXCJhcHBJZFwiLFxuICAgICAgICAgICAgICAgIFwiQXBwS2V5XCIsXG4gICAgICAgICAgICAgICAgXCJBcHBOYW1lXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiQXBwbGljYXRpb25Db21wb25lbnRcIixcbiAgICAgICAgICAgICAgICAgICAgXCJSb2xlTmFtZVwiLFxuICAgICAgICAgICAgICAgICAgICBcIkFwcGxpY2F0aW9uVHlwZVwiLFxuICAgICAgICAgICAgICAgICAgICBcIkJTUE5hbWVcIixcbiAgICAgICAgICAgICAgICAgICAgXCJCU1BBcHBsaWNhdGlvblVSTFwiLFxuICAgICAgICAgICAgICAgICAgICBcInJlbGVhc2VOYW1lXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiQnVzaW5lc3NDYXRhbG9nXCIsXG4gICAgICAgICAgICAgICAgICAgIFwiVGVjaG5pY2FsQ2F0YWxvZ1wiXSAqL1xuICAgICAgICAgICAgLmZvckVhY2goZnVuY3Rpb24gKGZpZWxkKSB7XG4gICAgICAgICAgICB0aGF0LmFkZEZpZWxkKGZpZWxkKTtcbiAgICAgICAgfSk7XG4gICAgICAgIHRoaXMuc2V0UmVmKCdpZCcpO1xuICAgICAgICB0aGlzLnNhdmVEb2N1bWVudChmYWxzZSk7XG4gICAgfSk7XG4gICAgYm9tZGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChvLCBpbmRleCkge1xuICAgICAgICBvLmlkID0gaW5kZXg7XG4gICAgfSk7XG4gICAgYm9tZGF0YS5mb3JFYWNoKGZ1bmN0aW9uIChyZWNvcmQpIHtcbiAgICAgICAgaW5kZXguYWRkRG9jKHJlY29yZCk7XG4gICAgfSk7XG4gICAgdmFyIGVsYXN0aWMgPSBpbmRleDtcbiAgICAvLyBkdW1wIHRoZSBsdW5yIGluZGV4XG4gICAgLy9cbiAgICB2YXIgdGhlSW5kZXggPSBpbmRleC50b0pTT04oKTtcbiAgICB2YXIgY29sdW1ucyA9IG1kbC5jb2x1bW5zLm1hcChmdW5jdGlvbiAoY29sbmFtZSkge1xuICAgICAgICB2YXIgcmVzID0gY2F0cy5maWx0ZXIoZnVuY3Rpb24gKGNhdCkgeyByZXR1cm4gY2F0Lm5hbWUgPT09IGNvbG5hbWU7IH0pO1xuICAgICAgICBpZiAocmVzLmxlbmd0aCAhPT0gMSkge1xuICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwidW5kZWZpbmVkIG9yIG5vbi1vYmplY3QgY29sdW1uIDogXCIgKyBjb2xuYW1lKTtcbiAgICAgICAgfVxuICAgICAgICA7XG4gICAgICAgIHJldHVybiByZXNbMF07XG4gICAgfSk7XG4gICAgdmFyIGNvbHVtbk5hbWVzID0gY29sdW1ucy5tYXAoZnVuY3Rpb24gKGNvbCkgeyByZXR1cm4gY29sLm5hbWU7IH0pO1xuICAgIHZhciBqc29ucCA9IFwidmFyIG1kbGRhdGEgPSB7fTtcXG4vL2NvbHVtbnMgXFxuIG1kbGRhdGEuY29sdW1ucyA9IFtcXFwiXCIgKyBjb2x1bW5zLm1hcChmdW5jdGlvbiAoY29sKSB7IHJldHVybiBjb2wubmFtZTsgfSkuam9pbignXCIsXCInKSArIFwiXFxcIl07XCI7XG4gICAgdmFyIGpzb24gPSBcInsgXFxcImNvbHVtbnNcXFwiICA6IFtcXFwiXCIgKyBjb2x1bW5zLm1hcChmdW5jdGlvbiAoY29sKSB7IHJldHVybiBKU09ORXNjYXBlKGNvbC5uYW1lKTsgfSkuam9pbignXCIsXCInKSArIFwiXFxcIl0sXCI7XG4gICAgLy8ganNvbnAgKz0gYFxcbiBtZGxkYXRhLmZ1bGxkYXRhID0gJHtKU09OLnN0cmluZ2lmeShib21kYXRhKX07XFxuYDtcbiAgICAvL2pzb25wICs9IGBcXG4vL2NvbHVtbnMgaW5mbyBcXG4gbWRsZGF0YS5sdW5yY29sdW1ucyA9IFtcInske0xVTlJJbmRleC5qb2luKCdcIixcIicpfVwiXTtgO1xuICAgIGpzb25wICs9IFwiXFxuLy9jb2x1bW5zIGluZm8gXFxuIG1kbGRhdGEuY29sdW1uc0Rlc2NyaXB0aW9uID0ge1wiICsgY29sdW1ucy5tYXAoZnVuY3Rpb24gKGNvbCkge1xuICAgICAgICByZXR1cm4gXCIgXFxuIFxcXCJcIiArIGNvbC5uYW1lICsgXCJcXFwiIDogIFxcXCJcIiArIEpTT05Fc2NhcGUoY29sLmRlc2NyaXB0aW9uIHx8IGNvbC5uYW1lKSArIFwiXFxcIiBcIjtcbiAgICB9KS5qb2luKCcsJykgKyBcIlxcbiAgICAgIH07XCI7XG4gICAganNvbiArPSBcIlxcXCJjb2x1bW5zRGVzY3JpcHRpb25cXFwiIDoge1wiICsgY29sdW1ucy5tYXAoZnVuY3Rpb24gKGNvbCkge1xuICAgICAgICByZXR1cm4gXCIgXFxuIFxcXCJcIiArIGNvbC5uYW1lICsgXCJcXFwiIDogIFxcXCJcIiArIEpTT05Fc2NhcGUoY29sLmRlc2NyaXB0aW9uIHx8IGNvbC5uYW1lKSArIFwiXFxcIiBcIjtcbiAgICB9KS5qb2luKCcsJykgKyBcIlxcbiAgICAgIH0sXCI7XG4gICAganNvbnAgKz0gXCJcXG4vL2NvbHVtbnMgaW5mbyBcXG4gbWRsZGF0YS5jb2x1bW5zRGVmYXVsdFdpZHRoID0ge1wiICsgY29sdW1ucy5tYXAoZnVuY3Rpb24gKGNvbCkge1xuICAgICAgICByZXR1cm4gXCIgXFxuIFxcXCJcIiArIGNvbC5uYW1lICsgXCJcXFwiIDogXCIgKyAoY29sLmRlZmF1bHRXaWR0aCB8fCAxNTApICsgXCIgXCI7XG4gICAgfSkuam9pbignLCcpICsgXCJcXG4gICAgICB9O1wiO1xuICAgIGpzb24gKz0gXCJcXG5cXFwiY29sdW1uc0RlZmF1bHRXaWR0aFxcXCIgOiB7XCIgKyBjb2x1bW5zLm1hcChmdW5jdGlvbiAoY29sKSB7XG4gICAgICAgIHJldHVybiBcIiBcXG4gXFxcIlwiICsgY29sLm5hbWUgKyBcIlxcXCIgOiBcIiArIChjb2wuZGVmYXVsdFdpZHRoIHx8IDE1MCkgKyBcIiBcIjtcbiAgICB9KS5qb2luKCcsJykgKyBcIlxcbiAgICAgIH0sXCI7XG4gICAgdmFyIHRoZUluZGV4U3RyID0gSlNPTi5zdHJpbmdpZnkodGhlSW5kZXgpO1xuICAgIGpzb25wICs9IFwiXFxudmFyIHNlckluZGV4ID1cXFwiXCIgKyBKU09ORXNjYXBlKHRoZUluZGV4U3RyKSArIFwiXFxcIjtcXG5cIjtcbiAgICAvLyBqc29ucCArPSBcIlxcbnZhciBzZXJJbmRleCA9XCIgKyBKU09OLnN0cmluZ2lmeSh0aGVJbmRleCkgKyBcIjtcXG5cIjtcbiAgICBqc29uICs9ICdcXG5cInNlckluZGV4XCIgOicgKyB0aGVJbmRleFN0ciArICcsJztcbiAgICAvL2NvbnNvbGUubG9nKFwiaGVyZSBhbGwgbmFtZXMgXCIgKyBKU09OLnN0cmluZ2lmeShxYmVEYXRhTmFtZXMpKTtcbiAgICB2YXIgY2xlYW5zZWRkYXRhID0gYm9tZGF0YS5tYXAoZnVuY3Rpb24gKG8pIHtcbiAgICAgICAgdmFyIHJlcyA9IHt9O1xuICAgICAgICBxYmVEYXRhTmFtZXMuZm9yRWFjaChmdW5jdGlvbiAoa2V5KSB7XG4gICAgICAgICAgICByZXNba2V5XSA9IG9ba2V5XTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiByZXM7XG4gICAgfSk7XG4gICAgaWYgKCFzaWxlbnQpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJkdW1waW5nIFwiICsgb3V0cHV0KTtcbiAgICAgICAgY29uc29sZS5sb2coXCJsZW5ndGggb2YgaW5kZXggc3RyXCIgKyB0aGVJbmRleFN0ci5sZW5ndGgpO1xuICAgICAgICBjb25zb2xlLmxvZyhcImF2YWlsYWJsZSAgICAgICAgICBcIiArIGNvbHVtbnMubGVuZ3RoICsgXCIgY29sdW1uc1wiKTtcbiAgICAgICAgY29uc29sZS5sb2coXCJyZXR1cm5pbmcgYXMgZGF0YSAgXCIgKyBxYmVEYXRhTmFtZXMubGVuZ3RoICsgXCIgY29sdW1uc1wiKTtcbiAgICAgICAgY29uc29sZS5sb2coXCJpbmRleGluZyAgICAgICAgICAgXCIgKyBMVU5SSW5kZXgubGVuZ3RoICsgXCIgY29sdW1uc1wiKTtcbiAgICAgICAgY29uc29sZS5sb2coJ3JldHVybmVkIGJ1dCBub3QgYXZhaWxhYmxlJywgXy5kaWZmZXJlbmNlKHFiZURhdGFOYW1lcywgY29sdW1uTmFtZXMpLmpvaW4oXCIsIFwiKSk7XG4gICAgICAgIGNvbnNvbGUubG9nKCdyZXR1cm5lZCBidXQgbm90IGluZGV4ZWQnLCBfLmRpZmZlcmVuY2UocWJlRGF0YU5hbWVzLCBMVU5SSW5kZXgpLmpvaW4oXCIsIFwiKSk7XG4gICAgfVxuICAgIGpzb25wICs9IFwidmFyIGRhdGE9XCIgKyBKU09OLnN0cmluZ2lmeShjbGVhbnNlZGRhdGEpICsgXCI7XCI7XG4gICAganNvbiArPSAnXCJkYXRhXCI6JyArIEpTT04uc3RyaW5naWZ5KGNsZWFuc2VkZGF0YSkgKyBcIlxcbn1cIjtcbiAgICBqc29ucCArPSBcIlxcblxcbiAgICAgICAgICAgLy8gdmFyIGVsYXN0aWMgPSBlbGFzdGljbHVuci5JbmRleC5sb2FkKHNlckluZGV4KTtcXG5cXG4gIFwiO1xuICAgIC8vZnMud3JpdGVGaWxlU3luYyhvdXRwdXQgKyBcIi5sdW5yLmpzXCIsIGpzb25wKTtcbiAgICBmcy53cml0ZUZpbGVTeW5jKG91dHB1dCArIFwiLmx1bnIuanNvblwiLCBqc29uKTtcbn1cbmV4cG9ydHMubWFrZUx1bnJJbmRleCA9IG1ha2VMdW5ySW5kZXg7XG4vKlxuXG4gIHZhciBpbmRleCA9IGVsYXN0aWx1bnIuSW5kZXgubG9hZChvYmopO1xuXG5cbn1cblxuIFwiUUJFXCIgOiBmYWxzZSxcbiAgICAgIFwiUUJFSW5jbHVkZVwiIDogdHJ1ZSxcbiAgICAgIFwiTFVOUkluZGV4XCI6IGZhbHNlXG4qL1xuZnVuY3Rpb24gY2FsY0NhdGVnb3J5UmVjb3JkKG0sIGNhdGVnb3J5LCBkb21haW4pIHtcbiAgICB2YXIgb3RoZXJkb21haW5zID0gTW9kZWwuZ2V0RG9tYWluc0ZvckNhdGVnb3J5KG0sIGNhdGVnb3J5KTtcbiAgICBfLnB1bGwob3RoZXJkb21haW5zLCBkb21haW4pO1xuICAgIHZhciByZXMgPSB7XG4gICAgICAgIG90aGVyZG9tYWluczogb3RoZXJkb21haW5zLFxuICAgICAgICBuckRpc3RpbmN0VmFsdWVzOiAwLFxuICAgICAgICBuckRpc3RpbmN0VmFsdWVzSW5Eb21haW46IDAsXG4gICAgICAgIG5yUmVjb3JkczogMCxcbiAgICAgICAgbnJSZWNvcmRzSW5Eb21haW46IDAsXG4gICAgICAgIG5yVG90YWxSZWNvcmRzSW5Eb21haW46IDAsXG4gICAgfTtcbiAgICB2YXIgdmFsdWVzID0gW107XG4gICAgdmFyIHZhbHVlc0luRG9tYWluID0gW107XG4gICAgdmFyIG5yUmVjb3Jkc0luRG9tYWluID0gMDtcbiAgICB2YXIgZGlzdGluY3RWYWx1ZXMgPSBtLnJlY29yZHMuZm9yRWFjaChmdW5jdGlvbiAob0VudHJ5KSB7XG4gICAgICAgIGlmIChvRW50cnkuX2RvbWFpbiA9PT0gZG9tYWluKSB7XG4gICAgICAgICAgICByZXMubnJUb3RhbFJlY29yZHNJbkRvbWFpbiArPSAxO1xuICAgICAgICB9XG4gICAgICAgIGlmIChvRW50cnlbY2F0ZWdvcnldKSB7XG4gICAgICAgICAgICB2YXIgdmFsdWUgPSBvRW50cnlbY2F0ZWdvcnldO1xuICAgICAgICAgICAgaWYgKG9FbnRyeS5fZG9tYWluID09PSBkb21haW4pIHtcbiAgICAgICAgICAgICAgICB2YWx1ZXNJbkRvbWFpblt2YWx1ZV0gPSAodmFsdWVzSW5Eb21haW5bdmFsdWVdIHx8IDApICsgMTtcbiAgICAgICAgICAgICAgICByZXMubnJSZWNvcmRzSW5Eb21haW4gKz0gMTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhbHVlc1t2YWx1ZV0gPSAodmFsdWVzW3ZhbHVlXSB8fCAwKSArIDE7XG4gICAgICAgICAgICByZXMubnJSZWNvcmRzICs9IDE7XG4gICAgICAgIH1cbiAgICB9KTtcbiAgICByZXMubnJEaXN0aW5jdFZhbHVlcyA9IE9iamVjdC5rZXlzKHZhbHVlcykubGVuZ3RoO1xuICAgIHJlcy5uckRpc3RpbmN0VmFsdWVzSW5Eb21haW4gPSBPYmplY3Qua2V5cyh2YWx1ZXNJbkRvbWFpbikubGVuZ3RoO1xuICAgIHJldHVybiByZXM7XG59XG5leHBvcnRzLmNhbGNDYXRlZ29yeVJlY29yZCA9IGNhbGNDYXRlZ29yeVJlY29yZDtcbmZ1bmN0aW9uIGdyYXBoRG9tYWluKGRvbWFpbiwgbSkge1xuICAgIC8vIGRyYXcgYSBtb2RlbCBkb21haW5zXG4gICAgdmFyIHJlcyA9IFwiXFxuICAgIGRpZ3JhcGggc2RzdSB7XFxuXFx0c2l6ZT1cXFwiMzYsMzZcXFwiO1xcbiAgIHJhbmtkaXI9TFJcXG5cXHRub2RlIFtjb2xvcj15ZWxsb3csIHN0eWxlPWZpbGxlZF07XFxuICAgIFxcXCJcIiArIGRvbWFpbiArIFwiXFxcIlxcbiAgXCI7XG4gICAgLy8gYWRkIGFsbCBjYXRlZ29yeSBub2Rlc1xuICAgIHJlcyArPSBcIm5vZGUgW3NoYXBlPXJlY29yZCwgY29sb3I9eWVsbG93LCBzdHlsZT1maWxsZWRdO1xcbiBcIjtcbiAgICB2YXIgY2F0cyA9IE1vZGVsLmdldENhdGVnb3JpZXNGb3JEb21haW4obSwgZG9tYWluKTtcbiAgICB2YXIgY2F0ZWdvcnlSZXN1bHRzID0ge307XG4gICAgdmFyIG90aGVyZG9tYWlucyA9IFtdO1xuICAgIGNhdHMuZm9yRWFjaChmdW5jdGlvbiAoY2F0KSB7XG4gICAgICAgIHZhciBjYXRSZXN1bHQgPSBjYWxjQ2F0ZWdvcnlSZWNvcmQobSwgY2F0LCBkb21haW4pO1xuICAgICAgICBjYXRlZ29yeVJlc3VsdHNbY2F0XSA9IGNhdFJlc3VsdDtcbiAgICAgICAgb3RoZXJkb21haW5zID0gXy51bmlvbihvdGhlcmRvbWFpbnMsIGNhdGVnb3J5UmVzdWx0c1tjYXRdLm90aGVyRG9tYWlucyk7XG4gICAgICAgIHJlcyArPSBcIlxcXCJcIiArIGNhdCArIFwiXFxcIiBbbGFiZWw9XFxcInsgXCIgKyBjYXQgKyBcIiB8IFwiICsgY2F0UmVzdWx0Lm5yRGlzdGluY3RWYWx1ZXNJbkRvbWFpbiArIFwiIFZhbHVlcyBpbiBcIiArIGNhdFJlc3VsdC5uclJlY29yZHNJbkRvbWFpbiArIFwiIFwiO1xuICAgICAgICBpZiAoY2F0UmVzdWx0Lm5yUmVjb3Jkc0luRG9tYWluICE9PSBjYXRSZXN1bHQubnJSZWNvcmRzKSB7XG4gICAgICAgICAgICByZXMgKz0gXCJ8ICBcIiArIChjYXRSZXN1bHQubnJEaXN0aW5jdFZhbHVlcyAtIGNhdFJlc3VsdC5uckRpc3RpbmN0VmFsdWVzSW5Eb21haW4pICsgXCIgb3RoZXIgdmFsdWVzIGluIFwiICsgKGNhdFJlc3VsdC5uclJlY29yZHMgLSBjYXRSZXN1bHQubnJSZWNvcmRzSW5Eb21haW4pICsgXCIgb3RoZXIgcmVjb3Jkc1wiO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgcmVzICs9IFwiIFwiO1xuICAgICAgICB9XG4gICAgICAgIHJlcyArPSBcIn1cXFwiXVxcblwiO1xuICAgIH0pO1xuICAgIC8vIGNhbGN1bGF0ZSBvdGhlciBkb21haW5zLlxuICAgIC8vIGRyYXcgXCJvdGhlciBjYXRlZ29yaWVzXCJcbiAgICByZXMgKz0gXCJub2RlIFtjb2xvcj1wdXJwbGUsIHN0eWxlPWZpbGxlZF07IFxcblwiO1xuICAgIG90aGVyZG9tYWlucy5mb3JFYWNoKGZ1bmN0aW9uIChvdGhlcmRvbWFpbikge1xuICAgICAgICByZXMgKz0gXCJcXFwiXCIgKyBvdGhlcmRvbWFpbiArIFwiXFxcIiBcXG5cIjtcbiAgICB9KTtcbiAgICAvLyBjb3VudCByZWNvcmRzIGluIGRvbWFpbiA6XG4gICAgdmFyIG5yUmVjb3JkcyA9IG0ucmVjb3Jkcy5yZWR1Y2UoZnVuY3Rpb24gKHByZXYsIGVudHJ5KSB7XG4gICAgICAgIHJldHVybiBwcmV2ICsgKChlbnRyeS5fZG9tYWluID09PSBkb21haW4pID8gMSA6IDApO1xuICAgIH0sIDApO1xuICAgIHJlcyArPSBcIm5vZGUgW3NoYXBlPXJlY29yZF07IFxcblwiO1xuICAgIHJlcyArPSBcIiBcXFwicmVjb3JkXFxcIiBbbGFiZWw9XFxcIns8ZjA+IFwiICsgZG9tYWluICsgXCIgfCBcIiArIG5yUmVjb3JkcyArIFwifVxcXCJdIFxcblwiO1xuICAgIHJlcyArPSBcIiBcXFwicl9vdGhlclxcXCIgW2xhYmVsPVxcXCJ7PGYwPiBvdGhlciB8IFwiICsgbnJSZWNvcmRzICsgXCJ9XFxcIl0gXFxuIFwiO1xuICAgIHJlcyArPSBcIiMgcmVsYXRpb24gZnJvbSBjYXRlZ29yaWVzIHRvIGRvbWFpblxcblwiO1xuICAgIGNhdHMuZm9yRWFjaChmdW5jdGlvbiAoY2F0KSB7XG4gICAgICAgIHJlcyArPSBcIiBcXFwiXCIgKyBjYXQgKyBcIlxcXCIgLT4gXFxcIlwiICsgZG9tYWluICsgXCJcXFwiIFxcblwiO1xuICAgIH0pO1xuICAgIHJlcyArPSBcIiMgcmVsYXRpb24gZnJvbSBjYXRlZ29yaWVzIHRvIHJlY29yZHNcXG5cIjtcbiAgICBjYXRzLmZvckVhY2goZnVuY3Rpb24gKGNhdCkge1xuICAgICAgICB2YXIgcmVjID0gY2F0ZWdvcnlSZXN1bHRzW2NhdF07XG4gICAgICAgIHJlcyArPSBcIiBcXFwiXCIgKyBjYXQgKyBcIlxcXCIgLT4gXFxcInJlY29yZFxcXCIgXFxuXCI7XG4gICAgfSk7XG4gICAgLy9vdGhlciBkb21haW5zIHRvIHRoaXNcbiAgICBjYXRzLmZvckVhY2goZnVuY3Rpb24gKGNhdCkge1xuICAgIH0pO1xuICAgIC8qXG4gICAgY2F0cyBmb1xuICAgICAgZGlncmFwaCBzZHN1IHtcbiAgICAgIHNpemU9XCIzNiwzNlwiO1xuICAgICAgbm9kZSBbY29sb3I9eWVsbG93LCBzdHlsZT1maWxsZWRdO1xuICAgICAgRkxQRCBGTFAgXCJCT00gRWRpdG9yXCIsIFwiV0lLSVVSTFwiIFwiVUk1IERvY3VtZW50YXRpb25cIiwgXCJVSTUgRXhhbXBsZVwiLCBcIlNUQVJUVEFcIlxuICAgICAgQkNQXG4gICAgICBub2RlIFtjb2xvcj1ncmV5LCBzdHlsZT1maWxsZWRdO1xuICAgICAgbm9kZSBbZm9udG5hbWU9XCJWZXJkYW5hXCIsIHNpemU9XCIzMCwzMFwiXTtcbiAgICAgIG5vZGUgW2NvbG9yPWdyZXksIHN0eWxlPWZpbGxlZF07XG4gICAgICBncmFwaCBbIGZvbnRuYW1lID0gXCJBcmlhbFwiLFxuICAgICovXG4gICAgcmVzICs9IFwifVxcblwiO1xuICAgIHJldHVybiByZXM7XG59XG5leHBvcnRzLmdyYXBoRG9tYWluID0gZ3JhcGhEb21haW47XG4vKlxuICAgIGNhdGVnb3J5RGVzYyA6IHRoZU1vZGVsLmZ1bGwuZG9tYWluW2ZpbHRlcmRvbWFpbl0uY2F0ZWdvcmllc1tjYXRlZ29yeV0sXG4gICAgZGlzdGluY3QgOiBkaXN0aW5jdCxcbiAgICBkZWx0YSA6IGRlbHRhLFxuICAgIHByZXNlbnRSZWNvcmRzIDogcmVjb3JkQ291bnQucHJlc2VudHJlY29yZHMsXG4gICAgcGVyY1ByZXNlbnQgOiBwZXJjZW50LFxuICAgIHNhbXBsZVZhbHVlcyA6IHZhbHVlc0xpc3RcbiAgfVxuKi9cbmZ1bmN0aW9uIHJlcGxhY2VCcihzdHJpbmcpIHtcbiAgICBzdHJpbmcgPSBzdHJpbmcucmVwbGFjZSgvXFxuL2csIFwiXFxuXFx0XFx0XFx0XFx0XFx0XFx0XFx0XFx0XFx0XFx0XFx0YnJcXG5cXHRcXHRcXHRcXHRcXHRcXHRcXHRcXHRcXHRcXHRcXHR8IFwiKTtcbiAgICByZXR1cm4gc3RyaW5nO1xufVxuLyoqXG4gKiBnZW5lcmF0ZSBhIHRleHR1YWwgcmVwcmVzZW50YXRpb24gb2YgYSBkb21haW5cbiAqL1xuZnVuY3Rpb24gdGFiRG9tYWluKGRvbWFpbiwgbSkge1xuICAgIC8vIGRyYXcgYSBtb2RlbCBkb21haW5zXG4gICAgdmFyIGNhdHMgPSBNb2RlbC5nZXRDYXRlZ29yaWVzRm9yRG9tYWluKG0sIGRvbWFpbik7XG4gICAgY2F0cyA9IE1vZGVsLnNvcnRDYXRlZ29yaWVzQnlJbXBvcnRhbmNlKG0uZnVsbC5kb21haW5bZG9tYWluXS5jYXRlZ29yaWVzIHx8IHt9LCBjYXRzKTtcbiAgICAvL2NvbnNvbGUubG9nKGNhdHMuam9pbihcIlxcblwiKSk7XG4gICAgdmFyIGNhdGRlc2MgPSBEZXNjcmliZS5nZXRDYXRlZ29yeVN0YXRzSW5Eb21haW4oY2F0c1swXSwgZG9tYWluLCBtKTtcbiAgICB2YXIgY2F0UmVzdWx0ID0gY2FsY0NhdGVnb3J5UmVjb3JkKG0sIGNhdHNbMF0sIGRvbWFpbik7XG4gICAgdmFyIGRvbWFpbkRlc2NyID0gbS5mdWxsLmRvbWFpbltkb21haW5dLmRlc2NyaXB0aW9uIHx8IFwiXCI7XG4gICAgZG9tYWluRGVzY3IgPSByZXBsYWNlQnIoZG9tYWluRGVzY3IpO1xuICAgIHZhciByZXMgPSBcIlxcblxcbi8vIHByZXNldCBmb3JtIHZhbHVlcyBpZiB3ZSByZWNlaXZlIGEgdXNlcmRhdGEgb2JqZWN0IC8vXFxuLSB1c2VyID0gdXNlclxcblxcbmV4dGVuZHMgLi4vbGF5b3V0X3BcXG5cXG5ibG9jayBjb250ZW50XFxuXFxuXFx0bmF2Lm5hdmJhci5uYXZiYXItZGVmYXVsdC5uYXZiYXItZml4ZWQtdG9wXFxuXFx0XFx0LmNvbnRhaW5lclxcblxcdFxcdFxcdC5uYXZiYXItaGVhZGVyXFxuXFx0XFx0XFx0XFx0Lm5hdmJhci1icmFuZChzdHlsZT0nYmdjb2xvcjpvcmFuZ2U7Y29sb3I6ZGFya2JsdWU7Zm9udC1mYW1pbHk6QXJpYWwgQmxhY2s7Zm9udC1zaXplOjE1LjExOHB4Jykgd29zYXAgZG9tYWluIFwiICsgZG9tYWluICsgXCJcXG5cXHRcXHRcXHR1bC5uYXYubmF2YmFyLW5hdi5uYXZiYXItcmlnaHQgI3t1aWR9XFxuXFx0XFx0XFx0XFx0bGlcXG5cXHRcXHRcXHRcXHRcXHQubmF2YmFyLWJ0biNidG4tbG9nb3V0LmJ0bi5idG4tZGVmYXVsdChvbmNsaWNrPVxcXCJsb2NhdGlvbi5ocmVmPScvaG9tZSdcXFwiKVxcblxcdFxcdFxcdFxcdFxcdFxcdHwgYmFjayB0byBob21lXFxuXFxuXFx0cCAgJm5ic3A7XFxuXFx0cCAmbmJzcDtcXG5cXHRwXFxuXFxuXFx0ZGl2LndlbGxcXG5cXHRcXHRoMyBkb21haW4gXFxcIlwiICsgZG9tYWluICsgXCJcXFwiXFxuXFx0XFx0XFx0c3Bhbi5wdWxsLXJpZ2h0IFwiICsgY2F0UmVzdWx0Lm5yVG90YWxSZWNvcmRzSW5Eb21haW4gKyBcIiByZWNvcmRzXFxuXFx0XFx0cFxcblxcdFxcdHNwYW4gXCIgKyBkb21haW5EZXNjciArIFwiXFxuXFxuXFx0XFx0dGFibGUudGFibGUudGFibGUtY29uZGVuc2VkLnRhYmxlLXN0cmlwZWRcXG5cXHRcXHRcXHR0aGVhZFxcblxcdFxcdFxcdFxcdHRyXFxuXFx0XFx0XFx0XFx0XFx0dGggY2F0ZWdvcnlcXG5cXHRcXHRcXHRcXHRcXHR0aChzdHlsZT1cXFwid2lkdGg6MTAlXFxcIikgY291bnRcXG5cXHRcXHRcXHRcXHRcXHR0aFxcblxcdFxcdFxcdFxcdFxcdFxcdHRhYmxlXFxuXFx0XFx0XFx0XFx0XFx0XFx0XFx0dHJcXG5cXHRcXHRcXHRcXHRcXHRcXHRcXHRcXHR0ZCBzeW5vbnltc1xcblxcdFxcdFxcdFxcdFxcdFxcdFxcdHRyXFxuXFx0XFx0XFx0XFx0XFx0XFx0XFx0XFx0dGQgZGVzY3JpcHRpb25cXG5cXHRcXHRcXHRcXHRcXHRcXHRcXHR0clxcblxcdFxcdFxcdFxcdFxcdFxcdFxcdFxcdHRkIGV4YW1wbGUgdmFsdWVzXFxuXFx0XFx0XFx0dGJvZHlcXG5cIjtcbiAgICB2YXIgY2F0ZWdvcnlSZXN1bHRzID0ge307XG4gICAgdmFyIG90aGVyZG9tYWlucyA9IFtdO1xuICAgIHZhciBjYXRlZ29yeU1hcCA9IG0uZnVsbC5kb21haW5bZG9tYWluXS5jYXRlZ29yaWVzIHx8IHt9O1xuICAgIGNhdHMuZm9yRWFjaChmdW5jdGlvbiAoY2F0KSB7XG4gICAgICAgIHZhciBjYXRkZXNjID0gRGVzY3JpYmUuZ2V0Q2F0ZWdvcnlTdGF0c0luRG9tYWluKGNhdCwgZG9tYWluLCBtKTtcbiAgICAgICAgLy9jb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeShjYXRkZXNjKSk7XG4gICAgICAgIHZhciBjYXRSZXN1bHQgPSBjYWxjQ2F0ZWdvcnlSZWNvcmQobSwgY2F0LCBkb21haW4pO1xuICAgICAgICBjYXRlZ29yeVJlc3VsdHNbY2F0XSA9IGNhdFJlc3VsdDtcbiAgICAgICAgb3RoZXJkb21haW5zID0gXy51bmlvbihvdGhlcmRvbWFpbnMsIGNhdGVnb3J5UmVzdWx0c1tjYXRdLm90aGVyRG9tYWlucyk7XG4gICAgICAgIC8qXG4gICAgICAgICAgICByZXMgKz0gYFwiJHtjYXR9XCIgW2xhYmVsPVwieyAke2NhdH0gfCAke2NhdFJlc3VsdC5uckRpc3RpbmN0VmFsdWVzSW5Eb21haW59IFZhbHVlcyBpbiAke2NhdFJlc3VsdC5uclJlY29yZHNJbkRvbWFpbn0gYDtcbiAgICAgICAgICAgIGlmKGNhdFJlc3VsdC5uclJlY29yZHNJbkRvbWFpbiAhPT0gY2F0UmVzdWx0Lm5yUmVjb3Jkcykge1xuICAgICAgICAgICAgICByZXMgKz0gIGB8ICAke2NhdFJlc3VsdC5uckRpc3RpbmN0VmFsdWVzIC0gY2F0UmVzdWx0Lm5yRGlzdGluY3RWYWx1ZXNJbkRvbWFpbn0gb3RoZXIgdmFsdWVzIGluICR7Y2F0UmVzdWx0Lm5yUmVjb3JkcyAtIGNhdFJlc3VsdC5uclJlY29yZHNJbkRvbWFpbn0gb3RoZXIgcmVjb3Jkc2A7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICByZXMgKz0gYCBgO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgcmVzICs9IGB9XCJdXFxuYDtcbiAgICAgICAgKi9cbiAgICAgICAgLy9jb25zb2xlLmxvZyhKU09OLnN0cmluZ2lmeShtLmZ1bGwuZG9tYWluW2RvbWFpbl0pKTtcbiAgICAgICAgaWYgKG0uZnVsbC5kb21haW5bZG9tYWluXS5jYXRlZ29yaWVzW2NhdF0pIHtcbiAgICAgICAgICAgIHZhciBzeW5vbnltc1N0cmluZyA9IFV0aWwubGlzdFRvQ29tbWFBbmQoY2F0ZGVzYy5jYXRlZ29yeURlc2MgJiYgY2F0ZGVzYy5jYXRlZ29yeURlc2Muc3lub255bXMgJiYgY2F0ZGVzYy5jYXRlZ29yeURlc2Muc3lub255bXMgfHwgW10pIHx8IFwiJm5ic3A7XCI7XG4gICAgICAgICAgICByZXMgKz0gXCJcXG5cXHRcXHRcXHR0clxcblxcdFxcdFxcdFxcdFxcdHRkLmNhdF9jb3VudCBcIiArIGNhdCArIFwiXFxuXFx0XFx0XFx0XFx0XFx0dGQgXCIgKyBjYXRkZXNjLnByZXNlbnRSZWNvcmRzICsgXCIgZGlzdGluY3QgdmFsdWVzIGluIFwiICsgY2F0ZGVzYy5wZXJjUHJlc2VudCArIFwiJSBvZiByZWNvcmRzXFxuXFx0XFx0XFx0XFx0XFx0dGRcXG5cXHRcXHRcXHRcXHRcXHRcXHR0YWJsZVxcblxcdFxcdFxcdFxcdFxcdFxcdFxcdHRyLmNhdF9zeW5vbnltc1xcblxcdFxcdFxcdFxcdFxcdFxcdFxcdFxcdHRkIFwiICsgc3lub255bXNTdHJpbmcgKyBcIlxcblxcdFxcdFxcdFxcdFxcdFxcdFxcdHRyLmNhdF9kZXNjcmlwdGlvblxcblxcdFxcdFxcdFxcdFxcdFxcdFxcdFxcdHRkIFwiICsgcmVwbGFjZUJyKGNhdGRlc2MuY2F0ZWdvcnlEZXNjICYmIGNhdGRlc2MuY2F0ZWdvcnlEZXNjLmRlc2NyaXB0aW9uIHx8IFwiXCIpICsgXCJcXG5cXHRcXHRcXHRcXHRcXHRcXHRcXHR0ci5jYXRfc2FtcGxldmFsdWVzXFxuXFx0XFx0XFx0XFx0XFx0XFx0XFx0XFx0dGQgXCIgKyByZXBsYWNlQnIoY2F0ZGVzYy5zYW1wbGVWYWx1ZXMpICsgXCJcXG4gICAgICBcIjtcbiAgICAgICAgfVxuICAgIH0pO1xuICAgIHZhciBvdGhlcmNhdHMgPSBjYXRzLmxlbmd0aCAtIE9iamVjdC5rZXlzKG0uZnVsbC5kb21haW5bZG9tYWluXS5jYXRlZ29yaWVzKS5sZW5ndGg7XG4gICAgdmFyIHJlbWFpbmluZ0NhdGVnb3JpZXMgPSBfLmRpZmZlcmVuY2UoY2F0cywgT2JqZWN0LmtleXMobS5mdWxsLmRvbWFpbltkb21haW5dLmNhdGVnb3JpZXMpKTtcbiAgICBpZiAoKG90aGVyY2F0cykgPiAwKSB7XG4gICAgICAgIHJlcyArPSBcIlxcblxcdFxcdHAgICBhbmQgXCIgKyBvdGhlcmNhdHMgKyBcIiBvdGhlciBjYXRlZ29yaWVzXFxuXFx0XFx0fCBcIiArIFV0aWwubGlzdFRvQ29tbWFBbmQocmVtYWluaW5nQ2F0ZWdvcmllcykgKyBcIlxcbiAgICAgICBcIjtcbiAgICB9XG4gICAgLypcbiAgICAgIC8vIGNhbGN1bGF0ZSBvdGhlciBkb21haW5zLlxuICAgICAgLy8gZHJhdyBcIm90aGVyIGNhdGVnb3JpZXNcIlxuICAgICAgcmVzICs9IGBub2RlIFtjb2xvcj1wdXJwbGUsIHN0eWxlPWZpbGxlZF07IFxcbmBcbiAgICAgIG90aGVyZG9tYWlucy5mb3JFYWNoKGZ1bmN0aW9uKG90aGVyZG9tYWluKSB7XG4gICAgICAgIHJlcyArPSBgXCIke290aGVyZG9tYWlufVwiIFxcbmA7XG4gICAgICB9KTtcbiAgICAgIC8vIGNvdW50IHJlY29yZHMgaW4gZG9tYWluIDpcbiAgICAgIHZhciBuclJlY29yZHMgPSBtLnJlY29yZHMucmVkdWNlKGZ1bmN0aW9uKHByZXYsZW50cnkpIHtcbiAgICAgIHJldHVybiBwcmV2ICsgKChlbnRyeS5fZG9tYWluID09PSBkb21haW4pID8gMSA6IDApO1xuICAgICAgfSwwKTtcbiAgICAgIHJlcyArPSBgbm9kZSBbc2hhcGU9cmVjb3JkXTsgXFxuYFxuICAgICAgcmVzICs9IGAgXCJyZWNvcmRcIiBbbGFiZWw9XCJ7PGYwPiAke2RvbWFpbn0gfCAke25yUmVjb3Jkc319XCJdIFxcbmA7XG4gIFxuICAgICAgcmVzICs9IGAgXCJyX290aGVyXCIgW2xhYmVsPVwiezxmMD4gb3RoZXIgfCAke25yUmVjb3Jkc319XCJdIFxcbiBgO1xuICBcbiAgICAgIHJlcyArPSBgIyByZWxhdGlvbiBmcm9tIGNhdGVnb3JpZXMgdG8gZG9tYWluXFxuYDtcbiAgICAgIGNhdHMuZm9yRWFjaChmdW5jdGlvbihjYXQpIHtcbiAgICAgICAgcmVzICs9IGAgXCIke2NhdH1cIiAtPiBcIiR7ZG9tYWlufVwiIFxcbmA7XG4gICAgICB9KVxuICBcbiAgXG4gICAgICByZXMgKz0gYCMgcmVsYXRpb24gZnJvbSBjYXRlZ29yaWVzIHRvIHJlY29yZHNcXG5gO1xuICAgICAgY2F0cy5mb3JFYWNoKGZ1bmN0aW9uKGNhdCkge1xuICAgICAgICB2YXIgcmVjID0gY2F0ZWdvcnlSZXN1bHRzW2NhdF07XG4gICAgICAgIHJlcyArPSBgIFwiJHtjYXR9XCIgLT4gXCJyZWNvcmRcIiBcXG5gO1xuICAgICAgfSlcbiAgXG4gIFxuICAgICAgLy9vdGhlciBkb21haW5zIHRvIHRoaXNcbiAgICAgIGNhdHMuZm9yRWFjaChmdW5jdGlvbihjYXQpIHtcbiAgXG4gIFxuICAgICAgfSlcbiAgICAqL1xuICAgIC8qXG4gICAgY2F0cyBmb1xuICAgICAgZGlncmFwaCBzZHN1IHtcbiAgICAgIHNpemU9XCIzNiwzNlwiO1xuICAgICAgbm9kZSBbY29sb3I9eWVsbG93LCBzdHlsZT1maWxsZWRdO1xuICAgICAgRkxQRCBGTFAgXCJCT00gRWRpdG9yXCIsIFwiV0lLSVVSTFwiIFwiVUk1IERvY3VtZW50YXRpb25cIiwgXCJVSTUgRXhhbXBsZVwiLCBcIlNUQVJUVEFcIlxuICAgICAgQkNQXG4gICAgICBub2RlIFtjb2xvcj1ncmV5LCBzdHlsZT1maWxsZWRdO1xuICAgICAgbm9kZSBbZm9udG5hbWU9XCJWZXJkYW5hXCIsIHNpemU9XCIzMCwzMFwiXTtcbiAgICAgIG5vZGUgW2NvbG9yPWdyZXksIHN0eWxlPWZpbGxlZF07XG4gICAgICBncmFwaCBbIGZvbnRuYW1lID0gXCJBcmlhbFwiLFxuICAgICovXG4gICAgcmVzICs9IFwiXFxuXFx0XFx0aDMgVmVyc2lvblxcblxcdFxcdFxcdGEuc21hbGwoaHJlZj1cXFwiL3doYXRzbmV3XFxcIilcXG5cXG5cXG5ibG9jayBzY3JpcHRzXFxuXFx0c2NyaXB0KHNyYz0nL3ZlbmRvci9qcXVlcnktMi4yLjMubWluLmpzJylcXG5cXHRzY3JpcHQoc3JjPScvdmVuZG9yL2Jvb3RzdHJhcC5taW4uanMnKVxcblxcdHNjcmlwdChzcmM9Jy9qcy92aWV3cy9zZXR0aW5ncy5qcycpXFxuXCI7XG4gICAgcmV0dXJuIHJlcztcbn1cbmV4cG9ydHMudGFiRG9tYWluID0gdGFiRG9tYWluO1xudmFyIGNoaWxkX3Byb2Nlc3NfMSA9IHJlcXVpcmUoXCJjaGlsZF9wcm9jZXNzXCIpO1xuZnVuY3Rpb24gZXhlY0NtZChjbWQpIHtcbiAgICBjaGlsZF9wcm9jZXNzXzEuZXhlYyhjbWQsIGZ1bmN0aW9uIChlcnJvciwgc3Rkb3V0LCBzdGRlcnIpIHtcbiAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiZXhlYyBlcnJvcjogXCIgKyBlcnJvcik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc29sZS5sb2coXCJzdGRvdXQ6IFwiICsgc3Rkb3V0KTtcbiAgICAgICAgY29uc29sZS5sb2coXCJzdGRlcnI6IFwiICsgc3RkZXJyKTtcbiAgICB9KTtcbn1cbjtcbmZ1bmN0aW9uIHZpc01vZGVscyhtLCBmb2xkZXJPdXQpIHtcbiAgICBtLmRvbWFpbnMuZm9yRWFjaChmdW5jdGlvbiAoc0RvbWFpbikge1xuICAgICAgICB2YXIgcyA9IGdyYXBoRG9tYWluKHNEb21haW4sIG0pO1xuICAgICAgICB2YXIgZm5HcmFwaCA9IGZvbGRlck91dCArIFwiL1wiICsgc0RvbWFpbi5yZXBsYWNlKC8gL2csICdfJykgKyBcIi5ndlwiO1xuICAgICAgICBmcy53cml0ZUZpbGVTeW5jKGZuR3JhcGgsIHMpO1xuICAgICAgICBpZiAocHJvY2Vzcy5lbnYuR1JBUEhWSVopIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiaGVyZSB0aGUgZmlsZSBcIiArIGZuR3JhcGgpO1xuICAgICAgICAgICAgZXhlY0NtZChwcm9jZXNzLmVudi5HUkFQSFZJWiArIFwiIC1UanBlZyAtTyBcIiArIGZuR3JhcGgpO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5leHBvcnRzLnZpc01vZGVscyA9IHZpc01vZGVscztcbmZ1bmN0aW9uIHRhYk1vZGVscyhtLCBmb2xkZXJPdXQpIHtcbiAgICBtLmRvbWFpbnMuZm9yRWFjaChmdW5jdGlvbiAoc0RvbWFpbikge1xuICAgICAgICB2YXIgcyA9IHRhYkRvbWFpbihzRG9tYWluLCBtKTtcbiAgICAgICAgdmFyIGZuR3JhcGggPSBmb2xkZXJPdXQgKyBcIi9cIiArIHNEb21haW4ucmVwbGFjZSgvIC9nLCAnXycpICsgXCIuamFkZVwiO1xuICAgICAgICBkZWJ1Z2xvZyhcImhlcmUgdGhlIGZpbGUgXCIgKyBmbkdyYXBoKTtcbiAgICAgICAgZnMud3JpdGVGaWxlU3luYyhmbkdyYXBoLCBzKTtcbiAgICB9KTtcbn1cbmV4cG9ydHMudGFiTW9kZWxzID0gdGFiTW9kZWxzO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
