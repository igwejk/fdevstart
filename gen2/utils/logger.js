/**
 * a simple logger utility
 *
 *
 * There are two types of logs ( append and overwrite, default is append)
 */
"use strict";
/// <reference path="../../lib/node-4.d.ts" />

var debug = require('debug');
var debuglog = debug('logger');
;
var perfs = {};
function logPerf(sString) {
    if (!this || !this.enabled) {
        return;
    }
    var label = 'perf' + this.name;
    console.log('Perf' + this.name);
    if (this.first === 0) {
        this.first = Date.now();
    } else {
        console.log('Perf' + this.name + ' total ' + (Date.now() - this.first));
    }
    if (this.on[sString]) {
        console.timeEnd(sString);
        delete this.on[sString];
    } else {
        console.time(sString);
        this.on[sString] = 1;
    }
}
function perf(string) {
    perfs[string] = { name: string, last: 0, first: 0, on: {}, enabled: false };
    if (debug('perf' + string).enabled) {
        perfs[string].enabled = true;
    }
    return logPerf.bind(perfs[string]);
}
exports.perf = perf;
var fs = require('fs');
var loggers = {};
function getFileName(name) {
    return './logs/' + name + ".log";
}
exports._test = {
    getFileName: getFileName
};
function logIt(logger, arg) {
    var text;
    if (typeof arg === "string") {
        text = arg;
    } else if (arg instanceof Error) {
        text = "Error:" + arg.message + " " + arg.stack;
    }
    if (!text) {
        throw new Error("Illegal argument to log");
    }
    var filename = getFileName(logger.name);
    var d = new Date();
    var n = d.toUTCString() + "\t" + text;
    debuglog('writing log entry to ' + filename + ' ' + n);
    fs.writeFileSync(filename, n, { encoding: 'utf-8', flag: 'a' });
}
function logger(name, flags) {
    if (flags !== 'a' && flags !== '' && flags !== undefined) {
        throw new Error('only a allowed as flags');
    }
    flags = flags === undefined ? 'a' : flags;
    if (typeof name !== "string" || !/^[A-Za-z][A-Za-z0-9_]+$/.exec(name)) {
        throw new Error('Logger name must be at least two alphanumeric characters');
    }
    if (!loggers[name]) {
        var alogger = {
            name: name,
            flags: flags
        };
        alogger.logIt = logIt.bind(undefined, alogger);
        // reset the file
        if (flags === '') {
            try {
                fs.unlinkSync(getFileName(name));
            } catch (e) {
                debuglog("***ERROR: unable to remove log file " + getFileName(name));
            }
        }
        loggers[name] = alogger;
    }
    if (loggers[name].flags !== flags) {
        throw new Error('FLags mismatch in logger' + name);
    }
    return loggers[name].logIt;
}
exports.logger = logger;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy91dGlscy9sb2dnZXIudHMiLCJ1dGlscy9sb2dnZXIuanMiXSwibmFtZXMiOlsiZGVidWciLCJyZXF1aXJlIiwiZGVidWdsb2ciLCJwZXJmcyIsImxvZ1BlcmYiLCJzU3RyaW5nIiwiZW5hYmxlZCIsImxhYmVsIiwibmFtZSIsImNvbnNvbGUiLCJsb2ciLCJmaXJzdCIsIkRhdGUiLCJub3ciLCJvbiIsInRpbWVFbmQiLCJ0aW1lIiwicGVyZiIsInN0cmluZyIsImxhc3QiLCJiaW5kIiwiZXhwb3J0cyIsImZzIiwibG9nZ2VycyIsImdldEZpbGVOYW1lIiwiX3Rlc3QiLCJsb2dJdCIsImxvZ2dlciIsImFyZyIsInRleHQiLCJFcnJvciIsIm1lc3NhZ2UiLCJzdGFjayIsImZpbGVuYW1lIiwiZCIsIm4iLCJ0b1VUQ1N0cmluZyIsIndyaXRlRmlsZVN5bmMiLCJlbmNvZGluZyIsImZsYWciLCJmbGFncyIsInVuZGVmaW5lZCIsImV4ZWMiLCJhbG9nZ2VyIiwidW5saW5rU3luYyIsImUiXSwibWFwcGluZ3MiOiJBQUVBOzs7Ozs7QUNJQTtBREdBOztBQUVBLElBQVlBLFFBQUtDLFFBQU0sT0FBTixDQUFqQjtBQUVBLElBQU1DLFdBQVdGLE1BQU0sUUFBTixDQUFqQjtBQU1DO0FBR0QsSUFBSUcsUUFBUSxFQUFaO0FBR0EsU0FBQUMsT0FBQSxDQUFpQkMsT0FBakIsRUFBd0I7QUFDdEIsUUFBRyxDQUFDLElBQUQsSUFBUyxDQUFDLEtBQUtDLE9BQWxCLEVBQTJCO0FBQ3pCO0FBQ0Q7QUFDRCxRQUFJQyxRQUFRLFNBQVMsS0FBS0MsSUFBMUI7QUFDQUMsWUFBUUMsR0FBUixDQUFZLFNBQVMsS0FBS0YsSUFBMUI7QUFDQSxRQUFHLEtBQUtHLEtBQUwsS0FBZSxDQUFsQixFQUFxQjtBQUNqQixhQUFLQSxLQUFMLEdBQWFDLEtBQUtDLEdBQUwsRUFBYjtBQUNILEtBRkQsTUFFTztBQUNMSixnQkFBUUMsR0FBUixDQUFZLFNBQVMsS0FBS0YsSUFBZCxHQUFx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TixDQUFXcUIsU0FBWCxFQUFzQkUsT0FBdEIsQ0FBaEI7QUFDQTtBQUNBLFlBQUlILFVBQVUsRUFBZCxFQUFrQjtBQUNoQixnQkFBSTtBQUNGbEIsbUJBQUdzQixVQUFILENBQWNwQixZQUFZaEIsSUFBWixDQUFkO0FBQ0EsYUFGRixDQUVFLE9BQU9xQyxDQUFQLEVBQVU7QUFDVjNDLHlCQUFTLHlDQUF5Q3NCLFlBQVloQixJQUFaLENBQWxEO0FBQ0Q7QUFDRjtBQUNEZSxnQkFBUWYsSUFBUixJQUFnQm1DLE9BQWhCO0FBQ0Q7QUFDRCxRQUFJcEIsUUFBUWYsSUFBUixFQUFjZ0MsS0FBZCxLQUF3QkEsS0FBNUIsRUFBbUM7QUFDakMsY0FBTSxJQUFJVixLQUFKLENBQVUsNkJBQTZCdEIsSUFBdkMsQ0FBTjtBQUNEO0FBQ0QsV0FBT2UsUUFBUWYsSUFBUixFQUFja0IsS0FBckI7QUFDRDtBQTVCZUwsUUFBQU0sTUFBQSxHQUFNQSxNQUFOIiwiZmlsZSI6InV0aWxzL2xvZ2dlci5qcyIsInNvdXJjZXNDb250ZW50IjpbIlxuXG4vKipcbiAqIGEgc2ltcGxlIGxvZ2dlciB1dGlsaXR5XG4gKlxuICpcbiAqIFRoZXJlIGFyZSB0d28gdHlwZXMgb2YgbG9ncyAoIGFwcGVuZCBhbmQgb3ZlcndyaXRlLCBkZWZhdWx0IGlzIGFwcGVuZClcbiAqL1xuXG4vLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vLi4vbGliL25vZGUtNC5kLnRzXCIgLz5cblxuaW1wb3J0ICogYXMgZGVidWcgZnJvbSAnZGVidWcnO1xuXG5jb25zdCBkZWJ1Z2xvZyA9IGRlYnVnKCdsb2dnZXInKTtcblxuaW50ZXJmYWNlIElMb2dnZXIge1xuICBuYW1lOiBzdHJpbmcsXG4gIGZsYWdzOiBzdHJpbmcsXG4gIGxvZ0l0PzogKGFueSkgPT4gdm9pZFxufTtcblxuXG52YXIgcGVyZnMgPSB7fSBhcyB7W2tleSA6IHN0cmluZ10gOiB7IGVuYWJsZWQgOiBib29sZWFuLCBuYW1lIDogc3RyaW5nLCBsYXN0OiBudW1iZXIsIGZpcnN0IDogbnVtYmVyLCBvbiA6IHt9fX07XG5cblxuZnVuY3Rpb24gbG9nUGVyZihzU3RyaW5nKSB7XG4gIGlmKCF0aGlzIHx8ICF0aGlzLmVuYWJsZWQpIHtcbiAgICByZXR1cm47XG4gIH1cbiAgdmFyIGxhYmVsID0gJ3BlcmYnICsgdGhpcy5uYW1lO1xuICBjb25zb2xlLmxvZygnUGVyZicgKyB0aGlzLm5hbWUpO1xuICBpZih0aGlzLmZpcnN0ID09PSAwKSB7XG4gICAgICB0aGlzLmZpcnN0ID0gRGF0ZS5ub3coKTtcbiAgfSBlbHNlIHtcbiAgICBjb25zb2xlLmxvZygnUGVyZicgKyB0aGlzLm5hbWUgKyAnIHRvdGFsICcgKyAoRGF0ZS5ub3coKSAtIHRoaXMuZmlyc3QpKTtcbiAgfVxuICBpZiggdGhpcy5vbltzU3RyaW5nXSkge1xuICAgICBjb25zb2xlLnRpbWVFbmQoc1N0cmluZylcbiAgICAgZGVsZXRlIHRoaXMub25bc1N0cmluZ107XG4gIH0gZWxzZSB7XG4gICAgICBjb25zb2xlLnRpbWUoc1N0cmluZyk7XG4gICAgICB0aGlzLm9uW3NTdHJpbmddID0gMTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gcGVyZihzdHJpbmcpIHtcbiAgcGVyZnNbc3RyaW5nXSA9IHsgbmFtZSA6IHN0cmluZywgbGFzdCA6IDAsIGZpcnN0OiAwLCBvbiA6IHt9LCBlbmFibGVkIDogZmFsc2UgfTtcbiAgaWYgKGRlYnVnKCdwZXJmJyArIHN0cmluZykuZW5hYmxlZCApXG4gIHsgcGVyZnNbc3RyaW5nXS5lbmFibGVkID0gdHJ1ZTtcbiAgfVxuICByZXR1cm4gbG9nUGVyZi5iaW5kKHBlcmZzW3N0cmluZ10pO1xufVxuXG5pbXBvcnQgKiBhcyBmcyBmcm9tICdmcyc7XG5cbnZhciBsb2dnZXJzID0ge30gYXMgeyBba2V5OiBzdHJpbmddOiBJTG9nZ2VyIH07XG5cbmZ1bmN0aW9uIGdldEZpbGVOYW1lKG5hbWU6IHN0cmluZykge1xuICByZXR1cm4gJy4vbG9ncy8nICsgbmFtZSArIFwiLmxvZ1wiO1xufVxuXG5leHBvcnQgY29uc3QgX3Rlc3QgPSB7XG4gIGdldEZpbGVOYW1lOiBnZXRGaWxlTmFtZVxufTtcblxuZnVuY3Rpb24gbG9nSXQobG9nZ2VyOiBJTG9nZ2VyLCBhcmcpIHtcbiAgdmFyIHRleHQ6IHN0cmluZztcbiAgaWYgKHR5cGVvZiBhcmcgPT09IFwic3RyaW5nXCIpIHtcbiAgICB0ZXh0ID0gYXJnO1xuICB9IGVsc2UgaWYgKGFyZyBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgdGV4dCA9IFwiRXJyb3I6XCIgKyBhcmcubWVzc2FnZSArIFwiIFwiICsgYXJnLnN0YWNrO1xuICB9XG4gIGlmICghdGV4dCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIklsbGVnYWwgYXJndW1lbnQgdG8gbG9nXCIpO1xuICB9XG4gIHZhciBmaWxlbmFtZSA9IGdldEZpbGVOYW1lKGxvZ2dlci5uYW1lKTtcbiAgdmFyIGQgPSBuZXcgRGF0ZSgpO1xuICB2YXIgbiA9IGQudG9VVENTdHJpbmcoKSArIFwiXFx0XCIgKyB0ZXh0O1xuICBkZWJ1Z2xvZygnd3JpdGluZyBsb2cgZW50cnkgdG8gJyArIGZpbGVuYW1lICsgJyAnICsgbik7XG4gIGZzLndyaXRlRmlsZVN5bmMoZmlsZW5hbWUsIG4sIHsgZW5jb2Rpbmc6ICd1dGYtOCcsIGZsYWc6ICdhJyB9KTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGxvZ2dlcihuYW1lOiBzdHJpbmcsIGZsYWdzPzogc3RyaW5nKTogKGFueSkgPT4gdm9pZCB7XG4gIGlmIChmbGFncyAhPT0gJ2EnICYmIGZsYWdzICE9PSAnJyAmJiBmbGFncyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdvbmx5IGEgYWxsb3dlZCBhcyBmbGFncycpO1xuICB9XG4gIGZsYWdzID0gKGZsYWdzID09PSB1bmRlZmluZWQgKT8gICdhJyA6IGZsYWdzO1xuICBpZiAodHlwZW9mIG5hbWUgIT09IFwic3RyaW5nXCIgfHwgIS9eW0EtWmEtel1bQS1aYS16MC05X10rJC8uZXhlYyhuYW1lKSkge1xuICAgIHRocm93IG5ldyBFcnJvcignTG9nZ2VyIG5hbWUgbXVzdCBiZSBhdCBsZWFzdCB0d28gYWxwaGFudW1lcmljIGNoYXJhY3RlcnMnKVxuICB9XG4gIGlmICghbG9nZ2Vyc1tuYW1lXSkge1xuICAgIHZhciBhbG9nZ2VyID0ge1xuICAgICAgbmFtZTogbmFtZSxcbiAgICAgIGZsYWdzOiBmbGFnc1xuICAgIH0gYXMgSUxvZ2dlcjtcbiAgICBhbG9nZ2VyLmxvZ0l0ID0gbG9nSXQuYmluZCh1bmRlZmluZWQsIGFsb2dnZXIpO1xuICAgIC8vIHJlc2V0IHRoZSBmaWxlXG4gICAgaWYgKGZsYWdzID09PSAnJykge1xuICAgICAgdHJ5IHtcbiAgICAgICAgZnMudW5saW5rU3luYyhnZXRGaWxlTmFtZShuYW1lKSk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGRlYnVnbG9nKFwiKioqRVJST1I6IHVuYWJsZSB0byByZW1vdmUgbG9nIGZpbGUgXCIgKyBnZXRGaWxlTmFtZShuYW1lKSk7XG4gICAgICB9XG4gICAgfVxuICAgIGxvZ2dlcnNbbmFtZV0gPSBhbG9nZ2VyO1xuICB9XG4gIGlmIChsb2dnZXJzW25hbWVdLmZsYWdzICE9PSBmbGFncykge1xuICAgIHRocm93IG5ldyBFcnJvcignRkxhZ3MgbWlzbWF0Y2ggaW4gbG9nZ2VyJyArIG5hbWUpO1xuICB9XG4gIHJldHVybiBsb2dnZXJzW25hbWVdLmxvZ0l0O1xufSIsIi8qKlxuICogYSBzaW1wbGUgbG9nZ2VyIHV0aWxpdHlcbiAqXG4gKlxuICogVGhlcmUgYXJlIHR3byB0eXBlcyBvZiBsb2dzICggYXBwZW5kIGFuZCBvdmVyd3JpdGUsIGRlZmF1bHQgaXMgYXBwZW5kKVxuICovXG5cInVzZSBzdHJpY3RcIjtcbi8vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi8uLi9saWIvbm9kZS00LmQudHNcIiAvPlxudmFyIGRlYnVnID0gcmVxdWlyZSgnZGVidWcnKTtcbnZhciBkZWJ1Z2xvZyA9IGRlYnVnKCdsb2dnZXInKTtcbjtcbnZhciBwZXJmcyA9IHt9O1xuZnVuY3Rpb24gbG9nUGVyZihzU3RyaW5nKSB7XG4gICAgaWYgKCF0aGlzIHx8ICF0aGlzLmVuYWJsZWQpIHtcbiAgICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB2YXIgbGFiZWwgPSAncGVyZicgKyB0aGlzLm5hbWU7XG4gICAgY29uc29sZS5sb2coJ1BlcmYnICsgdGhpcy5uYW1lKTtcbiAgICBpZiAodGhpcy5maXJzdCA9PT0gMCkge1xuICAgICAgICB0aGlzLmZpcnN0ID0gRGF0ZS5ub3coKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdQZXJmJyArIHRoaXMubmFtZSArICcgdG90YWwgJyArIChEYXRlLm5vdygpIC0gdGhpcy5maXJzdCkpO1xuICAgIH1cbiAgICBpZiAodGhpcy5vbltzU3RyaW5nXSkge1xuICAgICAgICBjb25zb2xlLnRpbWVFbmQoc1N0cmluZyk7XG4gICAgICAgIGRlbGV0ZSB0aGlzLm9uW3NTdHJpbmddO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgY29uc29sZS50aW1lKHNTdHJpbmcpO1xuICAgICAgICB0aGlzLm9uW3NTdHJpbmddID0gMTtcbiAgICB9XG59XG5mdW5jdGlvbiBwZXJmKHN0cmluZykge1xuICAgIHBlcmZzW3N0cmluZ10gPSB7IG5hbWU6IHN0cmluZywgbGFzdDogMCwgZmlyc3Q6IDAsIG9uOiB7fSwgZW5hYmxlZDogZmFsc2UgfTtcbiAgICBpZiAoZGVidWcoJ3BlcmYnICsgc3RyaW5nKS5lbmFibGVkKSB7XG4gICAgICAgIHBlcmZzW3N0cmluZ10uZW5hYmxlZCA9IHRydWU7XG4gICAgfVxuICAgIHJldHVybiBsb2dQZXJmLmJpbmQocGVyZnNbc3RyaW5nXSk7XG59XG5leHBvcnRzLnBlcmYgPSBwZXJmO1xudmFyIGZzID0gcmVxdWlyZSgnZnMnKTtcbnZhciBsb2dnZXJzID0ge307XG5mdW5jdGlvbiBnZXRGaWxlTmFtZShuYW1lKSB7XG4gICAgcmV0dXJuICcuL2xvZ3MvJyArIG5hbWUgKyBcIi5sb2dcIjtcbn1cbmV4cG9ydHMuX3Rlc3QgPSB7XG4gICAgZ2V0RmlsZU5hbWU6IGdldEZpbGVOYW1lXG59O1xuZnVuY3Rpb24gbG9nSXQobG9nZ2VyLCBhcmcpIHtcbiAgICB2YXIgdGV4dDtcbiAgICBpZiAodHlwZW9mIGFyZyA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICB0ZXh0ID0gYXJnO1xuICAgIH1cbiAgICBlbHNlIGlmIChhcmcgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgICAgICB0ZXh0ID0gXCJFcnJvcjpcIiArIGFyZy5tZXNzYWdlICsgXCIgXCIgKyBhcmcuc3RhY2s7XG4gICAgfVxuICAgIGlmICghdGV4dCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbGxlZ2FsIGFyZ3VtZW50IHRvIGxvZ1wiKTtcbiAgICB9XG4gICAgdmFyIGZpbGVuYW1lID0gZ2V0RmlsZU5hbWUobG9nZ2VyLm5hbWUpO1xuICAgIHZhciBkID0gbmV3IERhdGUoKTtcbiAgICB2YXIgbiA9IGQudG9VVENTdHJpbmcoKSArIFwiXFx0XCIgKyB0ZXh0O1xuICAgIGRlYnVnbG9nKCd3cml0aW5nIGxvZyBlbnRyeSB0byAnICsgZmlsZW5hbWUgKyAnICcgKyBuKTtcbiAgICBmcy53cml0ZUZpbGVTeW5jKGZpbGVuYW1lLCBuLCB7IGVuY29kaW5nOiAndXRmLTgnLCBmbGFnOiAnYScgfSk7XG59XG5mdW5jdGlvbiBsb2dnZXIobmFtZSwgZmxhZ3MpIHtcbiAgICBpZiAoZmxhZ3MgIT09ICdhJyAmJiBmbGFncyAhPT0gJycgJiYgZmxhZ3MgIT09IHVuZGVmaW5lZCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ29ubHkgYSBhbGxvd2VkIGFzIGZsYWdzJyk7XG4gICAgfVxuICAgIGZsYWdzID0gKGZsYWdzID09PSB1bmRlZmluZWQpID8gJ2EnIDogZmxhZ3M7XG4gICAgaWYgKHR5cGVvZiBuYW1lICE9PSBcInN0cmluZ1wiIHx8ICEvXltBLVphLXpdW0EtWmEtejAtOV9dKyQvLmV4ZWMobmFtZSkpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdMb2dnZXIgbmFtZSBtdXN0IGJlIGF0IGxlYXN0IHR3byBhbHBoYW51bWVyaWMgY2hhcmFjdGVycycpO1xuICAgIH1cbiAgICBpZiAoIWxvZ2dlcnNbbmFtZV0pIHtcbiAgICAgICAgdmFyIGFsb2dnZXIgPSB7XG4gICAgICAgICAgICBuYW1lOiBuYW1lLFxuICAgICAgICAgICAgZmxhZ3M6IGZsYWdzXG4gICAgICAgIH07XG4gICAgICAgIGFsb2dnZXIubG9nSXQgPSBsb2dJdC5iaW5kKHVuZGVmaW5lZCwgYWxvZ2dlcik7XG4gICAgICAgIC8vIHJlc2V0IHRoZSBmaWxlXG4gICAgICAgIGlmIChmbGFncyA9PT0gJycpIHtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgZnMudW5saW5rU3luYyhnZXRGaWxlTmFtZShuYW1lKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIGRlYnVnbG9nKFwiKioqRVJST1I6IHVuYWJsZSB0byByZW1vdmUgbG9nIGZpbGUgXCIgKyBnZXRGaWxlTmFtZShuYW1lKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgbG9nZ2Vyc1tuYW1lXSA9IGFsb2dnZXI7XG4gICAgfVxuICAgIGlmIChsb2dnZXJzW25hbWVdLmZsYWdzICE9PSBmbGFncykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZMYWdzIG1pc21hdGNoIGluIGxvZ2dlcicgKyBuYW1lKTtcbiAgICB9XG4gICAgcmV0dXJuIGxvZ2dlcnNbbmFtZV0ubG9nSXQ7XG59XG5leHBvcnRzLmxvZ2dlciA9IGxvZ2dlcjtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
