/**
 * a simple logger utility
 *
 *
 * There are two types of logs ( append and overwrite, default is append)
 */
"use strict";
/// <reference path="../../lib/node-4.d.ts" />

var debug = require('debug');
var debuglog = debug('logger');
;
var fs = require('fs');
var loggers = {};
function getFileName(name) {
    return './logs/' + name + ".log";
}
exports._test = {
    getFileName: getFileName
};
function logIt(logger, arg) {
    var text;
    if (typeof arg === "string") {
        text = arg;
    } else if (arg instanceof Error) {
        text = "Error:" + arg.message + " " + arg.stack;
    }
    if (!text) {
        throw new Error("Illegal argument to log");
    }
    var filename = getFileName(logger.name);
    var d = new Date();
    var n = d.toUTCString() + "\t" + text;
    debuglog('writing log entry to ' + filename + ' ' + n);
    fs.writeFileSync(filename, n, { encoding: 'utf-8', flag: 'a' });
}
function logger(name, flags) {
    flags = flags || "a";
    if (flags !== 'a' && flags !== '') {
        throw new Error('only a allowed as flags');
    }
    if (typeof name !== "string" || !/^[A-Za-z][A-Za-z0-9_]+$/.exec(name)) {
        throw new Error('Logger name must be at least two alphanumeric characters');
    }
    if (!loggers[name]) {
        var alogger = {
            name: name,
            flags: flags
        };
        alogger.logIt = logIt.bind(undefined, alogger);
        // reset the file
        if (flags === '') {
            try {
                fs.unlinkSync(getFileName(name));
            } catch (e) {
                debuglog("***ERROR: unable to remove log file " + getFileName(name));
            }
        }
        loggers[name] = alogger;
    }
    if (loggers[name].flags !== flags) {
        throw new Error('FLags mismatch in logger' + name);
    }
    return loggers[name].logIt;
}
exports.logger = logger;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy91dGlscy9sb2dnZXIudHMiLCJ1dGlscy9sb2dnZXIuanMiXSwibmFtZXMiOlsiZGVidWciLCJyZXF1aXJlIiwiZGVidWdsb2ciLCJmcyIsImxvZ2dlcnMiLCJnZXRGaWxlTmFtZSIsIm5hbWUiLCJleHBvcnRzIiwiX3Rlc3QiLCJsb2dJdCIsImxvZ2dlciIsImFyZyIsInRleHQiLCJFcnJvciIsIm1lc3NhZ2UiLCJzdGFjayIsImZpbGVuYW1lIiwiZCIsIkRhdGUiLCJuIiwidG9VVENTdHJpbmciLCJ3cml0ZUZpbGVTeW5jIiwiZW5jb2RpbmciLCJmbGFnIiwiZmxhZ3MiLCJleGVjIiwiYWxvZ2dlciIsImJpbmQiLCJ1bmRlZmluZWQiLCJ1bmxpbmtTeW5jIiwiZSJdLCJtYXBwaW5ncyI6IkFBRUE7Ozs7OztBQ0lBO0FER0E7O0FBRUEsSUFBWUEsUUFBS0MsUUFBTSxPQUFOLENBQWpCO0FBRUEsSUFBTUMsV0FBV0YsTUFBTSxRQUFOLENBQWpCO0FBTUM7QUFFRCxJQUFZRyxLQUFFRixRQUFNLElBQU4sQ0FBZDtBQUVBLElBQUlHLFVBQVUsRUFBZDtBQUVBLFNBQUFDLFdBQUEsQ0FBcUJDLElBQXJCLEVBQWlDO0FBQy9CLFdBQU8sWUFBWUEsSUFBWixHQUFtQixNQUExQjtBQUNEO0FBRVlDLFFBQUFDLEtBQUEsR0FBUTtBQUNuQkgsaUJBQWFBO0FBRE0sQ0FBUjtBQUliLFNBQUFJLEtBQUEsQ0FBZUMsTUFBZixFQUFnQ0MsR0FBaEMsRUFBbUM7QUFDakMsUUFBSUMsSUFBSjtBQUNBLFFBQUksT0FBT0QsR0FBUCxLQUFlLFFBQW5CLEVBQTZCO0FBQzNCQyxlQUFPRCxHQUFQO0FBQ0QsS0FGRCxNQUVPLElBQUlBLGVBQWVFLEtBQW5CLEVBQTBCO0FBQy9CRCxlQUFPLFdBQVdELElBQUlHLE9BQWYsR0FBeUIsR0FBekIsR0FBK0JILElBQUlJLEtBQTFDO0FBQ0Q7QUFDRCxRQUFJLENBQUNILElBQUwsRUFBVztBQUNULGNBQU0sSUFBSUMsS0FBSixDQUFVLHlCQUFWLENBQU47QUFDRDtBQUNELFFBQUlHLFdBQVdYLFlBQVlLLE9BQU9KLElBQW5CLENBQWY7QUFDQSxRQUFJVyxJQUFJLElBQUlDLElBQUosRUFBUjtBQUNBLFFBQUlDLElBQUlGLEVBQUVHLFdBQUYsS0FBa0IsSUFBbEIsR0FBeUJSLElBQWpDO0FBQ0FWLGFBQVMsMEJBQTBCYyxRQUExQixHQUFxQyxHQUFyQyxHQUEyQ0csQ0FBcEQ7QUFDQWhCLE9BQUdrQixhQUFILENBQWlCTCxRQUFqQixFQUEyQkcsQ0FBM0IsRUFBOEIsRUFBRUcsVUFBVSxPQUFaLEVBQXFCQyxNQUFNLEdBQTNCLEVBQTlCO0FBQ0Q7QUFFRCxTQUFBYixNQUFBLENBQXVCSixJQUF2QixFQUFxQ2tCLEtBQXJDLEVBQW1EO0FBQ2pEQSxZQUFRQSxTQUFTLEdBQWpCO0FBQ0EsUUFBSUEsVUFBVSxHQUFWLElBQWlCQSxVQUFVLEVBQS9CLEVBQW1DO0FBQ2pDLGNBQU0sSUFBSVgsS0FBSixDQUFVLHlCQUFWLENBQU47QUFDRDtBQUNELFFBQUksT0FBT1AsSUFBUCxLQUFnQixRQUFoQixJQUE0QixDQUFDLDBCQUEwQm1CLElBQTFCLENBQStCbkIsSUFBL0IsQ0FBakMsRUFBdUU7QUFDckUsY0FBTSxJQUFJTyxLQUFKLENBQVUsMERBQVYsQ0FBTjtBQUNEO0FBQ0QsUUFBSSxDQUFDVCxRQUFRRSxJQUFSLENBQUwsRUFBb0I7QUFDbEIsWUFBSW9CLFVBQVU7QUFDWnBCLGtCQUFNQSxJQURNO0FBRVprQixtQkFBT0E7QUFGSyxTQUFkO0FBSUFFLGdCQUFRakIsS0FBUixHQUFnQkEsTUFBTWtCLElBQU4sQ0FBV0MsU0FBWCxFQUFzQkYsT0FBdEIsQ0FBaEI7QUFDQTtBQUNBLFlBQUlGLFVBQVUsRUFBZCxFQUFrQjtBQUNoQixnQkFBSTtBQUNGckIsbUJBQUcwQixVQUFILENBQWN4QixZQUFZQyxJQUFaLENBQWQ7QUFDQSxhQUZGLENBRUUsT0FBT3dCLENBQVAsRUFBVTtBQUNWNUIseUJBQVMseUNBQXlDRyxZQUFZQyxJQUFaLENBQWxEO0FBQ0Q7QUFDRjtBQUNERixnQkFBUUUsSUFBUixJQUFnQm9CLE9BQWhCO0FBQ0Q7QUFDRCxRQUFJdEIsUUFBUUUsSUFBUixFQUFja0IsS0FBZCxLQUF3QkEsS0FBNUIsRUFBbUM7QUFDakMsY0FBTSxJQUFJWCxLQUFKLENBQVUsNkJBQTZCUCxJQUF2QyxDQUFOO0FBQ0Q7QUFDRCxXQUFPRixRQUFRRSxJQUFSLEVBQWNHLEtBQXJCO0FBQ0Q7QUE1QmVGLFFBQUFHLE1BQUEsR0FBTUEsTUFBTiIsImZpbGUiOiJ1dGlscy9sb2dnZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJcblxuLyoqXG4gKiBhIHNpbXBsZSBsb2dnZXIgdXRpbGl0eVxuICpcbiAqXG4gKiBUaGVyZSBhcmUgdHdvIHR5cGVzIG9mIGxvZ3MgKCBhcHBlbmQgYW5kIG92ZXJ3cml0ZSwgZGVmYXVsdCBpcyBhcHBlbmQpXG4gKi9cblxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4uLy4uL2xpYi9ub2RlLTQuZC50c1wiIC8+XG5cbmltcG9ydCAqIGFzIGRlYnVnIGZyb20gJ2RlYnVnJztcblxuY29uc3QgZGVidWdsb2cgPSBkZWJ1ZygnbG9nZ2VyJyk7XG5cbmludGVyZmFjZSBJTG9nZ2VyIHtcbiAgbmFtZTogc3RyaW5nLFxuICBmbGFnczogc3RyaW5nLFxuICBsb2dJdD86IChhbnkpID0+IHZvaWRcbn07XG5cbmltcG9ydCAqIGFzIGZzIGZyb20gJ2ZzJztcblxudmFyIGxvZ2dlcnMgPSB7fSBhcyB7IFtrZXk6IHN0cmluZ106IElMb2dnZXIgfTtcblxuZnVuY3Rpb24gZ2V0RmlsZU5hbWUobmFtZTogc3RyaW5nKSB7XG4gIHJldHVybiAnLi9sb2dzLycgKyBuYW1lICsgXCIubG9nXCI7XG59XG5cbmV4cG9ydCBjb25zdCBfdGVzdCA9IHtcbiAgZ2V0RmlsZU5hbWU6IGdldEZpbGVOYW1lXG59O1xuXG5mdW5jdGlvbiBsb2dJdChsb2dnZXI6IElMb2dnZXIsIGFyZykge1xuICB2YXIgdGV4dDogc3RyaW5nO1xuICBpZiAodHlwZW9mIGFyZyA9PT0gXCJzdHJpbmdcIikge1xuICAgIHRleHQgPSBhcmc7XG4gIH0gZWxzZSBpZiAoYXJnIGluc3RhbmNlb2YgRXJyb3IpIHtcbiAgICB0ZXh0ID0gXCJFcnJvcjpcIiArIGFyZy5tZXNzYWdlICsgXCIgXCIgKyBhcmcuc3RhY2s7XG4gIH1cbiAgaWYgKCF0ZXh0KSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiSWxsZWdhbCBhcmd1bWVudCB0byBsb2dcIik7XG4gIH1cbiAgdmFyIGZpbGVuYW1lID0gZ2V0RmlsZU5hbWUobG9nZ2VyLm5hbWUpO1xuICB2YXIgZCA9IG5ldyBEYXRlKCk7XG4gIHZhciBuID0gZC50b1VUQ1N0cmluZygpICsgXCJcXHRcIiArIHRleHQ7XG4gIGRlYnVnbG9nKCd3cml0aW5nIGxvZyBlbnRyeSB0byAnICsgZmlsZW5hbWUgKyAnICcgKyBuKTtcbiAgZnMud3JpdGVGaWxlU3luYyhmaWxlbmFtZSwgbiwgeyBlbmNvZGluZzogJ3V0Zi04JywgZmxhZzogJ2EnIH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gbG9nZ2VyKG5hbWU6IHN0cmluZywgZmxhZ3M/OiBzdHJpbmcpOiAoYW55KSA9PiB2b2lkIHtcbiAgZmxhZ3MgPSBmbGFncyB8fCBcImFcIjtcbiAgaWYgKGZsYWdzICE9PSAnYScgJiYgZmxhZ3MgIT09ICcnKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdvbmx5IGEgYWxsb3dlZCBhcyBmbGFncycpO1xuICB9XG4gIGlmICh0eXBlb2YgbmFtZSAhPT0gXCJzdHJpbmdcIiB8fCAhL15bQS1aYS16XVtBLVphLXowLTlfXSskLy5leGVjKG5hbWUpKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdMb2dnZXIgbmFtZSBtdXN0IGJlIGF0IGxlYXN0IHR3byBhbHBoYW51bWVyaWMgY2hhcmFjdGVycycpXG4gIH1cbiAgaWYgKCFsb2dnZXJzW25hbWVdKSB7XG4gICAgdmFyIGFsb2dnZXIgPSB7XG4gICAgICBuYW1lOiBuYW1lLFxuICAgICAgZmxhZ3M6IGZsYWdzXG4gICAgfSBhcyBJTG9nZ2VyO1xuICAgIGFsb2dnZXIubG9nSXQgPSBsb2dJdC5iaW5kKHVuZGVmaW5lZCwgYWxvZ2dlcik7XG4gICAgLy8gcmVzZXQgdGhlIGZpbGVcbiAgICBpZiAoZmxhZ3MgPT09ICcnKSB7XG4gICAgICB0cnkge1xuICAgICAgICBmcy51bmxpbmtTeW5jKGdldEZpbGVOYW1lKG5hbWUpKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgZGVidWdsb2coXCIqKipFUlJPUjogdW5hYmxlIHRvIHJlbW92ZSBsb2cgZmlsZSBcIiArIGdldEZpbGVOYW1lKG5hbWUpKTtcbiAgICAgIH1cbiAgICB9XG4gICAgbG9nZ2Vyc1tuYW1lXSA9IGFsb2dnZXI7XG4gIH1cbiAgaWYgKGxvZ2dlcnNbbmFtZV0uZmxhZ3MgIT09IGZsYWdzKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKCdGTGFncyBtaXNtYXRjaCBpbiBsb2dnZXInICsgbmFtZSk7XG4gIH1cbiAgcmV0dXJuIGxvZ2dlcnNbbmFtZV0ubG9nSXQ7XG59IiwiLyoqXG4gKiBhIHNpbXBsZSBsb2dnZXIgdXRpbGl0eVxuICpcbiAqXG4gKiBUaGVyZSBhcmUgdHdvIHR5cGVzIG9mIGxvZ3MgKCBhcHBlbmQgYW5kIG92ZXJ3cml0ZSwgZGVmYXVsdCBpcyBhcHBlbmQpXG4gKi9cblwidXNlIHN0cmljdFwiO1xuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4uLy4uL2xpYi9ub2RlLTQuZC50c1wiIC8+XG52YXIgZGVidWcgPSByZXF1aXJlKCdkZWJ1ZycpO1xudmFyIGRlYnVnbG9nID0gZGVidWcoJ2xvZ2dlcicpO1xuO1xudmFyIGZzID0gcmVxdWlyZSgnZnMnKTtcbnZhciBsb2dnZXJzID0ge307XG5mdW5jdGlvbiBnZXRGaWxlTmFtZShuYW1lKSB7XG4gICAgcmV0dXJuICcuL2xvZ3MvJyArIG5hbWUgKyBcIi5sb2dcIjtcbn1cbmV4cG9ydHMuX3Rlc3QgPSB7XG4gICAgZ2V0RmlsZU5hbWU6IGdldEZpbGVOYW1lXG59O1xuZnVuY3Rpb24gbG9nSXQobG9nZ2VyLCBhcmcpIHtcbiAgICB2YXIgdGV4dDtcbiAgICBpZiAodHlwZW9mIGFyZyA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICB0ZXh0ID0gYXJnO1xuICAgIH1cbiAgICBlbHNlIGlmIChhcmcgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgICAgICB0ZXh0ID0gXCJFcnJvcjpcIiArIGFyZy5tZXNzYWdlICsgXCIgXCIgKyBhcmcuc3RhY2s7XG4gICAgfVxuICAgIGlmICghdGV4dCkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbGxlZ2FsIGFyZ3VtZW50IHRvIGxvZ1wiKTtcbiAgICB9XG4gICAgdmFyIGZpbGVuYW1lID0gZ2V0RmlsZU5hbWUobG9nZ2VyLm5hbWUpO1xuICAgIHZhciBkID0gbmV3IERhdGUoKTtcbiAgICB2YXIgbiA9IGQudG9VVENTdHJpbmcoKSArIFwiXFx0XCIgKyB0ZXh0O1xuICAgIGRlYnVnbG9nKCd3cml0aW5nIGxvZyBlbnRyeSB0byAnICsgZmlsZW5hbWUgKyAnICcgKyBuKTtcbiAgICBmcy53cml0ZUZpbGVTeW5jKGZpbGVuYW1lLCBuLCB7IGVuY29kaW5nOiAndXRmLTgnLCBmbGFnOiAnYScgfSk7XG59XG5mdW5jdGlvbiBsb2dnZXIobmFtZSwgZmxhZ3MpIHtcbiAgICBmbGFncyA9IGZsYWdzIHx8IFwiYVwiO1xuICAgIGlmIChmbGFncyAhPT0gJ2EnICYmIGZsYWdzICE9PSAnJykge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ29ubHkgYSBhbGxvd2VkIGFzIGZsYWdzJyk7XG4gICAgfVxuICAgIGlmICh0eXBlb2YgbmFtZSAhPT0gXCJzdHJpbmdcIiB8fCAhL15bQS1aYS16XVtBLVphLXowLTlfXSskLy5leGVjKG5hbWUpKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignTG9nZ2VyIG5hbWUgbXVzdCBiZSBhdCBsZWFzdCB0d28gYWxwaGFudW1lcmljIGNoYXJhY3RlcnMnKTtcbiAgICB9XG4gICAgaWYgKCFsb2dnZXJzW25hbWVdKSB7XG4gICAgICAgIHZhciBhbG9nZ2VyID0ge1xuICAgICAgICAgICAgbmFtZTogbmFtZSxcbiAgICAgICAgICAgIGZsYWdzOiBmbGFnc1xuICAgICAgICB9O1xuICAgICAgICBhbG9nZ2VyLmxvZ0l0ID0gbG9nSXQuYmluZCh1bmRlZmluZWQsIGFsb2dnZXIpO1xuICAgICAgICAvLyByZXNldCB0aGUgZmlsZVxuICAgICAgICBpZiAoZmxhZ3MgPT09ICcnKSB7XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGZzLnVubGlua1N5bmMoZ2V0RmlsZU5hbWUobmFtZSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICBkZWJ1Z2xvZyhcIioqKkVSUk9SOiB1bmFibGUgdG8gcmVtb3ZlIGxvZyBmaWxlIFwiICsgZ2V0RmlsZU5hbWUobmFtZSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGxvZ2dlcnNbbmFtZV0gPSBhbG9nZ2VyO1xuICAgIH1cbiAgICBpZiAobG9nZ2Vyc1tuYW1lXS5mbGFncyAhPT0gZmxhZ3MpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdGTGFncyBtaXNtYXRjaCBpbiBsb2dnZXInICsgbmFtZSk7XG4gICAgfVxuICAgIHJldHVybiBsb2dnZXJzW25hbWVdLmxvZ0l0O1xufVxuZXhwb3J0cy5sb2dnZXIgPSBsb2dnZXI7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
