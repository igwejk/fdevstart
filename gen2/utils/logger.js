/**
 * a simple logger utility
 *
 *
 * There are two types of logs ( append and overwrite, default is append)
 */
"use strict";
/// <reference path="../../lib/node-4.d.ts" />

var debug = require('debug');
var debuglog = debug('logger');
;
var perfs = {};
function logPerf(sString) {
    if (!this) {
        return;
    }
    var label = 'perf' + this.name;
    console.log('Perf' + this.name);
    if (this.first === 0) {
        this.first = Date.now();
    } else {
        console.log('Perf' + this.name + ' total ' + (Date.now() - this.first));
    }
    if (this.on[sString]) {
        console.timeEnd(sString);
        delete this.on[sString];
    } else {
        console.time(sString);
        this.on[sString] = 1;
    }
}
function perf(string) {
    if (debug('perf' + this.name).enabled) {
        perfs[string] = { name: string, last: 0, first: 0, on: {} };
    }
    return logPerf.bind(perfs[string]);
}
exports.perf = perf;
var fs = require('fs');
var loggers = {};
function getFileName(name) {
    return './logs/' + name + ".log";
}
exports._test = {
    getFileName: getFileName
};
function logIt(logger, arg) {
    var text;
    if (typeof arg === "string") {
        text = arg;
    } else if (arg instanceof Error) {
        text = "Error:" + arg.message + " " + arg.stack;
    }
    if (!text) {
        throw new Error("Illegal argument to log");
    }
    var filename = getFileName(logger.name);
    var d = new Date();
    var n = d.toUTCString() + "\t" + text;
    debuglog('writing log entry to ' + filename + ' ' + n);
    fs.writeFileSync(filename, n, { encoding: 'utf-8', flag: 'a' });
}
function logger(name, flags) {
    if (flags !== 'a' && flags !== '' && flags !== undefined) {
        throw new Error('only a allowed as flags');
    }
    flags = flags === undefined ? 'a' : flags;
    if (typeof name !== "string" || !/^[A-Za-z][A-Za-z0-9_]+$/.exec(name)) {
        throw new Error('Logger name must be at least two alphanumeric characters');
    }
    if (!loggers[name]) {
        var alogger = {
            name: name,
            flags: flags
        };
        alogger.logIt = logIt.bind(undefined, alogger);
        // reset the file
        if (flags === '') {
            try {
                fs.unlinkSync(getFileName(name));
            } catch (e) {
                debuglog("***ERROR: unable to remove log file " + getFileName(name));
            }
        }
        loggers[name] = alogger;
    }
    if (loggers[name].flags !== flags) {
        throw new Error('FLags mismatch in logger' + name);
    }
    return loggers[name].logIt;
}
exports.logger = logger;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy91dGlscy9sb2dnZXIudHMiLCJ1dGlscy9sb2dnZXIuanMiXSwibmFtZXMiOlsiZGVidWciLCJyZXF1aXJlIiwiZGVidWdsb2ciLCJwZXJmcyIsImxvZ1BlcmYiLCJzU3RyaW5nIiwibGFiZWwiLCJuYW1lIiwiY29uc29sZSIsImxvZyIsImZpcnN0IiwiRGF0ZSIsIm5vdyIsIm9uIiwidGltZUVuZCIsInRpbWUiLCJwZXJmIiwic3RyaW5nIiwiZW5hYmxlZCIsImxhc3QiLCJiaW5kIiwiZXhwb3J0cyIsImZzIiwibG9nZ2VycyIsImdldEZpbGVOYW1lIiwiX3Rlc3QiLCJsb2dJdCIsImxvZ2dlciIsImFyZyIsInRleHQiLCJFcnJvciIsIm1lc3NhZ2UiLCJzdGFjayIsImZpbGVuYW1lIiwiZCIsIm4iLCJ0b1VUQ1N0cmluZyIsIndyaXRlRmlsZVN5bmMiLCJlbmNvZGluZyIsImZsYWciLCJmbGFncyIsInVuZGVmaW5lZCIsImV4ZWMiLCJhbG9nZ2VyIiwidW5saW5rU3luYyIsImUiXSwibWFwcGluZ3MiOiJBQUVBOzs7Ozs7QUNJQTtBREdBOztBQUVBLElBQVlBLFFBQUtDLFFBQU0sT0FBTixDQUFqQjtBQUVBLElBQU1DLFdBQVdGLE1BQU0sUUFBTixDQUFqQjtBQU1DO0FBR0QsSUFBSUcsUUFBUSxFQUFaO0FBR0EsU0FBQUMsT0FBQSxDQUFpQkMsT0FBakIsRUFBd0I7QUFDdEIsUUFBRyxDQUFDLElBQUosRUFBVTtBQUNSO0FBQ0Q7QUFDRCxRQUFJQyxRQUFRLFNBQVMsS0FBS0MsSUFBMUI7QUFDQUMsWUFBUUMsR0FBUixDQUFZLFNBQVMsS0FBS0YsSUFBMUI7QUFDQSxRQUFHLEtBQUtHLEtBQUwsS0FBZSxDQUFsQixFQUFxQjtBQUNqQixhQUFLQSxLQUFMLEdBQWFDLEtBQUtDLEdBQUwsRUFBYjtBQUNILEtBRkQsTUFFTztBQUNMSixnQkFBUUMsR0FBUixDQUFZLFNBQVMsS0FBS0YsSUFBZCxHQUFxQixTQUFyQixJQUFrQ0ksS0FBS0MsR0FB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QUFJO0FBQ0ZsQixtQkFBR3NCLFVBQUgsQ0FBY3BCLFlBQVlqQixJQUFaLENBQWQ7QUFDQSxhQUZGLENBRUUsT0FBT3NDLENBQVAsRUFBVTtBQUNWM0MseUJBQVMseUNBQXlDc0IsWUFBWWpCLElBQVosQ0FBbEQ7QUFDRDtBQUNGO0FBQ0RnQixnQkFBUWhCLElBQVIsSUFBZ0JvQyxPQUFoQjtBQUNEO0FBQ0QsUUFBSXBCLFFBQVFoQixJQUFSLEVBQWNpQyxLQUFkLEtBQXdCQSxLQUE1QixFQUFtQztBQUNqQyxjQUFNLElBQUlWLEtBQUosQ0FBVSw2QkFBNkJ2QixJQUF2QyxDQUFOO0FBQ0Q7QUFDRCxXQUFPZ0IsUUFBUWhCLElBQVIsRUFBY21CLEtBQXJCO0FBQ0Q7QUE1QmVMLFFBQUFNLE1BQUEsR0FBTUEsTUFBTiIsImZpbGUiOiJ1dGlscy9sb2dnZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJcblxuLyoqXG4gKiBhIHNpbXBsZSBsb2dnZXIgdXRpbGl0eVxuICpcbiAqXG4gKiBUaGVyZSBhcmUgdHdvIHR5cGVzIG9mIGxvZ3MgKCBhcHBlbmQgYW5kIG92ZXJ3cml0ZSwgZGVmYXVsdCBpcyBhcHBlbmQpXG4gKi9cblxuLy8vIDxyZWZlcmVuY2UgcGF0aD1cIi4uLy4uL2xpYi9ub2RlLTQuZC50c1wiIC8+XG5cbmltcG9ydCAqIGFzIGRlYnVnIGZyb20gJ2RlYnVnJztcblxuY29uc3QgZGVidWdsb2cgPSBkZWJ1ZygnbG9nZ2VyJyk7XG5cbmludGVyZmFjZSBJTG9nZ2VyIHtcbiAgbmFtZTogc3RyaW5nLFxuICBmbGFnczogc3RyaW5nLFxuICBsb2dJdD86IChhbnkpID0+IHZvaWRcbn07XG5cblxudmFyIHBlcmZzID0ge30gYXMge1trZXkgOiBzdHJpbmddIDogeyBuYW1lIDogc3RyaW5nLCBsYXN0OiBudW1iZXIsIGZpcnN0IDogbnVtYmVyLCBvbiA6IHt9fX07XG5cblxuZnVuY3Rpb24gbG9nUGVyZihzU3RyaW5nKSB7XG4gIGlmKCF0aGlzKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIHZhciBsYWJlbCA9ICdwZXJmJyArIHRoaXMubmFtZTtcbiAgY29uc29sZS5sb2coJ1BlcmYnICsgdGhpcy5uYW1lKTtcbiAgaWYodGhpcy5maXJzdCA9PT0gMCkge1xuICAgICAgdGhpcy5maXJzdCA9IERhdGUubm93KCk7XG4gIH0gZWxzZSB7XG4gICAgY29uc29sZS5sb2coJ1BlcmYnICsgdGhpcy5uYW1lICsgJyB0b3RhbCAnICsgKERhdGUubm93KCkgLSB0aGlzLmZpcnN0KSk7XG4gIH1cbiAgaWYoIHRoaXMub25bc1N0cmluZ10pIHtcbiAgICAgY29uc29sZS50aW1lRW5kKHNTdHJpbmcpXG4gICAgIGRlbGV0ZSB0aGlzLm9uW3NTdHJpbmddO1xuICB9IGVsc2Uge1xuICAgICAgY29uc29sZS50aW1lKHNTdHJpbmcpO1xuICAgICAgdGhpcy5vbltzU3RyaW5nXSA9IDE7XG4gIH1cbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHBlcmYoc3RyaW5nKSB7XG4gIGlmIChkZWJ1ZygncGVyZicgKyB0aGlzLm5hbWUpLmVuYWJsZWQgKSB7XG4gICAgcGVyZnNbc3RyaW5nXSA9IHsgbmFtZSA6IHN0cmluZywgbGFzdCA6IDAsIGZpcnN0OiAwLCBvbiA6IHt9IH07XG4gIH1cbiAgcmV0dXJuIGxvZ1BlcmYuYmluZChwZXJmc1tzdHJpbmddKTtcbn1cblxuaW1wb3J0ICogYXMgZnMgZnJvbSAnZnMnO1xuXG52YXIgbG9nZ2VycyA9IHt9IGFzIHsgW2tleTogc3RyaW5nXTogSUxvZ2dlciB9O1xuXG5mdW5jdGlvbiBnZXRGaWxlTmFtZShuYW1lOiBzdHJpbmcpIHtcbiAgcmV0dXJuICcuL2xvZ3MvJyArIG5hbWUgKyBcIi5sb2dcIjtcbn1cblxuZXhwb3J0IGNvbnN0IF90ZXN0ID0ge1xuICBnZXRGaWxlTmFtZTogZ2V0RmlsZU5hbWVcbn07XG5cbmZ1bmN0aW9uIGxvZ0l0KGxvZ2dlcjogSUxvZ2dlciwgYXJnKSB7XG4gIHZhciB0ZXh0OiBzdHJpbmc7XG4gIGlmICh0eXBlb2YgYXJnID09PSBcInN0cmluZ1wiKSB7XG4gICAgdGV4dCA9IGFyZztcbiAgfSBlbHNlIGlmIChhcmcgaW5zdGFuY2VvZiBFcnJvcikge1xuICAgIHRleHQgPSBcIkVycm9yOlwiICsgYXJnLm1lc3NhZ2UgKyBcIiBcIiArIGFyZy5zdGFjaztcbiAgfVxuICBpZiAoIXRleHQpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbGxlZ2FsIGFyZ3VtZW50IHRvIGxvZ1wiKTtcbiAgfVxuICB2YXIgZmlsZW5hbWUgPSBnZXRGaWxlTmFtZShsb2dnZXIubmFtZSk7XG4gIHZhciBkID0gbmV3IERhdGUoKTtcbiAgdmFyIG4gPSBkLnRvVVRDU3RyaW5nKCkgKyBcIlxcdFwiICsgdGV4dDtcbiAgZGVidWdsb2coJ3dyaXRpbmcgbG9nIGVudHJ5IHRvICcgKyBmaWxlbmFtZSArICcgJyArIG4pO1xuICBmcy53cml0ZUZpbGVTeW5jKGZpbGVuYW1lLCBuLCB7IGVuY29kaW5nOiAndXRmLTgnLCBmbGFnOiAnYScgfSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBsb2dnZXIobmFtZTogc3RyaW5nLCBmbGFncz86IHN0cmluZyk6IChhbnkpID0+IHZvaWQge1xuICBpZiAoZmxhZ3MgIT09ICdhJyAmJiBmbGFncyAhPT0gJycgJiYgZmxhZ3MgIT09IHVuZGVmaW5lZCkge1xuICAgIHRocm93IG5ldyBFcnJvcignb25seSBhIGFsbG93ZWQgYXMgZmxhZ3MnKTtcbiAgfVxuICBmbGFncyA9IChmbGFncyA9PT0gdW5kZWZpbmVkICk/ICAnYScgOiBmbGFncztcbiAgaWYgKHR5cGVvZiBuYW1lICE9PSBcInN0cmluZ1wiIHx8ICEvXltBLVphLXpdW0EtWmEtejAtOV9dKyQvLmV4ZWMobmFtZSkpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0xvZ2dlciBuYW1lIG11c3QgYmUgYXQgbGVhc3QgdHdvIGFscGhhbnVtZXJpYyBjaGFyYWN0ZXJzJylcbiAgfVxuICBpZiAoIWxvZ2dlcnNbbmFtZV0pIHtcbiAgICB2YXIgYWxvZ2dlciA9IHtcbiAgICAgIG5hbWU6IG5hbWUsXG4gICAgICBmbGFnczogZmxhZ3NcbiAgICB9IGFzIElMb2dnZXI7XG4gICAgYWxvZ2dlci5sb2dJdCA9IGxvZ0l0LmJpbmQodW5kZWZpbmVkLCBhbG9nZ2VyKTtcbiAgICAvLyByZXNldCB0aGUgZmlsZVxuICAgIGlmIChmbGFncyA9PT0gJycpIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGZzLnVubGlua1N5bmMoZ2V0RmlsZU5hbWUobmFtZSkpO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBkZWJ1Z2xvZyhcIioqKkVSUk9SOiB1bmFibGUgdG8gcmVtb3ZlIGxvZyBmaWxlIFwiICsgZ2V0RmlsZU5hbWUobmFtZSkpO1xuICAgICAgfVxuICAgIH1cbiAgICBsb2dnZXJzW25hbWVdID0gYWxvZ2dlcjtcbiAgfVxuICBpZiAobG9nZ2Vyc1tuYW1lXS5mbGFncyAhPT0gZmxhZ3MpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0ZMYWdzIG1pc21hdGNoIGluIGxvZ2dlcicgKyBuYW1lKTtcbiAgfVxuICByZXR1cm4gbG9nZ2Vyc1tuYW1lXS5sb2dJdDtcbn0iLCIvKipcbiAqIGEgc2ltcGxlIGxvZ2dlciB1dGlsaXR5XG4gKlxuICpcbiAqIFRoZXJlIGFyZSB0d28gdHlwZXMgb2YgbG9ncyAoIGFwcGVuZCBhbmQgb3ZlcndyaXRlLCBkZWZhdWx0IGlzIGFwcGVuZClcbiAqL1xuXCJ1c2Ugc3RyaWN0XCI7XG4vLy8gPHJlZmVyZW5jZSBwYXRoPVwiLi4vLi4vbGliL25vZGUtNC5kLnRzXCIgLz5cbnZhciBkZWJ1ZyA9IHJlcXVpcmUoJ2RlYnVnJyk7XG52YXIgZGVidWdsb2cgPSBkZWJ1ZygnbG9nZ2VyJyk7XG47XG52YXIgcGVyZnMgPSB7fTtcbmZ1bmN0aW9uIGxvZ1BlcmYoc1N0cmluZykge1xuICAgIGlmICghdGhpcykge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIHZhciBsYWJlbCA9ICdwZXJmJyArIHRoaXMubmFtZTtcbiAgICBjb25zb2xlLmxvZygnUGVyZicgKyB0aGlzLm5hbWUpO1xuICAgIGlmICh0aGlzLmZpcnN0ID09PSAwKSB7XG4gICAgICAgIHRoaXMuZmlyc3QgPSBEYXRlLm5vdygpO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgY29uc29sZS5sb2coJ1BlcmYnICsgdGhpcy5uYW1lICsgJyB0b3RhbCAnICsgKERhdGUubm93KCkgLSB0aGlzLmZpcnN0KSk7XG4gICAgfVxuICAgIGlmICh0aGlzLm9uW3NTdHJpbmddKSB7XG4gICAgICAgIGNvbnNvbGUudGltZUVuZChzU3RyaW5nKTtcbiAgICAgICAgZGVsZXRlIHRoaXMub25bc1N0cmluZ107XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBjb25zb2xlLnRpbWUoc1N0cmluZyk7XG4gICAgICAgIHRoaXMub25bc1N0cmluZ10gPSAxO1xuICAgIH1cbn1cbmZ1bmN0aW9uIHBlcmYoc3RyaW5nKSB7XG4gICAgaWYgKGRlYnVnKCdwZXJmJyArIHRoaXMubmFtZSkuZW5hYmxlZCkge1xuICAgICAgICBwZXJmc1tzdHJpbmddID0geyBuYW1lOiBzdHJpbmcsIGxhc3Q6IDAsIGZpcnN0OiAwLCBvbjoge30gfTtcbiAgICB9XG4gICAgcmV0dXJuIGxvZ1BlcmYuYmluZChwZXJmc1tzdHJpbmddKTtcbn1cbmV4cG9ydHMucGVyZiA9IHBlcmY7XG52YXIgZnMgPSByZXF1aXJlKCdmcycpO1xudmFyIGxvZ2dlcnMgPSB7fTtcbmZ1bmN0aW9uIGdldEZpbGVOYW1lKG5hbWUpIHtcbiAgICByZXR1cm4gJy4vbG9ncy8nICsgbmFtZSArIFwiLmxvZ1wiO1xufVxuZXhwb3J0cy5fdGVzdCA9IHtcbiAgICBnZXRGaWxlTmFtZTogZ2V0RmlsZU5hbWVcbn07XG5mdW5jdGlvbiBsb2dJdChsb2dnZXIsIGFyZykge1xuICAgIHZhciB0ZXh0O1xuICAgIGlmICh0eXBlb2YgYXJnID09PSBcInN0cmluZ1wiKSB7XG4gICAgICAgIHRleHQgPSBhcmc7XG4gICAgfVxuICAgIGVsc2UgaWYgKGFyZyBpbnN0YW5jZW9mIEVycm9yKSB7XG4gICAgICAgIHRleHQgPSBcIkVycm9yOlwiICsgYXJnLm1lc3NhZ2UgKyBcIiBcIiArIGFyZy5zdGFjaztcbiAgICB9XG4gICAgaWYgKCF0ZXh0KSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIklsbGVnYWwgYXJndW1lbnQgdG8gbG9nXCIpO1xuICAgIH1cbiAgICB2YXIgZmlsZW5hbWUgPSBnZXRGaWxlTmFtZShsb2dnZXIubmFtZSk7XG4gICAgdmFyIGQgPSBuZXcgRGF0ZSgpO1xuICAgIHZhciBuID0gZC50b1VUQ1N0cmluZygpICsgXCJcXHRcIiArIHRleHQ7XG4gICAgZGVidWdsb2coJ3dyaXRpbmcgbG9nIGVudHJ5IHRvICcgKyBmaWxlbmFtZSArICcgJyArIG4pO1xuICAgIGZzLndyaXRlRmlsZVN5bmMoZmlsZW5hbWUsIG4sIHsgZW5jb2Rpbmc6ICd1dGYtOCcsIGZsYWc6ICdhJyB9KTtcbn1cbmZ1bmN0aW9uIGxvZ2dlcihuYW1lLCBmbGFncykge1xuICAgIGlmIChmbGFncyAhPT0gJ2EnICYmIGZsYWdzICE9PSAnJyAmJiBmbGFncyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignb25seSBhIGFsbG93ZWQgYXMgZmxhZ3MnKTtcbiAgICB9XG4gICAgZmxhZ3MgPSAoZmxhZ3MgPT09IHVuZGVmaW5lZCkgPyAnYScgOiBmbGFncztcbiAgICBpZiAodHlwZW9mIG5hbWUgIT09IFwic3RyaW5nXCIgfHwgIS9eW0EtWmEtel1bQS1aYS16MC05X10rJC8uZXhlYyhuYW1lKSkge1xuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0xvZ2dlciBuYW1lIG11c3QgYmUgYXQgbGVhc3QgdHdvIGFscGhhbnVtZXJpYyBjaGFyYWN0ZXJzJyk7XG4gICAgfVxuICAgIGlmICghbG9nZ2Vyc1tuYW1lXSkge1xuICAgICAgICB2YXIgYWxvZ2dlciA9IHtcbiAgICAgICAgICAgIG5hbWU6IG5hbWUsXG4gICAgICAgICAgICBmbGFnczogZmxhZ3NcbiAgICAgICAgfTtcbiAgICAgICAgYWxvZ2dlci5sb2dJdCA9IGxvZ0l0LmJpbmQodW5kZWZpbmVkLCBhbG9nZ2VyKTtcbiAgICAgICAgLy8gcmVzZXQgdGhlIGZpbGVcbiAgICAgICAgaWYgKGZsYWdzID09PSAnJykge1xuICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgICBmcy51bmxpbmtTeW5jKGdldEZpbGVOYW1lKG5hbWUpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgZGVidWdsb2coXCIqKipFUlJPUjogdW5hYmxlIHRvIHJlbW92ZSBsb2cgZmlsZSBcIiArIGdldEZpbGVOYW1lKG5hbWUpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgICBsb2dnZXJzW25hbWVdID0gYWxvZ2dlcjtcbiAgICB9XG4gICAgaWYgKGxvZ2dlcnNbbmFtZV0uZmxhZ3MgIT09IGZsYWdzKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignRkxhZ3MgbWlzbWF0Y2ggaW4gbG9nZ2VyJyArIG5hbWUpO1xuICAgIH1cbiAgICByZXR1cm4gbG9nZ2Vyc1tuYW1lXS5sb2dJdDtcbn1cbmV4cG9ydHMubG9nZ2VyID0gbG9nZ2VyO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
