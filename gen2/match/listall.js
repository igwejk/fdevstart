/**
 *
 * @module jfseb.fdevstart.analyze
 * @file analyze.ts
 * @copyright (c) 2016 Gerd Forstmann
 */
"use strict";

var InputFilter = require('./inputFilter');
var debug = require('debug');
var debuglog = debug('whatis');
var Sentence = require('./sentence');
var WhatIs = require('./whatis');
function matchRecordHavingCategory(category, records) {
    debuglog(JSON.stringify(records, undefined, 2));
    var relevantRecords = records.filter(function (record) {
        return record[category] !== undefined && record[category] !== null;
    });
    var res = [];
    debuglog("relevant records nr:" + relevantRecords.length);
    return relevantRecords;
}
exports.matchRecordHavingCategory = matchRecordHavingCategory;
// const result = WhatIs.resolveCategory(cat, a1.entity,
//   theModel.mRules, theModel.tools, theModel.records);
function listAllWithContext(category, contextQueryString, aRules, records) {
    if (contextQueryString.length === 0) {
        return [];
    } else {
        var matched = InputFilter.analyzeString(contextQueryString, aRules);
        debuglog("After matched " + JSON.stringify(matched));
        var aSentences = InputFilter.expandMatchArr(matched);
        debuglog("after expand" + aSentences.map(function (oSentence) {
            return Sentence.rankingProduct(oSentence) + ":" + JSON.stringify(oSentence);
        }).join("\n"));
        var aSentencesReinforced = InputFilter.reinForce(aSentences);
        //aSentences.map(function(oSentence) { return InputFilter.reinForce(oSentence); });
        debuglog("after reinforce" + aSentencesReinforced.map(function (oSentence) {
            return Sentence.rankingProduct(oSentence) + ":" + JSON.stringify(oSentence);
        }).join("\n"));
        var matchedAnswers = WhatIs.matchRecords(aSentences, category, records); //aTool: Array<IMatch.ITool>): any /* objectstream*/ {
        debuglog(" matched Answers" + JSON.stringify(matchedAnswers, undefined, 2));
        var matchedFiltered = WhatIs.filterOnlyTopRanked(matchedAnswers);
        debuglog(" matched top-ranked Answers" + JSON.stringify(matchedFiltered, undefined, 2));
        return matchedAnswers;
    }
}
exports.listAllWithContext = listAllWithContext;
function listAllHavingContext(category, contextQueryString, aRules, records) {
    if (contextQueryString.length === 0) {
        return [];
    } else {
        var matched = InputFilter.analyzeString(contextQueryString, aRules);
        debuglog("After matched " + JSON.stringify(matched));
        var aSentences = InputFilter.expandMatchArr(matched);
        debuglog("after expand" + aSentences.map(function (oSentence) {
            return Sentence.rankingProduct(oSentence) + ":" + JSON.stringify(oSentence);
        }).join("\n"));
        var aSentencesReinforced = InputFilter.reinForce(aSentences);
        //aSentences.map(function(oSentence) { return InputFilter.reinForce(oSentence); });
        debuglog("after reinforce" + aSentencesReinforced.map(function (oSentence) {
            return Sentence.rankingProduct(oSentence) + ":" + JSON.stringify(oSentence);
        }).join("\n"));
        var matchedAnswers = WhatIs.matchRecordsHavingContext(aSentences, category, records); //aTool: Array<IMatch.ITool>): any /* objectstream*/ {
        debuglog(" matched Answers" + JSON.stringify(matchedAnswers, undefined, 2));
        var matchedFiltered = WhatIs.filterOnlyTopRanked(matchedAnswers);
        debuglog(" matched top-ranked Answers" + JSON.stringify(matchedFiltered, undefined, 2));
        return matchedFiltered;
    }
}
exports.listAllHavingContext = listAllHavingContext;
function listAllWithCategory(category, records) {
    var matchedAnswers = matchRecordHavingCategory(category, records); //aTool: Array<IMatch.ITool>): any /* objectstream*/ {
    debuglog(" listAllWithCategory:" + JSON.stringify(matchedAnswers, undefined, 2));
    return matchedAnswers;
}
exports.listAllWithCategory = listAllWithCategory;
function joinSortedQuoted(strings) {
    if (strings.length === 0) {
        return "";
    }
    return '"' + strings.sort().join('"; "') + '"';
}
exports.joinSortedQuoted = joinSortedQuoted;
function joinDistinct(category, records) {
    var res = records.reduce(function (prev, oRecord) {
        prev[oRecord[category]] = 1;
        return prev;
    }, {});
    return joinSortedQuoted(Object.keys(res));
}
exports.joinDistinct = joinDistinct;
function formatDistinctFromWhatIfResult(answers) {
    return joinSortedQuoted(answers.map(function (oAnswer) {
        return oAnswer.result;
    }));
}
exports.formatDistinctFromWhatIfResult = formatDistinctFromWhatIfResult;
function joinResults(results) {
    var res = [];
    var cnt = results.reduce(function (prev, result) {
        if (result._ranking === results[0]._ranking) {
            if (res.indexOf(result.result) < 0) {
                res.push(result.result);
            }
            return prev + 1;
        }
    }, 0);
    return res;
}
exports.joinResults = joinResults;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9tYXRjaC9saXN0YWxsLnRzIiwibWF0Y2gvbGlzdGFsbC5qcyJdLCJuYW1lcyI6WyJJbnB1dEZpbHRlciIsInJlcXVpcmUiLCJkZWJ1ZyIsImRlYnVnbG9nIiwiU2VudGVuY2UiLCJXaGF0SXMiLCJtYXRjaFJlY29yZEhhdmluZ0NhdGVnb3J5IiwiY2F0ZWdvcnkiLCJyZWNvcmRzIiwiSlNPTiIsInN0cmluZ2lmeSIsInVuZGVmaW5lZCIsInJlbGV2YW50UmVjb3JkcyIsImZpbHRlciIsInJlY29yZCIsInJlcyIsImxlbmd0aCIsImV4cG9ydHMiLCJsaXN0QWxsV2l0aENvbnRleHQiLCJjb250ZXh0UXVlcnlTdHJpbmciLCJhUnVsZXMiLCJtYXRjaGVkIiwiYW5hbHl6ZVN0cmluZyIsImFTZW50ZW5jZXMiLCJleHBhbmRNYXRjaEFyciIsIm1hcCIsIm9TZW50ZW5jZSIsInJhbmtpbmdQcm9kdWN0Iiwiam9pbiIsImFTZW50ZW5jZXNSZWluZm9yY2VkIiwicmVpbkZvcmNlIiwibWF0Y2hlZEFuc3dlcnMiLCJtYXRjaFJlY29yZHMiLCJtYXRjaGVkRmlsdGVyZWQiLCJmaWx0ZXJPbmx5VG9wUmFua2VkIiwibGlzdEFsbEhhdmluZ0NvbnRleHQiLCJtYXRjaFJlY29yZHNIYXZpbmdDb250ZXh0IiwibGlzdEFsbFdpdGhDYXRlZ29yeSIsImpvaW5Tb3J0ZWRRdW90ZWQiLCJzdHJpbmdzIiwic29ydCIsImpvaW5EaXN0aW5jdCIsInJlZHVjZSIsInByZXYiLCJvUmVjb3JkIiwiT2JqZWN0Iiwia2V5cyIsImZvcm1hdERpc3RpbmN0RnJvbVdoYXRJZlJlc3VsdCIsImFuc3dlcnMiLCJvQW5zd2VyIiwicmVzdWx0Iiwiam9pblJlc3VsdHMiLCJyZXN1bHRzIiwiY250IiwiX3JhbmtpbmciLCJpbmRleE9mIiwicHVzaCJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7OztBQ01BOztBREVBLElBQVlBLGNBQVdDLFFBQU0sZUFBTixDQUF2QjtBQUVBLElBQVlDLFFB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QUFBSSxXQUFBLENBQTRCQyxPQUE1QixFQUFnRTtBQUM5RCxRQUFJckMsTUFBTyxFQUFYO0FBQ0EsUUFBSXNDLE1BQU1ELFFBQVFWLE1BQVIsQ0FBZSxVQUFVQyxJQUFWLEVBQWdCTyxNQUFoQixFQUFzQjtBQUM3QyxZQUFJQSxPQUFPSSxRQUFQLEtBQW9CRixRQUFRLENBQVIsRUFBV0UsUUFBbkMsRUFBNkM7QUFDM0MsZ0JBQUd2QyxJQUFJd0MsT0FBSixDQUFZTCxPQUFPQSxNQUFuQixJQUE2QixDQUFoQyxFQUFtQztBQUNqQ25DLG9CQUFJeUMsSUFBSixDQUFTTixPQUFPQSxNQUFoQjtBQUNEO0FBQ0QsbUJBQU9QLE9BQU8sQ0FBZDtBQUNEO0FBQ0YsS0FQUyxFQU9QLENBUE8sQ0FBVjtBQVFBLFdBQU81QixHQUFQO0FBQ0Q7QUFYZUUsUUFBQWtDLFdBQUEsR0FBV0EsV0FBWCIsImZpbGUiOiJtYXRjaC9saXN0YWxsLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKlxuICogQG1vZHVsZSBqZnNlYi5mZGV2c3RhcnQuYW5hbHl6ZVxuICogQGZpbGUgYW5hbHl6ZS50c1xuICogQGNvcHlyaWdodCAoYykgMjAxNiBHZXJkIEZvcnN0bWFublxuICovXG5cblxuaW1wb3J0ICogYXMgSW5wdXRGaWx0ZXIgZnJvbSAnLi9pbnB1dEZpbHRlcic7XG5cbmltcG9ydCAqIGFzIGRlYnVnIGZyb20gJ2RlYnVnJztcblxuY29uc3QgZGVidWdsb2cgPSBkZWJ1Zygnd2hhdGlzJyk7XG5cbmltcG9ydCAqIGFzIHV0aWxzIGZyb20gJy4uL3V0aWxzL3V0aWxzJztcblxuaW1wb3J0ICogYXMgSU1hdGNoIGZyb20gJy4vaWZtYXRjaCc7XG5cbmltcG9ydCAqIGFzIFRvb2xtYXRjaGVyIGZyb20gJy4vdG9vbG1hdGNoZXInO1xuXG5pbXBvcnQgKiBhcyBTZW50ZW5jZSBmcm9tICcuL3NlbnRlbmNlJztcblxuaW1wb3J0ICogYXMgV29yZCBmcm9tICcuL3dvcmQnO1xuXG5pbXBvcnQgKiBhcyBXaGF0SXMgZnJvbSAnLi93aGF0aXMnO1xuXG5cbmltcG9ydCAqIGFzIE1hdGNoIGZyb20gJy4vbWF0Y2gnO1xuXG5cbmV4cG9ydCBmdW5jdGlvbiBtYXRjaFJlY29yZEhhdmluZ0NhdGVnb3J5KGNhdGVnb3J5OiBzdHJpbmcsIHJlY29yZHM6IEFycmF5PElNYXRjaC5JUmVjb3JkPilcbiAgOiBBcnJheTxJTWF0Y2guSVJlY29yZD4ge1xuICBkZWJ1Z2xvZyhKU09OLnN0cmluZ2lmeShyZWNvcmRzLHVuZGVmaW5lZCwyKSk7XG4gIHZhciByZWxldmFudFJlY29yZHMgPSByZWNvcmRzLmZpbHRlcihmdW5jdGlvbiAocmVjb3JkOiBJTWF0Y2guSVJlY29yZCkge1xuICAgIHJldHVybiAocmVjb3JkW2NhdGVnb3J5XSAhPT0gdW5kZWZpbmVkKSAmJiAocmVjb3JkW2NhdGVnb3J5XSAhPT0gbnVsbCk7XG4gIH0pO1xuICB2YXIgcmVzID0gW107XG4gIGRlYnVnbG9nKFwicmVsZXZhbnQgcmVjb3JkcyBucjpcIiArIHJlbGV2YW50UmVjb3Jkcy5sZW5ndGgpO1xuICByZXR1cm4gcmVsZXZhbnRSZWNvcmRzO1xufVxuXG4vLyBjb25zdCByZXN1bHQgPSBXaGF0SXMucmVzb2x2ZUNhdGVnb3J5KGNhdCwgYTEuZW50aXR5LFxuLy8gICB0aGVNb2RlbC5tUnVsZXMsIHRoZU1vZGVsLnRvb2xzLCB0aGVNb2RlbC5yZWNvcmRzKTtcblxuZXhwb3J0IGZ1bmN0aW9uIGxpc3RBbGxXaXRoQ29udGV4dChjYXRlZ29yeTogc3RyaW5nLCBjb250ZXh0UXVlcnlTdHJpbmc6IHN0cmluZyxcbiAgYVJ1bGVzOiBBcnJheTxJTWF0Y2gubVJ1bGU+LCByZWNvcmRzOiBBcnJheTxJTWF0Y2guSVJlY29yZD4pOiBBcnJheTxJTWF0Y2guSVdoYXRJc0Fuc3dlcj4ge1xuICBpZiAoY29udGV4dFF1ZXJ5U3RyaW5nLmxlbmd0aCA9PT0gMCkge1xuICAgIHJldHVybiBbXTtcbiAgfSBlbHNlIHtcbiAgICB2YXIgbWF0Y2hlZCA9IElucHV0RmlsdGVyLmFuYWx5emVTdHJpbmcoY29udGV4dFF1ZXJ5U3RyaW5nLCBhUnVsZXMpO1xuICAgIGRlYnVnbG9nKFwiQWZ0ZXIgbWF0Y2hlZCBcIiArIEpTT04uc3RyaW5naWZ5KG1hdGNoZWQpKTtcbiAgICB2YXIgYVNlbnRlbmNlcyA9IElucHV0RmlsdGVyLmV4cGFuZE1hdGNoQXJyKG1hdGNoZWQpO1xuICAgIGRlYnVnbG9nKFwiYWZ0ZXIgZXhwYW5kXCIgKyBhU2VudGVuY2VzLm1hcChmdW5jdGlvbiAob1NlbnRlbmNlKSB7XG4gICAgICByZXR1cm4gU2VudGVuY2UucmFua2luZ1Byb2R1Y3Qob1NlbnRlbmNlKSArIFwiOlwiICsgSlNPTi5zdHJpbmdpZnkob1NlbnRlbmNlKTtcbiAgICB9KS5qb2luKFwiXFxuXCIpKTtcbiAgICB2YXIgYVNlbnRlbmNlc1JlaW5mb3JjZWQgPSBJbnB1dEZpbHRlci5yZWluRm9yY2UoYVNlbnRlbmNlcyk7XG4gICAgLy9hU2VudGVuY2VzLm1hcChmdW5jdGlvbihvU2VudGVuY2UpIHsgcmV0dXJuIElucHV0RmlsdGVyLnJlaW5Gb3JjZShvU2VudGVuY2UpOyB9KTtcbiAgICBkZWJ1Z2xvZyhcImFmdGVyIHJlaW5mb3JjZVwiICsgYVNlbnRlbmNlc1JlaW5mb3JjZWQubWFwKGZ1bmN0aW9uIChvU2VudGVuY2UpIHtcbiAgICAgIHJldHVybiBTZW50ZW5jZS5yYW5raW5nUHJvZHVjdChvU2VudGVuY2UpICsgXCI6XCIgKyBKU09OLnN0cmluZ2lmeShvU2VudGVuY2UpO1xuICAgIH0pLmpvaW4oXCJcXG5cIikpO1xuICAgIHZhciBtYXRjaGVkQW5zd2VycyA9IFdoYXRJcy5tYXRjaFJlY29yZHMoYVNlbnRlbmNlcywgY2F0ZWdvcnksIHJlY29yZHMpOyAvL2FUb29sOiBBcnJheTxJTWF0Y2guSVRvb2w+KTogYW55IC8qIG9iamVjdHN0cmVhbSovIHtcblxuICAgIGRlYnVnbG9nKFwiIG1hdGNoZWQgQW5zd2Vyc1wiICsgSlNPTi5zdHJpbmdpZnkobWF0Y2hlZEFuc3dlcnMsIHVuZGVmaW5lZCwgMikpO1xuICAgIHZhciBtYXRjaGVkRmlsdGVyZWQgPSBXaGF0SXMuZmlsdGVyT25seVRvcFJhbmtlZChtYXRjaGVkQW5zd2Vycyk7XG4gICAgZGVidWdsb2coXCIgbWF0Y2hlZCB0b3AtcmFua2VkIEFuc3dlcnNcIiArIEpTT04uc3RyaW5naWZ5KG1hdGNoZWRGaWx0ZXJlZCwgdW5kZWZpbmVkLCAyKSk7XG5cbiAgICByZXR1cm4gbWF0Y2hlZEFuc3dlcnM7XG4gIH1cbn1cblxuXG5leHBvcnQgZnVuY3Rpb24gbGlzdEFsbEhhdmluZ0NvbnRleHQoY2F0ZWdvcnk6IHN0cmluZywgY29udGV4dFF1ZXJ5U3RyaW5nOiBzdHJpbmcsXG4gIGFSdWxlczogQXJyYXk8SU1hdGNoLm1SdWxlPiwgcmVjb3JkczogQXJyYXk8SU1hdGNoLklSZWNvcmQ+KTogQXJyYXk8SU1hdGNoLklXaGF0SXNBbnN3ZXI+IHtcbiAgaWYgKGNvbnRleHRRdWVyeVN0cmluZy5sZW5ndGggPT09IDApIHtcbiAgICByZXR1cm4gW107XG4gIH0gZWxzZSB7XG4gICAgdmFyIG1hdGNoZWQgPSBJbnB1dEZpbHRlci5hbmFseXplU3RyaW5nKGNvbnRleHRRdWVyeVN0cmluZywgYVJ1bGVzKTtcbiAgICBkZWJ1Z2xvZyhcIkFmdGVyIG1hdGNoZWQgXCIgKyBKU09OLnN0cmluZ2lmeShtYXRjaGVkKSk7XG4gICAgdmFyIGFTZW50ZW5jZXMgPSBJbnB1dEZpbHRlci5leHBhbmRNYXRjaEFycihtYXRjaGVkKTtcbiAgICBkZWJ1Z2xvZyhcImFmdGVyIGV4cGFuZFwiICsgYVNlbnRlbmNlcy5tYXAoZnVuY3Rpb24gKG9TZW50ZW5jZSkge1xuICAgICAgcmV0dXJuIFNlbnRlbmNlLnJhbmtpbmdQcm9kdWN0KG9TZW50ZW5jZSkgKyBcIjpcIiArIEpTT04uc3RyaW5naWZ5KG9TZW50ZW5jZSk7XG4gICAgfSkuam9pbihcIlxcblwiKSk7XG4gICAgdmFyIGFTZW50ZW5jZXNSZWluZm9yY2VkID0gSW5wdXRGaWx0ZXIucmVpbkZvcmNlKGFTZW50ZW5jZXMpO1xuICAgIC8vYVNlbnRlbmNlcy5tYXAoZnVuY3Rpb24ob1NlbnRlbmNlKSB7IHJldHVybiBJbnB1dEZpbHRlci5yZWluRm9yY2Uob1NlbnRlbmNlKTsgfSk7XG4gICAgZGVidWdsb2coXCJhZnRlciByZWluZm9yY2VcIiArIGFTZW50ZW5jZXNSZWluZm9yY2VkLm1hcChmdW5jdGlvbiAob1NlbnRlbmNlKSB7XG4gICAgICByZXR1cm4gU2VudGVuY2UucmFua2luZ1Byb2R1Y3Qob1NlbnRlbmNlKSArIFwiOlwiICsgSlNPTi5zdHJpbmdpZnkob1NlbnRlbmNlKTtcbiAgICB9KS5qb2luKFwiXFxuXCIpKTtcbiAgICB2YXIgbWF0Y2hlZEFuc3dlcnMgPSBXaGF0SXMubWF0Y2hSZWNvcmRzSGF2aW5nQ29udGV4dChhU2VudGVuY2VzLCBjYXRlZ29yeSwgcmVjb3Jkcyk7IC8vYVRvb2w6IEFycmF5PElNYXRjaC5JVG9vbD4pOiBhbnkgLyogb2JqZWN0c3RyZWFtKi8ge1xuICAgIGRlYnVnbG9nKFwiIG1hdGNoZWQgQW5zd2Vyc1wiICsgSlNPTi5zdHJpbmdpZnkobWF0Y2hlZEFuc3dlcnMsIHVuZGVmaW5lZCwgMikpO1xuICAgIHZhciBtYXRjaGVkRmlsdGVyZWQgPSBXaGF0SXMuZmlsdGVyT25seVRvcFJhbmtlZChtYXRjaGVkQW5zd2Vycyk7XG4gICAgZGVidWdsb2coXCIgbWF0Y2hlZCB0b3AtcmFua2VkIEFuc3dlcnNcIiArIEpTT04uc3RyaW5naWZ5KG1hdGNoZWRGaWx0ZXJlZCwgdW5kZWZpbmVkLCAyKSk7XG5cbiAgICByZXR1cm4gbWF0Y2hlZEZpbHRlcmVkO1xuICB9XG59XG5cblxuXG5cbmV4cG9ydCBmdW5jdGlvbiBsaXN0QWxsV2l0aENhdGVnb3J5KGNhdGVnb3J5OiBzdHJpbmcsIHJlY29yZHM6IEFycmF5PElNYXRjaC5JUmVjb3JkPik6IEFycmF5PElNYXRjaC5JUmVjb3JkPiB7XG4gIHZhciBtYXRjaGVkQW5zd2VycyA9IG1hdGNoUmVjb3JkSGF2aW5nQ2F0ZWdvcnkoY2F0ZWdvcnksIHJlY29yZHMpOyAvL2FUb29sOiBBcnJheTxJTWF0Y2guSVRvb2w+KTogYW55IC8qIG9iamVjdHN0cmVhbSovIHtcbiAgZGVidWdsb2coXCIgbGlzdEFsbFdpdGhDYXRlZ29yeTpcIiArIEpTT04uc3RyaW5naWZ5KG1hdGNoZWRBbnN3ZXJzLCB1bmRlZmluZWQsIDIpKTtcblxuICByZXR1cm4gbWF0Y2hlZEFuc3dlcnM7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBqb2luU29ydGVkUXVvdGVkKHN0cmluZ3MgOiBzdHJpbmdbXSApIDogc3RyaW5nIHtcbiAgaWYgKHN0cmluZ3MubGVuZ3RoID09PSAwKSB7XG4gICAgcmV0dXJuIFwiXCI7XG4gIH1cbiAgcmV0dXJuICdcIicgKyBzdHJpbmdzLnNvcnQoKS5qb2luKCdcIjsgXCInKSArICdcIic7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBqb2luRGlzdGluY3QoY2F0ZWdvcnkgOiBzdHJpbmcsIHJlY29yZHMgOiBBcnJheTxJTWF0Y2guSVJlY29yZD4pIDogc3RyaW5nIHtcbiAgdmFyIHJlcyA9IHJlY29yZHMucmVkdWNlKGZ1bmN0aW9uKHByZXYsIG9SZWNvcmQpIHtcbiAgICBwcmV2W29SZWNvcmRbY2F0ZWdvcnldXSA9IDE7XG4gICAgcmV0dXJuIHByZXY7XG4gIH0se30gYXMgYW55KTtcbiAgcmV0dXJuIGpvaW5Tb3J0ZWRRdW90ZWQoT2JqZWN0LmtleXMocmVzKSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBmb3JtYXREaXN0aW5jdEZyb21XaGF0SWZSZXN1bHQoIGFuc3dlcnMgOiBBcnJheTxJTWF0Y2guSVdoYXRJc0Fuc3dlcj4pIDogc3RyaW5nIHtcbiAgcmV0dXJuIGpvaW5Tb3J0ZWRRdW90ZWQoYW5zd2Vycy5tYXAoZnVuY3Rpb24ob0Fuc3dlcikge1xuICAgIHJldHVybiBvQW5zd2VyLnJlc3VsdDtcbiAgfSkpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gam9pblJlc3VsdHMocmVzdWx0czogQXJyYXk8SU1hdGNoLklXaGF0SXNBbnN3ZXI+KTogc3RyaW5nW10ge1xuICB2YXIgcmVzICA9IFtdO1xuICB2YXIgY250ID0gcmVzdWx0cy5yZWR1Y2UoZnVuY3Rpb24gKHByZXYsIHJlc3VsdCkge1xuICAgIGlmIChyZXN1bHQuX3JhbmtpbmcgPT09IHJlc3VsdHNbMF0uX3JhbmtpbmcpIHtcbiAgICAgIGlmKHJlcy5pbmRleE9mKHJlc3VsdC5yZXN1bHQpIDwgMCApe1xuICAgICAgICByZXMucHVzaChyZXN1bHQucmVzdWx0KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBwcmV2ICsgMTtcbiAgICB9XG4gIH0sIDApO1xuICByZXR1cm4gcmVzO1xufVxuIiwiLyoqXG4gKlxuICogQG1vZHVsZSBqZnNlYi5mZGV2c3RhcnQuYW5hbHl6ZVxuICogQGZpbGUgYW5hbHl6ZS50c1xuICogQGNvcHlyaWdodCAoYykgMjAxNiBHZXJkIEZvcnN0bWFublxuICovXG5cInVzZSBzdHJpY3RcIjtcbnZhciBJbnB1dEZpbHRlciA9IHJlcXVpcmUoJy4vaW5wdXRGaWx0ZXInKTtcbnZhciBkZWJ1ZyA9IHJlcXVpcmUoJ2RlYnVnJyk7XG52YXIgZGVidWdsb2cgPSBkZWJ1Zygnd2hhdGlzJyk7XG52YXIgU2VudGVuY2UgPSByZXF1aXJlKCcuL3NlbnRlbmNlJyk7XG52YXIgV2hhdElzID0gcmVxdWlyZSgnLi93aGF0aXMnKTtcbmZ1bmN0aW9uIG1hdGNoUmVjb3JkSGF2aW5nQ2F0ZWdvcnkoY2F0ZWdvcnksIHJlY29yZHMpIHtcbiAgICBkZWJ1Z2xvZyhKU09OLnN0cmluZ2lmeShyZWNvcmRzLCB1bmRlZmluZWQsIDIpKTtcbiAgICB2YXIgcmVsZXZhbnRSZWNvcmRzID0gcmVjb3Jkcy5maWx0ZXIoZnVuY3Rpb24gKHJlY29yZCkge1xuICAgICAgICByZXR1cm4gKHJlY29yZFtjYXRlZ29yeV0gIT09IHVuZGVmaW5lZCkgJiYgKHJlY29yZFtjYXRlZ29yeV0gIT09IG51bGwpO1xuICAgIH0pO1xuICAgIHZhciByZXMgPSBbXTtcbiAgICBkZWJ1Z2xvZyhcInJlbGV2YW50IHJlY29yZHMgbnI6XCIgKyByZWxldmFudFJlY29yZHMubGVuZ3RoKTtcbiAgICByZXR1cm4gcmVsZXZhbnRSZWNvcmRzO1xufVxuZXhwb3J0cy5tYXRjaFJlY29yZEhhdmluZ0NhdGVnb3J5ID0gbWF0Y2hSZWNvcmRIYXZpbmdDYXRlZ29yeTtcbi8vIGNvbnN0IHJlc3VsdCA9IFdoYXRJcy5yZXNvbHZlQ2F0ZWdvcnkoY2F0LCBhMS5lbnRpdHksXG4vLyAgIHRoZU1vZGVsLm1SdWxlcywgdGhlTW9kZWwudG9vbHMsIHRoZU1vZGVsLnJlY29yZHMpO1xuZnVuY3Rpb24gbGlzdEFsbFdpdGhDb250ZXh0KGNhdGVnb3J5LCBjb250ZXh0UXVlcnlTdHJpbmcsIGFSdWxlcywgcmVjb3Jkcykge1xuICAgIGlmIChjb250ZXh0UXVlcnlTdHJpbmcubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHZhciBtYXRjaGVkID0gSW5wdXRGaWx0ZXIuYW5hbHl6ZVN0cmluZyhjb250ZXh0UXVlcnlTdHJpbmcsIGFSdWxlcyk7XG4gICAgICAgIGRlYnVnbG9nKFwiQWZ0ZXIgbWF0Y2hlZCBcIiArIEpTT04uc3RyaW5naWZ5KG1hdGNoZWQpKTtcbiAgICAgICAgdmFyIGFTZW50ZW5jZXMgPSBJbnB1dEZpbHRlci5leHBhbmRNYXRjaEFycihtYXRjaGVkKTtcbiAgICAgICAgZGVidWdsb2coXCJhZnRlciBleHBhbmRcIiArIGFTZW50ZW5jZXMubWFwKGZ1bmN0aW9uIChvU2VudGVuY2UpIHtcbiAgICAgICAgICAgIHJldHVybiBTZW50ZW5jZS5yYW5raW5nUHJvZHVjdChvU2VudGVuY2UpICsgXCI6XCIgKyBKU09OLnN0cmluZ2lmeShvU2VudGVuY2UpO1xuICAgICAgICB9KS5qb2luKFwiXFxuXCIpKTtcbiAgICAgICAgdmFyIGFTZW50ZW5jZXNSZWluZm9yY2VkID0gSW5wdXRGaWx0ZXIucmVpbkZvcmNlKGFTZW50ZW5jZXMpO1xuICAgICAgICAvL2FTZW50ZW5jZXMubWFwKGZ1bmN0aW9uKG9TZW50ZW5jZSkgeyByZXR1cm4gSW5wdXRGaWx0ZXIucmVpbkZvcmNlKG9TZW50ZW5jZSk7IH0pO1xuICAgICAgICBkZWJ1Z2xvZyhcImFmdGVyIHJlaW5mb3JjZVwiICsgYVNlbnRlbmNlc1JlaW5mb3JjZWQubWFwKGZ1bmN0aW9uIChvU2VudGVuY2UpIHtcbiAgICAgICAgICAgIHJldHVybiBTZW50ZW5jZS5yYW5raW5nUHJvZHVjdChvU2VudGVuY2UpICsgXCI6XCIgKyBKU09OLnN0cmluZ2lmeShvU2VudGVuY2UpO1xuICAgICAgICB9KS5qb2luKFwiXFxuXCIpKTtcbiAgICAgICAgdmFyIG1hdGNoZWRBbnN3ZXJzID0gV2hhdElzLm1hdGNoUmVjb3JkcyhhU2VudGVuY2VzLCBjYXRlZ29yeSwgcmVjb3Jkcyk7IC8vYVRvb2w6IEFycmF5PElNYXRjaC5JVG9vbD4pOiBhbnkgLyogb2JqZWN0c3RyZWFtKi8ge1xuICAgICAgICBkZWJ1Z2xvZyhcIiBtYXRjaGVkIEFuc3dlcnNcIiArIEpTT04uc3RyaW5naWZ5KG1hdGNoZWRBbnN3ZXJzLCB1bmRlZmluZWQsIDIpKTtcbiAgICAgICAgdmFyIG1hdGNoZWRGaWx0ZXJlZCA9IFdoYXRJcy5maWx0ZXJPbmx5VG9wUmFua2VkKG1hdGNoZWRBbnN3ZXJzKTtcbiAgICAgICAgZGVidWdsb2coXCIgbWF0Y2hlZCB0b3AtcmFua2VkIEFuc3dlcnNcIiArIEpTT04uc3RyaW5naWZ5KG1hdGNoZWRGaWx0ZXJlZCwgdW5kZWZpbmVkLCAyKSk7XG4gICAgICAgIHJldHVybiBtYXRjaGVkQW5zd2VycztcbiAgICB9XG59XG5leHBvcnRzLmxpc3RBbGxXaXRoQ29udGV4dCA9IGxpc3RBbGxXaXRoQ29udGV4dDtcbmZ1bmN0aW9uIGxpc3RBbGxIYXZpbmdDb250ZXh0KGNhdGVnb3J5LCBjb250ZXh0UXVlcnlTdHJpbmcsIGFSdWxlcywgcmVjb3Jkcykge1xuICAgIGlmIChjb250ZXh0UXVlcnlTdHJpbmcubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiBbXTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHZhciBtYXRjaGVkID0gSW5wdXRGaWx0ZXIuYW5hbHl6ZVN0cmluZyhjb250ZXh0UXVlcnlTdHJpbmcsIGFSdWxlcyk7XG4gICAgICAgIGRlYnVnbG9nKFwiQWZ0ZXIgbWF0Y2hlZCBcIiArIEpTT04uc3RyaW5naWZ5KG1hdGNoZWQpKTtcbiAgICAgICAgdmFyIGFTZW50ZW5jZXMgPSBJbnB1dEZpbHRlci5leHBhbmRNYXRjaEFycihtYXRjaGVkKTtcbiAgICAgICAgZGVidWdsb2coXCJhZnRlciBleHBhbmRcIiArIGFTZW50ZW5jZXMubWFwKGZ1bmN0aW9uIChvU2VudGVuY2UpIHtcbiAgICAgICAgICAgIHJldHVybiBTZW50ZW5jZS5yYW5raW5nUHJvZHVjdChvU2VudGVuY2UpICsgXCI6XCIgKyBKU09OLnN0cmluZ2lmeShvU2VudGVuY2UpO1xuICAgICAgICB9KS5qb2luKFwiXFxuXCIpKTtcbiAgICAgICAgdmFyIGFTZW50ZW5jZXNSZWluZm9yY2VkID0gSW5wdXRGaWx0ZXIucmVpbkZvcmNlKGFTZW50ZW5jZXMpO1xuICAgICAgICAvL2FTZW50ZW5jZXMubWFwKGZ1bmN0aW9uKG9TZW50ZW5jZSkgeyByZXR1cm4gSW5wdXRGaWx0ZXIucmVpbkZvcmNlKG9TZW50ZW5jZSk7IH0pO1xuICAgICAgICBkZWJ1Z2xvZyhcImFmdGVyIHJlaW5mb3JjZVwiICsgYVNlbnRlbmNlc1JlaW5mb3JjZWQubWFwKGZ1bmN0aW9uIChvU2VudGVuY2UpIHtcbiAgICAgICAgICAgIHJldHVybiBTZW50ZW5jZS5yYW5raW5nUHJvZHVjdChvU2VudGVuY2UpICsgXCI6XCIgKyBKU09OLnN0cmluZ2lmeShvU2VudGVuY2UpO1xuICAgICAgICB9KS5qb2luKFwiXFxuXCIpKTtcbiAgICAgICAgdmFyIG1hdGNoZWRBbnN3ZXJzID0gV2hhdElzLm1hdGNoUmVjb3Jkc0hhdmluZ0NvbnRleHQoYVNlbnRlbmNlcywgY2F0ZWdvcnksIHJlY29yZHMpOyAvL2FUb29sOiBBcnJheTxJTWF0Y2guSVRvb2w+KTogYW55IC8qIG9iamVjdHN0cmVhbSovIHtcbiAgICAgICAgZGVidWdsb2coXCIgbWF0Y2hlZCBBbnN3ZXJzXCIgKyBKU09OLnN0cmluZ2lmeShtYXRjaGVkQW5zd2VycywgdW5kZWZpbmVkLCAyKSk7XG4gICAgICAgIHZhciBtYXRjaGVkRmlsdGVyZWQgPSBXaGF0SXMuZmlsdGVyT25seVRvcFJhbmtlZChtYXRjaGVkQW5zd2Vycyk7XG4gICAgICAgIGRlYnVnbG9nKFwiIG1hdGNoZWQgdG9wLXJhbmtlZCBBbnN3ZXJzXCIgKyBKU09OLnN0cmluZ2lmeShtYXRjaGVkRmlsdGVyZWQsIHVuZGVmaW5lZCwgMikpO1xuICAgICAgICByZXR1cm4gbWF0Y2hlZEZpbHRlcmVkO1xuICAgIH1cbn1cbmV4cG9ydHMubGlzdEFsbEhhdmluZ0NvbnRleHQgPSBsaXN0QWxsSGF2aW5nQ29udGV4dDtcbmZ1bmN0aW9uIGxpc3RBbGxXaXRoQ2F0ZWdvcnkoY2F0ZWdvcnksIHJlY29yZHMpIHtcbiAgICB2YXIgbWF0Y2hlZEFuc3dlcnMgPSBtYXRjaFJlY29yZEhhdmluZ0NhdGVnb3J5KGNhdGVnb3J5LCByZWNvcmRzKTsgLy9hVG9vbDogQXJyYXk8SU1hdGNoLklUb29sPik6IGFueSAvKiBvYmplY3RzdHJlYW0qLyB7XG4gICAgZGVidWdsb2coXCIgbGlzdEFsbFdpdGhDYXRlZ29yeTpcIiArIEpTT04uc3RyaW5naWZ5KG1hdGNoZWRBbnN3ZXJzLCB1bmRlZmluZWQsIDIpKTtcbiAgICByZXR1cm4gbWF0Y2hlZEFuc3dlcnM7XG59XG5leHBvcnRzLmxpc3RBbGxXaXRoQ2F0ZWdvcnkgPSBsaXN0QWxsV2l0aENhdGVnb3J5O1xuZnVuY3Rpb24gam9pblNvcnRlZFF1b3RlZChzdHJpbmdzKSB7XG4gICAgaWYgKHN0cmluZ3MubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiBcIlwiO1xuICAgIH1cbiAgICByZXR1cm4gJ1wiJyArIHN0cmluZ3Muc29ydCgpLmpvaW4oJ1wiOyBcIicpICsgJ1wiJztcbn1cbmV4cG9ydHMuam9pblNvcnRlZFF1b3RlZCA9IGpvaW5Tb3J0ZWRRdW90ZWQ7XG5mdW5jdGlvbiBqb2luRGlzdGluY3QoY2F0ZWdvcnksIHJlY29yZHMpIHtcbiAgICB2YXIgcmVzID0gcmVjb3Jkcy5yZWR1Y2UoZnVuY3Rpb24gKHByZXYsIG9SZWNvcmQpIHtcbiAgICAgICAgcHJldltvUmVjb3JkW2NhdGVnb3J5XV0gPSAxO1xuICAgICAgICByZXR1cm4gcHJldjtcbiAgICB9LCB7fSk7XG4gICAgcmV0dXJuIGpvaW5Tb3J0ZWRRdW90ZWQoT2JqZWN0LmtleXMocmVzKSk7XG59XG5leHBvcnRzLmpvaW5EaXN0aW5jdCA9IGpvaW5EaXN0aW5jdDtcbmZ1bmN0aW9uIGZvcm1hdERpc3RpbmN0RnJvbVdoYXRJZlJlc3VsdChhbnN3ZXJzKSB7XG4gICAgcmV0dXJuIGpvaW5Tb3J0ZWRRdW90ZWQoYW5zd2Vycy5tYXAoZnVuY3Rpb24gKG9BbnN3ZXIpIHtcbiAgICAgICAgcmV0dXJuIG9BbnN3ZXIucmVzdWx0O1xuICAgIH0pKTtcbn1cbmV4cG9ydHMuZm9ybWF0RGlzdGluY3RGcm9tV2hhdElmUmVzdWx0ID0gZm9ybWF0RGlzdGluY3RGcm9tV2hhdElmUmVzdWx0O1xuZnVuY3Rpb24gam9pblJlc3VsdHMocmVzdWx0cykge1xuICAgIHZhciByZXMgPSBbXTtcbiAgICB2YXIgY250ID0gcmVzdWx0cy5yZWR1Y2UoZnVuY3Rpb24gKHByZXYsIHJlc3VsdCkge1xuICAgICAgICBpZiAocmVzdWx0Ll9yYW5raW5nID09PSByZXN1bHRzWzBdLl9yYW5raW5nKSB7XG4gICAgICAgICAgICBpZiAocmVzLmluZGV4T2YocmVzdWx0LnJlc3VsdCkgPCAwKSB7XG4gICAgICAgICAgICAgICAgcmVzLnB1c2gocmVzdWx0LnJlc3VsdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICByZXR1cm4gcHJldiArIDE7XG4gICAgICAgIH1cbiAgICB9LCAwKTtcbiAgICByZXR1cm4gcmVzO1xufVxuZXhwb3J0cy5qb2luUmVzdWx0cyA9IGpvaW5SZXN1bHRzO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
