/**
 * @file
 * @module jfseb.fdevstart.breakdown
 * @copyright (c) 2016 Gerd Forstmann
 */
"use strict";

var debug = require('debug');
var debuglog = debug('dispatcher');
function cleanseString(sString) {
    var len = 0;
    while (len !== sString.length) {
        len = sString.length;
        sString = sString.replace(/\s\s+/g, ' ');
        sString = sString.replace(/\s\s+/g, ' ');
        sString = sString.replace(/^\s+/, '');
        sString = sString.replace(/\s+$/, '');
    }
    return sString;
}
exports.cleanseString = cleanseString;
var regexpRemoveDouble = new RegExp(/^\"(\".*\")\"$/);
var striptail = new RegExp(/^\"([^\"]+)"$/);
function trimQuoted(sString) {
    var skipUntil = 0;
    var stripped = sString;
    var m = regexpRemoveDouble.exec(sString);
    while (m) {
        stripped = m[1];
        m = regexpRemoveDouble.exec(stripped);
    }
    debuglog("stripped " + stripped);
    m = striptail.exec(stripped);
    if (m) {
        return m[1];
    }
    return sString;
}
exports.trimQuoted = trimQuoted;
function trimQuotedSpaced(sString) {
    var skipUntil = 0;
    sString = sString.replace(/^"\s+/g, '"');
    sString = sString.replace(/\s+\"$/g, '"');
    return sString;
}
exports.trimQuotedSpaced = trimQuotedSpaced;
function recombineQuoted(aArr) {
    var skipUntil = 0;
    aArr = aArr.map(function (s, index) {
        if (index < skipUntil) {
            debuglog("skipping >" + s + "<");
            return undefined;
        }
        if (/^"/.exec(s)) {
            var i = index;
            while (i < aArr.length && (!/"$/.exec(aArr[i]) || index === i && s === '"')) {
                i = i + 1;
            }
            if (i === aArr.length) {
                debuglog("Unterminated quoted string");
                return s;
            } else {
                skipUntil = i + 1;
                var res = aArr.slice(index, i + 1).join(" ");
            }
            return res;
        }
        return s;
    }).filter(function (s) {
        return s !== undefined;
    }).map(function (s) {
        return trimQuotedSpaced(s);
    });
    return aArr;
}
exports.recombineQuoted = recombineQuoted;
/**
 *@param {string} sString , e.g. "a b c"
 *@return {Array<Array<String>>} broken down array, e.g.
 *[["a b c"], ["a", "b c"], ["a b", "c"], ....["a", "b", "c"]]
 */
function breakdownString(sString) {
    var rString = cleanseString(sString);
    var u = rString.split(" ");
    u = recombineQuoted(u);
    var k = 0;
    if (u.length === 0) {
        return [[]];
    }
    var w = [[u[0]]];
    while (k < u.length - 1) {
        k = k + 1;
        var r1 = w.map(function (entry) {
            debuglog(JSON.stringify(entry));
            var entry = entry.slice(0);
            debuglog(JSON.stringify(entry));
            entry[entry.length - 1] = entry[entry.length - 1] + " " + u[k];
            return entry;
        });
        var r2 = w.map(function (entry) {
            debuglog("2 >" + JSON.stringify(entry));
            var entry = entry.slice(0);
            entry.push(u[k]);
            return entry;
        });
        debuglog(JSON.stringify(r1));
        debuglog(JSON.stringify(r2));
        w = r1.concat(r2);
    }
    return w.map(function (oMap) {
        return oMap.map(function (sWord) {
            return trimQuoted(sWord);
        });
    });
}
exports.breakdownString = breakdownString;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9tYXRjaC9icmVha2Rvd24udHMiLCJtYXRjaC9icmVha2Rvd24uanMiXSwibmFtZXMiOlsiZGVidWciLCJyZXF1aXJlIiwiZGVidWdsb2ciLCJjbGVhbnNlU3RyaW5nIiwic1N0cmluZyIsImxlbiIsImxlbmd0aCIsInJlcGxhY2UiLCJleHBvcnRzIiwicmVnZXhwUmVtb3ZlRG91YmxlIiwiUmVnRXhwIiwic3RyaXB0YWlsIiwidHJpbVF1b3RlZCIsInNraXBVbnRpbCIsInN0cmlwcGVkIiwibSIsImV4ZWMiLCJ0cmltUXVvdGVkU3BhY2VkIiwicmVjb21iaW5lUXVvdGVkIiwiYUFyciIsIm1hcCIsInMiLCJpbmRleCIsInVuZGVmaW5lZCIsImkiLCJyZXMiLCJzbGljZSIsImpvaW4iLCJmaWx0ZXIiLCJicmVha2Rvd25TdHJpbmciLCJyU3RyaW5nIiwidSIsInNwbGl0IiwiayIsInciLCJyMSIsImVudHJ5IiwiSlNPTiIsInN0cmluZ2lmeSIsInIyIiwicHVzaCIsImNvbmNhdCIsIm9NYXAiLCJzV29yZCJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7O0FDS0E7O0FEQ0EsSUFBWUEsUUFBS0MsUUFBTSxPQUFOLENBQWpCO0FBQ0EsSUFBTUMsV0FBV0YsTUFBTSxZQUFOLENBQWpCO0FBR0EsU0FBQUcsYUFBQSxDQUE4QkMsT0FBOUIsRUFBOEM7QUFDMUMsUUFBSUMsTUFBTSxDQUFWO0FBQ0EsV0FBUUEsUUFBUUQsUUFBUUUsTUFBeEIsRUFBa0M7QUFDOUJELGNBQU1ELFFBQVFFLE1BQWQ7QUFDQUYsa0JBQVVBLFFBQVFHLE9BQVIsQ0FBZ0IsUUFBaEIsRUFBMEIsR0FBMUIsQ0FBVjtBQUNBSCxrQkFBVUEsUUFBUUcsT0FBUixDQUFnQixRQUFoQixFQUEwQixHQUExQixDQUFWO0FBQ0FILGtCQUFVQSxRQUFRRyxPQUFSLENBQWdCLE1BQWhCLEVBQXVCLEVBQXZCLENBQVY7QUFDQUgsa0JBQVVBLFFBQVFHLE9BQVIsQ0FBZ0IsTUFBaEIsRUFBdUIsRUFB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QUFTc0IsSUFBVCxFQUFhO0FBQUksZUFBT0EsS0FBS3RCLEdBQUwsQ0FBUyxVQUFTdUIsS0FBVCxFQUFjO0FBQ3hELG1CQUFPL0IsV0FBVytCLEtBQVgsQ0FBUDtBQUEyQixTQURNLENBQVA7QUFDSyxLQUQ1QixDQUFQO0FBRUg7QUE5QmVuQyxRQUFBcUIsZUFBQSxHQUFlQSxlQUFmIiwiZmlsZSI6Im1hdGNoL2JyZWFrZG93bi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxyXG4gKiBAZmlsZVxyXG4gKiBAbW9kdWxlIGpmc2ViLmZkZXZzdGFydC5icmVha2Rvd25cclxuICogQGNvcHlyaWdodCAoYykgMjAxNiBHZXJkIEZvcnN0bWFublxyXG4gKi9cclxuXHJcbmltcG9ydCAqIGFzIGRlYnVnIGZyb20gJ2RlYnVnJztcclxuY29uc3QgZGVidWdsb2cgPSBkZWJ1ZygnZGlzcGF0Y2hlcicpXHJcblxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIGNsZWFuc2VTdHJpbmcoc1N0cmluZyA6IHN0cmluZykgOiBzdHJpbmcge1xyXG4gICAgdmFyIGxlbiA9IDA7XHJcbiAgICB3aGlsZSAoIGxlbiAhPT0gc1N0cmluZy5sZW5ndGggKSAge1xyXG4gICAgICAgIGxlbiA9IHNTdHJpbmcubGVuZ3RoO1xyXG4gICAgICAgIHNTdHJpbmcgPSBzU3RyaW5nLnJlcGxhY2UoL1xcc1xccysvZywgJyAnKTtcclxuICAgICAgICBzU3RyaW5nID0gc1N0cmluZy5yZXBsYWNlKC9cXHNcXHMrL2csICcgJyk7XHJcbiAgICAgICAgc1N0cmluZyA9IHNTdHJpbmcucmVwbGFjZSgvXlxccysvLCcnKTtcclxuICAgICAgICBzU3RyaW5nID0gc1N0cmluZy5yZXBsYWNlKC9cXHMrJC8sJycpO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHNTdHJpbmdcclxufVxyXG5cclxuXHJcbmNvbnN0IHJlZ2V4cFJlbW92ZURvdWJsZSA9IG5ldyBSZWdFeHAoL15cXFwiKFxcXCIuKlxcXCIpXFxcIiQvKTtcclxuY29uc3Qgc3RyaXB0YWlsID0gbmV3IFJlZ0V4cCgvXlxcXCIoW15cXFwiXSspXCIkLylcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiB0cmltUXVvdGVkKHNTdHJpbmcgOiBzdHJpbmcpIDogc3RyaW5nIHtcclxuICAgIHZhciBza2lwVW50aWwgPSAwO1xyXG4gICAgdmFyIHN0cmlwcGVkID0gc1N0cmluZztcclxuICAgIHZhciBtID0gcmVnZXhwUmVtb3ZlRG91YmxlLmV4ZWMoc1N0cmluZyk7XHJcbiAgICB3aGlsZShtKSB7XHJcbiAgICAgICAgc3RyaXBwZWQgPSBtWzFdO1xyXG4gICAgICAgIG0gPSByZWdleHBSZW1vdmVEb3VibGUuZXhlYyhzdHJpcHBlZCk7XHJcbiAgICB9XHJcbiAgICBkZWJ1Z2xvZyhcInN0cmlwcGVkIFwiICsgc3RyaXBwZWQpO1xyXG4gICAgbSA9IHN0cmlwdGFpbC5leGVjKHN0cmlwcGVkKTtcclxuICAgIGlmKG0pIHtcclxuICAgICAgICByZXR1cm4gbVsxXTtcclxuICAgIH1cclxuICAgIHJldHVybiBzU3RyaW5nO1xyXG4gfVxyXG5cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiB0cmltUXVvdGVkU3BhY2VkKHNTdHJpbmcgOiBzdHJpbmcpIDogc3RyaW5nIHtcclxuICAgIHZhciBza2lwVW50aWwgPSAwO1xyXG4gICAgc1N0cmluZyA9IHNTdHJpbmcucmVwbGFjZSgvXlwiXFxzKy9nLCAnXCInKTtcclxuICAgIHNTdHJpbmcgPSBzU3RyaW5nLnJlcGxhY2UoL1xccytcXFwiJC9nLCAnXCInKTtcclxuICAgIHJldHVybiBzU3RyaW5nO1xyXG59XHJcblxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHJlY29tYmluZVF1b3RlZChhQXJyIDogQXJyYXk8c3RyaW5nPikgOiBBcnJheTxzdHJpbmc+IHtcclxuICAgIHZhciBza2lwVW50aWwgPSAwO1xyXG4gICAgYUFyciA9IGFBcnIubWFwKGZ1bmN0aW9uKHMsIGluZGV4KSB7XHJcbiAgICAgICAgaWYgKGluZGV4IDwgc2tpcFVudGlsKSB7XHJcbiAgICAgICAgICAgIGRlYnVnbG9nKFwic2tpcHBpbmcgPlwiICsgcyArIFwiPFwiKTtcclxuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYoL15cIi8uZXhlYyhzKSkge1xyXG4gICAgICAgICAgICB2YXIgaSA9IGluZGV4O1xyXG4gICAgICAgICAgICB3aGlsZShpIDwgYUFyci5sZW5ndGggJiYgKCEvXCIkLy5leGVjKGFBcnJbaV0pIHx8IChpbmRleCA9PT0gaSAmJiBzID09PSAnXCInKSkpIHtcclxuICAgICAgICAgICAgICBpID0gaSArIDE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGkgPT09IGFBcnIubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICBkZWJ1Z2xvZyhcIlVudGVybWluYXRlZCBxdW90ZWQgc3RyaW5nXCIpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHM7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBza2lwVW50aWwgPSBpICsgMTtcclxuICAgICAgICAgICAgICAgIHZhciByZXMgPSBhQXJyLnNsaWNlKGluZGV4LGkgKyAxKS5qb2luKFwiIFwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gcmVzO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcztcclxuICAgIH0pLmZpbHRlcihmdW5jdGlvbihzKSB7XHJcbiAgICAgICAgcmV0dXJuIHMgIT09IHVuZGVmaW5lZDtcclxuICAgIH0pLm1hcChmdW5jdGlvbihzKSB7XHJcbiAgICAgICByZXR1cm4gdHJpbVF1b3RlZFNwYWNlZChzKTtcclxuICAgIH0pXHJcbiAgICByZXR1cm4gYUFycjtcclxufVxyXG5cclxuLyoqXHJcbiAqQHBhcmFtIHtzdHJpbmd9IHNTdHJpbmcgLCBlLmcuIFwiYSBiIGNcIlxyXG4gKkByZXR1cm4ge0FycmF5PEFycmF5PFN0cmluZz4+fSBicm9rZW4gZG93biBhcnJheSwgZS5nLlxyXG4gKltbXCJhIGIgY1wiXSwgW1wiYVwiLCBcImIgY1wiXSwgW1wiYSBiXCIsIFwiY1wiXSwgLi4uLltcImFcIiwgXCJiXCIsIFwiY1wiXV1cclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBicmVha2Rvd25TdHJpbmcoc1N0cmluZzogc3RyaW5nKSA6IEFycmF5PEFycmF5PFN0cmluZz4+IHtcclxuICAgIHZhciByU3RyaW5nID0gY2xlYW5zZVN0cmluZyhzU3RyaW5nKTtcclxuICAgIHZhciB1ID0gclN0cmluZy5zcGxpdChcIiBcIik7XHJcbiAgICB1ID0gcmVjb21iaW5lUXVvdGVkKHUpO1xyXG4gICAgdmFyIGsgPSAwO1xyXG4gICAgaWYodS5sZW5ndGggPT09IDApIHtcclxuICAgICAgICByZXR1cm4gW1tdXTtcclxuICAgIH1cclxuICAgIHZhciB3ID0gW1t1WzBdXV07XHJcbiAgICB3aGlsZShrIDwgdS5sZW5ndGggLSAxKSB7XHJcbiAgICAgICAgayA9IGsgKyAxO1xyXG4gICAgICAgIHZhciByMSA9IHcubWFwKGZ1bmN0aW9uIChlbnRyeSkge1xyXG4gICAgICAgICAgICBkZWJ1Z2xvZyhKU09OLnN0cmluZ2lmeShlbnRyeSkpO1xyXG4gICAgICAgICAgICB2YXIgZW50cnkgPSBlbnRyeS5zbGljZSgwKTtcclxuICAgICAgICAgICAgZGVidWdsb2coSlNPTi5zdHJpbmdpZnkoZW50cnkpKTtcclxuICAgICAgICAgICAgZW50cnlbZW50cnkubGVuZ3RoIC0xIF0gPSBlbnRyeVtlbnRyeS5sZW5ndGgtMSBdICsgXCIgXCIgKyB1W2tdO1xyXG4gICAgICAgICAgICByZXR1cm4gZW50cnk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdmFyIHIyID0gIHcubWFwKGZ1bmN0aW9uIChlbnRyeSkge1xyXG4gICAgICAgICAgICBkZWJ1Z2xvZyhcIjIgPlwiICsgSlNPTi5zdHJpbmdpZnkoZW50cnkpKTtcclxuICAgICAgICAgICAgdmFyIGVudHJ5ID0gZW50cnkuc2xpY2UoMCk7XHJcbiAgICAgICAgICAgIGVudHJ5LnB1c2godVtrXSk7XHJcbiAgICAgICAgICAgIHJldHVybiBlbnRyeVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGRlYnVnbG9nKEpTT04uc3RyaW5naWZ5KHIxKSk7XHJcbiAgICAgICAgZGVidWdsb2coSlNPTi5zdHJpbmdpZnkocjIpKTtcclxuICAgICAgICB3ID0gcjEuY29uY2F0KHIyKTtcclxuICAgIH1cclxuICAgIHJldHVybiB3Lm1hcChmdW5jdGlvbihvTWFwKSB7IHJldHVybiBvTWFwLm1hcChmdW5jdGlvbihzV29yZCkge1xyXG4gICAgICAgIHJldHVybiB0cmltUXVvdGVkKHNXb3JkKTsgfSk7IH0pO1xyXG59XHJcblxyXG5pbXBvcnQgKiBhcyBJTWF0Y2ggZnJvbSAnLi9pZm1hdGNoJ1xyXG5cclxuIiwiLyoqXG4gKiBAZmlsZVxuICogQG1vZHVsZSBqZnNlYi5mZGV2c3RhcnQuYnJlYWtkb3duXG4gKiBAY29weXJpZ2h0IChjKSAyMDE2IEdlcmQgRm9yc3RtYW5uXG4gKi9cblwidXNlIHN0cmljdFwiO1xudmFyIGRlYnVnID0gcmVxdWlyZSgnZGVidWcnKTtcbnZhciBkZWJ1Z2xvZyA9IGRlYnVnKCdkaXNwYXRjaGVyJyk7XG5mdW5jdGlvbiBjbGVhbnNlU3RyaW5nKHNTdHJpbmcpIHtcbiAgICB2YXIgbGVuID0gMDtcbiAgICB3aGlsZSAobGVuICE9PSBzU3RyaW5nLmxlbmd0aCkge1xuICAgICAgICBsZW4gPSBzU3RyaW5nLmxlbmd0aDtcbiAgICAgICAgc1N0cmluZyA9IHNTdHJpbmcucmVwbGFjZSgvXFxzXFxzKy9nLCAnICcpO1xuICAgICAgICBzU3RyaW5nID0gc1N0cmluZy5yZXBsYWNlKC9cXHNcXHMrL2csICcgJyk7XG4gICAgICAgIHNTdHJpbmcgPSBzU3RyaW5nLnJlcGxhY2UoL15cXHMrLywgJycpO1xuICAgICAgICBzU3RyaW5nID0gc1N0cmluZy5yZXBsYWNlKC9cXHMrJC8sICcnKTtcbiAgICB9XG4gICAgcmV0dXJuIHNTdHJpbmc7XG59XG5leHBvcnRzLmNsZWFuc2VTdHJpbmcgPSBjbGVhbnNlU3RyaW5nO1xudmFyIHJlZ2V4cFJlbW92ZURvdWJsZSA9IG5ldyBSZWdFeHAoL15cXFwiKFxcXCIuKlxcXCIpXFxcIiQvKTtcbnZhciBzdHJpcHRhaWwgPSBuZXcgUmVnRXhwKC9eXFxcIihbXlxcXCJdKylcIiQvKTtcbmZ1bmN0aW9uIHRyaW1RdW90ZWQoc1N0cmluZykge1xuICAgIHZhciBza2lwVW50aWwgPSAwO1xuICAgIHZhciBzdHJpcHBlZCA9IHNTdHJpbmc7XG4gICAgdmFyIG0gPSByZWdleHBSZW1vdmVEb3VibGUuZXhlYyhzU3RyaW5nKTtcbiAgICB3aGlsZSAobSkge1xuICAgICAgICBzdHJpcHBlZCA9IG1bMV07XG4gICAgICAgIG0gPSByZWdleHBSZW1vdmVEb3VibGUuZXhlYyhzdHJpcHBlZCk7XG4gICAgfVxuICAgIGRlYnVnbG9nKFwic3RyaXBwZWQgXCIgKyBzdHJpcHBlZCk7XG4gICAgbSA9IHN0cmlwdGFpbC5leGVjKHN0cmlwcGVkKTtcbiAgICBpZiAobSkge1xuICAgICAgICByZXR1cm4gbVsxXTtcbiAgICB9XG4gICAgcmV0dXJuIHNTdHJpbmc7XG59XG5leHBvcnRzLnRyaW1RdW90ZWQgPSB0cmltUXVvdGVkO1xuZnVuY3Rpb24gdHJpbVF1b3RlZFNwYWNlZChzU3RyaW5nKSB7XG4gICAgdmFyIHNraXBVbnRpbCA9IDA7XG4gICAgc1N0cmluZyA9IHNTdHJpbmcucmVwbGFjZSgvXlwiXFxzKy9nLCAnXCInKTtcbiAgICBzU3RyaW5nID0gc1N0cmluZy5yZXBsYWNlKC9cXHMrXFxcIiQvZywgJ1wiJyk7XG4gICAgcmV0dXJuIHNTdHJpbmc7XG59XG5leHBvcnRzLnRyaW1RdW90ZWRTcGFjZWQgPSB0cmltUXVvdGVkU3BhY2VkO1xuZnVuY3Rpb24gcmVjb21iaW5lUXVvdGVkKGFBcnIpIHtcbiAgICB2YXIgc2tpcFVudGlsID0gMDtcbiAgICBhQXJyID0gYUFyci5tYXAoZnVuY3Rpb24gKHMsIGluZGV4KSB7XG4gICAgICAgIGlmIChpbmRleCA8IHNraXBVbnRpbCkge1xuICAgICAgICAgICAgZGVidWdsb2coXCJza2lwcGluZyA+XCIgKyBzICsgXCI8XCIpO1xuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoL15cIi8uZXhlYyhzKSkge1xuICAgICAgICAgICAgdmFyIGkgPSBpbmRleDtcbiAgICAgICAgICAgIHdoaWxlIChpIDwgYUFyci5sZW5ndGggJiYgKCEvXCIkLy5leGVjKGFBcnJbaV0pIHx8IChpbmRleCA9PT0gaSAmJiBzID09PSAnXCInKSkpIHtcbiAgICAgICAgICAgICAgICBpID0gaSArIDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaSA9PT0gYUFyci5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBkZWJ1Z2xvZyhcIlVudGVybWluYXRlZCBxdW90ZWQgc3RyaW5nXCIpO1xuICAgICAgICAgICAgICAgIHJldHVybiBzO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgc2tpcFVudGlsID0gaSArIDE7XG4gICAgICAgICAgICAgICAgdmFyIHJlcyA9IGFBcnIuc2xpY2UoaW5kZXgsIGkgKyAxKS5qb2luKFwiIFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiByZXM7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHM7XG4gICAgfSkuZmlsdGVyKGZ1bmN0aW9uIChzKSB7XG4gICAgICAgIHJldHVybiBzICE9PSB1bmRlZmluZWQ7XG4gICAgfSkubWFwKGZ1bmN0aW9uIChzKSB7XG4gICAgICAgIHJldHVybiB0cmltUXVvdGVkU3BhY2VkKHMpO1xuICAgIH0pO1xuICAgIHJldHVybiBhQXJyO1xufVxuZXhwb3J0cy5yZWNvbWJpbmVRdW90ZWQgPSByZWNvbWJpbmVRdW90ZWQ7XG4vKipcbiAqQHBhcmFtIHtzdHJpbmd9IHNTdHJpbmcgLCBlLmcuIFwiYSBiIGNcIlxuICpAcmV0dXJuIHtBcnJheTxBcnJheTxTdHJpbmc+Pn0gYnJva2VuIGRvd24gYXJyYXksIGUuZy5cbiAqW1tcImEgYiBjXCJdLCBbXCJhXCIsIFwiYiBjXCJdLCBbXCJhIGJcIiwgXCJjXCJdLCAuLi4uW1wiYVwiLCBcImJcIiwgXCJjXCJdXVxuICovXG5mdW5jdGlvbiBicmVha2Rvd25TdHJpbmcoc1N0cmluZykge1xuICAgIHZhciByU3RyaW5nID0gY2xlYW5zZVN0cmluZyhzU3RyaW5nKTtcbiAgICB2YXIgdSA9IHJTdHJpbmcuc3BsaXQoXCIgXCIpO1xuICAgIHUgPSByZWNvbWJpbmVRdW90ZWQodSk7XG4gICAgdmFyIGsgPSAwO1xuICAgIGlmICh1Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gW1tdXTtcbiAgICB9XG4gICAgdmFyIHcgPSBbW3VbMF1dXTtcbiAgICB3aGlsZSAoayA8IHUubGVuZ3RoIC0gMSkge1xuICAgICAgICBrID0gayArIDE7XG4gICAgICAgIHZhciByMSA9IHcubWFwKGZ1bmN0aW9uIChlbnRyeSkge1xuICAgICAgICAgICAgZGVidWdsb2coSlNPTi5zdHJpbmdpZnkoZW50cnkpKTtcbiAgICAgICAgICAgIHZhciBlbnRyeSA9IGVudHJ5LnNsaWNlKDApO1xuICAgICAgICAgICAgZGVidWdsb2coSlNPTi5zdHJpbmdpZnkoZW50cnkpKTtcbiAgICAgICAgICAgIGVudHJ5W2VudHJ5Lmxlbmd0aCAtIDFdID0gZW50cnlbZW50cnkubGVuZ3RoIC0gMV0gKyBcIiBcIiArIHVba107XG4gICAgICAgICAgICByZXR1cm4gZW50cnk7XG4gICAgICAgIH0pO1xuICAgICAgICB2YXIgcjIgPSB3Lm1hcChmdW5jdGlvbiAoZW50cnkpIHtcbiAgICAgICAgICAgIGRlYnVnbG9nKFwiMiA+XCIgKyBKU09OLnN0cmluZ2lmeShlbnRyeSkpO1xuICAgICAgICAgICAgdmFyIGVudHJ5ID0gZW50cnkuc2xpY2UoMCk7XG4gICAgICAgICAgICBlbnRyeS5wdXNoKHVba10pO1xuICAgICAgICAgICAgcmV0dXJuIGVudHJ5O1xuICAgICAgICB9KTtcbiAgICAgICAgZGVidWdsb2coSlNPTi5zdHJpbmdpZnkocjEpKTtcbiAgICAgICAgZGVidWdsb2coSlNPTi5zdHJpbmdpZnkocjIpKTtcbiAgICAgICAgdyA9IHIxLmNvbmNhdChyMik7XG4gICAgfVxuICAgIHJldHVybiB3Lm1hcChmdW5jdGlvbiAob01hcCkge1xuICAgICAgICByZXR1cm4gb01hcC5tYXAoZnVuY3Rpb24gKHNXb3JkKSB7XG4gICAgICAgICAgICByZXR1cm4gdHJpbVF1b3RlZChzV29yZCk7XG4gICAgICAgIH0pO1xuICAgIH0pO1xufVxuZXhwb3J0cy5icmVha2Rvd25TdHJpbmcgPSBicmVha2Rvd25TdHJpbmc7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
