/**
 * @file
 * @module jfseb.fdevstart.breakdown
 * @copyright (c) 2016 Gerd Forstmann
 */
"use strict";

var debug = require('debug');
var debuglog = debug('dispatcher');
function cleanseString(sString) {
    sString = sString.replace(/^\s+/, '');
    sString = sString.replace(/\s+$/, '');
    sString = sString.replace(/\s\s+/g, ' ');
    return sString;
}
exports.cleanseString = cleanseString;
var regexpRemoveDouble = new RegExp(/^\"(\".*\")\"$/);
var striptail = new RegExp(/^\"([^\"]+)"$/);
function trimQuoted(sString) {
    var skipUntil = 0;
    var stripped = sString;
    var m = regexpRemoveDouble.exec(sString);
    while (m) {
        stripped = m[1];
        m = regexpRemoveDouble.exec(stripped);
    }
    debuglog("stripped " + stripped);
    m = striptail.exec(stripped);
    if (m) {
        return m[1];
    }
    return sString;
}
exports.trimQuoted = trimQuoted;
function trimQuotedSpaced(sString) {
    var skipUntil = 0;
    sString = sString.replace(/^"\s+/g, '"');
    sString = sString.replace(/\s+\"$/g, '"');
    return sString;
}
exports.trimQuotedSpaced = trimQuotedSpaced;
function recombineQuoted(aArr) {
    var skipUntil = 0;
    aArr = aArr.map(function (s, index) {
        if (index < skipUntil) {
            debuglog("skipping >" + s + "<");
            return undefined;
        }
        if (/^"/.exec(s)) {
            var i = index;
            while (i < aArr.length && (!/"$/.exec(aArr[i]) || index === i && s === '"')) {
                i = i + 1;
            }
            if (i === aArr.length) {
                debuglog("Unterminated quoted string");
                return s;
            } else {
                skipUntil = i + 1;
                var res = aArr.slice(index, i + 1).join(" ");
            }
            return res;
        }
        return s;
    }).filter(function (s) {
        return s !== undefined;
    }).map(function (s) {
        return trimQuotedSpaced(s);
    });
    return aArr;
}
exports.recombineQuoted = recombineQuoted;
/**
 *@param {string} sString , e.g. "a b c"
 *@return {Array<Array<String>>} broken down array, e.g.
 *[["a b c"], ["a", "b c"], ["a b", "c"], ....["a", "b", "c"]]
 */
function breakdownString(sString) {
    var u = sString.split(" ");
    u = recombineQuoted(u);
    var k = 0;
    if (u.length === 0) {
        return [[]];
    }
    var w = [[u[0]]];
    while (k < u.length - 1) {
        k = k + 1;
        var r1 = w.map(function (entry) {
            debuglog(JSON.stringify(entry));
            var entry = entry.slice(0);
            debuglog(JSON.stringify(entry));
            entry[entry.length - 1] = entry[entry.length - 1] + " " + u[k];
            return entry;
        });
        var r2 = w.map(function (entry) {
            debuglog("2 >" + JSON.stringify(entry));
            var entry = entry.slice(0);
            entry.push(u[k]);
            return entry;
        });
        debuglog(JSON.stringify(r1));
        debuglog(JSON.stringify(r2));
        w = r1.concat(r2);
    }
    return w.map(function (oMap) {
        return oMap.map(function (sWord) {
            return trimQuoted(sWord);
        });
    });
}
exports.breakdownString = breakdownString;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9tYXRjaC9icmVha2Rvd24udHMiLCJtYXRjaC9icmVha2Rvd24uanMiXSwibmFtZXMiOlsiZGVidWciLCJyZXF1aXJlIiwiZGVidWdsb2ciLCJjbGVhbnNlU3RyaW5nIiwic1N0cmluZyIsInJlcGxhY2UiLCJleHBvcnRzIiwicmVnZXhwUmVtb3ZlRG91YmxlIiwiUmVnRXhwIiwic3RyaXB0YWlsIiwidHJpbVF1b3RlZCIsInNraXBVbnRpbCIsInN0cmlwcGVkIiwibSIsImV4ZWMiLCJ0cmltUXVvdGVkU3BhY2VkIiwicmVjb21iaW5lUXVvdGVkIiwiYUFyciIsIm1hcCIsInMiLCJpbmRleCIsInVuZGVmaW5lZCIsImkiLCJsZW5ndGgiLCJyZXMiLCJzbGljZSIsImpvaW4iLCJmaWx0ZXIiLCJicmVha2Rvd25TdHJpbmciLCJ1Iiwic3BsaXQiLCJrIiwidyIsInIxIiwiZW50cnkiLCJKU09OIiwic3RyaW5naWZ5IiwicjIiLCJwdXNoIiwiY29uY2F0Iiwib01hcCIsInNXb3JkIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7QUNLQTs7QURDQSxJQUFZQSxRQUFLQyxRQUFNLE9BQU4sQ0FBakI7QUFDQSxJQUFNQyxXQUFXRixNQUFNLFlBQU4sQ0FBakI7QUFHQSxTQUFBRyxhQUFBLENBQThCQyxPQUE5QixFQUE4QztBQUMxQ0EsY0FBVUEsUUFBUUMsT0FBUixDQUFnQixNQUFoQixFQUF1QixFQUF2QixDQUFWO0FBQ0FELGNBQVVBLFFBQVFDLE9BQVIsQ0FBZ0IsTUFBaEIsRUFBdUIsRUFBdkIsQ0FBVjtBQUNBRCxjQUFVQSxRQUFRQyxPQUFSLENBQWdCLFFBQWhCLEVBQTBCLEdBQTFCLENBQVY7QUFDQSxXQUFPRCxPQUFQO0FBQ0g7QUFMZUUsUUFBQUgsYUFBQSxHQUFhQSxhQUFiO0FBUWhCLElBQU1JLHFCQUFxQixJQUFJQyxNQUFKLENBQVcsZ0JBQVgsQ0FBM0I7QUFDQSxJQUFNQyxZQUFZLElBQUlELE1BQUosQ0FBVyxlQUFYLENBQWxCO0FBRUEs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Q29udGVudCI6WyIvKipcclxuICogQGZpbGVcclxuICogQG1vZHVsZSBqZnNlYi5mZGV2c3RhcnQuYnJlYWtkb3duXHJcbiAqIEBjb3B5cmlnaHQgKGMpIDIwMTYgR2VyZCBGb3JzdG1hbm5cclxuICovXHJcblxyXG5pbXBvcnQgKiBhcyBkZWJ1ZyBmcm9tICdkZWJ1Zyc7XHJcbmNvbnN0IGRlYnVnbG9nID0gZGVidWcoJ2Rpc3BhdGNoZXInKVxyXG5cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBjbGVhbnNlU3RyaW5nKHNTdHJpbmcgOiBzdHJpbmcpIDogc3RyaW5nIHtcclxuICAgIHNTdHJpbmcgPSBzU3RyaW5nLnJlcGxhY2UoL15cXHMrLywnJyk7XHJcbiAgICBzU3RyaW5nID0gc1N0cmluZy5yZXBsYWNlKC9cXHMrJC8sJycpO1xyXG4gICAgc1N0cmluZyA9IHNTdHJpbmcucmVwbGFjZSgvXFxzXFxzKy9nLCAnICcpO1xyXG4gICAgcmV0dXJuIHNTdHJpbmdcclxufVxyXG5cclxuXHJcbmNvbnN0IHJlZ2V4cFJlbW92ZURvdWJsZSA9IG5ldyBSZWdFeHAoL15cXFwiKFxcXCIuKlxcXCIpXFxcIiQvKTtcclxuY29uc3Qgc3RyaXB0YWlsID0gbmV3IFJlZ0V4cCgvXlxcXCIoW15cXFwiXSspXCIkLylcclxuXHJcbmV4cG9ydCBmdW5jdGlvbiB0cmltUXVvdGVkKHNTdHJpbmcgOiBzdHJpbmcpIDogc3RyaW5nIHtcclxuICAgIHZhciBza2lwVW50aWwgPSAwO1xyXG4gICAgdmFyIHN0cmlwcGVkID0gc1N0cmluZztcclxuICAgIHZhciBtID0gcmVnZXhwUmVtb3ZlRG91YmxlLmV4ZWMoc1N0cmluZyk7XHJcbiAgICB3aGlsZShtKSB7XHJcbiAgICAgICAgc3RyaXBwZWQgPSBtWzFdO1xyXG4gICAgICAgIG0gPSByZWdleHBSZW1vdmVEb3VibGUuZXhlYyhzdHJpcHBlZCk7XHJcbiAgICB9XHJcbiAgICBkZWJ1Z2xvZyhcInN0cmlwcGVkIFwiICsgc3RyaXBwZWQpO1xyXG4gICAgbSA9IHN0cmlwdGFpbC5leGVjKHN0cmlwcGVkKTtcclxuICAgIGlmKG0pIHtcclxuICAgICAgICByZXR1cm4gbVsxXTtcclxuICAgIH1cclxuICAgIHJldHVybiBzU3RyaW5nO1xyXG4gfVxyXG5cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiB0cmltUXVvdGVkU3BhY2VkKHNTdHJpbmcgOiBzdHJpbmcpIDogc3RyaW5nIHtcclxuICAgIHZhciBza2lwVW50aWwgPSAwO1xyXG4gICAgc1N0cmluZyA9IHNTdHJpbmcucmVwbGFjZSgvXlwiXFxzKy9nLCAnXCInKTtcclxuICAgIHNTdHJpbmcgPSBzU3RyaW5nLnJlcGxhY2UoL1xccytcXFwiJC9nLCAnXCInKTtcclxuICAgIHJldHVybiBzU3RyaW5nO1xyXG59XHJcblxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIHJlY29tYmluZVF1b3RlZChhQXJyIDogQXJyYXk8c3RyaW5nPikgOiBBcnJheTxzdHJpbmc+IHtcclxuICAgIHZhciBza2lwVW50aWwgPSAwO1xyXG4gICAgYUFyciA9IGFBcnIubWFwKGZ1bmN0aW9uKHMsIGluZGV4KSB7XHJcbiAgICAgICAgaWYgKGluZGV4IDwgc2tpcFVudGlsKSB7XHJcbiAgICAgICAgICAgIGRlYnVnbG9nKFwic2tpcHBpbmcgPlwiICsgcyArIFwiPFwiKTtcclxuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYoL15cIi8uZXhlYyhzKSkge1xyXG4gICAgICAgICAgICB2YXIgaSA9IGluZGV4O1xyXG4gICAgICAgICAgICB3aGlsZShpIDwgYUFyci5sZW5ndGggJiYgKCEvXCIkLy5leGVjKGFBcnJbaV0pIHx8IChpbmRleCA9PT0gaSAmJiBzID09PSAnXCInKSkpIHtcclxuICAgICAgICAgICAgICBpID0gaSArIDE7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGkgPT09IGFBcnIubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICBkZWJ1Z2xvZyhcIlVudGVybWluYXRlZCBxdW90ZWQgc3RyaW5nXCIpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHM7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBza2lwVW50aWwgPSBpICsgMTtcclxuICAgICAgICAgICAgICAgIHZhciByZXMgPSBhQXJyLnNsaWNlKGluZGV4LGkgKyAxKS5qb2luKFwiIFwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICByZXR1cm4gcmVzO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gcztcclxuICAgIH0pLmZpbHRlcihmdW5jdGlvbihzKSB7XHJcbiAgICAgICAgcmV0dXJuIHMgIT09IHVuZGVmaW5lZDtcclxuICAgIH0pLm1hcChmdW5jdGlvbihzKSB7XHJcbiAgICAgICByZXR1cm4gdHJpbVF1b3RlZFNwYWNlZChzKTtcclxuICAgIH0pXHJcbiAgICByZXR1cm4gYUFycjtcclxufVxyXG5cclxuLyoqXHJcbiAqQHBhcmFtIHtzdHJpbmd9IHNTdHJpbmcgLCBlLmcuIFwiYSBiIGNcIlxyXG4gKkByZXR1cm4ge0FycmF5PEFycmF5PFN0cmluZz4+fSBicm9rZW4gZG93biBhcnJheSwgZS5nLlxyXG4gKltbXCJhIGIgY1wiXSwgW1wiYVwiLCBcImIgY1wiXSwgW1wiYSBiXCIsIFwiY1wiXSwgLi4uLltcImFcIiwgXCJiXCIsIFwiY1wiXV1cclxuICovXHJcbmV4cG9ydCBmdW5jdGlvbiBicmVha2Rvd25TdHJpbmcoc1N0cmluZzogc3RyaW5nKSA6IEFycmF5PEFycmF5PFN0cmluZz4+IHtcclxuICAgIHZhciB1ID0gc1N0cmluZy5zcGxpdChcIiBcIik7XHJcbiAgICB1ID0gcmVjb21iaW5lUXVvdGVkKHUpO1xyXG4gICAgdmFyIGsgPSAwO1xyXG4gICAgaWYodS5sZW5ndGggPT09IDApIHtcclxuICAgICAgICByZXR1cm4gW1tdXTtcclxuICAgIH1cclxuICAgIHZhciB3ID0gW1t1WzBdXV07XHJcbiAgICB3aGlsZShrIDwgdS5sZW5ndGggLSAxKSB7XHJcbiAgICAgICAgayA9IGsgKyAxO1xyXG4gICAgICAgIHZhciByMSA9IHcubWFwKGZ1bmN0aW9uIChlbnRyeSkge1xyXG4gICAgICAgICAgICBkZWJ1Z2xvZyhKU09OLnN0cmluZ2lmeShlbnRyeSkpO1xyXG4gICAgICAgICAgICB2YXIgZW50cnkgPSBlbnRyeS5zbGljZSgwKTtcclxuICAgICAgICAgICAgZGVidWdsb2coSlNPTi5zdHJpbmdpZnkoZW50cnkpKTtcclxuICAgICAgICAgICAgZW50cnlbZW50cnkubGVuZ3RoIC0xIF0gPSBlbnRyeVtlbnRyeS5sZW5ndGgtMSBdICsgXCIgXCIgKyB1W2tdO1xyXG4gICAgICAgICAgICByZXR1cm4gZW50cnk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdmFyIHIyID0gIHcubWFwKGZ1bmN0aW9uIChlbnRyeSkge1xyXG4gICAgICAgICAgICBkZWJ1Z2xvZyhcIjIgPlwiICsgSlNPTi5zdHJpbmdpZnkoZW50cnkpKTtcclxuICAgICAgICAgICAgdmFyIGVudHJ5ID0gZW50cnkuc2xpY2UoMCk7XHJcbiAgICAgICAgICAgIGVudHJ5LnB1c2godVtrXSk7XHJcbiAgICAgICAgICAgIHJldHVybiBlbnRyeVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGRlYnVnbG9nKEpTT04uc3RyaW5naWZ5KHIxKSk7XHJcbiAgICAgICAgZGVidWdsb2coSlNPTi5zdHJpbmdpZnkocjIpKTtcclxuICAgICAgICB3ID0gcjEuY29uY2F0KHIyKTtcclxuICAgIH1cclxuICAgIHJldHVybiB3Lm1hcChmdW5jdGlvbihvTWFwKSB7IHJldHVybiBvTWFwLm1hcChmdW5jdGlvbihzV29yZCkge1xyXG4gICAgICAgIHJldHVybiB0cmltUXVvdGVkKHNXb3JkKTsgfSk7IH0pO1xyXG59XHJcblxyXG5pbXBvcnQgKiBhcyBJTWF0Y2ggZnJvbSAnLi9pZm1hdGNoJ1xyXG5cclxuIiwiLyoqXG4gKiBAZmlsZVxuICogQG1vZHVsZSBqZnNlYi5mZGV2c3RhcnQuYnJlYWtkb3duXG4gKiBAY29weXJpZ2h0IChjKSAyMDE2IEdlcmQgRm9yc3RtYW5uXG4gKi9cblwidXNlIHN0cmljdFwiO1xudmFyIGRlYnVnID0gcmVxdWlyZSgnZGVidWcnKTtcbnZhciBkZWJ1Z2xvZyA9IGRlYnVnKCdkaXNwYXRjaGVyJyk7XG5mdW5jdGlvbiBjbGVhbnNlU3RyaW5nKHNTdHJpbmcpIHtcbiAgICBzU3RyaW5nID0gc1N0cmluZy5yZXBsYWNlKC9eXFxzKy8sICcnKTtcbiAgICBzU3RyaW5nID0gc1N0cmluZy5yZXBsYWNlKC9cXHMrJC8sICcnKTtcbiAgICBzU3RyaW5nID0gc1N0cmluZy5yZXBsYWNlKC9cXHNcXHMrL2csICcgJyk7XG4gICAgcmV0dXJuIHNTdHJpbmc7XG59XG5leHBvcnRzLmNsZWFuc2VTdHJpbmcgPSBjbGVhbnNlU3RyaW5nO1xudmFyIHJlZ2V4cFJlbW92ZURvdWJsZSA9IG5ldyBSZWdFeHAoL15cXFwiKFxcXCIuKlxcXCIpXFxcIiQvKTtcbnZhciBzdHJpcHRhaWwgPSBuZXcgUmVnRXhwKC9eXFxcIihbXlxcXCJdKylcIiQvKTtcbmZ1bmN0aW9uIHRyaW1RdW90ZWQoc1N0cmluZykge1xuICAgIHZhciBza2lwVW50aWwgPSAwO1xuICAgIHZhciBzdHJpcHBlZCA9IHNTdHJpbmc7XG4gICAgdmFyIG0gPSByZWdleHBSZW1vdmVEb3VibGUuZXhlYyhzU3RyaW5nKTtcbiAgICB3aGlsZSAobSkge1xuICAgICAgICBzdHJpcHBlZCA9IG1bMV07XG4gICAgICAgIG0gPSByZWdleHBSZW1vdmVEb3VibGUuZXhlYyhzdHJpcHBlZCk7XG4gICAgfVxuICAgIGRlYnVnbG9nKFwic3RyaXBwZWQgXCIgKyBzdHJpcHBlZCk7XG4gICAgbSA9IHN0cmlwdGFpbC5leGVjKHN0cmlwcGVkKTtcbiAgICBpZiAobSkge1xuICAgICAgICByZXR1cm4gbVsxXTtcbiAgICB9XG4gICAgcmV0dXJuIHNTdHJpbmc7XG59XG5leHBvcnRzLnRyaW1RdW90ZWQgPSB0cmltUXVvdGVkO1xuZnVuY3Rpb24gdHJpbVF1b3RlZFNwYWNlZChzU3RyaW5nKSB7XG4gICAgdmFyIHNraXBVbnRpbCA9IDA7XG4gICAgc1N0cmluZyA9IHNTdHJpbmcucmVwbGFjZSgvXlwiXFxzKy9nLCAnXCInKTtcbiAgICBzU3RyaW5nID0gc1N0cmluZy5yZXBsYWNlKC9cXHMrXFxcIiQvZywgJ1wiJyk7XG4gICAgcmV0dXJuIHNTdHJpbmc7XG59XG5leHBvcnRzLnRyaW1RdW90ZWRTcGFjZWQgPSB0cmltUXVvdGVkU3BhY2VkO1xuZnVuY3Rpb24gcmVjb21iaW5lUXVvdGVkKGFBcnIpIHtcbiAgICB2YXIgc2tpcFVudGlsID0gMDtcbiAgICBhQXJyID0gYUFyci5tYXAoZnVuY3Rpb24gKHMsIGluZGV4KSB7XG4gICAgICAgIGlmIChpbmRleCA8IHNraXBVbnRpbCkge1xuICAgICAgICAgICAgZGVidWdsb2coXCJza2lwcGluZyA+XCIgKyBzICsgXCI8XCIpO1xuICAgICAgICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICAgICAgfVxuICAgICAgICBpZiAoL15cIi8uZXhlYyhzKSkge1xuICAgICAgICAgICAgdmFyIGkgPSBpbmRleDtcbiAgICAgICAgICAgIHdoaWxlIChpIDwgYUFyci5sZW5ndGggJiYgKCEvXCIkLy5leGVjKGFBcnJbaV0pIHx8IChpbmRleCA9PT0gaSAmJiBzID09PSAnXCInKSkpIHtcbiAgICAgICAgICAgICAgICBpID0gaSArIDE7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoaSA9PT0gYUFyci5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICBkZWJ1Z2xvZyhcIlVudGVybWluYXRlZCBxdW90ZWQgc3RyaW5nXCIpO1xuICAgICAgICAgICAgICAgIHJldHVybiBzO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgc2tpcFVudGlsID0gaSArIDE7XG4gICAgICAgICAgICAgICAgdmFyIHJlcyA9IGFBcnIuc2xpY2UoaW5kZXgsIGkgKyAxKS5qb2luKFwiIFwiKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiByZXM7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHM7XG4gICAgfSkuZmlsdGVyKGZ1bmN0aW9uIChzKSB7XG4gICAgICAgIHJldHVybiBzICE9PSB1bmRlZmluZWQ7XG4gICAgfSkubWFwKGZ1bmN0aW9uIChzKSB7XG4gICAgICAgIHJldHVybiB0cmltUXVvdGVkU3BhY2VkKHMpO1xuICAgIH0pO1xuICAgIHJldHVybiBhQXJyO1xufVxuZXhwb3J0cy5yZWNvbWJpbmVRdW90ZWQgPSByZWNvbWJpbmVRdW90ZWQ7XG4vKipcbiAqQHBhcmFtIHtzdHJpbmd9IHNTdHJpbmcgLCBlLmcuIFwiYSBiIGNcIlxuICpAcmV0dXJuIHtBcnJheTxBcnJheTxTdHJpbmc+Pn0gYnJva2VuIGRvd24gYXJyYXksIGUuZy5cbiAqW1tcImEgYiBjXCJdLCBbXCJhXCIsIFwiYiBjXCJdLCBbXCJhIGJcIiwgXCJjXCJdLCAuLi4uW1wiYVwiLCBcImJcIiwgXCJjXCJdXVxuICovXG5mdW5jdGlvbiBicmVha2Rvd25TdHJpbmcoc1N0cmluZykge1xuICAgIHZhciB1ID0gc1N0cmluZy5zcGxpdChcIiBcIik7XG4gICAgdSA9IHJlY29tYmluZVF1b3RlZCh1KTtcbiAgICB2YXIgayA9IDA7XG4gICAgaWYgKHUubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiBbW11dO1xuICAgIH1cbiAgICB2YXIgdyA9IFtbdVswXV1dO1xuICAgIHdoaWxlIChrIDwgdS5sZW5ndGggLSAxKSB7XG4gICAgICAgIGsgPSBrICsgMTtcbiAgICAgICAgdmFyIHIxID0gdy5tYXAoZnVuY3Rpb24gKGVudHJ5KSB7XG4gICAgICAgICAgICBkZWJ1Z2xvZyhKU09OLnN0cmluZ2lmeShlbnRyeSkpO1xuICAgICAgICAgICAgdmFyIGVudHJ5ID0gZW50cnkuc2xpY2UoMCk7XG4gICAgICAgICAgICBkZWJ1Z2xvZyhKU09OLnN0cmluZ2lmeShlbnRyeSkpO1xuICAgICAgICAgICAgZW50cnlbZW50cnkubGVuZ3RoIC0gMV0gPSBlbnRyeVtlbnRyeS5sZW5ndGggLSAxXSArIFwiIFwiICsgdVtrXTtcbiAgICAgICAgICAgIHJldHVybiBlbnRyeTtcbiAgICAgICAgfSk7XG4gICAgICAgIHZhciByMiA9IHcubWFwKGZ1bmN0aW9uIChlbnRyeSkge1xuICAgICAgICAgICAgZGVidWdsb2coXCIyID5cIiArIEpTT04uc3RyaW5naWZ5KGVudHJ5KSk7XG4gICAgICAgICAgICB2YXIgZW50cnkgPSBlbnRyeS5zbGljZSgwKTtcbiAgICAgICAgICAgIGVudHJ5LnB1c2godVtrXSk7XG4gICAgICAgICAgICByZXR1cm4gZW50cnk7XG4gICAgICAgIH0pO1xuICAgICAgICBkZWJ1Z2xvZyhKU09OLnN0cmluZ2lmeShyMSkpO1xuICAgICAgICBkZWJ1Z2xvZyhKU09OLnN0cmluZ2lmeShyMikpO1xuICAgICAgICB3ID0gcjEuY29uY2F0KHIyKTtcbiAgICB9XG4gICAgcmV0dXJuIHcubWFwKGZ1bmN0aW9uIChvTWFwKSB7XG4gICAgICAgIHJldHVybiBvTWFwLm1hcChmdW5jdGlvbiAoc1dvcmQpIHtcbiAgICAgICAgICAgIHJldHVybiB0cmltUXVvdGVkKHNXb3JkKTtcbiAgICAgICAgfSk7XG4gICAgfSk7XG59XG5leHBvcnRzLmJyZWFrZG93blN0cmluZyA9IGJyZWFrZG93blN0cmluZztcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
