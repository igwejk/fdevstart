/**
 * @file sentence
 * @module jfseb.fdevstart.sentence
 * @copyright (c) Gerd Forstmann
 *
 * Match a tool record on a sentence,
 *
 * This will unify matching required and optional category words
 * with the requirements of the tool.
 *
 */
"use strict";
// <reference path="../../lib/node-4.d.ts" />

var debug = require('debug');
var debuglog = debug('sentence');
function findWordByCategory(oSentence, sCategory) {
    var res = {};
    oSentence.every(function (oWord, iIndex) {
        if (oWord.category === sCategory) {
            res = { word: oWord,
                index: iIndex };
            return false;
        }
        return true;
    });
    return res;
}
exports.findWordByCategory = findWordByCategory;
function getDistinctCategoriesInSentence(oSentence) {
    var res = [];
    var resm = {};
    oSentence.forEach(function (oWord) {
        if (oWord.category === "category") {
            if (!resm[oWord.matchedString]) {
                res.push(oWord.matchedString);
                resm[oWord.matchedString] = 1;
            }
        }
    });
    return res;
}
exports.getDistinctCategoriesInSentence = getDistinctCategoriesInSentence;
function rankingGeometricMean(oSentence) {
    var length = oSentence.length;
    if (length === 0) {
        return 1.0;
    }
    var prod = oSentence.reduce(function (prev, oWord) {
        return prev * (oWord._ranking || 1.0);
    }, 1.0);
    // TODO: find somethign faster ;-)
    return Math.pow(prod, 1 / length);
}
exports.rankingGeometricMean = rankingGeometricMean;
function rankingProduct(oSentence) {
    return rankingGeometricMean(oSentence);
}
exports.rankingProduct = rankingProduct;
function cmpRankingProduct(a, b) {
    return -(rankingProduct(a) - rankingProduct(b));
}
exports.cmpRankingProduct = cmpRankingProduct;
function cutoffSentenceAtRatio(sentences) {
    if (sentences.length === 0) {
        return sentences;
    }
    var bestRank = rankingProduct(sentences[0]);
    for (var i = 1; i < Math.min(sentences.length, 300) && rankingProduct(sentences[i]) / bestRank > 0.8; ++i) {}
    debuglog("reduce sentences by " + i + "/" + sentences.length);
    return sentences.slice(0, i);
}
exports.cutoffSentenceAtRatio = cutoffSentenceAtRatio;
function dumpNice(sentence, fn) {
    var result = [];
    sentence.forEach(function (oWord, index) {
        var sWord = "[" + index + "] : " + (oWord._ranking || 0).toFixed(3) + " " + oWord.category + " \"" + oWord.string + "\" => \"" + oWord.matchedString + "\"";
        result.push(sWord + "\n");
    });
    result.push(".\n");
    return result.join("");
}
exports.dumpNice = dumpNice;
function dumpNiceArr(sentences, fn) {
    if (!sentences) {
        return "";
    }
    var res = sentences.reduce(function (prev, oSentence) {
        return prev + dumpNice(oSentence);
    }, "");
    return res;
}
exports.dumpNiceArr = dumpNiceArr;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9tYXRjaC9zZW50ZW5jZS50cyIsIm1hdGNoL3NlbnRlbmNlLmpzIl0sIm5hbWVzIjpbImRlYnVnIiwicmVxdWlyZSIsImRlYnVnbG9nIiwiZmluZFdvcmRCeUNhdGVnb3J5Iiwib1NlbnRlbmNlIiwic0NhdGVnb3J5IiwicmVzIiwiZXZlcnkiLCJvV29yZCIsImlJbmRleCIsImNhdGVnb3J5Iiwid29yZCIsImluZGV4IiwiZXhwb3J0cyIsImdldERpc3RpbmN0Q2F0ZWdvcmllc0luU2VudGVuY2UiLCJyZXNtIiwiZm9yRWFjaCIsIm1hdGNoZWRTdHJpbmciLCJwdXNoIiwicmFua2luZ0dlb21ldHJpY01lYW4iLCJsZW5ndGgiLCJwcm9kIiwicmVkdWNlIiwicHJldiIsIl9yYW5raW5nIiwiTWF0aCIsInBvdyIsInJhbmtpbmdQcm9kdWN0IiwiY21wUmFua2luZ1Byb2R1Y3QiLCJhIiwiYiIsImN1dG9mZlNlbnRlbmNlQXRSYXRpbyIsInNlbnRlbmNlcyIsImJlc3RSYW5rIiwiaSIsIm1pbiIsInNsaWNlIiwiZHVtcE5pY2UiLCJzZW50ZW5jZSIsImZuIiwicmVzdWx0Iiwic1dvcmQiLCJ0b0ZpeGVkIiwic3RyaW5nIiwiam9pbiIsImR1bXBOaWNlQXJyIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7Ozs7QUNXQTtBRENBOztBQUVBLElBQVlBLFFBQUtDLFFBQU0sT0FBTixDQUFqQjtBQU1BLElBQU1DLFdBQVdGLE1BQU0sVUFBTixDQUFqQjtBQUVBLFNBQUFHLGtCQUFBLENBQW1DQyxTQUFuQyxFQUE4Q0MsU0FBOUMsRUFBZ0U7QUFDN0QsUUFBSUMsTUFBTSxFQUFWO0FBQ0NGLGNBQVVHLEtBQVYsQ0FBZ0IsVUFBU0MsS0FBVCxFQUFnQkMsTUFBaEIsRUFBc0I7QUFDcEMsWUFBR0QsTUFBTUUsUUFBTixLQUFtQkwsU0FBdEIsRUFBaUM7QUFDL0JDLGtCQUFNLEVBQUVLLE1BQU1ILEtBQVI7QUFDRUksdUJBQVFILE1BRFYsRUFBTjtBQUVBLG1C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bUYsVUFBbkYsR0FBNEZuQyxNQUFNUyxhQUFsRyxHQUErRyxJQUEzSDtBQUNBdUIsZUFBT3RCLElBQVAsQ0FBWXVCLFFBQVEsSUFBcEI7QUFDRCxLQUhEO0FBSUFELFdBQU90QixJQUFQLENBQVksS0FBWjtBQUNBLFdBQU9zQixPQUFPSSxJQUFQLENBQVksRUFBWixDQUFQO0FBQ0g7QUFSZS9CLFFBQUF3QixRQUFBLEdBQVFBLFFBQVI7QUFXaEIsU0FBQVEsV0FBQSxDQUE0QmIsU0FBNUIsRUFBNERPLEVBQTVELEVBQXFFO0FBQ25FLFFBQUcsQ0FBQ1AsU0FBSixFQUFlO0FBQ2IsZUFBTyxFQUFQO0FBQ0Q7QUFDRCxRQUFJMUIsTUFBTTBCLFVBQVVWLE1BQVYsQ0FBaUIsVUFBU0MsSUFBVCxFQUFlbkIsU0FBZixFQUF3QjtBQUNqRCxlQUFPbUIsT0FBT2MsU0FBU2pDLFNBQVQsQ0FBZDtBQUNELEtBRlMsRUFFUCxFQUZPLENBQVY7QUFHQSxXQUFPRSxHQUFQO0FBQ0Q7QUFSZU8sUUFBQWdDLFdBQUEsR0FBV0EsV0FBWCIsImZpbGUiOiJtYXRjaC9zZW50ZW5jZS5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQGZpbGUgc2VudGVuY2VcbiAqIEBtb2R1bGUgamZzZWIuZmRldnN0YXJ0LnNlbnRlbmNlXG4gKiBAY29weXJpZ2h0IChjKSBHZXJkIEZvcnN0bWFublxuICpcbiAqIE1hdGNoIGEgdG9vbCByZWNvcmQgb24gYSBzZW50ZW5jZSxcbiAqXG4gKiBUaGlzIHdpbGwgdW5pZnkgbWF0Y2hpbmcgcmVxdWlyZWQgYW5kIG9wdGlvbmFsIGNhdGVnb3J5IHdvcmRzXG4gKiB3aXRoIHRoZSByZXF1aXJlbWVudHMgb2YgdGhlIHRvb2wuXG4gKlxuICovXG5cbi8vIDxyZWZlcmVuY2UgcGF0aD1cIi4uLy4uL2xpYi9ub2RlLTQuZC50c1wiIC8+XG5cbmltcG9ydCAqIGFzIGRlYnVnIGZyb20gJ2RlYnVnJztcblxuLy8gaW1wb3J0ICogYXMgdXRpbHMgZnJvbSAnLi4vdXRpbHMvdXRpbHMnO1xuXG5pbXBvcnQgKiBhcyBJTWF0Y2ggZnJvbSAnLi9pZm1hdGNoJztcblxuY29uc3QgZGVidWdsb2cgPSBkZWJ1Zygnc2VudGVuY2UnKVxuXG5leHBvcnQgZnVuY3Rpb24gZmluZFdvcmRCeUNhdGVnb3J5KG9TZW50ZW5jZSwgc0NhdGVnb3J5IDogc3RyaW5nKSA6IHsgd29yZCA6IElNYXRjaC5JV29yZCwgaW5kZXggOiBudW1iZXJ9IHtcbiAgXHR2YXIgcmVzID0ge30gYXMgeyB3b3JkIDogSU1hdGNoLklXb3JkLCBpbmRleCA6IG51bWJlcn07XG4gICAgb1NlbnRlbmNlLmV2ZXJ5KGZ1bmN0aW9uKG9Xb3JkLCBpSW5kZXgpIHtcbiAgICAgIGlmKG9Xb3JkLmNhdGVnb3J5ID09PSBzQ2F0ZWdvcnkpIHtcbiAgICAgICAgcmVzID0geyB3b3JkOiBvV29yZCxcbiAgICAgICAgICAgICAgICBpbmRleCA6IGlJbmRleCB9O1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9KVxuICAgIHJldHVybiByZXM7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBnZXREaXN0aW5jdENhdGVnb3JpZXNJblNlbnRlbmNlKG9TZW50ZW5jZSA6IElNYXRjaC5JU2VudGVuY2UpIDogc3RyaW5nW10ge1xuICB2YXIgcmVzID0gW107XG4gIHZhciByZXNtID0ge307XG4gIG9TZW50ZW5jZS5mb3JFYWNoKGZ1bmN0aW9uKG9Xb3JkKSB7XG4gICAgaWYob1dvcmQuY2F0ZWdvcnkgPT09IFwiY2F0ZWdvcnlcIikge1xuICAgICAgaWYoIXJlc21bb1dvcmQubWF0Y2hlZFN0cmluZ10pIHtcbiAgICAgICAgcmVzLnB1c2gob1dvcmQubWF0Y2hlZFN0cmluZyk7XG4gICAgICAgIHJlc21bb1dvcmQubWF0Y2hlZFN0cmluZ10gPSAxO1xuICAgICAgfVxuICAgIH1cbiAgfSk7XG4gIHJldHVybiByZXM7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByYW5raW5nR2VvbWV0cmljTWVhbihvU2VudGVuY2UgOiBJTWF0Y2guSVNlbnRlbmNlKSA6IG51bWJlciB7XG4gIGNvbnN0IGxlbmd0aCA9IG9TZW50ZW5jZS5sZW5ndGg7XG4gIGlmKGxlbmd0aCA9PT0gMCkge1xuICAgIHJldHVybiAxLjA7XG4gIH1cbiAgdmFyIHByb2QgPSAgb1NlbnRlbmNlLnJlZHVjZShmdW5jdGlvbihwcmV2LCBvV29yZCkge1xuICAgIHJldHVybiBwcmV2ICogKG9Xb3JkLl9yYW5raW5nIHx8IDEuMCk7XG4gIH0sMS4wKTtcbiAgLy8gVE9ETzogZmluZCBzb21ldGhpZ24gZmFzdGVyIDstKVxuICByZXR1cm4gTWF0aC5wb3cocHJvZCwgMS9sZW5ndGgpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gcmFua2luZ1Byb2R1Y3Qob1NlbnRlbmNlOiBJTWF0Y2guSVNlbnRlbmNlKSA6IG51bWJlciB7XG4gIHJldHVybiByYW5raW5nR2VvbWV0cmljTWVhbihvU2VudGVuY2UpO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gY21wUmFua2luZ1Byb2R1Y3QoYSA6IElNYXRjaC5JU2VudGVuY2UsIGIgOiBJTWF0Y2guSVNlbnRlbmNlKSB7XG4gIHJldHVybiAtIChyYW5raW5nUHJvZHVjdChhKSAtIHJhbmtpbmdQcm9kdWN0KGIpKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGN1dG9mZlNlbnRlbmNlQXRSYXRpbyhzZW50ZW5jZXMgOiBJTWF0Y2guSVNlbnRlbmNlW10pIHtcbiAgaWYoc2VudGVuY2VzLmxlbmd0aCA9PT0gMCl7XG4gICAgcmV0dXJuIHNlbnRlbmNlcztcbiAgfVxuICB2YXIgYmVzdFJhbmsgPSByYW5raW5nUHJvZHVjdChzZW50ZW5jZXNbMF0pO1xuICBmb3IodmFyIGkgPSAxOyAoaSA8IE1hdGgubWluKHNlbnRlbmNlcy5sZW5ndGgsIDMwMCkpICYmICgocmFua2luZ1Byb2R1Y3Qoc2VudGVuY2VzW2ldKS8gYmVzdFJhbmspID4gMC44KTsgKysgaSkge1xuICAgIC8vIGVtcHR5XG4gIH1cbiAgZGVidWdsb2coXCJyZWR1Y2Ugc2VudGVuY2VzIGJ5IFwiICsgaSArIFwiL1wiICsgc2VudGVuY2VzLmxlbmd0aCk7XG4gIHJldHVybiBzZW50ZW5jZXMuc2xpY2UoMCxpKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGR1bXBOaWNlKHNlbnRlbmNlIDogSU1hdGNoLklTZW50ZW5jZSwgZm4/OiBhbnkpIDogc3RyaW5nIHtcbiAgdmFyIHJlc3VsdCA9IFtdO1xuICAgIHNlbnRlbmNlLmZvckVhY2goZnVuY3Rpb24ob1dvcmQsIGluZGV4KSB7XG4gICAgICB2YXIgc1dvcmQgPSBgWyR7aW5kZXh9XSA6ICR7KG9Xb3JkLl9yYW5raW5nIHx8IDApLnRvRml4ZWQoMyl9ICR7b1dvcmQuY2F0ZWdvcnl9IFwiJHtvV29yZC5zdHJpbmd9XCIgPT4gXCIke29Xb3JkLm1hdGNoZWRTdHJpbmd9XCJgXG4gICAgICByZXN1bHQucHVzaChzV29yZCArIFwiXFxuXCIpO1xuICAgIH0pXG4gICAgcmVzdWx0LnB1c2goXCIuXFxuXCIpO1xuICAgIHJldHVybiByZXN1bHQuam9pbihcIlwiKTtcbn1cblxuXG5leHBvcnQgZnVuY3Rpb24gZHVtcE5pY2VBcnIoc2VudGVuY2VzIDogSU1hdGNoLklTZW50ZW5jZVtdLCBmbj8gOiBhbnkpIDogc3RyaW5nIHtcbiAgaWYoIXNlbnRlbmNlcykge1xuICAgIHJldHVybiBcIlwiO1xuICB9XG4gIHZhciByZXMgPSBzZW50ZW5jZXMucmVkdWNlKGZ1bmN0aW9uKHByZXYsIG9TZW50ZW5jZSkge1xuICAgIHJldHVybiBwcmV2ICsgZHVtcE5pY2Uob1NlbnRlbmNlKTtcbiAgfSwgXCJcIilcbiAgcmV0dXJuIHJlcztcbn0iLCIvKipcbiAqIEBmaWxlIHNlbnRlbmNlXG4gKiBAbW9kdWxlIGpmc2ViLmZkZXZzdGFydC5zZW50ZW5jZVxuICogQGNvcHlyaWdodCAoYykgR2VyZCBGb3JzdG1hbm5cbiAqXG4gKiBNYXRjaCBhIHRvb2wgcmVjb3JkIG9uIGEgc2VudGVuY2UsXG4gKlxuICogVGhpcyB3aWxsIHVuaWZ5IG1hdGNoaW5nIHJlcXVpcmVkIGFuZCBvcHRpb25hbCBjYXRlZ29yeSB3b3Jkc1xuICogd2l0aCB0aGUgcmVxdWlyZW1lbnRzIG9mIHRoZSB0b29sLlxuICpcbiAqL1xuXCJ1c2Ugc3RyaWN0XCI7XG4vLyA8cmVmZXJlbmNlIHBhdGg9XCIuLi8uLi9saWIvbm9kZS00LmQudHNcIiAvPlxudmFyIGRlYnVnID0gcmVxdWlyZSgnZGVidWcnKTtcbnZhciBkZWJ1Z2xvZyA9IGRlYnVnKCdzZW50ZW5jZScpO1xuZnVuY3Rpb24gZmluZFdvcmRCeUNhdGVnb3J5KG9TZW50ZW5jZSwgc0NhdGVnb3J5KSB7XG4gICAgdmFyIHJlcyA9IHt9O1xuICAgIG9TZW50ZW5jZS5ldmVyeShmdW5jdGlvbiAob1dvcmQsIGlJbmRleCkge1xuICAgICAgICBpZiAob1dvcmQuY2F0ZWdvcnkgPT09IHNDYXRlZ29yeSkge1xuICAgICAgICAgICAgcmVzID0geyB3b3JkOiBvV29yZCxcbiAgICAgICAgICAgICAgICBpbmRleDogaUluZGV4IH07XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSk7XG4gICAgcmV0dXJuIHJlcztcbn1cbmV4cG9ydHMuZmluZFdvcmRCeUNhdGVnb3J5ID0gZmluZFdvcmRCeUNhdGVnb3J5O1xuZnVuY3Rpb24gZ2V0RGlzdGluY3RDYXRlZ29yaWVzSW5TZW50ZW5jZShvU2VudGVuY2UpIHtcbiAgICB2YXIgcmVzID0gW107XG4gICAgdmFyIHJlc20gPSB7fTtcbiAgICBvU2VudGVuY2UuZm9yRWFjaChmdW5jdGlvbiAob1dvcmQpIHtcbiAgICAgICAgaWYgKG9Xb3JkLmNhdGVnb3J5ID09PSBcImNhdGVnb3J5XCIpIHtcbiAgICAgICAgICAgIGlmICghcmVzbVtvV29yZC5tYXRjaGVkU3RyaW5nXSkge1xuICAgICAgICAgICAgICAgIHJlcy5wdXNoKG9Xb3JkLm1hdGNoZWRTdHJpbmcpO1xuICAgICAgICAgICAgICAgIHJlc21bb1dvcmQubWF0Y2hlZFN0cmluZ10gPSAxO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgfSk7XG4gICAgcmV0dXJuIHJlcztcbn1cbmV4cG9ydHMuZ2V0RGlzdGluY3RDYXRlZ29yaWVzSW5TZW50ZW5jZSA9IGdldERpc3RpbmN0Q2F0ZWdvcmllc0luU2VudGVuY2U7XG5mdW5jdGlvbiByYW5raW5nR2VvbWV0cmljTWVhbihvU2VudGVuY2UpIHtcbiAgICB2YXIgbGVuZ3RoID0gb1NlbnRlbmNlLmxlbmd0aDtcbiAgICBpZiAobGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHJldHVybiAxLjA7XG4gICAgfVxuICAgIHZhciBwcm9kID0gb1NlbnRlbmNlLnJlZHVjZShmdW5jdGlvbiAocHJldiwgb1dvcmQpIHtcbiAgICAgICAgcmV0dXJuIHByZXYgKiAob1dvcmQuX3JhbmtpbmcgfHwgMS4wKTtcbiAgICB9LCAxLjApO1xuICAgIC8vIFRPRE86IGZpbmQgc29tZXRoaWduIGZhc3RlciA7LSlcbiAgICByZXR1cm4gTWF0aC5wb3cocHJvZCwgMSAvIGxlbmd0aCk7XG59XG5leHBvcnRzLnJhbmtpbmdHZW9tZXRyaWNNZWFuID0gcmFua2luZ0dlb21ldHJpY01lYW47XG5mdW5jdGlvbiByYW5raW5nUHJvZHVjdChvU2VudGVuY2UpIHtcbiAgICByZXR1cm4gcmFua2luZ0dlb21ldHJpY01lYW4ob1NlbnRlbmNlKTtcbn1cbmV4cG9ydHMucmFua2luZ1Byb2R1Y3QgPSByYW5raW5nUHJvZHVjdDtcbmZ1bmN0aW9uIGNtcFJhbmtpbmdQcm9kdWN0KGEsIGIpIHtcbiAgICByZXR1cm4gLShyYW5raW5nUHJvZHVjdChhKSAtIHJhbmtpbmdQcm9kdWN0KGIpKTtcbn1cbmV4cG9ydHMuY21wUmFua2luZ1Byb2R1Y3QgPSBjbXBSYW5raW5nUHJvZHVjdDtcbmZ1bmN0aW9uIGN1dG9mZlNlbnRlbmNlQXRSYXRpbyhzZW50ZW5jZXMpIHtcbiAgICBpZiAoc2VudGVuY2VzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgICByZXR1cm4gc2VudGVuY2VzO1xuICAgIH1cbiAgICB2YXIgYmVzdFJhbmsgPSByYW5raW5nUHJvZHVjdChzZW50ZW5jZXNbMF0pO1xuICAgIGZvciAodmFyIGkgPSAxOyAoaSA8IE1hdGgubWluKHNlbnRlbmNlcy5sZW5ndGgsIDMwMCkpICYmICgocmFua2luZ1Byb2R1Y3Qoc2VudGVuY2VzW2ldKSAvIGJlc3RSYW5rKSA+IDAuOCk7ICsraSkge1xuICAgIH1cbiAgICBkZWJ1Z2xvZyhcInJlZHVjZSBzZW50ZW5jZXMgYnkgXCIgKyBpICsgXCIvXCIgKyBzZW50ZW5jZXMubGVuZ3RoKTtcbiAgICByZXR1cm4gc2VudGVuY2VzLnNsaWNlKDAsIGkpO1xufVxuZXhwb3J0cy5jdXRvZmZTZW50ZW5jZUF0UmF0aW8gPSBjdXRvZmZTZW50ZW5jZUF0UmF0aW87XG5mdW5jdGlvbiBkdW1wTmljZShzZW50ZW5jZSwgZm4pIHtcbiAgICB2YXIgcmVzdWx0ID0gW107XG4gICAgc2VudGVuY2UuZm9yRWFjaChmdW5jdGlvbiAob1dvcmQsIGluZGV4KSB7XG4gICAgICAgIHZhciBzV29yZCA9IFwiW1wiICsgaW5kZXggKyBcIl0gOiBcIiArIChvV29yZC5fcmFua2luZyB8fCAwKS50b0ZpeGVkKDMpICsgXCIgXCIgKyBvV29yZC5jYXRlZ29yeSArIFwiIFxcXCJcIiArIG9Xb3JkLnN0cmluZyArIFwiXFxcIiA9PiBcXFwiXCIgKyBvV29yZC5tYXRjaGVkU3RyaW5nICsgXCJcXFwiXCI7XG4gICAgICAgIHJlc3VsdC5wdXNoKHNXb3JkICsgXCJcXG5cIik7XG4gICAgfSk7XG4gICAgcmVzdWx0LnB1c2goXCIuXFxuXCIpO1xuICAgIHJldHVybiByZXN1bHQuam9pbihcIlwiKTtcbn1cbmV4cG9ydHMuZHVtcE5pY2UgPSBkdW1wTmljZTtcbmZ1bmN0aW9uIGR1bXBOaWNlQXJyKHNlbnRlbmNlcywgZm4pIHtcbiAgICBpZiAoIXNlbnRlbmNlcykge1xuICAgICAgICByZXR1cm4gXCJcIjtcbiAgICB9XG4gICAgdmFyIHJlcyA9IHNlbnRlbmNlcy5yZWR1Y2UoZnVuY3Rpb24gKHByZXYsIG9TZW50ZW5jZSkge1xuICAgICAgICByZXR1cm4gcHJldiArIGR1bXBOaWNlKG9TZW50ZW5jZSk7XG4gICAgfSwgXCJcIik7XG4gICAgcmV0dXJuIHJlcztcbn1cbmV4cG9ydHMuZHVtcE5pY2VBcnIgPSBkdW1wTmljZUFycjtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
