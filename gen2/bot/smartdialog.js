/**
 * The bot implementation
 *
 * Instantiate apssing a connector via
 * makeBot
 *
 */
/**
 * @file
 * @module jfseb.fdevstart.smartdialog
 * @copyright (c) 2016 Gerd Forstmann
 */
//declare module 'elizabot' { };
//declare module 'winston-pg' { };
//delcare module 'winston' {};
"use strict";

var builder = require("botbuilder");
var debug = require("debug");
var Match = require("../match/match");
var Analyze = require("../match/analyze");
var BreakDown = require("../match/breakdown");
var WhatIs = require("../match/whatis");
var ListAll = require("../match/listall");
var Describe = require("../match/describe");
var MakeTable = require("../exec/makeqbetable");
var Utils = require("../utils/utils");
var ErError = require("../match/ererror");
var _ = require("lodash");
var DialogLogger = require("../utils/dialoglogger");
var process = require("process");
var dburl = process.env.DATABASE_URL || "";
var pglocalurl = "postgres://joe:abcdef@localhost:5432/abot";
var dburl = process.env.DATABASE_URL || pglocalurl;
var pg = require("pg");
var o = pg;
if (!process.env.ABOT_DBNOSSL) {
    o.defaults.ssl = true; // Only used internally !
}
var dialogLogger = DialogLogger.logger("smartbot", dburl, pg);
function send(o) {
    return o;
}
;
function dialoglog(intent, session, response) {
    var sResponse;
    var sAction;
    if (typeof response === "string") {
        sAction = "";
        sResponse = response;
    } else {
        var aMessage = response;
        var iMessage = aMessage.toMessage();
        sResponse = iMessage.text;
        sAction = iMessage.entities && iMessage.entities[0] ? JSON.stringify(iMessage.entities && iMessage.entities[0]) : "";
    }
    dialogLogger({
        intent: intent,
        session: session,
        response: sResponse,
        action: sAction
    });
    session.send(response);
}
//const pgLogger = new PgLogger({
//  name: 'test-logger',
//  level: 'debug',
//  connString: 'postgres://ubuntu@localhost:5432/circle_test',
//  tableName: 'winston_logs',
//});
//winston.add(winston.transports.File, { filename: 'winston_out.log', timestamp : true });
//  winston.remove(winston.transports.Console);
//winston.add(pgLogger);
/*
const logger = new winston.Logger({
  transports: [
    new winston.transports.Console({
      color: true,
      timestamp: true,
    }),
    pgLogger,
  ]
});
*/
//pgLogger.initTable(done);
var elizabot = require('../extern/elizabot/elizabot.js');
//import * as elizabot from 'elizabot';
var debuglog = debug('smartdialog');
var PlainRecognizer = require("./plainrecognizer");
//var builder = require('botbuilder');
var dispatcher = require('../match/dispatcher.js').dispatcher;
function getConversationId(session) {
    return session.message && session.message.address && session.message.address.conversation.id;
}
var elizabots = {};
function getElizaBot(id) {
    if (!elizabots[id]) {
        elizabots[id] = {
            access: new Date(),
            elizabot: new elizabot()
        };
    }
    elizabots[id].access = new Date();
    return elizabots[id].elizabot;
}
var newFlow = true;
var Model = require("../model/model");
var ExecServer = require("../exec/execserver");
//const theDefaultModel = Model.loadModels();
var models = {};
function loadModel(modelPath) {
    modelPath = modelPath || "";
    if (!models[modelPath]) {
        models[modelPath] = Model.loadModels(modelPath);
    }
    return models[modelPath];
}
if (newFlow) {} else {}
function isAnonymous(userid) {
    return userid.indexOf("ano:") === 0;
}
function restrictLoggedOn(session, arr) {
    var userid = session.message.address && session.message.address.user && session.message.address.user.id || "";
    if (process.env.ABOT_EMAIL_USER && isAnonymous(userid)) {
        if (arr.length < 6) {
            return arr;
        }
        var len = arr.length;
        var res = arr.slice(0, Math.min(Math.max(Math.floor(arr.length / 3), 7), arr.length));
        if (typeof arr[0] === "string") {
            var delta = len - res.length;
            res.push("... and " + delta + " more entries for registered users");
        }
        return res;
    }
    return arr;
}
/*
export class SimpleRecognizer implements builder.IIntentRecognizer {
  constructor() {

  }

  recognize(context: builder.IRecognizeContext, callback: (err: Error, result: builder.IIntentRecognizerResult) => void): void {
    var u = {} as builder.IIntentRecognizerResult;

    debuglog("recognizing " + context.message.text);
    if (context.message.text.indexOf("start") >= 0) {
      u.intent = "ShowEntity";
      u.score = 0.9;
      var e1 = {} as builder.IEntity;
      e1.startIndex = "start ".length;
      e1.endIndex = context.message.text.length;
      e1.score = 0.3;
      u.entities = [e1];
      callback(undefined, u);
      return;
    }

    if (context.message.text.indexOf("train") >= 0) {
      u.intent = "train";
      u.score = 0.9;
      var e1 = {} as builder.IEntity;
      e1.startIndex = "train ".length;
      e1.endIndex = context.message.text.length;
      e1.score = 0.3;
      u.entities = [e1];
      callback(undefined, u);
      return;
    }
    if (context.message.text.indexOf("learn") >= 0) {
      u.intent = "learn";
      u.score = 0.9;
      var e1 = {} as builder.IEntity;
      e1.type = "trainFact";
      e1.startIndex = "train ".length;
      e1.endIndex = context.message.text.length;
      e1.score = 0.3;
      u.entities = [e1];
      callback(undefined, u);
      return;
    }
    if (context.message.text.indexOf("help") >= 0) {
      u.intent = "help";
      u.score = 0.9;
      var e1 = {} as builder.IEntity;
      e1.startIndex = "train ".length;
      e1.endIndex = context.message.text.length;
      e1.score = 0.3;
      u.entities = [e1];
      callback(undefined, u);
      return;
    }
    if (context.message.text.indexOf("exit") >= 0) {
      u.intent = "exit";
      u.score = 0.9;
      var e1 = {} as builder.IEntity;
      e1.startIndex = "exit ".length;
      e1.endIndex = context.message.text.length;
      e1.score = 0.3;
      u.entities = [e1];
      callback(undefined, u);
      return;
    }
    if (context.message.text.indexOf("wrong") >= 0) {
      u.intent = "wrong";
      u.score = 0.9;
      var e1 = {} as builder.IEntity;
      e1.startIndex = "exit ".length;
      e1.endIndex = context.message.text.length;
      e1.score = 0.3;
      u.entities = [e1];
      callback(undefined, u);
      return;
    }
    debuglog('recognizing nothing');
    u.intent = "None";
    u.score = 0.1;
    var e1 = {} as builder.IEntity;
    e1.startIndex = "exit ".length;
    e1.endIndex = context.message.text.length;
    e1.score = 0.1;
    u.entities = [];
    callback(undefined, u);
  }
}
*/
var aTrainReplies = ["Thank you for sharing this suggestion with us", "Thank for for this valuable information.", "Thank for for this interesting fact!", "Thats a plethoria of information.", "That's a nugget of information.", "Lovely, I may consider you input.", "Well done, anything more to let me know?", "I do appreciate your teaching and my learning experience, or was it the other way round?", "Your helpful input has been stored in some dusty corner of the World wide web!", "Thank you for my learning experience!", "I have incorporated your valuable suggestion in the wisdom of the internet"];
var aTrainDialog = aTrainReplies;
var aTrainExitHint = ["\ntype \"done\" when you are done training me.", "", "", "", "\nremember, you are stuck here instructing me, type \"done\" to return.", ""];
var aEnterTrain = ['So you think this is wrong? You can offer your advise here.\n Type "done" if you are done with instructing me', 'Feel free to offer me your better solution here.\nType "done" if you are done with instructing me', 'Some say "The secret to happiness is to lower your expectations to the point they are already met.", \nt if you could help me to become better, instruct me.\n Type "done" if you are done with teaching me', 'Feel free to offer me your better solution here.\n Type "done" if you are done with instructing me', 'Feel free to offer me your better solution here.\n Type "done" if you are done with instructing me'];
var aBackFromTraining = ['Puuh, back from training! Now for the easy part ...\n ask me a new question.', 'Live and don\'t learn, that\'s us. Naah, we\'ll see.\nAsk me another question.', 'The secret to happiness is to lower your expectations to the point they are already met.\n Ask me a question.', 'Thanks for having this lecture session, now i am back to our usual self.\n Ask me a question.'];
var aTrainNoKlingon = ["He who master the dark arts of SAP must not dwell in the earthly realms of Start Trek.", "SAP is a cloud company, not a space company.", "The depth of R/3 are deeper than Deep Space 42.", "My brainpower is fully absorbed with mastering other realms.", "For the wosap, the sky is the limit. Feel free to check out nasa.gov .", "The future is SAP or IBM blue, not space black.", "That's left to some musky future."];
exports.aResponsesOnTooLong = ["Your input should be eloquent in it's brevity. This one was too long.", "my wisdom is severly bound by my limited input processing capabilities. Could you formulate a shorter input? Thank you.", "The length of you input indicates you probably know more about the topic than me? Can i humbly ask you to formulate a shorter question?", '\"What ever you want to teach, be brief\" (Horace). While this does not always applies to my answers, it is require for your questions. Please try again with a refined questions.', 'I understand more than 4-letter words, but not more than 20 word sentences. Please try to shorten your input.', 'the sky is the limit? Air force member or not, you can ask longer questions than \"the sky\", but not this long', 'My answers may be exhaustive, but I understand more than 4-letter words, but not more than 20 word sentences. Sorry.', 'Our conversation must be highly assymmetric: my answers may be verbose and exhaustive and fuzzy, questions and input must be brief. Try to reformulate it'];
exports.metawordsDescriptions = {
    "category": "an attribute of a record in a model, example: a Planet has a \"name\" attribute",
    "domain": "a group of facts which are typically unrelated",
    "key": "an attribute value (of a category) which  is unique for the record",
    "tool": "is potentialy command to execute",
    "record": "a specific set of \"fact\"s of a domain, a \"record\" has a set of attributes values (\"fact\"s) of the categories, often a record has a \"key\"",
    "fact": "a specific category value of a record in a domain, may be a \"key\" value"
};
function getRandomResult(arr) {
    return arr[Math.floor(Math.random() * arr.length) % arr.length];
}
var SimpleUpDownRecognizer = function () {
    function SimpleUpDownRecognizer() {}
    SimpleUpDownRecognizer.prototype.recognize = function (context, callback) {
        var u = {};
        debuglog("recognizing " + context.message.text);
        if (context.message.text.indexOf("down") >= 0) {
            u.intent = "intent.down";
            u.score = 0.9;
            var e1 = {};
            e1.startIndex = "start ".length;
            e1.endIndex = context.message.text.length;
            e1.score = 0.3;
            u.entities = [e1];
            callback(undefined, u);
            return;
        }
        if (context.message.text.indexOf("up") >= 0) {
            u.intent = "intent.up";
            u.score = 0.9;
            var e1 = {};
            e1.startIndex = "up".length;
            e1.endIndex = context.message.text.length;
            e1.score = 0.3;
            u.entities = [e1];
            callback(undefined, u);
            return;
        }
        if (context.message.text.indexOf("done") >= 0) {
            u.intent = "intent.up";
            u.score = 0.9;
            var e1 = {};
            e1.startIndex = "up".length;
            e1.endIndex = context.message.text.length;
            e1.score = 0.3;
            u.entities = [e1];
            callback(undefined, u);
            return;
        }
        if (context.message.text.indexOf("exit") >= 0) {
            u.intent = "intent.up";
            u.score = 0.9;
            var e1 = {};
            e1.startIndex = "up".length;
            e1.endIndex = context.message.text.length;
            e1.score = 0.3;
            u.entities = [e1];
            callback(undefined, u);
            return;
        }
        if (context.message.text.indexOf("quit") >= 0) {
            u.intent = "intent.up";
            u.score = 0.9;
            var e1 = {};
            e1.startIndex = "up".length;
            e1.endIndex = context.message.text.length;
            e1.score = 0.3;
            u.entities = [e1];
            callback(undefined, u);
            return;
        }
        debuglog('recognizing nothing');
        u.intent = "None";
        u.score = 0.1;
        var e1 = {};
        e1.startIndex = "exit ".length;
        e1.endIndex = context.message.text.length;
        e1.score = 0.1;
        u.entities = [];
        callback(undefined, u);
    };
    return SimpleUpDownRecognizer;
}();
exports.SimpleUpDownRecognizer = SimpleUpDownRecognizer;
var AnyObject = Object;
// globalTunnel.initialize({
//  host: 'proxy.exxxample.com',
//  port: 8080
// })
// Create bot and bind to console
// var connector = new htmlconnector.HTMLConnector()
// connector.setAnswerHook(function (sAnswer) {
//  console.log('Got answer : ' + sAnswer + '\n')
// })
var bot;
// setTimeout(function () {
//   connector.processMessage('start unit test ABC ')
// }, 5000)
var fs = require("fs");
var oJSON = JSON.parse('' + fs.readFileSync('./resources/model/intents.json'));
var oRules = PlainRecognizer.parseRules(oJSON);
// var Recognizer = new (recognizer.RegExpRecognizer)(oRules);
function logQuery(session, intent, result) {
    fs.appendFile('./logs/showmequeries.txt', "\n" + JSON.stringify({
        text: session.message.text,
        timestamp: session.message.timestamp,
        intent: intent,
        res: result && result.length && Match.ToolMatch.dumpNice(result[0]) || "0",
        conversationId: session.message.address && session.message.address.conversation && session.message.address.conversation.id || "",
        userid: session.message.address && session.message.address.user && session.message.address.user.id || ""
    }), function (err, res) {
        if (err) {
            debuglog("logging failed " + err);
        }
    });
}
function logQueryWhatIs(session, intent, result) {
    fs.appendFile('./logs/showmequeries.txt', "\n" + JSON.stringify({
        text: session.message.text,
        timestamp: session.message.timestamp,
        intent: intent,
        res: result && result.length && WhatIs.dumpNice(result[0]) || "0",
        conversationId: session.message.address && session.message.address.conversation && session.message.address.conversation.id || "",
        userid: session.message.address && session.message.address.user && session.message.address.user.id || ""
    }), function (err, res) {
        if (err) {
            debuglog("logging failed " + err);
        }
    });
}
function logQueryWhatIsTupel(session, intent, result) {
    fs.appendFile('./logs/showmequeries.txt', "\n" + JSON.stringify({
        text: session.message.text,
        timestamp: session.message.timestamp,
        intent: intent,
        res: result && result.length && WhatIs.dumpNiceTupel(result[0]) || "0",
        conversationId: session.message.address && session.message.address.conversation && session.message.address.conversation.id || "",
        userid: session.message.address && session.message.address.user && session.message.address.user.id || ""
    }), function (err, res) {
        if (err) {
            debuglog("logging failed " + err);
        }
    });
}
var gwords = {};
/**
 * Construct a bot
 * @param connector {Connector} the connector to use
 * HTMLConnector
 * or connector = new builder.ConsoleConnector().listen()
 */
function makeBot(connector, modelPath, options) {
    var t = Date.now();
    var theModel = loadModel(modelPath);
    var t = Date.now() - t;
    if (options && options.showModelLoadTime) {
        console.log("model load time " + t);
    }
    bot = new builder.UniversalBot(connector);
    // Create LUIS recognizer that points at our model and add it as the root '/' dialog for our Cortana Bot.
    // var model = sensitive.modelurl;
    // var model = 'https://api.projectoxford.ai/luis/v2.0/apps/c413b2ef-382c-45bd-8ff0-f76d60e2a821?subscription-key=c21398b5980a4ce09f474bbfee93b892&q='
    var recognizer = new PlainRecognizer.RegExpRecognizer(oRules);
    var dialog = new builder.IntentDialog({ recognizers: [recognizer] });
    // dialog.onBegin(function(session,args) {
    // console.log("beginning ...")
    // session.dialogData.retryPrompt = args && args.retryPrompt || "I am sorry"
    // session.send("What do you want?")
    //
    // })
    var dialogUpDown = new builder.IntentDialog({ recognizers: [new SimpleUpDownRecognizer()] });
    bot.dialog('/updown', dialogUpDown);
    dialogUpDown.onBegin(function (session) {
        dialoglog("TrainMe", session, send(getRandomResult(aEnterTrain)));
        //session.send("Hi there, updown is waiting for you");
    });
    dialogUpDown.matches('intent.up', [function (session, args, next) {
        session.dialogData.abc = args || {};
        builder.Prompts.text(session, 'you want to exit training? type \"done\" again.');
    }, function (session, results, next) {
        session.dialogData.abc = results.reponse;
        next();
    }, function (session, results) {
        session.endDialogWithResult({ response: session.dialogData.abc });
    }]);
    dialogUpDown.matches('intent.down', [function (session, args, next) {
        session.dialogData.abc = args || {};
        builder.Prompts.text(session, 'you want to go down!');
    }, function (session, results, next) {
        session.dialogData.abc = -1; // results.reponse;
        next();
    }, function (session, results) {
        session.send("still going down?");
    }]);
    dialogUpDown.onDefault(function (session) {
        logQuery(session, "onDefault");
        var res = getRandomResult(aTrainDialog) + getRandomResult(aTrainExitHint);
        dialoglog("TrainMe", session, send(res));
    });
    bot.dialog('/train', [function (session, args, next) {
        session.dialgoData.abc = args || {};
        builder.Prompts.text(session, 'Do you want to train me');
    }, function (session, results, next) {
        session.dialogData.abc = results.reponse;
    }, function (session, results) {
        session.endDialogWithResult({ response: session.DialogData.abc });
    }]);
    bot.dialog('/', dialog);
    dialog.matches('ShowMe', [function (session, args, next) {
        var isCombinedIndex = {};
        var oNewEntity;
        // expecting entity A1
        debuglog("Show Entity");
        debuglog('raw: ' + JSON.stringify(args.entities), undefined, 2);
        var a1 = builder.EntityRecognizer.findEntity(args.entities, 'A1');
        var result = Analyze.analyzeAll(a1.entity, theModel.rules, theModel.tools, gwords);
        logQuery(session, 'ShowMe', result);
        // test.expect(3)
        //  test.deepEqual(result.weight, 120, 'correct weight');
        if (!result || result.length === 0) {
            next();
        }
        // debuglog('result : ' + JSON.stringify(result, undefined, 2));
        debuglog('best result : ' + JSON.stringify(result[0] || {}, undefined, 2));
        debuglog('top : ' + Match.ToolMatch.dumpWeightsTop(result, { top: 3 }));
        if (Analyze.isComplete(result[0])) {
            session.dialogData.result = result[0];
            //    session.send('Showing entity ...');
            next();
        } else if (Analyze.getPrompt(result[0])) {
            var prompt = Analyze.getPrompt(result[0]);
            session.dialogData.result = result[0];
            session.dialogData.prompt = prompt;
            dialoglog("ShowMe", session, send("Not enough information supplied: " + Match.ToolMatch.dumpNice(session.dialogData.result)));
            builder.Prompts.text(session, prompt.text);
        } else {
            var best = result.length ? Match.ToolMatch.dumpNice(result[0]) : "<nothing>";
            dialoglog("ShowMe", session, send('I did not understand this' + best));
        }
    }, function (session, results, next) {
        var result = session.dialogData.result;
        if (!result || result.length === 0) {
            next();
        }
        if (results.response) {
            // some prompting
            Analyze.setPrompt(session.dialogData.result, session.dialogData.prompt, results.response);
        }
        if (Analyze.isComplete(session.dialogData.result)) {
            next();
        } else if (Analyze.getPrompt(session.dialogData.result)) {
            var prompt = Analyze.getPrompt(session.dialogData.result);
            session.dialogData.prompt = prompt;
            builder.Prompts.text(session, prompt.text);
        }
    }, function (session, results, next) {
        var result = session.dialogData.result;
        if (results.response) {
            // some prompting
            Analyze.setPrompt(session.dialogData.result, session.dialogData.prompt, results.response);
        }
        if (Analyze.isComplete(session.dialogData.result)) {
            var exec = ExecServer.execTool(session.dialogData.result, theModel.records);
            var reply = new builder.Message(session).text(exec.text).addEntity(exec.action);
            // .addAttachment({ fallbackText: "I don't know", contentType: 'image/jpeg', contentUrl: "www.wombat.org" });
            dialoglog("ShowMe", session, send(reply));
        } else {
            if (session.dialogData.result) {
                dialoglog("ShowMe", session, send("Not enough information supplied: " + Match.ToolMatch.dumpNice(session.dialogData.result)));
            } else {
                dialoglog("ShowMe", session, send("I did not get what you want"));
            }
        }
    }]);
    dialog.matches('WhatIs', [function (session, args, next) {
        var isCombinedIndex = {};
        var oNewEntity;
        // expecting entity A1
        var message = session.message.text;
        debuglog("WhatIs Entities");
        debuglog(debuglog.enabled ? 'raw: ' + JSON.stringify(args.entities, undefined, 2) : '-');
        var categoryEntity = builder.EntityRecognizer.findEntity(args.entities, 'category');
        var category = categoryEntity.entity;
        var a1 = builder.EntityRecognizer.findEntity(args.entities, 'A1');
        var cats = [];
        try {
            cats = WhatIs.analyzeCategoryMultOnlyAndComma(category, theModel.rules, message);
            debuglog("here cats" + cats.join(","));
        } catch (e) {
            if (e) {
                debuglog("here exception" + e);
                dialoglog("WhatIs", session, send('I don\'t know anything about "' + category + (e ? '(' + e.toString() + ')' : "")));
                // next();
                return;
            }
        }
        var cat = undefined;
        // we have some cats, (or at least one)
        if (cats.length === 1) {
            cat = cats[0];
            if (!cat) {
                session.send('I don\'t know anything about "' + category + '"');
                // next();
                return;
            }
        }
        if (cats.length === 1) {
            debuglog('category identified:' + cat);
            var result = WhatIs.resolveCategory(cat, a1.entity, theModel.rules, theModel.records);
            debuglog(debuglog.enabled ? 'whatis result:' + JSON.stringify(result) : '-');
            logQueryWhatIs(session, 'WhatIs', result.answers);
            var indis = WhatIs.isIndiscriminateResult(result.answers);
            if (indis) {
                session.send(indis);
                // next();
                return;
            }
            if (!result || result.answers.length === 0) {
                var explain = '';
                if (result.errors.length) {
                    explain = ErError.explainError(result.errors);
                }
                dialoglog("WhatIs", session, send('I don\'t know anything about "' + cat + " (" + category + ')\" in relation to "' + a1.entity + ("\"." + explain)));
                // next();
                return;
            } else {
                // debuglog('result : ' + JSON.stringify(result, undefined, 2));
                debuglog(debuglog.enabled ? 'best result : ' + JSON.stringify(result.answers[0] || {}, undefined, 2) : '-');
                debuglog(debuglog.enabled ? 'top : ' + WhatIs.dumpWeightsTop(result.answers, { top: 3 }) : '-');
                // TODO cleansed sentence
                dialoglog("WhatIs", session, send('The ' + category + ' of ' + a1.entity + ' is ' + result.answers[0].result + "\n")); //  + JSON.stringify(result[0]));
            }
        } // single category
        else {
                debuglog('categories identified:' + cats.join(","));
                var resultArr = WhatIs.resolveCategories(cats, a1.entity, theModel);
                debuglog(debuglog.enabled ? 'mulst whatis result:' + JSON.stringify(resultArr) : '-');
                logQueryWhatIsTupel(session, 'WhatIs', resultArr.tupelanswers);
                var indis = WhatIs.isIndiscriminateResultTupel(resultArr.tupelanswers);
                if (indis) {
                    session.send(indis);
                    // next();
                    return;
                }
                if (!resultArr || !resultArr.tupelanswers || resultArr.tupelanswers.length === 0) {
                    var explain = '';
                    if (resultArr.errors.length) {
                        explain = ErError.explainError(resultArr.errors);
                    }
                    dialoglog("WhatIs", session, send('I don\'t know anything about "' + category + "\" (" + Utils.listToQuotedCommaAnd(cats) + ')\" in relation to "' + a1.entity + ("\"" + explain)));
                    // next();
                    return;
                } else {
                    // debuglog('result : ' + JSON.stringify(result, undefined, 2));
                    debuglog(debuglog.enabled ? 'best result : ' + JSON.stringify(resultArr.tupelanswers[0] || {}, undefined, 2) : '-');
                    //debuglog('top : ' + WhatIs.dumpWeightsTop(resultArr, { top: 3 }));
                    // TODO cleansed sentence
                    dialoglog("WhatIs", session, send('The ' + Utils.listToQuotedCommaAnd(cats) + ' of ' + a1.entity + ' are ' + Utils.listToQuotedCommaAnd(resultArr.tupelanswers[0].result) + '\n')); //  + JSON.stringify(result[0]));
                }
            } //endif multiple categories
    }]);
    dialog.matches('ListAll', [function (session, args, next) {
        var isCombinedIndex = {};
        var oNewEntity;
        // expecting entity A1
        var message = session.message.text;
        debuglog("Intent : ListAll");
        debuglog(debuglog.enabled ? 'raw: ' + JSON.stringify(args.entities, undefined, 2) : '-');
        var categoryEntity = builder.EntityRecognizer.findEntity(args.entities, 'categories');
        var category = categoryEntity.entity;
        var inSthEntity = builder.EntityRecognizer.findEntity(args.entities, 'insth');
        var inSomething = inSthEntity && inSthEntity.entity;
        // some metaqueries:
        if (category === "categories") {
            // do we have a filter ?
            var domain = undefined;
            if (inSomething) {
                domain = ListAll.inferDomain(theModel, inSomething);
            }
            if (!domain) {
                var res = restrictLoggedOn(session, theModel.category).join(";\n");
                if (inSomething) {
                    dialoglog("ListAll", session, send("I did not infer a domain restriction from \"" + Utils.stripQuotes(inSomething) + "\", all my categories are ...\n" + res));
                } else {
                    dialoglog("ListAll", session, send("my categories are ...\n" + res));
                }
                return;
            } else {
                var aRes = Model.getCategoriesForDomain(theModel, domain);
                var res = restrictLoggedOn(session, aRes).join(";\n");
                dialoglog("ListAll", session, send("my categories in domain \"" + domain + "\" are ...\n" + res));
                return;
            }
        }
        if (category === "domains") {
            var res = restrictLoggedOn(session, theModel.domains).join(";\n");
            dialoglog("ListAll", session, send("my domains are ...\n" + res));
            return;
        }
        if (category === "tools") {
            var res = restrictLoggedOn(session, theModel.tools).map(function (oTool) {
                return oTool.name;
            }).join(";\n");
            dialoglog("ListAll", session, send("my tools are ...\n" + res));
            return;
        }
        var cats = [];
        try {
            cats = WhatIs.analyzeCategoryMultOnlyAndComma(category, theModel.rules, message);
            debuglog("here cats" + cats.join(","));
        } catch (e) {
            if (e) {
                debuglog("here exception" + e);
                dialoglog("WhatIs", session, send('I don\'t know anything about "' + category + '"(' + e.toString() + ')'));
                // next();
                return;
            }
        }
        if (!cats || cats.length === 0) {
            dialoglog("ListAll", session, send('I don\'t know anything about "' + category + '"'));
            // next();
            return;
        }
        var cat = "";
        if (cats.length === 1) {
            cat = cats[0];
        }
        if (cats.length === 1) {
            debuglog('single category identified:' + cat);
            if (inSomething) {
                debuglog('got filter:' + inSomething);
                var categorySet = Model.getAllRecordCategoriesForTargetCategory(theModel, cat, true);
                var result1 = ListAll.listAllWithContext(cat, inSomething, theModel.rules, theModel.records, categorySet);
                // TODO classifying the string twice is a terrible waste
                if (!result1.answers.length) {
                    debuglog('going for having');
                    var categorySetFull = Model.getAllRecordCategoriesForTargetCategory(theModel, cat, false);
                    result1 = ListAll.listAllHavingContext(cat, inSomething, theModel.rules, theModel.records, categorySetFull);
                }
                debuglog(debuglog ? 'listall result >:' + JSON.stringify(result1) : '-');
                var joinresults = restrictLoggedOn(session, ListAll.joinResults(result1.answers));
                logQueryWhatIs(session, 'ListAll', result1.answers);
                debuglog(debuglog ? 'listall result2 >:' + JSON.stringify(result1) : '-');
                if (joinresults.length) {
                    dialoglog("ListAll", session, send("the " + category + " for " + inSomething + " are ...\n" + joinresults.join(";\n")));
                } else {
                    var errprefix = "";
                    if (result1.errors.length) {
                        errprefix = ErError.explainError(result1.errors);
                    }
                    dialoglog("ListAll", session, send("i did not find any " + category + " for " + inSomething + ".\n" + joinresults.join(";\n") + "" + errprefix));
                }
                return;
            } else {
                // no filter entity, e.g. list all countries
                //
                var categorySetFull = Model.getAllRecordCategoriesForTargetCategory(theModel, cat, false);
                var result = ListAll.listAllHavingContext(cat, cat, theModel.rules, theModel.records, categorySetFull);
                logQueryWhatIs(session, 'ListAll', result.answers);
                if (result.answers.length) {
                    debuglog(debuglog.enabled ? 'listall result:' + JSON.stringify(result) : '-');
                    var joinresults = [];
                    debuglog("here is cat>" + cat);
                    if (cat !== "example question") {
                        joinresults = restrictLoggedOn(session, ListAll.joinResults(result.answers));
                    } else {
                        joinresults = ListAll.joinResults(result.answers);
                    }
                    var response = "the " + category + " are ...\n" + joinresults.join(";\n");
                    dialoglog("ListAll", session, send(response));
                    return;
                } else {
                    var response = "Found no data having \"" + cat + "\"";
                    dialoglog("ListAll", session, send(response));
                    return;
                }
            }
        } else {
            // multiple categories
            debuglog('categories identified:' + cats.join(","));
            if (inSomething) {
                debuglog('got filter:' + inSomething);
                try {
                    var categorySet = Model.getAllRecordCategoriesForTargetCategories(theModel, cats, true);
                } catch (e) {
                    debuglog("here exception" + e);
                    dialoglog("WhatIs", session, send('I cannot combine "' + category + '(' + e.toString() + ')'));
                    return;
                }
                var result1T = ListAll.listAllTupelWithContext(cats, inSomething, theModel.rules, theModel.records, categorySet);
                // TODO classifying the string twice is a terrible waste
                if (!result1T.tupelanswers.length) {
                    debuglog('going for having');
                    var categorySetFull = Model.getAllRecordCategoriesForTargetCategories(theModel, cats, false);
                    result1T = ListAll.listAllTupelHavingContext(cats, inSomething, theModel.rules, theModel.records, categorySetFull);
                }
                debuglog(debuglog.enabled ? 'listall result:' + JSON.stringify(result1T) : '-');
                var joinresults = restrictLoggedOn(session, ListAll.joinResultsTupel(result1T.tupelanswers));
                logQueryWhatIsTupel(session, 'ListAll', result1T.tupelanswers);
                if (joinresults.length) {
                    dialoglog("ListAll", session, send("the " + category + " for " + inSomething + " are ...\n" + joinresults.join(";\n")));
                } else {
                    if (result1T.errors.length) {
                        errprefix = ErError.explainError(result1T.errors);
                    }
                    dialoglog("ListAll", session, send("i did not find any " + category + " for " + inSomething + ".\n" + joinresults.join(";\n") + errprefix));
                }
                return;
            } else {
                // no entity, e.g. list all countries
                //
                var categorySetFull = {};
                try {
                    categorySetFull = Model.getAllRecordCategoriesForTargetCategories(theModel, cats, false);
                } catch (e) {
                    debuglog("here exception" + e);
                    dialoglog("WhatIs", session, send('I cannot combine "' + category + '(' + e.toString() + ')'));
                    // next();
                    return;
                }
                var resultT = ListAll.listAllTupelHavingContext(cats, "\"" + cats.join("\" \"") + "\"", theModel.rules, theModel.records, categorySetFull);
                logQueryWhatIsTupel(session, 'ListAll', resultT.tupelanswers);
                if (resultT.tupelanswers.length) {
                    debuglog(debuglog.enabled ? 'listall result:' + JSON.stringify(resultT) : '-');
                    var joinresults = [];
                    debuglog("here is cat>" + cats.join(", "));
                    if (cat !== "example question") {
                        joinresults = restrictLoggedOn(session, ListAll.joinResultsTupel(resultT.tupelanswers));
                    } else {
                        joinresults = ListAll.joinResultsTupel(resultT.tupelanswers);
                    }
                    var response = "the " + category + " are ...\n" + joinresults.join(";\n");
                    dialoglog("ListAll", session, send(response));
                    return;
                } else {
                    var response = "Found no data having \"" + cat + "\"";
                    dialoglog("ListAll", session, send(response));
                    return;
                }
            }
        }
    }]);
    dialog.matches('buildtable', [function (session, args, next) {
        var isCombinedIndex = {};
        var oNewEntity;
        // expecting entity A1
        var message = session.message.text;
        debuglog("Intent : buildtable");
        debuglog('raw: ' + JSON.stringify(args.entities), undefined, 2);
        var categories = builder.EntityRecognizer.findEntity(args.entities, 'categories').entity;
        debuglog("factOrCat is" + categories);
        var cats;
        try {
            cats = WhatIs.analyzeCategoryMultOnlyAndComma(categories, theModel.rules, message);
            debuglog("here cats" + cats.join(","));
        } catch (e) {
            if (e) {
                debuglog("here exception" + e);
                dialoglog("WhatIs", session, send('I don\'t know anything about "' + categories + '"(' + e.toString() + ')'));
                // next();
                return;
            }
        }
        if (!cats || cats.length === 0) {
            dialoglog("ListAll", session, send('I did not find a category in "' + categories + '"'));
            // next();
            return;
        }
        var exec = MakeTable.makeTable(cats, theModel);
        //      const exec = ExecServer.execTool(session.dialogData.result as IMatch.IToolMatch, theModel.records);
        var reply = new builder.Message(session).text(exec.text).addEntity(exec.action);
        // .addAttachment({ fallbackText: "I don't know", contentType: 'image/jpeg', contentUrl: "www.wombat.org" });
        dialoglog("ShowMe", session, send(reply));
    }]);
    dialog.matches('Describe', [function (session, args, next) {
        var isCombinedIndex = {};
        var oNewEntity;
        // expecting entity A1
        var message = session.message.text;
        debuglog("Intent : Describe");
        debuglog('raw: ' + JSON.stringify(args.entities), undefined, 2);
        var factEntity = builder.EntityRecognizer.findEntity(args.entities, 'A1');
        var factOrCat = factEntity && factEntity.entity;
        var domainEntity = builder.EntityRecognizer.findEntity(args.entities, 'D');
        var domainS = domainEntity && domainEntity.entity;
        var filterDomain = undefined;
        if (domainS) {
            filterDomain = ListAll.inferDomain(theModel, domainS);
            debuglog("got domain" + filterDomain);
            if (!filterDomain) {
                dialoglog("Describe", session, send("I did not infer a domain restriction from \"" + domainS + "\". Specify an existing domain. (List all domains) to get exact names.\n"));
                return;
            }
        }
        debuglog("factOrCat is" + factOrCat);
        if (exports.metawordsDescriptions[factOrCat.toLowerCase()]) {
            // do we have a filter ?
            var prefix = "";
            if (filterDomain) {
                prefix = '"in domain "' + filterDomain + '" make no sense when matching a metaword.\n';
            }
            debuglog("showing meta result");
            dialoglog("Describe", session, send(prefix + '"' + factOrCat + '" is ' + exports.metawordsDescriptions[factOrCat.toLowerCase()] + ""));
            return;
        }
        var categories = [];
        if (WhatIs.splitAtCommaAnd(factOrCat).length > 1) {
            dialoglog("Describe", session, send("Whoa, i can only explain one thing at a time, not \"" + factOrCat + "\". Please ask one at a time."));
            return;
        }
        var category = WhatIs.analyzeCategory(factOrCat, theModel.rules, message);
        var catResults = [];
        if (category) {
            //TODO
            catResults = Describe.describeCategory(category, filterDomain, theModel, message);
        }
        var resFact = Describe.describeFactInDomain(factOrCat, filterDomain, theModel);
        if (catResults) {
            var prefixed = catResults.map(function (res) {
                return Describe.sloppyOrExact(category, factOrCat, theModel) + "  " + res;
            });
        }
        if (catResults.length) {
            resFact = prefixed.join("\n");
            +"\n" + resFact;
        }
        dialoglog("Describe", session, send(resFact));
        /*
            var aRes = Model.getCategoriesForDomain(theModel, domain);
             var res = restrictLoggedOn(session, aRes).join(";\n");
            dialoglog("ListAll",session,send("my categories in domain \"" + domain + "\" are ...\n" + res));
            return;
          }
        }
        if (category === "domains") {
          var res = restrictLoggedOn(session, theModel.domains).join(";\n");
          dialoglog("ListAll",session, send("my domains are ...\n" + res));
          return;
        }
        if (category === "tools") {
          var res = restrictLoggedOn(session, theModel.tools).map(function (oTool) {
            return oTool.name;
          }).join(";\n");
          dialoglog("ListAll", session,send("my tools are ...\n" + res));
          return;
        }
        */
        /*
        var cats = [];
          try {
          cats = WhatIs.analyzeCategoryMult2(category, theModel.rules, message);
          debuglog("here cats" + cats.join(","));
        } catch (e) {
            if(e) {
              debuglog("here exception" + e);
              dialoglog("WhatIs",session,send('I don\'t know anything about "' + category + '"(' + e.toString() + ')'));
              // next();
              return;
            }
        }
        if (!cats || (cats.length === 0)) {
          dialoglog("ListAll",session,send('I don\'t know anything about "' + category + '"'));
          // next();
          return;
        }
        var cat = "";
        if( cats.length === 1) {
          cat = cats[0];
        }
        if( cats.length === 1) {
          debuglog('category identified:' + cat);
          if (a1 && a1.entity) {
            debuglog('got filter:' + a1.entity);
            var categorySet = Model.getAllRecordCategoriesForTargetCategory(theModel, cat, true);
            var result1 = ListAll.listAllWithContext(cat, a1.entity,
              theModel.rules, theModel.records, categorySet);
            // TODO classifying the string twice is a terrible waste
            if (!result1.length) {
              debuglog('going for having');
              var categorySetFull = Model.getAllRecordCategoriesForTargetCategory(theModel, cat, false);
              result1 = ListAll.listAllHavingContext(cat, a1.entity, theModel.rules,
                theModel.records, categorySetFull);
            }
            debuglog('listall result:' + JSON.stringify(result1));
            var joinresults = restrictLoggedOn(session, ListAll.joinResults(result1));
            logQueryWhatIs(session, 'ListAll', result1);
            if(joinresults.length ){
              dialoglog("ListAll",session,send("the " + category + " for " + a1.entity + " are ...\n" + joinresults.join(";\n")));
            } else {
              dialoglog("ListAll",session,send("i did not find any " + category + " for " + a1.entity + ".\n" + joinresults.join(";\n")));
            }
            return;
          } else {
            // no entity, e.g. list all countries
            //
            var categorySetFull = Model.getAllRecordCategoriesForTargetCategory(theModel, cat, false);
            var result = ListAll.listAllHavingContext(cat, cat, theModel.rules, theModel.records, categorySetFull);
            logQueryWhatIs(session, 'ListAll', result);
            if (result.length) {
              debuglog('listall result:' + JSON.stringify(result));
              var joinresults = [];
              debuglog("here is cat>" + cat);
              if(cat !== "example question") {
                joinresults = restrictLoggedOn(session, ListAll.joinResults(result));
              } else {
                joinresults = ListAll.joinResults(result);
              }
              var response = "the " + category + " are ...\n" + joinresults.join(";\n");
              dialoglog("ListAll",session,send(response));
              return;
            } else {
              var response = "Found no data having \"" + cat + "\""
              dialoglog("ListAll",session,send(response));
              return;
            }
          }
        } else {
          // multiple categories
          debuglog('categories identified:' + cats.join(","));
          if (a1 && a1.entity) {
            debuglog('got filter:' + a1.entity);
            try {
            var categorySet = Model.getAllRecordCategoriesForTargetCategories(theModel, cats, true);
            } catch(e) {
                debuglog("here exception" + e);
                dialoglog("WhatIs",session,send('I cannot combine "' + category + '(' + e.toString() + ')'));
                return;
            }
            var result1T = ListAll.listAllTupelWithContext(cats, a1.entity,
              theModel.rules, theModel.records, categorySet);
            // TODO classifying the string twice is a terrible waste
            if (!result1T.length) {
              debuglog('going for having');
              var categorySetFull = Model.getAllRecordCategoriesForTargetCategories(theModel, cats, false);
              result1T = ListAll.listAllTupelHavingContext(cats, a1.entity, theModel.rules,
                theModel.records, categorySetFull);
            }
            debuglog('listall result:' + JSON.stringify(result1T));
            var joinresults = restrictLoggedOn(session, ListAll.joinResultsTupel(result1T));
            logQueryWhatIsTupel(session, 'ListAll', result1T);
            if(joinresults.length ){
              dialoglog("ListAll",session,send("the " + category + " for " + a1.entity + " are ...\n" + joinresults.join(";\n")));
            } else {
              dialoglog("ListAll",session,send("i did not find any " + category + " for " + a1.entity + ".\n" + joinresults.join(";\n")));
            }
            return;
          } else {
            // no entity, e.g. list all countries
            //
            var categorySetFull = {} as { [key : string] : boolean};
            try {
              categorySetFull = Model.getAllRecordCategoriesForTargetCategories(theModel, cats, false);
            } catch(e) {
                debuglog("here exception" + e);
                dialoglog("WhatIs",session,send('I cannot combine "' + category + '(' + e.toString() + ')'));
            // next();
                return;
            }
            var resultT = ListAll.listAllTupelHavingContext(cats, "\"" + cats.join("\" \"") + "\"", theModel.rules, theModel.records, categorySetFull);
            logQueryWhatIsTupel(session, 'ListAll', resultT);
            if (resultT.length) {
              debuglog('listall result:' + JSON.stringify(resultT));
              var joinresults = [];
              debuglog("here is cat>" + cats.join(", "));
              if(cat !== "example question") {
                joinresults = restrictLoggedOn(session, ListAll.joinResultsTupel(resultT));
              } else {
                joinresults = ListAll.joinResultsTupel(resultT);
              }
              var response = "the " + category + " are ...\n" + joinresults.join(";\n");
              dialoglog("ListAll",session,send(response));
              return;
            } else {
              var response = "Found no data having \"" + cat + "\""
              dialoglog("ListAll",session,send(response));
              return;
            }
          }
        }
          */
    }]);
    dialog.matches('ListAllBinOp', [function (session, args, next) {
        var isCombinedIndex = {};
        var oNewEntity;
        // expecting entity A1
        var message = session.message.text;
        debuglog("Intent : ListAllBinOp");
        debuglog('raw: ' + JSON.stringify(args.entities), undefined, 2);
        var categoryEntity = builder.EntityRecognizer.findEntity(args.entities, 'category');
        var categoryWord = categoryEntity.entity;
        var opEntity = builder.EntityRecognizer.findEntity(args.entities, 'operator');
        var operatorWord = opEntity && opEntity.entity;
        // categorize as operator ?
        var filterDomainEntity = builder.EntityRecognizer.findEntity(args.entities, 'domain');
        var filterDomainS = filterDomainEntity && filterDomainEntity.entity;
        var operator = WhatIs.analyzeOperator(operatorWord, theModel.rules, message);
        var category = WhatIs.analyzeCategory(categoryWord, theModel.rules, message);
        var operatorArgs = Model.getOperator(theModel, operator);
        var a2 = builder.EntityRecognizer.findEntity(args.entities, 'A2');
        if (!operator) {
            var s = "Unknown operator " + operatorWord + ", this is a model bug, check operators.json and intents.json";
            dialoglog("ListAllBinOp", session, send("ouch, this was in internal error. Recovering from a weird operator \"" + operatorWord + "\"\n"));
            throw new Error(s);
        }
        var filterDomain = undefined;
        if (filterDomainS) {
            debuglog("found a domainString" + filterDomainS);
            filterDomain = ListAll.inferDomain(theModel, filterDomainS);
            debuglog("got domain" + filterDomain);
            if (!filterDomain) {
                dialoglog("Describe", session, send("I did not infer a domain restriction from \"" + filterDomainS + "\". Specify an existing domain. (List all domains) to get exact names.\n"));
                return;
            }
        }
        var fragment = a2 && a2.entity;
        fragment = BreakDown.trimQuoted(BreakDown.trimQuotedSpaced(fragment));
        debuglog("fragment after trimming \"" + fragment + "\"");
        if (categoryWord === "categories") {
            // do we have a filter?
            var aFilteredCategories = ListAll.filterStringListByOp(operatorArgs, fragment, theModel.category);
            if (filterDomain) {
                var catsForDomain = Model.getCategoriesForDomain(theModel, filterDomain);
                aFilteredCategories = _.intersection(aFilteredCategories, catsForDomain);
            }
            res = restrictLoggedOn(session, aFilteredCategories).join(";\n");
            if (res.length) {
                if (filterDomain) {
                    dialoglog("ListAllBinOp", session, send("my categories " + operator + " \"" + fragment + "\" in domain \"" + filterDomain + "\" are ...\n" + res));
                } else {
                    dialoglog("ListAllBinOp", session, send("my categories " + operator + " \"" + fragment + "\" are ...\n" + res));
                }
            } else {
                dialoglog("ListAllBinOp", session, send('I have no categories ' + operator + ' "' + fragment + '"'));
            }
            return;
        } else if (categoryWord === "domains") {
            var aRes = ListAll.filterStringListByOp(operatorArgs, fragment, theModel.domains);
            res = restrictLoggedOn(session, aRes).join(";\n");
            if (res.length) {
                dialoglog("ListAllBinOp", session, send("my domains " + operator + ' "' + fragment + '" are ...\n' + res));
            } else {
                dialoglog("ListAllBinOp", session, send('I have no domains ' + operator + ' "' + fragment + '"'));
            }
            return;
        } else if (categoryWord === "tools") {
            var aRes = ListAll.filterStringListByOp(operatorArgs, fragment, theModel.tools.map(function (oTool) {
                return oTool.name;
            }));
            var res = restrictLoggedOn(session, aRes).join(";\n");
            if (res.length) {
                dialoglog("ListAllBinOp", session, send("my tools " + operator + ' "' + fragment + '" are ...\n' + res));
            } else {
                dialoglog("ListAllBinOp", session, send("I have no tools " + operator + ' "' + fragment + '"'));
            }
            return;
        } else {
            var cat = WhatIs.analyzeCategory(categoryWord, theModel.rules, message);
            if (!cat) {
                dialoglog("ListAllBinOp", session, send('I don\'t know anything about "' + categoryWord + '"'));
                // next();
                return;
            }
            debuglog('category identified:' + cat);
            var aRes = ListAll.getCategoryOpFilterAsDistinctStrings(operatorArgs, fragment, category, theModel.records, filterDomain);
            var res = restrictLoggedOn(session, aRes).join(";\n");
            var infixExplain = '';
            if (!ListAll.likelyPluralDiff(category, categoryWord)) {
                infixExplain = '("' + category + '")';
            }
            if (res.length) {
                if (filterDomain) {
                    dialoglog("ListAllBinOp", session, send("my " + categoryWord + infixExplain + " " + operator + " \"" + fragment + "\" in domain \"" + filterDomain + "\" are ...\n" + res));
                } else {
                    dialoglog("ListAllBinOp", session, send("my " + categoryWord + infixExplain + " " + operator + " \"" + fragment + "\" are ...\n" + res));
                }
            } else {
                dialoglog("ListAllBinOp", session, send('I have no ' + categoryWord + infixExplain + ' ' + operator + ' "' + fragment + '"'));
            }
            return;
        }
    }]);
    dialog.matches('TrainMe', [function (session, args, next) {
        var isCombinedIndex = {};
        var oNewEntity;
        // expecting entity A1
        var message = session.message.text;
        debuglog("Intent : Train");
        debuglog('raw: ' + JSON.stringify(args.entities), undefined, 2);
        var categoryEntity = builder.EntityRecognizer.findEntity(args.entities, 'categories');
        if (message.toLowerCase().indexOf("kronos") >= 0 || message.toLowerCase().indexOf("klingon") >= 0) {
            dialoglog("TrainMe", session, send(getRandomResult(aTrainNoKlingon)));
            return;
        }
        var res = getRandomResult(aTrainReplies);
        dialoglog("TrainMe", session, send(res));
    }]);
    dialog.matches('TooLong', [function (session, args, next) {
        var isCombinedIndex = {};
        var oNewEntity;
        // expecting entity A1
        var message = session.message.text;
        debuglog("Intent : TooLong");
        debuglog('raw: ' + JSON.stringify(args.entities), undefined, 2);
        var categoryEntity = builder.EntityRecognizer.findEntity(args.entities, 'categories');
        dialoglog("TooLong", session, send(getRandomResult(exports.aResponsesOnTooLong)));
    }]);
    dialog.matches('Wrong', [function (session, args, next) {
        /*
        dialogLogger({
          session: session,
          intent: "Wrong",
          response: '<begin updown>'
        }); */
        session.beginDialog('/updown', session.userData.count);
    }, function (session, results, next) {
        var alarm = session.dialogData.alarm;
        next();
    }, function (session, results) {
        session.send(getRandomResult(aBackFromTraining)); //  + JSON.stringify(results));
        //session.send('end of wrong');
    }]);
    dialog.matches('Exit', [function (session, args, next) {
        debuglog('exit :');
        debuglog('exit' + JSON.stringify(args.entities));
        dialogLogger({
            session: session,
            intent: "Exit",
            response: 'you are in a logic loop'
        });
        session.send("you are in a logic loop ");
    }]);
    dialog.matches('Help', [function (session, args, next) {
        debuglog('help :');
        debuglog('help');
        session.send("I know about .... <categories>>");
    }]);
    /*
      // Add intent handlers
      dialog.matches('train', [
        function (session, args, next) {
          debuglog('train');
          // Resolve and store any entities passed from LUIS.
          var title = builder.EntityRecognizer.findEntity(args.entities, 'builtin.alarm.title');
          var time = builder.EntityRecognizer.resolveTime(args.entities);
          var alarm = session.dialogData.alarm = {
            title: title ? title.entity : null,
            timestamp: time ? time.getTime() : null
          };
          // Prompt for title
          if (!alarm.title) {
            dialogLogger({
              session: session,
              intent: "train",
              response: 'What fact would you like to train?'
            });
            builder.Prompts.text(session, 'What fact would you like to train?');
          } else {
            next();
          }
        },
        function (session, results, next) {
          var alarm = session.dialogData.alarm;
          if (results.response) {
            alarm.title = results.response;
          }
    
          // Prompt for time (title will be blank if the user said cancel)
          if (alarm.title && !alarm.timestamp) {
    
    
            builder.Prompts.time(session, 'What time would you like to set the alarm for?');
          } else {
            next();
          }
        },
        function (session, results) {
          var alarm = session.dialogData.alarm;
          if (results.response) {
            var time = builder.EntityRecognizer.resolveTime([results.response]);
            alarm.timestamp = time ? time.getTime() : null;
          }
          // Set the alarm (if title or timestamp is blank the user said cancel)
          if (alarm.title && alarm.timestamp) {
            // Save address of who to notify and write to scheduler.
            alarm.address = session.message.address;
            //alarms[alarm.title] = alarm;
    
            // Send confirmation to user
            var date = new Date(alarm.timestamp);
            var isAM = date.getHours() < 12;
            session.send('Creating alarm named "%s" for %d/%d/%d %d:%02d%s',
              alarm.title,
              date.getMonth() + 1, date.getDate(), date.getFullYear(),
              isAM ? date.getHours() : date.getHours() - 12, date.getMinutes(), isAM ? 'am' : 'pm');
          } else {
            session.send('Ok... no problem.');
          }
        }
      ]);
    */
    dialog.onDefault(function (session) {
        logQuery(session, "onDefault");
        var eliza = getElizaBot(getConversationId(session));
        var reply = eliza.transform(session.message.text);
        dialoglog("eliza", session, send(reply));
        //new Eilzabot
        //session.send("I do not understand this at all");
        //builder.DialogAction.send('I\'m sorry I didn\'t understand. I can only show start and ring');
    });
    /*
    // Very simple alarm scheduler
    var alarms = {};
    setInterval(function () {
      var now = new Date().getTime();
      for (var key in alarms) {
        var alarm = alarms[key];
        if (now >= alarm.timestamp) {
          var msg = new builder.Message()
            .address(alarm.address)
            .text('Here\'s your \'%s\' alarm.', alarm.title);
          bot.send(msg);
          delete alarms[key];
        }
      }
    }, 15000);
    */
}
if (module) {
    module.exports = {
        SimpleUpDownRecognizer: SimpleUpDownRecognizer,
        aResponsesOnTooLong: exports.aResponsesOnTooLong,
        metawordsDescriptions: exports.metawordsDescriptions,
        makeBot: makeBot
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9ib3Qvc21hcnRkaWFsb2cudHMiLCJib3Qvc21hcnRkaWFsb2cuanMiXSwibmFtZXMiOlsiYnVpbGRlciIsInJlcXVpcmUiLCJkZWJ1ZyIsIk1hdGNoIiwiQW5hbHl6ZSIsIkJyZWFrRG93biIsIldoYXRJcyIsIkxpc3RBbGwiLCJEZXNjcmliZSIsIk1ha2VUYWJsZSIsIlV0aWxzIiwiRXJFcnJvciIsIl8iLCJEaWFsb2dMb2dnZXIiLCJwcm9jZXNzIiwiZGJ1cmwiLCJlbnYiLCJEQVRBQkFTRV9VUkwiLCJwZ2xvY2FsdXJsIiwicGciLCJvIiwiQUJPVF9EQk5PU1NMIiwiZGVmYXVsdHMiLCJzc2wiLCJkaWFsb2dMb2dnZXIiLCJsb2dnZXIiLCJzZW5kIiwiZGlhbG9nbG9nIiwiaW50ZW50Iiwic2Vzc2lvbiIsInJlc3BvbnNlIiwic1Jlc3BvbnNlIiwic0FjdGlvbiIsImFNZXNzYWdlIiwiaU1lc3NhZ2UiLCJ0b01lc3NhZ2UiLCJ0ZXh0IiwiZW50aXRpZXMiLCJKU09OIiwic3RyaW5naWZ5IiwiYWN0aW9uIiwiZWxpemFib3QiLCJkZWJ1Z2xvZyIsIlBsYWluUmVjb2duaXplciIsImRpc3BhdGNoZXIiLCJnZXRDb252ZXJzYXRpb25JZCIsIm1lc3NhZ2UiLCJhZGRyZXNzIiwiY29udmVyc2F0aW9uIiwiaWQiLCJlbGl6YWJvdHMiLCJnZXRFbGl6YUJvdCIsImFjY2VzcyIsIkRhdGUiLCJuZXdGbG93IiwiTW9kZWwiLCJFeGVjU2VydmVyIiwibW9kZWxzIiwibG9hZE1vZGVsIiwibW9kZWxQYXRoIiwibG9hZE1vZGVscyIsImlzQW5vbnltb3VzIiwidXNlcmlkIiwiaW5kZXhPZiIsInJlc3RyaWN0TG9nZ2VkT24iLCJhcnIiLCJ1c2VyIiwiQUJPVF9FTUFJTF9VU0VSIiwibGVuZ3RoIiwibGVuIiwicmVzIiwic2xpY2UiLCJNYXRoIiwibWluIiwibWF4IiwiZmxvb3IiLCJkZWx0YSIsInB1c2giLCJhVHJhaW5SZXBsaWVzIiwiYVRyYWluRGlhbG9nIiwiYVRyYWluRXhpdEhpbnQiLCJhRW50ZXJUcmFpbiIsImFCYWNrRnJvbVRyYWluaW5nIiwiYVRyYWluTm9LbGluZ29uIiwiZXhwb3J0cyIsImFSZXNwb25zZXNPblRvb0xvbmciLCJtZXRhd29yZHNEZXNjcmlwdGlvbnMiLCJnZXRSYW5kb21SZXN1bHQiLCJyYW5kb20iLCJTaW1wbGVVcERvd25SZWNvZ25pemVyIiwicHJvdG90eXBlIiwicmVjb2duaXplIiwiY29udGV4dCIsImNhbGxiYWNrIiwidSIsInNjb3JlIiwiZTEiLCJzdGFydEluZGV4IiwiZW5kSW5kZXgiLCJ1bmRlZmluZWQiLCJBbnlPYmplY3QiLCJPYmplY3QiLCJib3QiLCJmcyIsIm9KU09OIiwicGFyc2UiLCJyZWFkRmlsZVN5bmMiLCJvUnVsZXMiLCJwYXJzZVJ1bGVzIiwibG9nUXVlcnkiLCJyZXN1bHQiLCJhcHBlbmRGaWxlIiwidGltZXN0YW1wIiwiVG9vbE1hdGNoIiwiZHVtcE5pY2UiLCJjb252ZXJzYXRpb25JZCIsImVyciIsImxvZ1F1ZXJ5V2hhdElzIiwibG9nUXVlcnlXaGF0SXNUdXBlbCIsImR1bXBOaWNlVHVwZWwiLCJnd29yZHMiLCJtYWtlQm90IiwiY29ubmVjdG9yIiwib3B0aW9ucyIsInQiLCJub3ciLCJ0aGVNb2RlbCIsInNob3dNb2RlbExvYWRUaW1lIiwiY29uc29sZSIsImxvZyIsIlVuaXZlcnNhbEJvdCIsInJlY29nbml6ZXIiLCJSZWdFeHBSZWNvZ25pemVyIiwiZGlhbG9nIiwiSW50ZW50RGlhbG9nIiwicmVjb2duaXplcnMiLCJkaWFsb2dVcERvd24iLCJvbkJlZ2luIiwibWF0Y2hlcyIsImFyZ3MiLCJuZXh0IiwiZGlhbG9nRGF0YSIsImFiYyIsIlByb21wdHMiLCJyZXN1bHRzIiwicmVwb25zZSIsImVuZERpYWxvZ1dpdGhSZXN1bHQiLCJvbkRlZmF1bHQiLCJkaWFsZ29EYXRhIiwiRGlhbG9nRGF0YSIsImlzQ29tYmluZWRJbmRleCIsIm9OZXdFbnRpdHkiLCJhMSIsIkVudGl0eVJlY29nbml6ZXIiLCJmaW5kRW50aXR5IiwiYW5hbHl6ZUFsbCIsImVudGl0eSIsInJ1bGVzIiwidG9vbHMiLCJkdW1wV2VpZ2h0c1RvcCIsInRvcCIsImlzQ29tcGxldGUiLCJnZXRQcm9tcHQiLCJwcm9tcHQiLCJiZXN0Iiwic2V0UHJvbXB0IiwiZXhlYyIsImV4ZWNUb29sIiwicmVjb3JkcyIsInJlcGx5IiwiTWVzc2FnZSIsImFkZEVudGl0eSIsImVuYWJsZWQiLCJjYXRlZ29yeUVudGl0eSIsImNhdGVnb3J5IiwiY2F0cyIsImFuYWx5emVDYXRlZ29yeU11bHRPbmx5QW5kQ29tbWEiLCJqb2luIiwiZSIsInRvU3RyaW5nIiwiY2F0IiwicmVzb2x2ZUNhdGVnb3J5IiwiYW5zd2VycyIsImluZGlzIiwiaXNJbmRpc2NyaW1pbmF0ZVJlc3VsdCIsImV4cGxhaW4iLCJlcnJvcnMiLCJleHBsYWluRXJyb3IiLCJyZXN1bHRBcnIiLCJyZXNvbHZlQ2F0ZWdvcmllcyIsInR1cGVsYW5zd2VycyIsImlzSW5kaXNjcmltaW5hdGVSZXN1bHRUdXBlbCIsImxpc3RUb1F1b3RlZENvbW1hQW5kIiwiaW5TdGhFbnRpdHkiLCJpblNvbWV0aGluZyIsImRvbWFpbiIsImluZmVyRG9tYWluIiwic3RyaXBRdW90ZXMiLCJhUmVzIiwiZ2V0Q2F0ZWdvcmllc0ZvckRvbWFpbiIsImRvbWFpbnMiLCJtYXAiLCJvVG9vbCIsIm5hbWUiLCJjYXRlZ29yeVNldCIsImdldEFsbFJlY29yZENhdGVnb3JpZXNGb3JUYXJnZXRDYXRlZ29yeSIsInJlc3VsdDEiLCJsaXN0QWxsV2l0aENvbnRleHQiLCJjYXRlZ29yeVNldEZ1bGwiLCJsaXN0QWxsSGF2aW5nQ29udGV4dCIsImpvaW5yZXN1bHRzIiwiam9pblJlc3VsdHMiLCJlcnJwcmVmaXgiLCJnZXRBbGxSZWNvcmRDYXRlZ29yaWVzRm9yVGFyZ2V0Q2F0ZWdvcmllcyIsInJlc3VsdDFUIiwibGlzdEFsbFR1cGVsV2l0aENvbnRleHQiLCJsaXN0QWxsVHVwZWxIYXZpbmdDb250ZXh0Iiwiam9pblJlc3VsdHNUdXBlbCIsInJlc3VsdFQiLCJjYXRlZ29yaWVzIiwibWFrZVRhYmxlIiwiZmFjdEVudGl0eSIsImZhY3RPckNhdCIsImRvbWFpbkVudGl0eSIsImRvbWFpblMiLCJmaWx0ZXJEb21haW4iLCJ0b0xvd2VyQ2FzZSIsInByZWZpeCIsInNwbGl0QXRDb21tYUFuZCIsImFuYWx5emVDYXRlZ29yeSIsImNhdFJlc3VsdHMiLCJkZXNjcmliZUNhdGVnb3J5IiwicmVzRmFjdCIsImRlc2NyaWJlRmFjdEluRG9tYWluIiwicHJlZml4ZWQiLCJzbG9wcHlPckV4YWN0IiwiY2F0ZWdvcnlXb3JkIiwib3BFbnRpdHkiLCJvcGVyYXRvcldvcmQiLCJmaWx0ZXJEb21haW5FbnRpdHkiLCJmaWx0ZXJEb21haW5TIiwib3BlcmF0b3IiLCJhbmFseXplT3BlcmF0b3IiLCJvcGVyYXRvckFyZ3MiLCJnZXRPcGVyYXRvciIsImEyIiwicyIsIkVycm9yIiwiZnJhZ21lbnQiLCJ0cmltUXVvdGVkIiwidHJpbVF1b3RlZFNwYWNlZCIsImFGaWx0ZXJlZENhdGVnb3JpZXMiLCJmaWx0ZXJTdHJpbmdMaXN0QnlPcCIsImNhdHNGb3JEb21haW4iLCJpbnRlcnNlY3Rpb24iLCJnZXRDYXRlZ29yeU9wRmlsdGVyQXNEaXN0aW5jdFN0cmluZ3MiLCJpbmZpeEV4cGxhaW4iLCJsaWtlbHlQbHVyYWxEaWZmIiwiYmVnaW5EaWFsb2ciLCJ1c2VyRGF0YSIsImNvdW50IiwiYWxhcm0iLCJlbGl6YSIsInRyYW5zZm9ybSIsIm1vZHVsZSJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7QUFPQTs7Ozs7QUFLQTtBQUNBO0FBQ0E7QUNDQTs7QURDQSxJQUFBQSxVQUFBQyxRQUFBLFlBQUEsQ0FBQTtBQUNBLElBQUFDLFFBQUFELFFBQUEsT0FBQSxDQUFBO0FBR0EsSUFBQUUsUUFBQUYsUUFBQSxnQkFBQSxDQUFBO0FBRUEsSUFBQUcsVUFBQUgsUUFBQSxrQkFBQSxDQUFBO0FBQ0EsSUFBQUksWUFBQUosUUFBQSxvQkFBQSxDQUFB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bkIsRUFBeUJDLElBQXpCLEVBQTZCO0FBQzNCbEcsaUJBQVMsUUFBVDtBQUNBQSxpQkFBUyxNQUFUO0FBQ0FiLGdCQUFRSCxJQUFSLENBQWEsaUNBQWI7QUFDRCxLQUxvQixDQUF2QjtBQVFGOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBaUVFMkcsV0FBT2MsU0FBUCxDQUFpQixVQUFVdEgsT0FBVixFQUFpQjtBQUNoQ2dGLGlCQUFTaEYsT0FBVCxFQUFrQixXQUFsQjtBQUNBLFlBQUl5TyxRQUFRbk4sWUFBWU4sa0JBQWtCaEIsT0FBbEIsQ0FBWixDQUFaO0FBQ0EsWUFBSTRJLFFBQVE2RixNQUFNQyxTQUFOLENBQWdCMU8sUUFBUWlCLE9BQVIsQ0FBZ0JWLElBQWhDLENBQVo7QUFDQVQsa0JBQVUsT0FBVixFQUFtQkUsT0FBbkIsRUFBNEJILEtBQUsrSSxLQUFMLENBQTVCO0FBQ0E7QUFDQTtBQUNBO0FBQ0QsS0FSRDtBQVVBOzs7Ozs7Ozs7Ozs7Ozs7OztBQWlCRDtBQUVELElBQUkrRixNQUFKLEVBQVk7QUFDVkEsV0FBT3BMLE9BQVAsR0FBaUI7QUFDZkssZ0NBQXdCQSxzQkFEVDtBQUVmSiw2QkFBcUJELFFBQUFDLG1CQUZOO0FBR2ZDLCtCQUF3QkYsUUFBQUUscUJBSFQ7QUFJZm1DLGlCQUFTQTtBQUpNLEtBQWpCO0FBTUQiLCJmaWxlIjoiYm90L3NtYXJ0ZGlhbG9nLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBUaGUgYm90IGltcGxlbWVudGF0aW9uXG4gKlxuICogSW5zdGFudGlhdGUgYXBzc2luZyBhIGNvbm5lY3RvciB2aWFcbiAqIG1ha2VCb3RcbiAqXG4gKi9cbi8qKlxuICogQGZpbGVcbiAqIEBtb2R1bGUgamZzZWIuZmRldnN0YXJ0LnNtYXJ0ZGlhbG9nXG4gKiBAY29weXJpZ2h0IChjKSAyMDE2IEdlcmQgRm9yc3RtYW5uXG4gKi9cbi8vZGVjbGFyZSBtb2R1bGUgJ2VsaXphYm90JyB7IH07XG4vL2RlY2xhcmUgbW9kdWxlICd3aW5zdG9uLXBnJyB7IH07XG4vL2RlbGNhcmUgbW9kdWxlICd3aW5zdG9uJyB7fTtcblxuaW1wb3J0ICogYXMgYnVpbGRlciBmcm9tICdib3RidWlsZGVyJztcbmltcG9ydCAqIGFzIGRlYnVnIGZyb20gJ2RlYnVnJztcblxuaW1wb3J0ICogYXMgRXhlYyBmcm9tICcuLi9leGVjL2V4ZWMnO1xuaW1wb3J0ICogYXMgTWF0Y2ggZnJvbSAnLi4vbWF0Y2gvbWF0Y2gnO1xuXG5pbXBvcnQgKiBhcyBBbmFseXplIGZyb20gJy4uL21hdGNoL2FuYWx5emUnO1xuaW1wb3J0ICogYXMgQnJlYWtEb3duIGZyb20gJy4uL21hdGNoL2JyZWFrZG93bic7XG5cbmltcG9ydCAqIGFzIFdoYXRJcyBmcm9tICcuLi9tYXRjaC93aGF0aXMnO1xuaW1wb3J0ICogYXMgTGlzdEFsbCBmcm9tICcuLi9tYXRjaC9saXN0YWxsJztcbmltcG9ydCAqIGFzIERlc2NyaWJlIGZyb20gJy4uL21hdGNoL2Rlc2NyaWJlJztcbmltcG9ydCAqIGFzIE1ha2VUYWJsZSBmcm9tICcuLi9leGVjL21ha2VxYmV0YWJsZSc7XG5cbmltcG9ydCAqIGFzIFV0aWxzIGZyb20gJy4uL3V0aWxzL3V0aWxzJztcbmltcG9ydCAqIGFzIEVyRXJyb3IgZnJvbSAnLi4vbWF0Y2gvZXJlcnJvcic7XG5cbmltcG9ydCAqIGFzIF8gZnJvbSAnbG9kYXNoJztcblxuaW1wb3J0ICogYXMgRGlhbG9nTG9nZ2VyIGZyb20gJy4uL3V0aWxzL2RpYWxvZ2xvZ2dlcic7XG5cbmltcG9ydCAqIGFzIHByb2Nlc3MgZnJvbSAncHJvY2Vzcyc7XG5cbnZhciBkYnVybCA9IHByb2Nlc3MuZW52LkRBVEFCQVNFX1VSTCB8fCBcIlwiO1xuXG52YXIgcGdsb2NhbHVybCA9IFwicG9zdGdyZXM6Ly9qb2U6YWJjZGVmQGxvY2FsaG9zdDo1NDMyL2Fib3RcIjtcbnZhciBkYnVybCA9IHByb2Nlc3MuZW52LkRBVEFCQVNFX1VSTCB8fCBwZ2xvY2FsdXJsO1xuaW1wb3J0ICogYXMgcGcgZnJvbSAncGcnO1xudmFyIG8gPSBwZyBhcyBhbnk7XG5pZighKHByb2Nlc3MuZW52LkFCT1RfREJOT1NTTCkpIHtcbiAgby5kZWZhdWx0cy5zc2wgPSB0cnVlOyAvLyBPbmx5IHVzZWQgaW50ZXJuYWxseSAhXG59XG52YXIgZGlhbG9nTG9nZ2VyID0gRGlhbG9nTG9nZ2VyLmxvZ2dlcihcInNtYXJ0Ym90XCIsIGRidXJsLCBwZyk7XG5cbnR5cGUgc3RyaW5nT3JNZXNzYWdlID0gc3RyaW5nIHwgYnVpbGRlci5NZXNzYWdlO1xuZnVuY3Rpb24gc2VuZDxUIGV4dGVuZHMgc3RyaW5nT3JNZXNzYWdlPihvOiBUKTogVCB7IHJldHVybiBvOyB9O1xuZnVuY3Rpb24gZGlhbG9nbG9nKGludGVudDogc3RyaW5nLCBzZXNzaW9uOiBidWlsZGVyLlNlc3Npb24sIHJlc3BvbnNlOiBzdHJpbmdPck1lc3NhZ2UpIHtcbiAgdmFyIHNSZXNwb25zZTogc3RyaW5nO1xuICB2YXIgc0FjdGlvbjogc3RyaW5nO1xuICBpZiAodHlwZW9mIHJlc3BvbnNlID09PSBcInN0cmluZ1wiKSB7XG4gICAgc0FjdGlvbiA9IFwiXCI7XG4gICAgc1Jlc3BvbnNlID0gcmVzcG9uc2U7XG4gIH0gZWxzZSB7XG4gICAgdmFyIGFNZXNzYWdlOiBidWlsZGVyLk1lc3NhZ2UgPSByZXNwb25zZTtcbiAgICB2YXIgaU1lc3NhZ2U6IGJ1aWxkZXIuSU1lc3NhZ2UgPSBhTWVzc2FnZS50b01lc3NhZ2UoKTtcbiAgICBzUmVzcG9uc2UgPSBpTWVzc2FnZS50ZXh0O1xuICAgIHNBY3Rpb24gPSAoaU1lc3NhZ2UuZW50aXRpZXMgJiYgaU1lc3NhZ2UuZW50aXRpZXNbMF0pID8gKEpTT04uc3RyaW5naWZ5KGlNZXNzYWdlLmVudGl0aWVzICYmIGlNZXNzYWdlLmVudGl0aWVzWzBdKSkgOiBcIlwiO1xuICB9XG4gIGRpYWxvZ0xvZ2dlcih7XG4gICAgaW50ZW50OiBpbnRlbnQsXG4gICAgc2Vzc2lvbjogc2Vzc2lvbixcbiAgICByZXNwb25zZTogc1Jlc3BvbnNlLFxuICAgIGFjdGlvbjogc0FjdGlvblxuICB9KTtcbiAgc2Vzc2lvbi5zZW5kKHJlc3BvbnNlKTtcbn1cblxuLy9jb25zdCBwZ0xvZ2dlciA9IG5ldyBQZ0xvZ2dlcih7XG4vLyAgbmFtZTogJ3Rlc3QtbG9nZ2VyJyxcbi8vICBsZXZlbDogJ2RlYnVnJyxcbi8vICBjb25uU3RyaW5nOiAncG9zdGdyZXM6Ly91YnVudHVAbG9jYWxob3N0OjU0MzIvY2lyY2xlX3Rlc3QnLFxuLy8gIHRhYmxlTmFtZTogJ3dpbnN0b25fbG9ncycsXG4vL30pO1xuXG5cblxuLy93aW5zdG9uLmFkZCh3aW5zdG9uLnRyYW5zcG9ydHMuRmlsZSwgeyBmaWxlbmFtZTogJ3dpbnN0b25fb3V0LmxvZycsIHRpbWVzdGFtcCA6IHRydWUgfSk7XG4vLyAgd2luc3Rvbi5yZW1vdmUod2luc3Rvbi50cmFuc3BvcnRzLkNvbnNvbGUpO1xuLy93aW5zdG9uLmFkZChwZ0xvZ2dlcik7XG5cbi8qXG5jb25zdCBsb2dnZXIgPSBuZXcgd2luc3Rvbi5Mb2dnZXIoe1xuICB0cmFuc3BvcnRzOiBbXG4gICAgbmV3IHdpbnN0b24udHJhbnNwb3J0cy5Db25zb2xlKHtcbiAgICAgIGNvbG9yOiB0cnVlLFxuICAgICAgdGltZXN0YW1wOiB0cnVlLFxuICAgIH0pLFxuICAgIHBnTG9nZ2VyLFxuICBdXG59KTtcbiovXG4vL3BnTG9nZ2VyLmluaXRUYWJsZShkb25lKTtcblxuXG52YXIgZWxpemFib3QgPSByZXF1aXJlKCcuLi9leHRlcm4vZWxpemFib3QvZWxpemFib3QuanMnKTtcbi8vaW1wb3J0ICogYXMgZWxpemFib3QgZnJvbSAnZWxpemFib3QnO1xuXG5sZXQgZGVidWdsb2cgPSBkZWJ1Zygnc21hcnRkaWFsb2cnKTtcbmltcG9ydCAqIGFzIFBsYWluUmVjb2duaXplciBmcm9tICcuL3BsYWlucmVjb2duaXplcic7XG4vL3ZhciBidWlsZGVyID0gcmVxdWlyZSgnYm90YnVpbGRlcicpO1xuXG52YXIgZGlzcGF0Y2hlciA9IHJlcXVpcmUoJy4uL21hdGNoL2Rpc3BhdGNoZXIuanMnKS5kaXNwYXRjaGVyO1xuXG5cbmZ1bmN0aW9uIGdldENvbnZlcnNhdGlvbklkKHNlc3Npb246IGJ1aWxkZXIuU2Vzc2lvbik6IHN0cmluZyB7XG4gIHJldHVybiBzZXNzaW9uLm1lc3NhZ2UgJiZcbiAgICBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzcyAmJlxuICAgIHNlc3Npb24ubWVzc2FnZS5hZGRyZXNzLmNvbnZlcnNhdGlvbi5pZDtcbn1cblxudmFyIGVsaXphYm90cyA9IHt9O1xuXG5mdW5jdGlvbiBnZXRFbGl6YUJvdChpZDogc3RyaW5nKSB7XG4gIGlmICghZWxpemFib3RzW2lkXSkge1xuICAgIGVsaXphYm90c1tpZF0gPSB7XG4gICAgICBhY2Nlc3M6IG5ldyBEYXRlKCksXG4gICAgICBlbGl6YWJvdDogbmV3IGVsaXphYm90KClcbiAgICB9O1xuICB9XG4gIGVsaXphYm90c1tpZF0uYWNjZXNzID0gbmV3IERhdGUoKTtcbiAgcmV0dXJuIGVsaXphYm90c1tpZF0uZWxpemFib3Q7XG59XG5cbmltcG9ydCAqIGFzIElNYXRjaCBmcm9tICcuLi9tYXRjaC9pZm1hdGNoJztcbmltcG9ydCAqIGFzIFRvb2xzIGZyb20gJy4uL21hdGNoL3Rvb2xzJztcblxudmFyIG5ld0Zsb3cgPSB0cnVlO1xuXG5pbXBvcnQgKiBhcyBNb2RlbCBmcm9tICcuLi9tb2RlbC9tb2RlbCc7XG5pbXBvcnQgKiBhcyBFeGVjU2VydmVyIGZyb20gJy4uL2V4ZWMvZXhlY3NlcnZlcic7XG5cbi8vY29uc3QgdGhlRGVmYXVsdE1vZGVsID0gTW9kZWwubG9hZE1vZGVscygpO1xuXG52YXIgbW9kZWxzID0ge307XG5cbmZ1bmN0aW9uIGxvYWRNb2RlbChtb2RlbFBhdGg/OiBzdHJpbmcpOiBJTWF0Y2guSU1vZGVscyB7XG4gIG1vZGVsUGF0aCA9IG1vZGVsUGF0aCB8fCBcIlwiO1xuICBpZiAoIW1vZGVsc1ttb2RlbFBhdGhdKSB7XG4gICAgbW9kZWxzW21vZGVsUGF0aF0gPSBNb2RlbC5sb2FkTW9kZWxzKG1vZGVsUGF0aCk7XG4gIH1cbiAgcmV0dXJuIG1vZGVsc1ttb2RlbFBhdGhdO1xufVxuXG5pZiAobmV3Rmxvdykge1xuXG59IGVsc2Uge1xuXG4gIC8vY29uc3QgdG9vbHMgPSBUb29scy5nZXRUb29scygpO1xuICAvL2NvbnN0IElucHV0RmlsdGVyUnVsZXMgPSByZXF1aXJlKCcuLi9tYXRjaC9pbnB1dEZpbHRlclJ1bGVzLmpzJyk7XG4gIC8vY29uc3QgbVJ1bGVzID0gSW5wdXRGaWx0ZXJSdWxlcy5nZXRNUnVsZXNTYW1wbGUoKTtcbn1cblxuZnVuY3Rpb24gaXNBbm9ueW1vdXModXNlcmlkOiBzdHJpbmcpOiBib29sZWFuIHtcbiAgcmV0dXJuIHVzZXJpZC5pbmRleE9mKFwiYW5vOlwiKSA9PT0gMDtcbn1cblxuZnVuY3Rpb24gcmVzdHJpY3RMb2dnZWRPbihzZXNzaW9uOiBidWlsZGVyLlNlc3Npb24sIGFycjogYW55W10pOiBhbnlbXSB7XG4gIHZhciB1c2VyaWQgPSBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzc1xuICAgICYmIHNlc3Npb24ubWVzc2FnZS5hZGRyZXNzLnVzZXJcbiAgICAmJiBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzcy51c2VyLmlkIHx8IFwiXCI7XG4gIGlmIChwcm9jZXNzLmVudi5BQk9UX0VNQUlMX1VTRVIgJiYgaXNBbm9ueW1vdXModXNlcmlkKSkge1xuICAgIGlmIChhcnIubGVuZ3RoIDwgNikge1xuICAgICAgcmV0dXJuIGFycjtcbiAgICB9XG4gICAgdmFyIGxlbiA9IGFyci5sZW5ndGg7XG4gICAgdmFyIHJlcyA9IGFyci5zbGljZSgwLCBNYXRoLm1pbihNYXRoLm1heChNYXRoLmZsb29yKGFyci5sZW5ndGggLyAzKSwgNyksIGFyci5sZW5ndGgpKTtcbiAgICBpZiAodHlwZW9mIGFyclswXSA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgdmFyIGRlbHRhID0gbGVuIC0gcmVzLmxlbmd0aDtcbiAgICAgIHJlcy5wdXNoKFwiLi4uIGFuZCBcIiArIGRlbHRhICsgXCIgbW9yZSBlbnRyaWVzIGZvciByZWdpc3RlcmVkIHVzZXJzXCIpO1xuICAgIH1cbiAgICByZXR1cm4gcmVzO1xuICB9XG4gIHJldHVybiBhcnI7XG59XG5cbi8qXG5leHBvcnQgY2xhc3MgU2ltcGxlUmVjb2duaXplciBpbXBsZW1lbnRzIGJ1aWxkZXIuSUludGVudFJlY29nbml6ZXIge1xuICBjb25zdHJ1Y3RvcigpIHtcblxuICB9XG5cbiAgcmVjb2duaXplKGNvbnRleHQ6IGJ1aWxkZXIuSVJlY29nbml6ZUNvbnRleHQsIGNhbGxiYWNrOiAoZXJyOiBFcnJvciwgcmVzdWx0OiBidWlsZGVyLklJbnRlbnRSZWNvZ25pemVyUmVzdWx0KSA9PiB2b2lkKTogdm9pZCB7XG4gICAgdmFyIHUgPSB7fSBhcyBidWlsZGVyLklJbnRlbnRSZWNvZ25pemVyUmVzdWx0O1xuXG4gICAgZGVidWdsb2coXCJyZWNvZ25pemluZyBcIiArIGNvbnRleHQubWVzc2FnZS50ZXh0KTtcbiAgICBpZiAoY29udGV4dC5tZXNzYWdlLnRleHQuaW5kZXhPZihcInN0YXJ0XCIpID49IDApIHtcbiAgICAgIHUuaW50ZW50ID0gXCJTaG93RW50aXR5XCI7XG4gICAgICB1LnNjb3JlID0gMC45O1xuICAgICAgdmFyIGUxID0ge30gYXMgYnVpbGRlci5JRW50aXR5O1xuICAgICAgZTEuc3RhcnRJbmRleCA9IFwic3RhcnQgXCIubGVuZ3RoO1xuICAgICAgZTEuZW5kSW5kZXggPSBjb250ZXh0Lm1lc3NhZ2UudGV4dC5sZW5ndGg7XG4gICAgICBlMS5zY29yZSA9IDAuMztcbiAgICAgIHUuZW50aXRpZXMgPSBbZTFdO1xuICAgICAgY2FsbGJhY2sodW5kZWZpbmVkLCB1KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoY29udGV4dC5tZXNzYWdlLnRleHQuaW5kZXhPZihcInRyYWluXCIpID49IDApIHtcbiAgICAgIHUuaW50ZW50ID0gXCJ0cmFpblwiO1xuICAgICAgdS5zY29yZSA9IDAuOTtcbiAgICAgIHZhciBlMSA9IHt9IGFzIGJ1aWxkZXIuSUVudGl0eTtcbiAgICAgIGUxLnN0YXJ0SW5kZXggPSBcInRyYWluIFwiLmxlbmd0aDtcbiAgICAgIGUxLmVuZEluZGV4ID0gY29udGV4dC5tZXNzYWdlLnRleHQubGVuZ3RoO1xuICAgICAgZTEuc2NvcmUgPSAwLjM7XG4gICAgICB1LmVudGl0aWVzID0gW2UxXTtcbiAgICAgIGNhbGxiYWNrKHVuZGVmaW5lZCwgdSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChjb250ZXh0Lm1lc3NhZ2UudGV4dC5pbmRleE9mKFwibGVhcm5cIikgPj0gMCkge1xuICAgICAgdS5pbnRlbnQgPSBcImxlYXJuXCI7XG4gICAgICB1LnNjb3JlID0gMC45O1xuICAgICAgdmFyIGUxID0ge30gYXMgYnVpbGRlci5JRW50aXR5O1xuICAgICAgZTEudHlwZSA9IFwidHJhaW5GYWN0XCI7XG4gICAgICBlMS5zdGFydEluZGV4ID0gXCJ0cmFpbiBcIi5sZW5ndGg7XG4gICAgICBlMS5lbmRJbmRleCA9IGNvbnRleHQubWVzc2FnZS50ZXh0Lmxlbmd0aDtcbiAgICAgIGUxLnNjb3JlID0gMC4zO1xuICAgICAgdS5lbnRpdGllcyA9IFtlMV07XG4gICAgICBjYWxsYmFjayh1bmRlZmluZWQsIHUpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoY29udGV4dC5tZXNzYWdlLnRleHQuaW5kZXhPZihcImhlbHBcIikgPj0gMCkge1xuICAgICAgdS5pbnRlbnQgPSBcImhlbHBcIjtcbiAgICAgIHUuc2NvcmUgPSAwLjk7XG4gICAgICB2YXIgZTEgPSB7fSBhcyBidWlsZGVyLklFbnRpdHk7XG4gICAgICBlMS5zdGFydEluZGV4ID0gXCJ0cmFpbiBcIi5sZW5ndGg7XG4gICAgICBlMS5lbmRJbmRleCA9IGNvbnRleHQubWVzc2FnZS50ZXh0Lmxlbmd0aDtcbiAgICAgIGUxLnNjb3JlID0gMC4zO1xuICAgICAgdS5lbnRpdGllcyA9IFtlMV07XG4gICAgICBjYWxsYmFjayh1bmRlZmluZWQsIHUpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoY29udGV4dC5tZXNzYWdlLnRleHQuaW5kZXhPZihcImV4aXRcIikgPj0gMCkge1xuICAgICAgdS5pbnRlbnQgPSBcImV4aXRcIjtcbiAgICAgIHUuc2NvcmUgPSAwLjk7XG4gICAgICB2YXIgZTEgPSB7fSBhcyBidWlsZGVyLklFbnRpdHk7XG4gICAgICBlMS5zdGFydEluZGV4ID0gXCJleGl0IFwiLmxlbmd0aDtcbiAgICAgIGUxLmVuZEluZGV4ID0gY29udGV4dC5tZXNzYWdlLnRleHQubGVuZ3RoO1xuICAgICAgZTEuc2NvcmUgPSAwLjM7XG4gICAgICB1LmVudGl0aWVzID0gW2UxXTtcbiAgICAgIGNhbGxiYWNrKHVuZGVmaW5lZCwgdSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChjb250ZXh0Lm1lc3NhZ2UudGV4dC5pbmRleE9mKFwid3JvbmdcIikgPj0gMCkge1xuICAgICAgdS5pbnRlbnQgPSBcIndyb25nXCI7XG4gICAgICB1LnNjb3JlID0gMC45O1xuICAgICAgdmFyIGUxID0ge30gYXMgYnVpbGRlci5JRW50aXR5O1xuICAgICAgZTEuc3RhcnRJbmRleCA9IFwiZXhpdCBcIi5sZW5ndGg7XG4gICAgICBlMS5lbmRJbmRleCA9IGNvbnRleHQubWVzc2FnZS50ZXh0Lmxlbmd0aDtcbiAgICAgIGUxLnNjb3JlID0gMC4zO1xuICAgICAgdS5lbnRpdGllcyA9IFtlMV07XG4gICAgICBjYWxsYmFjayh1bmRlZmluZWQsIHUpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBkZWJ1Z2xvZygncmVjb2duaXppbmcgbm90aGluZycpO1xuICAgIHUuaW50ZW50ID0gXCJOb25lXCI7XG4gICAgdS5zY29yZSA9IDAuMTtcbiAgICB2YXIgZTEgPSB7fSBhcyBidWlsZGVyLklFbnRpdHk7XG4gICAgZTEuc3RhcnRJbmRleCA9IFwiZXhpdCBcIi5sZW5ndGg7XG4gICAgZTEuZW5kSW5kZXggPSBjb250ZXh0Lm1lc3NhZ2UudGV4dC5sZW5ndGg7XG4gICAgZTEuc2NvcmUgPSAwLjE7XG4gICAgdS5lbnRpdGllcyA9IFtdO1xuICAgIGNhbGxiYWNrKHVuZGVmaW5lZCwgdSk7XG4gIH1cbn1cbiovXG5cbmNvbnN0IGFUcmFpblJlcGxpZXMgPSBbXCJUaGFuayB5b3UgZm9yIHNoYXJpbmcgdGhpcyBzdWdnZXN0aW9uIHdpdGggdXNcIixcbiAgXCJUaGFuayBmb3IgZm9yIHRoaXMgdmFsdWFibGUgaW5mb3JtYXRpb24uXCIsXG4gIFwiVGhhbmsgZm9yIGZvciB0aGlzIGludGVyZXN0aW5nIGZhY3QhXCIsXG4gIFwiVGhhdHMgYSBwbGV0aG9yaWEgb2YgaW5mb3JtYXRpb24uXCIsXG4gIFwiVGhhdCdzIGEgbnVnZ2V0IG9mIGluZm9ybWF0aW9uLlwiLFxuICBcIkxvdmVseSwgSSBtYXkgY29uc2lkZXIgeW91IGlucHV0LlwiLFxuICBcIldlbGwgZG9uZSwgYW55dGhpbmcgbW9yZSB0byBsZXQgbWUga25vdz9cIixcbiAgXCJJIGRvIGFwcHJlY2lhdGUgeW91ciB0ZWFjaGluZyBhbmQgbXkgbGVhcm5pbmcgZXhwZXJpZW5jZSwgb3Igd2FzIGl0IHRoZSBvdGhlciB3YXkgcm91bmQ/XCIsXG4gIFwiWW91ciBoZWxwZnVsIGlucHV0IGhhcyBiZWVuIHN0b3JlZCBpbiBzb21lIGR1c3R5IGNvcm5lciBvZiB0aGUgV29ybGQgd2lkZSB3ZWIhXCIsXG4gIFwiVGhhbmsgeW91IGZvciBteSBsZWFybmluZyBleHBlcmllbmNlIVwiLFxuICBcIkkgaGF2ZSBpbmNvcnBvcmF0ZWQgeW91ciB2YWx1YWJsZSBzdWdnZXN0aW9uIGluIHRoZSB3aXNkb20gb2YgdGhlIGludGVybmV0XCJcbl07XG5cbnZhciBhVHJhaW5EaWFsb2cgPSBhVHJhaW5SZXBsaWVzO1xuXG52YXIgYVRyYWluRXhpdEhpbnQgPSBbXG4gIFwiXFxudHlwZSBcXFwiZG9uZVxcXCIgd2hlbiB5b3UgYXJlIGRvbmUgdHJhaW5pbmcgbWUuXCIsXG4gIFwiXCIsXG4gIFwiXCIsXG4gIFwiXCIsXG4gIFwiXFxucmVtZW1iZXIsIHlvdSBhcmUgc3R1Y2sgaGVyZSBpbnN0cnVjdGluZyBtZSwgdHlwZSBcXFwiZG9uZVxcXCIgdG8gcmV0dXJuLlwiLFxuICBcIlwiXTtcblxuY29uc3QgYUVudGVyVHJhaW4gPSBbJ1NvIHlvdSB0aGluayB0aGlzIGlzIHdyb25nPyBZb3UgY2FuIG9mZmVyIHlvdXIgYWR2aXNlIGhlcmUuXFxuIFR5cGUgXCJkb25lXCIgaWYgeW91IGFyZSBkb25lIHdpdGggaW5zdHJ1Y3RpbmcgbWUnLFxuICAnRmVlbCBmcmVlIHRvIG9mZmVyIG1lIHlvdXIgYmV0dGVyIHNvbHV0aW9uIGhlcmUuXFxuVHlwZSBcImRvbmVcIiBpZiB5b3UgYXJlIGRvbmUgd2l0aCBpbnN0cnVjdGluZyBtZScsXG4gICdTb21lIHNheSBcIlRoZSBzZWNyZXQgdG8gaGFwcGluZXNzIGlzIHRvIGxvd2VyIHlvdXIgZXhwZWN0YXRpb25zIHRvIHRoZSBwb2ludCB0aGV5IGFyZSBhbHJlYWR5IG1ldC5cIiwgXFxudCBpZiB5b3UgY291bGQgaGVscCBtZSB0byBiZWNvbWUgYmV0dGVyLCBpbnN0cnVjdCBtZS5cXG4gVHlwZSBcImRvbmVcIiBpZiB5b3UgYXJlIGRvbmUgd2l0aCB0ZWFjaGluZyBtZScsXG4gICdGZWVsIGZyZWUgdG8gb2ZmZXIgbWUgeW91ciBiZXR0ZXIgc29sdXRpb24gaGVyZS5cXG4gVHlwZSBcImRvbmVcIiBpZiB5b3UgYXJlIGRvbmUgd2l0aCBpbnN0cnVjdGluZyBtZScsXG4gICdGZWVsIGZyZWUgdG8gb2ZmZXIgbWUgeW91ciBiZXR0ZXIgc29sdXRpb24gaGVyZS5cXG4gVHlwZSBcImRvbmVcIiBpZiB5b3UgYXJlIGRvbmUgd2l0aCBpbnN0cnVjdGluZyBtZScsXG5dO1xuY29uc3QgYUJhY2tGcm9tVHJhaW5pbmcgPSBbXG4gICdQdXVoLCBiYWNrIGZyb20gdHJhaW5pbmchIE5vdyBmb3IgdGhlIGVhc3kgcGFydCAuLi5cXG4gYXNrIG1lIGEgbmV3IHF1ZXN0aW9uLicsXG4gICdMaXZlIGFuZCBkb25cXCd0IGxlYXJuLCB0aGF0XFwncyB1cy4gTmFhaCwgd2VcXCdsbCBzZWUuXFxuQXNrIG1lIGFub3RoZXIgcXVlc3Rpb24uJyxcbiAgJ1RoZSBzZWNyZXQgdG8gaGFwcGluZXNzIGlzIHRvIGxvd2VyIHlvdXIgZXhwZWN0YXRpb25zIHRvIHRoZSBwb2ludCB0aGV5IGFyZSBhbHJlYWR5IG1ldC5cXG4gQXNrIG1lIGEgcXVlc3Rpb24uJyxcbiAgJ1RoYW5rcyBmb3IgaGF2aW5nIHRoaXMgbGVjdHVyZSBzZXNzaW9uLCBub3cgaSBhbSBiYWNrIHRvIG91ciB1c3VhbCBzZWxmLlxcbiBBc2sgbWUgYSBxdWVzdGlvbi4nXG5dO1xuXG5cbmNvbnN0IGFUcmFpbk5vS2xpbmdvbiA9IFtcbiAgXCJIZSB3aG8gbWFzdGVyIHRoZSBkYXJrIGFydHMgb2YgU0FQIG11c3Qgbm90IGR3ZWxsIGluIHRoZSBlYXJ0aGx5IHJlYWxtcyBvZiBTdGFydCBUcmVrLlwiLFxuICBcIlNBUCBpcyBhIGNsb3VkIGNvbXBhbnksIG5vdCBhIHNwYWNlIGNvbXBhbnkuXCIsXG4gIFwiVGhlIGRlcHRoIG9mIFIvMyBhcmUgZGVlcGVyIHRoYW4gRGVlcCBTcGFjZSA0Mi5cIixcbiAgXCJNeSBicmFpbnBvd2VyIGlzIGZ1bGx5IGFic29yYmVkIHdpdGggbWFzdGVyaW5nIG90aGVyIHJlYWxtcy5cIixcbiAgXCJGb3IgdGhlIHdvc2FwLCB0aGUgc2t5IGlzIHRoZSBsaW1pdC4gRmVlbCBmcmVlIHRvIGNoZWNrIG91dCBuYXNhLmdvdiAuXCIsXG4gIFwiVGhlIGZ1dHVyZSBpcyBTQVAgb3IgSUJNIGJsdWUsIG5vdCBzcGFjZSBibGFjay5cIixcbiAgXCJUaGF0J3MgbGVmdCB0byBzb21lIG11c2t5IGZ1dHVyZS5cIlxuXVxuXG5leHBvcnQgY29uc3QgYVJlc3BvbnNlc09uVG9vTG9uZyA9IFtcbiAgXCJZb3VyIGlucHV0IHNob3VsZCBiZSBlbG9xdWVudCBpbiBpdCdzIGJyZXZpdHkuIFRoaXMgb25lIHdhcyB0b28gbG9uZy5cIixcbiAgXCJteSB3aXNkb20gaXMgc2V2ZXJseSBib3VuZCBieSBteSBsaW1pdGVkIGlucHV0IHByb2Nlc3NpbmcgY2FwYWJpbGl0aWVzLiBDb3VsZCB5b3UgZm9ybXVsYXRlIGEgc2hvcnRlciBpbnB1dD8gVGhhbmsgeW91LlwiLFxuICBcIlRoZSBsZW5ndGggb2YgeW91IGlucHV0IGluZGljYXRlcyB5b3UgcHJvYmFibHkga25vdyBtb3JlIGFib3V0IHRoZSB0b3BpYyB0aGFuIG1lPyBDYW4gaSBodW1ibHkgYXNrIHlvdSB0byBmb3JtdWxhdGUgYSBzaG9ydGVyIHF1ZXN0aW9uP1wiLFxuICAnXFxcIldoYXQgZXZlciB5b3Ugd2FudCB0byB0ZWFjaCwgYmUgYnJpZWZcXFwiIChIb3JhY2UpLiBXaGlsZSB0aGlzIGRvZXMgbm90IGFsd2F5cyBhcHBsaWVzIHRvIG15IGFuc3dlcnMsIGl0IGlzIHJlcXVpcmUgZm9yIHlvdXIgcXVlc3Rpb25zLiBQbGVhc2UgdHJ5IGFnYWluIHdpdGggYSByZWZpbmVkIHF1ZXN0aW9ucy4nLFxuICAnSSB1bmRlcnN0YW5kIG1vcmUgdGhhbiA0LWxldHRlciB3b3JkcywgYnV0IG5vdCBtb3JlIHRoYW4gMjAgd29yZCBzZW50ZW5jZXMuIFBsZWFzZSB0cnkgdG8gc2hvcnRlbiB5b3VyIGlucHV0LicsXG4gICd0aGUgc2t5IGlzIHRoZSBsaW1pdD8gQWlyIGZvcmNlIG1lbWJlciBvciBub3QsIHlvdSBjYW4gYXNrIGxvbmdlciBxdWVzdGlvbnMgdGhhbiBcXFwidGhlIHNreVxcXCIsIGJ1dCBub3QgdGhpcyBsb25nJyxcbiAgJ015IGFuc3dlcnMgbWF5IGJlIGV4aGF1c3RpdmUsIGJ1dCBJIHVuZGVyc3RhbmQgbW9yZSB0aGFuIDQtbGV0dGVyIHdvcmRzLCBidXQgbm90IG1vcmUgdGhhbiAyMCB3b3JkIHNlbnRlbmNlcy4gU29ycnkuJyxcbiAgJ091ciBjb252ZXJzYXRpb24gbXVzdCBiZSBoaWdobHkgYXNzeW1tZXRyaWM6IG15IGFuc3dlcnMgbWF5IGJlIHZlcmJvc2UgYW5kIGV4aGF1c3RpdmUgYW5kIGZ1enp5LCBxdWVzdGlvbnMgYW5kIGlucHV0IG11c3QgYmUgYnJpZWYuIFRyeSB0byByZWZvcm11bGF0ZSBpdCcsXG5dO1xuXG5cbmV4cG9ydCBjb25zdCBtZXRhd29yZHNEZXNjcmlwdGlvbnMgPSB7XG4gICAgICAgIFwiY2F0ZWdvcnlcIjogXCJhbiBhdHRyaWJ1dGUgb2YgYSByZWNvcmQgaW4gYSBtb2RlbCwgZXhhbXBsZTogYSBQbGFuZXQgaGFzIGEgXFxcIm5hbWVcXFwiIGF0dHJpYnV0ZVwiLFxuICAgICAgICBcImRvbWFpblwiOiBcImEgZ3JvdXAgb2YgZmFjdHMgd2hpY2ggYXJlIHR5cGljYWxseSB1bnJlbGF0ZWRcIixcbiAgICAgICAgXCJrZXlcIjogXCJhbiBhdHRyaWJ1dGUgdmFsdWUgKG9mIGEgY2F0ZWdvcnkpIHdoaWNoICBpcyB1bmlxdWUgZm9yIHRoZSByZWNvcmRcIixcbiAgICAgICAgXCJ0b29sXCI6IFwiaXMgcG90ZW50aWFseSBjb21tYW5kIHRvIGV4ZWN1dGVcIixcbiAgICAgICAgXCJyZWNvcmRcIjogXCJhIHNwZWNpZmljIHNldCBvZiBcXFwiZmFjdFxcXCJzIG9mIGEgZG9tYWluLCBhIFxcXCJyZWNvcmRcXFwiIGhhcyBhIHNldCBvZiBhdHRyaWJ1dGVzIHZhbHVlcyAoXFxcImZhY3RcXFwicykgb2YgdGhlIGNhdGVnb3JpZXMsIG9mdGVuIGEgcmVjb3JkIGhhcyBhIFxcXCJrZXlcXFwiXCIsXG4gICAgICAgIFwiZmFjdFwiOiBcImEgc3BlY2lmaWMgY2F0ZWdvcnkgdmFsdWUgb2YgYSByZWNvcmQgaW4gYSBkb21haW4sIG1heSBiZSBhIFxcXCJrZXlcXFwiIHZhbHVlXCIsXG4gICAgICB9O1xuXG5mdW5jdGlvbiBnZXRSYW5kb21SZXN1bHQoYXJyOiBzdHJpbmdbXSk6IHN0cmluZyB7XG4gIHJldHVybiBhcnJbTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogYXJyLmxlbmd0aCkgJSBhcnIubGVuZ3RoXTtcbn1cblxuZXhwb3J0IGNsYXNzIFNpbXBsZVVwRG93blJlY29nbml6ZXIgaW1wbGVtZW50cyBidWlsZGVyLklJbnRlbnRSZWNvZ25pemVyIHtcbiAgY29uc3RydWN0b3IoKSB7XG5cbiAgfVxuXG4gIHJlY29nbml6ZShjb250ZXh0OiBidWlsZGVyLklSZWNvZ25pemVDb250ZXh0LCBjYWxsYmFjazogKGVycjogRXJyb3IsIHJlc3VsdDogYnVpbGRlci5JSW50ZW50UmVjb2duaXplclJlc3VsdCkgPT4gdm9pZCk6IHZvaWQge1xuICAgIHZhciB1ID0ge30gYXMgYnVpbGRlci5JSW50ZW50UmVjb2duaXplclJlc3VsdDtcblxuICAgIGRlYnVnbG9nKFwicmVjb2duaXppbmcgXCIgKyBjb250ZXh0Lm1lc3NhZ2UudGV4dCk7XG4gICAgaWYgKGNvbnRleHQubWVzc2FnZS50ZXh0LmluZGV4T2YoXCJkb3duXCIpID49IDApIHtcbiAgICAgIHUuaW50ZW50ID0gXCJpbnRlbnQuZG93blwiO1xuICAgICAgdS5zY29yZSA9IDAuOTtcbiAgICAgIHZhciBlMSA9IHt9IGFzIGJ1aWxkZXIuSUVudGl0eTtcbiAgICAgIGUxLnN0YXJ0SW5kZXggPSBcInN0YXJ0IFwiLmxlbmd0aDtcbiAgICAgIGUxLmVuZEluZGV4ID0gY29udGV4dC5tZXNzYWdlLnRleHQubGVuZ3RoO1xuICAgICAgZTEuc2NvcmUgPSAwLjM7XG4gICAgICB1LmVudGl0aWVzID0gW2UxXTtcbiAgICAgIGNhbGxiYWNrKHVuZGVmaW5lZCwgdSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChjb250ZXh0Lm1lc3NhZ2UudGV4dC5pbmRleE9mKFwidXBcIikgPj0gMCkge1xuICAgICAgdS5pbnRlbnQgPSBcImludGVudC51cFwiO1xuICAgICAgdS5zY29yZSA9IDAuOTtcbiAgICAgIHZhciBlMSA9IHt9IGFzIGJ1aWxkZXIuSUVudGl0eTtcbiAgICAgIGUxLnN0YXJ0SW5kZXggPSBcInVwXCIubGVuZ3RoO1xuICAgICAgZTEuZW5kSW5kZXggPSBjb250ZXh0Lm1lc3NhZ2UudGV4dC5sZW5ndGg7XG4gICAgICBlMS5zY29yZSA9IDAuMztcbiAgICAgIHUuZW50aXRpZXMgPSBbZTFdO1xuICAgICAgY2FsbGJhY2sodW5kZWZpbmVkLCB1KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGNvbnRleHQubWVzc2FnZS50ZXh0LmluZGV4T2YoXCJkb25lXCIpID49IDApIHtcbiAgICAgIHUuaW50ZW50ID0gXCJpbnRlbnQudXBcIjtcbiAgICAgIHUuc2NvcmUgPSAwLjk7XG4gICAgICB2YXIgZTEgPSB7fSBhcyBidWlsZGVyLklFbnRpdHk7XG4gICAgICBlMS5zdGFydEluZGV4ID0gXCJ1cFwiLmxlbmd0aDtcbiAgICAgIGUxLmVuZEluZGV4ID0gY29udGV4dC5tZXNzYWdlLnRleHQubGVuZ3RoO1xuICAgICAgZTEuc2NvcmUgPSAwLjM7XG4gICAgICB1LmVudGl0aWVzID0gW2UxXTtcbiAgICAgIGNhbGxiYWNrKHVuZGVmaW5lZCwgdSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChjb250ZXh0Lm1lc3NhZ2UudGV4dC5pbmRleE9mKFwiZXhpdFwiKSA+PSAwKSB7XG4gICAgICB1LmludGVudCA9IFwiaW50ZW50LnVwXCI7XG4gICAgICB1LnNjb3JlID0gMC45O1xuICAgICAgdmFyIGUxID0ge30gYXMgYnVpbGRlci5JRW50aXR5O1xuICAgICAgZTEuc3RhcnRJbmRleCA9IFwidXBcIi5sZW5ndGg7XG4gICAgICBlMS5lbmRJbmRleCA9IGNvbnRleHQubWVzc2FnZS50ZXh0Lmxlbmd0aDtcbiAgICAgIGUxLnNjb3JlID0gMC4zO1xuICAgICAgdS5lbnRpdGllcyA9IFtlMV07XG4gICAgICBjYWxsYmFjayh1bmRlZmluZWQsIHUpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoY29udGV4dC5tZXNzYWdlLnRleHQuaW5kZXhPZihcInF1aXRcIikgPj0gMCkge1xuICAgICAgdS5pbnRlbnQgPSBcImludGVudC51cFwiO1xuICAgICAgdS5zY29yZSA9IDAuOTtcbiAgICAgIHZhciBlMSA9IHt9IGFzIGJ1aWxkZXIuSUVudGl0eTtcbiAgICAgIGUxLnN0YXJ0SW5kZXggPSBcInVwXCIubGVuZ3RoO1xuICAgICAgZTEuZW5kSW5kZXggPSBjb250ZXh0Lm1lc3NhZ2UudGV4dC5sZW5ndGg7XG4gICAgICBlMS5zY29yZSA9IDAuMztcbiAgICAgIHUuZW50aXRpZXMgPSBbZTFdO1xuICAgICAgY2FsbGJhY2sodW5kZWZpbmVkLCB1KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgZGVidWdsb2coJ3JlY29nbml6aW5nIG5vdGhpbmcnKTtcbiAgICB1LmludGVudCA9IFwiTm9uZVwiO1xuICAgIHUuc2NvcmUgPSAwLjE7XG4gICAgdmFyIGUxID0ge30gYXMgYnVpbGRlci5JRW50aXR5O1xuICAgIGUxLnN0YXJ0SW5kZXggPSBcImV4aXQgXCIubGVuZ3RoO1xuICAgIGUxLmVuZEluZGV4ID0gY29udGV4dC5tZXNzYWdlLnRleHQubGVuZ3RoO1xuICAgIGUxLnNjb3JlID0gMC4xO1xuICAgIHUuZW50aXRpZXMgPSBbXTtcbiAgICBjYWxsYmFjayh1bmRlZmluZWQsIHUpO1xuICB9XG59XG5cbmNvbnN0IEFueU9iamVjdCA9IE9iamVjdCBhcyBhbnk7XG4vLyBnbG9iYWxUdW5uZWwuaW5pdGlhbGl6ZSh7XG4vLyAgaG9zdDogJ3Byb3h5LmV4eHhhbXBsZS5jb20nLFxuLy8gIHBvcnQ6IDgwODBcbi8vIH0pXG5cbi8vIENyZWF0ZSBib3QgYW5kIGJpbmQgdG8gY29uc29sZVxuLy8gdmFyIGNvbm5lY3RvciA9IG5ldyBodG1sY29ubmVjdG9yLkhUTUxDb25uZWN0b3IoKVxuXG4vLyBjb25uZWN0b3Iuc2V0QW5zd2VySG9vayhmdW5jdGlvbiAoc0Fuc3dlcikge1xuLy8gIGNvbnNvbGUubG9nKCdHb3QgYW5zd2VyIDogJyArIHNBbnN3ZXIgKyAnXFxuJylcbi8vIH0pXG5cbnZhciBib3Q7XG4vLyBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbi8vICAgY29ubmVjdG9yLnByb2Nlc3NNZXNzYWdlKCdzdGFydCB1bml0IHRlc3QgQUJDICcpXG4vLyB9LCA1MDAwKVxuXG5pbXBvcnQgKiBhcyBmcyBmcm9tICdmcyc7XG5cbnZhciBvSlNPTiA9IEpTT04ucGFyc2UoJycgKyBmcy5yZWFkRmlsZVN5bmMoJy4vcmVzb3VyY2VzL21vZGVsL2ludGVudHMuanNvbicpKTtcbnZhciBvUnVsZXMgPSBQbGFpblJlY29nbml6ZXIucGFyc2VSdWxlcyhvSlNPTik7XG4vLyB2YXIgUmVjb2duaXplciA9IG5ldyAocmVjb2duaXplci5SZWdFeHBSZWNvZ25pemVyKShvUnVsZXMpO1xuXG5cbmZ1bmN0aW9uIGxvZ1F1ZXJ5KHNlc3Npb246IGJ1aWxkZXIuU2Vzc2lvbiwgaW50ZW50OiBzdHJpbmcsIHJlc3VsdD86IEFycmF5PElNYXRjaC5JVG9vbE1hdGNoPikge1xuXG4gIGZzLmFwcGVuZEZpbGUoJy4vbG9ncy9zaG93bWVxdWVyaWVzLnR4dCcsIFwiXFxuXCIgKyBKU09OLnN0cmluZ2lmeSh7XG4gICAgdGV4dDogc2Vzc2lvbi5tZXNzYWdlLnRleHQsXG4gICAgdGltZXN0YW1wOiBzZXNzaW9uLm1lc3NhZ2UudGltZXN0YW1wLFxuICAgIGludGVudDogaW50ZW50LFxuICAgIHJlczogcmVzdWx0ICYmIHJlc3VsdC5sZW5ndGggJiYgTWF0Y2guVG9vbE1hdGNoLmR1bXBOaWNlKHJlc3VsdFswXSkgfHwgXCIwXCIsXG4gICAgY29udmVyc2F0aW9uSWQ6IHNlc3Npb24ubWVzc2FnZS5hZGRyZXNzXG4gICAgJiYgc2Vzc2lvbi5tZXNzYWdlLmFkZHJlc3MuY29udmVyc2F0aW9uXG4gICAgJiYgc2Vzc2lvbi5tZXNzYWdlLmFkZHJlc3MuY29udmVyc2F0aW9uLmlkIHx8IFwiXCIsXG4gICAgdXNlcmlkOiBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzc1xuICAgICYmIHNlc3Npb24ubWVzc2FnZS5hZGRyZXNzLnVzZXJcbiAgICAmJiBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzcy51c2VyLmlkIHx8IFwiXCJcbiAgfSksIGZ1bmN0aW9uIChlcnIsIHJlcykge1xuICAgIGlmIChlcnIpIHtcbiAgICAgIGRlYnVnbG9nKFwibG9nZ2luZyBmYWlsZWQgXCIgKyBlcnIpO1xuICAgIH1cbiAgfSk7XG59XG5cblxuXG5mdW5jdGlvbiBsb2dRdWVyeVdoYXRJcyhzZXNzaW9uOiBidWlsZGVyLlNlc3Npb24sIGludGVudDogc3RyaW5nLCByZXN1bHQ/OiBBcnJheTxJTWF0Y2guSVdoYXRJc0Fuc3dlcj4pIHtcblxuICBmcy5hcHBlbmRGaWxlKCcuL2xvZ3Mvc2hvd21lcXVlcmllcy50eHQnLCBcIlxcblwiICsgSlNPTi5zdHJpbmdpZnkoe1xuICAgIHRleHQ6IHNlc3Npb24ubWVzc2FnZS50ZXh0LFxuICAgIHRpbWVzdGFtcDogc2Vzc2lvbi5tZXNzYWdlLnRpbWVzdGFtcCxcbiAgICBpbnRlbnQ6IGludGVudCxcbiAgICByZXM6IHJlc3VsdCAmJiByZXN1bHQubGVuZ3RoICYmIFdoYXRJcy5kdW1wTmljZShyZXN1bHRbMF0pIHx8IFwiMFwiLFxuICAgIGNvbnZlcnNhdGlvbklkOiBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzc1xuICAgICYmIHNlc3Npb24ubWVzc2FnZS5hZGRyZXNzLmNvbnZlcnNhdGlvblxuICAgICYmIHNlc3Npb24ubWVzc2FnZS5hZGRyZXNzLmNvbnZlcnNhdGlvbi5pZCB8fCBcIlwiLFxuICAgIHVzZXJpZDogc2Vzc2lvbi5tZXNzYWdlLmFkZHJlc3NcbiAgICAmJiBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzcy51c2VyXG4gICAgJiYgc2Vzc2lvbi5tZXNzYWdlLmFkZHJlc3MudXNlci5pZCB8fCBcIlwiXG4gIH0pLCBmdW5jdGlvbiAoZXJyLCByZXMpIHtcbiAgICBpZiAoZXJyKSB7XG4gICAgICBkZWJ1Z2xvZyhcImxvZ2dpbmcgZmFpbGVkIFwiICsgZXJyKTtcbiAgICB9XG4gIH0pO1xufVxuXG5mdW5jdGlvbiBsb2dRdWVyeVdoYXRJc1R1cGVsKHNlc3Npb246IGJ1aWxkZXIuU2Vzc2lvbiwgaW50ZW50OiBzdHJpbmcsIHJlc3VsdD86IEFycmF5PElNYXRjaC5JV2hhdElzVHVwZWxBbnN3ZXI+KSB7XG5cbiAgZnMuYXBwZW5kRmlsZSgnLi9sb2dzL3Nob3dtZXF1ZXJpZXMudHh0JywgXCJcXG5cIiArIEpTT04uc3RyaW5naWZ5KHtcbiAgICB0ZXh0OiBzZXNzaW9uLm1lc3NhZ2UudGV4dCxcbiAgICB0aW1lc3RhbXA6IHNlc3Npb24ubWVzc2FnZS50aW1lc3RhbXAsXG4gICAgaW50ZW50OiBpbnRlbnQsXG4gICAgcmVzOiByZXN1bHQgJiYgcmVzdWx0Lmxlbmd0aCAmJiBXaGF0SXMuZHVtcE5pY2VUdXBlbChyZXN1bHRbMF0pIHx8IFwiMFwiLFxuICAgIGNvbnZlcnNhdGlvbklkOiBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzc1xuICAgICYmIHNlc3Npb24ubWVzc2FnZS5hZGRyZXNzLmNvbnZlcnNhdGlvblxuICAgICYmIHNlc3Npb24ubWVzc2FnZS5hZGRyZXNzLmNvbnZlcnNhdGlvbi5pZCB8fCBcIlwiLFxuICAgIHVzZXJpZDogc2Vzc2lvbi5tZXNzYWdlLmFkZHJlc3NcbiAgICAmJiBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzcy51c2VyXG4gICAgJiYgc2Vzc2lvbi5tZXNzYWdlLmFkZHJlc3MudXNlci5pZCB8fCBcIlwiXG4gIH0pLCBmdW5jdGlvbiAoZXJyLCByZXMpIHtcbiAgICBpZiAoZXJyKSB7XG4gICAgICBkZWJ1Z2xvZyhcImxvZ2dpbmcgZmFpbGVkIFwiICsgZXJyKTtcbiAgICB9XG4gIH0pO1xufVxuXG52YXIgZ3dvcmRzID0ge307XG4vKipcbiAqIENvbnN0cnVjdCBhIGJvdFxuICogQHBhcmFtIGNvbm5lY3RvciB7Q29ubmVjdG9yfSB0aGUgY29ubmVjdG9yIHRvIHVzZVxuICogSFRNTENvbm5lY3RvclxuICogb3IgY29ubmVjdG9yID0gbmV3IGJ1aWxkZXIuQ29uc29sZUNvbm5lY3RvcigpLmxpc3RlbigpXG4gKi9cbmZ1bmN0aW9uIG1ha2VCb3QoY29ubmVjdG9yLCBtb2RlbFBhdGg/OiBzdHJpbmcsIG9wdGlvbnM/IDogYW55ICkge1xuICB2YXIgdCA9IERhdGUubm93KCk7XG4gIHZhciB0aGVNb2RlbCA9IGxvYWRNb2RlbChtb2RlbFBhdGgpO1xuICB2YXIgdCA9IERhdGUubm93KCkgLSB0O1xuICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLnNob3dNb2RlbExvYWRUaW1lKSB7XG4gICAgY29uc29sZS5sb2coYG1vZGVsIGxvYWQgdGltZSAkeyh0KX1gKTtcbiAgfVxuXG4gIGJvdCA9IG5ldyBidWlsZGVyLlVuaXZlcnNhbEJvdChjb25uZWN0b3IpO1xuXG5cblxuICAvLyBDcmVhdGUgTFVJUyByZWNvZ25pemVyIHRoYXQgcG9pbnRzIGF0IG91ciBtb2RlbCBhbmQgYWRkIGl0IGFzIHRoZSByb290ICcvJyBkaWFsb2cgZm9yIG91ciBDb3J0YW5hIEJvdC5cbiAgLy8gdmFyIG1vZGVsID0gc2Vuc2l0aXZlLm1vZGVsdXJsO1xuICAvLyB2YXIgbW9kZWwgPSAnaHR0cHM6Ly9hcGkucHJvamVjdG94Zm9yZC5haS9sdWlzL3YyLjAvYXBwcy9jNDEzYjJlZi0zODJjLTQ1YmQtOGZmMC1mNzZkNjBlMmE4MjE/c3Vic2NyaXB0aW9uLWtleT1jMjEzOThiNTk4MGE0Y2UwOWY0NzRiYmZlZTkzYjg5MiZxPSdcbiAgdmFyIHJlY29nbml6ZXIgPSBuZXcgUGxhaW5SZWNvZ25pemVyLlJlZ0V4cFJlY29nbml6ZXIob1J1bGVzKTtcblxuICB2YXIgZGlhbG9nID0gbmV3IGJ1aWxkZXIuSW50ZW50RGlhbG9nKHsgcmVjb2duaXplcnM6IFtyZWNvZ25pemVyXSB9KTtcbiAgLy8gZGlhbG9nLm9uQmVnaW4oZnVuY3Rpb24oc2Vzc2lvbixhcmdzKSB7XG4gIC8vIGNvbnNvbGUubG9nKFwiYmVnaW5uaW5nIC4uLlwiKVxuICAvLyBzZXNzaW9uLmRpYWxvZ0RhdGEucmV0cnlQcm9tcHQgPSBhcmdzICYmIGFyZ3MucmV0cnlQcm9tcHQgfHwgXCJJIGFtIHNvcnJ5XCJcbiAgLy8gc2Vzc2lvbi5zZW5kKFwiV2hhdCBkbyB5b3Ugd2FudD9cIilcbiAgLy9cbiAgLy8gfSlcblxuICB2YXIgZGlhbG9nVXBEb3duID0gbmV3IGJ1aWxkZXIuSW50ZW50RGlhbG9nKHsgcmVjb2duaXplcnM6IFtuZXcgU2ltcGxlVXBEb3duUmVjb2duaXplcigpXSB9KTtcblxuICBib3QuZGlhbG9nKCcvdXBkb3duJywgZGlhbG9nVXBEb3duKTtcbiAgZGlhbG9nVXBEb3duLm9uQmVnaW4oZnVuY3Rpb24gKHNlc3Npb24pIHtcbiAgICBkaWFsb2dsb2coXCJUcmFpbk1lXCIsIHNlc3Npb24sIHNlbmQoZ2V0UmFuZG9tUmVzdWx0KGFFbnRlclRyYWluKSkpO1xuICAgIC8vc2Vzc2lvbi5zZW5kKFwiSGkgdGhlcmUsIHVwZG93biBpcyB3YWl0aW5nIGZvciB5b3VcIik7XG4gIH0pXG5cbiAgZGlhbG9nVXBEb3duLm1hdGNoZXMoJ2ludGVudC51cCcsIFtcbiAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgYXJncywgbmV4dCkge1xuICAgICAgc2Vzc2lvbi5kaWFsb2dEYXRhLmFiYyA9IGFyZ3MgfHwge307XG4gICAgICBidWlsZGVyLlByb21wdHMudGV4dChzZXNzaW9uLCAneW91IHdhbnQgdG8gZXhpdCB0cmFpbmluZz8gdHlwZSBcXFwiZG9uZVxcXCIgYWdhaW4uJyk7XG4gICAgfSxcbiAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgcmVzdWx0cywgbmV4dCkge1xuICAgICAgc2Vzc2lvbi5kaWFsb2dEYXRhLmFiYyA9IHJlc3VsdHMucmVwb25zZTtcbiAgICAgIG5leHQoKTtcbiAgICB9LFxuICAgIGZ1bmN0aW9uIChzZXNzaW9uLCByZXN1bHRzKSB7XG4gICAgICBzZXNzaW9uLmVuZERpYWxvZ1dpdGhSZXN1bHQoeyByZXNwb25zZTogc2Vzc2lvbi5kaWFsb2dEYXRhLmFiYyB9KTtcbiAgICB9XG4gIF1cbiAgKTtcblxuICBkaWFsb2dVcERvd24ubWF0Y2hlcygnaW50ZW50LmRvd24nLCBbXG4gICAgZnVuY3Rpb24gKHNlc3Npb24sIGFyZ3MsIG5leHQpIHtcbiAgICAgIHNlc3Npb24uZGlhbG9nRGF0YS5hYmMgPSBhcmdzIHx8IHt9O1xuICAgICAgYnVpbGRlci5Qcm9tcHRzLnRleHQoc2Vzc2lvbiwgJ3lvdSB3YW50IHRvIGdvIGRvd24hJyk7XG4gICAgfSxcbiAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgcmVzdWx0cywgbmV4dCkge1xuICAgICAgc2Vzc2lvbi5kaWFsb2dEYXRhLmFiYyA9IC0xOyAvLyByZXN1bHRzLnJlcG9uc2U7XG4gICAgICBuZXh0KCk7XG4gICAgfSxcbiAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgcmVzdWx0cykge1xuICAgICAgc2Vzc2lvbi5zZW5kKFwic3RpbGwgZ29pbmcgZG93bj9cIik7XG4gICAgfVxuICBdXG4gICk7XG4gIGRpYWxvZ1VwRG93bi5vbkRlZmF1bHQoZnVuY3Rpb24gKHNlc3Npb24pIHtcbiAgICBsb2dRdWVyeShzZXNzaW9uLCBcIm9uRGVmYXVsdFwiKTtcbiAgICB2YXIgcmVzID0gZ2V0UmFuZG9tUmVzdWx0KGFUcmFpbkRpYWxvZykgKyBnZXRSYW5kb21SZXN1bHQoYVRyYWluRXhpdEhpbnQpO1xuICAgIGRpYWxvZ2xvZyhcIlRyYWluTWVcIiwgc2Vzc2lvbiwgc2VuZChyZXMpKTtcbiAgfSk7XG5cblxuICBib3QuZGlhbG9nKCcvdHJhaW4nLCBbXG4gICAgZnVuY3Rpb24gKHNlc3Npb24sIGFyZ3MsIG5leHQpIHtcbiAgICAgIHNlc3Npb24uZGlhbGdvRGF0YS5hYmMgPSBhcmdzIHx8IHt9O1xuICAgICAgYnVpbGRlci5Qcm9tcHRzLnRleHQoc2Vzc2lvbiwgJ0RvIHlvdSB3YW50IHRvIHRyYWluIG1lJyk7XG4gICAgfSxcbiAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgcmVzdWx0cywgbmV4dCkge1xuICAgICAgc2Vzc2lvbi5kaWFsb2dEYXRhLmFiYyA9IHJlc3VsdHMucmVwb25zZTtcbiAgICB9LFxuICAgIGZ1bmN0aW9uIChzZXNzaW9uLCByZXN1bHRzKSB7XG4gICAgICBzZXNzaW9uLmVuZERpYWxvZ1dpdGhSZXN1bHQoeyByZXNwb25zZTogc2Vzc2lvbi5EaWFsb2dEYXRhLmFiYyB9KTtcbiAgICB9XG4gIF0pO1xuXG5cbiAgYm90LmRpYWxvZygnLycsIGRpYWxvZyk7XG5cbiAgZGlhbG9nLm1hdGNoZXMoJ1Nob3dNZScsIFtcbiAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgYXJncywgbmV4dCkge1xuICAgICAgdmFyIGlzQ29tYmluZWRJbmRleCA9IHt9O1xuICAgICAgdmFyIG9OZXdFbnRpdHk7XG4gICAgICAvLyBleHBlY3RpbmcgZW50aXR5IEExXG4gICAgICBkZWJ1Z2xvZyhcIlNob3cgRW50aXR5XCIpO1xuICAgICAgZGVidWdsb2coJ3JhdzogJyArIEpTT04uc3RyaW5naWZ5KGFyZ3MuZW50aXRpZXMpLCB1bmRlZmluZWQsIDIpO1xuICAgICAgdmFyIGExID0gYnVpbGRlci5FbnRpdHlSZWNvZ25pemVyLmZpbmRFbnRpdHkoYXJncy5lbnRpdGllcywgJ0ExJyk7XG4gICAgICBjb25zdCByZXN1bHQgPSBBbmFseXplLmFuYWx5emVBbGwoYTEuZW50aXR5LFxuICAgICAgICB0aGVNb2RlbC5ydWxlcywgdGhlTW9kZWwudG9vbHMsIGd3b3Jkcyk7XG4gICAgICBsb2dRdWVyeShzZXNzaW9uLCAnU2hvd01lJywgcmVzdWx0KTtcbiAgICAgIC8vIHRlc3QuZXhwZWN0KDMpXG4gICAgICAvLyAgdGVzdC5kZWVwRXF1YWwocmVzdWx0LndlaWdodCwgMTIwLCAnY29ycmVjdCB3ZWlnaHQnKTtcbiAgICAgIGlmICghcmVzdWx0IHx8IHJlc3VsdC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgbmV4dCgpO1xuICAgICAgfVxuICAgICAgLy8gZGVidWdsb2coJ3Jlc3VsdCA6ICcgKyBKU09OLnN0cmluZ2lmeShyZXN1bHQsIHVuZGVmaW5lZCwgMikpO1xuICAgICAgZGVidWdsb2coJ2Jlc3QgcmVzdWx0IDogJyArIEpTT04uc3RyaW5naWZ5KHJlc3VsdFswXSB8fCB7fSwgdW5kZWZpbmVkLCAyKSk7XG4gICAgICBkZWJ1Z2xvZygndG9wIDogJyArIE1hdGNoLlRvb2xNYXRjaC5kdW1wV2VpZ2h0c1RvcChyZXN1bHQsIHsgdG9wOiAzIH0pKTtcblxuICAgICAgaWYgKEFuYWx5emUuaXNDb21wbGV0ZShyZXN1bHRbMF0pKSB7XG4gICAgICAgIHNlc3Npb24uZGlhbG9nRGF0YS5yZXN1bHQgPSByZXN1bHRbMF07XG4gICAgICAgIC8vICAgIHNlc3Npb24uc2VuZCgnU2hvd2luZyBlbnRpdHkgLi4uJyk7XG4gICAgICAgIG5leHQoKTtcbiAgICAgIH0gZWxzZSBpZiAoQW5hbHl6ZS5nZXRQcm9tcHQocmVzdWx0WzBdKSkge1xuICAgICAgICB2YXIgcHJvbXB0ID0gQW5hbHl6ZS5nZXRQcm9tcHQocmVzdWx0WzBdKTtcbiAgICAgICAgc2Vzc2lvbi5kaWFsb2dEYXRhLnJlc3VsdCA9IHJlc3VsdFswXTtcbiAgICAgICAgc2Vzc2lvbi5kaWFsb2dEYXRhLnByb21wdCA9IHByb21wdDtcbiAgICAgICAgZGlhbG9nbG9nKFwiU2hvd01lXCIsIHNlc3Npb24sIHNlbmQoXCJOb3QgZW5vdWdoIGluZm9ybWF0aW9uIHN1cHBsaWVkOiBcIiArIE1hdGNoLlRvb2xNYXRjaC5kdW1wTmljZShcbiAgICAgICAgICBzZXNzaW9uLmRpYWxvZ0RhdGEucmVzdWx0XG4gICAgICAgICkpKTtcbiAgICAgICAgYnVpbGRlci5Qcm9tcHRzLnRleHQoc2Vzc2lvbiwgcHJvbXB0LnRleHQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIGJlc3QgPSByZXN1bHQubGVuZ3RoID8gTWF0Y2guVG9vbE1hdGNoLmR1bXBOaWNlKHJlc3VsdFswXSkgOiBcIjxub3RoaW5nPlwiO1xuICAgICAgICBkaWFsb2dsb2coXCJTaG93TWVcIiwgc2Vzc2lvbiwgc2VuZCgnSSBkaWQgbm90IHVuZGVyc3RhbmQgdGhpcycgKyBiZXN0KSk7XG4gICAgICB9XG4gICAgfSxcbiAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgcmVzdWx0cywgbmV4dCkge1xuICAgICAgdmFyIHJlc3VsdCA9IHNlc3Npb24uZGlhbG9nRGF0YS5yZXN1bHQ7XG4gICAgICBpZiAoIXJlc3VsdCB8fCByZXN1bHQubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIG5leHQoKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHJlc3VsdHMucmVzcG9uc2UpIHtcbiAgICAgICAgLy8gc29tZSBwcm9tcHRpbmdcbiAgICAgICAgQW5hbHl6ZS5zZXRQcm9tcHQoc2Vzc2lvbi5kaWFsb2dEYXRhLnJlc3VsdCwgc2Vzc2lvbi5kaWFsb2dEYXRhLnByb21wdCwgcmVzdWx0cy5yZXNwb25zZSk7XG4gICAgICB9XG4gICAgICBpZiAoQW5hbHl6ZS5pc0NvbXBsZXRlKHNlc3Npb24uZGlhbG9nRGF0YS5yZXN1bHQpKSB7XG4gICAgICAgIG5leHQoKTtcbiAgICAgIH0gZWxzZSBpZiAoQW5hbHl6ZS5nZXRQcm9tcHQoc2Vzc2lvbi5kaWFsb2dEYXRhLnJlc3VsdCkpIHtcbiAgICAgICAgdmFyIHByb21wdCA9IEFuYWx5emUuZ2V0UHJvbXB0KHNlc3Npb24uZGlhbG9nRGF0YS5yZXN1bHQpO1xuICAgICAgICBzZXNzaW9uLmRpYWxvZ0RhdGEucHJvbXB0ID0gcHJvbXB0O1xuICAgICAgICBidWlsZGVyLlByb21wdHMudGV4dChzZXNzaW9uLCBwcm9tcHQudGV4dCk7XG4gICAgICB9XG4gICAgfSxcbiAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgcmVzdWx0cywgbmV4dCkge1xuICAgICAgdmFyIHJlc3VsdCA9IHNlc3Npb24uZGlhbG9nRGF0YS5yZXN1bHQ7XG4gICAgICBpZiAocmVzdWx0cy5yZXNwb25zZSkge1xuICAgICAgICAvLyBzb21lIHByb21wdGluZ1xuICAgICAgICBBbmFseXplLnNldFByb21wdChzZXNzaW9uLmRpYWxvZ0RhdGEucmVzdWx0LFxuICAgICAgICAgIHNlc3Npb24uZGlhbG9nRGF0YS5wcm9tcHQsIHJlc3VsdHMucmVzcG9uc2UpO1xuICAgICAgfVxuICAgICAgaWYgKEFuYWx5emUuaXNDb21wbGV0ZShzZXNzaW9uLmRpYWxvZ0RhdGEucmVzdWx0KSkge1xuICAgICAgICBjb25zdCBleGVjID0gRXhlY1NlcnZlci5leGVjVG9vbChzZXNzaW9uLmRpYWxvZ0RhdGEucmVzdWx0IGFzIElNYXRjaC5JVG9vbE1hdGNoLCB0aGVNb2RlbC5yZWNvcmRzKTtcblxuICAgICAgICB2YXIgcmVwbHkgPSBuZXcgYnVpbGRlci5NZXNzYWdlKHNlc3Npb24pXG4gICAgICAgICAgLnRleHQoZXhlYy50ZXh0KVxuICAgICAgICAgIC5hZGRFbnRpdHkoZXhlYy5hY3Rpb24pO1xuICAgICAgICAvLyAuYWRkQXR0YWNobWVudCh7IGZhbGxiYWNrVGV4dDogXCJJIGRvbid0IGtub3dcIiwgY29udGVudFR5cGU6ICdpbWFnZS9qcGVnJywgY29udGVudFVybDogXCJ3d3cud29tYmF0Lm9yZ1wiIH0pO1xuICAgICAgICBkaWFsb2dsb2coXCJTaG93TWVcIiwgc2Vzc2lvbiwgc2VuZChyZXBseSkpO1xuXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoc2Vzc2lvbi5kaWFsb2dEYXRhLnJlc3VsdCkge1xuICAgICAgICAgIGRpYWxvZ2xvZyhcIlNob3dNZVwiLFxuICAgICAgICAgICAgc2Vzc2lvbiwgc2VuZChcIk5vdCBlbm91Z2ggaW5mb3JtYXRpb24gc3VwcGxpZWQ6IFwiICsgTWF0Y2guVG9vbE1hdGNoLmR1bXBOaWNlKFxuICAgICAgICAgICAgICBzZXNzaW9uLmRpYWxvZ0RhdGEucmVzdWx0XG4gICAgICAgICAgICApKSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZGlhbG9nbG9nKFwiU2hvd01lXCIsIHNlc3Npb24sIHNlbmQoXCJJIGRpZCBub3QgZ2V0IHdoYXQgeW91IHdhbnRcIikpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcbiAgXSk7XG5cbiAgZGlhbG9nLm1hdGNoZXMoJ1doYXRJcycsIFtcbiAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgYXJncywgbmV4dCkge1xuICAgICAgdmFyIGlzQ29tYmluZWRJbmRleCA9IHt9O1xuICAgICAgdmFyIG9OZXdFbnRpdHk7XG4gICAgICAvLyBleHBlY3RpbmcgZW50aXR5IEExXG4gICAgICB2YXIgbWVzc2FnZSA9IHNlc3Npb24ubWVzc2FnZS50ZXh0O1xuICAgICAgZGVidWdsb2coXCJXaGF0SXMgRW50aXRpZXNcIik7XG4gICAgICBkZWJ1Z2xvZyhkZWJ1Z2xvZy5lbmFibGVkPyAoJ3JhdzogJyArIEpTT04uc3RyaW5naWZ5KGFyZ3MuZW50aXRpZXMsIHVuZGVmaW5lZCwgMikpOiAnLScpO1xuICAgICAgdmFyIGNhdGVnb3J5RW50aXR5ID0gYnVpbGRlci5FbnRpdHlSZWNvZ25pemVyLmZpbmRFbnRpdHkoYXJncy5lbnRpdGllcywgJ2NhdGVnb3J5Jyk7XG4gICAgICB2YXIgY2F0ZWdvcnkgPSBjYXRlZ29yeUVudGl0eS5lbnRpdHk7XG4gICAgICB2YXIgYTEgPSBidWlsZGVyLkVudGl0eVJlY29nbml6ZXIuZmluZEVudGl0eShhcmdzLmVudGl0aWVzLCAnQTEnKTtcbiAgICAgIHZhciBjYXRzID0gW107XG4gICAgICB0cnkge1xuICAgICAgICBjYXRzID0gV2hhdElzLmFuYWx5emVDYXRlZ29yeU11bHRPbmx5QW5kQ29tbWEoY2F0ZWdvcnksIHRoZU1vZGVsLnJ1bGVzLCBtZXNzYWdlKTtcbiAgICAgICAgZGVidWdsb2coXCJoZXJlIGNhdHNcIiArIGNhdHMuam9pbihcIixcIikpO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICBpZiAoZSkge1xuICAgICAgICAgIGRlYnVnbG9nKFwiaGVyZSBleGNlcHRpb25cIiArIGUpO1xuICAgICAgICAgIGRpYWxvZ2xvZyhcIldoYXRJc1wiLCBzZXNzaW9uLCBzZW5kKCdJIGRvblxcJ3Qga25vdyBhbnl0aGluZyBhYm91dCBcIicgKyBjYXRlZ29yeSArXG4gICAgICAgICAgICAoZSA/ICcoJyArIGUudG9TdHJpbmcoKSArICcpJyA6IFwiXCIpKSk7XG4gICAgICAgICAgLy8gbmV4dCgpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICB2YXIgY2F0ID0gdW5kZWZpbmVkO1xuICAgICAgLy8gd2UgaGF2ZSBzb21lIGNhdHMsIChvciBhdCBsZWFzdCBvbmUpXG4gICAgICBpZiAoY2F0cy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgY2F0ID0gY2F0c1swXTtcbiAgICAgICAgaWYgKCFjYXQpIHtcbiAgICAgICAgICBzZXNzaW9uLnNlbmQoJ0kgZG9uXFwndCBrbm93IGFueXRoaW5nIGFib3V0IFwiJyArIGNhdGVnb3J5ICsgJ1wiJyk7XG4gICAgICAgICAgLy8gbmV4dCgpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKGNhdHMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgIGRlYnVnbG9nKCdjYXRlZ29yeSBpZGVudGlmaWVkOicgKyBjYXQpO1xuICAgICAgICBjb25zdCByZXN1bHQgPSBXaGF0SXMucmVzb2x2ZUNhdGVnb3J5KGNhdCwgYTEuZW50aXR5LFxuICAgICAgICAgIHRoZU1vZGVsLnJ1bGVzLCB0aGVNb2RlbC5yZWNvcmRzKTtcbiAgICAgICAgZGVidWdsb2coZGVidWdsb2cuZW5hYmxlZD8gKCd3aGF0aXMgcmVzdWx0OicgKyBKU09OLnN0cmluZ2lmeShyZXN1bHQpKTonLScpO1xuICAgICAgICBsb2dRdWVyeVdoYXRJcyhzZXNzaW9uLCAnV2hhdElzJywgcmVzdWx0LmFuc3dlcnMpO1xuICAgICAgICB2YXIgaW5kaXMgPSBXaGF0SXMuaXNJbmRpc2NyaW1pbmF0ZVJlc3VsdChyZXN1bHQuYW5zd2Vycyk7XG4gICAgICAgIGlmIChpbmRpcykge1xuICAgICAgICAgIHNlc3Npb24uc2VuZChpbmRpcyk7XG4gICAgICAgICAgLy8gbmV4dCgpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoIXJlc3VsdCB8fCByZXN1bHQuYW5zd2Vycy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICB2YXIgZXhwbGFpbiA9ICcnO1xuICAgICAgICAgIGlmKHJlc3VsdC5lcnJvcnMubGVuZ3RoKSB7XG4gICAgICAgICAgICBleHBsYWluID0gRXJFcnJvci5leHBsYWluRXJyb3IocmVzdWx0LmVycm9ycyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGRpYWxvZ2xvZyhcIldoYXRJc1wiLCBzZXNzaW9uLCBzZW5kKCdJIGRvblxcJ3Qga25vdyBhbnl0aGluZyBhYm91dCBcIicgKyBjYXQgKyBcIiAoXCIgKyBjYXRlZ29yeSArICcpXFxcIiBpbiByZWxhdGlvbiB0byBcIicgKyBhMS5lbnRpdHkgKyBgXCIuJHtleHBsYWlufWApKTtcbiAgICAgICAgICAvLyBuZXh0KCk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIGRlYnVnbG9nKCdyZXN1bHQgOiAnICsgSlNPTi5zdHJpbmdpZnkocmVzdWx0LCB1bmRlZmluZWQsIDIpKTtcbiAgICAgICAgICBkZWJ1Z2xvZyhkZWJ1Z2xvZy5lbmFibGVkPygnYmVzdCByZXN1bHQgOiAnICsgSlNPTi5zdHJpbmdpZnkocmVzdWx0LmFuc3dlcnNbMF0gfHwge30sIHVuZGVmaW5lZCwgMikpOictJyk7XG4gICAgICAgICAgZGVidWdsb2coZGVidWdsb2cuZW5hYmxlZD8gKCd0b3AgOiAnICsgV2hhdElzLmR1bXBXZWlnaHRzVG9wKHJlc3VsdC5hbnN3ZXJzLCB7IHRvcDogMyB9KSk6ICctJyk7XG4gICAgICAgICAgLy8gVE9ETyBjbGVhbnNlZCBzZW50ZW5jZVxuICAgICAgICAgIGRpYWxvZ2xvZyhcIldoYXRJc1wiLCBzZXNzaW9uLCBzZW5kKCdUaGUgJyArIGNhdGVnb3J5ICsgJyBvZiAnICsgYTEuZW50aXR5ICsgJyBpcyAnICsgcmVzdWx0LmFuc3dlcnNbMF0ucmVzdWx0ICsgXCJcXG5cIikpOyAvLyAgKyBKU09OLnN0cmluZ2lmeShyZXN1bHRbMF0pKTtcbiAgICAgICAgfVxuICAgICAgfSAvLyBzaW5nbGUgY2F0ZWdvcnlcbiAgICAgIGVsc2Uge1xuICAgICAgICBkZWJ1Z2xvZygnY2F0ZWdvcmllcyBpZGVudGlmaWVkOicgKyBjYXRzLmpvaW4oXCIsXCIpKTtcbiAgICAgICAgY29uc3QgcmVzdWx0QXJyID0gV2hhdElzLnJlc29sdmVDYXRlZ29yaWVzKGNhdHMsIGExLmVudGl0eSxcbiAgICAgICAgICB0aGVNb2RlbCk7XG4gICAgICAgIGRlYnVnbG9nKGRlYnVnbG9nLmVuYWJsZWQgPyAoJ211bHN0IHdoYXRpcyByZXN1bHQ6JyArIEpTT04uc3RyaW5naWZ5KHJlc3VsdEFycikpOictJyk7XG4gICAgICAgIGxvZ1F1ZXJ5V2hhdElzVHVwZWwoc2Vzc2lvbiwgJ1doYXRJcycsIHJlc3VsdEFyci50dXBlbGFuc3dlcnMpO1xuICAgICAgICB2YXIgaW5kaXMgPSBXaGF0SXMuaXNJbmRpc2NyaW1pbmF0ZVJlc3VsdFR1cGVsKHJlc3VsdEFyci50dXBlbGFuc3dlcnMpO1xuICAgICAgICBpZiAoaW5kaXMpIHtcbiAgICAgICAgICBzZXNzaW9uLnNlbmQoaW5kaXMpO1xuICAgICAgICAgIC8vIG5leHQoKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFyZXN1bHRBcnIgfHwgIXJlc3VsdEFyci50dXBlbGFuc3dlcnMgfHwgcmVzdWx0QXJyLnR1cGVsYW5zd2Vycy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICB2YXIgZXhwbGFpbiA9ICcnO1xuICAgICAgICAgIGlmKHJlc3VsdEFyci5lcnJvcnMubGVuZ3RoKSB7XG4gICAgICAgICAgICBleHBsYWluID0gRXJFcnJvci5leHBsYWluRXJyb3IocmVzdWx0QXJyLmVycm9ycyk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGRpYWxvZ2xvZyhcIldoYXRJc1wiLCBzZXNzaW9uLCBzZW5kKCdJIGRvblxcJ3Qga25vdyBhbnl0aGluZyBhYm91dCBcIicgKyBjYXRlZ29yeSArIFwiXFxcIiAoXCIgKyBVdGlscy5saXN0VG9RdW90ZWRDb21tYUFuZChjYXRzKSArICcpXFxcIiBpbiByZWxhdGlvbiB0byBcIicgKyBhMS5lbnRpdHkgKyBgXCIke2V4cGxhaW59YCkpO1xuICAgICAgICAgIC8vIG5leHQoKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gZGVidWdsb2coJ3Jlc3VsdCA6ICcgKyBKU09OLnN0cmluZ2lmeShyZXN1bHQsIHVuZGVmaW5lZCwgMikpO1xuICAgICAgICAgIGRlYnVnbG9nKGRlYnVnbG9nLmVuYWJsZWQ/ICgnYmVzdCByZXN1bHQgOiAnICsgSlNPTi5zdHJpbmdpZnkocmVzdWx0QXJyLnR1cGVsYW5zd2Vyc1swXSB8fCB7fSwgdW5kZWZpbmVkLCAyKSk6Jy0nKTtcbiAgICAgICAgICAvL2RlYnVnbG9nKCd0b3AgOiAnICsgV2hhdElzLmR1bXBXZWlnaHRzVG9wKHJlc3VsdEFyciwgeyB0b3A6IDMgfSkpO1xuICAgICAgICAgIC8vIFRPRE8gY2xlYW5zZWQgc2VudGVuY2VcbiAgICAgICAgICBkaWFsb2dsb2coXCJXaGF0SXNcIiwgc2Vzc2lvbiwgc2VuZCgnVGhlICcgKyBVdGlscy5saXN0VG9RdW90ZWRDb21tYUFuZChjYXRzKSArICcgb2YgJyArIGExLmVudGl0eSArICcgYXJlICcgKyBVdGlscy5saXN0VG9RdW90ZWRDb21tYUFuZChyZXN1bHRBcnIudHVwZWxhbnN3ZXJzWzBdLnJlc3VsdCkgKyAnXFxuJykpOyAvLyAgKyBKU09OLnN0cmluZ2lmeShyZXN1bHRbMF0pKTtcbiAgICAgICAgfVxuICAgICAgfSAvL2VuZGlmIG11bHRpcGxlIGNhdGVnb3JpZXNcbiAgICB9XG4gIF0pO1xuXG5cbiAgZGlhbG9nLm1hdGNoZXMoJ0xpc3RBbGwnLCBbXG4gICAgZnVuY3Rpb24gKHNlc3Npb24sIGFyZ3MsIG5leHQpIHtcbiAgICAgIHZhciBpc0NvbWJpbmVkSW5kZXggPSB7fTtcbiAgICAgIHZhciBvTmV3RW50aXR5O1xuICAgICAgLy8gZXhwZWN0aW5nIGVudGl0eSBBMVxuICAgICAgdmFyIG1lc3NhZ2UgPSBzZXNzaW9uLm1lc3NhZ2UudGV4dDtcbiAgICAgIGRlYnVnbG9nKFwiSW50ZW50IDogTGlzdEFsbFwiKTtcbiAgICAgIGRlYnVnbG9nKGRlYnVnbG9nLmVuYWJsZWQ/ICgncmF3OiAnICsgSlNPTi5zdHJpbmdpZnkoYXJncy5lbnRpdGllcywgdW5kZWZpbmVkLCAyKSkgOictJyk7XG4gICAgICB2YXIgY2F0ZWdvcnlFbnRpdHkgPSBidWlsZGVyLkVudGl0eVJlY29nbml6ZXIuZmluZEVudGl0eShhcmdzLmVudGl0aWVzLCAnY2F0ZWdvcmllcycpO1xuICAgICAgdmFyIGNhdGVnb3J5ID0gY2F0ZWdvcnlFbnRpdHkuZW50aXR5O1xuICAgICAgdmFyIGluU3RoRW50aXR5ID0gYnVpbGRlci5FbnRpdHlSZWNvZ25pemVyLmZpbmRFbnRpdHkoYXJncy5lbnRpdGllcywgJ2luc3RoJylcbiAgICAgIHZhciBpblNvbWV0aGluZyA9IGluU3RoRW50aXR5ICYmIGluU3RoRW50aXR5LmVudGl0eTtcbiAgICAgIC8vIHNvbWUgbWV0YXF1ZXJpZXM6XG4gICAgICBpZiAoY2F0ZWdvcnkgPT09IFwiY2F0ZWdvcmllc1wiKSB7XG4gICAgICAgIC8vIGRvIHdlIGhhdmUgYSBmaWx0ZXIgP1xuICAgICAgICB2YXIgZG9tYWluID0gdW5kZWZpbmVkO1xuICAgICAgICBpZiAoaW5Tb21ldGhpbmcpIHtcbiAgICAgICAgICBkb21haW4gPSBMaXN0QWxsLmluZmVyRG9tYWluKHRoZU1vZGVsLCBpblNvbWV0aGluZyk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCFkb21haW4pIHtcbiAgICAgICAgICB2YXIgcmVzID0gcmVzdHJpY3RMb2dnZWRPbihzZXNzaW9uLCB0aGVNb2RlbC5jYXRlZ29yeSkuam9pbihcIjtcXG5cIik7XG4gICAgICAgICAgaWYgKGluU29tZXRoaW5nKSB7XG4gICAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsXCIsIHNlc3Npb24sIHNlbmQoXCJJIGRpZCBub3QgaW5mZXIgYSBkb21haW4gcmVzdHJpY3Rpb24gZnJvbSBcXFwiXCIgKyBVdGlscy5zdHJpcFF1b3RlcyhpblNvbWV0aGluZykgKyBcIlxcXCIsIGFsbCBteSBjYXRlZ29yaWVzIGFyZSAuLi5cXG5cIiArIHJlcykpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsXCIsIHNlc3Npb24sIHNlbmQoXCJteSBjYXRlZ29yaWVzIGFyZSAuLi5cXG5cIiArIHJlcykpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdmFyIGFSZXMgPSBNb2RlbC5nZXRDYXRlZ29yaWVzRm9yRG9tYWluKHRoZU1vZGVsLCBkb21haW4pO1xuICAgICAgICAgIHZhciByZXMgPSByZXN0cmljdExvZ2dlZE9uKHNlc3Npb24sIGFSZXMpLmpvaW4oXCI7XFxuXCIpO1xuICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxcIiwgc2Vzc2lvbiwgc2VuZChcIm15IGNhdGVnb3JpZXMgaW4gZG9tYWluIFxcXCJcIiArIGRvbWFpbiArIFwiXFxcIiBhcmUgLi4uXFxuXCIgKyByZXMpKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChjYXRlZ29yeSA9PT0gXCJkb21haW5zXCIpIHtcbiAgICAgICAgdmFyIHJlcyA9IHJlc3RyaWN0TG9nZ2VkT24oc2Vzc2lvbiwgdGhlTW9kZWwuZG9tYWlucykuam9pbihcIjtcXG5cIik7XG4gICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxcIiwgc2Vzc2lvbiwgc2VuZChcIm15IGRvbWFpbnMgYXJlIC4uLlxcblwiICsgcmVzKSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGlmIChjYXRlZ29yeSA9PT0gXCJ0b29sc1wiKSB7XG4gICAgICAgIHZhciByZXMgPSByZXN0cmljdExvZ2dlZE9uKHNlc3Npb24sIHRoZU1vZGVsLnRvb2xzKS5tYXAoZnVuY3Rpb24gKG9Ub29sKSB7XG4gICAgICAgICAgcmV0dXJuIG9Ub29sLm5hbWU7XG4gICAgICAgIH0pLmpvaW4oXCI7XFxuXCIpO1xuICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsXCIsIHNlc3Npb24sIHNlbmQoXCJteSB0b29scyBhcmUgLi4uXFxuXCIgKyByZXMpKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdmFyIGNhdHMgPSBbXTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNhdHMgPSBXaGF0SXMuYW5hbHl6ZUNhdGVnb3J5TXVsdE9ubHlBbmRDb21tYShjYXRlZ29yeSwgdGhlTW9kZWwucnVsZXMsIG1lc3NhZ2UpO1xuICAgICAgICBkZWJ1Z2xvZyhcImhlcmUgY2F0c1wiICsgY2F0cy5qb2luKFwiLFwiKSk7XG4gICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgIGlmIChlKSB7XG4gICAgICAgICAgZGVidWdsb2coXCJoZXJlIGV4Y2VwdGlvblwiICsgZSk7XG4gICAgICAgICAgZGlhbG9nbG9nKFwiV2hhdElzXCIsIHNlc3Npb24sIHNlbmQoJ0kgZG9uXFwndCBrbm93IGFueXRoaW5nIGFib3V0IFwiJyArIGNhdGVnb3J5ICsgJ1wiKCcgKyBlLnRvU3RyaW5nKCkgKyAnKScpKTtcbiAgICAgICAgICAvLyBuZXh0KCk7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICBpZiAoIWNhdHMgfHwgKGNhdHMubGVuZ3RoID09PSAwKSkge1xuICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsXCIsIHNlc3Npb24sIHNlbmQoJ0kgZG9uXFwndCBrbm93IGFueXRoaW5nIGFib3V0IFwiJyArIGNhdGVnb3J5ICsgJ1wiJykpO1xuICAgICAgICAvLyBuZXh0KCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHZhciBjYXQgPSBcIlwiO1xuICAgICAgaWYgKGNhdHMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgIGNhdCA9IGNhdHNbMF07XG4gICAgICB9XG4gICAgICBpZiAoY2F0cy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgZGVidWdsb2coJ3NpbmdsZSBjYXRlZ29yeSBpZGVudGlmaWVkOicgKyBjYXQpO1xuICAgICAgICBpZiAoaW5Tb21ldGhpbmcpIHtcbiAgICAgICAgICBkZWJ1Z2xvZygnZ290IGZpbHRlcjonICsgaW5Tb21ldGhpbmcpO1xuICAgICAgICAgIHZhciBjYXRlZ29yeVNldCA9IE1vZGVsLmdldEFsbFJlY29yZENhdGVnb3JpZXNGb3JUYXJnZXRDYXRlZ29yeSh0aGVNb2RlbCwgY2F0LCB0cnVlKTtcbiAgICAgICAgICB2YXIgcmVzdWx0MSA9IExpc3RBbGwubGlzdEFsbFdpdGhDb250ZXh0KGNhdCwgaW5Tb21ldGhpbmcsXG4gICAgICAgICAgICB0aGVNb2RlbC5ydWxlcywgdGhlTW9kZWwucmVjb3JkcywgY2F0ZWdvcnlTZXQpO1xuICAgICAgICAgIC8vIFRPRE8gY2xhc3NpZnlpbmcgdGhlIHN0cmluZyB0d2ljZSBpcyBhIHRlcnJpYmxlIHdhc3RlXG4gICAgICAgICAgaWYgKCFyZXN1bHQxLmFuc3dlcnMubGVuZ3RoKSB7XG4gICAgICAgICAgICBkZWJ1Z2xvZygnZ29pbmcgZm9yIGhhdmluZycpO1xuICAgICAgICAgICAgdmFyIGNhdGVnb3J5U2V0RnVsbCA9IE1vZGVsLmdldEFsbFJlY29yZENhdGVnb3JpZXNGb3JUYXJnZXRDYXRlZ29yeSh0aGVNb2RlbCwgY2F0LCBmYWxzZSk7XG4gICAgICAgICAgICByZXN1bHQxID0gTGlzdEFsbC5saXN0QWxsSGF2aW5nQ29udGV4dChjYXQsIGluU29tZXRoaW5nLCB0aGVNb2RlbC5ydWxlcyxcbiAgICAgICAgICAgICAgdGhlTW9kZWwucmVjb3JkcywgY2F0ZWdvcnlTZXRGdWxsKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZGVidWdsb2coZGVidWdsb2c/ICgnbGlzdGFsbCByZXN1bHQgPjonICsgSlNPTi5zdHJpbmdpZnkocmVzdWx0MSkpOictJyk7XG4gICAgICAgICAgdmFyIGpvaW5yZXN1bHRzID0gcmVzdHJpY3RMb2dnZWRPbihzZXNzaW9uLCBMaXN0QWxsLmpvaW5SZXN1bHRzKHJlc3VsdDEuYW5zd2VycykpO1xuICAgICAgICAgIGxvZ1F1ZXJ5V2hhdElzKHNlc3Npb24sICdMaXN0QWxsJywgcmVzdWx0MS5hbnN3ZXJzKTtcbiAgICAgICAgICBkZWJ1Z2xvZyhkZWJ1Z2xvZz8gKCdsaXN0YWxsIHJlc3VsdDIgPjonICsgSlNPTi5zdHJpbmdpZnkocmVzdWx0MSkpOictJyk7XG4gICAgICAgICAgaWYgKGpvaW5yZXN1bHRzLmxlbmd0aCkge1xuICAgICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbFwiLCBzZXNzaW9uLCBzZW5kKFwidGhlIFwiICsgY2F0ZWdvcnkgKyBcIiBmb3IgXCIgKyBpblNvbWV0aGluZyArIFwiIGFyZSAuLi5cXG5cIiArIGpvaW5yZXN1bHRzLmpvaW4oXCI7XFxuXCIpKSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhciBlcnJwcmVmaXggPSBcIlwiO1xuICAgICAgICAgICAgaWYgKHJlc3VsdDEuZXJyb3JzLmxlbmd0aCkge1xuICAgICAgICAgICAgICBlcnJwcmVmaXggPSBFckVycm9yLmV4cGxhaW5FcnJvcihyZXN1bHQxLmVycm9ycyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsXCIsIHNlc3Npb24sIHNlbmQoXCJpIGRpZCBub3QgZmluZCBhbnkgXCIgKyBjYXRlZ29yeSArIFwiIGZvciBcIiArIGluU29tZXRoaW5nICsgXCIuXFxuXCIgKyBqb2lucmVzdWx0cy5qb2luKFwiO1xcblwiKSArIFwiXCIgKyBlcnJwcmVmaXgpKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIC8vIG5vIGZpbHRlciBlbnRpdHksIGUuZy4gbGlzdCBhbGwgY291bnRyaWVzXG4gICAgICAgICAgLy9cbiAgICAgICAgICB2YXIgY2F0ZWdvcnlTZXRGdWxsID0gTW9kZWwuZ2V0QWxsUmVjb3JkQ2F0ZWdvcmllc0ZvclRhcmdldENhdGVnb3J5KHRoZU1vZGVsLCBjYXQsIGZhbHNlKTtcbiAgICAgICAgICB2YXIgcmVzdWx0ID0gTGlzdEFsbC5saXN0QWxsSGF2aW5nQ29udGV4dChjYXQsIGNhdCwgdGhlTW9kZWwucnVsZXMsIHRoZU1vZGVsLnJlY29yZHMsIGNhdGVnb3J5U2V0RnVsbCk7XG4gICAgICAgICAgbG9nUXVlcnlXaGF0SXMoc2Vzc2lvbiwgJ0xpc3RBbGwnLCByZXN1bHQuYW5zd2Vycyk7XG4gICAgICAgICAgaWYgKHJlc3VsdC5hbnN3ZXJzLmxlbmd0aCkge1xuICAgICAgICAgICAgZGVidWdsb2coZGVidWdsb2cuZW5hYmxlZCA/ICgnbGlzdGFsbCByZXN1bHQ6JyArIEpTT04uc3RyaW5naWZ5KHJlc3VsdCkpOiAnLScpO1xuICAgICAgICAgICAgdmFyIGpvaW5yZXN1bHRzID0gW107XG4gICAgICAgICAgICBkZWJ1Z2xvZyhcImhlcmUgaXMgY2F0PlwiICsgY2F0KTtcbiAgICAgICAgICAgIGlmIChjYXQgIT09IFwiZXhhbXBsZSBxdWVzdGlvblwiKSB7XG4gICAgICAgICAgICAgIGpvaW5yZXN1bHRzID0gcmVzdHJpY3RMb2dnZWRPbihzZXNzaW9uLCBMaXN0QWxsLmpvaW5SZXN1bHRzKHJlc3VsdC5hbnN3ZXJzKSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBqb2lucmVzdWx0cyA9IExpc3RBbGwuam9pblJlc3VsdHMocmVzdWx0LmFuc3dlcnMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0gXCJ0aGUgXCIgKyBjYXRlZ29yeSArIFwiIGFyZSAuLi5cXG5cIiArIGpvaW5yZXN1bHRzLmpvaW4oXCI7XFxuXCIpO1xuICAgICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbFwiLCBzZXNzaW9uLCBzZW5kKHJlc3BvbnNlKSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhciByZXNwb25zZSA9IFwiRm91bmQgbm8gZGF0YSBoYXZpbmcgXFxcIlwiICsgY2F0ICsgXCJcXFwiXCJcbiAgICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxcIiwgc2Vzc2lvbiwgc2VuZChyZXNwb25zZSkpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gbXVsdGlwbGUgY2F0ZWdvcmllc1xuICAgICAgICBkZWJ1Z2xvZygnY2F0ZWdvcmllcyBpZGVudGlmaWVkOicgKyBjYXRzLmpvaW4oXCIsXCIpKTtcbiAgICAgICAgaWYgKGluU29tZXRoaW5nKSB7XG4gICAgICAgICAgZGVidWdsb2coJ2dvdCBmaWx0ZXI6JyArIGluU29tZXRoaW5nKTtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgdmFyIGNhdGVnb3J5U2V0ID0gTW9kZWwuZ2V0QWxsUmVjb3JkQ2F0ZWdvcmllc0ZvclRhcmdldENhdGVnb3JpZXModGhlTW9kZWwsIGNhdHMsIHRydWUpO1xuICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGRlYnVnbG9nKFwiaGVyZSBleGNlcHRpb25cIiArIGUpO1xuICAgICAgICAgICAgZGlhbG9nbG9nKFwiV2hhdElzXCIsIHNlc3Npb24sIHNlbmQoJ0kgY2Fubm90IGNvbWJpbmUgXCInICsgY2F0ZWdvcnkgKyAnKCcgKyBlLnRvU3RyaW5nKCkgKyAnKScpKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgdmFyIHJlc3VsdDFUID0gTGlzdEFsbC5saXN0QWxsVHVwZWxXaXRoQ29udGV4dChjYXRzLCBpblNvbWV0aGluZyxcbiAgICAgICAgICAgIHRoZU1vZGVsLnJ1bGVzLCB0aGVNb2RlbC5yZWNvcmRzLCBjYXRlZ29yeVNldCk7XG4gICAgICAgICAgLy8gVE9ETyBjbGFzc2lmeWluZyB0aGUgc3RyaW5nIHR3aWNlIGlzIGEgdGVycmlibGUgd2FzdGVcbiAgICAgICAgICBpZiAoIXJlc3VsdDFULnR1cGVsYW5zd2Vycy5sZW5ndGgpIHtcbiAgICAgICAgICAgIGRlYnVnbG9nKCdnb2luZyBmb3IgaGF2aW5nJyk7XG4gICAgICAgICAgICB2YXIgY2F0ZWdvcnlTZXRGdWxsID0gTW9kZWwuZ2V0QWxsUmVjb3JkQ2F0ZWdvcmllc0ZvclRhcmdldENhdGVnb3JpZXModGhlTW9kZWwsIGNhdHMsIGZhbHNlKTtcbiAgICAgICAgICAgIHJlc3VsdDFUID0gTGlzdEFsbC5saXN0QWxsVHVwZWxIYXZpbmdDb250ZXh0KGNhdHMsIGluU29tZXRoaW5nLCB0aGVNb2RlbC5ydWxlcyxcbiAgICAgICAgICAgICAgdGhlTW9kZWwucmVjb3JkcywgY2F0ZWdvcnlTZXRGdWxsKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZGVidWdsb2coZGVidWdsb2cuZW5hYmxlZD8gKCdsaXN0YWxsIHJlc3VsdDonICsgSlNPTi5zdHJpbmdpZnkocmVzdWx0MVQpKSA6ICctJyk7XG4gICAgICAgICAgdmFyIGpvaW5yZXN1bHRzID0gcmVzdHJpY3RMb2dnZWRPbihzZXNzaW9uLCBMaXN0QWxsLmpvaW5SZXN1bHRzVHVwZWwocmVzdWx0MVQudHVwZWxhbnN3ZXJzKSk7XG4gICAgICAgICAgbG9nUXVlcnlXaGF0SXNUdXBlbChzZXNzaW9uLCAnTGlzdEFsbCcsIHJlc3VsdDFULnR1cGVsYW5zd2Vycyk7XG4gICAgICAgICAgaWYgKGpvaW5yZXN1bHRzLmxlbmd0aCkge1xuICAgICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbFwiLCBzZXNzaW9uLCBzZW5kKFwidGhlIFwiICsgY2F0ZWdvcnkgKyBcIiBmb3IgXCIgKyBpblNvbWV0aGluZyArIFwiIGFyZSAuLi5cXG5cIiArIGpvaW5yZXN1bHRzLmpvaW4oXCI7XFxuXCIpKSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGlmIChyZXN1bHQxVC5lcnJvcnMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgIGVycnByZWZpeCA9IEVyRXJyb3IuZXhwbGFpbkVycm9yKHJlc3VsdDFULmVycm9ycyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsXCIsIHNlc3Npb24sIHNlbmQoXCJpIGRpZCBub3QgZmluZCBhbnkgXCIgKyBjYXRlZ29yeSArIFwiIGZvciBcIiArIGluU29tZXRoaW5nICsgXCIuXFxuXCIgKyBqb2lucmVzdWx0cy5qb2luKFwiO1xcblwiKSArIGVycnByZWZpeCkpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gbm8gZW50aXR5LCBlLmcuIGxpc3QgYWxsIGNvdW50cmllc1xuICAgICAgICAgIC8vXG4gICAgICAgICAgdmFyIGNhdGVnb3J5U2V0RnVsbCA9IHt9IGFzIHsgW2tleTogc3RyaW5nXTogYm9vbGVhbiB9O1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjYXRlZ29yeVNldEZ1bGwgPSBNb2RlbC5nZXRBbGxSZWNvcmRDYXRlZ29yaWVzRm9yVGFyZ2V0Q2F0ZWdvcmllcyh0aGVNb2RlbCwgY2F0cywgZmFsc2UpO1xuICAgICAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgIGRlYnVnbG9nKFwiaGVyZSBleGNlcHRpb25cIiArIGUpO1xuICAgICAgICAgICAgZGlhbG9nbG9nKFwiV2hhdElzXCIsIHNlc3Npb24sIHNlbmQoJ0kgY2Fubm90IGNvbWJpbmUgXCInICsgY2F0ZWdvcnkgKyAnKCcgKyBlLnRvU3RyaW5nKCkgKyAnKScpKTtcbiAgICAgICAgICAgIC8vIG5leHQoKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgICAgdmFyIHJlc3VsdFQgPSBMaXN0QWxsLmxpc3RBbGxUdXBlbEhhdmluZ0NvbnRleHQoY2F0cywgXCJcXFwiXCIgKyBjYXRzLmpvaW4oXCJcXFwiIFxcXCJcIikgKyBcIlxcXCJcIiwgdGhlTW9kZWwucnVsZXMsIHRoZU1vZGVsLnJlY29yZHMsIGNhdGVnb3J5U2V0RnVsbCk7XG4gICAgICAgICAgbG9nUXVlcnlXaGF0SXNUdXBlbChzZXNzaW9uLCAnTGlzdEFsbCcsIHJlc3VsdFQudHVwZWxhbnN3ZXJzKTtcbiAgICAgICAgICBpZiAocmVzdWx0VC50dXBlbGFuc3dlcnMubGVuZ3RoKSB7XG4gICAgICAgICAgICBkZWJ1Z2xvZyhkZWJ1Z2xvZy5lbmFibGVkPyAoJ2xpc3RhbGwgcmVzdWx0OicgKyBKU09OLnN0cmluZ2lmeShyZXN1bHRUKSk6Jy0nKTtcbiAgICAgICAgICAgIHZhciBqb2lucmVzdWx0cyA9IFtdO1xuICAgICAgICAgICAgZGVidWdsb2coXCJoZXJlIGlzIGNhdD5cIiArIGNhdHMuam9pbihcIiwgXCIpKTtcbiAgICAgICAgICAgIGlmIChjYXQgIT09IFwiZXhhbXBsZSBxdWVzdGlvblwiKSB7XG4gICAgICAgICAgICAgIGpvaW5yZXN1bHRzID0gcmVzdHJpY3RMb2dnZWRPbihzZXNzaW9uLCBMaXN0QWxsLmpvaW5SZXN1bHRzVHVwZWwocmVzdWx0VC50dXBlbGFuc3dlcnMpKTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIGpvaW5yZXN1bHRzID0gTGlzdEFsbC5qb2luUmVzdWx0c1R1cGVsKHJlc3VsdFQudHVwZWxhbnN3ZXJzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciByZXNwb25zZSA9IFwidGhlIFwiICsgY2F0ZWdvcnkgKyBcIiBhcmUgLi4uXFxuXCIgKyBqb2lucmVzdWx0cy5qb2luKFwiO1xcblwiKTtcbiAgICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxcIiwgc2Vzc2lvbiwgc2VuZChyZXNwb25zZSkpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSBcIkZvdW5kIG5vIGRhdGEgaGF2aW5nIFxcXCJcIiArIGNhdCArIFwiXFxcIlwiXG4gICAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsXCIsIHNlc3Npb24sIHNlbmQocmVzcG9uc2UpKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIF0pO1xuXG5cbiAgZGlhbG9nLm1hdGNoZXMoJ2J1aWxkdGFibGUnLCBbXG4gICAgZnVuY3Rpb24gKHNlc3Npb24sIGFyZ3MsIG5leHQpIHtcbiAgICAgIHZhciBpc0NvbWJpbmVkSW5kZXggPSB7fTtcbiAgICAgIHZhciBvTmV3RW50aXR5O1xuICAgICAgLy8gZXhwZWN0aW5nIGVudGl0eSBBMVxuICAgICAgdmFyIG1lc3NhZ2UgPSBzZXNzaW9uLm1lc3NhZ2UudGV4dDtcbiAgICAgIGRlYnVnbG9nKFwiSW50ZW50IDogYnVpbGR0YWJsZVwiKTtcbiAgICAgIGRlYnVnbG9nKCdyYXc6ICcgKyBKU09OLnN0cmluZ2lmeShhcmdzLmVudGl0aWVzKSwgdW5kZWZpbmVkLCAyKTtcbiAgICAgIHZhciBjYXRlZ29yaWVzID0gYnVpbGRlci5FbnRpdHlSZWNvZ25pemVyLmZpbmRFbnRpdHkoYXJncy5lbnRpdGllcywgJ2NhdGVnb3JpZXMnKS5lbnRpdHk7XG4gICAgICBkZWJ1Z2xvZyhcImZhY3RPckNhdCBpc1wiICsgY2F0ZWdvcmllcyk7XG4gICAgICB2YXIgY2F0cztcbiAgICAgIHRyeSB7XG4gICAgICAgIGNhdHMgPSBXaGF0SXMuYW5hbHl6ZUNhdGVnb3J5TXVsdE9ubHlBbmRDb21tYShjYXRlZ29yaWVzLCB0aGVNb2RlbC5ydWxlcywgbWVzc2FnZSk7XG4gICAgICAgIGRlYnVnbG9nKFwiaGVyZSBjYXRzXCIgKyBjYXRzLmpvaW4oXCIsXCIpKTtcbiAgICAgIH0gY2F0Y2ggKGUpIHtcbiAgICAgICAgaWYgKGUpIHtcbiAgICAgICAgICBkZWJ1Z2xvZyhcImhlcmUgZXhjZXB0aW9uXCIgKyBlKTtcbiAgICAgICAgICBkaWFsb2dsb2coXCJXaGF0SXNcIiwgc2Vzc2lvbiwgc2VuZCgnSSBkb25cXCd0IGtub3cgYW55dGhpbmcgYWJvdXQgXCInICsgY2F0ZWdvcmllcyArICdcIignICsgZS50b1N0cmluZygpICsgJyknKSk7XG4gICAgICAgICAgLy8gbmV4dCgpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKCFjYXRzIHx8IChjYXRzLmxlbmd0aCA9PT0gMCkpIHtcbiAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbFwiLCBzZXNzaW9uLCBzZW5kKCdJIGRpZCBub3QgZmluZCBhIGNhdGVnb3J5IGluIFwiJyArIGNhdGVnb3JpZXMgKyAnXCInKSk7XG4gICAgICAgIC8vIG5leHQoKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdmFyIGV4ZWMgPSBNYWtlVGFibGUubWFrZVRhYmxlKGNhdHMsdGhlTW9kZWwpO1xuICAvLyAgICAgIGNvbnN0IGV4ZWMgPSBFeGVjU2VydmVyLmV4ZWNUb29sKHNlc3Npb24uZGlhbG9nRGF0YS5yZXN1bHQgYXMgSU1hdGNoLklUb29sTWF0Y2gsIHRoZU1vZGVsLnJlY29yZHMpO1xuICAgICAgICB2YXIgcmVwbHkgPSBuZXcgYnVpbGRlci5NZXNzYWdlKHNlc3Npb24pXG4gICAgICAgICAgLnRleHQoZXhlYy50ZXh0KVxuICAgICAgICAgIC5hZGRFbnRpdHkoZXhlYy5hY3Rpb24pO1xuICAgICAgICAvLyAuYWRkQXR0YWNobWVudCh7IGZhbGxiYWNrVGV4dDogXCJJIGRvbid0IGtub3dcIiwgY29udGVudFR5cGU6ICdpbWFnZS9qcGVnJywgY29udGVudFVybDogXCJ3d3cud29tYmF0Lm9yZ1wiIH0pO1xuICAgICAgICBkaWFsb2dsb2coXCJTaG93TWVcIiwgc2Vzc2lvbiwgc2VuZChyZXBseSkpO1xuICAgIH1cblxuXG4gIF0pO1xuXG4gIGRpYWxvZy5tYXRjaGVzKCdEZXNjcmliZScsIFtcbiAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgYXJncywgbmV4dCkge1xuICAgICAgdmFyIGlzQ29tYmluZWRJbmRleCA9IHt9O1xuICAgICAgdmFyIG9OZXdFbnRpdHk7XG4gICAgICAvLyBleHBlY3RpbmcgZW50aXR5IEExXG4gICAgICB2YXIgbWVzc2FnZSA9IHNlc3Npb24ubWVzc2FnZS50ZXh0O1xuICAgICAgZGVidWdsb2coXCJJbnRlbnQgOiBEZXNjcmliZVwiKTtcbiAgICAgIGRlYnVnbG9nKCdyYXc6ICcgKyBKU09OLnN0cmluZ2lmeShhcmdzLmVudGl0aWVzKSwgdW5kZWZpbmVkLCAyKTtcbiAgICAgIHZhciBmYWN0RW50aXR5ID0gYnVpbGRlci5FbnRpdHlSZWNvZ25pemVyLmZpbmRFbnRpdHkoYXJncy5lbnRpdGllcywgJ0ExJyk7XG4gICAgICB2YXIgZmFjdE9yQ2F0ID0gZmFjdEVudGl0eSAmJiBmYWN0RW50aXR5LmVudGl0eTtcbiAgICAgIHZhciBkb21haW5FbnRpdHkgPSBidWlsZGVyLkVudGl0eVJlY29nbml6ZXIuZmluZEVudGl0eShhcmdzLmVudGl0aWVzLCAnRCcpO1xuICAgICAgdmFyIGRvbWFpblMgPSBkb21haW5FbnRpdHkgJiYgZG9tYWluRW50aXR5LmVudGl0eTtcbiAgICAgIHZhciBmaWx0ZXJEb21haW4gPSB1bmRlZmluZWQ7XG4gICAgICBpZiAoZG9tYWluUykge1xuICAgICAgICBmaWx0ZXJEb21haW4gPSBMaXN0QWxsLmluZmVyRG9tYWluKHRoZU1vZGVsLCBkb21haW5TKTtcbiAgICAgICAgZGVidWdsb2coXCJnb3QgZG9tYWluXCIgKyBmaWx0ZXJEb21haW4pO1xuICAgICAgICBpZiAoIWZpbHRlckRvbWFpbikge1xuICAgICAgICAgIGRpYWxvZ2xvZyhcIkRlc2NyaWJlXCIsIHNlc3Npb24sIHNlbmQoXCJJIGRpZCBub3QgaW5mZXIgYSBkb21haW4gcmVzdHJpY3Rpb24gZnJvbSBcXFwiXCIgKyBkb21haW5TICsgXCJcXFwiLiBTcGVjaWZ5IGFuIGV4aXN0aW5nIGRvbWFpbi4gKExpc3QgYWxsIGRvbWFpbnMpIHRvIGdldCBleGFjdCBuYW1lcy5cXG5cIikpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICBkZWJ1Z2xvZyhcImZhY3RPckNhdCBpc1wiICsgZmFjdE9yQ2F0KTtcbiAgICAgIGlmIChtZXRhd29yZHNEZXNjcmlwdGlvbnNbZmFjdE9yQ2F0LnRvTG93ZXJDYXNlKCldKSB7XG4gICAgICAgIC8vIGRvIHdlIGhhdmUgYSBmaWx0ZXIgP1xuICAgICAgICB2YXIgcHJlZml4ID0gXCJcIjtcbiAgICAgICAgaWYgKGZpbHRlckRvbWFpbikge1xuICAgICAgICAgIHByZWZpeCA9ICdcImluIGRvbWFpbiBcIicgKyBmaWx0ZXJEb21haW4gKyAnXCIgbWFrZSBubyBzZW5zZSB3aGVuIG1hdGNoaW5nIGEgbWV0YXdvcmQuXFxuJztcbiAgICAgICAgfVxuICAgICAgICBkZWJ1Z2xvZyhcInNob3dpbmcgbWV0YSByZXN1bHRcIik7XG4gICAgICAgIGRpYWxvZ2xvZyhcIkRlc2NyaWJlXCIsIHNlc3Npb24sIHNlbmQocHJlZml4ICsgJ1wiJyArIGZhY3RPckNhdCArICdcIiBpcyAnICsgbWV0YXdvcmRzRGVzY3JpcHRpb25zW2ZhY3RPckNhdC50b0xvd2VyQ2FzZSgpXSArIFwiXCIpKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdmFyIGNhdGVnb3JpZXMgPSBbXTtcbiAgICAgIGlmIChXaGF0SXMuc3BsaXRBdENvbW1hQW5kKGZhY3RPckNhdCkubGVuZ3RoID4gMSkge1xuICAgICAgICBkaWFsb2dsb2coXCJEZXNjcmliZVwiLCBzZXNzaW9uLCBzZW5kKFwiV2hvYSwgaSBjYW4gb25seSBleHBsYWluIG9uZSB0aGluZyBhdCBhIHRpbWUsIG5vdCBcXFwiXCIgKyBmYWN0T3JDYXQgKyBcIlxcXCIuIFBsZWFzZSBhc2sgb25lIGF0IGEgdGltZS5cIikpO1xuICAgICAgICByZXR1cm47XG4gICAgICAgIC8vIGdldERvbWFpbnNGb3JDYXRlZ29yeVxuICAgICAgfVxuXG5cblxuICAgICAgdmFyIGNhdGVnb3J5ID0gV2hhdElzLmFuYWx5emVDYXRlZ29yeShmYWN0T3JDYXQsIHRoZU1vZGVsLnJ1bGVzLCBtZXNzYWdlKTtcbiAgICAgIHZhciBjYXRSZXN1bHRzID0gW107XG4gICAgICBpZiAoY2F0ZWdvcnkpIHtcbiAgICAgICAgLy9UT0RPXG4gICAgICAgIGNhdFJlc3VsdHMgPSBEZXNjcmliZS5kZXNjcmliZUNhdGVnb3J5KGNhdGVnb3J5LGZpbHRlckRvbWFpbiwgdGhlTW9kZWwsbWVzc2FnZSk7XG4gICAgICB9XG5cbiAgICAgIHZhciByZXNGYWN0ID0gRGVzY3JpYmUuZGVzY3JpYmVGYWN0SW5Eb21haW4oZmFjdE9yQ2F0LCBmaWx0ZXJEb21haW4sdGhlTW9kZWwpO1xuICAgICAgaWYoY2F0UmVzdWx0cykge1xuICAgICAgdmFyIHByZWZpeGVkID0gY2F0UmVzdWx0cy5tYXAocmVzID0+XG4gICAgICAgIGAke0Rlc2NyaWJlLnNsb3BweU9yRXhhY3QoY2F0ZWdvcnksIGZhY3RPckNhdCwgdGhlTW9kZWwpfSAgJHtyZXN9YCApO1xuICAgICAgfVxuICAgICAgaWYoY2F0UmVzdWx0cy5sZW5ndGgpIHtcbiAgICAgICAgcmVzRmFjdCA9IHByZWZpeGVkLmpvaW4oXCJcXG5cIik7ICsgXCJcXG5cIiArIHJlc0ZhY3Q7XG4gICAgICB9XG4gICAgICBkaWFsb2dsb2coXCJEZXNjcmliZVwiLCBzZXNzaW9uLCBzZW5kKHJlc0ZhY3QpKTtcbiAgICAgIC8qXG4gICAgICAgICAgdmFyIGFSZXMgPSBNb2RlbC5nZXRDYXRlZ29yaWVzRm9yRG9tYWluKHRoZU1vZGVsLCBkb21haW4pO1xuICAgICAgICAgICB2YXIgcmVzID0gcmVzdHJpY3RMb2dnZWRPbihzZXNzaW9uLCBhUmVzKS5qb2luKFwiO1xcblwiKTtcbiAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsXCIsc2Vzc2lvbixzZW5kKFwibXkgY2F0ZWdvcmllcyBpbiBkb21haW4gXFxcIlwiICsgZG9tYWluICsgXCJcXFwiIGFyZSAuLi5cXG5cIiArIHJlcykpO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKGNhdGVnb3J5ID09PSBcImRvbWFpbnNcIikge1xuICAgICAgICB2YXIgcmVzID0gcmVzdHJpY3RMb2dnZWRPbihzZXNzaW9uLCB0aGVNb2RlbC5kb21haW5zKS5qb2luKFwiO1xcblwiKTtcbiAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbFwiLHNlc3Npb24sIHNlbmQoXCJteSBkb21haW5zIGFyZSAuLi5cXG5cIiArIHJlcykpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBpZiAoY2F0ZWdvcnkgPT09IFwidG9vbHNcIikge1xuICAgICAgICB2YXIgcmVzID0gcmVzdHJpY3RMb2dnZWRPbihzZXNzaW9uLCB0aGVNb2RlbC50b29scykubWFwKGZ1bmN0aW9uIChvVG9vbCkge1xuICAgICAgICAgIHJldHVybiBvVG9vbC5uYW1lO1xuICAgICAgICB9KS5qb2luKFwiO1xcblwiKTtcbiAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbFwiLCBzZXNzaW9uLHNlbmQoXCJteSB0b29scyBhcmUgLi4uXFxuXCIgKyByZXMpKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgKi9cblxuICAgICAgLypcbiAgICAgIHZhciBjYXRzID0gW107XG4gICAgICAgIHRyeSB7XG4gICAgICAgIGNhdHMgPSBXaGF0SXMuYW5hbHl6ZUNhdGVnb3J5TXVsdDIoY2F0ZWdvcnksIHRoZU1vZGVsLnJ1bGVzLCBtZXNzYWdlKTtcbiAgICAgICAgZGVidWdsb2coXCJoZXJlIGNhdHNcIiArIGNhdHMuam9pbihcIixcIikpO1xuICAgICAgfSBjYXRjaCAoZSkge1xuICAgICAgICAgIGlmKGUpIHtcbiAgICAgICAgICAgIGRlYnVnbG9nKFwiaGVyZSBleGNlcHRpb25cIiArIGUpO1xuICAgICAgICAgICAgZGlhbG9nbG9nKFwiV2hhdElzXCIsc2Vzc2lvbixzZW5kKCdJIGRvblxcJ3Qga25vdyBhbnl0aGluZyBhYm91dCBcIicgKyBjYXRlZ29yeSArICdcIignICsgZS50b1N0cmluZygpICsgJyknKSk7XG4gICAgICAgICAgICAvLyBuZXh0KCk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKCFjYXRzIHx8IChjYXRzLmxlbmd0aCA9PT0gMCkpIHtcbiAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbFwiLHNlc3Npb24sc2VuZCgnSSBkb25cXCd0IGtub3cgYW55dGhpbmcgYWJvdXQgXCInICsgY2F0ZWdvcnkgKyAnXCInKSk7XG4gICAgICAgIC8vIG5leHQoKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdmFyIGNhdCA9IFwiXCI7XG4gICAgICBpZiggY2F0cy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgY2F0ID0gY2F0c1swXTtcbiAgICAgIH1cbiAgICAgIGlmKCBjYXRzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICBkZWJ1Z2xvZygnY2F0ZWdvcnkgaWRlbnRpZmllZDonICsgY2F0KTtcbiAgICAgICAgaWYgKGExICYmIGExLmVudGl0eSkge1xuICAgICAgICAgIGRlYnVnbG9nKCdnb3QgZmlsdGVyOicgKyBhMS5lbnRpdHkpO1xuICAgICAgICAgIHZhciBjYXRlZ29yeVNldCA9IE1vZGVsLmdldEFsbFJlY29yZENhdGVnb3JpZXNGb3JUYXJnZXRDYXRlZ29yeSh0aGVNb2RlbCwgY2F0LCB0cnVlKTtcbiAgICAgICAgICB2YXIgcmVzdWx0MSA9IExpc3RBbGwubGlzdEFsbFdpdGhDb250ZXh0KGNhdCwgYTEuZW50aXR5LFxuICAgICAgICAgICAgdGhlTW9kZWwucnVsZXMsIHRoZU1vZGVsLnJlY29yZHMsIGNhdGVnb3J5U2V0KTtcbiAgICAgICAgICAvLyBUT0RPIGNsYXNzaWZ5aW5nIHRoZSBzdHJpbmcgdHdpY2UgaXMgYSB0ZXJyaWJsZSB3YXN0ZVxuICAgICAgICAgIGlmICghcmVzdWx0MS5sZW5ndGgpIHtcbiAgICAgICAgICAgIGRlYnVnbG9nKCdnb2luZyBmb3IgaGF2aW5nJyk7XG4gICAgICAgICAgICB2YXIgY2F0ZWdvcnlTZXRGdWxsID0gTW9kZWwuZ2V0QWxsUmVjb3JkQ2F0ZWdvcmllc0ZvclRhcmdldENhdGVnb3J5KHRoZU1vZGVsLCBjYXQsIGZhbHNlKTtcbiAgICAgICAgICAgIHJlc3VsdDEgPSBMaXN0QWxsLmxpc3RBbGxIYXZpbmdDb250ZXh0KGNhdCwgYTEuZW50aXR5LCB0aGVNb2RlbC5ydWxlcyxcbiAgICAgICAgICAgICAgdGhlTW9kZWwucmVjb3JkcywgY2F0ZWdvcnlTZXRGdWxsKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgZGVidWdsb2coJ2xpc3RhbGwgcmVzdWx0OicgKyBKU09OLnN0cmluZ2lmeShyZXN1bHQxKSk7XG4gICAgICAgICAgdmFyIGpvaW5yZXN1bHRzID0gcmVzdHJpY3RMb2dnZWRPbihzZXNzaW9uLCBMaXN0QWxsLmpvaW5SZXN1bHRzKHJlc3VsdDEpKTtcbiAgICAgICAgICBsb2dRdWVyeVdoYXRJcyhzZXNzaW9uLCAnTGlzdEFsbCcsIHJlc3VsdDEpO1xuICAgICAgICAgIGlmKGpvaW5yZXN1bHRzLmxlbmd0aCApe1xuICAgICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbFwiLHNlc3Npb24sc2VuZChcInRoZSBcIiArIGNhdGVnb3J5ICsgXCIgZm9yIFwiICsgYTEuZW50aXR5ICsgXCIgYXJlIC4uLlxcblwiICsgam9pbnJlc3VsdHMuam9pbihcIjtcXG5cIikpKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbFwiLHNlc3Npb24sc2VuZChcImkgZGlkIG5vdCBmaW5kIGFueSBcIiArIGNhdGVnb3J5ICsgXCIgZm9yIFwiICsgYTEuZW50aXR5ICsgXCIuXFxuXCIgKyBqb2lucmVzdWx0cy5qb2luKFwiO1xcblwiKSkpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gbm8gZW50aXR5LCBlLmcuIGxpc3QgYWxsIGNvdW50cmllc1xuICAgICAgICAgIC8vXG4gICAgICAgICAgdmFyIGNhdGVnb3J5U2V0RnVsbCA9IE1vZGVsLmdldEFsbFJlY29yZENhdGVnb3JpZXNGb3JUYXJnZXRDYXRlZ29yeSh0aGVNb2RlbCwgY2F0LCBmYWxzZSk7XG4gICAgICAgICAgdmFyIHJlc3VsdCA9IExpc3RBbGwubGlzdEFsbEhhdmluZ0NvbnRleHQoY2F0LCBjYXQsIHRoZU1vZGVsLnJ1bGVzLCB0aGVNb2RlbC5yZWNvcmRzLCBjYXRlZ29yeVNldEZ1bGwpO1xuICAgICAgICAgIGxvZ1F1ZXJ5V2hhdElzKHNlc3Npb24sICdMaXN0QWxsJywgcmVzdWx0KTtcbiAgICAgICAgICBpZiAocmVzdWx0Lmxlbmd0aCkge1xuICAgICAgICAgICAgZGVidWdsb2coJ2xpc3RhbGwgcmVzdWx0OicgKyBKU09OLnN0cmluZ2lmeShyZXN1bHQpKTtcbiAgICAgICAgICAgIHZhciBqb2lucmVzdWx0cyA9IFtdO1xuICAgICAgICAgICAgZGVidWdsb2coXCJoZXJlIGlzIGNhdD5cIiArIGNhdCk7XG4gICAgICAgICAgICBpZihjYXQgIT09IFwiZXhhbXBsZSBxdWVzdGlvblwiKSB7XG4gICAgICAgICAgICAgIGpvaW5yZXN1bHRzID0gcmVzdHJpY3RMb2dnZWRPbihzZXNzaW9uLCBMaXN0QWxsLmpvaW5SZXN1bHRzKHJlc3VsdCkpO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgam9pbnJlc3VsdHMgPSBMaXN0QWxsLmpvaW5SZXN1bHRzKHJlc3VsdCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSBcInRoZSBcIiArIGNhdGVnb3J5ICsgXCIgYXJlIC4uLlxcblwiICsgam9pbnJlc3VsdHMuam9pbihcIjtcXG5cIik7XG4gICAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsXCIsc2Vzc2lvbixzZW5kKHJlc3BvbnNlKSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHZhciByZXNwb25zZSA9IFwiRm91bmQgbm8gZGF0YSBoYXZpbmcgXFxcIlwiICsgY2F0ICsgXCJcXFwiXCJcbiAgICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxcIixzZXNzaW9uLHNlbmQocmVzcG9uc2UpKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIC8vIG11bHRpcGxlIGNhdGVnb3JpZXNcbiAgICAgICAgZGVidWdsb2coJ2NhdGVnb3JpZXMgaWRlbnRpZmllZDonICsgY2F0cy5qb2luKFwiLFwiKSk7XG4gICAgICAgIGlmIChhMSAmJiBhMS5lbnRpdHkpIHtcbiAgICAgICAgICBkZWJ1Z2xvZygnZ290IGZpbHRlcjonICsgYTEuZW50aXR5KTtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgIHZhciBjYXRlZ29yeVNldCA9IE1vZGVsLmdldEFsbFJlY29yZENhdGVnb3JpZXNGb3JUYXJnZXRDYXRlZ29yaWVzKHRoZU1vZGVsLCBjYXRzLCB0cnVlKTtcbiAgICAgICAgICB9IGNhdGNoKGUpIHtcbiAgICAgICAgICAgICAgZGVidWdsb2coXCJoZXJlIGV4Y2VwdGlvblwiICsgZSk7XG4gICAgICAgICAgICAgIGRpYWxvZ2xvZyhcIldoYXRJc1wiLHNlc3Npb24sc2VuZCgnSSBjYW5ub3QgY29tYmluZSBcIicgKyBjYXRlZ29yeSArICcoJyArIGUudG9TdHJpbmcoKSArICcpJykpO1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgfVxuICAgICAgICAgIHZhciByZXN1bHQxVCA9IExpc3RBbGwubGlzdEFsbFR1cGVsV2l0aENvbnRleHQoY2F0cywgYTEuZW50aXR5LFxuICAgICAgICAgICAgdGhlTW9kZWwucnVsZXMsIHRoZU1vZGVsLnJlY29yZHMsIGNhdGVnb3J5U2V0KTtcbiAgICAgICAgICAvLyBUT0RPIGNsYXNzaWZ5aW5nIHRoZSBzdHJpbmcgdHdpY2UgaXMgYSB0ZXJyaWJsZSB3YXN0ZVxuICAgICAgICAgIGlmICghcmVzdWx0MVQubGVuZ3RoKSB7XG4gICAgICAgICAgICBkZWJ1Z2xvZygnZ29pbmcgZm9yIGhhdmluZycpO1xuICAgICAgICAgICAgdmFyIGNhdGVnb3J5U2V0RnVsbCA9IE1vZGVsLmdldEFsbFJlY29yZENhdGVnb3JpZXNGb3JUYXJnZXRDYXRlZ29yaWVzKHRoZU1vZGVsLCBjYXRzLCBmYWxzZSk7XG4gICAgICAgICAgICByZXN1bHQxVCA9IExpc3RBbGwubGlzdEFsbFR1cGVsSGF2aW5nQ29udGV4dChjYXRzLCBhMS5lbnRpdHksIHRoZU1vZGVsLnJ1bGVzLFxuICAgICAgICAgICAgICB0aGVNb2RlbC5yZWNvcmRzLCBjYXRlZ29yeVNldEZ1bGwpO1xuICAgICAgICAgIH1cbiAgICAgICAgICBkZWJ1Z2xvZygnbGlzdGFsbCByZXN1bHQ6JyArIEpTT04uc3RyaW5naWZ5KHJlc3VsdDFUKSk7XG4gICAgICAgICAgdmFyIGpvaW5yZXN1bHRzID0gcmVzdHJpY3RMb2dnZWRPbihzZXNzaW9uLCBMaXN0QWxsLmpvaW5SZXN1bHRzVHVwZWwocmVzdWx0MVQpKTtcbiAgICAgICAgICBsb2dRdWVyeVdoYXRJc1R1cGVsKHNlc3Npb24sICdMaXN0QWxsJywgcmVzdWx0MVQpO1xuICAgICAgICAgIGlmKGpvaW5yZXN1bHRzLmxlbmd0aCApe1xuICAgICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbFwiLHNlc3Npb24sc2VuZChcInRoZSBcIiArIGNhdGVnb3J5ICsgXCIgZm9yIFwiICsgYTEuZW50aXR5ICsgXCIgYXJlIC4uLlxcblwiICsgam9pbnJlc3VsdHMuam9pbihcIjtcXG5cIikpKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbFwiLHNlc3Npb24sc2VuZChcImkgZGlkIG5vdCBmaW5kIGFueSBcIiArIGNhdGVnb3J5ICsgXCIgZm9yIFwiICsgYTEuZW50aXR5ICsgXCIuXFxuXCIgKyBqb2lucmVzdWx0cy5qb2luKFwiO1xcblwiKSkpO1xuICAgICAgICAgIH1cbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgLy8gbm8gZW50aXR5LCBlLmcuIGxpc3QgYWxsIGNvdW50cmllc1xuICAgICAgICAgIC8vXG4gICAgICAgICAgdmFyIGNhdGVnb3J5U2V0RnVsbCA9IHt9IGFzIHsgW2tleSA6IHN0cmluZ10gOiBib29sZWFufTtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgY2F0ZWdvcnlTZXRGdWxsID0gTW9kZWwuZ2V0QWxsUmVjb3JkQ2F0ZWdvcmllc0ZvclRhcmdldENhdGVnb3JpZXModGhlTW9kZWwsIGNhdHMsIGZhbHNlKTtcbiAgICAgICAgICB9IGNhdGNoKGUpIHtcbiAgICAgICAgICAgICAgZGVidWdsb2coXCJoZXJlIGV4Y2VwdGlvblwiICsgZSk7XG4gICAgICAgICAgICAgIGRpYWxvZ2xvZyhcIldoYXRJc1wiLHNlc3Npb24sc2VuZCgnSSBjYW5ub3QgY29tYmluZSBcIicgKyBjYXRlZ29yeSArICcoJyArIGUudG9TdHJpbmcoKSArICcpJykpO1xuICAgICAgICAgIC8vIG5leHQoKTtcbiAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgICB2YXIgcmVzdWx0VCA9IExpc3RBbGwubGlzdEFsbFR1cGVsSGF2aW5nQ29udGV4dChjYXRzLCBcIlxcXCJcIiArIGNhdHMuam9pbihcIlxcXCIgXFxcIlwiKSArIFwiXFxcIlwiLCB0aGVNb2RlbC5ydWxlcywgdGhlTW9kZWwucmVjb3JkcywgY2F0ZWdvcnlTZXRGdWxsKTtcbiAgICAgICAgICBsb2dRdWVyeVdoYXRJc1R1cGVsKHNlc3Npb24sICdMaXN0QWxsJywgcmVzdWx0VCk7XG4gICAgICAgICAgaWYgKHJlc3VsdFQubGVuZ3RoKSB7XG4gICAgICAgICAgICBkZWJ1Z2xvZygnbGlzdGFsbCByZXN1bHQ6JyArIEpTT04uc3RyaW5naWZ5KHJlc3VsdFQpKTtcbiAgICAgICAgICAgIHZhciBqb2lucmVzdWx0cyA9IFtdO1xuICAgICAgICAgICAgZGVidWdsb2coXCJoZXJlIGlzIGNhdD5cIiArIGNhdHMuam9pbihcIiwgXCIpKTtcbiAgICAgICAgICAgIGlmKGNhdCAhPT0gXCJleGFtcGxlIHF1ZXN0aW9uXCIpIHtcbiAgICAgICAgICAgICAgam9pbnJlc3VsdHMgPSByZXN0cmljdExvZ2dlZE9uKHNlc3Npb24sIExpc3RBbGwuam9pblJlc3VsdHNUdXBlbChyZXN1bHRUKSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBqb2lucmVzdWx0cyA9IExpc3RBbGwuam9pblJlc3VsdHNUdXBlbChyZXN1bHRUKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciByZXNwb25zZSA9IFwidGhlIFwiICsgY2F0ZWdvcnkgKyBcIiBhcmUgLi4uXFxuXCIgKyBqb2lucmVzdWx0cy5qb2luKFwiO1xcblwiKTtcbiAgICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxcIixzZXNzaW9uLHNlbmQocmVzcG9uc2UpKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0gXCJGb3VuZCBubyBkYXRhIGhhdmluZyBcXFwiXCIgKyBjYXQgKyBcIlxcXCJcIlxuICAgICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbFwiLHNlc3Npb24sc2VuZChyZXNwb25zZSkpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgICAqL1xuICAgIH1cbiAgXSk7XG5cblxuICBkaWFsb2cubWF0Y2hlcygnTGlzdEFsbEJpbk9wJywgW1xuICAgIGZ1bmN0aW9uIChzZXNzaW9uLCBhcmdzLCBuZXh0KSB7XG4gICAgICB2YXIgaXNDb21iaW5lZEluZGV4ID0ge307XG4gICAgICB2YXIgb05ld0VudGl0eTtcbiAgICAgIC8vIGV4cGVjdGluZyBlbnRpdHkgQTFcbiAgICAgIHZhciBtZXNzYWdlID0gc2Vzc2lvbi5tZXNzYWdlLnRleHQ7XG4gICAgICBkZWJ1Z2xvZyhcIkludGVudCA6IExpc3RBbGxCaW5PcFwiKTtcbiAgICAgIGRlYnVnbG9nKCdyYXc6ICcgKyBKU09OLnN0cmluZ2lmeShhcmdzLmVudGl0aWVzKSwgdW5kZWZpbmVkLCAyKTtcbiAgICAgIHZhciBjYXRlZ29yeUVudGl0eSA9IGJ1aWxkZXIuRW50aXR5UmVjb2duaXplci5maW5kRW50aXR5KGFyZ3MuZW50aXRpZXMsICdjYXRlZ29yeScpO1xuICAgICAgdmFyIGNhdGVnb3J5V29yZCA9IGNhdGVnb3J5RW50aXR5LmVudGl0eTtcbiAgICAgIHZhciBvcEVudGl0eSA9IGJ1aWxkZXIuRW50aXR5UmVjb2duaXplci5maW5kRW50aXR5KGFyZ3MuZW50aXRpZXMsICdvcGVyYXRvcicpO1xuICAgICAgdmFyIG9wZXJhdG9yV29yZCA9IG9wRW50aXR5ICYmICBvcEVudGl0eS5lbnRpdHk7XG4gICAgICAvLyBjYXRlZ29yaXplIGFzIG9wZXJhdG9yID9cbiAgICAgIHZhciBmaWx0ZXJEb21haW5FbnRpdHkgPSAgYnVpbGRlci5FbnRpdHlSZWNvZ25pemVyLmZpbmRFbnRpdHkoYXJncy5lbnRpdGllcywgJ2RvbWFpbicpO1xuICAgICAgdmFyIGZpbHRlckRvbWFpblMgPSBmaWx0ZXJEb21haW5FbnRpdHkgJiYgZmlsdGVyRG9tYWluRW50aXR5LmVudGl0eTtcbiAgICAgIHZhciBvcGVyYXRvciA9IFdoYXRJcy5hbmFseXplT3BlcmF0b3Iob3BlcmF0b3JXb3JkLCB0aGVNb2RlbC5ydWxlcywgbWVzc2FnZSk7XG4gICAgICB2YXIgY2F0ZWdvcnkgPSBXaGF0SXMuYW5hbHl6ZUNhdGVnb3J5KGNhdGVnb3J5V29yZCwgdGhlTW9kZWwucnVsZXMsIG1lc3NhZ2UpO1xuICAgICAgdmFyIG9wZXJhdG9yQXJncyA9IE1vZGVsLmdldE9wZXJhdG9yKHRoZU1vZGVsLCBvcGVyYXRvcik7XG4gICAgICB2YXIgYTIgPSBidWlsZGVyLkVudGl0eVJlY29nbml6ZXIuZmluZEVudGl0eShhcmdzLmVudGl0aWVzLCAnQTInKTtcbiAgICAgIGlmICghb3BlcmF0b3IpIHtcbiAgICAgICAgdmFyIHMgPSBcIlVua25vd24gb3BlcmF0b3IgXCIgKyBvcGVyYXRvcldvcmQgKyBcIiwgdGhpcyBpcyBhIG1vZGVsIGJ1ZywgY2hlY2sgb3BlcmF0b3JzLmpzb24gYW5kIGludGVudHMuanNvblwiO1xuICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsQmluT3BcIiwgc2Vzc2lvbiwgc2VuZChcIm91Y2gsIHRoaXMgd2FzIGluIGludGVybmFsIGVycm9yLiBSZWNvdmVyaW5nIGZyb20gYSB3ZWlyZCBvcGVyYXRvciBcXFwiXCJcbiAgICAgICAgICArIG9wZXJhdG9yV29yZCArIFwiXFxcIlxcblwiKSk7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcihzKTtcbiAgICAgIH1cbiAgICAgIHZhciBmaWx0ZXJEb21haW4gPSB1bmRlZmluZWQ7XG4gICAgICBpZiAoZmlsdGVyRG9tYWluUykge1xuICAgICAgICBkZWJ1Z2xvZyhcImZvdW5kIGEgZG9tYWluU3RyaW5nXCIgKyBmaWx0ZXJEb21haW5TKTtcbiAgICAgICAgZmlsdGVyRG9tYWluID0gTGlzdEFsbC5pbmZlckRvbWFpbih0aGVNb2RlbCwgZmlsdGVyRG9tYWluUyk7XG4gICAgICAgIGRlYnVnbG9nKFwiZ290IGRvbWFpblwiICsgZmlsdGVyRG9tYWluKTtcbiAgICAgICAgaWYgKCFmaWx0ZXJEb21haW4pIHtcbiAgICAgICAgICBkaWFsb2dsb2coXCJEZXNjcmliZVwiLCBzZXNzaW9uLCBzZW5kKFwiSSBkaWQgbm90IGluZmVyIGEgZG9tYWluIHJlc3RyaWN0aW9uIGZyb20gXFxcIlwiICsgZmlsdGVyRG9tYWluUyArIFwiXFxcIi4gU3BlY2lmeSBhbiBleGlzdGluZyBkb21haW4uIChMaXN0IGFsbCBkb21haW5zKSB0byBnZXQgZXhhY3QgbmFtZXMuXFxuXCIpKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgdmFyIGZyYWdtZW50ID0gYTIgJiYgYTIuZW50aXR5O1xuICAgICAgZnJhZ21lbnQgPSBCcmVha0Rvd24udHJpbVF1b3RlZChCcmVha0Rvd24udHJpbVF1b3RlZFNwYWNlZChmcmFnbWVudCkpO1xuICAgICAgZGVidWdsb2coXCJmcmFnbWVudCBhZnRlciB0cmltbWluZyBcXFwiXCIgKyBmcmFnbWVudCArIFwiXFxcIlwiKTtcbiAgICAgIGlmIChjYXRlZ29yeVdvcmQgPT09IFwiY2F0ZWdvcmllc1wiKSB7XG4gICAgICAgIC8vIGRvIHdlIGhhdmUgYSBmaWx0ZXI/XG4gICAgICAgIHZhciBhRmlsdGVyZWRDYXRlZ29yaWVzID0gTGlzdEFsbC5maWx0ZXJTdHJpbmdMaXN0QnlPcChvcGVyYXRvckFyZ3MsIGZyYWdtZW50LCB0aGVNb2RlbC5jYXRlZ29yeSk7XG4gICAgICAgIGlmKGZpbHRlckRvbWFpbikge1xuICAgICAgICAgIHZhciBjYXRzRm9yRG9tYWluID0gTW9kZWwuZ2V0Q2F0ZWdvcmllc0ZvckRvbWFpbih0aGVNb2RlbCxmaWx0ZXJEb21haW4pO1xuICAgICAgICAgIGFGaWx0ZXJlZENhdGVnb3JpZXMgPSBfLmludGVyc2VjdGlvbihhRmlsdGVyZWRDYXRlZ29yaWVzLGNhdHNGb3JEb21haW4pO1xuICAgICAgICB9XG4gICAgICAgIHJlcyA9IHJlc3RyaWN0TG9nZ2VkT24oc2Vzc2lvbiwgYUZpbHRlcmVkQ2F0ZWdvcmllcykuam9pbihcIjtcXG5cIik7XG4gICAgICAgIGlmIChyZXMubGVuZ3RoKSB7XG4gICAgICAgICAgaWYoZmlsdGVyRG9tYWluKSB7XG4gICAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsQmluT3BcIiwgc2Vzc2lvbiwgc2VuZChgbXkgY2F0ZWdvcmllcyAke29wZXJhdG9yfSBcIiR7ZnJhZ21lbnR9XCIgaW4gZG9tYWluIFwiJHtmaWx0ZXJEb21haW59XCIgYXJlIC4uLlxcbmAgKyByZXMpKTtcbiAgICAgICAgICB9ZWxzZSB7XG4gICAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsQmluT3BcIiwgc2Vzc2lvbiwgc2VuZChgbXkgY2F0ZWdvcmllcyAke29wZXJhdG9yfSBcIiR7ZnJhZ21lbnR9XCIgYXJlIC4uLlxcbmAgKyByZXMpKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbEJpbk9wXCIsIHNlc3Npb24sIHNlbmQoJ0kgaGF2ZSBubyBjYXRlZ29yaWVzICcgKyBvcGVyYXRvciArICcgXCInICsgZnJhZ21lbnQgKyAnXCInKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgZWxzZSBpZiAoY2F0ZWdvcnlXb3JkID09PSBcImRvbWFpbnNcIikge1xuICAgICAgICB2YXIgYVJlcyA9IExpc3RBbGwuZmlsdGVyU3RyaW5nTGlzdEJ5T3Aob3BlcmF0b3JBcmdzLCBmcmFnbWVudCwgdGhlTW9kZWwuZG9tYWlucyk7XG4gICAgICAgIHJlcyA9IHJlc3RyaWN0TG9nZ2VkT24oc2Vzc2lvbiwgYVJlcykuam9pbihcIjtcXG5cIik7XG4gICAgICAgIGlmIChyZXMubGVuZ3RoKSB7XG4gICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbEJpbk9wXCIsIHNlc3Npb24sIHNlbmQoXCJteSBkb21haW5zIFwiICsgb3BlcmF0b3IgKyAnIFwiJyArIGZyYWdtZW50ICsgJ1wiIGFyZSAuLi5cXG4nICsgcmVzKSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbEJpbk9wXCIsIHNlc3Npb24sIHNlbmQoJ0kgaGF2ZSBubyBkb21haW5zICcgKyBvcGVyYXRvciArICcgXCInICsgZnJhZ21lbnQgKyAnXCInKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgZWxzZSBpZiAoY2F0ZWdvcnlXb3JkID09PSBcInRvb2xzXCIpIHtcbiAgICAgICAgdmFyIGFSZXMgPSBMaXN0QWxsLmZpbHRlclN0cmluZ0xpc3RCeU9wKG9wZXJhdG9yQXJncywgZnJhZ21lbnQsIHRoZU1vZGVsLnRvb2xzLm1hcChcbiAgICAgICAgICBmdW5jdGlvbiAob1Rvb2wpIHsgcmV0dXJuIG9Ub29sLm5hbWU7IH0pKTtcbiAgICAgICAgdmFyIHJlcyA9IHJlc3RyaWN0TG9nZ2VkT24oc2Vzc2lvbiwgYVJlcykuam9pbihcIjtcXG5cIik7XG4gICAgICAgIGlmIChyZXMubGVuZ3RoKSB7XG4gICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbEJpbk9wXCIsIHNlc3Npb24sIHNlbmQoXCJteSB0b29scyBcIiArIG9wZXJhdG9yICsgJyBcIicgKyBmcmFnbWVudCArICdcIiBhcmUgLi4uXFxuJyArIHJlcykpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxCaW5PcFwiLCBzZXNzaW9uLCBzZW5kKFwiSSBoYXZlIG5vIHRvb2xzIFwiICsgb3BlcmF0b3IgKyAnIFwiJyArIGZyYWdtZW50ICsgJ1wiJykpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGVsc2UgeyAvLyBjYXRlZ29yeSBpcyBjYXRlZ29yeVxuICAgICAgICB2YXIgY2F0ID0gV2hhdElzLmFuYWx5emVDYXRlZ29yeShjYXRlZ29yeVdvcmQsIHRoZU1vZGVsLnJ1bGVzLCBtZXNzYWdlKTtcbiAgICAgICAgaWYgKCFjYXQpIHtcbiAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsQmluT3BcIiwgc2Vzc2lvbiwgc2VuZCgnSSBkb25cXCd0IGtub3cgYW55dGhpbmcgYWJvdXQgXCInICsgY2F0ZWdvcnlXb3JkICsgJ1wiJykpO1xuICAgICAgICAgIC8vIG5leHQoKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgZGVidWdsb2coJ2NhdGVnb3J5IGlkZW50aWZpZWQ6JyArIGNhdCk7XG4gICAgICAgIHZhciBhUmVzID0gTGlzdEFsbC5nZXRDYXRlZ29yeU9wRmlsdGVyQXNEaXN0aW5jdFN0cmluZ3Mob3BlcmF0b3JBcmdzLCBmcmFnbWVudCwgY2F0ZWdvcnksIHRoZU1vZGVsLnJlY29yZHMsIGZpbHRlckRvbWFpbik7XG4gICAgICAgIHZhciByZXMgPSByZXN0cmljdExvZ2dlZE9uKHNlc3Npb24sIGFSZXMpLmpvaW4oXCI7XFxuXCIpO1xuICAgICAgICB2YXIgaW5maXhFeHBsYWluID0gJydcbiAgICAgICAgaWYgKCFMaXN0QWxsLmxpa2VseVBsdXJhbERpZmYoY2F0ZWdvcnksIGNhdGVnb3J5V29yZCkpIHtcbiAgICAgICAgICBpbmZpeEV4cGxhaW4gPSAnKFwiJyArIGNhdGVnb3J5ICsgJ1wiKSc7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHJlcy5sZW5ndGgpIHtcbiAgICAgICAgICBpZiAoZmlsdGVyRG9tYWluKSB7XG4gICAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsQmluT3BcIiwgc2Vzc2lvbiwgc2VuZChgbXkgJHtjYXRlZ29yeVdvcmR9JHtpbmZpeEV4cGxhaW59ICR7b3BlcmF0b3J9IFwiJHtmcmFnbWVudH1cIiBpbiBkb21haW4gXCIke2ZpbHRlckRvbWFpbn1cIiBhcmUgLi4uXFxuYCArIHJlcykpO1xuXG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxCaW5PcFwiLCBzZXNzaW9uLCBzZW5kKGBteSAke2NhdGVnb3J5V29yZH0ke2luZml4RXhwbGFpbn0gJHtvcGVyYXRvcn0gXCIke2ZyYWdtZW50fVwiIGFyZSAuLi5cXG5gICsgcmVzKSk7XG4gICAgICAgICAgfVxuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxCaW5PcFwiLCBzZXNzaW9uLCBzZW5kKCdJIGhhdmUgbm8gJyArIGNhdGVnb3J5V29yZCArIGluZml4RXhwbGFpbiArICcgJyArIG9wZXJhdG9yICsgJyBcIicgKyBmcmFnbWVudCArICdcIicpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfVxuICBdKTtcblxuICBkaWFsb2cubWF0Y2hlcygnVHJhaW5NZScsIFtcbiAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgYXJncywgbmV4dCkge1xuICAgICAgdmFyIGlzQ29tYmluZWRJbmRleCA9IHt9O1xuICAgICAgdmFyIG9OZXdFbnRpdHk7XG4gICAgICAvLyBleHBlY3RpbmcgZW50aXR5IEExXG4gICAgICB2YXIgbWVzc2FnZSA9IHNlc3Npb24ubWVzc2FnZS50ZXh0O1xuICAgICAgZGVidWdsb2coXCJJbnRlbnQgOiBUcmFpblwiKTtcbiAgICAgIGRlYnVnbG9nKCdyYXc6ICcgKyBKU09OLnN0cmluZ2lmeShhcmdzLmVudGl0aWVzKSwgdW5kZWZpbmVkLCAyKTtcbiAgICAgIHZhciBjYXRlZ29yeUVudGl0eSA9IGJ1aWxkZXIuRW50aXR5UmVjb2duaXplci5maW5kRW50aXR5KGFyZ3MuZW50aXRpZXMsICdjYXRlZ29yaWVzJyk7XG4gICAgICBpZiAobWVzc2FnZS50b0xvd2VyQ2FzZSgpLmluZGV4T2YoXCJrcm9ub3NcIikgPj0gMCB8fCBtZXNzYWdlLnRvTG93ZXJDYXNlKCkuaW5kZXhPZihcImtsaW5nb25cIikgPj0gMCkge1xuICAgICAgICBkaWFsb2dsb2coXCJUcmFpbk1lXCIsIHNlc3Npb24sIHNlbmQoZ2V0UmFuZG9tUmVzdWx0KGFUcmFpbk5vS2xpbmdvbikpKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgdmFyIHJlcyA9IGdldFJhbmRvbVJlc3VsdChhVHJhaW5SZXBsaWVzKTtcbiAgICAgIGRpYWxvZ2xvZyhcIlRyYWluTWVcIiwgc2Vzc2lvbiwgc2VuZChyZXMpKTtcbiAgICB9XG4gIF0pO1xuXG4gIGRpYWxvZy5tYXRjaGVzKCdUb29Mb25nJywgW1xuICAgIGZ1bmN0aW9uIChzZXNzaW9uLCBhcmdzLCBuZXh0KSB7XG4gICAgICB2YXIgaXNDb21iaW5lZEluZGV4ID0ge307XG4gICAgICB2YXIgb05ld0VudGl0eTtcbiAgICAgIC8vIGV4cGVjdGluZyBlbnRpdHkgQTFcbiAgICAgIHZhciBtZXNzYWdlID0gc2Vzc2lvbi5tZXNzYWdlLnRleHQ7XG4gICAgICBkZWJ1Z2xvZyhcIkludGVudCA6IFRvb0xvbmdcIik7XG4gICAgICBkZWJ1Z2xvZygncmF3OiAnICsgSlNPTi5zdHJpbmdpZnkoYXJncy5lbnRpdGllcyksIHVuZGVmaW5lZCwgMik7XG4gICAgICB2YXIgY2F0ZWdvcnlFbnRpdHkgPSBidWlsZGVyLkVudGl0eVJlY29nbml6ZXIuZmluZEVudGl0eShhcmdzLmVudGl0aWVzLCAnY2F0ZWdvcmllcycpO1xuICAgICAgZGlhbG9nbG9nKFwiVG9vTG9uZ1wiLCBzZXNzaW9uLCBzZW5kKGdldFJhbmRvbVJlc3VsdChhUmVzcG9uc2VzT25Ub29Mb25nKSkpO1xuICAgIH1cbiAgXSk7XG5cblxuICBkaWFsb2cubWF0Y2hlcygnV3JvbmcnLCBbXG4gICAgZnVuY3Rpb24gKHNlc3Npb24sIGFyZ3MsIG5leHQpIHtcbiAgICAgIC8qXG4gICAgICBkaWFsb2dMb2dnZXIoe1xuICAgICAgICBzZXNzaW9uOiBzZXNzaW9uLFxuICAgICAgICBpbnRlbnQ6IFwiV3JvbmdcIixcbiAgICAgICAgcmVzcG9uc2U6ICc8YmVnaW4gdXBkb3duPidcbiAgICAgIH0pOyAqL1xuICAgICAgc2Vzc2lvbi5iZWdpbkRpYWxvZygnL3VwZG93bicsIHNlc3Npb24udXNlckRhdGEuY291bnQpO1xuICAgIH0sXG4gICAgZnVuY3Rpb24gKHNlc3Npb24sIHJlc3VsdHMsIG5leHQpIHtcbiAgICAgIHZhciBhbGFybSA9IHNlc3Npb24uZGlhbG9nRGF0YS5hbGFybTtcbiAgICAgIG5leHQoKTtcbiAgICB9LFxuICAgIGZ1bmN0aW9uIChzZXNzaW9uLCByZXN1bHRzKSB7XG4gICAgICBzZXNzaW9uLnNlbmQoZ2V0UmFuZG9tUmVzdWx0KGFCYWNrRnJvbVRyYWluaW5nKSk7IC8vICArIEpTT04uc3RyaW5naWZ5KHJlc3VsdHMpKTtcbiAgICAgIC8vc2Vzc2lvbi5zZW5kKCdlbmQgb2Ygd3JvbmcnKTtcbiAgICB9XG4gIF0pO1xuXG4gIGRpYWxvZy5tYXRjaGVzKCdFeGl0JywgW1xuICAgIGZ1bmN0aW9uIChzZXNzaW9uLCBhcmdzLCBuZXh0KSB7XG4gICAgICBkZWJ1Z2xvZygnZXhpdCA6Jyk7XG4gICAgICBkZWJ1Z2xvZygnZXhpdCcgKyBKU09OLnN0cmluZ2lmeShhcmdzLmVudGl0aWVzKSk7XG4gICAgICBkaWFsb2dMb2dnZXIoe1xuICAgICAgICBzZXNzaW9uOiBzZXNzaW9uLFxuICAgICAgICBpbnRlbnQ6IFwiRXhpdFwiLFxuICAgICAgICByZXNwb25zZTogJ3lvdSBhcmUgaW4gYSBsb2dpYyBsb29wJ1xuICAgICAgfSk7XG4gICAgICBzZXNzaW9uLnNlbmQoXCJ5b3UgYXJlIGluIGEgbG9naWMgbG9vcCBcIik7XG4gICAgfVxuICBdKTtcbiAgZGlhbG9nLm1hdGNoZXMoJ0hlbHAnLCBbXG4gICAgZnVuY3Rpb24gKHNlc3Npb24sIGFyZ3MsIG5leHQpIHtcbiAgICAgIGRlYnVnbG9nKCdoZWxwIDonKTtcbiAgICAgIGRlYnVnbG9nKCdoZWxwJyk7XG4gICAgICBzZXNzaW9uLnNlbmQoXCJJIGtub3cgYWJvdXQgLi4uLiA8Y2F0ZWdvcmllcz4+XCIpO1xuICAgIH1cbiAgXSk7XG5cbi8qXG4gIC8vIEFkZCBpbnRlbnQgaGFuZGxlcnNcbiAgZGlhbG9nLm1hdGNoZXMoJ3RyYWluJywgW1xuICAgIGZ1bmN0aW9uIChzZXNzaW9uLCBhcmdzLCBuZXh0KSB7XG4gICAgICBkZWJ1Z2xvZygndHJhaW4nKTtcbiAgICAgIC8vIFJlc29sdmUgYW5kIHN0b3JlIGFueSBlbnRpdGllcyBwYXNzZWQgZnJvbSBMVUlTLlxuICAgICAgdmFyIHRpdGxlID0gYnVpbGRlci5FbnRpdHlSZWNvZ25pemVyLmZpbmRFbnRpdHkoYXJncy5lbnRpdGllcywgJ2J1aWx0aW4uYWxhcm0udGl0bGUnKTtcbiAgICAgIHZhciB0aW1lID0gYnVpbGRlci5FbnRpdHlSZWNvZ25pemVyLnJlc29sdmVUaW1lKGFyZ3MuZW50aXRpZXMpO1xuICAgICAgdmFyIGFsYXJtID0gc2Vzc2lvbi5kaWFsb2dEYXRhLmFsYXJtID0ge1xuICAgICAgICB0aXRsZTogdGl0bGUgPyB0aXRsZS5lbnRpdHkgOiBudWxsLFxuICAgICAgICB0aW1lc3RhbXA6IHRpbWUgPyB0aW1lLmdldFRpbWUoKSA6IG51bGxcbiAgICAgIH07XG4gICAgICAvLyBQcm9tcHQgZm9yIHRpdGxlXG4gICAgICBpZiAoIWFsYXJtLnRpdGxlKSB7XG4gICAgICAgIGRpYWxvZ0xvZ2dlcih7XG4gICAgICAgICAgc2Vzc2lvbjogc2Vzc2lvbixcbiAgICAgICAgICBpbnRlbnQ6IFwidHJhaW5cIixcbiAgICAgICAgICByZXNwb25zZTogJ1doYXQgZmFjdCB3b3VsZCB5b3UgbGlrZSB0byB0cmFpbj8nXG4gICAgICAgIH0pO1xuICAgICAgICBidWlsZGVyLlByb21wdHMudGV4dChzZXNzaW9uLCAnV2hhdCBmYWN0IHdvdWxkIHlvdSBsaWtlIHRvIHRyYWluPycpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbmV4dCgpO1xuICAgICAgfVxuICAgIH0sXG4gICAgZnVuY3Rpb24gKHNlc3Npb24sIHJlc3VsdHMsIG5leHQpIHtcbiAgICAgIHZhciBhbGFybSA9IHNlc3Npb24uZGlhbG9nRGF0YS5hbGFybTtcbiAgICAgIGlmIChyZXN1bHRzLnJlc3BvbnNlKSB7XG4gICAgICAgIGFsYXJtLnRpdGxlID0gcmVzdWx0cy5yZXNwb25zZTtcbiAgICAgIH1cblxuICAgICAgLy8gUHJvbXB0IGZvciB0aW1lICh0aXRsZSB3aWxsIGJlIGJsYW5rIGlmIHRoZSB1c2VyIHNhaWQgY2FuY2VsKVxuICAgICAgaWYgKGFsYXJtLnRpdGxlICYmICFhbGFybS50aW1lc3RhbXApIHtcblxuXG4gICAgICAgIGJ1aWxkZXIuUHJvbXB0cy50aW1lKHNlc3Npb24sICdXaGF0IHRpbWUgd291bGQgeW91IGxpa2UgdG8gc2V0IHRoZSBhbGFybSBmb3I/Jyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBuZXh0KCk7XG4gICAgICB9XG4gICAgfSxcbiAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgcmVzdWx0cykge1xuICAgICAgdmFyIGFsYXJtID0gc2Vzc2lvbi5kaWFsb2dEYXRhLmFsYXJtO1xuICAgICAgaWYgKHJlc3VsdHMucmVzcG9uc2UpIHtcbiAgICAgICAgdmFyIHRpbWUgPSBidWlsZGVyLkVudGl0eVJlY29nbml6ZXIucmVzb2x2ZVRpbWUoW3Jlc3VsdHMucmVzcG9uc2VdKTtcbiAgICAgICAgYWxhcm0udGltZXN0YW1wID0gdGltZSA/IHRpbWUuZ2V0VGltZSgpIDogbnVsbDtcbiAgICAgIH1cbiAgICAgIC8vIFNldCB0aGUgYWxhcm0gKGlmIHRpdGxlIG9yIHRpbWVzdGFtcCBpcyBibGFuayB0aGUgdXNlciBzYWlkIGNhbmNlbClcbiAgICAgIGlmIChhbGFybS50aXRsZSAmJiBhbGFybS50aW1lc3RhbXApIHtcbiAgICAgICAgLy8gU2F2ZSBhZGRyZXNzIG9mIHdobyB0byBub3RpZnkgYW5kIHdyaXRlIHRvIHNjaGVkdWxlci5cbiAgICAgICAgYWxhcm0uYWRkcmVzcyA9IHNlc3Npb24ubWVzc2FnZS5hZGRyZXNzO1xuICAgICAgICAvL2FsYXJtc1thbGFybS50aXRsZV0gPSBhbGFybTtcblxuICAgICAgICAvLyBTZW5kIGNvbmZpcm1hdGlvbiB0byB1c2VyXG4gICAgICAgIHZhciBkYXRlID0gbmV3IERhdGUoYWxhcm0udGltZXN0YW1wKTtcbiAgICAgICAgdmFyIGlzQU0gPSBkYXRlLmdldEhvdXJzKCkgPCAxMjtcbiAgICAgICAgc2Vzc2lvbi5zZW5kKCdDcmVhdGluZyBhbGFybSBuYW1lZCBcIiVzXCIgZm9yICVkLyVkLyVkICVkOiUwMmQlcycsXG4gICAgICAgICAgYWxhcm0udGl0bGUsXG4gICAgICAgICAgZGF0ZS5nZXRNb250aCgpICsgMSwgZGF0ZS5nZXREYXRlKCksIGRhdGUuZ2V0RnVsbFllYXIoKSxcbiAgICAgICAgICBpc0FNID8gZGF0ZS5nZXRIb3VycygpIDogZGF0ZS5nZXRIb3VycygpIC0gMTIsIGRhdGUuZ2V0TWludXRlcygpLCBpc0FNID8gJ2FtJyA6ICdwbScpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc2Vzc2lvbi5zZW5kKCdPay4uLiBubyBwcm9ibGVtLicpO1xuICAgICAgfVxuICAgIH1cbiAgXSk7XG4qL1xuXG4gIGRpYWxvZy5vbkRlZmF1bHQoZnVuY3Rpb24gKHNlc3Npb24pIHtcbiAgICBsb2dRdWVyeShzZXNzaW9uLCBcIm9uRGVmYXVsdFwiKTtcbiAgICB2YXIgZWxpemEgPSBnZXRFbGl6YUJvdChnZXRDb252ZXJzYXRpb25JZChzZXNzaW9uKSk7XG4gICAgdmFyIHJlcGx5ID0gZWxpemEudHJhbnNmb3JtKHNlc3Npb24ubWVzc2FnZS50ZXh0KTtcbiAgICBkaWFsb2dsb2coXCJlbGl6YVwiLCBzZXNzaW9uLCBzZW5kKHJlcGx5KSk7XG4gICAgLy9uZXcgRWlsemFib3RcbiAgICAvL3Nlc3Npb24uc2VuZChcIkkgZG8gbm90IHVuZGVyc3RhbmQgdGhpcyBhdCBhbGxcIik7XG4gICAgLy9idWlsZGVyLkRpYWxvZ0FjdGlvbi5zZW5kKCdJXFwnbSBzb3JyeSBJIGRpZG5cXCd0IHVuZGVyc3RhbmQuIEkgY2FuIG9ubHkgc2hvdyBzdGFydCBhbmQgcmluZycpO1xuICB9KTtcblxuICAvKlxuICAvLyBWZXJ5IHNpbXBsZSBhbGFybSBzY2hlZHVsZXJcbiAgdmFyIGFsYXJtcyA9IHt9O1xuICBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIG5vdyA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICAgIGZvciAodmFyIGtleSBpbiBhbGFybXMpIHtcbiAgICAgIHZhciBhbGFybSA9IGFsYXJtc1trZXldO1xuICAgICAgaWYgKG5vdyA+PSBhbGFybS50aW1lc3RhbXApIHtcbiAgICAgICAgdmFyIG1zZyA9IG5ldyBidWlsZGVyLk1lc3NhZ2UoKVxuICAgICAgICAgIC5hZGRyZXNzKGFsYXJtLmFkZHJlc3MpXG4gICAgICAgICAgLnRleHQoJ0hlcmVcXCdzIHlvdXIgXFwnJXNcXCcgYWxhcm0uJywgYWxhcm0udGl0bGUpO1xuICAgICAgICBib3Quc2VuZChtc2cpO1xuICAgICAgICBkZWxldGUgYWxhcm1zW2tleV07XG4gICAgICB9XG4gICAgfVxuICB9LCAxNTAwMCk7XG4gICovXG59XG5cbmlmIChtb2R1bGUpIHtcbiAgbW9kdWxlLmV4cG9ydHMgPSB7XG4gICAgU2ltcGxlVXBEb3duUmVjb2duaXplcjogU2ltcGxlVXBEb3duUmVjb2duaXplcixcbiAgICBhUmVzcG9uc2VzT25Ub29Mb25nOiBhUmVzcG9uc2VzT25Ub29Mb25nLFxuICAgIG1ldGF3b3Jkc0Rlc2NyaXB0aW9ucyA6IG1ldGF3b3Jkc0Rlc2NyaXB0aW9ucyxcbiAgICBtYWtlQm90OiBtYWtlQm90XG4gIH07XG59XG4iLCIvKipcbiAqIFRoZSBib3QgaW1wbGVtZW50YXRpb25cbiAqXG4gKiBJbnN0YW50aWF0ZSBhcHNzaW5nIGEgY29ubmVjdG9yIHZpYVxuICogbWFrZUJvdFxuICpcbiAqL1xuLyoqXG4gKiBAZmlsZVxuICogQG1vZHVsZSBqZnNlYi5mZGV2c3RhcnQuc21hcnRkaWFsb2dcbiAqIEBjb3B5cmlnaHQgKGMpIDIwMTYgR2VyZCBGb3JzdG1hbm5cbiAqL1xuLy9kZWNsYXJlIG1vZHVsZSAnZWxpemFib3QnIHsgfTtcbi8vZGVjbGFyZSBtb2R1bGUgJ3dpbnN0b24tcGcnIHsgfTtcbi8vZGVsY2FyZSBtb2R1bGUgJ3dpbnN0b24nIHt9O1xuXCJ1c2Ugc3RyaWN0XCI7XG52YXIgYnVpbGRlciA9IHJlcXVpcmUoXCJib3RidWlsZGVyXCIpO1xudmFyIGRlYnVnID0gcmVxdWlyZShcImRlYnVnXCIpO1xudmFyIE1hdGNoID0gcmVxdWlyZShcIi4uL21hdGNoL21hdGNoXCIpO1xudmFyIEFuYWx5emUgPSByZXF1aXJlKFwiLi4vbWF0Y2gvYW5hbHl6ZVwiKTtcbnZhciBCcmVha0Rvd24gPSByZXF1aXJlKFwiLi4vbWF0Y2gvYnJlYWtkb3duXCIpO1xudmFyIFdoYXRJcyA9IHJlcXVpcmUoXCIuLi9tYXRjaC93aGF0aXNcIik7XG52YXIgTGlzdEFsbCA9IHJlcXVpcmUoXCIuLi9tYXRjaC9saXN0YWxsXCIpO1xudmFyIERlc2NyaWJlID0gcmVxdWlyZShcIi4uL21hdGNoL2Rlc2NyaWJlXCIpO1xudmFyIE1ha2VUYWJsZSA9IHJlcXVpcmUoXCIuLi9leGVjL21ha2VxYmV0YWJsZVwiKTtcbnZhciBVdGlscyA9IHJlcXVpcmUoXCIuLi91dGlscy91dGlsc1wiKTtcbnZhciBFckVycm9yID0gcmVxdWlyZShcIi4uL21hdGNoL2VyZXJyb3JcIik7XG52YXIgXyA9IHJlcXVpcmUoXCJsb2Rhc2hcIik7XG52YXIgRGlhbG9nTG9nZ2VyID0gcmVxdWlyZShcIi4uL3V0aWxzL2RpYWxvZ2xvZ2dlclwiKTtcbnZhciBwcm9jZXNzID0gcmVxdWlyZShcInByb2Nlc3NcIik7XG52YXIgZGJ1cmwgPSBwcm9jZXNzLmVudi5EQVRBQkFTRV9VUkwgfHwgXCJcIjtcbnZhciBwZ2xvY2FsdXJsID0gXCJwb3N0Z3JlczovL2pvZTphYmNkZWZAbG9jYWxob3N0OjU0MzIvYWJvdFwiO1xudmFyIGRidXJsID0gcHJvY2Vzcy5lbnYuREFUQUJBU0VfVVJMIHx8IHBnbG9jYWx1cmw7XG52YXIgcGcgPSByZXF1aXJlKFwicGdcIik7XG52YXIgbyA9IHBnO1xuaWYgKCEocHJvY2Vzcy5lbnYuQUJPVF9EQk5PU1NMKSkge1xuICAgIG8uZGVmYXVsdHMuc3NsID0gdHJ1ZTsgLy8gT25seSB1c2VkIGludGVybmFsbHkgIVxufVxudmFyIGRpYWxvZ0xvZ2dlciA9IERpYWxvZ0xvZ2dlci5sb2dnZXIoXCJzbWFydGJvdFwiLCBkYnVybCwgcGcpO1xuZnVuY3Rpb24gc2VuZChvKSB7IHJldHVybiBvOyB9XG47XG5mdW5jdGlvbiBkaWFsb2dsb2coaW50ZW50LCBzZXNzaW9uLCByZXNwb25zZSkge1xuICAgIHZhciBzUmVzcG9uc2U7XG4gICAgdmFyIHNBY3Rpb247XG4gICAgaWYgKHR5cGVvZiByZXNwb25zZSA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICBzQWN0aW9uID0gXCJcIjtcbiAgICAgICAgc1Jlc3BvbnNlID0gcmVzcG9uc2U7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICB2YXIgYU1lc3NhZ2UgPSByZXNwb25zZTtcbiAgICAgICAgdmFyIGlNZXNzYWdlID0gYU1lc3NhZ2UudG9NZXNzYWdlKCk7XG4gICAgICAgIHNSZXNwb25zZSA9IGlNZXNzYWdlLnRleHQ7XG4gICAgICAgIHNBY3Rpb24gPSAoaU1lc3NhZ2UuZW50aXRpZXMgJiYgaU1lc3NhZ2UuZW50aXRpZXNbMF0pID8gKEpTT04uc3RyaW5naWZ5KGlNZXNzYWdlLmVudGl0aWVzICYmIGlNZXNzYWdlLmVudGl0aWVzWzBdKSkgOiBcIlwiO1xuICAgIH1cbiAgICBkaWFsb2dMb2dnZXIoe1xuICAgICAgICBpbnRlbnQ6IGludGVudCxcbiAgICAgICAgc2Vzc2lvbjogc2Vzc2lvbixcbiAgICAgICAgcmVzcG9uc2U6IHNSZXNwb25zZSxcbiAgICAgICAgYWN0aW9uOiBzQWN0aW9uXG4gICAgfSk7XG4gICAgc2Vzc2lvbi5zZW5kKHJlc3BvbnNlKTtcbn1cbi8vY29uc3QgcGdMb2dnZXIgPSBuZXcgUGdMb2dnZXIoe1xuLy8gIG5hbWU6ICd0ZXN0LWxvZ2dlcicsXG4vLyAgbGV2ZWw6ICdkZWJ1ZycsXG4vLyAgY29ublN0cmluZzogJ3Bvc3RncmVzOi8vdWJ1bnR1QGxvY2FsaG9zdDo1NDMyL2NpcmNsZV90ZXN0Jyxcbi8vICB0YWJsZU5hbWU6ICd3aW5zdG9uX2xvZ3MnLFxuLy99KTtcbi8vd2luc3Rvbi5hZGQod2luc3Rvbi50cmFuc3BvcnRzLkZpbGUsIHsgZmlsZW5hbWU6ICd3aW5zdG9uX291dC5sb2cnLCB0aW1lc3RhbXAgOiB0cnVlIH0pO1xuLy8gIHdpbnN0b24ucmVtb3ZlKHdpbnN0b24udHJhbnNwb3J0cy5Db25zb2xlKTtcbi8vd2luc3Rvbi5hZGQocGdMb2dnZXIpO1xuLypcbmNvbnN0IGxvZ2dlciA9IG5ldyB3aW5zdG9uLkxvZ2dlcih7XG4gIHRyYW5zcG9ydHM6IFtcbiAgICBuZXcgd2luc3Rvbi50cmFuc3BvcnRzLkNvbnNvbGUoe1xuICAgICAgY29sb3I6IHRydWUsXG4gICAgICB0aW1lc3RhbXA6IHRydWUsXG4gICAgfSksXG4gICAgcGdMb2dnZXIsXG4gIF1cbn0pO1xuKi9cbi8vcGdMb2dnZXIuaW5pdFRhYmxlKGRvbmUpO1xudmFyIGVsaXphYm90ID0gcmVxdWlyZSgnLi4vZXh0ZXJuL2VsaXphYm90L2VsaXphYm90LmpzJyk7XG4vL2ltcG9ydCAqIGFzIGVsaXphYm90IGZyb20gJ2VsaXphYm90JztcbnZhciBkZWJ1Z2xvZyA9IGRlYnVnKCdzbWFydGRpYWxvZycpO1xudmFyIFBsYWluUmVjb2duaXplciA9IHJlcXVpcmUoXCIuL3BsYWlucmVjb2duaXplclwiKTtcbi8vdmFyIGJ1aWxkZXIgPSByZXF1aXJlKCdib3RidWlsZGVyJyk7XG52YXIgZGlzcGF0Y2hlciA9IHJlcXVpcmUoJy4uL21hdGNoL2Rpc3BhdGNoZXIuanMnKS5kaXNwYXRjaGVyO1xuZnVuY3Rpb24gZ2V0Q29udmVyc2F0aW9uSWQoc2Vzc2lvbikge1xuICAgIHJldHVybiBzZXNzaW9uLm1lc3NhZ2UgJiZcbiAgICAgICAgc2Vzc2lvbi5tZXNzYWdlLmFkZHJlc3MgJiZcbiAgICAgICAgc2Vzc2lvbi5tZXNzYWdlLmFkZHJlc3MuY29udmVyc2F0aW9uLmlkO1xufVxudmFyIGVsaXphYm90cyA9IHt9O1xuZnVuY3Rpb24gZ2V0RWxpemFCb3QoaWQpIHtcbiAgICBpZiAoIWVsaXphYm90c1tpZF0pIHtcbiAgICAgICAgZWxpemFib3RzW2lkXSA9IHtcbiAgICAgICAgICAgIGFjY2VzczogbmV3IERhdGUoKSxcbiAgICAgICAgICAgIGVsaXphYm90OiBuZXcgZWxpemFib3QoKVxuICAgICAgICB9O1xuICAgIH1cbiAgICBlbGl6YWJvdHNbaWRdLmFjY2VzcyA9IG5ldyBEYXRlKCk7XG4gICAgcmV0dXJuIGVsaXphYm90c1tpZF0uZWxpemFib3Q7XG59XG52YXIgbmV3RmxvdyA9IHRydWU7XG52YXIgTW9kZWwgPSByZXF1aXJlKFwiLi4vbW9kZWwvbW9kZWxcIik7XG52YXIgRXhlY1NlcnZlciA9IHJlcXVpcmUoXCIuLi9leGVjL2V4ZWNzZXJ2ZXJcIik7XG4vL2NvbnN0IHRoZURlZmF1bHRNb2RlbCA9IE1vZGVsLmxvYWRNb2RlbHMoKTtcbnZhciBtb2RlbHMgPSB7fTtcbmZ1bmN0aW9uIGxvYWRNb2RlbChtb2RlbFBhdGgpIHtcbiAgICBtb2RlbFBhdGggPSBtb2RlbFBhdGggfHwgXCJcIjtcbiAgICBpZiAoIW1vZGVsc1ttb2RlbFBhdGhdKSB7XG4gICAgICAgIG1vZGVsc1ttb2RlbFBhdGhdID0gTW9kZWwubG9hZE1vZGVscyhtb2RlbFBhdGgpO1xuICAgIH1cbiAgICByZXR1cm4gbW9kZWxzW21vZGVsUGF0aF07XG59XG5pZiAobmV3Rmxvdykge1xufVxuZWxzZSB7XG59XG5mdW5jdGlvbiBpc0Fub255bW91cyh1c2VyaWQpIHtcbiAgICByZXR1cm4gdXNlcmlkLmluZGV4T2YoXCJhbm86XCIpID09PSAwO1xufVxuZnVuY3Rpb24gcmVzdHJpY3RMb2dnZWRPbihzZXNzaW9uLCBhcnIpIHtcbiAgICB2YXIgdXNlcmlkID0gc2Vzc2lvbi5tZXNzYWdlLmFkZHJlc3NcbiAgICAgICAgJiYgc2Vzc2lvbi5tZXNzYWdlLmFkZHJlc3MudXNlclxuICAgICAgICAmJiBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzcy51c2VyLmlkIHx8IFwiXCI7XG4gICAgaWYgKHByb2Nlc3MuZW52LkFCT1RfRU1BSUxfVVNFUiAmJiBpc0Fub255bW91cyh1c2VyaWQpKSB7XG4gICAgICAgIGlmIChhcnIubGVuZ3RoIDwgNikge1xuICAgICAgICAgICAgcmV0dXJuIGFycjtcbiAgICAgICAgfVxuICAgICAgICB2YXIgbGVuID0gYXJyLmxlbmd0aDtcbiAgICAgICAgdmFyIHJlcyA9IGFyci5zbGljZSgwLCBNYXRoLm1pbihNYXRoLm1heChNYXRoLmZsb29yKGFyci5sZW5ndGggLyAzKSwgNyksIGFyci5sZW5ndGgpKTtcbiAgICAgICAgaWYgKHR5cGVvZiBhcnJbMF0gPT09IFwic3RyaW5nXCIpIHtcbiAgICAgICAgICAgIHZhciBkZWx0YSA9IGxlbiAtIHJlcy5sZW5ndGg7XG4gICAgICAgICAgICByZXMucHVzaChcIi4uLiBhbmQgXCIgKyBkZWx0YSArIFwiIG1vcmUgZW50cmllcyBmb3IgcmVnaXN0ZXJlZCB1c2Vyc1wiKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm4gcmVzO1xuICAgIH1cbiAgICByZXR1cm4gYXJyO1xufVxuLypcbmV4cG9ydCBjbGFzcyBTaW1wbGVSZWNvZ25pemVyIGltcGxlbWVudHMgYnVpbGRlci5JSW50ZW50UmVjb2duaXplciB7XG4gIGNvbnN0cnVjdG9yKCkge1xuXG4gIH1cblxuICByZWNvZ25pemUoY29udGV4dDogYnVpbGRlci5JUmVjb2duaXplQ29udGV4dCwgY2FsbGJhY2s6IChlcnI6IEVycm9yLCByZXN1bHQ6IGJ1aWxkZXIuSUludGVudFJlY29nbml6ZXJSZXN1bHQpID0+IHZvaWQpOiB2b2lkIHtcbiAgICB2YXIgdSA9IHt9IGFzIGJ1aWxkZXIuSUludGVudFJlY29nbml6ZXJSZXN1bHQ7XG5cbiAgICBkZWJ1Z2xvZyhcInJlY29nbml6aW5nIFwiICsgY29udGV4dC5tZXNzYWdlLnRleHQpO1xuICAgIGlmIChjb250ZXh0Lm1lc3NhZ2UudGV4dC5pbmRleE9mKFwic3RhcnRcIikgPj0gMCkge1xuICAgICAgdS5pbnRlbnQgPSBcIlNob3dFbnRpdHlcIjtcbiAgICAgIHUuc2NvcmUgPSAwLjk7XG4gICAgICB2YXIgZTEgPSB7fSBhcyBidWlsZGVyLklFbnRpdHk7XG4gICAgICBlMS5zdGFydEluZGV4ID0gXCJzdGFydCBcIi5sZW5ndGg7XG4gICAgICBlMS5lbmRJbmRleCA9IGNvbnRleHQubWVzc2FnZS50ZXh0Lmxlbmd0aDtcbiAgICAgIGUxLnNjb3JlID0gMC4zO1xuICAgICAgdS5lbnRpdGllcyA9IFtlMV07XG4gICAgICBjYWxsYmFjayh1bmRlZmluZWQsIHUpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGlmIChjb250ZXh0Lm1lc3NhZ2UudGV4dC5pbmRleE9mKFwidHJhaW5cIikgPj0gMCkge1xuICAgICAgdS5pbnRlbnQgPSBcInRyYWluXCI7XG4gICAgICB1LnNjb3JlID0gMC45O1xuICAgICAgdmFyIGUxID0ge30gYXMgYnVpbGRlci5JRW50aXR5O1xuICAgICAgZTEuc3RhcnRJbmRleCA9IFwidHJhaW4gXCIubGVuZ3RoO1xuICAgICAgZTEuZW5kSW5kZXggPSBjb250ZXh0Lm1lc3NhZ2UudGV4dC5sZW5ndGg7XG4gICAgICBlMS5zY29yZSA9IDAuMztcbiAgICAgIHUuZW50aXRpZXMgPSBbZTFdO1xuICAgICAgY2FsbGJhY2sodW5kZWZpbmVkLCB1KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGNvbnRleHQubWVzc2FnZS50ZXh0LmluZGV4T2YoXCJsZWFyblwiKSA+PSAwKSB7XG4gICAgICB1LmludGVudCA9IFwibGVhcm5cIjtcbiAgICAgIHUuc2NvcmUgPSAwLjk7XG4gICAgICB2YXIgZTEgPSB7fSBhcyBidWlsZGVyLklFbnRpdHk7XG4gICAgICBlMS50eXBlID0gXCJ0cmFpbkZhY3RcIjtcbiAgICAgIGUxLnN0YXJ0SW5kZXggPSBcInRyYWluIFwiLmxlbmd0aDtcbiAgICAgIGUxLmVuZEluZGV4ID0gY29udGV4dC5tZXNzYWdlLnRleHQubGVuZ3RoO1xuICAgICAgZTEuc2NvcmUgPSAwLjM7XG4gICAgICB1LmVudGl0aWVzID0gW2UxXTtcbiAgICAgIGNhbGxiYWNrKHVuZGVmaW5lZCwgdSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChjb250ZXh0Lm1lc3NhZ2UudGV4dC5pbmRleE9mKFwiaGVscFwiKSA+PSAwKSB7XG4gICAgICB1LmludGVudCA9IFwiaGVscFwiO1xuICAgICAgdS5zY29yZSA9IDAuOTtcbiAgICAgIHZhciBlMSA9IHt9IGFzIGJ1aWxkZXIuSUVudGl0eTtcbiAgICAgIGUxLnN0YXJ0SW5kZXggPSBcInRyYWluIFwiLmxlbmd0aDtcbiAgICAgIGUxLmVuZEluZGV4ID0gY29udGV4dC5tZXNzYWdlLnRleHQubGVuZ3RoO1xuICAgICAgZTEuc2NvcmUgPSAwLjM7XG4gICAgICB1LmVudGl0aWVzID0gW2UxXTtcbiAgICAgIGNhbGxiYWNrKHVuZGVmaW5lZCwgdSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChjb250ZXh0Lm1lc3NhZ2UudGV4dC5pbmRleE9mKFwiZXhpdFwiKSA+PSAwKSB7XG4gICAgICB1LmludGVudCA9IFwiZXhpdFwiO1xuICAgICAgdS5zY29yZSA9IDAuOTtcbiAgICAgIHZhciBlMSA9IHt9IGFzIGJ1aWxkZXIuSUVudGl0eTtcbiAgICAgIGUxLnN0YXJ0SW5kZXggPSBcImV4aXQgXCIubGVuZ3RoO1xuICAgICAgZTEuZW5kSW5kZXggPSBjb250ZXh0Lm1lc3NhZ2UudGV4dC5sZW5ndGg7XG4gICAgICBlMS5zY29yZSA9IDAuMztcbiAgICAgIHUuZW50aXRpZXMgPSBbZTFdO1xuICAgICAgY2FsbGJhY2sodW5kZWZpbmVkLCB1KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGNvbnRleHQubWVzc2FnZS50ZXh0LmluZGV4T2YoXCJ3cm9uZ1wiKSA+PSAwKSB7XG4gICAgICB1LmludGVudCA9IFwid3JvbmdcIjtcbiAgICAgIHUuc2NvcmUgPSAwLjk7XG4gICAgICB2YXIgZTEgPSB7fSBhcyBidWlsZGVyLklFbnRpdHk7XG4gICAgICBlMS5zdGFydEluZGV4ID0gXCJleGl0IFwiLmxlbmd0aDtcbiAgICAgIGUxLmVuZEluZGV4ID0gY29udGV4dC5tZXNzYWdlLnRleHQubGVuZ3RoO1xuICAgICAgZTEuc2NvcmUgPSAwLjM7XG4gICAgICB1LmVudGl0aWVzID0gW2UxXTtcbiAgICAgIGNhbGxiYWNrKHVuZGVmaW5lZCwgdSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGRlYnVnbG9nKCdyZWNvZ25pemluZyBub3RoaW5nJyk7XG4gICAgdS5pbnRlbnQgPSBcIk5vbmVcIjtcbiAgICB1LnNjb3JlID0gMC4xO1xuICAgIHZhciBlMSA9IHt9IGFzIGJ1aWxkZXIuSUVudGl0eTtcbiAgICBlMS5zdGFydEluZGV4ID0gXCJleGl0IFwiLmxlbmd0aDtcbiAgICBlMS5lbmRJbmRleCA9IGNvbnRleHQubWVzc2FnZS50ZXh0Lmxlbmd0aDtcbiAgICBlMS5zY29yZSA9IDAuMTtcbiAgICB1LmVudGl0aWVzID0gW107XG4gICAgY2FsbGJhY2sodW5kZWZpbmVkLCB1KTtcbiAgfVxufVxuKi9cbnZhciBhVHJhaW5SZXBsaWVzID0gW1wiVGhhbmsgeW91IGZvciBzaGFyaW5nIHRoaXMgc3VnZ2VzdGlvbiB3aXRoIHVzXCIsXG4gICAgXCJUaGFuayBmb3IgZm9yIHRoaXMgdmFsdWFibGUgaW5mb3JtYXRpb24uXCIsXG4gICAgXCJUaGFuayBmb3IgZm9yIHRoaXMgaW50ZXJlc3RpbmcgZmFjdCFcIixcbiAgICBcIlRoYXRzIGEgcGxldGhvcmlhIG9mIGluZm9ybWF0aW9uLlwiLFxuICAgIFwiVGhhdCdzIGEgbnVnZ2V0IG9mIGluZm9ybWF0aW9uLlwiLFxuICAgIFwiTG92ZWx5LCBJIG1heSBjb25zaWRlciB5b3UgaW5wdXQuXCIsXG4gICAgXCJXZWxsIGRvbmUsIGFueXRoaW5nIG1vcmUgdG8gbGV0IG1lIGtub3c/XCIsXG4gICAgXCJJIGRvIGFwcHJlY2lhdGUgeW91ciB0ZWFjaGluZyBhbmQgbXkgbGVhcm5pbmcgZXhwZXJpZW5jZSwgb3Igd2FzIGl0IHRoZSBvdGhlciB3YXkgcm91bmQ/XCIsXG4gICAgXCJZb3VyIGhlbHBmdWwgaW5wdXQgaGFzIGJlZW4gc3RvcmVkIGluIHNvbWUgZHVzdHkgY29ybmVyIG9mIHRoZSBXb3JsZCB3aWRlIHdlYiFcIixcbiAgICBcIlRoYW5rIHlvdSBmb3IgbXkgbGVhcm5pbmcgZXhwZXJpZW5jZSFcIixcbiAgICBcIkkgaGF2ZSBpbmNvcnBvcmF0ZWQgeW91ciB2YWx1YWJsZSBzdWdnZXN0aW9uIGluIHRoZSB3aXNkb20gb2YgdGhlIGludGVybmV0XCJcbl07XG52YXIgYVRyYWluRGlhbG9nID0gYVRyYWluUmVwbGllcztcbnZhciBhVHJhaW5FeGl0SGludCA9IFtcbiAgICBcIlxcbnR5cGUgXFxcImRvbmVcXFwiIHdoZW4geW91IGFyZSBkb25lIHRyYWluaW5nIG1lLlwiLFxuICAgIFwiXCIsXG4gICAgXCJcIixcbiAgICBcIlwiLFxuICAgIFwiXFxucmVtZW1iZXIsIHlvdSBhcmUgc3R1Y2sgaGVyZSBpbnN0cnVjdGluZyBtZSwgdHlwZSBcXFwiZG9uZVxcXCIgdG8gcmV0dXJuLlwiLFxuICAgIFwiXCJcbl07XG52YXIgYUVudGVyVHJhaW4gPSBbJ1NvIHlvdSB0aGluayB0aGlzIGlzIHdyb25nPyBZb3UgY2FuIG9mZmVyIHlvdXIgYWR2aXNlIGhlcmUuXFxuIFR5cGUgXCJkb25lXCIgaWYgeW91IGFyZSBkb25lIHdpdGggaW5zdHJ1Y3RpbmcgbWUnLFxuICAgICdGZWVsIGZyZWUgdG8gb2ZmZXIgbWUgeW91ciBiZXR0ZXIgc29sdXRpb24gaGVyZS5cXG5UeXBlIFwiZG9uZVwiIGlmIHlvdSBhcmUgZG9uZSB3aXRoIGluc3RydWN0aW5nIG1lJyxcbiAgICAnU29tZSBzYXkgXCJUaGUgc2VjcmV0IHRvIGhhcHBpbmVzcyBpcyB0byBsb3dlciB5b3VyIGV4cGVjdGF0aW9ucyB0byB0aGUgcG9pbnQgdGhleSBhcmUgYWxyZWFkeSBtZXQuXCIsIFxcbnQgaWYgeW91IGNvdWxkIGhlbHAgbWUgdG8gYmVjb21lIGJldHRlciwgaW5zdHJ1Y3QgbWUuXFxuIFR5cGUgXCJkb25lXCIgaWYgeW91IGFyZSBkb25lIHdpdGggdGVhY2hpbmcgbWUnLFxuICAgICdGZWVsIGZyZWUgdG8gb2ZmZXIgbWUgeW91ciBiZXR0ZXIgc29sdXRpb24gaGVyZS5cXG4gVHlwZSBcImRvbmVcIiBpZiB5b3UgYXJlIGRvbmUgd2l0aCBpbnN0cnVjdGluZyBtZScsXG4gICAgJ0ZlZWwgZnJlZSB0byBvZmZlciBtZSB5b3VyIGJldHRlciBzb2x1dGlvbiBoZXJlLlxcbiBUeXBlIFwiZG9uZVwiIGlmIHlvdSBhcmUgZG9uZSB3aXRoIGluc3RydWN0aW5nIG1lJyxcbl07XG52YXIgYUJhY2tGcm9tVHJhaW5pbmcgPSBbXG4gICAgJ1B1dWgsIGJhY2sgZnJvbSB0cmFpbmluZyEgTm93IGZvciB0aGUgZWFzeSBwYXJ0IC4uLlxcbiBhc2sgbWUgYSBuZXcgcXVlc3Rpb24uJyxcbiAgICAnTGl2ZSBhbmQgZG9uXFwndCBsZWFybiwgdGhhdFxcJ3MgdXMuIE5hYWgsIHdlXFwnbGwgc2VlLlxcbkFzayBtZSBhbm90aGVyIHF1ZXN0aW9uLicsXG4gICAgJ1RoZSBzZWNyZXQgdG8gaGFwcGluZXNzIGlzIHRvIGxvd2VyIHlvdXIgZXhwZWN0YXRpb25zIHRvIHRoZSBwb2ludCB0aGV5IGFyZSBhbHJlYWR5IG1ldC5cXG4gQXNrIG1lIGEgcXVlc3Rpb24uJyxcbiAgICAnVGhhbmtzIGZvciBoYXZpbmcgdGhpcyBsZWN0dXJlIHNlc3Npb24sIG5vdyBpIGFtIGJhY2sgdG8gb3VyIHVzdWFsIHNlbGYuXFxuIEFzayBtZSBhIHF1ZXN0aW9uLidcbl07XG52YXIgYVRyYWluTm9LbGluZ29uID0gW1xuICAgIFwiSGUgd2hvIG1hc3RlciB0aGUgZGFyayBhcnRzIG9mIFNBUCBtdXN0IG5vdCBkd2VsbCBpbiB0aGUgZWFydGhseSByZWFsbXMgb2YgU3RhcnQgVHJlay5cIixcbiAgICBcIlNBUCBpcyBhIGNsb3VkIGNvbXBhbnksIG5vdCBhIHNwYWNlIGNvbXBhbnkuXCIsXG4gICAgXCJUaGUgZGVwdGggb2YgUi8zIGFyZSBkZWVwZXIgdGhhbiBEZWVwIFNwYWNlIDQyLlwiLFxuICAgIFwiTXkgYnJhaW5wb3dlciBpcyBmdWxseSBhYnNvcmJlZCB3aXRoIG1hc3RlcmluZyBvdGhlciByZWFsbXMuXCIsXG4gICAgXCJGb3IgdGhlIHdvc2FwLCB0aGUgc2t5IGlzIHRoZSBsaW1pdC4gRmVlbCBmcmVlIHRvIGNoZWNrIG91dCBuYXNhLmdvdiAuXCIsXG4gICAgXCJUaGUgZnV0dXJlIGlzIFNBUCBvciBJQk0gYmx1ZSwgbm90IHNwYWNlIGJsYWNrLlwiLFxuICAgIFwiVGhhdCdzIGxlZnQgdG8gc29tZSBtdXNreSBmdXR1cmUuXCJcbl07XG5leHBvcnRzLmFSZXNwb25zZXNPblRvb0xvbmcgPSBbXG4gICAgXCJZb3VyIGlucHV0IHNob3VsZCBiZSBlbG9xdWVudCBpbiBpdCdzIGJyZXZpdHkuIFRoaXMgb25lIHdhcyB0b28gbG9uZy5cIixcbiAgICBcIm15IHdpc2RvbSBpcyBzZXZlcmx5IGJvdW5kIGJ5IG15IGxpbWl0ZWQgaW5wdXQgcHJvY2Vzc2luZyBjYXBhYmlsaXRpZXMuIENvdWxkIHlvdSBmb3JtdWxhdGUgYSBzaG9ydGVyIGlucHV0PyBUaGFuayB5b3UuXCIsXG4gICAgXCJUaGUgbGVuZ3RoIG9mIHlvdSBpbnB1dCBpbmRpY2F0ZXMgeW91IHByb2JhYmx5IGtub3cgbW9yZSBhYm91dCB0aGUgdG9waWMgdGhhbiBtZT8gQ2FuIGkgaHVtYmx5IGFzayB5b3UgdG8gZm9ybXVsYXRlIGEgc2hvcnRlciBxdWVzdGlvbj9cIixcbiAgICAnXFxcIldoYXQgZXZlciB5b3Ugd2FudCB0byB0ZWFjaCwgYmUgYnJpZWZcXFwiIChIb3JhY2UpLiBXaGlsZSB0aGlzIGRvZXMgbm90IGFsd2F5cyBhcHBsaWVzIHRvIG15IGFuc3dlcnMsIGl0IGlzIHJlcXVpcmUgZm9yIHlvdXIgcXVlc3Rpb25zLiBQbGVhc2UgdHJ5IGFnYWluIHdpdGggYSByZWZpbmVkIHF1ZXN0aW9ucy4nLFxuICAgICdJIHVuZGVyc3RhbmQgbW9yZSB0aGFuIDQtbGV0dGVyIHdvcmRzLCBidXQgbm90IG1vcmUgdGhhbiAyMCB3b3JkIHNlbnRlbmNlcy4gUGxlYXNlIHRyeSB0byBzaG9ydGVuIHlvdXIgaW5wdXQuJyxcbiAgICAndGhlIHNreSBpcyB0aGUgbGltaXQ/IEFpciBmb3JjZSBtZW1iZXIgb3Igbm90LCB5b3UgY2FuIGFzayBsb25nZXIgcXVlc3Rpb25zIHRoYW4gXFxcInRoZSBza3lcXFwiLCBidXQgbm90IHRoaXMgbG9uZycsXG4gICAgJ015IGFuc3dlcnMgbWF5IGJlIGV4aGF1c3RpdmUsIGJ1dCBJIHVuZGVyc3RhbmQgbW9yZSB0aGFuIDQtbGV0dGVyIHdvcmRzLCBidXQgbm90IG1vcmUgdGhhbiAyMCB3b3JkIHNlbnRlbmNlcy4gU29ycnkuJyxcbiAgICAnT3VyIGNvbnZlcnNhdGlvbiBtdXN0IGJlIGhpZ2hseSBhc3N5bW1ldHJpYzogbXkgYW5zd2VycyBtYXkgYmUgdmVyYm9zZSBhbmQgZXhoYXVzdGl2ZSBhbmQgZnV6enksIHF1ZXN0aW9ucyBhbmQgaW5wdXQgbXVzdCBiZSBicmllZi4gVHJ5IHRvIHJlZm9ybXVsYXRlIGl0Jyxcbl07XG5leHBvcnRzLm1ldGF3b3Jkc0Rlc2NyaXB0aW9ucyA9IHtcbiAgICBcImNhdGVnb3J5XCI6IFwiYW4gYXR0cmlidXRlIG9mIGEgcmVjb3JkIGluIGEgbW9kZWwsIGV4YW1wbGU6IGEgUGxhbmV0IGhhcyBhIFxcXCJuYW1lXFxcIiBhdHRyaWJ1dGVcIixcbiAgICBcImRvbWFpblwiOiBcImEgZ3JvdXAgb2YgZmFjdHMgd2hpY2ggYXJlIHR5cGljYWxseSB1bnJlbGF0ZWRcIixcbiAgICBcImtleVwiOiBcImFuIGF0dHJpYnV0ZSB2YWx1ZSAob2YgYSBjYXRlZ29yeSkgd2hpY2ggIGlzIHVuaXF1ZSBmb3IgdGhlIHJlY29yZFwiLFxuICAgIFwidG9vbFwiOiBcImlzIHBvdGVudGlhbHkgY29tbWFuZCB0byBleGVjdXRlXCIsXG4gICAgXCJyZWNvcmRcIjogXCJhIHNwZWNpZmljIHNldCBvZiBcXFwiZmFjdFxcXCJzIG9mIGEgZG9tYWluLCBhIFxcXCJyZWNvcmRcXFwiIGhhcyBhIHNldCBvZiBhdHRyaWJ1dGVzIHZhbHVlcyAoXFxcImZhY3RcXFwicykgb2YgdGhlIGNhdGVnb3JpZXMsIG9mdGVuIGEgcmVjb3JkIGhhcyBhIFxcXCJrZXlcXFwiXCIsXG4gICAgXCJmYWN0XCI6IFwiYSBzcGVjaWZpYyBjYXRlZ29yeSB2YWx1ZSBvZiBhIHJlY29yZCBpbiBhIGRvbWFpbiwgbWF5IGJlIGEgXFxcImtleVxcXCIgdmFsdWVcIixcbn07XG5mdW5jdGlvbiBnZXRSYW5kb21SZXN1bHQoYXJyKSB7XG4gICAgcmV0dXJuIGFycltNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBhcnIubGVuZ3RoKSAlIGFyci5sZW5ndGhdO1xufVxudmFyIFNpbXBsZVVwRG93blJlY29nbml6ZXIgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIFNpbXBsZVVwRG93blJlY29nbml6ZXIoKSB7XG4gICAgfVxuICAgIFNpbXBsZVVwRG93blJlY29nbml6ZXIucHJvdG90eXBlLnJlY29nbml6ZSA9IGZ1bmN0aW9uIChjb250ZXh0LCBjYWxsYmFjaykge1xuICAgICAgICB2YXIgdSA9IHt9O1xuICAgICAgICBkZWJ1Z2xvZyhcInJlY29nbml6aW5nIFwiICsgY29udGV4dC5tZXNzYWdlLnRleHQpO1xuICAgICAgICBpZiAoY29udGV4dC5tZXNzYWdlLnRleHQuaW5kZXhPZihcImRvd25cIikgPj0gMCkge1xuICAgICAgICAgICAgdS5pbnRlbnQgPSBcImludGVudC5kb3duXCI7XG4gICAgICAgICAgICB1LnNjb3JlID0gMC45O1xuICAgICAgICAgICAgdmFyIGUxID0ge307XG4gICAgICAgICAgICBlMS5zdGFydEluZGV4ID0gXCJzdGFydCBcIi5sZW5ndGg7XG4gICAgICAgICAgICBlMS5lbmRJbmRleCA9IGNvbnRleHQubWVzc2FnZS50ZXh0Lmxlbmd0aDtcbiAgICAgICAgICAgIGUxLnNjb3JlID0gMC4zO1xuICAgICAgICAgICAgdS5lbnRpdGllcyA9IFtlMV07XG4gICAgICAgICAgICBjYWxsYmFjayh1bmRlZmluZWQsIHUpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb250ZXh0Lm1lc3NhZ2UudGV4dC5pbmRleE9mKFwidXBcIikgPj0gMCkge1xuICAgICAgICAgICAgdS5pbnRlbnQgPSBcImludGVudC51cFwiO1xuICAgICAgICAgICAgdS5zY29yZSA9IDAuOTtcbiAgICAgICAgICAgIHZhciBlMSA9IHt9O1xuICAgICAgICAgICAgZTEuc3RhcnRJbmRleCA9IFwidXBcIi5sZW5ndGg7XG4gICAgICAgICAgICBlMS5lbmRJbmRleCA9IGNvbnRleHQubWVzc2FnZS50ZXh0Lmxlbmd0aDtcbiAgICAgICAgICAgIGUxLnNjb3JlID0gMC4zO1xuICAgICAgICAgICAgdS5lbnRpdGllcyA9IFtlMV07XG4gICAgICAgICAgICBjYWxsYmFjayh1bmRlZmluZWQsIHUpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb250ZXh0Lm1lc3NhZ2UudGV4dC5pbmRleE9mKFwiZG9uZVwiKSA+PSAwKSB7XG4gICAgICAgICAgICB1LmludGVudCA9IFwiaW50ZW50LnVwXCI7XG4gICAgICAgICAgICB1LnNjb3JlID0gMC45O1xuICAgICAgICAgICAgdmFyIGUxID0ge307XG4gICAgICAgICAgICBlMS5zdGFydEluZGV4ID0gXCJ1cFwiLmxlbmd0aDtcbiAgICAgICAgICAgIGUxLmVuZEluZGV4ID0gY29udGV4dC5tZXNzYWdlLnRleHQubGVuZ3RoO1xuICAgICAgICAgICAgZTEuc2NvcmUgPSAwLjM7XG4gICAgICAgICAgICB1LmVudGl0aWVzID0gW2UxXTtcbiAgICAgICAgICAgIGNhbGxiYWNrKHVuZGVmaW5lZCwgdSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbnRleHQubWVzc2FnZS50ZXh0LmluZGV4T2YoXCJleGl0XCIpID49IDApIHtcbiAgICAgICAgICAgIHUuaW50ZW50ID0gXCJpbnRlbnQudXBcIjtcbiAgICAgICAgICAgIHUuc2NvcmUgPSAwLjk7XG4gICAgICAgICAgICB2YXIgZTEgPSB7fTtcbiAgICAgICAgICAgIGUxLnN0YXJ0SW5kZXggPSBcInVwXCIubGVuZ3RoO1xuICAgICAgICAgICAgZTEuZW5kSW5kZXggPSBjb250ZXh0Lm1lc3NhZ2UudGV4dC5sZW5ndGg7XG4gICAgICAgICAgICBlMS5zY29yZSA9IDAuMztcbiAgICAgICAgICAgIHUuZW50aXRpZXMgPSBbZTFdO1xuICAgICAgICAgICAgY2FsbGJhY2sodW5kZWZpbmVkLCB1KTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29udGV4dC5tZXNzYWdlLnRleHQuaW5kZXhPZihcInF1aXRcIikgPj0gMCkge1xuICAgICAgICAgICAgdS5pbnRlbnQgPSBcImludGVudC51cFwiO1xuICAgICAgICAgICAgdS5zY29yZSA9IDAuOTtcbiAgICAgICAgICAgIHZhciBlMSA9IHt9O1xuICAgICAgICAgICAgZTEuc3RhcnRJbmRleCA9IFwidXBcIi5sZW5ndGg7XG4gICAgICAgICAgICBlMS5lbmRJbmRleCA9IGNvbnRleHQubWVzc2FnZS50ZXh0Lmxlbmd0aDtcbiAgICAgICAgICAgIGUxLnNjb3JlID0gMC4zO1xuICAgICAgICAgICAgdS5lbnRpdGllcyA9IFtlMV07XG4gICAgICAgICAgICBjYWxsYmFjayh1bmRlZmluZWQsIHUpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGRlYnVnbG9nKCdyZWNvZ25pemluZyBub3RoaW5nJyk7XG4gICAgICAgIHUuaW50ZW50ID0gXCJOb25lXCI7XG4gICAgICAgIHUuc2NvcmUgPSAwLjE7XG4gICAgICAgIHZhciBlMSA9IHt9O1xuICAgICAgICBlMS5zdGFydEluZGV4ID0gXCJleGl0IFwiLmxlbmd0aDtcbiAgICAgICAgZTEuZW5kSW5kZXggPSBjb250ZXh0Lm1lc3NhZ2UudGV4dC5sZW5ndGg7XG4gICAgICAgIGUxLnNjb3JlID0gMC4xO1xuICAgICAgICB1LmVudGl0aWVzID0gW107XG4gICAgICAgIGNhbGxiYWNrKHVuZGVmaW5lZCwgdSk7XG4gICAgfTtcbiAgICByZXR1cm4gU2ltcGxlVXBEb3duUmVjb2duaXplcjtcbn0oKSk7XG5leHBvcnRzLlNpbXBsZVVwRG93blJlY29nbml6ZXIgPSBTaW1wbGVVcERvd25SZWNvZ25pemVyO1xudmFyIEFueU9iamVjdCA9IE9iamVjdDtcbi8vIGdsb2JhbFR1bm5lbC5pbml0aWFsaXplKHtcbi8vICBob3N0OiAncHJveHkuZXh4eGFtcGxlLmNvbScsXG4vLyAgcG9ydDogODA4MFxuLy8gfSlcbi8vIENyZWF0ZSBib3QgYW5kIGJpbmQgdG8gY29uc29sZVxuLy8gdmFyIGNvbm5lY3RvciA9IG5ldyBodG1sY29ubmVjdG9yLkhUTUxDb25uZWN0b3IoKVxuLy8gY29ubmVjdG9yLnNldEFuc3dlckhvb2soZnVuY3Rpb24gKHNBbnN3ZXIpIHtcbi8vICBjb25zb2xlLmxvZygnR290IGFuc3dlciA6ICcgKyBzQW5zd2VyICsgJ1xcbicpXG4vLyB9KVxudmFyIGJvdDtcbi8vIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuLy8gICBjb25uZWN0b3IucHJvY2Vzc01lc3NhZ2UoJ3N0YXJ0IHVuaXQgdGVzdCBBQkMgJylcbi8vIH0sIDUwMDApXG52YXIgZnMgPSByZXF1aXJlKFwiZnNcIik7XG52YXIgb0pTT04gPSBKU09OLnBhcnNlKCcnICsgZnMucmVhZEZpbGVTeW5jKCcuL3Jlc291cmNlcy9tb2RlbC9pbnRlbnRzLmpzb24nKSk7XG52YXIgb1J1bGVzID0gUGxhaW5SZWNvZ25pemVyLnBhcnNlUnVsZXMob0pTT04pO1xuLy8gdmFyIFJlY29nbml6ZXIgPSBuZXcgKHJlY29nbml6ZXIuUmVnRXhwUmVjb2duaXplcikob1J1bGVzKTtcbmZ1bmN0aW9uIGxvZ1F1ZXJ5KHNlc3Npb24sIGludGVudCwgcmVzdWx0KSB7XG4gICAgZnMuYXBwZW5kRmlsZSgnLi9sb2dzL3Nob3dtZXF1ZXJpZXMudHh0JywgXCJcXG5cIiArIEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgdGV4dDogc2Vzc2lvbi5tZXNzYWdlLnRleHQsXG4gICAgICAgIHRpbWVzdGFtcDogc2Vzc2lvbi5tZXNzYWdlLnRpbWVzdGFtcCxcbiAgICAgICAgaW50ZW50OiBpbnRlbnQsXG4gICAgICAgIHJlczogcmVzdWx0ICYmIHJlc3VsdC5sZW5ndGggJiYgTWF0Y2guVG9vbE1hdGNoLmR1bXBOaWNlKHJlc3VsdFswXSkgfHwgXCIwXCIsXG4gICAgICAgIGNvbnZlcnNhdGlvbklkOiBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzc1xuICAgICAgICAgICAgJiYgc2Vzc2lvbi5tZXNzYWdlLmFkZHJlc3MuY29udmVyc2F0aW9uXG4gICAgICAgICAgICAmJiBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzcy5jb252ZXJzYXRpb24uaWQgfHwgXCJcIixcbiAgICAgICAgdXNlcmlkOiBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzc1xuICAgICAgICAgICAgJiYgc2Vzc2lvbi5tZXNzYWdlLmFkZHJlc3MudXNlclxuICAgICAgICAgICAgJiYgc2Vzc2lvbi5tZXNzYWdlLmFkZHJlc3MudXNlci5pZCB8fCBcIlwiXG4gICAgfSksIGZ1bmN0aW9uIChlcnIsIHJlcykge1xuICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICBkZWJ1Z2xvZyhcImxvZ2dpbmcgZmFpbGVkIFwiICsgZXJyKTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuZnVuY3Rpb24gbG9nUXVlcnlXaGF0SXMoc2Vzc2lvbiwgaW50ZW50LCByZXN1bHQpIHtcbiAgICBmcy5hcHBlbmRGaWxlKCcuL2xvZ3Mvc2hvd21lcXVlcmllcy50eHQnLCBcIlxcblwiICsgSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICB0ZXh0OiBzZXNzaW9uLm1lc3NhZ2UudGV4dCxcbiAgICAgICAgdGltZXN0YW1wOiBzZXNzaW9uLm1lc3NhZ2UudGltZXN0YW1wLFxuICAgICAgICBpbnRlbnQ6IGludGVudCxcbiAgICAgICAgcmVzOiByZXN1bHQgJiYgcmVzdWx0Lmxlbmd0aCAmJiBXaGF0SXMuZHVtcE5pY2UocmVzdWx0WzBdKSB8fCBcIjBcIixcbiAgICAgICAgY29udmVyc2F0aW9uSWQ6IHNlc3Npb24ubWVzc2FnZS5hZGRyZXNzXG4gICAgICAgICAgICAmJiBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzcy5jb252ZXJzYXRpb25cbiAgICAgICAgICAgICYmIHNlc3Npb24ubWVzc2FnZS5hZGRyZXNzLmNvbnZlcnNhdGlvbi5pZCB8fCBcIlwiLFxuICAgICAgICB1c2VyaWQ6IHNlc3Npb24ubWVzc2FnZS5hZGRyZXNzXG4gICAgICAgICAgICAmJiBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzcy51c2VyXG4gICAgICAgICAgICAmJiBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzcy51c2VyLmlkIHx8IFwiXCJcbiAgICB9KSwgZnVuY3Rpb24gKGVyciwgcmVzKSB7XG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgIGRlYnVnbG9nKFwibG9nZ2luZyBmYWlsZWQgXCIgKyBlcnIpO1xuICAgICAgICB9XG4gICAgfSk7XG59XG5mdW5jdGlvbiBsb2dRdWVyeVdoYXRJc1R1cGVsKHNlc3Npb24sIGludGVudCwgcmVzdWx0KSB7XG4gICAgZnMuYXBwZW5kRmlsZSgnLi9sb2dzL3Nob3dtZXF1ZXJpZXMudHh0JywgXCJcXG5cIiArIEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgdGV4dDogc2Vzc2lvbi5tZXNzYWdlLnRleHQsXG4gICAgICAgIHRpbWVzdGFtcDogc2Vzc2lvbi5tZXNzYWdlLnRpbWVzdGFtcCxcbiAgICAgICAgaW50ZW50OiBpbnRlbnQsXG4gICAgICAgIHJlczogcmVzdWx0ICYmIHJlc3VsdC5sZW5ndGggJiYgV2hhdElzLmR1bXBOaWNlVHVwZWwocmVzdWx0WzBdKSB8fCBcIjBcIixcbiAgICAgICAgY29udmVyc2F0aW9uSWQ6IHNlc3Npb24ubWVzc2FnZS5hZGRyZXNzXG4gICAgICAgICAgICAmJiBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzcy5jb252ZXJzYXRpb25cbiAgICAgICAgICAgICYmIHNlc3Npb24ubWVzc2FnZS5hZGRyZXNzLmNvbnZlcnNhdGlvbi5pZCB8fCBcIlwiLFxuICAgICAgICB1c2VyaWQ6IHNlc3Npb24ubWVzc2FnZS5hZGRyZXNzXG4gICAgICAgICAgICAmJiBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzcy51c2VyXG4gICAgICAgICAgICAmJiBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzcy51c2VyLmlkIHx8IFwiXCJcbiAgICB9KSwgZnVuY3Rpb24gKGVyciwgcmVzKSB7XG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgIGRlYnVnbG9nKFwibG9nZ2luZyBmYWlsZWQgXCIgKyBlcnIpO1xuICAgICAgICB9XG4gICAgfSk7XG59XG52YXIgZ3dvcmRzID0ge307XG4vKipcbiAqIENvbnN0cnVjdCBhIGJvdFxuICogQHBhcmFtIGNvbm5lY3RvciB7Q29ubmVjdG9yfSB0aGUgY29ubmVjdG9yIHRvIHVzZVxuICogSFRNTENvbm5lY3RvclxuICogb3IgY29ubmVjdG9yID0gbmV3IGJ1aWxkZXIuQ29uc29sZUNvbm5lY3RvcigpLmxpc3RlbigpXG4gKi9cbmZ1bmN0aW9uIG1ha2VCb3QoY29ubmVjdG9yLCBtb2RlbFBhdGgsIG9wdGlvbnMpIHtcbiAgICB2YXIgdCA9IERhdGUubm93KCk7XG4gICAgdmFyIHRoZU1vZGVsID0gbG9hZE1vZGVsKG1vZGVsUGF0aCk7XG4gICAgdmFyIHQgPSBEYXRlLm5vdygpIC0gdDtcbiAgICBpZiAob3B0aW9ucyAmJiBvcHRpb25zLnNob3dNb2RlbExvYWRUaW1lKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwibW9kZWwgbG9hZCB0aW1lIFwiICsgKHQpKTtcbiAgICB9XG4gICAgYm90ID0gbmV3IGJ1aWxkZXIuVW5pdmVyc2FsQm90KGNvbm5lY3Rvcik7XG4gICAgLy8gQ3JlYXRlIExVSVMgcmVjb2duaXplciB0aGF0IHBvaW50cyBhdCBvdXIgbW9kZWwgYW5kIGFkZCBpdCBhcyB0aGUgcm9vdCAnLycgZGlhbG9nIGZvciBvdXIgQ29ydGFuYSBCb3QuXG4gICAgLy8gdmFyIG1vZGVsID0gc2Vuc2l0aXZlLm1vZGVsdXJsO1xuICAgIC8vIHZhciBtb2RlbCA9ICdodHRwczovL2FwaS5wcm9qZWN0b3hmb3JkLmFpL2x1aXMvdjIuMC9hcHBzL2M0MTNiMmVmLTM4MmMtNDViZC04ZmYwLWY3NmQ2MGUyYTgyMT9zdWJzY3JpcHRpb24ta2V5PWMyMTM5OGI1OTgwYTRjZTA5ZjQ3NGJiZmVlOTNiODkyJnE9J1xuICAgIHZhciByZWNvZ25pemVyID0gbmV3IFBsYWluUmVjb2duaXplci5SZWdFeHBSZWNvZ25pemVyKG9SdWxlcyk7XG4gICAgdmFyIGRpYWxvZyA9IG5ldyBidWlsZGVyLkludGVudERpYWxvZyh7IHJlY29nbml6ZXJzOiBbcmVjb2duaXplcl0gfSk7XG4gICAgLy8gZGlhbG9nLm9uQmVnaW4oZnVuY3Rpb24oc2Vzc2lvbixhcmdzKSB7XG4gICAgLy8gY29uc29sZS5sb2coXCJiZWdpbm5pbmcgLi4uXCIpXG4gICAgLy8gc2Vzc2lvbi5kaWFsb2dEYXRhLnJldHJ5UHJvbXB0ID0gYXJncyAmJiBhcmdzLnJldHJ5UHJvbXB0IHx8IFwiSSBhbSBzb3JyeVwiXG4gICAgLy8gc2Vzc2lvbi5zZW5kKFwiV2hhdCBkbyB5b3Ugd2FudD9cIilcbiAgICAvL1xuICAgIC8vIH0pXG4gICAgdmFyIGRpYWxvZ1VwRG93biA9IG5ldyBidWlsZGVyLkludGVudERpYWxvZyh7IHJlY29nbml6ZXJzOiBbbmV3IFNpbXBsZVVwRG93blJlY29nbml6ZXIoKV0gfSk7XG4gICAgYm90LmRpYWxvZygnL3VwZG93bicsIGRpYWxvZ1VwRG93bik7XG4gICAgZGlhbG9nVXBEb3duLm9uQmVnaW4oZnVuY3Rpb24gKHNlc3Npb24pIHtcbiAgICAgICAgZGlhbG9nbG9nKFwiVHJhaW5NZVwiLCBzZXNzaW9uLCBzZW5kKGdldFJhbmRvbVJlc3VsdChhRW50ZXJUcmFpbikpKTtcbiAgICAgICAgLy9zZXNzaW9uLnNlbmQoXCJIaSB0aGVyZSwgdXBkb3duIGlzIHdhaXRpbmcgZm9yIHlvdVwiKTtcbiAgICB9KTtcbiAgICBkaWFsb2dVcERvd24ubWF0Y2hlcygnaW50ZW50LnVwJywgW1xuICAgICAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgYXJncywgbmV4dCkge1xuICAgICAgICAgICAgc2Vzc2lvbi5kaWFsb2dEYXRhLmFiYyA9IGFyZ3MgfHwge307XG4gICAgICAgICAgICBidWlsZGVyLlByb21wdHMudGV4dChzZXNzaW9uLCAneW91IHdhbnQgdG8gZXhpdCB0cmFpbmluZz8gdHlwZSBcXFwiZG9uZVxcXCIgYWdhaW4uJyk7XG4gICAgICAgIH0sXG4gICAgICAgIGZ1bmN0aW9uIChzZXNzaW9uLCByZXN1bHRzLCBuZXh0KSB7XG4gICAgICAgICAgICBzZXNzaW9uLmRpYWxvZ0RhdGEuYWJjID0gcmVzdWx0cy5yZXBvbnNlO1xuICAgICAgICAgICAgbmV4dCgpO1xuICAgICAgICB9LFxuICAgICAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgcmVzdWx0cykge1xuICAgICAgICAgICAgc2Vzc2lvbi5lbmREaWFsb2dXaXRoUmVzdWx0KHsgcmVzcG9uc2U6IHNlc3Npb24uZGlhbG9nRGF0YS5hYmMgfSk7XG4gICAgICAgIH1cbiAgICBdKTtcbiAgICBkaWFsb2dVcERvd24ubWF0Y2hlcygnaW50ZW50LmRvd24nLCBbXG4gICAgICAgIGZ1bmN0aW9uIChzZXNzaW9uLCBhcmdzLCBuZXh0KSB7XG4gICAgICAgICAgICBzZXNzaW9uLmRpYWxvZ0RhdGEuYWJjID0gYXJncyB8fCB7fTtcbiAgICAgICAgICAgIGJ1aWxkZXIuUHJvbXB0cy50ZXh0KHNlc3Npb24sICd5b3Ugd2FudCB0byBnbyBkb3duIScpO1xuICAgICAgICB9LFxuICAgICAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgcmVzdWx0cywgbmV4dCkge1xuICAgICAgICAgICAgc2Vzc2lvbi5kaWFsb2dEYXRhLmFiYyA9IC0xOyAvLyByZXN1bHRzLnJlcG9uc2U7XG4gICAgICAgICAgICBuZXh0KCk7XG4gICAgICAgIH0sXG4gICAgICAgIGZ1bmN0aW9uIChzZXNzaW9uLCByZXN1bHRzKSB7XG4gICAgICAgICAgICBzZXNzaW9uLnNlbmQoXCJzdGlsbCBnb2luZyBkb3duP1wiKTtcbiAgICAgICAgfVxuICAgIF0pO1xuICAgIGRpYWxvZ1VwRG93bi5vbkRlZmF1bHQoZnVuY3Rpb24gKHNlc3Npb24pIHtcbiAgICAgICAgbG9nUXVlcnkoc2Vzc2lvbiwgXCJvbkRlZmF1bHRcIik7XG4gICAgICAgIHZhciByZXMgPSBnZXRSYW5kb21SZXN1bHQoYVRyYWluRGlhbG9nKSArIGdldFJhbmRvbVJlc3VsdChhVHJhaW5FeGl0SGludCk7XG4gICAgICAgIGRpYWxvZ2xvZyhcIlRyYWluTWVcIiwgc2Vzc2lvbiwgc2VuZChyZXMpKTtcbiAgICB9KTtcbiAgICBib3QuZGlhbG9nKCcvdHJhaW4nLCBbXG4gICAgICAgIGZ1bmN0aW9uIChzZXNzaW9uLCBhcmdzLCBuZXh0KSB7XG4gICAgICAgICAgICBzZXNzaW9uLmRpYWxnb0RhdGEuYWJjID0gYXJncyB8fCB7fTtcbiAgICAgICAgICAgIGJ1aWxkZXIuUHJvbXB0cy50ZXh0KHNlc3Npb24sICdEbyB5b3Ugd2FudCB0byB0cmFpbiBtZScpO1xuICAgICAgICB9LFxuICAgICAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgcmVzdWx0cywgbmV4dCkge1xuICAgICAgICAgICAgc2Vzc2lvbi5kaWFsb2dEYXRhLmFiYyA9IHJlc3VsdHMucmVwb25zZTtcbiAgICAgICAgfSxcbiAgICAgICAgZnVuY3Rpb24gKHNlc3Npb24sIHJlc3VsdHMpIHtcbiAgICAgICAgICAgIHNlc3Npb24uZW5kRGlhbG9nV2l0aFJlc3VsdCh7IHJlc3BvbnNlOiBzZXNzaW9uLkRpYWxvZ0RhdGEuYWJjIH0pO1xuICAgICAgICB9XG4gICAgXSk7XG4gICAgYm90LmRpYWxvZygnLycsIGRpYWxvZyk7XG4gICAgZGlhbG9nLm1hdGNoZXMoJ1Nob3dNZScsIFtcbiAgICAgICAgZnVuY3Rpb24gKHNlc3Npb24sIGFyZ3MsIG5leHQpIHtcbiAgICAgICAgICAgIHZhciBpc0NvbWJpbmVkSW5kZXggPSB7fTtcbiAgICAgICAgICAgIHZhciBvTmV3RW50aXR5O1xuICAgICAgICAgICAgLy8gZXhwZWN0aW5nIGVudGl0eSBBMVxuICAgICAgICAgICAgZGVidWdsb2coXCJTaG93IEVudGl0eVwiKTtcbiAgICAgICAgICAgIGRlYnVnbG9nKCdyYXc6ICcgKyBKU09OLnN0cmluZ2lmeShhcmdzLmVudGl0aWVzKSwgdW5kZWZpbmVkLCAyKTtcbiAgICAgICAgICAgIHZhciBhMSA9IGJ1aWxkZXIuRW50aXR5UmVjb2duaXplci5maW5kRW50aXR5KGFyZ3MuZW50aXRpZXMsICdBMScpO1xuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IEFuYWx5emUuYW5hbHl6ZUFsbChhMS5lbnRpdHksIHRoZU1vZGVsLnJ1bGVzLCB0aGVNb2RlbC50b29scywgZ3dvcmRzKTtcbiAgICAgICAgICAgIGxvZ1F1ZXJ5KHNlc3Npb24sICdTaG93TWUnLCByZXN1bHQpO1xuICAgICAgICAgICAgLy8gdGVzdC5leHBlY3QoMylcbiAgICAgICAgICAgIC8vICB0ZXN0LmRlZXBFcXVhbChyZXN1bHQud2VpZ2h0LCAxMjAsICdjb3JyZWN0IHdlaWdodCcpO1xuICAgICAgICAgICAgaWYgKCFyZXN1bHQgfHwgcmVzdWx0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIG5leHQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIGRlYnVnbG9nKCdyZXN1bHQgOiAnICsgSlNPTi5zdHJpbmdpZnkocmVzdWx0LCB1bmRlZmluZWQsIDIpKTtcbiAgICAgICAgICAgIGRlYnVnbG9nKCdiZXN0IHJlc3VsdCA6ICcgKyBKU09OLnN0cmluZ2lmeShyZXN1bHRbMF0gfHwge30sIHVuZGVmaW5lZCwgMikpO1xuICAgICAgICAgICAgZGVidWdsb2coJ3RvcCA6ICcgKyBNYXRjaC5Ub29sTWF0Y2guZHVtcFdlaWdodHNUb3AocmVzdWx0LCB7IHRvcDogMyB9KSk7XG4gICAgICAgICAgICBpZiAoQW5hbHl6ZS5pc0NvbXBsZXRlKHJlc3VsdFswXSkpIHtcbiAgICAgICAgICAgICAgICBzZXNzaW9uLmRpYWxvZ0RhdGEucmVzdWx0ID0gcmVzdWx0WzBdO1xuICAgICAgICAgICAgICAgIC8vICAgIHNlc3Npb24uc2VuZCgnU2hvd2luZyBlbnRpdHkgLi4uJyk7XG4gICAgICAgICAgICAgICAgbmV4dCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoQW5hbHl6ZS5nZXRQcm9tcHQocmVzdWx0WzBdKSkge1xuICAgICAgICAgICAgICAgIHZhciBwcm9tcHQgPSBBbmFseXplLmdldFByb21wdChyZXN1bHRbMF0pO1xuICAgICAgICAgICAgICAgIHNlc3Npb24uZGlhbG9nRGF0YS5yZXN1bHQgPSByZXN1bHRbMF07XG4gICAgICAgICAgICAgICAgc2Vzc2lvbi5kaWFsb2dEYXRhLnByb21wdCA9IHByb21wdDtcbiAgICAgICAgICAgICAgICBkaWFsb2dsb2coXCJTaG93TWVcIiwgc2Vzc2lvbiwgc2VuZChcIk5vdCBlbm91Z2ggaW5mb3JtYXRpb24gc3VwcGxpZWQ6IFwiICsgTWF0Y2guVG9vbE1hdGNoLmR1bXBOaWNlKHNlc3Npb24uZGlhbG9nRGF0YS5yZXN1bHQpKSk7XG4gICAgICAgICAgICAgICAgYnVpbGRlci5Qcm9tcHRzLnRleHQoc2Vzc2lvbiwgcHJvbXB0LnRleHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFyIGJlc3QgPSByZXN1bHQubGVuZ3RoID8gTWF0Y2guVG9vbE1hdGNoLmR1bXBOaWNlKHJlc3VsdFswXSkgOiBcIjxub3RoaW5nPlwiO1xuICAgICAgICAgICAgICAgIGRpYWxvZ2xvZyhcIlNob3dNZVwiLCBzZXNzaW9uLCBzZW5kKCdJIGRpZCBub3QgdW5kZXJzdGFuZCB0aGlzJyArIGJlc3QpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZnVuY3Rpb24gKHNlc3Npb24sIHJlc3VsdHMsIG5leHQpIHtcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSBzZXNzaW9uLmRpYWxvZ0RhdGEucmVzdWx0O1xuICAgICAgICAgICAgaWYgKCFyZXN1bHQgfHwgcmVzdWx0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIG5leHQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChyZXN1bHRzLnJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgLy8gc29tZSBwcm9tcHRpbmdcbiAgICAgICAgICAgICAgICBBbmFseXplLnNldFByb21wdChzZXNzaW9uLmRpYWxvZ0RhdGEucmVzdWx0LCBzZXNzaW9uLmRpYWxvZ0RhdGEucHJvbXB0LCByZXN1bHRzLnJlc3BvbnNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChBbmFseXplLmlzQ29tcGxldGUoc2Vzc2lvbi5kaWFsb2dEYXRhLnJlc3VsdCkpIHtcbiAgICAgICAgICAgICAgICBuZXh0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChBbmFseXplLmdldFByb21wdChzZXNzaW9uLmRpYWxvZ0RhdGEucmVzdWx0KSkge1xuICAgICAgICAgICAgICAgIHZhciBwcm9tcHQgPSBBbmFseXplLmdldFByb21wdChzZXNzaW9uLmRpYWxvZ0RhdGEucmVzdWx0KTtcbiAgICAgICAgICAgICAgICBzZXNzaW9uLmRpYWxvZ0RhdGEucHJvbXB0ID0gcHJvbXB0O1xuICAgICAgICAgICAgICAgIGJ1aWxkZXIuUHJvbXB0cy50ZXh0KHNlc3Npb24sIHByb21wdC50ZXh0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZnVuY3Rpb24gKHNlc3Npb24sIHJlc3VsdHMsIG5leHQpIHtcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSBzZXNzaW9uLmRpYWxvZ0RhdGEucmVzdWx0O1xuICAgICAgICAgICAgaWYgKHJlc3VsdHMucmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAvLyBzb21lIHByb21wdGluZ1xuICAgICAgICAgICAgICAgIEFuYWx5emUuc2V0UHJvbXB0KHNlc3Npb24uZGlhbG9nRGF0YS5yZXN1bHQsIHNlc3Npb24uZGlhbG9nRGF0YS5wcm9tcHQsIHJlc3VsdHMucmVzcG9uc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKEFuYWx5emUuaXNDb21wbGV0ZShzZXNzaW9uLmRpYWxvZ0RhdGEucmVzdWx0KSkge1xuICAgICAgICAgICAgICAgIHZhciBleGVjID0gRXhlY1NlcnZlci5leGVjVG9vbChzZXNzaW9uLmRpYWxvZ0RhdGEucmVzdWx0LCB0aGVNb2RlbC5yZWNvcmRzKTtcbiAgICAgICAgICAgICAgICB2YXIgcmVwbHkgPSBuZXcgYnVpbGRlci5NZXNzYWdlKHNlc3Npb24pXG4gICAgICAgICAgICAgICAgICAgIC50ZXh0KGV4ZWMudGV4dClcbiAgICAgICAgICAgICAgICAgICAgLmFkZEVudGl0eShleGVjLmFjdGlvbik7XG4gICAgICAgICAgICAgICAgLy8gLmFkZEF0dGFjaG1lbnQoeyBmYWxsYmFja1RleHQ6IFwiSSBkb24ndCBrbm93XCIsIGNvbnRlbnRUeXBlOiAnaW1hZ2UvanBlZycsIGNvbnRlbnRVcmw6IFwid3d3LndvbWJhdC5vcmdcIiB9KTtcbiAgICAgICAgICAgICAgICBkaWFsb2dsb2coXCJTaG93TWVcIiwgc2Vzc2lvbiwgc2VuZChyZXBseSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKHNlc3Npb24uZGlhbG9nRGF0YS5yZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiU2hvd01lXCIsIHNlc3Npb24sIHNlbmQoXCJOb3QgZW5vdWdoIGluZm9ybWF0aW9uIHN1cHBsaWVkOiBcIiArIE1hdGNoLlRvb2xNYXRjaC5kdW1wTmljZShzZXNzaW9uLmRpYWxvZ0RhdGEucmVzdWx0KSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiU2hvd01lXCIsIHNlc3Npb24sIHNlbmQoXCJJIGRpZCBub3QgZ2V0IHdoYXQgeW91IHdhbnRcIikpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICBdKTtcbiAgICBkaWFsb2cubWF0Y2hlcygnV2hhdElzJywgW1xuICAgICAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgYXJncywgbmV4dCkge1xuICAgICAgICAgICAgdmFyIGlzQ29tYmluZWRJbmRleCA9IHt9O1xuICAgICAgICAgICAgdmFyIG9OZXdFbnRpdHk7XG4gICAgICAgICAgICAvLyBleHBlY3RpbmcgZW50aXR5IEExXG4gICAgICAgICAgICB2YXIgbWVzc2FnZSA9IHNlc3Npb24ubWVzc2FnZS50ZXh0O1xuICAgICAgICAgICAgZGVidWdsb2coXCJXaGF0SXMgRW50aXRpZXNcIik7XG4gICAgICAgICAgICBkZWJ1Z2xvZyhkZWJ1Z2xvZy5lbmFibGVkID8gKCdyYXc6ICcgKyBKU09OLnN0cmluZ2lmeShhcmdzLmVudGl0aWVzLCB1bmRlZmluZWQsIDIpKSA6ICctJyk7XG4gICAgICAgICAgICB2YXIgY2F0ZWdvcnlFbnRpdHkgPSBidWlsZGVyLkVudGl0eVJlY29nbml6ZXIuZmluZEVudGl0eShhcmdzLmVudGl0aWVzLCAnY2F0ZWdvcnknKTtcbiAgICAgICAgICAgIHZhciBjYXRlZ29yeSA9IGNhdGVnb3J5RW50aXR5LmVudGl0eTtcbiAgICAgICAgICAgIHZhciBhMSA9IGJ1aWxkZXIuRW50aXR5UmVjb2duaXplci5maW5kRW50aXR5KGFyZ3MuZW50aXRpZXMsICdBMScpO1xuICAgICAgICAgICAgdmFyIGNhdHMgPSBbXTtcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgY2F0cyA9IFdoYXRJcy5hbmFseXplQ2F0ZWdvcnlNdWx0T25seUFuZENvbW1hKGNhdGVnb3J5LCB0aGVNb2RlbC5ydWxlcywgbWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgZGVidWdsb2coXCJoZXJlIGNhdHNcIiArIGNhdHMuam9pbihcIixcIikpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICBpZiAoZSkge1xuICAgICAgICAgICAgICAgICAgICBkZWJ1Z2xvZyhcImhlcmUgZXhjZXB0aW9uXCIgKyBlKTtcbiAgICAgICAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiV2hhdElzXCIsIHNlc3Npb24sIHNlbmQoJ0kgZG9uXFwndCBrbm93IGFueXRoaW5nIGFib3V0IFwiJyArIGNhdGVnb3J5ICtcbiAgICAgICAgICAgICAgICAgICAgICAgIChlID8gJygnICsgZS50b1N0cmluZygpICsgJyknIDogXCJcIikpKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gbmV4dCgpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGNhdCA9IHVuZGVmaW5lZDtcbiAgICAgICAgICAgIC8vIHdlIGhhdmUgc29tZSBjYXRzLCAob3IgYXQgbGVhc3Qgb25lKVxuICAgICAgICAgICAgaWYgKGNhdHMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICAgICAgY2F0ID0gY2F0c1swXTtcbiAgICAgICAgICAgICAgICBpZiAoIWNhdCkge1xuICAgICAgICAgICAgICAgICAgICBzZXNzaW9uLnNlbmQoJ0kgZG9uXFwndCBrbm93IGFueXRoaW5nIGFib3V0IFwiJyArIGNhdGVnb3J5ICsgJ1wiJyk7XG4gICAgICAgICAgICAgICAgICAgIC8vIG5leHQoKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChjYXRzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgICAgIGRlYnVnbG9nKCdjYXRlZ29yeSBpZGVudGlmaWVkOicgKyBjYXQpO1xuICAgICAgICAgICAgICAgIHZhciByZXN1bHQgPSBXaGF0SXMucmVzb2x2ZUNhdGVnb3J5KGNhdCwgYTEuZW50aXR5LCB0aGVNb2RlbC5ydWxlcywgdGhlTW9kZWwucmVjb3Jkcyk7XG4gICAgICAgICAgICAgICAgZGVidWdsb2coZGVidWdsb2cuZW5hYmxlZCA/ICgnd2hhdGlzIHJlc3VsdDonICsgSlNPTi5zdHJpbmdpZnkocmVzdWx0KSkgOiAnLScpO1xuICAgICAgICAgICAgICAgIGxvZ1F1ZXJ5V2hhdElzKHNlc3Npb24sICdXaGF0SXMnLCByZXN1bHQuYW5zd2Vycyk7XG4gICAgICAgICAgICAgICAgdmFyIGluZGlzID0gV2hhdElzLmlzSW5kaXNjcmltaW5hdGVSZXN1bHQocmVzdWx0LmFuc3dlcnMpO1xuICAgICAgICAgICAgICAgIGlmIChpbmRpcykge1xuICAgICAgICAgICAgICAgICAgICBzZXNzaW9uLnNlbmQoaW5kaXMpO1xuICAgICAgICAgICAgICAgICAgICAvLyBuZXh0KCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCFyZXN1bHQgfHwgcmVzdWx0LmFuc3dlcnMubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBleHBsYWluID0gJyc7XG4gICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQuZXJyb3JzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZXhwbGFpbiA9IEVyRXJyb3IuZXhwbGFpbkVycm9yKHJlc3VsdC5lcnJvcnMpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGRpYWxvZ2xvZyhcIldoYXRJc1wiLCBzZXNzaW9uLCBzZW5kKCdJIGRvblxcJ3Qga25vdyBhbnl0aGluZyBhYm91dCBcIicgKyBjYXQgKyBcIiAoXCIgKyBjYXRlZ29yeSArICcpXFxcIiBpbiByZWxhdGlvbiB0byBcIicgKyBhMS5lbnRpdHkgKyAoXCJcXFwiLlwiICsgZXhwbGFpbikpKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gbmV4dCgpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyBkZWJ1Z2xvZygncmVzdWx0IDogJyArIEpTT04uc3RyaW5naWZ5KHJlc3VsdCwgdW5kZWZpbmVkLCAyKSk7XG4gICAgICAgICAgICAgICAgICAgIGRlYnVnbG9nKGRlYnVnbG9nLmVuYWJsZWQgPyAoJ2Jlc3QgcmVzdWx0IDogJyArIEpTT04uc3RyaW5naWZ5KHJlc3VsdC5hbnN3ZXJzWzBdIHx8IHt9LCB1bmRlZmluZWQsIDIpKSA6ICctJyk7XG4gICAgICAgICAgICAgICAgICAgIGRlYnVnbG9nKGRlYnVnbG9nLmVuYWJsZWQgPyAoJ3RvcCA6ICcgKyBXaGF0SXMuZHVtcFdlaWdodHNUb3AocmVzdWx0LmFuc3dlcnMsIHsgdG9wOiAzIH0pKSA6ICctJyk7XG4gICAgICAgICAgICAgICAgICAgIC8vIFRPRE8gY2xlYW5zZWQgc2VudGVuY2VcbiAgICAgICAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiV2hhdElzXCIsIHNlc3Npb24sIHNlbmQoJ1RoZSAnICsgY2F0ZWdvcnkgKyAnIG9mICcgKyBhMS5lbnRpdHkgKyAnIGlzICcgKyByZXN1bHQuYW5zd2Vyc1swXS5yZXN1bHQgKyBcIlxcblwiKSk7IC8vICArIEpTT04uc3RyaW5naWZ5KHJlc3VsdFswXSkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0gLy8gc2luZ2xlIGNhdGVnb3J5XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBkZWJ1Z2xvZygnY2F0ZWdvcmllcyBpZGVudGlmaWVkOicgKyBjYXRzLmpvaW4oXCIsXCIpKTtcbiAgICAgICAgICAgICAgICB2YXIgcmVzdWx0QXJyID0gV2hhdElzLnJlc29sdmVDYXRlZ29yaWVzKGNhdHMsIGExLmVudGl0eSwgdGhlTW9kZWwpO1xuICAgICAgICAgICAgICAgIGRlYnVnbG9nKGRlYnVnbG9nLmVuYWJsZWQgPyAoJ211bHN0IHdoYXRpcyByZXN1bHQ6JyArIEpTT04uc3RyaW5naWZ5KHJlc3VsdEFycikpIDogJy0nKTtcbiAgICAgICAgICAgICAgICBsb2dRdWVyeVdoYXRJc1R1cGVsKHNlc3Npb24sICdXaGF0SXMnLCByZXN1bHRBcnIudHVwZWxhbnN3ZXJzKTtcbiAgICAgICAgICAgICAgICB2YXIgaW5kaXMgPSBXaGF0SXMuaXNJbmRpc2NyaW1pbmF0ZVJlc3VsdFR1cGVsKHJlc3VsdEFyci50dXBlbGFuc3dlcnMpO1xuICAgICAgICAgICAgICAgIGlmIChpbmRpcykge1xuICAgICAgICAgICAgICAgICAgICBzZXNzaW9uLnNlbmQoaW5kaXMpO1xuICAgICAgICAgICAgICAgICAgICAvLyBuZXh0KCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCFyZXN1bHRBcnIgfHwgIXJlc3VsdEFyci50dXBlbGFuc3dlcnMgfHwgcmVzdWx0QXJyLnR1cGVsYW5zd2Vycy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGV4cGxhaW4gPSAnJztcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdEFyci5lcnJvcnMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBleHBsYWluID0gRXJFcnJvci5leHBsYWluRXJyb3IocmVzdWx0QXJyLmVycm9ycyk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiV2hhdElzXCIsIHNlc3Npb24sIHNlbmQoJ0kgZG9uXFwndCBrbm93IGFueXRoaW5nIGFib3V0IFwiJyArIGNhdGVnb3J5ICsgXCJcXFwiIChcIiArIFV0aWxzLmxpc3RUb1F1b3RlZENvbW1hQW5kKGNhdHMpICsgJylcXFwiIGluIHJlbGF0aW9uIHRvIFwiJyArIGExLmVudGl0eSArIChcIlxcXCJcIiArIGV4cGxhaW4pKSk7XG4gICAgICAgICAgICAgICAgICAgIC8vIG5leHQoKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgLy8gZGVidWdsb2coJ3Jlc3VsdCA6ICcgKyBKU09OLnN0cmluZ2lmeShyZXN1bHQsIHVuZGVmaW5lZCwgMikpO1xuICAgICAgICAgICAgICAgICAgICBkZWJ1Z2xvZyhkZWJ1Z2xvZy5lbmFibGVkID8gKCdiZXN0IHJlc3VsdCA6ICcgKyBKU09OLnN0cmluZ2lmeShyZXN1bHRBcnIudHVwZWxhbnN3ZXJzWzBdIHx8IHt9LCB1bmRlZmluZWQsIDIpKSA6ICctJyk7XG4gICAgICAgICAgICAgICAgICAgIC8vZGVidWdsb2coJ3RvcCA6ICcgKyBXaGF0SXMuZHVtcFdlaWdodHNUb3AocmVzdWx0QXJyLCB7IHRvcDogMyB9KSk7XG4gICAgICAgICAgICAgICAgICAgIC8vIFRPRE8gY2xlYW5zZWQgc2VudGVuY2VcbiAgICAgICAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiV2hhdElzXCIsIHNlc3Npb24sIHNlbmQoJ1RoZSAnICsgVXRpbHMubGlzdFRvUXVvdGVkQ29tbWFBbmQoY2F0cykgKyAnIG9mICcgKyBhMS5lbnRpdHkgKyAnIGFyZSAnICsgVXRpbHMubGlzdFRvUXVvdGVkQ29tbWFBbmQocmVzdWx0QXJyLnR1cGVsYW5zd2Vyc1swXS5yZXN1bHQpICsgJ1xcbicpKTsgLy8gICsgSlNPTi5zdHJpbmdpZnkocmVzdWx0WzBdKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSAvL2VuZGlmIG11bHRpcGxlIGNhdGVnb3JpZXNcbiAgICAgICAgfVxuICAgIF0pO1xuICAgIGRpYWxvZy5tYXRjaGVzKCdMaXN0QWxsJywgW1xuICAgICAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgYXJncywgbmV4dCkge1xuICAgICAgICAgICAgdmFyIGlzQ29tYmluZWRJbmRleCA9IHt9O1xuICAgICAgICAgICAgdmFyIG9OZXdFbnRpdHk7XG4gICAgICAgICAgICAvLyBleHBlY3RpbmcgZW50aXR5IEExXG4gICAgICAgICAgICB2YXIgbWVzc2FnZSA9IHNlc3Npb24ubWVzc2FnZS50ZXh0O1xuICAgICAgICAgICAgZGVidWdsb2coXCJJbnRlbnQgOiBMaXN0QWxsXCIpO1xuICAgICAgICAgICAgZGVidWdsb2coZGVidWdsb2cuZW5hYmxlZCA/ICgncmF3OiAnICsgSlNPTi5zdHJpbmdpZnkoYXJncy5lbnRpdGllcywgdW5kZWZpbmVkLCAyKSkgOiAnLScpO1xuICAgICAgICAgICAgdmFyIGNhdGVnb3J5RW50aXR5ID0gYnVpbGRlci5FbnRpdHlSZWNvZ25pemVyLmZpbmRFbnRpdHkoYXJncy5lbnRpdGllcywgJ2NhdGVnb3JpZXMnKTtcbiAgICAgICAgICAgIHZhciBjYXRlZ29yeSA9IGNhdGVnb3J5RW50aXR5LmVudGl0eTtcbiAgICAgICAgICAgIHZhciBpblN0aEVudGl0eSA9IGJ1aWxkZXIuRW50aXR5UmVjb2duaXplci5maW5kRW50aXR5KGFyZ3MuZW50aXRpZXMsICdpbnN0aCcpO1xuICAgICAgICAgICAgdmFyIGluU29tZXRoaW5nID0gaW5TdGhFbnRpdHkgJiYgaW5TdGhFbnRpdHkuZW50aXR5O1xuICAgICAgICAgICAgLy8gc29tZSBtZXRhcXVlcmllczpcbiAgICAgICAgICAgIGlmIChjYXRlZ29yeSA9PT0gXCJjYXRlZ29yaWVzXCIpIHtcbiAgICAgICAgICAgICAgICAvLyBkbyB3ZSBoYXZlIGEgZmlsdGVyID9cbiAgICAgICAgICAgICAgICB2YXIgZG9tYWluID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgIGlmIChpblNvbWV0aGluZykge1xuICAgICAgICAgICAgICAgICAgICBkb21haW4gPSBMaXN0QWxsLmluZmVyRG9tYWluKHRoZU1vZGVsLCBpblNvbWV0aGluZyk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmICghZG9tYWluKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciByZXMgPSByZXN0cmljdExvZ2dlZE9uKHNlc3Npb24sIHRoZU1vZGVsLmNhdGVnb3J5KS5qb2luKFwiO1xcblwiKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGluU29tZXRoaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsXCIsIHNlc3Npb24sIHNlbmQoXCJJIGRpZCBub3QgaW5mZXIgYSBkb21haW4gcmVzdHJpY3Rpb24gZnJvbSBcXFwiXCIgKyBVdGlscy5zdHJpcFF1b3RlcyhpblNvbWV0aGluZykgKyBcIlxcXCIsIGFsbCBteSBjYXRlZ29yaWVzIGFyZSAuLi5cXG5cIiArIHJlcykpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbFwiLCBzZXNzaW9uLCBzZW5kKFwibXkgY2F0ZWdvcmllcyBhcmUgLi4uXFxuXCIgKyByZXMpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB2YXIgYVJlcyA9IE1vZGVsLmdldENhdGVnb3JpZXNGb3JEb21haW4odGhlTW9kZWwsIGRvbWFpbik7XG4gICAgICAgICAgICAgICAgICAgIHZhciByZXMgPSByZXN0cmljdExvZ2dlZE9uKHNlc3Npb24sIGFSZXMpLmpvaW4oXCI7XFxuXCIpO1xuICAgICAgICAgICAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsXCIsIHNlc3Npb24sIHNlbmQoXCJteSBjYXRlZ29yaWVzIGluIGRvbWFpbiBcXFwiXCIgKyBkb21haW4gKyBcIlxcXCIgYXJlIC4uLlxcblwiICsgcmVzKSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoY2F0ZWdvcnkgPT09IFwiZG9tYWluc1wiKSB7XG4gICAgICAgICAgICAgICAgdmFyIHJlcyA9IHJlc3RyaWN0TG9nZ2VkT24oc2Vzc2lvbiwgdGhlTW9kZWwuZG9tYWlucykuam9pbihcIjtcXG5cIik7XG4gICAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbFwiLCBzZXNzaW9uLCBzZW5kKFwibXkgZG9tYWlucyBhcmUgLi4uXFxuXCIgKyByZXMpKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoY2F0ZWdvcnkgPT09IFwidG9vbHNcIikge1xuICAgICAgICAgICAgICAgIHZhciByZXMgPSByZXN0cmljdExvZ2dlZE9uKHNlc3Npb24sIHRoZU1vZGVsLnRvb2xzKS5tYXAoZnVuY3Rpb24gKG9Ub29sKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvVG9vbC5uYW1lO1xuICAgICAgICAgICAgICAgIH0pLmpvaW4oXCI7XFxuXCIpO1xuICAgICAgICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxcIiwgc2Vzc2lvbiwgc2VuZChcIm15IHRvb2xzIGFyZSAuLi5cXG5cIiArIHJlcykpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBjYXRzID0gW107XG4gICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgIGNhdHMgPSBXaGF0SXMuYW5hbHl6ZUNhdGVnb3J5TXVsdE9ubHlBbmRDb21tYShjYXRlZ29yeSwgdGhlTW9kZWwucnVsZXMsIG1lc3NhZ2UpO1xuICAgICAgICAgICAgICAgIGRlYnVnbG9nKFwiaGVyZSBjYXRzXCIgKyBjYXRzLmpvaW4oXCIsXCIpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgaWYgKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgZGVidWdsb2coXCJoZXJlIGV4Y2VwdGlvblwiICsgZSk7XG4gICAgICAgICAgICAgICAgICAgIGRpYWxvZ2xvZyhcIldoYXRJc1wiLCBzZXNzaW9uLCBzZW5kKCdJIGRvblxcJ3Qga25vdyBhbnl0aGluZyBhYm91dCBcIicgKyBjYXRlZ29yeSArICdcIignICsgZS50b1N0cmluZygpICsgJyknKSk7XG4gICAgICAgICAgICAgICAgICAgIC8vIG5leHQoKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghY2F0cyB8fCAoY2F0cy5sZW5ndGggPT09IDApKSB7XG4gICAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbFwiLCBzZXNzaW9uLCBzZW5kKCdJIGRvblxcJ3Qga25vdyBhbnl0aGluZyBhYm91dCBcIicgKyBjYXRlZ29yeSArICdcIicpKTtcbiAgICAgICAgICAgICAgICAvLyBuZXh0KCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGNhdCA9IFwiXCI7XG4gICAgICAgICAgICBpZiAoY2F0cy5sZW5ndGggPT09IDEpIHtcbiAgICAgICAgICAgICAgICBjYXQgPSBjYXRzWzBdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGNhdHMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICAgICAgZGVidWdsb2coJ3NpbmdsZSBjYXRlZ29yeSBpZGVudGlmaWVkOicgKyBjYXQpO1xuICAgICAgICAgICAgICAgIGlmIChpblNvbWV0aGluZykge1xuICAgICAgICAgICAgICAgICAgICBkZWJ1Z2xvZygnZ290IGZpbHRlcjonICsgaW5Tb21ldGhpbmcpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgY2F0ZWdvcnlTZXQgPSBNb2RlbC5nZXRBbGxSZWNvcmRDYXRlZ29yaWVzRm9yVGFyZ2V0Q2F0ZWdvcnkodGhlTW9kZWwsIGNhdCwgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIHZhciByZXN1bHQxID0gTGlzdEFsbC5saXN0QWxsV2l0aENvbnRleHQoY2F0LCBpblNvbWV0aGluZywgdGhlTW9kZWwucnVsZXMsIHRoZU1vZGVsLnJlY29yZHMsIGNhdGVnb3J5U2V0KTtcbiAgICAgICAgICAgICAgICAgICAgLy8gVE9ETyBjbGFzc2lmeWluZyB0aGUgc3RyaW5nIHR3aWNlIGlzIGEgdGVycmlibGUgd2FzdGVcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFyZXN1bHQxLmFuc3dlcnMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWJ1Z2xvZygnZ29pbmcgZm9yIGhhdmluZycpO1xuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGNhdGVnb3J5U2V0RnVsbCA9IE1vZGVsLmdldEFsbFJlY29yZENhdGVnb3JpZXNGb3JUYXJnZXRDYXRlZ29yeSh0aGVNb2RlbCwgY2F0LCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXN1bHQxID0gTGlzdEFsbC5saXN0QWxsSGF2aW5nQ29udGV4dChjYXQsIGluU29tZXRoaW5nLCB0aGVNb2RlbC5ydWxlcywgdGhlTW9kZWwucmVjb3JkcywgY2F0ZWdvcnlTZXRGdWxsKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBkZWJ1Z2xvZyhkZWJ1Z2xvZyA/ICgnbGlzdGFsbCByZXN1bHQgPjonICsgSlNPTi5zdHJpbmdpZnkocmVzdWx0MSkpIDogJy0nKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIGpvaW5yZXN1bHRzID0gcmVzdHJpY3RMb2dnZWRPbihzZXNzaW9uLCBMaXN0QWxsLmpvaW5SZXN1bHRzKHJlc3VsdDEuYW5zd2VycykpO1xuICAgICAgICAgICAgICAgICAgICBsb2dRdWVyeVdoYXRJcyhzZXNzaW9uLCAnTGlzdEFsbCcsIHJlc3VsdDEuYW5zd2Vycyk7XG4gICAgICAgICAgICAgICAgICAgIGRlYnVnbG9nKGRlYnVnbG9nID8gKCdsaXN0YWxsIHJlc3VsdDIgPjonICsgSlNPTi5zdHJpbmdpZnkocmVzdWx0MSkpIDogJy0nKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGpvaW5yZXN1bHRzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbFwiLCBzZXNzaW9uLCBzZW5kKFwidGhlIFwiICsgY2F0ZWdvcnkgKyBcIiBmb3IgXCIgKyBpblNvbWV0aGluZyArIFwiIGFyZSAuLi5cXG5cIiArIGpvaW5yZXN1bHRzLmpvaW4oXCI7XFxuXCIpKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgZXJycHJlZml4ID0gXCJcIjtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChyZXN1bHQxLmVycm9ycy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcnJwcmVmaXggPSBFckVycm9yLmV4cGxhaW5FcnJvcihyZXN1bHQxLmVycm9ycyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsXCIsIHNlc3Npb24sIHNlbmQoXCJpIGRpZCBub3QgZmluZCBhbnkgXCIgKyBjYXRlZ29yeSArIFwiIGZvciBcIiArIGluU29tZXRoaW5nICsgXCIuXFxuXCIgKyBqb2lucmVzdWx0cy5qb2luKFwiO1xcblwiKSArIFwiXCIgKyBlcnJwcmVmaXgpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAvLyBubyBmaWx0ZXIgZW50aXR5LCBlLmcuIGxpc3QgYWxsIGNvdW50cmllc1xuICAgICAgICAgICAgICAgICAgICAvL1xuICAgICAgICAgICAgICAgICAgICB2YXIgY2F0ZWdvcnlTZXRGdWxsID0gTW9kZWwuZ2V0QWxsUmVjb3JkQ2F0ZWdvcmllc0ZvclRhcmdldENhdGVnb3J5KHRoZU1vZGVsLCBjYXQsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IExpc3RBbGwubGlzdEFsbEhhdmluZ0NvbnRleHQoY2F0LCBjYXQsIHRoZU1vZGVsLnJ1bGVzLCB0aGVNb2RlbC5yZWNvcmRzLCBjYXRlZ29yeVNldEZ1bGwpO1xuICAgICAgICAgICAgICAgICAgICBsb2dRdWVyeVdoYXRJcyhzZXNzaW9uLCAnTGlzdEFsbCcsIHJlc3VsdC5hbnN3ZXJzKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHJlc3VsdC5hbnN3ZXJzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVidWdsb2coZGVidWdsb2cuZW5hYmxlZCA/ICgnbGlzdGFsbCByZXN1bHQ6JyArIEpTT04uc3RyaW5naWZ5KHJlc3VsdCkpIDogJy0nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBqb2lucmVzdWx0cyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVidWdsb2coXCJoZXJlIGlzIGNhdD5cIiArIGNhdCk7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoY2F0ICE9PSBcImV4YW1wbGUgcXVlc3Rpb25cIikge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGpvaW5yZXN1bHRzID0gcmVzdHJpY3RMb2dnZWRPbihzZXNzaW9uLCBMaXN0QWxsLmpvaW5SZXN1bHRzKHJlc3VsdC5hbnN3ZXJzKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBqb2lucmVzdWx0cyA9IExpc3RBbGwuam9pblJlc3VsdHMocmVzdWx0LmFuc3dlcnMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0gXCJ0aGUgXCIgKyBjYXRlZ29yeSArIFwiIGFyZSAuLi5cXG5cIiArIGpvaW5yZXN1bHRzLmpvaW4oXCI7XFxuXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbFwiLCBzZXNzaW9uLCBzZW5kKHJlc3BvbnNlKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSBcIkZvdW5kIG5vIGRhdGEgaGF2aW5nIFxcXCJcIiArIGNhdCArIFwiXFxcIlwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbFwiLCBzZXNzaW9uLCBzZW5kKHJlc3BvbnNlKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBtdWx0aXBsZSBjYXRlZ29yaWVzXG4gICAgICAgICAgICAgICAgZGVidWdsb2coJ2NhdGVnb3JpZXMgaWRlbnRpZmllZDonICsgY2F0cy5qb2luKFwiLFwiKSk7XG4gICAgICAgICAgICAgICAgaWYgKGluU29tZXRoaW5nKSB7XG4gICAgICAgICAgICAgICAgICAgIGRlYnVnbG9nKCdnb3QgZmlsdGVyOicgKyBpblNvbWV0aGluZyk7XG4gICAgICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2F0ZWdvcnlTZXQgPSBNb2RlbC5nZXRBbGxSZWNvcmRDYXRlZ29yaWVzRm9yVGFyZ2V0Q2F0ZWdvcmllcyh0aGVNb2RlbCwgY2F0cywgdHJ1ZSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgY2F0Y2ggKGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlYnVnbG9nKFwiaGVyZSBleGNlcHRpb25cIiArIGUpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiV2hhdElzXCIsIHNlc3Npb24sIHNlbmQoJ0kgY2Fubm90IGNvbWJpbmUgXCInICsgY2F0ZWdvcnkgKyAnKCcgKyBlLnRvU3RyaW5nKCkgKyAnKScpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICB2YXIgcmVzdWx0MVQgPSBMaXN0QWxsLmxpc3RBbGxUdXBlbFdpdGhDb250ZXh0KGNhdHMsIGluU29tZXRoaW5nLCB0aGVNb2RlbC5ydWxlcywgdGhlTW9kZWwucmVjb3JkcywgY2F0ZWdvcnlTZXQpO1xuICAgICAgICAgICAgICAgICAgICAvLyBUT0RPIGNsYXNzaWZ5aW5nIHRoZSBzdHJpbmcgdHdpY2UgaXMgYSB0ZXJyaWJsZSB3YXN0ZVxuICAgICAgICAgICAgICAgICAgICBpZiAoIXJlc3VsdDFULnR1cGVsYW5zd2Vycy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlYnVnbG9nKCdnb2luZyBmb3IgaGF2aW5nJyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2F0ZWdvcnlTZXRGdWxsID0gTW9kZWwuZ2V0QWxsUmVjb3JkQ2F0ZWdvcmllc0ZvclRhcmdldENhdGVnb3JpZXModGhlTW9kZWwsIGNhdHMsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdDFUID0gTGlzdEFsbC5saXN0QWxsVHVwZWxIYXZpbmdDb250ZXh0KGNhdHMsIGluU29tZXRoaW5nLCB0aGVNb2RlbC5ydWxlcywgdGhlTW9kZWwucmVjb3JkcywgY2F0ZWdvcnlTZXRGdWxsKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBkZWJ1Z2xvZyhkZWJ1Z2xvZy5lbmFibGVkID8gKCdsaXN0YWxsIHJlc3VsdDonICsgSlNPTi5zdHJpbmdpZnkocmVzdWx0MVQpKSA6ICctJyk7XG4gICAgICAgICAgICAgICAgICAgIHZhciBqb2lucmVzdWx0cyA9IHJlc3RyaWN0TG9nZ2VkT24oc2Vzc2lvbiwgTGlzdEFsbC5qb2luUmVzdWx0c1R1cGVsKHJlc3VsdDFULnR1cGVsYW5zd2VycykpO1xuICAgICAgICAgICAgICAgICAgICBsb2dRdWVyeVdoYXRJc1R1cGVsKHNlc3Npb24sICdMaXN0QWxsJywgcmVzdWx0MVQudHVwZWxhbnN3ZXJzKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKGpvaW5yZXN1bHRzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbFwiLCBzZXNzaW9uLCBzZW5kKFwidGhlIFwiICsgY2F0ZWdvcnkgKyBcIiBmb3IgXCIgKyBpblNvbWV0aGluZyArIFwiIGFyZSAuLi5cXG5cIiArIGpvaW5yZXN1bHRzLmpvaW4oXCI7XFxuXCIpKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0MVQuZXJyb3JzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycnByZWZpeCA9IEVyRXJyb3IuZXhwbGFpbkVycm9yKHJlc3VsdDFULmVycm9ycyk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsXCIsIHNlc3Npb24sIHNlbmQoXCJpIGRpZCBub3QgZmluZCBhbnkgXCIgKyBjYXRlZ29yeSArIFwiIGZvciBcIiArIGluU29tZXRoaW5nICsgXCIuXFxuXCIgKyBqb2lucmVzdWx0cy5qb2luKFwiO1xcblwiKSArIGVycnByZWZpeCkpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIC8vIG5vIGVudGl0eSwgZS5nLiBsaXN0IGFsbCBjb3VudHJpZXNcbiAgICAgICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgICAgICAgdmFyIGNhdGVnb3J5U2V0RnVsbCA9IHt9O1xuICAgICAgICAgICAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgICAgICAgICAgICAgY2F0ZWdvcnlTZXRGdWxsID0gTW9kZWwuZ2V0QWxsUmVjb3JkQ2F0ZWdvcmllc0ZvclRhcmdldENhdGVnb3JpZXModGhlTW9kZWwsIGNhdHMsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVidWdsb2coXCJoZXJlIGV4Y2VwdGlvblwiICsgZSk7XG4gICAgICAgICAgICAgICAgICAgICAgICBkaWFsb2dsb2coXCJXaGF0SXNcIiwgc2Vzc2lvbiwgc2VuZCgnSSBjYW5ub3QgY29tYmluZSBcIicgKyBjYXRlZ29yeSArICcoJyArIGUudG9TdHJpbmcoKSArICcpJykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gbmV4dCgpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHZhciByZXN1bHRUID0gTGlzdEFsbC5saXN0QWxsVHVwZWxIYXZpbmdDb250ZXh0KGNhdHMsIFwiXFxcIlwiICsgY2F0cy5qb2luKFwiXFxcIiBcXFwiXCIpICsgXCJcXFwiXCIsIHRoZU1vZGVsLnJ1bGVzLCB0aGVNb2RlbC5yZWNvcmRzLCBjYXRlZ29yeVNldEZ1bGwpO1xuICAgICAgICAgICAgICAgICAgICBsb2dRdWVyeVdoYXRJc1R1cGVsKHNlc3Npb24sICdMaXN0QWxsJywgcmVzdWx0VC50dXBlbGFuc3dlcnMpO1xuICAgICAgICAgICAgICAgICAgICBpZiAocmVzdWx0VC50dXBlbGFuc3dlcnMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkZWJ1Z2xvZyhkZWJ1Z2xvZy5lbmFibGVkID8gKCdsaXN0YWxsIHJlc3VsdDonICsgSlNPTi5zdHJpbmdpZnkocmVzdWx0VCkpIDogJy0nKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBqb2lucmVzdWx0cyA9IFtdO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGVidWdsb2coXCJoZXJlIGlzIGNhdD5cIiArIGNhdHMuam9pbihcIiwgXCIpKTtcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjYXQgIT09IFwiZXhhbXBsZSBxdWVzdGlvblwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgam9pbnJlc3VsdHMgPSByZXN0cmljdExvZ2dlZE9uKHNlc3Npb24sIExpc3RBbGwuam9pblJlc3VsdHNUdXBlbChyZXN1bHRULnR1cGVsYW5zd2VycykpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgam9pbnJlc3VsdHMgPSBMaXN0QWxsLmpvaW5SZXN1bHRzVHVwZWwocmVzdWx0VC50dXBlbGFuc3dlcnMpO1xuICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0gXCJ0aGUgXCIgKyBjYXRlZ29yeSArIFwiIGFyZSAuLi5cXG5cIiArIGpvaW5yZXN1bHRzLmpvaW4oXCI7XFxuXCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbFwiLCBzZXNzaW9uLCBzZW5kKHJlc3BvbnNlKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSBcIkZvdW5kIG5vIGRhdGEgaGF2aW5nIFxcXCJcIiArIGNhdCArIFwiXFxcIlwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbFwiLCBzZXNzaW9uLCBzZW5kKHJlc3BvbnNlKSk7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICBdKTtcbiAgICBkaWFsb2cubWF0Y2hlcygnYnVpbGR0YWJsZScsIFtcbiAgICAgICAgZnVuY3Rpb24gKHNlc3Npb24sIGFyZ3MsIG5leHQpIHtcbiAgICAgICAgICAgIHZhciBpc0NvbWJpbmVkSW5kZXggPSB7fTtcbiAgICAgICAgICAgIHZhciBvTmV3RW50aXR5O1xuICAgICAgICAgICAgLy8gZXhwZWN0aW5nIGVudGl0eSBBMVxuICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSBzZXNzaW9uLm1lc3NhZ2UudGV4dDtcbiAgICAgICAgICAgIGRlYnVnbG9nKFwiSW50ZW50IDogYnVpbGR0YWJsZVwiKTtcbiAgICAgICAgICAgIGRlYnVnbG9nKCdyYXc6ICcgKyBKU09OLnN0cmluZ2lmeShhcmdzLmVudGl0aWVzKSwgdW5kZWZpbmVkLCAyKTtcbiAgICAgICAgICAgIHZhciBjYXRlZ29yaWVzID0gYnVpbGRlci5FbnRpdHlSZWNvZ25pemVyLmZpbmRFbnRpdHkoYXJncy5lbnRpdGllcywgJ2NhdGVnb3JpZXMnKS5lbnRpdHk7XG4gICAgICAgICAgICBkZWJ1Z2xvZyhcImZhY3RPckNhdCBpc1wiICsgY2F0ZWdvcmllcyk7XG4gICAgICAgICAgICB2YXIgY2F0cztcbiAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgY2F0cyA9IFdoYXRJcy5hbmFseXplQ2F0ZWdvcnlNdWx0T25seUFuZENvbW1hKGNhdGVnb3JpZXMsIHRoZU1vZGVsLnJ1bGVzLCBtZXNzYWdlKTtcbiAgICAgICAgICAgICAgICBkZWJ1Z2xvZyhcImhlcmUgY2F0c1wiICsgY2F0cy5qb2luKFwiLFwiKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBjYXRjaCAoZSkge1xuICAgICAgICAgICAgICAgIGlmIChlKSB7XG4gICAgICAgICAgICAgICAgICAgIGRlYnVnbG9nKFwiaGVyZSBleGNlcHRpb25cIiArIGUpO1xuICAgICAgICAgICAgICAgICAgICBkaWFsb2dsb2coXCJXaGF0SXNcIiwgc2Vzc2lvbiwgc2VuZCgnSSBkb25cXCd0IGtub3cgYW55dGhpbmcgYWJvdXQgXCInICsgY2F0ZWdvcmllcyArICdcIignICsgZS50b1N0cmluZygpICsgJyknKSk7XG4gICAgICAgICAgICAgICAgICAgIC8vIG5leHQoKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghY2F0cyB8fCAoY2F0cy5sZW5ndGggPT09IDApKSB7XG4gICAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbFwiLCBzZXNzaW9uLCBzZW5kKCdJIGRpZCBub3QgZmluZCBhIGNhdGVnb3J5IGluIFwiJyArIGNhdGVnb3JpZXMgKyAnXCInKSk7XG4gICAgICAgICAgICAgICAgLy8gbmV4dCgpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBleGVjID0gTWFrZVRhYmxlLm1ha2VUYWJsZShjYXRzLCB0aGVNb2RlbCk7XG4gICAgICAgICAgICAvLyAgICAgIGNvbnN0IGV4ZWMgPSBFeGVjU2VydmVyLmV4ZWNUb29sKHNlc3Npb24uZGlhbG9nRGF0YS5yZXN1bHQgYXMgSU1hdGNoLklUb29sTWF0Y2gsIHRoZU1vZGVsLnJlY29yZHMpO1xuICAgICAgICAgICAgdmFyIHJlcGx5ID0gbmV3IGJ1aWxkZXIuTWVzc2FnZShzZXNzaW9uKVxuICAgICAgICAgICAgICAgIC50ZXh0KGV4ZWMudGV4dClcbiAgICAgICAgICAgICAgICAuYWRkRW50aXR5KGV4ZWMuYWN0aW9uKTtcbiAgICAgICAgICAgIC8vIC5hZGRBdHRhY2htZW50KHsgZmFsbGJhY2tUZXh0OiBcIkkgZG9uJ3Qga25vd1wiLCBjb250ZW50VHlwZTogJ2ltYWdlL2pwZWcnLCBjb250ZW50VXJsOiBcInd3dy53b21iYXQub3JnXCIgfSk7XG4gICAgICAgICAgICBkaWFsb2dsb2coXCJTaG93TWVcIiwgc2Vzc2lvbiwgc2VuZChyZXBseSkpO1xuICAgICAgICB9XG4gICAgXSk7XG4gICAgZGlhbG9nLm1hdGNoZXMoJ0Rlc2NyaWJlJywgW1xuICAgICAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgYXJncywgbmV4dCkge1xuICAgICAgICAgICAgdmFyIGlzQ29tYmluZWRJbmRleCA9IHt9O1xuICAgICAgICAgICAgdmFyIG9OZXdFbnRpdHk7XG4gICAgICAgICAgICAvLyBleHBlY3RpbmcgZW50aXR5IEExXG4gICAgICAgICAgICB2YXIgbWVzc2FnZSA9IHNlc3Npb24ubWVzc2FnZS50ZXh0O1xuICAgICAgICAgICAgZGVidWdsb2coXCJJbnRlbnQgOiBEZXNjcmliZVwiKTtcbiAgICAgICAgICAgIGRlYnVnbG9nKCdyYXc6ICcgKyBKU09OLnN0cmluZ2lmeShhcmdzLmVudGl0aWVzKSwgdW5kZWZpbmVkLCAyKTtcbiAgICAgICAgICAgIHZhciBmYWN0RW50aXR5ID0gYnVpbGRlci5FbnRpdHlSZWNvZ25pemVyLmZpbmRFbnRpdHkoYXJncy5lbnRpdGllcywgJ0ExJyk7XG4gICAgICAgICAgICB2YXIgZmFjdE9yQ2F0ID0gZmFjdEVudGl0eSAmJiBmYWN0RW50aXR5LmVudGl0eTtcbiAgICAgICAgICAgIHZhciBkb21haW5FbnRpdHkgPSBidWlsZGVyLkVudGl0eVJlY29nbml6ZXIuZmluZEVudGl0eShhcmdzLmVudGl0aWVzLCAnRCcpO1xuICAgICAgICAgICAgdmFyIGRvbWFpblMgPSBkb21haW5FbnRpdHkgJiYgZG9tYWluRW50aXR5LmVudGl0eTtcbiAgICAgICAgICAgIHZhciBmaWx0ZXJEb21haW4gPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICBpZiAoZG9tYWluUykge1xuICAgICAgICAgICAgICAgIGZpbHRlckRvbWFpbiA9IExpc3RBbGwuaW5mZXJEb21haW4odGhlTW9kZWwsIGRvbWFpblMpO1xuICAgICAgICAgICAgICAgIGRlYnVnbG9nKFwiZ290IGRvbWFpblwiICsgZmlsdGVyRG9tYWluKTtcbiAgICAgICAgICAgICAgICBpZiAoIWZpbHRlckRvbWFpbikge1xuICAgICAgICAgICAgICAgICAgICBkaWFsb2dsb2coXCJEZXNjcmliZVwiLCBzZXNzaW9uLCBzZW5kKFwiSSBkaWQgbm90IGluZmVyIGEgZG9tYWluIHJlc3RyaWN0aW9uIGZyb20gXFxcIlwiICsgZG9tYWluUyArIFwiXFxcIi4gU3BlY2lmeSBhbiBleGlzdGluZyBkb21haW4uIChMaXN0IGFsbCBkb21haW5zKSB0byBnZXQgZXhhY3QgbmFtZXMuXFxuXCIpKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGRlYnVnbG9nKFwiZmFjdE9yQ2F0IGlzXCIgKyBmYWN0T3JDYXQpO1xuICAgICAgICAgICAgaWYgKGV4cG9ydHMubWV0YXdvcmRzRGVzY3JpcHRpb25zW2ZhY3RPckNhdC50b0xvd2VyQ2FzZSgpXSkge1xuICAgICAgICAgICAgICAgIC8vIGRvIHdlIGhhdmUgYSBmaWx0ZXIgP1xuICAgICAgICAgICAgICAgIHZhciBwcmVmaXggPSBcIlwiO1xuICAgICAgICAgICAgICAgIGlmIChmaWx0ZXJEb21haW4pIHtcbiAgICAgICAgICAgICAgICAgICAgcHJlZml4ID0gJ1wiaW4gZG9tYWluIFwiJyArIGZpbHRlckRvbWFpbiArICdcIiBtYWtlIG5vIHNlbnNlIHdoZW4gbWF0Y2hpbmcgYSBtZXRhd29yZC5cXG4nO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBkZWJ1Z2xvZyhcInNob3dpbmcgbWV0YSByZXN1bHRcIik7XG4gICAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiRGVzY3JpYmVcIiwgc2Vzc2lvbiwgc2VuZChwcmVmaXggKyAnXCInICsgZmFjdE9yQ2F0ICsgJ1wiIGlzICcgKyBleHBvcnRzLm1ldGF3b3Jkc0Rlc2NyaXB0aW9uc1tmYWN0T3JDYXQudG9Mb3dlckNhc2UoKV0gKyBcIlwiKSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGNhdGVnb3JpZXMgPSBbXTtcbiAgICAgICAgICAgIGlmIChXaGF0SXMuc3BsaXRBdENvbW1hQW5kKGZhY3RPckNhdCkubGVuZ3RoID4gMSkge1xuICAgICAgICAgICAgICAgIGRpYWxvZ2xvZyhcIkRlc2NyaWJlXCIsIHNlc3Npb24sIHNlbmQoXCJXaG9hLCBpIGNhbiBvbmx5IGV4cGxhaW4gb25lIHRoaW5nIGF0IGEgdGltZSwgbm90IFxcXCJcIiArIGZhY3RPckNhdCArIFwiXFxcIi4gUGxlYXNlIGFzayBvbmUgYXQgYSB0aW1lLlwiKSk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGNhdGVnb3J5ID0gV2hhdElzLmFuYWx5emVDYXRlZ29yeShmYWN0T3JDYXQsIHRoZU1vZGVsLnJ1bGVzLCBtZXNzYWdlKTtcbiAgICAgICAgICAgIHZhciBjYXRSZXN1bHRzID0gW107XG4gICAgICAgICAgICBpZiAoY2F0ZWdvcnkpIHtcbiAgICAgICAgICAgICAgICAvL1RPRE9cbiAgICAgICAgICAgICAgICBjYXRSZXN1bHRzID0gRGVzY3JpYmUuZGVzY3JpYmVDYXRlZ29yeShjYXRlZ29yeSwgZmlsdGVyRG9tYWluLCB0aGVNb2RlbCwgbWVzc2FnZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgcmVzRmFjdCA9IERlc2NyaWJlLmRlc2NyaWJlRmFjdEluRG9tYWluKGZhY3RPckNhdCwgZmlsdGVyRG9tYWluLCB0aGVNb2RlbCk7XG4gICAgICAgICAgICBpZiAoY2F0UmVzdWx0cykge1xuICAgICAgICAgICAgICAgIHZhciBwcmVmaXhlZCA9IGNhdFJlc3VsdHMubWFwKGZ1bmN0aW9uIChyZXMpIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIERlc2NyaWJlLnNsb3BweU9yRXhhY3QoY2F0ZWdvcnksIGZhY3RPckNhdCwgdGhlTW9kZWwpICsgXCIgIFwiICsgcmVzO1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGNhdFJlc3VsdHMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgcmVzRmFjdCA9IHByZWZpeGVkLmpvaW4oXCJcXG5cIik7XG4gICAgICAgICAgICAgICAgK1wiXFxuXCIgKyByZXNGYWN0O1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZGlhbG9nbG9nKFwiRGVzY3JpYmVcIiwgc2Vzc2lvbiwgc2VuZChyZXNGYWN0KSk7XG4gICAgICAgICAgICAvKlxuICAgICAgICAgICAgICAgIHZhciBhUmVzID0gTW9kZWwuZ2V0Q2F0ZWdvcmllc0ZvckRvbWFpbih0aGVNb2RlbCwgZG9tYWluKTtcbiAgICAgICAgICAgICAgICAgdmFyIHJlcyA9IHJlc3RyaWN0TG9nZ2VkT24oc2Vzc2lvbiwgYVJlcykuam9pbihcIjtcXG5cIik7XG4gICAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbFwiLHNlc3Npb24sc2VuZChcIm15IGNhdGVnb3JpZXMgaW4gZG9tYWluIFxcXCJcIiArIGRvbWFpbiArIFwiXFxcIiBhcmUgLi4uXFxuXCIgKyByZXMpKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChjYXRlZ29yeSA9PT0gXCJkb21haW5zXCIpIHtcbiAgICAgICAgICAgICAgdmFyIHJlcyA9IHJlc3RyaWN0TG9nZ2VkT24oc2Vzc2lvbiwgdGhlTW9kZWwuZG9tYWlucykuam9pbihcIjtcXG5cIik7XG4gICAgICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxcIixzZXNzaW9uLCBzZW5kKFwibXkgZG9tYWlucyBhcmUgLi4uXFxuXCIgKyByZXMpKTtcbiAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKGNhdGVnb3J5ID09PSBcInRvb2xzXCIpIHtcbiAgICAgICAgICAgICAgdmFyIHJlcyA9IHJlc3RyaWN0TG9nZ2VkT24oc2Vzc2lvbiwgdGhlTW9kZWwudG9vbHMpLm1hcChmdW5jdGlvbiAob1Rvb2wpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gb1Rvb2wubmFtZTtcbiAgICAgICAgICAgICAgfSkuam9pbihcIjtcXG5cIik7XG4gICAgICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxcIiwgc2Vzc2lvbixzZW5kKFwibXkgdG9vbHMgYXJlIC4uLlxcblwiICsgcmVzKSk7XG4gICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgICovXG4gICAgICAgICAgICAvKlxuICAgICAgICAgICAgdmFyIGNhdHMgPSBbXTtcbiAgICAgICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgICAgY2F0cyA9IFdoYXRJcy5hbmFseXplQ2F0ZWdvcnlNdWx0MihjYXRlZ29yeSwgdGhlTW9kZWwucnVsZXMsIG1lc3NhZ2UpO1xuICAgICAgICAgICAgICBkZWJ1Z2xvZyhcImhlcmUgY2F0c1wiICsgY2F0cy5qb2luKFwiLFwiKSk7XG4gICAgICAgICAgICB9IGNhdGNoIChlKSB7XG4gICAgICAgICAgICAgICAgaWYoZSkge1xuICAgICAgICAgICAgICAgICAgZGVidWdsb2coXCJoZXJlIGV4Y2VwdGlvblwiICsgZSk7XG4gICAgICAgICAgICAgICAgICBkaWFsb2dsb2coXCJXaGF0SXNcIixzZXNzaW9uLHNlbmQoJ0kgZG9uXFwndCBrbm93IGFueXRoaW5nIGFib3V0IFwiJyArIGNhdGVnb3J5ICsgJ1wiKCcgKyBlLnRvU3RyaW5nKCkgKyAnKScpKTtcbiAgICAgICAgICAgICAgICAgIC8vIG5leHQoKTtcbiAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIWNhdHMgfHwgKGNhdHMubGVuZ3RoID09PSAwKSkge1xuICAgICAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsXCIsc2Vzc2lvbixzZW5kKCdJIGRvblxcJ3Qga25vdyBhbnl0aGluZyBhYm91dCBcIicgKyBjYXRlZ29yeSArICdcIicpKTtcbiAgICAgICAgICAgICAgLy8gbmV4dCgpO1xuICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB2YXIgY2F0ID0gXCJcIjtcbiAgICAgICAgICAgIGlmKCBjYXRzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgICAgICBjYXQgPSBjYXRzWzBdO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYoIGNhdHMubGVuZ3RoID09PSAxKSB7XG4gICAgICAgICAgICAgIGRlYnVnbG9nKCdjYXRlZ29yeSBpZGVudGlmaWVkOicgKyBjYXQpO1xuICAgICAgICAgICAgICBpZiAoYTEgJiYgYTEuZW50aXR5KSB7XG4gICAgICAgICAgICAgICAgZGVidWdsb2coJ2dvdCBmaWx0ZXI6JyArIGExLmVudGl0eSk7XG4gICAgICAgICAgICAgICAgdmFyIGNhdGVnb3J5U2V0ID0gTW9kZWwuZ2V0QWxsUmVjb3JkQ2F0ZWdvcmllc0ZvclRhcmdldENhdGVnb3J5KHRoZU1vZGVsLCBjYXQsIHRydWUpO1xuICAgICAgICAgICAgICAgIHZhciByZXN1bHQxID0gTGlzdEFsbC5saXN0QWxsV2l0aENvbnRleHQoY2F0LCBhMS5lbnRpdHksXG4gICAgICAgICAgICAgICAgICB0aGVNb2RlbC5ydWxlcywgdGhlTW9kZWwucmVjb3JkcywgY2F0ZWdvcnlTZXQpO1xuICAgICAgICAgICAgICAgIC8vIFRPRE8gY2xhc3NpZnlpbmcgdGhlIHN0cmluZyB0d2ljZSBpcyBhIHRlcnJpYmxlIHdhc3RlXG4gICAgICAgICAgICAgICAgaWYgKCFyZXN1bHQxLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgZGVidWdsb2coJ2dvaW5nIGZvciBoYXZpbmcnKTtcbiAgICAgICAgICAgICAgICAgIHZhciBjYXRlZ29yeVNldEZ1bGwgPSBNb2RlbC5nZXRBbGxSZWNvcmRDYXRlZ29yaWVzRm9yVGFyZ2V0Q2F0ZWdvcnkodGhlTW9kZWwsIGNhdCwgZmFsc2UpO1xuICAgICAgICAgICAgICAgICAgcmVzdWx0MSA9IExpc3RBbGwubGlzdEFsbEhhdmluZ0NvbnRleHQoY2F0LCBhMS5lbnRpdHksIHRoZU1vZGVsLnJ1bGVzLFxuICAgICAgICAgICAgICAgICAgICB0aGVNb2RlbC5yZWNvcmRzLCBjYXRlZ29yeVNldEZ1bGwpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBkZWJ1Z2xvZygnbGlzdGFsbCByZXN1bHQ6JyArIEpTT04uc3RyaW5naWZ5KHJlc3VsdDEpKTtcbiAgICAgICAgICAgICAgICB2YXIgam9pbnJlc3VsdHMgPSByZXN0cmljdExvZ2dlZE9uKHNlc3Npb24sIExpc3RBbGwuam9pblJlc3VsdHMocmVzdWx0MSkpO1xuICAgICAgICAgICAgICAgIGxvZ1F1ZXJ5V2hhdElzKHNlc3Npb24sICdMaXN0QWxsJywgcmVzdWx0MSk7XG4gICAgICAgICAgICAgICAgaWYoam9pbnJlc3VsdHMubGVuZ3RoICl7XG4gICAgICAgICAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsXCIsc2Vzc2lvbixzZW5kKFwidGhlIFwiICsgY2F0ZWdvcnkgKyBcIiBmb3IgXCIgKyBhMS5lbnRpdHkgKyBcIiBhcmUgLi4uXFxuXCIgKyBqb2lucmVzdWx0cy5qb2luKFwiO1xcblwiKSkpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsXCIsc2Vzc2lvbixzZW5kKFwiaSBkaWQgbm90IGZpbmQgYW55IFwiICsgY2F0ZWdvcnkgKyBcIiBmb3IgXCIgKyBhMS5lbnRpdHkgKyBcIi5cXG5cIiArIGpvaW5yZXN1bHRzLmpvaW4oXCI7XFxuXCIpKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBubyBlbnRpdHksIGUuZy4gbGlzdCBhbGwgY291bnRyaWVzXG4gICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgICB2YXIgY2F0ZWdvcnlTZXRGdWxsID0gTW9kZWwuZ2V0QWxsUmVjb3JkQ2F0ZWdvcmllc0ZvclRhcmdldENhdGVnb3J5KHRoZU1vZGVsLCBjYXQsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICB2YXIgcmVzdWx0ID0gTGlzdEFsbC5saXN0QWxsSGF2aW5nQ29udGV4dChjYXQsIGNhdCwgdGhlTW9kZWwucnVsZXMsIHRoZU1vZGVsLnJlY29yZHMsIGNhdGVnb3J5U2V0RnVsbCk7XG4gICAgICAgICAgICAgICAgbG9nUXVlcnlXaGF0SXMoc2Vzc2lvbiwgJ0xpc3RBbGwnLCByZXN1bHQpO1xuICAgICAgICAgICAgICAgIGlmIChyZXN1bHQubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICBkZWJ1Z2xvZygnbGlzdGFsbCByZXN1bHQ6JyArIEpTT04uc3RyaW5naWZ5KHJlc3VsdCkpO1xuICAgICAgICAgICAgICAgICAgdmFyIGpvaW5yZXN1bHRzID0gW107XG4gICAgICAgICAgICAgICAgICBkZWJ1Z2xvZyhcImhlcmUgaXMgY2F0PlwiICsgY2F0KTtcbiAgICAgICAgICAgICAgICAgIGlmKGNhdCAhPT0gXCJleGFtcGxlIHF1ZXN0aW9uXCIpIHtcbiAgICAgICAgICAgICAgICAgICAgam9pbnJlc3VsdHMgPSByZXN0cmljdExvZ2dlZE9uKHNlc3Npb24sIExpc3RBbGwuam9pblJlc3VsdHMocmVzdWx0KSk7XG4gICAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBqb2lucmVzdWx0cyA9IExpc3RBbGwuam9pblJlc3VsdHMocmVzdWx0KTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIHZhciByZXNwb25zZSA9IFwidGhlIFwiICsgY2F0ZWdvcnkgKyBcIiBhcmUgLi4uXFxuXCIgKyBqb2lucmVzdWx0cy5qb2luKFwiO1xcblwiKTtcbiAgICAgICAgICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxcIixzZXNzaW9uLHNlbmQocmVzcG9uc2UpKTtcbiAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0gXCJGb3VuZCBubyBkYXRhIGhhdmluZyBcXFwiXCIgKyBjYXQgKyBcIlxcXCJcIlxuICAgICAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbFwiLHNlc3Npb24sc2VuZChyZXNwb25zZSkpO1xuICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgLy8gbXVsdGlwbGUgY2F0ZWdvcmllc1xuICAgICAgICAgICAgICBkZWJ1Z2xvZygnY2F0ZWdvcmllcyBpZGVudGlmaWVkOicgKyBjYXRzLmpvaW4oXCIsXCIpKTtcbiAgICAgICAgICAgICAgaWYgKGExICYmIGExLmVudGl0eSkge1xuICAgICAgICAgICAgICAgIGRlYnVnbG9nKCdnb3QgZmlsdGVyOicgKyBhMS5lbnRpdHkpO1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgdmFyIGNhdGVnb3J5U2V0ID0gTW9kZWwuZ2V0QWxsUmVjb3JkQ2F0ZWdvcmllc0ZvclRhcmdldENhdGVnb3JpZXModGhlTW9kZWwsIGNhdHMsIHRydWUpO1xuICAgICAgICAgICAgICAgIH0gY2F0Y2goZSkge1xuICAgICAgICAgICAgICAgICAgICBkZWJ1Z2xvZyhcImhlcmUgZXhjZXB0aW9uXCIgKyBlKTtcbiAgICAgICAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiV2hhdElzXCIsc2Vzc2lvbixzZW5kKCdJIGNhbm5vdCBjb21iaW5lIFwiJyArIGNhdGVnb3J5ICsgJygnICsgZS50b1N0cmluZygpICsgJyknKSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgdmFyIHJlc3VsdDFUID0gTGlzdEFsbC5saXN0QWxsVHVwZWxXaXRoQ29udGV4dChjYXRzLCBhMS5lbnRpdHksXG4gICAgICAgICAgICAgICAgICB0aGVNb2RlbC5ydWxlcywgdGhlTW9kZWwucmVjb3JkcywgY2F0ZWdvcnlTZXQpO1xuICAgICAgICAgICAgICAgIC8vIFRPRE8gY2xhc3NpZnlpbmcgdGhlIHN0cmluZyB0d2ljZSBpcyBhIHRlcnJpYmxlIHdhc3RlXG4gICAgICAgICAgICAgICAgaWYgKCFyZXN1bHQxVC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgIGRlYnVnbG9nKCdnb2luZyBmb3IgaGF2aW5nJyk7XG4gICAgICAgICAgICAgICAgICB2YXIgY2F0ZWdvcnlTZXRGdWxsID0gTW9kZWwuZ2V0QWxsUmVjb3JkQ2F0ZWdvcmllc0ZvclRhcmdldENhdGVnb3JpZXModGhlTW9kZWwsIGNhdHMsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgIHJlc3VsdDFUID0gTGlzdEFsbC5saXN0QWxsVHVwZWxIYXZpbmdDb250ZXh0KGNhdHMsIGExLmVudGl0eSwgdGhlTW9kZWwucnVsZXMsXG4gICAgICAgICAgICAgICAgICAgIHRoZU1vZGVsLnJlY29yZHMsIGNhdGVnb3J5U2V0RnVsbCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGRlYnVnbG9nKCdsaXN0YWxsIHJlc3VsdDonICsgSlNPTi5zdHJpbmdpZnkocmVzdWx0MVQpKTtcbiAgICAgICAgICAgICAgICB2YXIgam9pbnJlc3VsdHMgPSByZXN0cmljdExvZ2dlZE9uKHNlc3Npb24sIExpc3RBbGwuam9pblJlc3VsdHNUdXBlbChyZXN1bHQxVCkpO1xuICAgICAgICAgICAgICAgIGxvZ1F1ZXJ5V2hhdElzVHVwZWwoc2Vzc2lvbiwgJ0xpc3RBbGwnLCByZXN1bHQxVCk7XG4gICAgICAgICAgICAgICAgaWYoam9pbnJlc3VsdHMubGVuZ3RoICl7XG4gICAgICAgICAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsXCIsc2Vzc2lvbixzZW5kKFwidGhlIFwiICsgY2F0ZWdvcnkgKyBcIiBmb3IgXCIgKyBhMS5lbnRpdHkgKyBcIiBhcmUgLi4uXFxuXCIgKyBqb2lucmVzdWx0cy5qb2luKFwiO1xcblwiKSkpO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsXCIsc2Vzc2lvbixzZW5kKFwiaSBkaWQgbm90IGZpbmQgYW55IFwiICsgY2F0ZWdvcnkgKyBcIiBmb3IgXCIgKyBhMS5lbnRpdHkgKyBcIi5cXG5cIiArIGpvaW5yZXN1bHRzLmpvaW4oXCI7XFxuXCIpKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBubyBlbnRpdHksIGUuZy4gbGlzdCBhbGwgY291bnRyaWVzXG4gICAgICAgICAgICAgICAgLy9cbiAgICAgICAgICAgICAgICB2YXIgY2F0ZWdvcnlTZXRGdWxsID0ge30gYXMgeyBba2V5IDogc3RyaW5nXSA6IGJvb2xlYW59O1xuICAgICAgICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICAgICAgICBjYXRlZ29yeVNldEZ1bGwgPSBNb2RlbC5nZXRBbGxSZWNvcmRDYXRlZ29yaWVzRm9yVGFyZ2V0Q2F0ZWdvcmllcyh0aGVNb2RlbCwgY2F0cywgZmFsc2UpO1xuICAgICAgICAgICAgICAgIH0gY2F0Y2goZSkge1xuICAgICAgICAgICAgICAgICAgICBkZWJ1Z2xvZyhcImhlcmUgZXhjZXB0aW9uXCIgKyBlKTtcbiAgICAgICAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiV2hhdElzXCIsc2Vzc2lvbixzZW5kKCdJIGNhbm5vdCBjb21iaW5lIFwiJyArIGNhdGVnb3J5ICsgJygnICsgZS50b1N0cmluZygpICsgJyknKSk7XG4gICAgICAgICAgICAgICAgLy8gbmV4dCgpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHZhciByZXN1bHRUID0gTGlzdEFsbC5saXN0QWxsVHVwZWxIYXZpbmdDb250ZXh0KGNhdHMsIFwiXFxcIlwiICsgY2F0cy5qb2luKFwiXFxcIiBcXFwiXCIpICsgXCJcXFwiXCIsIHRoZU1vZGVsLnJ1bGVzLCB0aGVNb2RlbC5yZWNvcmRzLCBjYXRlZ29yeVNldEZ1bGwpO1xuICAgICAgICAgICAgICAgIGxvZ1F1ZXJ5V2hhdElzVHVwZWwoc2Vzc2lvbiwgJ0xpc3RBbGwnLCByZXN1bHRUKTtcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0VC5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgIGRlYnVnbG9nKCdsaXN0YWxsIHJlc3VsdDonICsgSlNPTi5zdHJpbmdpZnkocmVzdWx0VCkpO1xuICAgICAgICAgICAgICAgICAgdmFyIGpvaW5yZXN1bHRzID0gW107XG4gICAgICAgICAgICAgICAgICBkZWJ1Z2xvZyhcImhlcmUgaXMgY2F0PlwiICsgY2F0cy5qb2luKFwiLCBcIikpO1xuICAgICAgICAgICAgICAgICAgaWYoY2F0ICE9PSBcImV4YW1wbGUgcXVlc3Rpb25cIikge1xuICAgICAgICAgICAgICAgICAgICBqb2lucmVzdWx0cyA9IHJlc3RyaWN0TG9nZ2VkT24oc2Vzc2lvbiwgTGlzdEFsbC5qb2luUmVzdWx0c1R1cGVsKHJlc3VsdFQpKTtcbiAgICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGpvaW5yZXN1bHRzID0gTGlzdEFsbC5qb2luUmVzdWx0c1R1cGVsKHJlc3VsdFQpO1xuICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgdmFyIHJlc3BvbnNlID0gXCJ0aGUgXCIgKyBjYXRlZ29yeSArIFwiIGFyZSAuLi5cXG5cIiArIGpvaW5yZXN1bHRzLmpvaW4oXCI7XFxuXCIpO1xuICAgICAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbFwiLHNlc3Npb24sc2VuZChyZXNwb25zZSkpO1xuICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICB2YXIgcmVzcG9uc2UgPSBcIkZvdW5kIG5vIGRhdGEgaGF2aW5nIFxcXCJcIiArIGNhdCArIFwiXFxcIlwiXG4gICAgICAgICAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsXCIsc2Vzc2lvbixzZW5kKHJlc3BvbnNlKSk7XG4gICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAgICovXG4gICAgICAgIH1cbiAgICBdKTtcbiAgICBkaWFsb2cubWF0Y2hlcygnTGlzdEFsbEJpbk9wJywgW1xuICAgICAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgYXJncywgbmV4dCkge1xuICAgICAgICAgICAgdmFyIGlzQ29tYmluZWRJbmRleCA9IHt9O1xuICAgICAgICAgICAgdmFyIG9OZXdFbnRpdHk7XG4gICAgICAgICAgICAvLyBleHBlY3RpbmcgZW50aXR5IEExXG4gICAgICAgICAgICB2YXIgbWVzc2FnZSA9IHNlc3Npb24ubWVzc2FnZS50ZXh0O1xuICAgICAgICAgICAgZGVidWdsb2coXCJJbnRlbnQgOiBMaXN0QWxsQmluT3BcIik7XG4gICAgICAgICAgICBkZWJ1Z2xvZygncmF3OiAnICsgSlNPTi5zdHJpbmdpZnkoYXJncy5lbnRpdGllcyksIHVuZGVmaW5lZCwgMik7XG4gICAgICAgICAgICB2YXIgY2F0ZWdvcnlFbnRpdHkgPSBidWlsZGVyLkVudGl0eVJlY29nbml6ZXIuZmluZEVudGl0eShhcmdzLmVudGl0aWVzLCAnY2F0ZWdvcnknKTtcbiAgICAgICAgICAgIHZhciBjYXRlZ29yeVdvcmQgPSBjYXRlZ29yeUVudGl0eS5lbnRpdHk7XG4gICAgICAgICAgICB2YXIgb3BFbnRpdHkgPSBidWlsZGVyLkVudGl0eVJlY29nbml6ZXIuZmluZEVudGl0eShhcmdzLmVudGl0aWVzLCAnb3BlcmF0b3InKTtcbiAgICAgICAgICAgIHZhciBvcGVyYXRvcldvcmQgPSBvcEVudGl0eSAmJiBvcEVudGl0eS5lbnRpdHk7XG4gICAgICAgICAgICAvLyBjYXRlZ29yaXplIGFzIG9wZXJhdG9yID9cbiAgICAgICAgICAgIHZhciBmaWx0ZXJEb21haW5FbnRpdHkgPSBidWlsZGVyLkVudGl0eVJlY29nbml6ZXIuZmluZEVudGl0eShhcmdzLmVudGl0aWVzLCAnZG9tYWluJyk7XG4gICAgICAgICAgICB2YXIgZmlsdGVyRG9tYWluUyA9IGZpbHRlckRvbWFpbkVudGl0eSAmJiBmaWx0ZXJEb21haW5FbnRpdHkuZW50aXR5O1xuICAgICAgICAgICAgdmFyIG9wZXJhdG9yID0gV2hhdElzLmFuYWx5emVPcGVyYXRvcihvcGVyYXRvcldvcmQsIHRoZU1vZGVsLnJ1bGVzLCBtZXNzYWdlKTtcbiAgICAgICAgICAgIHZhciBjYXRlZ29yeSA9IFdoYXRJcy5hbmFseXplQ2F0ZWdvcnkoY2F0ZWdvcnlXb3JkLCB0aGVNb2RlbC5ydWxlcywgbWVzc2FnZSk7XG4gICAgICAgICAgICB2YXIgb3BlcmF0b3JBcmdzID0gTW9kZWwuZ2V0T3BlcmF0b3IodGhlTW9kZWwsIG9wZXJhdG9yKTtcbiAgICAgICAgICAgIHZhciBhMiA9IGJ1aWxkZXIuRW50aXR5UmVjb2duaXplci5maW5kRW50aXR5KGFyZ3MuZW50aXRpZXMsICdBMicpO1xuICAgICAgICAgICAgaWYgKCFvcGVyYXRvcikge1xuICAgICAgICAgICAgICAgIHZhciBzID0gXCJVbmtub3duIG9wZXJhdG9yIFwiICsgb3BlcmF0b3JXb3JkICsgXCIsIHRoaXMgaXMgYSBtb2RlbCBidWcsIGNoZWNrIG9wZXJhdG9ycy5qc29uIGFuZCBpbnRlbnRzLmpzb25cIjtcbiAgICAgICAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsQmluT3BcIiwgc2Vzc2lvbiwgc2VuZChcIm91Y2gsIHRoaXMgd2FzIGluIGludGVybmFsIGVycm9yLiBSZWNvdmVyaW5nIGZyb20gYSB3ZWlyZCBvcGVyYXRvciBcXFwiXCJcbiAgICAgICAgICAgICAgICAgICAgKyBvcGVyYXRvcldvcmQgKyBcIlxcXCJcXG5cIikpO1xuICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihzKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBmaWx0ZXJEb21haW4gPSB1bmRlZmluZWQ7XG4gICAgICAgICAgICBpZiAoZmlsdGVyRG9tYWluUykge1xuICAgICAgICAgICAgICAgIGRlYnVnbG9nKFwiZm91bmQgYSBkb21haW5TdHJpbmdcIiArIGZpbHRlckRvbWFpblMpO1xuICAgICAgICAgICAgICAgIGZpbHRlckRvbWFpbiA9IExpc3RBbGwuaW5mZXJEb21haW4odGhlTW9kZWwsIGZpbHRlckRvbWFpblMpO1xuICAgICAgICAgICAgICAgIGRlYnVnbG9nKFwiZ290IGRvbWFpblwiICsgZmlsdGVyRG9tYWluKTtcbiAgICAgICAgICAgICAgICBpZiAoIWZpbHRlckRvbWFpbikge1xuICAgICAgICAgICAgICAgICAgICBkaWFsb2dsb2coXCJEZXNjcmliZVwiLCBzZXNzaW9uLCBzZW5kKFwiSSBkaWQgbm90IGluZmVyIGEgZG9tYWluIHJlc3RyaWN0aW9uIGZyb20gXFxcIlwiICsgZmlsdGVyRG9tYWluUyArIFwiXFxcIi4gU3BlY2lmeSBhbiBleGlzdGluZyBkb21haW4uIChMaXN0IGFsbCBkb21haW5zKSB0byBnZXQgZXhhY3QgbmFtZXMuXFxuXCIpKTtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBmcmFnbWVudCA9IGEyICYmIGEyLmVudGl0eTtcbiAgICAgICAgICAgIGZyYWdtZW50ID0gQnJlYWtEb3duLnRyaW1RdW90ZWQoQnJlYWtEb3duLnRyaW1RdW90ZWRTcGFjZWQoZnJhZ21lbnQpKTtcbiAgICAgICAgICAgIGRlYnVnbG9nKFwiZnJhZ21lbnQgYWZ0ZXIgdHJpbW1pbmcgXFxcIlwiICsgZnJhZ21lbnQgKyBcIlxcXCJcIik7XG4gICAgICAgICAgICBpZiAoY2F0ZWdvcnlXb3JkID09PSBcImNhdGVnb3JpZXNcIikge1xuICAgICAgICAgICAgICAgIC8vIGRvIHdlIGhhdmUgYSBmaWx0ZXI/XG4gICAgICAgICAgICAgICAgdmFyIGFGaWx0ZXJlZENhdGVnb3JpZXMgPSBMaXN0QWxsLmZpbHRlclN0cmluZ0xpc3RCeU9wKG9wZXJhdG9yQXJncywgZnJhZ21lbnQsIHRoZU1vZGVsLmNhdGVnb3J5KTtcbiAgICAgICAgICAgICAgICBpZiAoZmlsdGVyRG9tYWluKSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciBjYXRzRm9yRG9tYWluID0gTW9kZWwuZ2V0Q2F0ZWdvcmllc0ZvckRvbWFpbih0aGVNb2RlbCwgZmlsdGVyRG9tYWluKTtcbiAgICAgICAgICAgICAgICAgICAgYUZpbHRlcmVkQ2F0ZWdvcmllcyA9IF8uaW50ZXJzZWN0aW9uKGFGaWx0ZXJlZENhdGVnb3JpZXMsIGNhdHNGb3JEb21haW4pO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXMgPSByZXN0cmljdExvZ2dlZE9uKHNlc3Npb24sIGFGaWx0ZXJlZENhdGVnb3JpZXMpLmpvaW4oXCI7XFxuXCIpO1xuICAgICAgICAgICAgICAgIGlmIChyZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIGlmIChmaWx0ZXJEb21haW4pIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxCaW5PcFwiLCBzZXNzaW9uLCBzZW5kKFwibXkgY2F0ZWdvcmllcyBcIiArIG9wZXJhdG9yICsgXCIgXFxcIlwiICsgZnJhZ21lbnQgKyBcIlxcXCIgaW4gZG9tYWluIFxcXCJcIiArIGZpbHRlckRvbWFpbiArIFwiXFxcIiBhcmUgLi4uXFxuXCIgKyByZXMpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxCaW5PcFwiLCBzZXNzaW9uLCBzZW5kKFwibXkgY2F0ZWdvcmllcyBcIiArIG9wZXJhdG9yICsgXCIgXFxcIlwiICsgZnJhZ21lbnQgKyBcIlxcXCIgYXJlIC4uLlxcblwiICsgcmVzKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxCaW5PcFwiLCBzZXNzaW9uLCBzZW5kKCdJIGhhdmUgbm8gY2F0ZWdvcmllcyAnICsgb3BlcmF0b3IgKyAnIFwiJyArIGZyYWdtZW50ICsgJ1wiJykpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChjYXRlZ29yeVdvcmQgPT09IFwiZG9tYWluc1wiKSB7XG4gICAgICAgICAgICAgICAgdmFyIGFSZXMgPSBMaXN0QWxsLmZpbHRlclN0cmluZ0xpc3RCeU9wKG9wZXJhdG9yQXJncywgZnJhZ21lbnQsIHRoZU1vZGVsLmRvbWFpbnMpO1xuICAgICAgICAgICAgICAgIHJlcyA9IHJlc3RyaWN0TG9nZ2VkT24oc2Vzc2lvbiwgYVJlcykuam9pbihcIjtcXG5cIik7XG4gICAgICAgICAgICAgICAgaWYgKHJlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbEJpbk9wXCIsIHNlc3Npb24sIHNlbmQoXCJteSBkb21haW5zIFwiICsgb3BlcmF0b3IgKyAnIFwiJyArIGZyYWdtZW50ICsgJ1wiIGFyZSAuLi5cXG4nICsgcmVzKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsQmluT3BcIiwgc2Vzc2lvbiwgc2VuZCgnSSBoYXZlIG5vIGRvbWFpbnMgJyArIG9wZXJhdG9yICsgJyBcIicgKyBmcmFnbWVudCArICdcIicpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoY2F0ZWdvcnlXb3JkID09PSBcInRvb2xzXCIpIHtcbiAgICAgICAgICAgICAgICB2YXIgYVJlcyA9IExpc3RBbGwuZmlsdGVyU3RyaW5nTGlzdEJ5T3Aob3BlcmF0b3JBcmdzLCBmcmFnbWVudCwgdGhlTW9kZWwudG9vbHMubWFwKGZ1bmN0aW9uIChvVG9vbCkgeyByZXR1cm4gb1Rvb2wubmFtZTsgfSkpO1xuICAgICAgICAgICAgICAgIHZhciByZXMgPSByZXN0cmljdExvZ2dlZE9uKHNlc3Npb24sIGFSZXMpLmpvaW4oXCI7XFxuXCIpO1xuICAgICAgICAgICAgICAgIGlmIChyZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxCaW5PcFwiLCBzZXNzaW9uLCBzZW5kKFwibXkgdG9vbHMgXCIgKyBvcGVyYXRvciArICcgXCInICsgZnJhZ21lbnQgKyAnXCIgYXJlIC4uLlxcbicgKyByZXMpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxCaW5PcFwiLCBzZXNzaW9uLCBzZW5kKFwiSSBoYXZlIG5vIHRvb2xzIFwiICsgb3BlcmF0b3IgKyAnIFwiJyArIGZyYWdtZW50ICsgJ1wiJykpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YXIgY2F0ID0gV2hhdElzLmFuYWx5emVDYXRlZ29yeShjYXRlZ29yeVdvcmQsIHRoZU1vZGVsLnJ1bGVzLCBtZXNzYWdlKTtcbiAgICAgICAgICAgICAgICBpZiAoIWNhdCkge1xuICAgICAgICAgICAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsQmluT3BcIiwgc2Vzc2lvbiwgc2VuZCgnSSBkb25cXCd0IGtub3cgYW55dGhpbmcgYWJvdXQgXCInICsgY2F0ZWdvcnlXb3JkICsgJ1wiJykpO1xuICAgICAgICAgICAgICAgICAgICAvLyBuZXh0KCk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZGVidWdsb2coJ2NhdGVnb3J5IGlkZW50aWZpZWQ6JyArIGNhdCk7XG4gICAgICAgICAgICAgICAgdmFyIGFSZXMgPSBMaXN0QWxsLmdldENhdGVnb3J5T3BGaWx0ZXJBc0Rpc3RpbmN0U3RyaW5ncyhvcGVyYXRvckFyZ3MsIGZyYWdtZW50LCBjYXRlZ29yeSwgdGhlTW9kZWwucmVjb3JkcywgZmlsdGVyRG9tYWluKTtcbiAgICAgICAgICAgICAgICB2YXIgcmVzID0gcmVzdHJpY3RMb2dnZWRPbihzZXNzaW9uLCBhUmVzKS5qb2luKFwiO1xcblwiKTtcbiAgICAgICAgICAgICAgICB2YXIgaW5maXhFeHBsYWluID0gJyc7XG4gICAgICAgICAgICAgICAgaWYgKCFMaXN0QWxsLmxpa2VseVBsdXJhbERpZmYoY2F0ZWdvcnksIGNhdGVnb3J5V29yZCkpIHtcbiAgICAgICAgICAgICAgICAgICAgaW5maXhFeHBsYWluID0gJyhcIicgKyBjYXRlZ29yeSArICdcIiknO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBpZiAocmVzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBpZiAoZmlsdGVyRG9tYWluKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsQmluT3BcIiwgc2Vzc2lvbiwgc2VuZChcIm15IFwiICsgY2F0ZWdvcnlXb3JkICsgaW5maXhFeHBsYWluICsgXCIgXCIgKyBvcGVyYXRvciArIFwiIFxcXCJcIiArIGZyYWdtZW50ICsgXCJcXFwiIGluIGRvbWFpbiBcXFwiXCIgKyBmaWx0ZXJEb21haW4gKyBcIlxcXCIgYXJlIC4uLlxcblwiICsgcmVzKSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsQmluT3BcIiwgc2Vzc2lvbiwgc2VuZChcIm15IFwiICsgY2F0ZWdvcnlXb3JkICsgaW5maXhFeHBsYWluICsgXCIgXCIgKyBvcGVyYXRvciArIFwiIFxcXCJcIiArIGZyYWdtZW50ICsgXCJcXFwiIGFyZSAuLi5cXG5cIiArIHJlcykpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsQmluT3BcIiwgc2Vzc2lvbiwgc2VuZCgnSSBoYXZlIG5vICcgKyBjYXRlZ29yeVdvcmQgKyBpbmZpeEV4cGxhaW4gKyAnICcgKyBvcGVyYXRvciArICcgXCInICsgZnJhZ21lbnQgKyAnXCInKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIF0pO1xuICAgIGRpYWxvZy5tYXRjaGVzKCdUcmFpbk1lJywgW1xuICAgICAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgYXJncywgbmV4dCkge1xuICAgICAgICAgICAgdmFyIGlzQ29tYmluZWRJbmRleCA9IHt9O1xuICAgICAgICAgICAgdmFyIG9OZXdFbnRpdHk7XG4gICAgICAgICAgICAvLyBleHBlY3RpbmcgZW50aXR5IEExXG4gICAgICAgICAgICB2YXIgbWVzc2FnZSA9IHNlc3Npb24ubWVzc2FnZS50ZXh0O1xuICAgICAgICAgICAgZGVidWdsb2coXCJJbnRlbnQgOiBUcmFpblwiKTtcbiAgICAgICAgICAgIGRlYnVnbG9nKCdyYXc6ICcgKyBKU09OLnN0cmluZ2lmeShhcmdzLmVudGl0aWVzKSwgdW5kZWZpbmVkLCAyKTtcbiAgICAgICAgICAgIHZhciBjYXRlZ29yeUVudGl0eSA9IGJ1aWxkZXIuRW50aXR5UmVjb2duaXplci5maW5kRW50aXR5KGFyZ3MuZW50aXRpZXMsICdjYXRlZ29yaWVzJyk7XG4gICAgICAgICAgICBpZiAobWVzc2FnZS50b0xvd2VyQ2FzZSgpLmluZGV4T2YoXCJrcm9ub3NcIikgPj0gMCB8fCBtZXNzYWdlLnRvTG93ZXJDYXNlKCkuaW5kZXhPZihcImtsaW5nb25cIikgPj0gMCkge1xuICAgICAgICAgICAgICAgIGRpYWxvZ2xvZyhcIlRyYWluTWVcIiwgc2Vzc2lvbiwgc2VuZChnZXRSYW5kb21SZXN1bHQoYVRyYWluTm9LbGluZ29uKSkpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciByZXMgPSBnZXRSYW5kb21SZXN1bHQoYVRyYWluUmVwbGllcyk7XG4gICAgICAgICAgICBkaWFsb2dsb2coXCJUcmFpbk1lXCIsIHNlc3Npb24sIHNlbmQocmVzKSk7XG4gICAgICAgIH1cbiAgICBdKTtcbiAgICBkaWFsb2cubWF0Y2hlcygnVG9vTG9uZycsIFtcbiAgICAgICAgZnVuY3Rpb24gKHNlc3Npb24sIGFyZ3MsIG5leHQpIHtcbiAgICAgICAgICAgIHZhciBpc0NvbWJpbmVkSW5kZXggPSB7fTtcbiAgICAgICAgICAgIHZhciBvTmV3RW50aXR5O1xuICAgICAgICAgICAgLy8gZXhwZWN0aW5nIGVudGl0eSBBMVxuICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSBzZXNzaW9uLm1lc3NhZ2UudGV4dDtcbiAgICAgICAgICAgIGRlYnVnbG9nKFwiSW50ZW50IDogVG9vTG9uZ1wiKTtcbiAgICAgICAgICAgIGRlYnVnbG9nKCdyYXc6ICcgKyBKU09OLnN0cmluZ2lmeShhcmdzLmVudGl0aWVzKSwgdW5kZWZpbmVkLCAyKTtcbiAgICAgICAgICAgIHZhciBjYXRlZ29yeUVudGl0eSA9IGJ1aWxkZXIuRW50aXR5UmVjb2duaXplci5maW5kRW50aXR5KGFyZ3MuZW50aXRpZXMsICdjYXRlZ29yaWVzJyk7XG4gICAgICAgICAgICBkaWFsb2dsb2coXCJUb29Mb25nXCIsIHNlc3Npb24sIHNlbmQoZ2V0UmFuZG9tUmVzdWx0KGV4cG9ydHMuYVJlc3BvbnNlc09uVG9vTG9uZykpKTtcbiAgICAgICAgfVxuICAgIF0pO1xuICAgIGRpYWxvZy5tYXRjaGVzKCdXcm9uZycsIFtcbiAgICAgICAgZnVuY3Rpb24gKHNlc3Npb24sIGFyZ3MsIG5leHQpIHtcbiAgICAgICAgICAgIC8qXG4gICAgICAgICAgICBkaWFsb2dMb2dnZXIoe1xuICAgICAgICAgICAgICBzZXNzaW9uOiBzZXNzaW9uLFxuICAgICAgICAgICAgICBpbnRlbnQ6IFwiV3JvbmdcIixcbiAgICAgICAgICAgICAgcmVzcG9uc2U6ICc8YmVnaW4gdXBkb3duPidcbiAgICAgICAgICAgIH0pOyAqL1xuICAgICAgICAgICAgc2Vzc2lvbi5iZWdpbkRpYWxvZygnL3VwZG93bicsIHNlc3Npb24udXNlckRhdGEuY291bnQpO1xuICAgICAgICB9LFxuICAgICAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgcmVzdWx0cywgbmV4dCkge1xuICAgICAgICAgICAgdmFyIGFsYXJtID0gc2Vzc2lvbi5kaWFsb2dEYXRhLmFsYXJtO1xuICAgICAgICAgICAgbmV4dCgpO1xuICAgICAgICB9LFxuICAgICAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgcmVzdWx0cykge1xuICAgICAgICAgICAgc2Vzc2lvbi5zZW5kKGdldFJhbmRvbVJlc3VsdChhQmFja0Zyb21UcmFpbmluZykpOyAvLyAgKyBKU09OLnN0cmluZ2lmeShyZXN1bHRzKSk7XG4gICAgICAgICAgICAvL3Nlc3Npb24uc2VuZCgnZW5kIG9mIHdyb25nJyk7XG4gICAgICAgIH1cbiAgICBdKTtcbiAgICBkaWFsb2cubWF0Y2hlcygnRXhpdCcsIFtcbiAgICAgICAgZnVuY3Rpb24gKHNlc3Npb24sIGFyZ3MsIG5leHQpIHtcbiAgICAgICAgICAgIGRlYnVnbG9nKCdleGl0IDonKTtcbiAgICAgICAgICAgIGRlYnVnbG9nKCdleGl0JyArIEpTT04uc3RyaW5naWZ5KGFyZ3MuZW50aXRpZXMpKTtcbiAgICAgICAgICAgIGRpYWxvZ0xvZ2dlcih7XG4gICAgICAgICAgICAgICAgc2Vzc2lvbjogc2Vzc2lvbixcbiAgICAgICAgICAgICAgICBpbnRlbnQ6IFwiRXhpdFwiLFxuICAgICAgICAgICAgICAgIHJlc3BvbnNlOiAneW91IGFyZSBpbiBhIGxvZ2ljIGxvb3AnXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHNlc3Npb24uc2VuZChcInlvdSBhcmUgaW4gYSBsb2dpYyBsb29wIFwiKTtcbiAgICAgICAgfVxuICAgIF0pO1xuICAgIGRpYWxvZy5tYXRjaGVzKCdIZWxwJywgW1xuICAgICAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgYXJncywgbmV4dCkge1xuICAgICAgICAgICAgZGVidWdsb2coJ2hlbHAgOicpO1xuICAgICAgICAgICAgZGVidWdsb2coJ2hlbHAnKTtcbiAgICAgICAgICAgIHNlc3Npb24uc2VuZChcIkkga25vdyBhYm91dCAuLi4uIDxjYXRlZ29yaWVzPj5cIik7XG4gICAgICAgIH1cbiAgICBdKTtcbiAgICAvKlxuICAgICAgLy8gQWRkIGludGVudCBoYW5kbGVyc1xuICAgICAgZGlhbG9nLm1hdGNoZXMoJ3RyYWluJywgW1xuICAgICAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgYXJncywgbmV4dCkge1xuICAgICAgICAgIGRlYnVnbG9nKCd0cmFpbicpO1xuICAgICAgICAgIC8vIFJlc29sdmUgYW5kIHN0b3JlIGFueSBlbnRpdGllcyBwYXNzZWQgZnJvbSBMVUlTLlxuICAgICAgICAgIHZhciB0aXRsZSA9IGJ1aWxkZXIuRW50aXR5UmVjb2duaXplci5maW5kRW50aXR5KGFyZ3MuZW50aXRpZXMsICdidWlsdGluLmFsYXJtLnRpdGxlJyk7XG4gICAgICAgICAgdmFyIHRpbWUgPSBidWlsZGVyLkVudGl0eVJlY29nbml6ZXIucmVzb2x2ZVRpbWUoYXJncy5lbnRpdGllcyk7XG4gICAgICAgICAgdmFyIGFsYXJtID0gc2Vzc2lvbi5kaWFsb2dEYXRhLmFsYXJtID0ge1xuICAgICAgICAgICAgdGl0bGU6IHRpdGxlID8gdGl0bGUuZW50aXR5IDogbnVsbCxcbiAgICAgICAgICAgIHRpbWVzdGFtcDogdGltZSA/IHRpbWUuZ2V0VGltZSgpIDogbnVsbFxuICAgICAgICAgIH07XG4gICAgICAgICAgLy8gUHJvbXB0IGZvciB0aXRsZVxuICAgICAgICAgIGlmICghYWxhcm0udGl0bGUpIHtcbiAgICAgICAgICAgIGRpYWxvZ0xvZ2dlcih7XG4gICAgICAgICAgICAgIHNlc3Npb246IHNlc3Npb24sXG4gICAgICAgICAgICAgIGludGVudDogXCJ0cmFpblwiLFxuICAgICAgICAgICAgICByZXNwb25zZTogJ1doYXQgZmFjdCB3b3VsZCB5b3UgbGlrZSB0byB0cmFpbj8nXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIGJ1aWxkZXIuUHJvbXB0cy50ZXh0KHNlc3Npb24sICdXaGF0IGZhY3Qgd291bGQgeW91IGxpa2UgdG8gdHJhaW4/Jyk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIG5leHQoKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGZ1bmN0aW9uIChzZXNzaW9uLCByZXN1bHRzLCBuZXh0KSB7XG4gICAgICAgICAgdmFyIGFsYXJtID0gc2Vzc2lvbi5kaWFsb2dEYXRhLmFsYXJtO1xuICAgICAgICAgIGlmIChyZXN1bHRzLnJlc3BvbnNlKSB7XG4gICAgICAgICAgICBhbGFybS50aXRsZSA9IHJlc3VsdHMucmVzcG9uc2U7XG4gICAgICAgICAgfVxuICAgIFxuICAgICAgICAgIC8vIFByb21wdCBmb3IgdGltZSAodGl0bGUgd2lsbCBiZSBibGFuayBpZiB0aGUgdXNlciBzYWlkIGNhbmNlbClcbiAgICAgICAgICBpZiAoYWxhcm0udGl0bGUgJiYgIWFsYXJtLnRpbWVzdGFtcCkge1xuICAgIFxuICAgIFxuICAgICAgICAgICAgYnVpbGRlci5Qcm9tcHRzLnRpbWUoc2Vzc2lvbiwgJ1doYXQgdGltZSB3b3VsZCB5b3UgbGlrZSB0byBzZXQgdGhlIGFsYXJtIGZvcj8nKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgbmV4dCgpO1xuICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZnVuY3Rpb24gKHNlc3Npb24sIHJlc3VsdHMpIHtcbiAgICAgICAgICB2YXIgYWxhcm0gPSBzZXNzaW9uLmRpYWxvZ0RhdGEuYWxhcm07XG4gICAgICAgICAgaWYgKHJlc3VsdHMucmVzcG9uc2UpIHtcbiAgICAgICAgICAgIHZhciB0aW1lID0gYnVpbGRlci5FbnRpdHlSZWNvZ25pemVyLnJlc29sdmVUaW1lKFtyZXN1bHRzLnJlc3BvbnNlXSk7XG4gICAgICAgICAgICBhbGFybS50aW1lc3RhbXAgPSB0aW1lID8gdGltZS5nZXRUaW1lKCkgOiBudWxsO1xuICAgICAgICAgIH1cbiAgICAgICAgICAvLyBTZXQgdGhlIGFsYXJtIChpZiB0aXRsZSBvciB0aW1lc3RhbXAgaXMgYmxhbmsgdGhlIHVzZXIgc2FpZCBjYW5jZWwpXG4gICAgICAgICAgaWYgKGFsYXJtLnRpdGxlICYmIGFsYXJtLnRpbWVzdGFtcCkge1xuICAgICAgICAgICAgLy8gU2F2ZSBhZGRyZXNzIG9mIHdobyB0byBub3RpZnkgYW5kIHdyaXRlIHRvIHNjaGVkdWxlci5cbiAgICAgICAgICAgIGFsYXJtLmFkZHJlc3MgPSBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzcztcbiAgICAgICAgICAgIC8vYWxhcm1zW2FsYXJtLnRpdGxlXSA9IGFsYXJtO1xuICAgIFxuICAgICAgICAgICAgLy8gU2VuZCBjb25maXJtYXRpb24gdG8gdXNlclxuICAgICAgICAgICAgdmFyIGRhdGUgPSBuZXcgRGF0ZShhbGFybS50aW1lc3RhbXApO1xuICAgICAgICAgICAgdmFyIGlzQU0gPSBkYXRlLmdldEhvdXJzKCkgPCAxMjtcbiAgICAgICAgICAgIHNlc3Npb24uc2VuZCgnQ3JlYXRpbmcgYWxhcm0gbmFtZWQgXCIlc1wiIGZvciAlZC8lZC8lZCAlZDolMDJkJXMnLFxuICAgICAgICAgICAgICBhbGFybS50aXRsZSxcbiAgICAgICAgICAgICAgZGF0ZS5nZXRNb250aCgpICsgMSwgZGF0ZS5nZXREYXRlKCksIGRhdGUuZ2V0RnVsbFllYXIoKSxcbiAgICAgICAgICAgICAgaXNBTSA/IGRhdGUuZ2V0SG91cnMoKSA6IGRhdGUuZ2V0SG91cnMoKSAtIDEyLCBkYXRlLmdldE1pbnV0ZXMoKSwgaXNBTSA/ICdhbScgOiAncG0nKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgc2Vzc2lvbi5zZW5kKCdPay4uLiBubyBwcm9ibGVtLicpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgXSk7XG4gICAgKi9cbiAgICBkaWFsb2cub25EZWZhdWx0KGZ1bmN0aW9uIChzZXNzaW9uKSB7XG4gICAgICAgIGxvZ1F1ZXJ5KHNlc3Npb24sIFwib25EZWZhdWx0XCIpO1xuICAgICAgICB2YXIgZWxpemEgPSBnZXRFbGl6YUJvdChnZXRDb252ZXJzYXRpb25JZChzZXNzaW9uKSk7XG4gICAgICAgIHZhciByZXBseSA9IGVsaXphLnRyYW5zZm9ybShzZXNzaW9uLm1lc3NhZ2UudGV4dCk7XG4gICAgICAgIGRpYWxvZ2xvZyhcImVsaXphXCIsIHNlc3Npb24sIHNlbmQocmVwbHkpKTtcbiAgICAgICAgLy9uZXcgRWlsemFib3RcbiAgICAgICAgLy9zZXNzaW9uLnNlbmQoXCJJIGRvIG5vdCB1bmRlcnN0YW5kIHRoaXMgYXQgYWxsXCIpO1xuICAgICAgICAvL2J1aWxkZXIuRGlhbG9nQWN0aW9uLnNlbmQoJ0lcXCdtIHNvcnJ5IEkgZGlkblxcJ3QgdW5kZXJzdGFuZC4gSSBjYW4gb25seSBzaG93IHN0YXJ0IGFuZCByaW5nJyk7XG4gICAgfSk7XG4gICAgLypcbiAgICAvLyBWZXJ5IHNpbXBsZSBhbGFybSBzY2hlZHVsZXJcbiAgICB2YXIgYWxhcm1zID0ge307XG4gICAgc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIG5vdyA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICAgICAgZm9yICh2YXIga2V5IGluIGFsYXJtcykge1xuICAgICAgICB2YXIgYWxhcm0gPSBhbGFybXNba2V5XTtcbiAgICAgICAgaWYgKG5vdyA+PSBhbGFybS50aW1lc3RhbXApIHtcbiAgICAgICAgICB2YXIgbXNnID0gbmV3IGJ1aWxkZXIuTWVzc2FnZSgpXG4gICAgICAgICAgICAuYWRkcmVzcyhhbGFybS5hZGRyZXNzKVxuICAgICAgICAgICAgLnRleHQoJ0hlcmVcXCdzIHlvdXIgXFwnJXNcXCcgYWxhcm0uJywgYWxhcm0udGl0bGUpO1xuICAgICAgICAgIGJvdC5zZW5kKG1zZyk7XG4gICAgICAgICAgZGVsZXRlIGFsYXJtc1trZXldO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSwgMTUwMDApO1xuICAgICovXG59XG5pZiAobW9kdWxlKSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSB7XG4gICAgICAgIFNpbXBsZVVwRG93blJlY29nbml6ZXI6IFNpbXBsZVVwRG93blJlY29nbml6ZXIsXG4gICAgICAgIGFSZXNwb25zZXNPblRvb0xvbmc6IGV4cG9ydHMuYVJlc3BvbnNlc09uVG9vTG9uZyxcbiAgICAgICAgbWV0YXdvcmRzRGVzY3JpcHRpb25zOiBleHBvcnRzLm1ldGF3b3Jkc0Rlc2NyaXB0aW9ucyxcbiAgICAgICAgbWFrZUJvdDogbWFrZUJvdFxuICAgIH07XG59XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
