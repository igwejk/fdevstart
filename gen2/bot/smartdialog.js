/**
 * The bot implementation
 *
 * Instantiate apssing a connector via
 * makeBot
 *
 */
/**
 * @file
 * @module jfseb.fdevstart.smartdialog
 * @copyright (c) 2016 Gerd Forstmann
 */
//declare module 'elizabot' { };
//declare module 'winston-pg' { };
//delcare module 'winston' {};
"use strict";

var builder = require('botbuilder');
var debug = require('debug');
var Match = require('../match/match');
var Analyze = require('../match/analyze');
var BreakDown = require('../match/breakdown');
var WhatIs = require('../match/whatis');
var ListAll = require('../match/listall');
var DialogLogger = require('../utils/dialoglogger');
var process = require('process');
var dburl = process.env.DATABASE_URL || "";
var pglocalurl = "postgres://joe:abcdef@localhost:5432/abot";
var dburl = process.env.DATABASE_URL || pglocalurl;
var pg = require('pg');
var o = pg;
o.defaults.ssl = true;
var dialogLogger = DialogLogger.logger("smartbot", dburl, pg);
function send(o) {
    return o;
}
;
function dialoglog(intent, session, response) {
    var sResponse;
    var sAction;
    if (typeof response === "string") {
        sAction = "";
        sResponse = response;
    } else {
        var aMessage = response;
        var iMessage = aMessage.toMessage();
        sResponse = iMessage.text;
        sAction = iMessage.entities && iMessage.entities[0] ? JSON.stringify(iMessage.entities && iMessage.entities[0]) : "";
    }
    dialogLogger({
        intent: intent,
        session: session,
        response: sResponse,
        action: sAction
    });
    session.send(response);
}
//const pgLogger = new PgLogger({
//  name: 'test-logger',
//  level: 'debug',
//  connString: 'postgres://ubuntu@localhost:5432/circle_test',
//  tableName: 'winston_logs',
//});
//winston.add(winston.transports.File, { filename: 'winston_out.log', timestamp : true });
//  winston.remove(winston.transports.Console);
//winston.add(pgLogger);
/*
const logger = new winston.Logger({
  transports: [
    new winston.transports.Console({
      color: true,
      timestamp: true,
    }),
    pgLogger,
  ]
});
*/
//pgLogger.initTable(done);
var elizabot = require('../extern/elizabot/elizabot.js');
//import * as elizabot from 'elizabot';
var debuglog = debug('smartdialog');
var PlainRecognizer = require('./plainrecognizer');
//var builder = require('botbuilder');
var dispatcher = require('../match/dispatcher.js').dispatcher;
function getConversationId(session) {
    return session.message && session.message.address && session.message.address.conversation.id;
}
var elizabots = {};
function getElizaBot(id) {
    if (!elizabots[id]) {
        elizabots[id] = {
            access: new Date(),
            elizabot: new elizabot()
        };
    }
    elizabots[id].access = new Date();
    return elizabots[id].elizabot;
}
var newFlow = true;
var Model = require('../model/model');
var ExecServer = require('../exec/execserver');
var theDefaultModel = Model.loadModels();
var models = {};
function loadModel(modelPath) {
    modelPath = modelPath || "";
    if (!models[modelPath]) {
        models[modelPath] = Model.loadModels(modelPath);
    }
    return models[modelPath];
}
if (newFlow) {} else {}
function isAnonymous(userid) {
    return userid.indexOf("ano:") === 0;
}
function restrictLoggedOn(session, arr) {
    var userid = session.message.address && session.message.address.user && session.message.address.user.id || "";
    if (process.env.ABOT_EMAIL_USER && isAnonymous(userid)) {
        if (arr.length < 6) {
            return arr;
        }
        var len = arr.length;
        var res = arr.slice(0, Math.min(Math.max(Math.floor(arr.length / 3), 7), arr.length));
        if (typeof arr[0] === "string") {
            var delta = len - res.length;
            res.push("... and " + delta + " more entries for registered users");
        }
        return res;
    }
    return arr;
}
/*
export class SimpleRecognizer implements builder.IIntentRecognizer {
  constructor() {

  }

  recognize(context: builder.IRecognizeContext, callback: (err: Error, result: builder.IIntentRecognizerResult) => void): void {
    var u = {} as builder.IIntentRecognizerResult;

    debuglog("recognizing " + context.message.text);
    if (context.message.text.indexOf("start") >= 0) {
      u.intent = "ShowEntity";
      u.score = 0.9;
      var e1 = {} as builder.IEntity;
      e1.startIndex = "start ".length;
      e1.endIndex = context.message.text.length;
      e1.score = 0.3;
      u.entities = [e1];
      callback(undefined, u);
      return;
    }

    if (context.message.text.indexOf("train") >= 0) {
      u.intent = "train";
      u.score = 0.9;
      var e1 = {} as builder.IEntity;
      e1.startIndex = "train ".length;
      e1.endIndex = context.message.text.length;
      e1.score = 0.3;
      u.entities = [e1];
      callback(undefined, u);
      return;
    }
    if (context.message.text.indexOf("learn") >= 0) {
      u.intent = "learn";
      u.score = 0.9;
      var e1 = {} as builder.IEntity;
      e1.type = "trainFact";
      e1.startIndex = "train ".length;
      e1.endIndex = context.message.text.length;
      e1.score = 0.3;
      u.entities = [e1];
      callback(undefined, u);
      return;
    }
    if (context.message.text.indexOf("help") >= 0) {
      u.intent = "help";
      u.score = 0.9;
      var e1 = {} as builder.IEntity;
      e1.startIndex = "train ".length;
      e1.endIndex = context.message.text.length;
      e1.score = 0.3;
      u.entities = [e1];
      callback(undefined, u);
      return;
    }
    if (context.message.text.indexOf("exit") >= 0) {
      u.intent = "exit";
      u.score = 0.9;
      var e1 = {} as builder.IEntity;
      e1.startIndex = "exit ".length;
      e1.endIndex = context.message.text.length;
      e1.score = 0.3;
      u.entities = [e1];
      callback(undefined, u);
      return;
    }
    if (context.message.text.indexOf("wrong") >= 0) {
      u.intent = "wrong";
      u.score = 0.9;
      var e1 = {} as builder.IEntity;
      e1.startIndex = "exit ".length;
      e1.endIndex = context.message.text.length;
      e1.score = 0.3;
      u.entities = [e1];
      callback(undefined, u);
      return;
    }
    debuglog('recognizing nothing');
    u.intent = "None";
    u.score = 0.1;
    var e1 = {} as builder.IEntity;
    e1.startIndex = "exit ".length;
    e1.endIndex = context.message.text.length;
    e1.score = 0.1;
    u.entities = [];
    callback(undefined, u);
  }
}
*/
var aTrainReplies = ["Thank you for sharing this suggestion with us", "Thank for for this valuable information.", "Thank for for this interesting fact!", "Thats a plethoria of information.", "That's a nugget of information.", "Lovely, I may consider you input.", "Well done, anything more to let me know?", "I do appreciate your teaching and my learning experience, or was it the other way round?", "Your helpful input has been stored in some dusty corner of the World wide web!", "Thank you for my learning experience!", "I have incorporated your valuable suggestion in the wisdom of the internet"];
var aTrainDialog = aTrainReplies;
var aTrainExitHint = ["\ntype \"done\" when you are done training me.", "", "", "", "\nremember, you are stuck here instructing me, type \"done\" to return.", ""];
var aEnterTrain = ["So you think this is wrong? You can offer your advise here.\n Type \"done\" if you are done with instructing me", "Feel free to offer me your better solution here.\n", "Some say \"The secret to happiness is to lower your expectations to the point they are already met.\", \nt if you could help me to becomde better, instruct me.", "Feel free to offer me your better solution here.\n Type \"done\" if you are done with instructing me", "Feel free to offer me your better solution here.\n Type \"done\" if you are done with instructing me"];
var aBackFromTraining = ["Puuh, back from training! Now for the easy part ...", "Live and don't learn, that's us. Naah, we'll see.", "The secret to happiness is to lower your expectations to the point they are already met.", "Thanks for having this lecture session, now back to our usual self."];
var aTrainNoKlingon = ["He who master the dark arts of SAP must not dwell in the earthly realms of Start Trek.", "SAP is a cloud company, not a space company.", "The depth of R/3 are deeper than Deep Space 42.", "My brainpower is fully absorbed with mastering other realms.", "For the wosap, the sky is the limit. Feel free to check out nasa.gov .", "The future is SAP or IBM blue, not space black.", "That's left to some musky future."];
function getRandomResult(arr) {
    return arr[Math.floor(Math.random() * arr.length) % arr.length];
}
var SimpleUpDownRecognizer = function () {
    function SimpleUpDownRecognizer() {}
    SimpleUpDownRecognizer.prototype.recognize = function (context, callback) {
        var u = {};
        debuglog("recognizing " + context.message.text);
        if (context.message.text.indexOf("down") >= 0) {
            u.intent = "intent.down";
            u.score = 0.9;
            var e1 = {};
            e1.startIndex = "start ".length;
            e1.endIndex = context.message.text.length;
            e1.score = 0.3;
            u.entities = [e1];
            callback(undefined, u);
            return;
        }
        if (context.message.text.indexOf("up") >= 0) {
            u.intent = "intent.up";
            u.score = 0.9;
            var e1 = {};
            e1.startIndex = "up".length;
            e1.endIndex = context.message.text.length;
            e1.score = 0.3;
            u.entities = [e1];
            callback(undefined, u);
            return;
        }
        if (context.message.text.indexOf("done") >= 0) {
            u.intent = "intent.up";
            u.score = 0.9;
            var e1 = {};
            e1.startIndex = "up".length;
            e1.endIndex = context.message.text.length;
            e1.score = 0.3;
            u.entities = [e1];
            callback(undefined, u);
            return;
        }
        if (context.message.text.indexOf("exit") >= 0) {
            u.intent = "intent.up";
            u.score = 0.9;
            var e1 = {};
            e1.startIndex = "up".length;
            e1.endIndex = context.message.text.length;
            e1.score = 0.3;
            u.entities = [e1];
            callback(undefined, u);
            return;
        }
        if (context.message.text.indexOf("quit") >= 0) {
            u.intent = "intent.up";
            u.score = 0.9;
            var e1 = {};
            e1.startIndex = "up".length;
            e1.endIndex = context.message.text.length;
            e1.score = 0.3;
            u.entities = [e1];
            callback(undefined, u);
            return;
        }
        debuglog('recognizing nothing');
        u.intent = "None";
        u.score = 0.1;
        var e1 = {};
        e1.startIndex = "exit ".length;
        e1.endIndex = context.message.text.length;
        e1.score = 0.1;
        u.entities = [];
        callback(undefined, u);
    };
    return SimpleUpDownRecognizer;
}();
exports.SimpleUpDownRecognizer = SimpleUpDownRecognizer;
var AnyObject = Object;
// globalTunnel.initialize({
//  host: 'proxy.exxxample.com',
//  port: 8080
// })
// Create bot and bind to console
// var connector = new htmlconnector.HTMLConnector()
// connector.setAnswerHook(function (sAnswer) {
//  console.log('Got answer : ' + sAnswer + '\n')
// })
var bot;
// setTimeout(function () {
//   connector.processMessage('start unit test ABC ')
// }, 5000)
var fs = require('fs');
var oJSON = JSON.parse('' + fs.readFileSync('./resources/model/intents.json'));
var oRules = PlainRecognizer.parseRules(oJSON);
// var Recognizer = new (recognizer.RegExpRecognizer)(oRules);
function logQuery(session, intent, result) {
    fs.appendFile('./logs/showmequeries.txt', "\n" + JSON.stringify({
        text: session.message.text,
        timestamp: session.message.timestamp,
        intent: intent,
        res: result && result.length && Match.ToolMatch.dumpNice(result[0]) || "0",
        conversationId: session.message.address && session.message.address.conversation && session.message.address.conversation.id || "",
        userid: session.message.address && session.message.address.user && session.message.address.user.id || ""
    }), function (err, res) {
        if (err) {
            debuglog("logging failed " + err);
        }
    });
}
function logQueryWhatIs(session, intent, result) {
    fs.appendFile('./logs/showmequeries.txt', "\n" + JSON.stringify({
        text: session.message.text,
        timestamp: session.message.timestamp,
        intent: intent,
        res: result && result.length && WhatIs.dumpNice(result[0]) || "0",
        conversationId: session.message.address && session.message.address.conversation && session.message.address.conversation.id || "",
        userid: session.message.address && session.message.address.user && session.message.address.user.id || ""
    }), function (err, res) {
        if (err) {
            debuglog("logging failed " + err);
        }
    });
}
var gwords = {};
/**
 * Construct a bot
 * @param connector {Connector} the connector to use
 * HTMLConnector
 * or connector = new builder.ConsoleConnector().listen()
 */
function makeBot(connector, modelPath) {
    var theModel = loadModel(modelPath);
    bot = new builder.UniversalBot(connector);
    // Create LUIS recognizer that points at our model and add it as the root '/' dialog for our Cortana Bot.
    // var model = sensitive.modelurl;
    // var model = 'https://api.projectoxford.ai/luis/v2.0/apps/c413b2ef-382c-45bd-8ff0-f76d60e2a821?subscription-key=c21398b5980a4ce09f474bbfee93b892&q='
    var recognizer = new PlainRecognizer.RegExpRecognizer(oRules);
    var dialog = new builder.IntentDialog({ recognizers: [recognizer] });
    // dialog.onBegin(function(session,args) {
    // console.log("beginning ...")
    // session.dialogData.retryPrompt = args && args.retryPrompt || "I am sorry"
    // session.send("What do you want?")
    //
    // })
    var dialogUpDown = new builder.IntentDialog({ recognizers: [new SimpleUpDownRecognizer()] });
    bot.dialog('/updown', dialogUpDown);
    dialogUpDown.onBegin(function (session) {
        dialoglog("TrainMe", session, send(getRandomResult(aEnterTrain)));
        //session.send("Hi there, updown is waiting for you");
    });
    dialogUpDown.matches('intent.up', [function (session, args, next) {
        session.dialogData.abc = args || {};
        builder.Prompts.text(session, 'you want to exit training? type \"done\" again.');
    }, function (session, results, next) {
        session.dialogData.abc = results.reponse;
        next();
    }, function (session, results) {
        session.endDialogWithResult({ response: session.dialogData.abc });
    }]);
    dialogUpDown.matches('intent.down', [function (session, args, next) {
        session.dialogData.abc = args || {};
        builder.Prompts.text(session, 'you want to go down!');
    }, function (session, results, next) {
        session.dialogData.abc = -1; // results.reponse;
        next();
    }, function (session, results) {
        session.send("still going down?");
    }]);
    dialogUpDown.onDefault(function (session) {
        logQuery(session, "onDefault");
        var res = getRandomResult(aTrainDialog) + getRandomResult(aTrainExitHint);
        dialoglog("TrainMe", session, send(res));
    });
    bot.dialog('/train', [function (session, args, next) {
        session.dialgoData.abc = args || {};
        builder.Prompts.text(session, 'Do you want to train me');
    }, function (session, results, next) {
        session.dialogData.abc = results.reponse;
    }, function (session, results) {
        session.endDialogWithResult({ response: session.DialogData.abc });
    }]);
    bot.dialog('/', dialog);
    dialog.matches('ShowMe', [function (session, args, next) {
        var isCombinedIndex = {};
        var oNewEntity;
        // expecting entity A1
        debuglog("Show Entity");
        debuglog('raw: ' + JSON.stringify(args.entities), undefined, 2);
        var a1 = builder.EntityRecognizer.findEntity(args.entities, 'A1');
        var result = Analyze.analyzeAll(a1.entity, theModel.rules, theModel.tools, gwords);
        logQuery(session, 'ShowMe', result);
        // test.expect(3)
        //  test.deepEqual(result.weight, 120, 'correct weight');
        if (!result || result.length === 0) {
            next();
        }
        // debuglog('result : ' + JSON.stringify(result, undefined, 2));
        debuglog('best result : ' + JSON.stringify(result[0] || {}, undefined, 2));
        debuglog('top : ' + Match.ToolMatch.dumpWeightsTop(result, { top: 3 }));
        if (Analyze.isComplete(result[0])) {
            session.dialogData.result = result[0];
            //    session.send('Showing entity ...');
            next();
        } else if (Analyze.getPrompt(result[0])) {
            var prompt = Analyze.getPrompt(result[0]);
            session.dialogData.result = result[0];
            session.dialogData.prompt = prompt;
            dialoglog("ShowMe", session, send("Not enough information supplied: " + Match.ToolMatch.dumpNice(session.dialogData.result)));
            builder.Prompts.text(session, prompt.text);
        } else {
            var best = result.length ? Match.ToolMatch.dumpNice(result[0]) : "<nothing>";
            dialoglog("ShowMe", session, send('I did not understand this' + best));
        }
    }, function (session, results, next) {
        var result = session.dialogData.result;
        if (!result || result.length === 0) {
            next();
        }
        if (results.response) {
            // some prompting
            Analyze.setPrompt(session.dialogData.result, session.dialogData.prompt, results.response);
        }
        if (Analyze.isComplete(session.dialogData.result)) {
            next();
        } else if (Analyze.getPrompt(session.dialogData.result)) {
            var prompt = Analyze.getPrompt(session.dialogData.result);
            session.dialogData.prompt = prompt;
            builder.Prompts.text(session, prompt.text);
        }
    }, function (session, results, next) {
        var result = session.dialogData.result;
        if (results.response) {
            // some prompting
            Analyze.setPrompt(session.dialogData.result, session.dialogData.prompt, results.response);
        }
        if (Analyze.isComplete(session.dialogData.result)) {
            var exec = ExecServer.execTool(session.dialogData.result, theModel.records);
            var reply = new builder.Message(session).text(exec.text).addEntity(exec.action);
            // .addAttachment({ fallbackText: "I don't know", contentType: 'image/jpeg', contentUrl: "www.wombat.org" });
            dialoglog("ShowMe", session, send(reply));
        } else {
            if (session.dialogData.result) {
                dialoglog("ShowMe", session, send("Not enough information supplied: " + Match.ToolMatch.dumpNice(session.dialogData.result)));
            } else {
                dialoglog("ShowMe", session, send("I did not get what you want"));
            }
        }
    }]);
    dialog.matches('WhatIs', [function (session, args, next) {
        var isCombinedIndex = {};
        var oNewEntity;
        // expecting entity A1
        var message = session.message.text;
        debuglog("WhatIs Entities");
        debuglog('raw: ' + JSON.stringify(args.entities), undefined, 2);
        var categoryEntity = builder.EntityRecognizer.findEntity(args.entities, 'category');
        var category = categoryEntity.entity;
        var a1 = builder.EntityRecognizer.findEntity(args.entities, 'A1');
        var cat = WhatIs.analyzeCategory(category, theModel.rules, message);
        if (!cat) {
            session.send('I don\'t know anything about "' + category + '"');
            // next();
            return;
        }
        debuglog('category identified:' + cat);
        var result = WhatIs.resolveCategory(cat, a1.entity, theModel.rules, theModel.records);
        debuglog('whatis result:' + JSON.stringify(result));
        logQueryWhatIs(session, 'WhatIs', result);
        var indis = WhatIs.isIndiscriminateResult(result);
        if (indis) {
            session.send(indis);
            // next();
            return;
        }
        if (!result || result.length === 0) {
            dialoglog("WhatIs", session, send('I don\'t know anything about "' + cat + " (" + category + ')\" in relation to "' + a1.entity + '"'));
            // next();
            return;
        } else {
            // debuglog('result : ' + JSON.stringify(result, undefined, 2));
            debuglog('best result : ' + JSON.stringify(result[0] || {}, undefined, 2));
            debuglog('top : ' + WhatIs.dumpWeightsTop(result, { top: 3 }));
            // TODO cleansed sentence
            dialoglog("WhatIs", session, send('The ' + category + ' of ' + a1.entity + ' is ' + result[0].result + "\n")); //  + JSON.stringify(result[0]));
        }
    }]);
    dialog.matches('ListAll', [function (session, args, next) {
        var isCombinedIndex = {};
        var oNewEntity;
        // expecting entity A1
        var message = session.message.text;
        debuglog("Intent : ListAll");
        debuglog('raw: ' + JSON.stringify(args.entities), undefined, 2);
        var categoryEntity = builder.EntityRecognizer.findEntity(args.entities, 'categories');
        var category = categoryEntity.entity;
        var a1 = builder.EntityRecognizer.findEntity(args.entities, 'insth');
        if (category === "categories") {
            // do we have a filter ?
            var domain = undefined;
            if (a1 && a1.entity) {
                domain = ListAll.inferDomain(theModel, a1.entity);
            }
            if (!domain) {
                var res = restrictLoggedOn(session, theModel.category).join(";\n");
                if (a1 && a1.entity) {
                    dialoglog("ListAll", session, send("I did not infer a domain restriction from \"" + a1.entity + "\", all my categories are ...\n" + res));
                } else {
                    dialoglog("ListAll", session, send("my categories are ...\n" + res));
                }
                return;
            } else {
                var aRes = Model.getCategoriesForDomain(theModel, domain);
                var res = restrictLoggedOn(session, aRes).join(";\n");
                dialoglog("ListAll", session, send("my categories in domain \"" + domain + "\" are ...\n" + res));
                return;
            }
        }
        if (category === "domains") {
            var res = restrictLoggedOn(session, theModel.domains).join(";\n");
            dialoglog("ListAll", session, send("my domains are ...\n" + res));
            return;
        }
        if (category === "tools") {
            var res = restrictLoggedOn(session, theModel.tools).map(function (oTool) {
                return oTool.name;
            }).join(";\n");
            dialoglog("ListAll", session, send("my tools are ...\n" + res));
            return;
        }
        var cat = WhatIs.analyzeCategory(category, theModel.rules, message);
        if (!cat) {
            dialoglog("ListAll", session, send('I don\'t know anything about "' + category + '"'));
            // next();
            return;
        }
        debuglog('category identified:' + cat);
        if (a1 && a1.entity) {
            debuglog('got filter:' + a1.entity);
            var categorySet = Model.getAllRecordCategoriesForTargetCategory(theModel, cat, true);
            var result1 = ListAll.listAllWithContext(cat, a1.entity, theModel.rules, theModel.records, categorySet);
            // TODO classifying the string twice is a terrible waste
            if (!result1.length) {
                debuglog('going for having');
                var categorySetFull = Model.getAllRecordCategoriesForTargetCategory(theModel, cat, false);
                result1 = ListAll.listAllHavingContext(cat, a1.entity, theModel.rules, theModel.records, categorySetFull);
            }
            debuglog('listall result:' + JSON.stringify(result1));
            var joinresults = restrictLoggedOn(session, ListAll.joinResults(result1));
            logQueryWhatIs(session, 'ListAll', result1);
            if (joinresults.length) {
                dialoglog("ListAll", session, send("the " + category + " for " + a1.entity + " are ...\n" + joinresults.join(";\n")));
            } else {
                dialoglog("ListAll", session, send("i did not find any " + category + " for " + a1.entity + ".\n" + joinresults.join(";\n")));
            }
            return;
        } else {
            // no entity, e.g. list all countries
            //
            var categorySetFull = Model.getAllRecordCategoriesForTargetCategory(theModel, cat, false);
            var result = ListAll.listAllHavingContext(cat, cat, theModel.rules, theModel.records, categorySetFull);
            logQueryWhatIs(session, 'ListAll', result);
            if (result.length) {
                debuglog('listall result:' + JSON.stringify(result));
                var joinresults = [];
                debuglog("here is cat>" + cat);
                if (cat !== "example question") {
                    joinresults = restrictLoggedOn(session, ListAll.joinResults(result));
                } else {
                    joinresults = ListAll.joinResults(result);
                }
                var response = "the " + category + " are ...\n" + joinresults.join(";\n");
                dialoglog("ListAll", session, send(response));
                return;
            } else {
                var response = "Found no data having \"" + cat + "\"";
                dialoglog("ListAll", session, send(response));
                return;
            }
        }
    }]);
    dialog.matches('ListAllBinOp', [function (session, args, next) {
        var isCombinedIndex = {};
        var oNewEntity;
        // expecting entity A1
        var message = session.message.text;
        debuglog("Intent : ListAllBinOp");
        debuglog('raw: ' + JSON.stringify(args.entities), undefined, 2);
        var categoryEntity = builder.EntityRecognizer.findEntity(args.entities, 'category');
        var categoryWord = categoryEntity.entity;
        var opEntity = builder.EntityRecognizer.findEntity(args.entities, 'operator');
        var operatorWord = opEntity.entity;
        // categorize as operator ?
        var operator = WhatIs.analyzeOperator(operatorWord, theModel.rules, message);
        var category = WhatIs.analyzeCategory(categoryWord, theModel.rules, message);
        var operatorArgs = Model.getOperator(theModel, operator);
        var a2 = builder.EntityRecognizer.findEntity(args.entities, 'A2');
        if (!operator) {
            var s = "Unknown operator " + operatorWord + ", this is a model bug, check operators.json and intents.json";
            dialoglog("ListAllBinOp", session, send("ouch, this was in internal error. Recovering from a weird operator \"" + operatorWord + "\"\n"));
            throw new Error(s);
        }
        var fragment = a2 && a2.entity;
        fragment = BreakDown.trimQuoted(BreakDown.trimQuotedSpaced(fragment));
        debuglog("fragment after trimming \"" + fragment + "\"");
        if (categoryWord === "categories") {
            // do we have a filter?
            var aFilteredCategories = ListAll.filterStringListByOp(operatorArgs, fragment, theModel.category);
            res = restrictLoggedOn(session, aFilteredCategories).join(";\n");
            if (res.length) {
                dialoglog("ListAllBinOp", session, send("my categories " + operator + ' "' + fragment + '" are ...\n' + res));
            } else {
                dialoglog("ListAllBinOp", session, send('I have no categories ' + operator + ' "' + fragment + '"'));
            }
            return;
        } else if (categoryWord === "domains") {
            var aRes = ListAll.filterStringListByOp(operatorArgs, fragment, theModel.domains);
            res = restrictLoggedOn(session, aRes).join(";\n");
            if (res.length) {
                dialoglog("ListAllBinOp", session, send("my domains " + operator + ' "' + fragment + '" are ...\n' + res));
            } else {
                dialoglog("ListAllBinOp", session, send('I have no domains ' + operator + ' "' + fragment + '"'));
            }
            return;
        } else if (categoryWord === "tools") {
            var aRes = ListAll.filterStringListByOp(operatorArgs, fragment, theModel.tools.map(function (oTool) {
                return oTool.name;
            }));
            var res = restrictLoggedOn(session, aRes).join(";\n");
            if (res.length) {
                dialoglog("ListAllBinOp", session, send("my tools " + operator + ' "' + fragment + '" are ...\n' + res));
            } else {
                dialoglog("ListAllBinOp", session, send("I have no tools " + operator + ' "' + fragment + '"'));
            }
            return;
        } else {
            var cat = WhatIs.analyzeCategory(categoryWord, theModel.rules, message);
            if (!cat) {
                dialoglog("ListAllBinOp", session, send('I don\'t know anything about "' + categoryWord + '"'));
                // next();
                return;
            }
            debuglog('category identified:' + cat);
            var aRes = ListAll.getCategoryOpFilterAsDistinctStrings(operatorArgs, fragment, category, theModel.records);
            var res = restrictLoggedOn(session, aRes).join(";\n");
            var infixExplain = '';
            if (!ListAll.likelyPluralDiff(category, categoryWord)) {
                infixExplain = '("' + category + '")';
            }
            if (res.length) {
                dialoglog("ListAllBinOp", session, send('my ' + categoryWord + infixExplain + ' ' + operator + ' "' + fragment + '" are ...\n' + res));
            } else {
                dialoglog("ListAllBinOp", session, send('I have no ' + categoryWord + infixExplain + ' ' + operator + ' "' + fragment + '"'));
            }
            return;
        }
    }]);
    dialog.matches('TrainMe', [function (session, args, next) {
        var isCombinedIndex = {};
        var oNewEntity;
        // expecting entity A1
        var message = session.message.text;
        debuglog("Intent : Train");
        debuglog('raw: ' + JSON.stringify(args.entities), undefined, 2);
        var categoryEntity = builder.EntityRecognizer.findEntity(args.entities, 'categories');
        if (message.toLowerCase().indexOf("kronos") >= 0 || message.toLowerCase().indexOf("klingon") >= 0) {
            dialoglog("TrainMe", session, send(getRandomResult(aTrainNoKlingon)));
            return;
        }
        var res = getRandomResult(aTrainReplies);
        dialoglog("TrainMe", session, send(res));
    }]);
    dialog.matches('Wrong', [function (session, args, next) {
        dialogLogger({
            session: session,
            intent: "Wrong",
            response: '<begin updown>'
        });
        session.beginDialog('/updown', session.userData.count);
    }, function (session, results, next) {
        var alarm = session.dialogData.alarm;
        next();
    }, function (session, results) {
        session.send(getRandomResult(aBackFromTraining)); //  + JSON.stringify(results));
        //session.send('end of wrong');
    }]);
    dialog.matches('Exit', [function (session, args, next) {
        debuglog('exit :');
        debuglog('exit' + JSON.stringify(args.entities));
        dialogLogger({
            session: session,
            intent: "Exit",
            response: 'you are in a logic loop'
        });
        session.send("you are in a logic loop ");
    }]);
    dialog.matches('Help', [function (session, args, next) {
        debuglog('help :');
        debuglog('help');
        session.send("I know about .... <categories>>");
    }]);
    // Add intent handlers
    dialog.matches('train', [function (session, args, next) {
        debuglog('train');
        // Resolve and store any entities passed from LUIS.
        var title = builder.EntityRecognizer.findEntity(args.entities, 'builtin.alarm.title');
        var time = builder.EntityRecognizer.resolveTime(args.entities);
        var alarm = session.dialogData.alarm = {
            title: title ? title.entity : null,
            timestamp: time ? time.getTime() : null
        };
        // Prompt for title
        if (!alarm.title) {
            dialogLogger({
                session: session,
                intent: "train",
                response: 'What fact would you like to train?'
            });
            builder.Prompts.text(session, 'What fact would you like to train?');
        } else {
            next();
        }
    }, function (session, results, next) {
        var alarm = session.dialogData.alarm;
        if (results.response) {
            alarm.title = results.response;
        }
        // Prompt for time (title will be blank if the user said cancel)
        if (alarm.title && !alarm.timestamp) {
            builder.Prompts.time(session, 'What time would you like to set the alarm for?');
        } else {
            next();
        }
    }, function (session, results) {
        var alarm = session.dialogData.alarm;
        if (results.response) {
            var time = builder.EntityRecognizer.resolveTime([results.response]);
            alarm.timestamp = time ? time.getTime() : null;
        }
        // Set the alarm (if title or timestamp is blank the user said cancel)
        if (alarm.title && alarm.timestamp) {
            // Save address of who to notify and write to scheduler.
            alarm.address = session.message.address;
            //alarms[alarm.title] = alarm;
            // Send confirmation to user
            var date = new Date(alarm.timestamp);
            var isAM = date.getHours() < 12;
            session.send('Creating alarm named "%s" for %d/%d/%d %d:%02d%s', alarm.title, date.getMonth() + 1, date.getDate(), date.getFullYear(), isAM ? date.getHours() : date.getHours() - 12, date.getMinutes(), isAM ? 'am' : 'pm');
        } else {
            session.send('Ok... no problem.');
        }
    }]);
    dialog.onDefault(function (session) {
        logQuery(session, "onDefault");
        var eliza = getElizaBot(getConversationId(session));
        var reply = eliza.transform(session.message.text);
        dialoglog("eliza", session, send(reply));
        //new Eilzabot
        //session.send("I do not understand this at all");
        //builder.DialogAction.send('I\'m sorry I didn\'t understand. I can only show start and ring');
    });
    /*
    // Very simple alarm scheduler
    var alarms = {};
    setInterval(function () {
      var now = new Date().getTime();
      for (var key in alarms) {
        var alarm = alarms[key];
        if (now >= alarm.timestamp) {
          var msg = new builder.Message()
            .address(alarm.address)
            .text('Here\'s your \'%s\' alarm.', alarm.title);
          bot.send(msg);
          delete alarms[key];
        }
      }
    }, 15000);
    */
}
if (module) {
    module.exports = {
        SimpleUpDownRecognizer: SimpleUpDownRecognizer,
        makeBot: makeBot
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9ib3Qvc21hcnRkaWFsb2cudHMiLCJib3Qvc21hcnRkaWFsb2cuanMiXSwibmFtZXMiOlsiYnVpbGRlciIsInJlcXVpcmUiLCJkZWJ1ZyIsIk1hdGNoIiwiQW5hbHl6ZSIsIkJyZWFrRG93biIsIldoYXRJcyIsIkxpc3RBbGwiLCJEaWFsb2dMb2dnZXIiLCJwcm9jZXNzIiwiZGJ1cmwiLCJlbnYiLCJEQVRBQkFTRV9VUkwiLCJwZ2xvY2FsdXJsIiwicGciLCJvIiwiZGVmYXVsdHMiLCJzc2wiLCJkaWFsb2dMb2dnZXIiLCJsb2dnZXIiLCJzZW5kIiwiZGlhbG9nbG9nIiwiaW50ZW50Iiwic2Vzc2lvbiIsInJlc3BvbnNlIiwic1Jlc3BvbnNlIiwic0FjdGlvbiIsImFNZXNzYWdlIiwiaU1lc3NhZ2UiLCJ0b01lc3NhZ2UiLCJ0ZXh0IiwiZW50aXRpZXMiLCJKU09OIiwic3RyaW5naWZ5IiwiYWN0aW9uIiwiZWxpemFib3QiLCJkZWJ1Z2xvZyIsIlBsYWluUmVjb2duaXplciIsImRpc3BhdGNoZXIiLCJnZXRDb252ZXJzYXRpb25JZCIsIm1lc3NhZ2UiLCJhZGRyZXNzIiwiY29udmVyc2F0aW9uIiwiaWQiLCJlbGl6YWJvdHMiLCJnZXRFbGl6YUJvdCIsImFjY2VzcyIsIkRhdGUiLCJuZXdGbG93IiwiTW9kZWwiLCJFeGVjU2VydmVyIiwidGhlRGVmYXVsdE1vZGVsIiwibG9hZE1vZGVscyIsIm1vZGVscyIsImxvYWRNb2RlbCIsIm1vZGVsUGF0aCIsImlzQW5vbnltb3VzIiwidXNlcmlkIiwiaW5kZXhPZiIsInJlc3RyaWN0TG9nZ2VkT24iLCJhcnIiLCJ1c2VyIiwiQUJPVF9FTUFJTF9VU0VSIiwibGVuZ3RoIiwibGVuIiwicmVzIiwic2xpY2UiLCJNYXRoIiwibWluIiwibWF4IiwiZmxvb3IiLCJkZWx0YSIsInB1c2giLCJhVHJhaW5SZXBsaWVzIiwiYVRyYWluRGlhbG9nIiwiYVRyYWluRXhpdEhpbnQiLCJhRW50ZXJUcmFpbiIsImFCYWNrRnJvbVRyYWluaW5nIiwiYVRyYWluTm9LbGluZ29uIiwiZ2V0UmFuZG9tUmVzdWx0IiwicmFuZG9tIiwiU2ltcGxlVXBEb3duUmVjb2duaXplciIsInByb3RvdHlwZSIsInJlY29nbml6ZSIsImNvbnRleHQiLCJjYWxsYmFjayIsInUiLCJzY29yZSIsImUxIiwic3RhcnRJbmRleCIsImVuZEluZGV4IiwidW5kZWZpbmVkIiwiZXhwb3J0cyIsIkFueU9iamVjdCIsIk9iamVjdCIsImJvdCIsImZzIiwib0pTT04iLCJwYXJzZSIsInJlYWRGaWxlU3luYyIsIm9SdWxlcyIsInBhcnNlUnVsZXMiLCJsb2dRdWVyeSIsInJlc3VsdCIsImFwcGVuZEZpbGUiLCJ0aW1lc3RhbXAiLCJUb29sTWF0Y2giLCJkdW1wTmljZSIsImNvbnZlcnNhdGlvbklkIiwiZXJyIiwibG9nUXVlcnlXaGF0SXMiLCJnd29yZHMiLCJtYWtlQm90IiwiY29ubmVjdG9yIiwidGhlTW9kZWwiLCJVbml2ZXJzYWxCb3QiLCJyZWNvZ25pemVyIiwiUmVnRXhwUmVjb2duaXplciIsImRpYWxvZyIsIkludGVudERpYWxvZyIsInJlY29nbml6ZXJzIiwiZGlhbG9nVXBEb3duIiwib25CZWdpbiIsIm1hdGNoZXMiLCJhcmdzIiwibmV4dCIsImRpYWxvZ0RhdGEiLCJhYmMiLCJQcm9tcHRzIiwicmVzdWx0cyIsInJlcG9uc2UiLCJlbmREaWFsb2dXaXRoUmVzdWx0Iiwib25EZWZhdWx0IiwiZGlhbGdvRGF0YSIsIkRpYWxvZ0RhdGEiLCJpc0NvbWJpbmVkSW5kZXgiLCJvTmV3RW50aXR5IiwiYTEiLCJFbnRpdHlSZWNvZ25pemVyIiwiZmluZEVudGl0eSIsImFuYWx5emVBbGwiLCJlbnRpdHkiLCJydWxlcyIsInRvb2xzIiwiZHVtcFdlaWdodHNUb3AiLCJ0b3AiLCJpc0NvbXBsZXRlIiwiZ2V0UHJvbXB0IiwicHJvbXB0IiwiYmVzdCIsInNldFByb21wdCIsImV4ZWMiLCJleGVjVG9vbCIsInJlY29yZHMiLCJyZXBseSIsIk1lc3NhZ2UiLCJhZGRFbnRpdHkiLCJjYXRlZ29yeUVudGl0eSIsImNhdGVnb3J5IiwiY2F0IiwiYW5hbHl6ZUNhdGVnb3J5IiwicmVzb2x2ZUNhdGVnb3J5IiwiaW5kaXMiLCJpc0luZGlzY3JpbWluYXRlUmVzdWx0IiwiZG9tYWluIiwiaW5mZXJEb21haW4iLCJqb2luIiwiYVJlcyIsImdldENhdGVnb3JpZXNGb3JEb21haW4iLCJkb21haW5zIiwibWFwIiwib1Rvb2wiLCJuYW1lIiwiY2F0ZWdvcnlTZXQiLCJnZXRBbGxSZWNvcmRDYXRlZ29yaWVzRm9yVGFyZ2V0Q2F0ZWdvcnkiLCJyZXN1bHQxIiwibGlzdEFsbFdpdGhDb250ZXh0IiwiY2F0ZWdvcnlTZXRGdWxsIiwibGlzdEFsbEhhdmluZ0NvbnRleHQiLCJqb2lucmVzdWx0cyIsImpvaW5SZXN1bHRzIiwiY2F0ZWdvcnlXb3JkIiwib3BFbnRpdHkiLCJvcGVyYXRvcldvcmQiLCJvcGVyYXRvciIsImFuYWx5emVPcGVyYXRvciIsIm9wZXJhdG9yQXJncyIsImdldE9wZXJhdG9yIiwiYTIiLCJzIiwiRXJyb3IiLCJmcmFnbWVudCIsInRyaW1RdW90ZWQiLCJ0cmltUXVvdGVkU3BhY2VkIiwiYUZpbHRlcmVkQ2F0ZWdvcmllcyIsImZpbHRlclN0cmluZ0xpc3RCeU9wIiwiZ2V0Q2F0ZWdvcnlPcEZpbHRlckFzRGlzdGluY3RTdHJpbmdzIiwiaW5maXhFeHBsYWluIiwibGlrZWx5UGx1cmFsRGlmZiIsInRvTG93ZXJDYXNlIiwiYmVnaW5EaWFsb2ciLCJ1c2VyRGF0YSIsImNvdW50IiwiYWxhcm0iLCJ0aXRsZSIsInRpbWUiLCJyZXNvbHZlVGltZSIsImdldFRpbWUiLCJkYXRlIiwiaXNBTSIsImdldEhvdXJzIiwiZ2V0TW9udGgiLCJnZXREYXRlIiwiZ2V0RnVsbFllYXIiLCJnZXRNaW51dGVzIiwiZWxpemEiLCJ0cmFuc2Zvcm0iLCJtb2R1bGUiXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7O0FBT0E7Ozs7O0FBS0E7QUFDQTtBQUNBO0FDQ0E7O0FEQ0EsSUFBWUEs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O0FBQ0EzTCxvQkFBUUgsSUFBUixDQUFhLGtEQUFiLEVBQ0V1TCxNQUFNQyxLQURSLEVBRUVJLEtBQUtHLFFBQUwsS0FBa0IsQ0FGcEIsRUFFdUJILEtBQUtJLE9BQUwsRUFGdkIsRUFFdUNKLEtBQUtLLFdBQUwsRUFGdkMsRUFHRUosT0FBT0QsS0FBS0UsUUFBTCxFQUFQLEdBQXlCRixLQUFLRSxRQUFMLEtBQWtCLEVBSDdDLEVBR2lERixLQUFLTSxVQUFMLEVBSGpELEVBR29FTCxPQUFPLElBQVAsR0FBYyxJQUhsRjtBQUlELFNBWkQsTUFZTztBQUNMMUwsb0JBQVFILElBQVIsQ0FBYSxtQkFBYjtBQUNEO0FBQ0YsS0EzRHFCLENBQXhCO0FBOERBa0csV0FBT2MsU0FBUCxDQUFpQixVQUFVN0csT0FBVixFQUFpQjtBQUNoQytFLGlCQUFTL0UsT0FBVCxFQUFrQixXQUFsQjtBQUNBLFlBQUlnTSxRQUFRMUssWUFBWU4sa0JBQWtCaEIsT0FBbEIsQ0FBWixDQUFaO0FBQ0EsWUFBSW1JLFFBQVE2RCxNQUFNQyxTQUFOLENBQWdCak0sUUFBUWlCLE9BQVIsQ0FBZ0JWLElBQWhDLENBQVo7QUFDQVQsa0JBQVUsT0FBVixFQUFrQkUsT0FBbEIsRUFBMEJILEtBQUtzSSxLQUFMLENBQTFCO0FBQ0E7QUFDQTtBQUNBO0FBQ0QsS0FSRDtBQVVBOzs7Ozs7Ozs7Ozs7Ozs7OztBQWlCRDtBQUVELElBQUkrRCxNQUFKLEVBQVk7QUFDVkEsV0FBTzdILE9BQVAsR0FBaUI7QUFDZlgsZ0NBQXlCQSxzQkFEVjtBQUVmK0IsaUJBQVNBO0FBRk0sS0FBakI7QUFJRCIsImZpbGUiOiJib3Qvc21hcnRkaWFsb2cuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIFRoZSBib3QgaW1wbGVtZW50YXRpb25cbiAqXG4gKiBJbnN0YW50aWF0ZSBhcHNzaW5nIGEgY29ubmVjdG9yIHZpYVxuICogbWFrZUJvdFxuICpcbiAqL1xuLyoqXG4gKiBAZmlsZVxuICogQG1vZHVsZSBqZnNlYi5mZGV2c3RhcnQuc21hcnRkaWFsb2dcbiAqIEBjb3B5cmlnaHQgKGMpIDIwMTYgR2VyZCBGb3JzdG1hbm5cbiAqL1xuLy9kZWNsYXJlIG1vZHVsZSAnZWxpemFib3QnIHsgfTtcbi8vZGVjbGFyZSBtb2R1bGUgJ3dpbnN0b24tcGcnIHsgfTtcbi8vZGVsY2FyZSBtb2R1bGUgJ3dpbnN0b24nIHt9O1xuXG5pbXBvcnQgKiBhcyBidWlsZGVyIGZyb20gJ2JvdGJ1aWxkZXInO1xuaW1wb3J0ICogYXMgZGVidWcgZnJvbSAnZGVidWcnO1xuXG5pbXBvcnQgKiBhcyBFeGVjIGZyb20gJy4uL2V4ZWMvZXhlYyc7XG5pbXBvcnQgKiBhcyBNYXRjaCBmcm9tICcuLi9tYXRjaC9tYXRjaCc7XG5cbmltcG9ydCAqIGFzIEFuYWx5emUgZnJvbSAnLi4vbWF0Y2gvYW5hbHl6ZSc7XG5pbXBvcnQgKiBhcyBCcmVha0Rvd24gZnJvbSAnLi4vbWF0Y2gvYnJlYWtkb3duJztcblxuaW1wb3J0ICogYXMgV2hhdElzIGZyb20gJy4uL21hdGNoL3doYXRpcyc7XG5pbXBvcnQgKiBhcyBMaXN0QWxsIGZyb20gJy4uL21hdGNoL2xpc3RhbGwnO1xuXG5pbXBvcnQgKiBhcyBEaWFsb2dMb2dnZXIgZnJvbSAnLi4vdXRpbHMvZGlhbG9nbG9nZ2VyJztcblxuaW1wb3J0ICogYXMgcHJvY2VzcyBmcm9tICdwcm9jZXNzJztcblxudmFyIGRidXJsID0gcHJvY2Vzcy5lbnYuREFUQUJBU0VfVVJMIHx8IFwiXCI7XG5cbnZhciBwZ2xvY2FsdXJsID0gXCJwb3N0Z3JlczovL2pvZTphYmNkZWZAbG9jYWxob3N0OjU0MzIvYWJvdFwiO1xudmFyIGRidXJsID0gcHJvY2Vzcy5lbnYuREFUQUJBU0VfVVJMIHx8IHBnbG9jYWx1cmw7XG5cbmltcG9ydCAqIGFzIHBnIGZyb20gJ3BnJztcbnZhciBvID0gcGcgYXMgYW55O1xuby5kZWZhdWx0cy5zc2wgPSB0cnVlO1xudmFyIGRpYWxvZ0xvZ2dlciA9IERpYWxvZ0xvZ2dlci5sb2dnZXIoXCJzbWFydGJvdFwiLCBkYnVybCwgcGcpO1xuXG50eXBlIHN0cmluZ09yTWVzc2FnZSA9IHN0cmluZyB8IGJ1aWxkZXIuTWVzc2FnZTtcbmZ1bmN0aW9uIHNlbmQ8VCBleHRlbmRzIHN0cmluZ09yTWVzc2FnZT4obyA6IFQpIDogVCB7IHJldHVybiBvOyB9O1xuZnVuY3Rpb24gZGlhbG9nbG9nKGludGVudDogc3RyaW5nLCBzZXNzaW9uIDogYnVpbGRlci5TZXNzaW9uLCByZXNwb25zZSA6IHN0cmluZ09yTWVzc2FnZSkge1xuICB2YXIgc1Jlc3BvbnNlIDogc3RyaW5nO1xuICB2YXIgc0FjdGlvbiA6IHN0cmluZztcbiAgaWYoIHR5cGVvZiByZXNwb25zZSA9PT0gXCJzdHJpbmdcIikge1xuICAgIHNBY3Rpb24gPSBcIlwiO1xuICAgIHNSZXNwb25zZSA9IHJlc3BvbnNlO1xuICB9IGVsc2Uge1xuICAgIHZhciBhTWVzc2FnZSA6IGJ1aWxkZXIuTWVzc2FnZSA9IHJlc3BvbnNlO1xuICAgIHZhciBpTWVzc2FnZSA6IGJ1aWxkZXIuSU1lc3NhZ2UgPSBhTWVzc2FnZS50b01lc3NhZ2UoKTtcbiAgICBzUmVzcG9uc2UgPSBpTWVzc2FnZS50ZXh0O1xuICAgIHNBY3Rpb24gPSAoaU1lc3NhZ2UuZW50aXRpZXMgJiYgaU1lc3NhZ2UuZW50aXRpZXNbMF0pID8gIChKU09OLnN0cmluZ2lmeShpTWVzc2FnZS5lbnRpdGllcyAmJiBpTWVzc2FnZS5lbnRpdGllc1swXSkpIDogXCJcIjtcbiAgfVxuICBkaWFsb2dMb2dnZXIoe1xuICAgIGludGVudDogaW50ZW50LFxuICAgIHNlc3Npb246IHNlc3Npb24sXG4gICAgcmVzcG9uc2UgOiBzUmVzcG9uc2UsXG4gICAgYWN0aW9uIDogc0FjdGlvblxuICB9KTtcbiAgc2Vzc2lvbi5zZW5kKHJlc3BvbnNlKTtcbn1cblxuLy9jb25zdCBwZ0xvZ2dlciA9IG5ldyBQZ0xvZ2dlcih7XG4vLyAgbmFtZTogJ3Rlc3QtbG9nZ2VyJyxcbi8vICBsZXZlbDogJ2RlYnVnJyxcbi8vICBjb25uU3RyaW5nOiAncG9zdGdyZXM6Ly91YnVudHVAbG9jYWxob3N0OjU0MzIvY2lyY2xlX3Rlc3QnLFxuLy8gIHRhYmxlTmFtZTogJ3dpbnN0b25fbG9ncycsXG4vL30pO1xuXG5cblxuLy93aW5zdG9uLmFkZCh3aW5zdG9uLnRyYW5zcG9ydHMuRmlsZSwgeyBmaWxlbmFtZTogJ3dpbnN0b25fb3V0LmxvZycsIHRpbWVzdGFtcCA6IHRydWUgfSk7XG4vLyAgd2luc3Rvbi5yZW1vdmUod2luc3Rvbi50cmFuc3BvcnRzLkNvbnNvbGUpO1xuLy93aW5zdG9uLmFkZChwZ0xvZ2dlcik7XG5cbi8qXG5jb25zdCBsb2dnZXIgPSBuZXcgd2luc3Rvbi5Mb2dnZXIoe1xuICB0cmFuc3BvcnRzOiBbXG4gICAgbmV3IHdpbnN0b24udHJhbnNwb3J0cy5Db25zb2xlKHtcbiAgICAgIGNvbG9yOiB0cnVlLFxuICAgICAgdGltZXN0YW1wOiB0cnVlLFxuICAgIH0pLFxuICAgIHBnTG9nZ2VyLFxuICBdXG59KTtcbiovXG4vL3BnTG9nZ2VyLmluaXRUYWJsZShkb25lKTtcblxuXG52YXIgZWxpemFib3QgPSByZXF1aXJlKCcuLi9leHRlcm4vZWxpemFib3QvZWxpemFib3QuanMnKTtcbi8vaW1wb3J0ICogYXMgZWxpemFib3QgZnJvbSAnZWxpemFib3QnO1xuXG5sZXQgZGVidWdsb2cgPSBkZWJ1Zygnc21hcnRkaWFsb2cnKTtcbmltcG9ydCAqIGFzIFBsYWluUmVjb2duaXplciBmcm9tICcuL3BsYWlucmVjb2duaXplcic7XG4vL3ZhciBidWlsZGVyID0gcmVxdWlyZSgnYm90YnVpbGRlcicpO1xuXG52YXIgZGlzcGF0Y2hlciA9IHJlcXVpcmUoJy4uL21hdGNoL2Rpc3BhdGNoZXIuanMnKS5kaXNwYXRjaGVyO1xuXG5cbmZ1bmN0aW9uIGdldENvbnZlcnNhdGlvbklkKHNlc3Npb246IGJ1aWxkZXIuU2Vzc2lvbik6IHN0cmluZyB7XG4gIHJldHVybiBzZXNzaW9uLm1lc3NhZ2UgJiZcbiAgICBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzcyAmJlxuICAgIHNlc3Npb24ubWVzc2FnZS5hZGRyZXNzLmNvbnZlcnNhdGlvbi5pZDtcbn1cblxudmFyIGVsaXphYm90cyA9IHt9O1xuXG5mdW5jdGlvbiBnZXRFbGl6YUJvdChpZDogc3RyaW5nKSB7XG4gIGlmICghZWxpemFib3RzW2lkXSkge1xuICAgIGVsaXphYm90c1tpZF0gPSB7XG4gICAgICBhY2Nlc3M6IG5ldyBEYXRlKCksXG4gICAgICBlbGl6YWJvdDogbmV3IGVsaXphYm90KClcbiAgICB9O1xuICB9XG4gIGVsaXphYm90c1tpZF0uYWNjZXNzID0gbmV3IERhdGUoKTtcbiAgcmV0dXJuIGVsaXphYm90c1tpZF0uZWxpemFib3Q7XG59XG5cbmltcG9ydCAqIGFzIElNYXRjaCBmcm9tICcuLi9tYXRjaC9pZm1hdGNoJztcbmltcG9ydCAqIGFzIFRvb2xzIGZyb20gJy4uL21hdGNoL3Rvb2xzJztcblxudmFyIG5ld0Zsb3cgPSB0cnVlO1xuXG5pbXBvcnQgKiBhcyBNb2RlbCBmcm9tICcuLi9tb2RlbC9tb2RlbCc7XG5pbXBvcnQgKiBhcyBFeGVjU2VydmVyIGZyb20gJy4uL2V4ZWMvZXhlY3NlcnZlcic7XG5cbmNvbnN0IHRoZURlZmF1bHRNb2RlbCA9IE1vZGVsLmxvYWRNb2RlbHMoKTtcblxudmFyIG1vZGVscyA9IHt9O1xuXG5mdW5jdGlvbiBsb2FkTW9kZWwobW9kZWxQYXRoPyA6IHN0cmluZykgOiBJTWF0Y2guSU1vZGVscyB7XG4gIG1vZGVsUGF0aCA9IG1vZGVsUGF0aCB8fCBcIlwiO1xuICBpZighbW9kZWxzW21vZGVsUGF0aF0pIHtcbiAgICBtb2RlbHNbbW9kZWxQYXRoXSA9IE1vZGVsLmxvYWRNb2RlbHMobW9kZWxQYXRoKTtcbiAgfVxuICByZXR1cm4gbW9kZWxzW21vZGVsUGF0aF07XG59XG5cbmlmIChuZXdGbG93KSB7XG5cbn0gZWxzZSB7XG5cbiAgLy9jb25zdCB0b29scyA9IFRvb2xzLmdldFRvb2xzKCk7XG4gIC8vY29uc3QgSW5wdXRGaWx0ZXJSdWxlcyA9IHJlcXVpcmUoJy4uL21hdGNoL2lucHV0RmlsdGVyUnVsZXMuanMnKTtcbiAgLy9jb25zdCBtUnVsZXMgPSBJbnB1dEZpbHRlclJ1bGVzLmdldE1SdWxlc1NhbXBsZSgpO1xufVxuXG5mdW5jdGlvbiBpc0Fub255bW91cyh1c2VyaWQgOiBzdHJpbmcpIDogYm9vbGVhbiB7XG4gIHJldHVybiB1c2VyaWQuaW5kZXhPZihcImFubzpcIikgPT09IDA7XG59XG5cbmZ1bmN0aW9uIHJlc3RyaWN0TG9nZ2VkT24oc2Vzc2lvbiA6IGJ1aWxkZXIuU2Vzc2lvbiwgYXJyIDogYW55W10pIDogYW55W10ge1xuICB2YXIgdXNlcmlkID0gc2Vzc2lvbi5tZXNzYWdlLmFkZHJlc3NcbiAgICAmJiBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzcy51c2VyXG4gICAgJiYgc2Vzc2lvbi5tZXNzYWdlLmFkZHJlc3MudXNlci5pZCB8fCBcIlwiO1xuICBpZihwcm9jZXNzLmVudi5BQk9UX0VNQUlMX1VTRVIgJiYgaXNBbm9ueW1vdXModXNlcmlkKSkgIHtcbiAgICBpZihhcnIubGVuZ3RoICA8IDYpIHtcbiAgICAgIHJldHVybiBhcnI7XG4gICAgfVxuICAgIHZhciBsZW4gPSBhcnIubGVuZ3RoO1xuICAgIHZhciByZXMgPSBhcnIuc2xpY2UoMCwgTWF0aC5taW4oTWF0aC5tYXgoTWF0aC5mbG9vcihhcnIubGVuZ3RoIC8gMyksIDcpLCBhcnIubGVuZ3RoKSk7XG4gICAgaWYodHlwZW9mIGFyclswXSA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgdmFyIGRlbHRhID0gbGVuIC0gcmVzLmxlbmd0aDtcbiAgICAgIHJlcy5wdXNoKFwiLi4uIGFuZCBcIiArIGRlbHRhICsgXCIgbW9yZSBlbnRyaWVzIGZvciByZWdpc3RlcmVkIHVzZXJzXCIpO1xuICAgIH1cbiAgICByZXR1cm4gcmVzO1xuICB9XG4gIHJldHVybiBhcnI7XG59XG5cbi8qXG5leHBvcnQgY2xhc3MgU2ltcGxlUmVjb2duaXplciBpbXBsZW1lbnRzIGJ1aWxkZXIuSUludGVudFJlY29nbml6ZXIge1xuICBjb25zdHJ1Y3RvcigpIHtcblxuICB9XG5cbiAgcmVjb2duaXplKGNvbnRleHQ6IGJ1aWxkZXIuSVJlY29nbml6ZUNvbnRleHQsIGNhbGxiYWNrOiAoZXJyOiBFcnJvciwgcmVzdWx0OiBidWlsZGVyLklJbnRlbnRSZWNvZ25pemVyUmVzdWx0KSA9PiB2b2lkKTogdm9pZCB7XG4gICAgdmFyIHUgPSB7fSBhcyBidWlsZGVyLklJbnRlbnRSZWNvZ25pemVyUmVzdWx0O1xuXG4gICAgZGVidWdsb2coXCJyZWNvZ25pemluZyBcIiArIGNvbnRleHQubWVzc2FnZS50ZXh0KTtcbiAgICBpZiAoY29udGV4dC5tZXNzYWdlLnRleHQuaW5kZXhPZihcInN0YXJ0XCIpID49IDApIHtcbiAgICAgIHUuaW50ZW50ID0gXCJTaG93RW50aXR5XCI7XG4gICAgICB1LnNjb3JlID0gMC45O1xuICAgICAgdmFyIGUxID0ge30gYXMgYnVpbGRlci5JRW50aXR5O1xuICAgICAgZTEuc3RhcnRJbmRleCA9IFwic3RhcnQgXCIubGVuZ3RoO1xuICAgICAgZTEuZW5kSW5kZXggPSBjb250ZXh0Lm1lc3NhZ2UudGV4dC5sZW5ndGg7XG4gICAgICBlMS5zY29yZSA9IDAuMztcbiAgICAgIHUuZW50aXRpZXMgPSBbZTFdO1xuICAgICAgY2FsbGJhY2sodW5kZWZpbmVkLCB1KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG5cbiAgICBpZiAoY29udGV4dC5tZXNzYWdlLnRleHQuaW5kZXhPZihcInRyYWluXCIpID49IDApIHtcbiAgICAgIHUuaW50ZW50ID0gXCJ0cmFpblwiO1xuICAgICAgdS5zY29yZSA9IDAuOTtcbiAgICAgIHZhciBlMSA9IHt9IGFzIGJ1aWxkZXIuSUVudGl0eTtcbiAgICAgIGUxLnN0YXJ0SW5kZXggPSBcInRyYWluIFwiLmxlbmd0aDtcbiAgICAgIGUxLmVuZEluZGV4ID0gY29udGV4dC5tZXNzYWdlLnRleHQubGVuZ3RoO1xuICAgICAgZTEuc2NvcmUgPSAwLjM7XG4gICAgICB1LmVudGl0aWVzID0gW2UxXTtcbiAgICAgIGNhbGxiYWNrKHVuZGVmaW5lZCwgdSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChjb250ZXh0Lm1lc3NhZ2UudGV4dC5pbmRleE9mKFwibGVhcm5cIikgPj0gMCkge1xuICAgICAgdS5pbnRlbnQgPSBcImxlYXJuXCI7XG4gICAgICB1LnNjb3JlID0gMC45O1xuICAgICAgdmFyIGUxID0ge30gYXMgYnVpbGRlci5JRW50aXR5O1xuICAgICAgZTEudHlwZSA9IFwidHJhaW5GYWN0XCI7XG4gICAgICBlMS5zdGFydEluZGV4ID0gXCJ0cmFpbiBcIi5sZW5ndGg7XG4gICAgICBlMS5lbmRJbmRleCA9IGNvbnRleHQubWVzc2FnZS50ZXh0Lmxlbmd0aDtcbiAgICAgIGUxLnNjb3JlID0gMC4zO1xuICAgICAgdS5lbnRpdGllcyA9IFtlMV07XG4gICAgICBjYWxsYmFjayh1bmRlZmluZWQsIHUpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoY29udGV4dC5tZXNzYWdlLnRleHQuaW5kZXhPZihcImhlbHBcIikgPj0gMCkge1xuICAgICAgdS5pbnRlbnQgPSBcImhlbHBcIjtcbiAgICAgIHUuc2NvcmUgPSAwLjk7XG4gICAgICB2YXIgZTEgPSB7fSBhcyBidWlsZGVyLklFbnRpdHk7XG4gICAgICBlMS5zdGFydEluZGV4ID0gXCJ0cmFpbiBcIi5sZW5ndGg7XG4gICAgICBlMS5lbmRJbmRleCA9IGNvbnRleHQubWVzc2FnZS50ZXh0Lmxlbmd0aDtcbiAgICAgIGUxLnNjb3JlID0gMC4zO1xuICAgICAgdS5lbnRpdGllcyA9IFtlMV07XG4gICAgICBjYWxsYmFjayh1bmRlZmluZWQsIHUpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoY29udGV4dC5tZXNzYWdlLnRleHQuaW5kZXhPZihcImV4aXRcIikgPj0gMCkge1xuICAgICAgdS5pbnRlbnQgPSBcImV4aXRcIjtcbiAgICAgIHUuc2NvcmUgPSAwLjk7XG4gICAgICB2YXIgZTEgPSB7fSBhcyBidWlsZGVyLklFbnRpdHk7XG4gICAgICBlMS5zdGFydEluZGV4ID0gXCJleGl0IFwiLmxlbmd0aDtcbiAgICAgIGUxLmVuZEluZGV4ID0gY29udGV4dC5tZXNzYWdlLnRleHQubGVuZ3RoO1xuICAgICAgZTEuc2NvcmUgPSAwLjM7XG4gICAgICB1LmVudGl0aWVzID0gW2UxXTtcbiAgICAgIGNhbGxiYWNrKHVuZGVmaW5lZCwgdSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChjb250ZXh0Lm1lc3NhZ2UudGV4dC5pbmRleE9mKFwid3JvbmdcIikgPj0gMCkge1xuICAgICAgdS5pbnRlbnQgPSBcIndyb25nXCI7XG4gICAgICB1LnNjb3JlID0gMC45O1xuICAgICAgdmFyIGUxID0ge30gYXMgYnVpbGRlci5JRW50aXR5O1xuICAgICAgZTEuc3RhcnRJbmRleCA9IFwiZXhpdCBcIi5sZW5ndGg7XG4gICAgICBlMS5lbmRJbmRleCA9IGNvbnRleHQubWVzc2FnZS50ZXh0Lmxlbmd0aDtcbiAgICAgIGUxLnNjb3JlID0gMC4zO1xuICAgICAgdS5lbnRpdGllcyA9IFtlMV07XG4gICAgICBjYWxsYmFjayh1bmRlZmluZWQsIHUpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBkZWJ1Z2xvZygncmVjb2duaXppbmcgbm90aGluZycpO1xuICAgIHUuaW50ZW50ID0gXCJOb25lXCI7XG4gICAgdS5zY29yZSA9IDAuMTtcbiAgICB2YXIgZTEgPSB7fSBhcyBidWlsZGVyLklFbnRpdHk7XG4gICAgZTEuc3RhcnRJbmRleCA9IFwiZXhpdCBcIi5sZW5ndGg7XG4gICAgZTEuZW5kSW5kZXggPSBjb250ZXh0Lm1lc3NhZ2UudGV4dC5sZW5ndGg7XG4gICAgZTEuc2NvcmUgPSAwLjE7XG4gICAgdS5lbnRpdGllcyA9IFtdO1xuICAgIGNhbGxiYWNrKHVuZGVmaW5lZCwgdSk7XG4gIH1cbn1cbiovXG5cbmNvbnN0IGFUcmFpblJlcGxpZXMgPSBbIFwiVGhhbmsgeW91IGZvciBzaGFyaW5nIHRoaXMgc3VnZ2VzdGlvbiB3aXRoIHVzXCIsXG5cIlRoYW5rIGZvciBmb3IgdGhpcyB2YWx1YWJsZSBpbmZvcm1hdGlvbi5cIixcblwiVGhhbmsgZm9yIGZvciB0aGlzIGludGVyZXN0aW5nIGZhY3QhXCIsXG5cIlRoYXRzIGEgcGxldGhvcmlhIG9mIGluZm9ybWF0aW9uLlwiLFxuXCJUaGF0J3MgYSBudWdnZXQgb2YgaW5mb3JtYXRpb24uXCIsXG5cIkxvdmVseSwgSSBtYXkgY29uc2lkZXIgeW91IGlucHV0LlwiLFxuXCJXZWxsIGRvbmUsIGFueXRoaW5nIG1vcmUgdG8gbGV0IG1lIGtub3c/XCIsXG5cIkkgZG8gYXBwcmVjaWF0ZSB5b3VyIHRlYWNoaW5nIGFuZCBteSBsZWFybmluZyBleHBlcmllbmNlLCBvciB3YXMgaXQgdGhlIG90aGVyIHdheSByb3VuZD9cIixcblwiWW91ciBoZWxwZnVsIGlucHV0IGhhcyBiZWVuIHN0b3JlZCBpbiBzb21lIGR1c3R5IGNvcm5lciBvZiB0aGUgV29ybGQgd2lkZSB3ZWIhXCIsXG5cIlRoYW5rIHlvdSBmb3IgbXkgbGVhcm5pbmcgZXhwZXJpZW5jZSFcIixcblwiSSBoYXZlIGluY29ycG9yYXRlZCB5b3VyIHZhbHVhYmxlIHN1Z2dlc3Rpb24gaW4gdGhlIHdpc2RvbSBvZiB0aGUgaW50ZXJuZXRcIlxuXTtcblxudmFyIGFUcmFpbkRpYWxvZyA9IGFUcmFpblJlcGxpZXM7XG5cbnZhciBhVHJhaW5FeGl0SGludCA9IFtcblwiXFxudHlwZSBcXFwiZG9uZVxcXCIgd2hlbiB5b3UgYXJlIGRvbmUgdHJhaW5pbmcgbWUuXCIsXG5cIlwiLFxuXCJcIixcblwiXCIsXG5cIlxcbnJlbWVtYmVyLCB5b3UgYXJlIHN0dWNrIGhlcmUgaW5zdHJ1Y3RpbmcgbWUsIHR5cGUgXFxcImRvbmVcXFwiIHRvIHJldHVybi5cIixcblwiXCJdO1xuXG5jb25zdCBhRW50ZXJUcmFpbiA9IFtcIlNvIHlvdSB0aGluayB0aGlzIGlzIHdyb25nPyBZb3UgY2FuIG9mZmVyIHlvdXIgYWR2aXNlIGhlcmUuXFxuIFR5cGUgXFxcImRvbmVcXFwiIGlmIHlvdSBhcmUgZG9uZSB3aXRoIGluc3RydWN0aW5nIG1lXCIsXG5cIkZlZWwgZnJlZSB0byBvZmZlciBtZSB5b3VyIGJldHRlciBzb2x1dGlvbiBoZXJlLlxcblwiLFxuXCJTb21lIHNheSBcXFwiVGhlIHNlY3JldCB0byBoYXBwaW5lc3MgaXMgdG8gbG93ZXIgeW91ciBleHBlY3RhdGlvbnMgdG8gdGhlIHBvaW50IHRoZXkgYXJlIGFscmVhZHkgbWV0LlxcXCIsIFxcbnQgaWYgeW91IGNvdWxkIGhlbHAgbWUgdG8gYmVjb21kZSBiZXR0ZXIsIGluc3RydWN0IG1lLlwiLFxuXCJGZWVsIGZyZWUgdG8gb2ZmZXIgbWUgeW91ciBiZXR0ZXIgc29sdXRpb24gaGVyZS5cXG4gVHlwZSBcXFwiZG9uZVxcXCIgaWYgeW91IGFyZSBkb25lIHdpdGggaW5zdHJ1Y3RpbmcgbWVcIixcblwiRmVlbCBmcmVlIHRvIG9mZmVyIG1lIHlvdXIgYmV0dGVyIHNvbHV0aW9uIGhlcmUuXFxuIFR5cGUgXFxcImRvbmVcXFwiIGlmIHlvdSBhcmUgZG9uZSB3aXRoIGluc3RydWN0aW5nIG1lXCIsXG5dO1xuXG5cbmNvbnN0IGFCYWNrRnJvbVRyYWluaW5nID0gW1xuICBcIlB1dWgsIGJhY2sgZnJvbSB0cmFpbmluZyEgTm93IGZvciB0aGUgZWFzeSBwYXJ0IC4uLlwiLFxuICBcIkxpdmUgYW5kIGRvbid0IGxlYXJuLCB0aGF0J3MgdXMuIE5hYWgsIHdlJ2xsIHNlZS5cIixcbiAgXCJUaGUgc2VjcmV0IHRvIGhhcHBpbmVzcyBpcyB0byBsb3dlciB5b3VyIGV4cGVjdGF0aW9ucyB0byB0aGUgcG9pbnQgdGhleSBhcmUgYWxyZWFkeSBtZXQuXCIsXG4gIFwiVGhhbmtzIGZvciBoYXZpbmcgdGhpcyBsZWN0dXJlIHNlc3Npb24sIG5vdyBiYWNrIHRvIG91ciB1c3VhbCBzZWxmLlwiXG5dO1xuXG5cbmNvbnN0IGFUcmFpbk5vS2xpbmdvbiA9IFtcbiAgXCJIZSB3aG8gbWFzdGVyIHRoZSBkYXJrIGFydHMgb2YgU0FQIG11c3Qgbm90IGR3ZWxsIGluIHRoZSBlYXJ0aGx5IHJlYWxtcyBvZiBTdGFydCBUcmVrLlwiLFxuICBcIlNBUCBpcyBhIGNsb3VkIGNvbXBhbnksIG5vdCBhIHNwYWNlIGNvbXBhbnkuXCIsXG4gIFwiVGhlIGRlcHRoIG9mIFIvMyBhcmUgZGVlcGVyIHRoYW4gRGVlcCBTcGFjZSA0Mi5cIixcbiAgXCJNeSBicmFpbnBvd2VyIGlzIGZ1bGx5IGFic29yYmVkIHdpdGggbWFzdGVyaW5nIG90aGVyIHJlYWxtcy5cIixcbiAgXCJGb3IgdGhlIHdvc2FwLCB0aGUgc2t5IGlzIHRoZSBsaW1pdC4gRmVlbCBmcmVlIHRvIGNoZWNrIG91dCBuYXNhLmdvdiAuXCIsXG4gIFwiVGhlIGZ1dHVyZSBpcyBTQVAgb3IgSUJNIGJsdWUsIG5vdCBzcGFjZSBibGFjay5cIixcbiAgXCJUaGF0J3MgbGVmdCB0byBzb21lIG11c2t5IGZ1dHVyZS5cIlxuXVxuXG5mdW5jdGlvbiBnZXRSYW5kb21SZXN1bHQoYXJyIDogc3RyaW5nW10pIDogc3RyaW5nIHtcbiAgcmV0dXJuIGFycltNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiBhcnIubGVuZ3RoKSAlIGFyci5sZW5ndGhdO1xufVxuXG5leHBvcnQgY2xhc3MgU2ltcGxlVXBEb3duUmVjb2duaXplciBpbXBsZW1lbnRzIGJ1aWxkZXIuSUludGVudFJlY29nbml6ZXIge1xuICBjb25zdHJ1Y3RvcigpIHtcblxuICB9XG5cbiAgcmVjb2duaXplKGNvbnRleHQ6IGJ1aWxkZXIuSVJlY29nbml6ZUNvbnRleHQsIGNhbGxiYWNrOiAoZXJyOiBFcnJvciwgcmVzdWx0OiBidWlsZGVyLklJbnRlbnRSZWNvZ25pemVyUmVzdWx0KSA9PiB2b2lkKTogdm9pZCB7XG4gICAgdmFyIHUgPSB7fSBhcyBidWlsZGVyLklJbnRlbnRSZWNvZ25pemVyUmVzdWx0O1xuXG4gICAgZGVidWdsb2coXCJyZWNvZ25pemluZyBcIiArIGNvbnRleHQubWVzc2FnZS50ZXh0KTtcbiAgICBpZiAoY29udGV4dC5tZXNzYWdlLnRleHQuaW5kZXhPZihcImRvd25cIikgPj0gMCkge1xuICAgICAgdS5pbnRlbnQgPSBcImludGVudC5kb3duXCI7XG4gICAgICB1LnNjb3JlID0gMC45O1xuICAgICAgdmFyIGUxID0ge30gYXMgYnVpbGRlci5JRW50aXR5O1xuICAgICAgZTEuc3RhcnRJbmRleCA9IFwic3RhcnQgXCIubGVuZ3RoO1xuICAgICAgZTEuZW5kSW5kZXggPSBjb250ZXh0Lm1lc3NhZ2UudGV4dC5sZW5ndGg7XG4gICAgICBlMS5zY29yZSA9IDAuMztcbiAgICAgIHUuZW50aXRpZXMgPSBbZTFdO1xuICAgICAgY2FsbGJhY2sodW5kZWZpbmVkLCB1KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGNvbnRleHQubWVzc2FnZS50ZXh0LmluZGV4T2YoXCJ1cFwiKSA+PSAwKSB7XG4gICAgICB1LmludGVudCA9IFwiaW50ZW50LnVwXCI7XG4gICAgICB1LnNjb3JlID0gMC45O1xuICAgICAgdmFyIGUxID0ge30gYXMgYnVpbGRlci5JRW50aXR5O1xuICAgICAgZTEuc3RhcnRJbmRleCA9IFwidXBcIi5sZW5ndGg7XG4gICAgICBlMS5lbmRJbmRleCA9IGNvbnRleHQubWVzc2FnZS50ZXh0Lmxlbmd0aDtcbiAgICAgIGUxLnNjb3JlID0gMC4zO1xuICAgICAgdS5lbnRpdGllcyA9IFtlMV07XG4gICAgICBjYWxsYmFjayh1bmRlZmluZWQsIHUpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoY29udGV4dC5tZXNzYWdlLnRleHQuaW5kZXhPZihcImRvbmVcIikgPj0gMCkge1xuICAgICAgdS5pbnRlbnQgPSBcImludGVudC51cFwiO1xuICAgICAgdS5zY29yZSA9IDAuOTtcbiAgICAgIHZhciBlMSA9IHt9IGFzIGJ1aWxkZXIuSUVudGl0eTtcbiAgICAgIGUxLnN0YXJ0SW5kZXggPSBcInVwXCIubGVuZ3RoO1xuICAgICAgZTEuZW5kSW5kZXggPSBjb250ZXh0Lm1lc3NhZ2UudGV4dC5sZW5ndGg7XG4gICAgICBlMS5zY29yZSA9IDAuMztcbiAgICAgIHUuZW50aXRpZXMgPSBbZTFdO1xuICAgICAgY2FsbGJhY2sodW5kZWZpbmVkLCB1KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGNvbnRleHQubWVzc2FnZS50ZXh0LmluZGV4T2YoXCJleGl0XCIpID49IDApIHtcbiAgICAgIHUuaW50ZW50ID0gXCJpbnRlbnQudXBcIjtcbiAgICAgIHUuc2NvcmUgPSAwLjk7XG4gICAgICB2YXIgZTEgPSB7fSBhcyBidWlsZGVyLklFbnRpdHk7XG4gICAgICBlMS5zdGFydEluZGV4ID0gXCJ1cFwiLmxlbmd0aDtcbiAgICAgIGUxLmVuZEluZGV4ID0gY29udGV4dC5tZXNzYWdlLnRleHQubGVuZ3RoO1xuICAgICAgZTEuc2NvcmUgPSAwLjM7XG4gICAgICB1LmVudGl0aWVzID0gW2UxXTtcbiAgICAgIGNhbGxiYWNrKHVuZGVmaW5lZCwgdSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIGlmIChjb250ZXh0Lm1lc3NhZ2UudGV4dC5pbmRleE9mKFwicXVpdFwiKSA+PSAwKSB7XG4gICAgICB1LmludGVudCA9IFwiaW50ZW50LnVwXCI7XG4gICAgICB1LnNjb3JlID0gMC45O1xuICAgICAgdmFyIGUxID0ge30gYXMgYnVpbGRlci5JRW50aXR5O1xuICAgICAgZTEuc3RhcnRJbmRleCA9IFwidXBcIi5sZW5ndGg7XG4gICAgICBlMS5lbmRJbmRleCA9IGNvbnRleHQubWVzc2FnZS50ZXh0Lmxlbmd0aDtcbiAgICAgIGUxLnNjb3JlID0gMC4zO1xuICAgICAgdS5lbnRpdGllcyA9IFtlMV07XG4gICAgICBjYWxsYmFjayh1bmRlZmluZWQsIHUpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBkZWJ1Z2xvZygncmVjb2duaXppbmcgbm90aGluZycpO1xuICAgIHUuaW50ZW50ID0gXCJOb25lXCI7XG4gICAgdS5zY29yZSA9IDAuMTtcbiAgICB2YXIgZTEgPSB7fSBhcyBidWlsZGVyLklFbnRpdHk7XG4gICAgZTEuc3RhcnRJbmRleCA9IFwiZXhpdCBcIi5sZW5ndGg7XG4gICAgZTEuZW5kSW5kZXggPSBjb250ZXh0Lm1lc3NhZ2UudGV4dC5sZW5ndGg7XG4gICAgZTEuc2NvcmUgPSAwLjE7XG4gICAgdS5lbnRpdGllcyA9IFtdO1xuICAgIGNhbGxiYWNrKHVuZGVmaW5lZCwgdSk7XG4gIH1cbn1cblxuY29uc3QgQW55T2JqZWN0ID0gT2JqZWN0IGFzIGFueTtcbi8vIGdsb2JhbFR1bm5lbC5pbml0aWFsaXplKHtcbi8vICBob3N0OiAncHJveHkuZXh4eGFtcGxlLmNvbScsXG4vLyAgcG9ydDogODA4MFxuLy8gfSlcblxuLy8gQ3JlYXRlIGJvdCBhbmQgYmluZCB0byBjb25zb2xlXG4vLyB2YXIgY29ubmVjdG9yID0gbmV3IGh0bWxjb25uZWN0b3IuSFRNTENvbm5lY3RvcigpXG5cbi8vIGNvbm5lY3Rvci5zZXRBbnN3ZXJIb29rKGZ1bmN0aW9uIChzQW5zd2VyKSB7XG4vLyAgY29uc29sZS5sb2coJ0dvdCBhbnN3ZXIgOiAnICsgc0Fuc3dlciArICdcXG4nKVxuLy8gfSlcblxudmFyIGJvdDtcbi8vIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuLy8gICBjb25uZWN0b3IucHJvY2Vzc01lc3NhZ2UoJ3N0YXJ0IHVuaXQgdGVzdCBBQkMgJylcbi8vIH0sIDUwMDApXG5cbmltcG9ydCAqIGFzIGZzIGZyb20gJ2ZzJztcblxudmFyIG9KU09OID0gSlNPTi5wYXJzZSgnJyArIGZzLnJlYWRGaWxlU3luYygnLi9yZXNvdXJjZXMvbW9kZWwvaW50ZW50cy5qc29uJykpO1xudmFyIG9SdWxlcyA9IFBsYWluUmVjb2duaXplci5wYXJzZVJ1bGVzKG9KU09OKTtcbi8vIHZhciBSZWNvZ25pemVyID0gbmV3IChyZWNvZ25pemVyLlJlZ0V4cFJlY29nbml6ZXIpKG9SdWxlcyk7XG5cblxuZnVuY3Rpb24gbG9nUXVlcnkoc2Vzc2lvbjogYnVpbGRlci5TZXNzaW9uLCBpbnRlbnQ6IHN0cmluZywgcmVzdWx0PzogQXJyYXk8SU1hdGNoLklUb29sTWF0Y2g+KSB7XG5cbiAgZnMuYXBwZW5kRmlsZSgnLi9sb2dzL3Nob3dtZXF1ZXJpZXMudHh0JywgXCJcXG5cIiArIEpTT04uc3RyaW5naWZ5KHtcbiAgICB0ZXh0OiBzZXNzaW9uLm1lc3NhZ2UudGV4dCxcbiAgICB0aW1lc3RhbXA6IHNlc3Npb24ubWVzc2FnZS50aW1lc3RhbXAsXG4gICAgaW50ZW50OiBpbnRlbnQsXG4gICAgcmVzOiByZXN1bHQgJiYgcmVzdWx0Lmxlbmd0aCAmJiBNYXRjaC5Ub29sTWF0Y2guZHVtcE5pY2UocmVzdWx0WzBdKSB8fCBcIjBcIixcbiAgICBjb252ZXJzYXRpb25JZDogc2Vzc2lvbi5tZXNzYWdlLmFkZHJlc3NcbiAgICAmJiBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzcy5jb252ZXJzYXRpb25cbiAgICAmJiBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzcy5jb252ZXJzYXRpb24uaWQgfHwgXCJcIixcbiAgICB1c2VyaWQ6IHNlc3Npb24ubWVzc2FnZS5hZGRyZXNzXG4gICAgJiYgc2Vzc2lvbi5tZXNzYWdlLmFkZHJlc3MudXNlclxuICAgICYmIHNlc3Npb24ubWVzc2FnZS5hZGRyZXNzLnVzZXIuaWQgfHwgXCJcIlxuICB9KSwgZnVuY3Rpb24gKGVyciwgcmVzKSB7XG4gICAgaWYgKGVycikge1xuICAgICAgZGVidWdsb2coXCJsb2dnaW5nIGZhaWxlZCBcIiArIGVycik7XG4gICAgfVxuICB9KTtcbn1cblxuXG5cbmZ1bmN0aW9uIGxvZ1F1ZXJ5V2hhdElzKHNlc3Npb246IGJ1aWxkZXIuU2Vzc2lvbiwgaW50ZW50OiBzdHJpbmcsIHJlc3VsdD86IEFycmF5PElNYXRjaC5JV2hhdElzQW5zd2VyPikge1xuXG4gIGZzLmFwcGVuZEZpbGUoJy4vbG9ncy9zaG93bWVxdWVyaWVzLnR4dCcsIFwiXFxuXCIgKyBKU09OLnN0cmluZ2lmeSh7XG4gICAgdGV4dDogc2Vzc2lvbi5tZXNzYWdlLnRleHQsXG4gICAgdGltZXN0YW1wOiBzZXNzaW9uLm1lc3NhZ2UudGltZXN0YW1wLFxuICAgIGludGVudDogaW50ZW50LFxuICAgIHJlczogcmVzdWx0ICYmIHJlc3VsdC5sZW5ndGggJiYgV2hhdElzLmR1bXBOaWNlKHJlc3VsdFswXSkgfHwgXCIwXCIsXG4gICAgY29udmVyc2F0aW9uSWQ6IHNlc3Npb24ubWVzc2FnZS5hZGRyZXNzXG4gICAgJiYgc2Vzc2lvbi5tZXNzYWdlLmFkZHJlc3MuY29udmVyc2F0aW9uXG4gICAgJiYgc2Vzc2lvbi5tZXNzYWdlLmFkZHJlc3MuY29udmVyc2F0aW9uLmlkIHx8IFwiXCIsXG4gICAgdXNlcmlkOiBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzc1xuICAgICYmIHNlc3Npb24ubWVzc2FnZS5hZGRyZXNzLnVzZXJcbiAgICAmJiBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzcy51c2VyLmlkIHx8IFwiXCJcbiAgfSksIGZ1bmN0aW9uIChlcnIsIHJlcykge1xuICAgIGlmIChlcnIpIHtcbiAgICAgIGRlYnVnbG9nKFwibG9nZ2luZyBmYWlsZWQgXCIgKyBlcnIpO1xuICAgIH1cbiAgfSk7XG59XG5cbnZhciBnd29yZHMgPSB7fTtcbi8qKlxuICogQ29uc3RydWN0IGEgYm90XG4gKiBAcGFyYW0gY29ubmVjdG9yIHtDb25uZWN0b3J9IHRoZSBjb25uZWN0b3IgdG8gdXNlXG4gKiBIVE1MQ29ubmVjdG9yXG4gKiBvciBjb25uZWN0b3IgPSBuZXcgYnVpbGRlci5Db25zb2xlQ29ubmVjdG9yKCkubGlzdGVuKClcbiAqL1xuZnVuY3Rpb24gbWFrZUJvdChjb25uZWN0b3IsIG1vZGVsUGF0aD8gOiBzdHJpbmcpIHtcblxuICB2YXIgdGhlTW9kZWwgPSBsb2FkTW9kZWwobW9kZWxQYXRoKTtcbiAgYm90ID0gbmV3IGJ1aWxkZXIuVW5pdmVyc2FsQm90KGNvbm5lY3Rvcik7XG5cblxuXG4gIC8vIENyZWF0ZSBMVUlTIHJlY29nbml6ZXIgdGhhdCBwb2ludHMgYXQgb3VyIG1vZGVsIGFuZCBhZGQgaXQgYXMgdGhlIHJvb3QgJy8nIGRpYWxvZyBmb3Igb3VyIENvcnRhbmEgQm90LlxuICAvLyB2YXIgbW9kZWwgPSBzZW5zaXRpdmUubW9kZWx1cmw7XG4gIC8vIHZhciBtb2RlbCA9ICdodHRwczovL2FwaS5wcm9qZWN0b3hmb3JkLmFpL2x1aXMvdjIuMC9hcHBzL2M0MTNiMmVmLTM4MmMtNDViZC04ZmYwLWY3NmQ2MGUyYTgyMT9zdWJzY3JpcHRpb24ta2V5PWMyMTM5OGI1OTgwYTRjZTA5ZjQ3NGJiZmVlOTNiODkyJnE9J1xuICB2YXIgcmVjb2duaXplciA9IG5ldyBQbGFpblJlY29nbml6ZXIuUmVnRXhwUmVjb2duaXplcihvUnVsZXMpO1xuXG4gIHZhciBkaWFsb2cgPSBuZXcgYnVpbGRlci5JbnRlbnREaWFsb2coeyByZWNvZ25pemVyczogW3JlY29nbml6ZXJdIH0pO1xuICAvLyBkaWFsb2cub25CZWdpbihmdW5jdGlvbihzZXNzaW9uLGFyZ3MpIHtcbiAgLy8gY29uc29sZS5sb2coXCJiZWdpbm5pbmcgLi4uXCIpXG4gIC8vIHNlc3Npb24uZGlhbG9nRGF0YS5yZXRyeVByb21wdCA9IGFyZ3MgJiYgYXJncy5yZXRyeVByb21wdCB8fCBcIkkgYW0gc29ycnlcIlxuICAvLyBzZXNzaW9uLnNlbmQoXCJXaGF0IGRvIHlvdSB3YW50P1wiKVxuICAvL1xuICAvLyB9KVxuXG4gIHZhciBkaWFsb2dVcERvd24gPSBuZXcgYnVpbGRlci5JbnRlbnREaWFsb2coeyByZWNvZ25pemVyczogW25ldyBTaW1wbGVVcERvd25SZWNvZ25pemVyKCldIH0pO1xuXG4gIGJvdC5kaWFsb2coJy91cGRvd24nLCBkaWFsb2dVcERvd24pO1xuICBkaWFsb2dVcERvd24ub25CZWdpbihmdW5jdGlvbiAoc2Vzc2lvbikge1xuICAgIGRpYWxvZ2xvZyhcIlRyYWluTWVcIiwgc2Vzc2lvbiwgc2VuZChnZXRSYW5kb21SZXN1bHQoYUVudGVyVHJhaW4pKSk7XG4gICAgLy9zZXNzaW9uLnNlbmQoXCJIaSB0aGVyZSwgdXBkb3duIGlzIHdhaXRpbmcgZm9yIHlvdVwiKTtcbiAgfSlcblxuICBkaWFsb2dVcERvd24ubWF0Y2hlcygnaW50ZW50LnVwJywgW1xuICAgIGZ1bmN0aW9uIChzZXNzaW9uLCBhcmdzLCBuZXh0KSB7XG4gICAgICBzZXNzaW9uLmRpYWxvZ0RhdGEuYWJjID0gYXJncyB8fCB7fTtcbiAgICAgIGJ1aWxkZXIuUHJvbXB0cy50ZXh0KHNlc3Npb24sICd5b3Ugd2FudCB0byBleGl0IHRyYWluaW5nPyB0eXBlIFxcXCJkb25lXFxcIiBhZ2Fpbi4nKTtcbiAgICB9LFxuICAgIGZ1bmN0aW9uIChzZXNzaW9uLCByZXN1bHRzLCBuZXh0KSB7XG4gICAgICBzZXNzaW9uLmRpYWxvZ0RhdGEuYWJjID0gcmVzdWx0cy5yZXBvbnNlO1xuICAgICAgbmV4dCgpO1xuICAgIH0sXG4gICAgZnVuY3Rpb24gKHNlc3Npb24sIHJlc3VsdHMpIHtcbiAgICAgIHNlc3Npb24uZW5kRGlhbG9nV2l0aFJlc3VsdCh7IHJlc3BvbnNlOiBzZXNzaW9uLmRpYWxvZ0RhdGEuYWJjIH0pO1xuICAgIH1cbiAgXVxuICApO1xuXG4gIGRpYWxvZ1VwRG93bi5tYXRjaGVzKCdpbnRlbnQuZG93bicsIFtcbiAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgYXJncywgbmV4dCkge1xuICAgICAgc2Vzc2lvbi5kaWFsb2dEYXRhLmFiYyA9IGFyZ3MgfHwge307XG4gICAgICBidWlsZGVyLlByb21wdHMudGV4dChzZXNzaW9uLCAneW91IHdhbnQgdG8gZ28gZG93biEnKTtcbiAgICB9LFxuICAgIGZ1bmN0aW9uIChzZXNzaW9uLCByZXN1bHRzLCBuZXh0KSB7XG4gICAgICBzZXNzaW9uLmRpYWxvZ0RhdGEuYWJjID0gLTE7IC8vIHJlc3VsdHMucmVwb25zZTtcbiAgICAgIG5leHQoKTtcbiAgICB9LFxuICAgIGZ1bmN0aW9uIChzZXNzaW9uLCByZXN1bHRzKSB7XG4gICAgICBzZXNzaW9uLnNlbmQoXCJzdGlsbCBnb2luZyBkb3duP1wiKTtcbiAgICB9XG4gIF1cbiAgKTtcbiAgZGlhbG9nVXBEb3duLm9uRGVmYXVsdChmdW5jdGlvbiAoc2Vzc2lvbikge1xuICAgIGxvZ1F1ZXJ5KHNlc3Npb24sIFwib25EZWZhdWx0XCIpO1xuICAgIHZhciByZXMgPSBnZXRSYW5kb21SZXN1bHQoYVRyYWluRGlhbG9nKSArIGdldFJhbmRvbVJlc3VsdChhVHJhaW5FeGl0SGludCk7XG4gICAgZGlhbG9nbG9nKFwiVHJhaW5NZVwiLCBzZXNzaW9uLCBzZW5kKHJlcykpO1xuICB9KTtcblxuXG4gIGJvdC5kaWFsb2coJy90cmFpbicsIFtcbiAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgYXJncywgbmV4dCkge1xuICAgICAgc2Vzc2lvbi5kaWFsZ29EYXRhLmFiYyA9IGFyZ3MgfHwge307XG4gICAgICBidWlsZGVyLlByb21wdHMudGV4dChzZXNzaW9uLCAnRG8geW91IHdhbnQgdG8gdHJhaW4gbWUnKTtcbiAgICB9LFxuICAgIGZ1bmN0aW9uIChzZXNzaW9uLCByZXN1bHRzLCBuZXh0KSB7XG4gICAgICBzZXNzaW9uLmRpYWxvZ0RhdGEuYWJjID0gcmVzdWx0cy5yZXBvbnNlO1xuICAgIH0sXG4gICAgZnVuY3Rpb24gKHNlc3Npb24sIHJlc3VsdHMpIHtcbiAgICAgIHNlc3Npb24uZW5kRGlhbG9nV2l0aFJlc3VsdCh7IHJlc3BvbnNlOiBzZXNzaW9uLkRpYWxvZ0RhdGEuYWJjIH0pO1xuICAgIH1cbiAgXSk7XG5cblxuICBib3QuZGlhbG9nKCcvJywgZGlhbG9nKTtcblxuICBkaWFsb2cubWF0Y2hlcygnU2hvd01lJywgW1xuICAgIGZ1bmN0aW9uIChzZXNzaW9uLCBhcmdzLCBuZXh0KSB7XG4gICAgICB2YXIgaXNDb21iaW5lZEluZGV4ID0ge307XG4gICAgICB2YXIgb05ld0VudGl0eTtcbiAgICAgIC8vIGV4cGVjdGluZyBlbnRpdHkgQTFcbiAgICAgIGRlYnVnbG9nKFwiU2hvdyBFbnRpdHlcIik7XG4gICAgICBkZWJ1Z2xvZygncmF3OiAnICsgSlNPTi5zdHJpbmdpZnkoYXJncy5lbnRpdGllcyksIHVuZGVmaW5lZCwgMik7XG4gICAgICB2YXIgYTEgPSBidWlsZGVyLkVudGl0eVJlY29nbml6ZXIuZmluZEVudGl0eShhcmdzLmVudGl0aWVzLCAnQTEnKTtcbiAgICAgIGNvbnN0IHJlc3VsdCA9IEFuYWx5emUuYW5hbHl6ZUFsbChhMS5lbnRpdHksXG4gICAgICAgIHRoZU1vZGVsLnJ1bGVzLCB0aGVNb2RlbC50b29scywgZ3dvcmRzKTtcbiAgICAgIGxvZ1F1ZXJ5KHNlc3Npb24sICdTaG93TWUnLCByZXN1bHQpO1xuICAgICAgLy8gdGVzdC5leHBlY3QoMylcbiAgICAgIC8vICB0ZXN0LmRlZXBFcXVhbChyZXN1bHQud2VpZ2h0LCAxMjAsICdjb3JyZWN0IHdlaWdodCcpO1xuICAgICAgaWYgKCFyZXN1bHQgfHwgcmVzdWx0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICBuZXh0KCk7XG4gICAgICB9XG4gICAgICAvLyBkZWJ1Z2xvZygncmVzdWx0IDogJyArIEpTT04uc3RyaW5naWZ5KHJlc3VsdCwgdW5kZWZpbmVkLCAyKSk7XG4gICAgICBkZWJ1Z2xvZygnYmVzdCByZXN1bHQgOiAnICsgSlNPTi5zdHJpbmdpZnkocmVzdWx0WzBdIHx8IHt9LCB1bmRlZmluZWQsIDIpKTtcbiAgICAgIGRlYnVnbG9nKCd0b3AgOiAnICsgTWF0Y2guVG9vbE1hdGNoLmR1bXBXZWlnaHRzVG9wKHJlc3VsdCwgeyB0b3A6IDMgfSkpO1xuXG5cbiAgICAgIGlmIChBbmFseXplLmlzQ29tcGxldGUocmVzdWx0WzBdKSkge1xuICAgICAgICBzZXNzaW9uLmRpYWxvZ0RhdGEucmVzdWx0ID0gcmVzdWx0WzBdO1xuICAgICAgICAvLyAgICBzZXNzaW9uLnNlbmQoJ1Nob3dpbmcgZW50aXR5IC4uLicpO1xuICAgICAgICBuZXh0KCk7XG4gICAgICB9IGVsc2UgaWYgKEFuYWx5emUuZ2V0UHJvbXB0KHJlc3VsdFswXSkpIHtcbiAgICAgICAgdmFyIHByb21wdCA9IEFuYWx5emUuZ2V0UHJvbXB0KHJlc3VsdFswXSk7XG4gICAgICAgIHNlc3Npb24uZGlhbG9nRGF0YS5yZXN1bHQgPSByZXN1bHRbMF07XG4gICAgICAgIHNlc3Npb24uZGlhbG9nRGF0YS5wcm9tcHQgPSBwcm9tcHQ7XG4gICAgICAgIGRpYWxvZ2xvZyhcIlNob3dNZVwiLCBzZXNzaW9uLHNlbmQoXCJOb3QgZW5vdWdoIGluZm9ybWF0aW9uIHN1cHBsaWVkOiBcIiArIE1hdGNoLlRvb2xNYXRjaC5kdW1wTmljZShcbiAgICAgICAgICBzZXNzaW9uLmRpYWxvZ0RhdGEucmVzdWx0XG4gICAgICAgICkpKTtcbiAgICAgICAgYnVpbGRlci5Qcm9tcHRzLnRleHQoc2Vzc2lvbiwgcHJvbXB0LnRleHQpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIGJlc3QgPSByZXN1bHQubGVuZ3RoID8gTWF0Y2guVG9vbE1hdGNoLmR1bXBOaWNlKHJlc3VsdFswXSkgOiBcIjxub3RoaW5nPlwiO1xuICAgICAgICBkaWFsb2dsb2coXCJTaG93TWVcIiwgc2Vzc2lvbiwgc2VuZCgnSSBkaWQgbm90IHVuZGVyc3RhbmQgdGhpcycgKyBiZXN0KSk7XG4gICAgICB9XG4gICAgfSxcbiAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgcmVzdWx0cywgbmV4dCkge1xuICAgICAgdmFyIHJlc3VsdCA9IHNlc3Npb24uZGlhbG9nRGF0YS5yZXN1bHQ7XG4gICAgICBpZiAoIXJlc3VsdCB8fCByZXN1bHQubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIG5leHQoKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHJlc3VsdHMucmVzcG9uc2UpIHtcbiAgICAgICAgLy8gc29tZSBwcm9tcHRpbmdcbiAgICAgICAgQW5hbHl6ZS5zZXRQcm9tcHQoc2Vzc2lvbi5kaWFsb2dEYXRhLnJlc3VsdCwgc2Vzc2lvbi5kaWFsb2dEYXRhLnByb21wdCwgcmVzdWx0cy5yZXNwb25zZSk7XG4gICAgICB9XG4gICAgICBpZiAoQW5hbHl6ZS5pc0NvbXBsZXRlKHNlc3Npb24uZGlhbG9nRGF0YS5yZXN1bHQpKSB7XG4gICAgICAgIG5leHQoKTtcbiAgICAgIH0gZWxzZSBpZiAoQW5hbHl6ZS5nZXRQcm9tcHQoc2Vzc2lvbi5kaWFsb2dEYXRhLnJlc3VsdCkpIHtcbiAgICAgICAgdmFyIHByb21wdCA9IEFuYWx5emUuZ2V0UHJvbXB0KHNlc3Npb24uZGlhbG9nRGF0YS5yZXN1bHQpO1xuICAgICAgICBzZXNzaW9uLmRpYWxvZ0RhdGEucHJvbXB0ID0gcHJvbXB0O1xuICAgICAgICBidWlsZGVyLlByb21wdHMudGV4dChzZXNzaW9uLCBwcm9tcHQudGV4dCk7XG4gICAgICB9XG4gICAgfSxcbiAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgcmVzdWx0cywgbmV4dCkge1xuICAgICAgdmFyIHJlc3VsdCA9IHNlc3Npb24uZGlhbG9nRGF0YS5yZXN1bHQ7XG4gICAgICBpZiAocmVzdWx0cy5yZXNwb25zZSkge1xuICAgICAgICAvLyBzb21lIHByb21wdGluZ1xuICAgICAgICBBbmFseXplLnNldFByb21wdChzZXNzaW9uLmRpYWxvZ0RhdGEucmVzdWx0LFxuICAgICAgICAgIHNlc3Npb24uZGlhbG9nRGF0YS5wcm9tcHQsIHJlc3VsdHMucmVzcG9uc2UpO1xuICAgICAgfVxuICAgICAgaWYgKEFuYWx5emUuaXNDb21wbGV0ZShzZXNzaW9uLmRpYWxvZ0RhdGEucmVzdWx0KSkge1xuICAgICAgICBjb25zdCBleGVjID0gRXhlY1NlcnZlci5leGVjVG9vbChzZXNzaW9uLmRpYWxvZ0RhdGEucmVzdWx0IGFzIElNYXRjaC5JVG9vbE1hdGNoLCB0aGVNb2RlbC5yZWNvcmRzKTtcblxuICAgICAgICB2YXIgcmVwbHkgPSBuZXcgYnVpbGRlci5NZXNzYWdlKHNlc3Npb24pXG4gICAgICAgICAgLnRleHQoZXhlYy50ZXh0KVxuICAgICAgICAgIC5hZGRFbnRpdHkoZXhlYy5hY3Rpb24pO1xuICAgICAgICAvLyAuYWRkQXR0YWNobWVudCh7IGZhbGxiYWNrVGV4dDogXCJJIGRvbid0IGtub3dcIiwgY29udGVudFR5cGU6ICdpbWFnZS9qcGVnJywgY29udGVudFVybDogXCJ3d3cud29tYmF0Lm9yZ1wiIH0pO1xuICAgICAgICBkaWFsb2dsb2coXCJTaG93TWVcIixzZXNzaW9uLHNlbmQocmVwbHkpKTtcblxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKHNlc3Npb24uZGlhbG9nRGF0YS5yZXN1bHQpIHtcbiAgICAgICAgICBkaWFsb2dsb2coXCJTaG93TWVcIixcbiAgICAgICAgICBzZXNzaW9uLHNlbmQoXCJOb3QgZW5vdWdoIGluZm9ybWF0aW9uIHN1cHBsaWVkOiBcIiArIE1hdGNoLlRvb2xNYXRjaC5kdW1wTmljZShcbiAgICAgICAgICAgIHNlc3Npb24uZGlhbG9nRGF0YS5yZXN1bHRcbiAgICAgICAgICApKSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgZGlhbG9nbG9nKFwiU2hvd01lXCIsIHNlc3Npb24sIHNlbmQoXCJJIGRpZCBub3QgZ2V0IHdoYXQgeW91IHdhbnRcIikpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSxcbiAgXSk7XG5cbiAgZGlhbG9nLm1hdGNoZXMoJ1doYXRJcycsIFtcbiAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgYXJncywgbmV4dCkge1xuICAgICAgdmFyIGlzQ29tYmluZWRJbmRleCA9IHt9O1xuICAgICAgdmFyIG9OZXdFbnRpdHk7XG4gICAgICAvLyBleHBlY3RpbmcgZW50aXR5IEExXG4gICAgICB2YXIgbWVzc2FnZSA9IHNlc3Npb24ubWVzc2FnZS50ZXh0O1xuICAgICAgZGVidWdsb2coXCJXaGF0SXMgRW50aXRpZXNcIik7XG4gICAgICBkZWJ1Z2xvZygncmF3OiAnICsgSlNPTi5zdHJpbmdpZnkoYXJncy5lbnRpdGllcyksIHVuZGVmaW5lZCwgMik7XG4gICAgICB2YXIgY2F0ZWdvcnlFbnRpdHkgPSBidWlsZGVyLkVudGl0eVJlY29nbml6ZXIuZmluZEVudGl0eShhcmdzLmVudGl0aWVzLCAnY2F0ZWdvcnknKTtcbiAgICAgIHZhciBjYXRlZ29yeSA9IGNhdGVnb3J5RW50aXR5LmVudGl0eTtcbiAgICAgIHZhciBhMSA9IGJ1aWxkZXIuRW50aXR5UmVjb2duaXplci5maW5kRW50aXR5KGFyZ3MuZW50aXRpZXMsICdBMScpO1xuXG4gICAgICB2YXIgY2F0ID0gV2hhdElzLmFuYWx5emVDYXRlZ29yeShjYXRlZ29yeSwgdGhlTW9kZWwucnVsZXMsIG1lc3NhZ2UpO1xuICAgICAgaWYgKCFjYXQpIHtcbiAgICAgICAgc2Vzc2lvbi5zZW5kKCdJIGRvblxcJ3Qga25vdyBhbnl0aGluZyBhYm91dCBcIicgKyBjYXRlZ29yeSArICdcIicpO1xuICAgICAgICAvLyBuZXh0KCk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGRlYnVnbG9nKCdjYXRlZ29yeSBpZGVudGlmaWVkOicgKyBjYXQpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gV2hhdElzLnJlc29sdmVDYXRlZ29yeShjYXQsIGExLmVudGl0eSxcbiAgICAgICAgdGhlTW9kZWwucnVsZXMsIHRoZU1vZGVsLnJlY29yZHMpO1xuICAgICAgZGVidWdsb2coJ3doYXRpcyByZXN1bHQ6JyArIEpTT04uc3RyaW5naWZ5KHJlc3VsdCkpO1xuICAgICAgbG9nUXVlcnlXaGF0SXMoc2Vzc2lvbiwgJ1doYXRJcycsIHJlc3VsdCk7XG4gICAgICB2YXIgaW5kaXMgPSBXaGF0SXMuaXNJbmRpc2NyaW1pbmF0ZVJlc3VsdChyZXN1bHQpO1xuICAgICAgaWYgKGluZGlzKSB7XG4gICAgICAgIHNlc3Npb24uc2VuZChpbmRpcyk7XG4gICAgICAgIC8vIG5leHQoKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaWYgKCFyZXN1bHQgfHwgcmVzdWx0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICBkaWFsb2dsb2coXCJXaGF0SXNcIixzZXNzaW9uLHNlbmQoJ0kgZG9uXFwndCBrbm93IGFueXRoaW5nIGFib3V0IFwiJyArIGNhdCArIFwiIChcIiArIGNhdGVnb3J5ICsgJylcXFwiIGluIHJlbGF0aW9uIHRvIFwiJyArIGExLmVudGl0eSArICdcIicpKTtcbiAgICAgICAgLy8gbmV4dCgpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBkZWJ1Z2xvZygncmVzdWx0IDogJyArIEpTT04uc3RyaW5naWZ5KHJlc3VsdCwgdW5kZWZpbmVkLCAyKSk7XG4gICAgICAgIGRlYnVnbG9nKCdiZXN0IHJlc3VsdCA6ICcgKyBKU09OLnN0cmluZ2lmeShyZXN1bHRbMF0gfHwge30sIHVuZGVmaW5lZCwgMikpO1xuICAgICAgICBkZWJ1Z2xvZygndG9wIDogJyArIFdoYXRJcy5kdW1wV2VpZ2h0c1RvcChyZXN1bHQsIHsgdG9wOiAzIH0pKTtcbiAgICAgICAgLy8gVE9ETyBjbGVhbnNlZCBzZW50ZW5jZVxuICAgICAgICBkaWFsb2dsb2coXCJXaGF0SXNcIixzZXNzaW9uLHNlbmQoJ1RoZSAnICsgY2F0ZWdvcnkgKyAnIG9mICcgKyBhMS5lbnRpdHkgKyAnIGlzICcgKyByZXN1bHRbMF0ucmVzdWx0ICsgXCJcXG5cIikpOyAvLyAgKyBKU09OLnN0cmluZ2lmeShyZXN1bHRbMF0pKTtcbiAgICAgIH1cbiAgICB9XG4gIF0pO1xuXG5cbiAgZGlhbG9nLm1hdGNoZXMoJ0xpc3RBbGwnLCBbXG4gICAgZnVuY3Rpb24gKHNlc3Npb24sIGFyZ3MsIG5leHQpIHtcbiAgICAgIHZhciBpc0NvbWJpbmVkSW5kZXggPSB7fTtcbiAgICAgIHZhciBvTmV3RW50aXR5O1xuICAgICAgLy8gZXhwZWN0aW5nIGVudGl0eSBBMVxuICAgICAgdmFyIG1lc3NhZ2UgPSBzZXNzaW9uLm1lc3NhZ2UudGV4dDtcbiAgICAgIGRlYnVnbG9nKFwiSW50ZW50IDogTGlzdEFsbFwiKTtcbiAgICAgIGRlYnVnbG9nKCdyYXc6ICcgKyBKU09OLnN0cmluZ2lmeShhcmdzLmVudGl0aWVzKSwgdW5kZWZpbmVkLCAyKTtcbiAgICAgIHZhciBjYXRlZ29yeUVudGl0eSA9IGJ1aWxkZXIuRW50aXR5UmVjb2duaXplci5maW5kRW50aXR5KGFyZ3MuZW50aXRpZXMsICdjYXRlZ29yaWVzJyk7XG4gICAgICB2YXIgY2F0ZWdvcnkgPSBjYXRlZ29yeUVudGl0eS5lbnRpdHk7XG4gICAgICB2YXIgYTEgPSBidWlsZGVyLkVudGl0eVJlY29nbml6ZXIuZmluZEVudGl0eShhcmdzLmVudGl0aWVzLCAnaW5zdGgnKTtcbiAgICAgIGlmIChjYXRlZ29yeSA9PT0gXCJjYXRlZ29yaWVzXCIpIHtcbiAgICAgICAgLy8gZG8gd2UgaGF2ZSBhIGZpbHRlciA/XG4gICAgICAgIHZhciBkb21haW4gPSB1bmRlZmluZWQ7XG4gICAgICAgIGlmKGExICYmIGExLmVudGl0eSkge1xuICAgICAgICAgIGRvbWFpbiA9IExpc3RBbGwuaW5mZXJEb21haW4odGhlTW9kZWwsIGExLmVudGl0eSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYoIWRvbWFpbikge1xuICAgICAgICAgIHZhciByZXMgPSByZXN0cmljdExvZ2dlZE9uKHNlc3Npb24sIHRoZU1vZGVsLmNhdGVnb3J5KS5qb2luKFwiO1xcblwiKTtcbiAgICAgICAgICBpZihhMSAmJiBhMS5lbnRpdHkpIHtcbiAgICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxcIixzZXNzaW9uLHNlbmQoXCJJIGRpZCBub3QgaW5mZXIgYSBkb21haW4gcmVzdHJpY3Rpb24gZnJvbSBcXFwiXCIgKyBhMS5lbnRpdHkgKyBcIlxcXCIsIGFsbCBteSBjYXRlZ29yaWVzIGFyZSAuLi5cXG5cIiArIHJlcykpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsXCIsc2Vzc2lvbixzZW5kKFwibXkgY2F0ZWdvcmllcyBhcmUgLi4uXFxuXCIgKyByZXMpKTtcbiAgICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHZhciBhUmVzID0gTW9kZWwuZ2V0Q2F0ZWdvcmllc0ZvckRvbWFpbih0aGVNb2RlbCwgZG9tYWluKTtcbiAgICAgICAgICAgdmFyIHJlcyA9IHJlc3RyaWN0TG9nZ2VkT24oc2Vzc2lvbiwgYVJlcykuam9pbihcIjtcXG5cIik7XG4gICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbFwiLHNlc3Npb24sc2VuZChcIm15IGNhdGVnb3JpZXMgaW4gZG9tYWluIFxcXCJcIiArIGRvbWFpbiArIFwiXFxcIiBhcmUgLi4uXFxuXCIgKyByZXMpKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGlmIChjYXRlZ29yeSA9PT0gXCJkb21haW5zXCIpIHtcbiAgICAgICAgdmFyIHJlcyA9IHJlc3RyaWN0TG9nZ2VkT24oc2Vzc2lvbiwgdGhlTW9kZWwuZG9tYWlucykuam9pbihcIjtcXG5cIik7XG4gICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxcIixzZXNzaW9uLCBzZW5kKFwibXkgZG9tYWlucyBhcmUgLi4uXFxuXCIgKyByZXMpKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgaWYgKGNhdGVnb3J5ID09PSBcInRvb2xzXCIpIHtcbiAgICAgICAgdmFyIHJlcyA9IHJlc3RyaWN0TG9nZ2VkT24oc2Vzc2lvbiwgdGhlTW9kZWwudG9vbHMpLm1hcChmdW5jdGlvbiAob1Rvb2wpIHtcbiAgICAgICAgICByZXR1cm4gb1Rvb2wubmFtZTtcbiAgICAgICAgfSkuam9pbihcIjtcXG5cIik7XG4gICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxcIiwgc2Vzc2lvbixzZW5kKFwibXkgdG9vbHMgYXJlIC4uLlxcblwiICsgcmVzKSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHZhciBjYXQgPSBXaGF0SXMuYW5hbHl6ZUNhdGVnb3J5KGNhdGVnb3J5LCB0aGVNb2RlbC5ydWxlcywgbWVzc2FnZSk7XG4gICAgICBpZiAoIWNhdCkge1xuICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsXCIsc2Vzc2lvbixzZW5kKCdJIGRvblxcJ3Qga25vdyBhbnl0aGluZyBhYm91dCBcIicgKyBjYXRlZ29yeSArICdcIicpKTtcbiAgICAgICAgLy8gbmV4dCgpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBkZWJ1Z2xvZygnY2F0ZWdvcnkgaWRlbnRpZmllZDonICsgY2F0KTtcbiAgICAgIGlmIChhMSAmJiBhMS5lbnRpdHkpIHtcbiAgICAgICAgZGVidWdsb2coJ2dvdCBmaWx0ZXI6JyArIGExLmVudGl0eSk7XG4gICAgICAgIHZhciBjYXRlZ29yeVNldCA9IE1vZGVsLmdldEFsbFJlY29yZENhdGVnb3JpZXNGb3JUYXJnZXRDYXRlZ29yeSh0aGVNb2RlbCwgY2F0LCB0cnVlKTtcbiAgICAgICAgdmFyIHJlc3VsdDEgPSBMaXN0QWxsLmxpc3RBbGxXaXRoQ29udGV4dChjYXQsIGExLmVudGl0eSxcbiAgICAgICAgICB0aGVNb2RlbC5ydWxlcywgdGhlTW9kZWwucmVjb3JkcywgY2F0ZWdvcnlTZXQpO1xuICAgICAgICAvLyBUT0RPIGNsYXNzaWZ5aW5nIHRoZSBzdHJpbmcgdHdpY2UgaXMgYSB0ZXJyaWJsZSB3YXN0ZVxuICAgICAgICBpZiAoIXJlc3VsdDEubGVuZ3RoKSB7XG4gICAgICAgICAgZGVidWdsb2coJ2dvaW5nIGZvciBoYXZpbmcnKTtcbiAgICAgICAgICB2YXIgY2F0ZWdvcnlTZXRGdWxsID0gTW9kZWwuZ2V0QWxsUmVjb3JkQ2F0ZWdvcmllc0ZvclRhcmdldENhdGVnb3J5KHRoZU1vZGVsLCBjYXQsIGZhbHNlKTtcbiAgICAgICAgICByZXN1bHQxID0gTGlzdEFsbC5saXN0QWxsSGF2aW5nQ29udGV4dChjYXQsIGExLmVudGl0eSwgdGhlTW9kZWwucnVsZXMsXG4gICAgICAgICAgICB0aGVNb2RlbC5yZWNvcmRzLCBjYXRlZ29yeVNldEZ1bGwpO1xuICAgICAgICB9XG4gICAgICAgIGRlYnVnbG9nKCdsaXN0YWxsIHJlc3VsdDonICsgSlNPTi5zdHJpbmdpZnkocmVzdWx0MSkpO1xuICAgICAgICB2YXIgam9pbnJlc3VsdHMgPSByZXN0cmljdExvZ2dlZE9uKHNlc3Npb24sIExpc3RBbGwuam9pblJlc3VsdHMocmVzdWx0MSkpO1xuICAgICAgICBsb2dRdWVyeVdoYXRJcyhzZXNzaW9uLCAnTGlzdEFsbCcsIHJlc3VsdDEpO1xuICAgICAgICBpZihqb2lucmVzdWx0cy5sZW5ndGggKXtcbiAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsXCIsc2Vzc2lvbixzZW5kKFwidGhlIFwiICsgY2F0ZWdvcnkgKyBcIiBmb3IgXCIgKyBhMS5lbnRpdHkgKyBcIiBhcmUgLi4uXFxuXCIgKyBqb2lucmVzdWx0cy5qb2luKFwiO1xcblwiKSkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxcIixzZXNzaW9uLHNlbmQoXCJpIGRpZCBub3QgZmluZCBhbnkgXCIgKyBjYXRlZ29yeSArIFwiIGZvciBcIiArIGExLmVudGl0eSArIFwiLlxcblwiICsgam9pbnJlc3VsdHMuam9pbihcIjtcXG5cIikpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm47XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBubyBlbnRpdHksIGUuZy4gbGlzdCBhbGwgY291bnRyaWVzXG4gICAgICAgIC8vXG4gICAgICAgIHZhciBjYXRlZ29yeVNldEZ1bGwgPSBNb2RlbC5nZXRBbGxSZWNvcmRDYXRlZ29yaWVzRm9yVGFyZ2V0Q2F0ZWdvcnkodGhlTW9kZWwsIGNhdCwgZmFsc2UpO1xuICAgICAgICB2YXIgcmVzdWx0ID0gTGlzdEFsbC5saXN0QWxsSGF2aW5nQ29udGV4dChjYXQsIGNhdCwgdGhlTW9kZWwucnVsZXMsIHRoZU1vZGVsLnJlY29yZHMsIGNhdGVnb3J5U2V0RnVsbCk7XG4gICAgICAgIGxvZ1F1ZXJ5V2hhdElzKHNlc3Npb24sICdMaXN0QWxsJywgcmVzdWx0KTtcbiAgICAgICAgaWYgKHJlc3VsdC5sZW5ndGgpIHtcbiAgICAgICAgICBkZWJ1Z2xvZygnbGlzdGFsbCByZXN1bHQ6JyArIEpTT04uc3RyaW5naWZ5KHJlc3VsdCkpO1xuICAgICAgICAgIHZhciBqb2lucmVzdWx0cyA9IFtdO1xuICAgICAgICAgIGRlYnVnbG9nKFwiaGVyZSBpcyBjYXQ+XCIgKyBjYXQpO1xuICAgICAgICAgIGlmKGNhdCAhPT0gXCJleGFtcGxlIHF1ZXN0aW9uXCIpIHtcbiAgICAgICAgICAgIGpvaW5yZXN1bHRzID0gcmVzdHJpY3RMb2dnZWRPbihzZXNzaW9uLCBMaXN0QWxsLmpvaW5SZXN1bHRzKHJlc3VsdCkpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICBqb2lucmVzdWx0cyA9IExpc3RBbGwuam9pblJlc3VsdHMocmVzdWx0KTtcbiAgICAgICAgICB9XG4gICAgICAgICAgdmFyIHJlc3BvbnNlID0gXCJ0aGUgXCIgKyBjYXRlZ29yeSArIFwiIGFyZSAuLi5cXG5cIiArIGpvaW5yZXN1bHRzLmpvaW4oXCI7XFxuXCIpO1xuICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxcIixzZXNzaW9uLHNlbmQocmVzcG9uc2UpKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdmFyIHJlc3BvbnNlID0gXCJGb3VuZCBubyBkYXRhIGhhdmluZyBcXFwiXCIgKyBjYXQgKyBcIlxcXCJcIlxuICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxcIixzZXNzaW9uLHNlbmQocmVzcG9uc2UpKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIF0pO1xuXG5cbiAgZGlhbG9nLm1hdGNoZXMoJ0xpc3RBbGxCaW5PcCcsIFtcbiAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgYXJncywgbmV4dCkge1xuICAgICAgdmFyIGlzQ29tYmluZWRJbmRleCA9IHt9O1xuICAgICAgdmFyIG9OZXdFbnRpdHk7XG4gICAgICAvLyBleHBlY3RpbmcgZW50aXR5IEExXG4gICAgICB2YXIgbWVzc2FnZSA9IHNlc3Npb24ubWVzc2FnZS50ZXh0O1xuICAgICAgZGVidWdsb2coXCJJbnRlbnQgOiBMaXN0QWxsQmluT3BcIik7XG4gICAgICBkZWJ1Z2xvZygncmF3OiAnICsgSlNPTi5zdHJpbmdpZnkoYXJncy5lbnRpdGllcyksIHVuZGVmaW5lZCwgMik7XG4gICAgICB2YXIgY2F0ZWdvcnlFbnRpdHkgPSBidWlsZGVyLkVudGl0eVJlY29nbml6ZXIuZmluZEVudGl0eShhcmdzLmVudGl0aWVzLCAnY2F0ZWdvcnknKTtcbiAgICAgIHZhciBjYXRlZ29yeVdvcmQgPSBjYXRlZ29yeUVudGl0eS5lbnRpdHk7XG4gICAgICB2YXIgb3BFbnRpdHkgPSBidWlsZGVyLkVudGl0eVJlY29nbml6ZXIuZmluZEVudGl0eShhcmdzLmVudGl0aWVzLCdvcGVyYXRvcicpO1xuICAgICAgdmFyIG9wZXJhdG9yV29yZCA9IG9wRW50aXR5LmVudGl0eTtcbiAgICAgIC8vIGNhdGVnb3JpemUgYXMgb3BlcmF0b3IgP1xuXG4gICAgICB2YXIgb3BlcmF0b3IgPSBXaGF0SXMuYW5hbHl6ZU9wZXJhdG9yKG9wZXJhdG9yV29yZCwgdGhlTW9kZWwucnVsZXMsIG1lc3NhZ2UpO1xuICAgICAgdmFyIGNhdGVnb3J5ID0gV2hhdElzLmFuYWx5emVDYXRlZ29yeShjYXRlZ29yeVdvcmQsIHRoZU1vZGVsLnJ1bGVzLCBtZXNzYWdlKTtcbiAgICAgIHZhciBvcGVyYXRvckFyZ3MgPSBNb2RlbC5nZXRPcGVyYXRvcih0aGVNb2RlbCwgb3BlcmF0b3IpO1xuICAgICAgdmFyIGEyID0gYnVpbGRlci5FbnRpdHlSZWNvZ25pemVyLmZpbmRFbnRpdHkoYXJncy5lbnRpdGllcywgJ0EyJyk7XG4gICAgICBpZiAoIW9wZXJhdG9yKSB7XG4gICAgICAgIHZhciBzID0gXCJVbmtub3duIG9wZXJhdG9yIFwiICsgb3BlcmF0b3JXb3JkICtcIiwgdGhpcyBpcyBhIG1vZGVsIGJ1ZywgY2hlY2sgb3BlcmF0b3JzLmpzb24gYW5kIGludGVudHMuanNvblwiO1xuICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsQmluT3BcIixzZXNzaW9uLHNlbmQoXCJvdWNoLCB0aGlzIHdhcyBpbiBpbnRlcm5hbCBlcnJvci4gUmVjb3ZlcmluZyBmcm9tIGEgd2VpcmQgb3BlcmF0b3IgXFxcIlwiXG4gICAgICAgICsgb3BlcmF0b3JXb3JkICsgXCJcXFwiXFxuXCIpKTtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKHMpO1xuICAgICAgfVxuICAgICAgdmFyIGZyYWdtZW50ID0gYTIgJiYgYTIuZW50aXR5O1xuICAgICAgZnJhZ21lbnQgPSBCcmVha0Rvd24udHJpbVF1b3RlZChCcmVha0Rvd24udHJpbVF1b3RlZFNwYWNlZChmcmFnbWVudCkpO1xuICAgICAgZGVidWdsb2coXCJmcmFnbWVudCBhZnRlciB0cmltbWluZyBcXFwiXCIgKyBmcmFnbWVudCArIFwiXFxcIlwiKTtcbiAgICAgIGlmIChjYXRlZ29yeVdvcmQgPT09IFwiY2F0ZWdvcmllc1wiKSB7XG4gICAgICAgIC8vIGRvIHdlIGhhdmUgYSBmaWx0ZXI/XG4gICAgICAgIHZhciBhRmlsdGVyZWRDYXRlZ29yaWVzID0gTGlzdEFsbC5maWx0ZXJTdHJpbmdMaXN0QnlPcChvcGVyYXRvckFyZ3MsIGZyYWdtZW50LCAgdGhlTW9kZWwuY2F0ZWdvcnkpO1xuICAgICAgICByZXMgPSByZXN0cmljdExvZ2dlZE9uKHNlc3Npb24sIGFGaWx0ZXJlZENhdGVnb3JpZXMpLmpvaW4oXCI7XFxuXCIpO1xuICAgICAgICBpZiAocmVzLmxlbmd0aCkge1xuICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxCaW5PcFwiLHNlc3Npb24sc2VuZChcIm15IGNhdGVnb3JpZXMgXCIgKyBvcGVyYXRvciArICcgXCInICsgZnJhZ21lbnQgKyAnXCIgYXJlIC4uLlxcbicgKyByZXMpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsQmluT3BcIiwgc2Vzc2lvbixzZW5kKCdJIGhhdmUgbm8gY2F0ZWdvcmllcyAnICsgb3BlcmF0b3IgKyAnIFwiJyArIGZyYWdtZW50ICsgJ1wiJykpO1xuICAgICAgICB9XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgZWxzZSBpZiAoY2F0ZWdvcnlXb3JkID09PSBcImRvbWFpbnNcIikge1xuICAgICAgICB2YXIgYVJlcyA9IExpc3RBbGwuZmlsdGVyU3RyaW5nTGlzdEJ5T3Aob3BlcmF0b3JBcmdzLCBmcmFnbWVudCwgIHRoZU1vZGVsLmRvbWFpbnMpO1xuICAgICAgICByZXMgPSByZXN0cmljdExvZ2dlZE9uKHNlc3Npb24sIGFSZXMpLmpvaW4oXCI7XFxuXCIpO1xuICAgICAgICBpZiAocmVzLmxlbmd0aCkge1xuICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxCaW5PcFwiLHNlc3Npb24sc2VuZChcIm15IGRvbWFpbnMgXCIgKyBvcGVyYXRvciArICcgXCInICsgZnJhZ21lbnQgKyAnXCIgYXJlIC4uLlxcbicgKyByZXMpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsQmluT3BcIiwgc2Vzc2lvbixzZW5kKCdJIGhhdmUgbm8gZG9tYWlucyAnICsgb3BlcmF0b3IgKyAnIFwiJyArIGZyYWdtZW50ICsgJ1wiJykpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIGVsc2UgaWYgKGNhdGVnb3J5V29yZCA9PT0gXCJ0b29sc1wiKSB7XG4gICAgICAgIHZhciBhUmVzID0gTGlzdEFsbC5maWx0ZXJTdHJpbmdMaXN0QnlPcChvcGVyYXRvckFyZ3MsIGZyYWdtZW50LCAgdGhlTW9kZWwudG9vbHMubWFwKFxuICAgICAgICBmdW5jdGlvbihvVG9vbCkgeyByZXR1cm4gb1Rvb2wubmFtZTsgfSkpO1xuICAgICAgICB2YXIgcmVzID0gcmVzdHJpY3RMb2dnZWRPbihzZXNzaW9uLCBhUmVzKS5qb2luKFwiO1xcblwiKTtcbiAgICAgICAgaWYocmVzLmxlbmd0aCkge1xuICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxCaW5PcFwiLCBzZXNzaW9uLHNlbmQoXCJteSB0b29scyBcIiArIG9wZXJhdG9yICsgJyBcIicgKyBmcmFnbWVudCArICdcIiBhcmUgLi4uXFxuJyArIHJlcykpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxCaW5PcFwiLCBzZXNzaW9uLHNlbmQoXCJJIGhhdmUgbm8gdG9vbHMgXCIgKyBvcGVyYXRvciArICcgXCInICsgZnJhZ21lbnQgKyAnXCInKSk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgZWxzZSB7IC8vIGNhdGVnb3J5IGlzIGNhdGVnb3J5XG4gICAgICAgIHZhciBjYXQgPSBXaGF0SXMuYW5hbHl6ZUNhdGVnb3J5KGNhdGVnb3J5V29yZCwgdGhlTW9kZWwucnVsZXMsIG1lc3NhZ2UpO1xuICAgICAgICBpZiAoIWNhdCkge1xuICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxCaW5PcFwiLHNlc3Npb24sc2VuZCgnSSBkb25cXCd0IGtub3cgYW55dGhpbmcgYWJvdXQgXCInICsgY2F0ZWdvcnlXb3JkICsgJ1wiJykpO1xuICAgICAgICAgIC8vIG5leHQoKTtcbiAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgZGVidWdsb2coJ2NhdGVnb3J5IGlkZW50aWZpZWQ6JyArIGNhdCk7XG4gICAgICAgIHZhciBhUmVzID0gTGlzdEFsbC5nZXRDYXRlZ29yeU9wRmlsdGVyQXNEaXN0aW5jdFN0cmluZ3Mob3BlcmF0b3JBcmdzLCBmcmFnbWVudCwgY2F0ZWdvcnksIHRoZU1vZGVsLnJlY29yZHMpO1xuICAgICAgICB2YXIgcmVzID0gcmVzdHJpY3RMb2dnZWRPbihzZXNzaW9uLCBhUmVzKS5qb2luKFwiO1xcblwiKTtcbiAgICAgICAgdmFyIGluZml4RXhwbGFpbiA9ICcnXG4gICAgICAgIGlmICghTGlzdEFsbC5saWtlbHlQbHVyYWxEaWZmKGNhdGVnb3J5LCBjYXRlZ29yeVdvcmQpKSB7XG4gICAgICAgICAgaW5maXhFeHBsYWluID0gJyhcIicgKyBjYXRlZ29yeSArICdcIiknO1xuICAgICAgICB9XG4gICAgICAgIGlmKHJlcy5sZW5ndGgpIHtcbiAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsQmluT3BcIixzZXNzaW9uLHNlbmQoJ215ICcgKyBjYXRlZ29yeVdvcmQgKyBpbmZpeEV4cGxhaW4gKyAnICcgKyBvcGVyYXRvciArICcgXCInICsgZnJhZ21lbnQgKyAnXCIgYXJlIC4uLlxcbicgKyByZXMpKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsQmluT3BcIiwgc2Vzc2lvbixzZW5kKCdJIGhhdmUgbm8gJyArIGNhdGVnb3J5V29yZCArIGluZml4RXhwbGFpbiArICcgJyArIG9wZXJhdG9yICsgJyBcIicgKyBmcmFnbWVudCArICdcIicpKTtcbiAgICAgICAgfVxuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgfVxuICBdKTtcblxuICBkaWFsb2cubWF0Y2hlcygnVHJhaW5NZScsIFtcbiAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgYXJncywgbmV4dCkge1xuICAgICAgdmFyIGlzQ29tYmluZWRJbmRleCA9IHt9O1xuICAgICAgdmFyIG9OZXdFbnRpdHk7XG4gICAgICAvLyBleHBlY3RpbmcgZW50aXR5IEExXG4gICAgICB2YXIgbWVzc2FnZSA9IHNlc3Npb24ubWVzc2FnZS50ZXh0O1xuICAgICAgZGVidWdsb2coXCJJbnRlbnQgOiBUcmFpblwiKTtcbiAgICAgIGRlYnVnbG9nKCdyYXc6ICcgKyBKU09OLnN0cmluZ2lmeShhcmdzLmVudGl0aWVzKSwgdW5kZWZpbmVkLCAyKTtcbiAgICAgIHZhciBjYXRlZ29yeUVudGl0eSA9IGJ1aWxkZXIuRW50aXR5UmVjb2duaXplci5maW5kRW50aXR5KGFyZ3MuZW50aXRpZXMsICdjYXRlZ29yaWVzJyk7XG4gICAgICBpZiAobWVzc2FnZS50b0xvd2VyQ2FzZSgpLmluZGV4T2YoXCJrcm9ub3NcIikgPj0gMCB8fCBtZXNzYWdlLnRvTG93ZXJDYXNlKCkuaW5kZXhPZihcImtsaW5nb25cIikgPj0gMCkge1xuICAgICAgICBkaWFsb2dsb2coXCJUcmFpbk1lXCIsc2Vzc2lvbixzZW5kKGdldFJhbmRvbVJlc3VsdChhVHJhaW5Ob0tsaW5nb24pKSk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHZhciByZXMgPSBnZXRSYW5kb21SZXN1bHQoYVRyYWluUmVwbGllcyk7XG4gICAgICBkaWFsb2dsb2coXCJUcmFpbk1lXCIsc2Vzc2lvbixzZW5kKHJlcykpO1xuICAgIH1cbiAgXSk7XG5cblxuXG4gIGRpYWxvZy5tYXRjaGVzKCdXcm9uZycsIFtcbiAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgYXJncywgbmV4dCkge1xuICAgICAgICBkaWFsb2dMb2dnZXIoIHtcbiAgICAgICAgICBzZXNzaW9uOiBzZXNzaW9uLFxuICAgICAgICAgIGludGVudCA6IFwiV3JvbmdcIixcbiAgICAgICAgICByZXNwb25zZSA6ICc8YmVnaW4gdXBkb3duPidcbiAgICAgICAgfSk7XG4gICAgICBzZXNzaW9uLmJlZ2luRGlhbG9nKCcvdXBkb3duJywgc2Vzc2lvbi51c2VyRGF0YS5jb3VudCk7XG4gICAgfSxcbiAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgcmVzdWx0cywgbmV4dCkge1xuICAgICAgdmFyIGFsYXJtID0gc2Vzc2lvbi5kaWFsb2dEYXRhLmFsYXJtO1xuICAgICAgbmV4dCgpO1xuICAgIH0sXG4gICAgZnVuY3Rpb24gKHNlc3Npb24sIHJlc3VsdHMpIHtcbiAgICAgIHNlc3Npb24uc2VuZChnZXRSYW5kb21SZXN1bHQoYUJhY2tGcm9tVHJhaW5pbmcpKTsgLy8gICsgSlNPTi5zdHJpbmdpZnkocmVzdWx0cykpO1xuICAgICAgLy9zZXNzaW9uLnNlbmQoJ2VuZCBvZiB3cm9uZycpO1xuICAgIH1cbiAgXSk7XG5cbiAgZGlhbG9nLm1hdGNoZXMoJ0V4aXQnLCBbXG4gICAgZnVuY3Rpb24gKHNlc3Npb24sIGFyZ3MsIG5leHQpIHtcbiAgICAgIGRlYnVnbG9nKCdleGl0IDonKTtcbiAgICAgIGRlYnVnbG9nKCdleGl0JyArIEpTT04uc3RyaW5naWZ5KGFyZ3MuZW50aXRpZXMpKTtcbiAgICAgICAgZGlhbG9nTG9nZ2VyKCB7XG4gICAgICAgICAgc2Vzc2lvbjogc2Vzc2lvbixcbiAgICAgICAgICBpbnRlbnQgOiBcIkV4aXRcIixcbiAgICAgICAgICByZXNwb25zZSA6ICd5b3UgYXJlIGluIGEgbG9naWMgbG9vcCdcbiAgICAgICAgfSk7XG4gICAgICBzZXNzaW9uLnNlbmQoXCJ5b3UgYXJlIGluIGEgbG9naWMgbG9vcCBcIik7XG4gICAgfVxuICBdKTtcbiAgZGlhbG9nLm1hdGNoZXMoJ0hlbHAnLCBbXG4gICAgZnVuY3Rpb24gKHNlc3Npb24sIGFyZ3MsIG5leHQpIHtcbiAgICAgIGRlYnVnbG9nKCdoZWxwIDonKTtcbiAgICAgIGRlYnVnbG9nKCdoZWxwJyk7XG4gICAgICBzZXNzaW9uLnNlbmQoXCJJIGtub3cgYWJvdXQgLi4uLiA8Y2F0ZWdvcmllcz4+XCIpO1xuICAgIH1cbiAgXSk7XG5cbiAgLy8gQWRkIGludGVudCBoYW5kbGVyc1xuICBkaWFsb2cubWF0Y2hlcygndHJhaW4nLCBbXG4gICAgZnVuY3Rpb24gKHNlc3Npb24sIGFyZ3MsIG5leHQpIHtcbiAgICAgIGRlYnVnbG9nKCd0cmFpbicpO1xuICAgICAgLy8gUmVzb2x2ZSBhbmQgc3RvcmUgYW55IGVudGl0aWVzIHBhc3NlZCBmcm9tIExVSVMuXG4gICAgICB2YXIgdGl0bGUgPSBidWlsZGVyLkVudGl0eVJlY29nbml6ZXIuZmluZEVudGl0eShhcmdzLmVudGl0aWVzLCAnYnVpbHRpbi5hbGFybS50aXRsZScpO1xuICAgICAgdmFyIHRpbWUgPSBidWlsZGVyLkVudGl0eVJlY29nbml6ZXIucmVzb2x2ZVRpbWUoYXJncy5lbnRpdGllcyk7XG4gICAgICB2YXIgYWxhcm0gPSBzZXNzaW9uLmRpYWxvZ0RhdGEuYWxhcm0gPSB7XG4gICAgICAgIHRpdGxlOiB0aXRsZSA/IHRpdGxlLmVudGl0eSA6IG51bGwsXG4gICAgICAgIHRpbWVzdGFtcDogdGltZSA/IHRpbWUuZ2V0VGltZSgpIDogbnVsbFxuICAgICAgfTtcbiAgICAgIC8vIFByb21wdCBmb3IgdGl0bGVcbiAgICAgICAgaWYgKCFhbGFybS50aXRsZSkge1xuICAgICAgICAgIGRpYWxvZ0xvZ2dlcigge1xuICAgICAgICAgIHNlc3Npb246IHNlc3Npb24sXG4gICAgICAgICAgaW50ZW50IDogXCJ0cmFpblwiLFxuICAgICAgICAgIHJlc3BvbnNlIDogJ1doYXQgZmFjdCB3b3VsZCB5b3UgbGlrZSB0byB0cmFpbj8nXG4gICAgICAgIH0pO1xuICAgICAgICBidWlsZGVyLlByb21wdHMudGV4dChzZXNzaW9uLCAnV2hhdCBmYWN0IHdvdWxkIHlvdSBsaWtlIHRvIHRyYWluPycpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbmV4dCgpO1xuICAgICAgfVxuICAgIH0sXG4gICAgZnVuY3Rpb24gKHNlc3Npb24sIHJlc3VsdHMsIG5leHQpIHtcbiAgICAgIHZhciBhbGFybSA9IHNlc3Npb24uZGlhbG9nRGF0YS5hbGFybTtcbiAgICAgIGlmIChyZXN1bHRzLnJlc3BvbnNlKSB7XG4gICAgICAgIGFsYXJtLnRpdGxlID0gcmVzdWx0cy5yZXNwb25zZTtcbiAgICAgIH1cblxuICAgICAgLy8gUHJvbXB0IGZvciB0aW1lICh0aXRsZSB3aWxsIGJlIGJsYW5rIGlmIHRoZSB1c2VyIHNhaWQgY2FuY2VsKVxuICAgICAgaWYgKGFsYXJtLnRpdGxlICYmICFhbGFybS50aW1lc3RhbXApIHtcblxuXG4gICAgICAgIGJ1aWxkZXIuUHJvbXB0cy50aW1lKHNlc3Npb24sICdXaGF0IHRpbWUgd291bGQgeW91IGxpa2UgdG8gc2V0IHRoZSBhbGFybSBmb3I/Jyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBuZXh0KCk7XG4gICAgICB9XG4gICAgfSxcbiAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgcmVzdWx0cykge1xuICAgICAgdmFyIGFsYXJtID0gc2Vzc2lvbi5kaWFsb2dEYXRhLmFsYXJtO1xuICAgICAgaWYgKHJlc3VsdHMucmVzcG9uc2UpIHtcbiAgICAgICAgdmFyIHRpbWUgPSBidWlsZGVyLkVudGl0eVJlY29nbml6ZXIucmVzb2x2ZVRpbWUoW3Jlc3VsdHMucmVzcG9uc2VdKTtcbiAgICAgICAgYWxhcm0udGltZXN0YW1wID0gdGltZSA/IHRpbWUuZ2V0VGltZSgpIDogbnVsbDtcbiAgICAgIH1cbiAgICAgIC8vIFNldCB0aGUgYWxhcm0gKGlmIHRpdGxlIG9yIHRpbWVzdGFtcCBpcyBibGFuayB0aGUgdXNlciBzYWlkIGNhbmNlbClcbiAgICAgIGlmIChhbGFybS50aXRsZSAmJiBhbGFybS50aW1lc3RhbXApIHtcbiAgICAgICAgLy8gU2F2ZSBhZGRyZXNzIG9mIHdobyB0byBub3RpZnkgYW5kIHdyaXRlIHRvIHNjaGVkdWxlci5cbiAgICAgICAgYWxhcm0uYWRkcmVzcyA9IHNlc3Npb24ubWVzc2FnZS5hZGRyZXNzO1xuICAgICAgICAvL2FsYXJtc1thbGFybS50aXRsZV0gPSBhbGFybTtcblxuICAgICAgICAvLyBTZW5kIGNvbmZpcm1hdGlvbiB0byB1c2VyXG4gICAgICAgIHZhciBkYXRlID0gbmV3IERhdGUoYWxhcm0udGltZXN0YW1wKTtcbiAgICAgICAgdmFyIGlzQU0gPSBkYXRlLmdldEhvdXJzKCkgPCAxMjtcbiAgICAgICAgc2Vzc2lvbi5zZW5kKCdDcmVhdGluZyBhbGFybSBuYW1lZCBcIiVzXCIgZm9yICVkLyVkLyVkICVkOiUwMmQlcycsXG4gICAgICAgICAgYWxhcm0udGl0bGUsXG4gICAgICAgICAgZGF0ZS5nZXRNb250aCgpICsgMSwgZGF0ZS5nZXREYXRlKCksIGRhdGUuZ2V0RnVsbFllYXIoKSxcbiAgICAgICAgICBpc0FNID8gZGF0ZS5nZXRIb3VycygpIDogZGF0ZS5nZXRIb3VycygpIC0gMTIsIGRhdGUuZ2V0TWludXRlcygpLCBpc0FNID8gJ2FtJyA6ICdwbScpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc2Vzc2lvbi5zZW5kKCdPay4uLiBubyBwcm9ibGVtLicpO1xuICAgICAgfVxuICAgIH1cbiAgXSk7XG5cbiAgZGlhbG9nLm9uRGVmYXVsdChmdW5jdGlvbiAoc2Vzc2lvbikge1xuICAgIGxvZ1F1ZXJ5KHNlc3Npb24sIFwib25EZWZhdWx0XCIpO1xuICAgIHZhciBlbGl6YSA9IGdldEVsaXphQm90KGdldENvbnZlcnNhdGlvbklkKHNlc3Npb24pKTtcbiAgICB2YXIgcmVwbHkgPSBlbGl6YS50cmFuc2Zvcm0oc2Vzc2lvbi5tZXNzYWdlLnRleHQpO1xuICAgIGRpYWxvZ2xvZyhcImVsaXphXCIsc2Vzc2lvbixzZW5kKHJlcGx5KSk7XG4gICAgLy9uZXcgRWlsemFib3RcbiAgICAvL3Nlc3Npb24uc2VuZChcIkkgZG8gbm90IHVuZGVyc3RhbmQgdGhpcyBhdCBhbGxcIik7XG4gICAgLy9idWlsZGVyLkRpYWxvZ0FjdGlvbi5zZW5kKCdJXFwnbSBzb3JyeSBJIGRpZG5cXCd0IHVuZGVyc3RhbmQuIEkgY2FuIG9ubHkgc2hvdyBzdGFydCBhbmQgcmluZycpO1xuICB9KTtcblxuICAvKlxuICAvLyBWZXJ5IHNpbXBsZSBhbGFybSBzY2hlZHVsZXJcbiAgdmFyIGFsYXJtcyA9IHt9O1xuICBzZXRJbnRlcnZhbChmdW5jdGlvbiAoKSB7XG4gICAgdmFyIG5vdyA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICAgIGZvciAodmFyIGtleSBpbiBhbGFybXMpIHtcbiAgICAgIHZhciBhbGFybSA9IGFsYXJtc1trZXldO1xuICAgICAgaWYgKG5vdyA+PSBhbGFybS50aW1lc3RhbXApIHtcbiAgICAgICAgdmFyIG1zZyA9IG5ldyBidWlsZGVyLk1lc3NhZ2UoKVxuICAgICAgICAgIC5hZGRyZXNzKGFsYXJtLmFkZHJlc3MpXG4gICAgICAgICAgLnRleHQoJ0hlcmVcXCdzIHlvdXIgXFwnJXNcXCcgYWxhcm0uJywgYWxhcm0udGl0bGUpO1xuICAgICAgICBib3Quc2VuZChtc2cpO1xuICAgICAgICBkZWxldGUgYWxhcm1zW2tleV07XG4gICAgICB9XG4gICAgfVxuICB9LCAxNTAwMCk7XG4gICovXG59XG5cbmlmIChtb2R1bGUpIHtcbiAgbW9kdWxlLmV4cG9ydHMgPSB7XG4gICAgU2ltcGxlVXBEb3duUmVjb2duaXplciA6IFNpbXBsZVVwRG93blJlY29nbml6ZXIsXG4gICAgbWFrZUJvdDogbWFrZUJvdFxuICB9O1xufVxuIiwiLyoqXG4gKiBUaGUgYm90IGltcGxlbWVudGF0aW9uXG4gKlxuICogSW5zdGFudGlhdGUgYXBzc2luZyBhIGNvbm5lY3RvciB2aWFcbiAqIG1ha2VCb3RcbiAqXG4gKi9cbi8qKlxuICogQGZpbGVcbiAqIEBtb2R1bGUgamZzZWIuZmRldnN0YXJ0LnNtYXJ0ZGlhbG9nXG4gKiBAY29weXJpZ2h0IChjKSAyMDE2IEdlcmQgRm9yc3RtYW5uXG4gKi9cbi8vZGVjbGFyZSBtb2R1bGUgJ2VsaXphYm90JyB7IH07XG4vL2RlY2xhcmUgbW9kdWxlICd3aW5zdG9uLXBnJyB7IH07XG4vL2RlbGNhcmUgbW9kdWxlICd3aW5zdG9uJyB7fTtcblwidXNlIHN0cmljdFwiO1xudmFyIGJ1aWxkZXIgPSByZXF1aXJlKCdib3RidWlsZGVyJyk7XG52YXIgZGVidWcgPSByZXF1aXJlKCdkZWJ1ZycpO1xudmFyIE1hdGNoID0gcmVxdWlyZSgnLi4vbWF0Y2gvbWF0Y2gnKTtcbnZhciBBbmFseXplID0gcmVxdWlyZSgnLi4vbWF0Y2gvYW5hbHl6ZScpO1xudmFyIEJyZWFrRG93biA9IHJlcXVpcmUoJy4uL21hdGNoL2JyZWFrZG93bicpO1xudmFyIFdoYXRJcyA9IHJlcXVpcmUoJy4uL21hdGNoL3doYXRpcycpO1xudmFyIExpc3RBbGwgPSByZXF1aXJlKCcuLi9tYXRjaC9saXN0YWxsJyk7XG52YXIgRGlhbG9nTG9nZ2VyID0gcmVxdWlyZSgnLi4vdXRpbHMvZGlhbG9nbG9nZ2VyJyk7XG52YXIgcHJvY2VzcyA9IHJlcXVpcmUoJ3Byb2Nlc3MnKTtcbnZhciBkYnVybCA9IHByb2Nlc3MuZW52LkRBVEFCQVNFX1VSTCB8fCBcIlwiO1xudmFyIHBnbG9jYWx1cmwgPSBcInBvc3RncmVzOi8vam9lOmFiY2RlZkBsb2NhbGhvc3Q6NTQzMi9hYm90XCI7XG52YXIgZGJ1cmwgPSBwcm9jZXNzLmVudi5EQVRBQkFTRV9VUkwgfHwgcGdsb2NhbHVybDtcbnZhciBwZyA9IHJlcXVpcmUoJ3BnJyk7XG52YXIgbyA9IHBnO1xuby5kZWZhdWx0cy5zc2wgPSB0cnVlO1xudmFyIGRpYWxvZ0xvZ2dlciA9IERpYWxvZ0xvZ2dlci5sb2dnZXIoXCJzbWFydGJvdFwiLCBkYnVybCwgcGcpO1xuZnVuY3Rpb24gc2VuZChvKSB7IHJldHVybiBvOyB9XG47XG5mdW5jdGlvbiBkaWFsb2dsb2coaW50ZW50LCBzZXNzaW9uLCByZXNwb25zZSkge1xuICAgIHZhciBzUmVzcG9uc2U7XG4gICAgdmFyIHNBY3Rpb247XG4gICAgaWYgKHR5cGVvZiByZXNwb25zZSA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICBzQWN0aW9uID0gXCJcIjtcbiAgICAgICAgc1Jlc3BvbnNlID0gcmVzcG9uc2U7XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICB2YXIgYU1lc3NhZ2UgPSByZXNwb25zZTtcbiAgICAgICAgdmFyIGlNZXNzYWdlID0gYU1lc3NhZ2UudG9NZXNzYWdlKCk7XG4gICAgICAgIHNSZXNwb25zZSA9IGlNZXNzYWdlLnRleHQ7XG4gICAgICAgIHNBY3Rpb24gPSAoaU1lc3NhZ2UuZW50aXRpZXMgJiYgaU1lc3NhZ2UuZW50aXRpZXNbMF0pID8gKEpTT04uc3RyaW5naWZ5KGlNZXNzYWdlLmVudGl0aWVzICYmIGlNZXNzYWdlLmVudGl0aWVzWzBdKSkgOiBcIlwiO1xuICAgIH1cbiAgICBkaWFsb2dMb2dnZXIoe1xuICAgICAgICBpbnRlbnQ6IGludGVudCxcbiAgICAgICAgc2Vzc2lvbjogc2Vzc2lvbixcbiAgICAgICAgcmVzcG9uc2U6IHNSZXNwb25zZSxcbiAgICAgICAgYWN0aW9uOiBzQWN0aW9uXG4gICAgfSk7XG4gICAgc2Vzc2lvbi5zZW5kKHJlc3BvbnNlKTtcbn1cbi8vY29uc3QgcGdMb2dnZXIgPSBuZXcgUGdMb2dnZXIoe1xuLy8gIG5hbWU6ICd0ZXN0LWxvZ2dlcicsXG4vLyAgbGV2ZWw6ICdkZWJ1ZycsXG4vLyAgY29ublN0cmluZzogJ3Bvc3RncmVzOi8vdWJ1bnR1QGxvY2FsaG9zdDo1NDMyL2NpcmNsZV90ZXN0Jyxcbi8vICB0YWJsZU5hbWU6ICd3aW5zdG9uX2xvZ3MnLFxuLy99KTtcbi8vd2luc3Rvbi5hZGQod2luc3Rvbi50cmFuc3BvcnRzLkZpbGUsIHsgZmlsZW5hbWU6ICd3aW5zdG9uX291dC5sb2cnLCB0aW1lc3RhbXAgOiB0cnVlIH0pO1xuLy8gIHdpbnN0b24ucmVtb3ZlKHdpbnN0b24udHJhbnNwb3J0cy5Db25zb2xlKTtcbi8vd2luc3Rvbi5hZGQocGdMb2dnZXIpO1xuLypcbmNvbnN0IGxvZ2dlciA9IG5ldyB3aW5zdG9uLkxvZ2dlcih7XG4gIHRyYW5zcG9ydHM6IFtcbiAgICBuZXcgd2luc3Rvbi50cmFuc3BvcnRzLkNvbnNvbGUoe1xuICAgICAgY29sb3I6IHRydWUsXG4gICAgICB0aW1lc3RhbXA6IHRydWUsXG4gICAgfSksXG4gICAgcGdMb2dnZXIsXG4gIF1cbn0pO1xuKi9cbi8vcGdMb2dnZXIuaW5pdFRhYmxlKGRvbmUpO1xudmFyIGVsaXphYm90ID0gcmVxdWlyZSgnLi4vZXh0ZXJuL2VsaXphYm90L2VsaXphYm90LmpzJyk7XG4vL2ltcG9ydCAqIGFzIGVsaXphYm90IGZyb20gJ2VsaXphYm90JztcbnZhciBkZWJ1Z2xvZyA9IGRlYnVnKCdzbWFydGRpYWxvZycpO1xudmFyIFBsYWluUmVjb2duaXplciA9IHJlcXVpcmUoJy4vcGxhaW5yZWNvZ25pemVyJyk7XG4vL3ZhciBidWlsZGVyID0gcmVxdWlyZSgnYm90YnVpbGRlcicpO1xudmFyIGRpc3BhdGNoZXIgPSByZXF1aXJlKCcuLi9tYXRjaC9kaXNwYXRjaGVyLmpzJykuZGlzcGF0Y2hlcjtcbmZ1bmN0aW9uIGdldENvbnZlcnNhdGlvbklkKHNlc3Npb24pIHtcbiAgICByZXR1cm4gc2Vzc2lvbi5tZXNzYWdlICYmXG4gICAgICAgIHNlc3Npb24ubWVzc2FnZS5hZGRyZXNzICYmXG4gICAgICAgIHNlc3Npb24ubWVzc2FnZS5hZGRyZXNzLmNvbnZlcnNhdGlvbi5pZDtcbn1cbnZhciBlbGl6YWJvdHMgPSB7fTtcbmZ1bmN0aW9uIGdldEVsaXphQm90KGlkKSB7XG4gICAgaWYgKCFlbGl6YWJvdHNbaWRdKSB7XG4gICAgICAgIGVsaXphYm90c1tpZF0gPSB7XG4gICAgICAgICAgICBhY2Nlc3M6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICBlbGl6YWJvdDogbmV3IGVsaXphYm90KClcbiAgICAgICAgfTtcbiAgICB9XG4gICAgZWxpemFib3RzW2lkXS5hY2Nlc3MgPSBuZXcgRGF0ZSgpO1xuICAgIHJldHVybiBlbGl6YWJvdHNbaWRdLmVsaXphYm90O1xufVxudmFyIG5ld0Zsb3cgPSB0cnVlO1xudmFyIE1vZGVsID0gcmVxdWlyZSgnLi4vbW9kZWwvbW9kZWwnKTtcbnZhciBFeGVjU2VydmVyID0gcmVxdWlyZSgnLi4vZXhlYy9leGVjc2VydmVyJyk7XG52YXIgdGhlRGVmYXVsdE1vZGVsID0gTW9kZWwubG9hZE1vZGVscygpO1xudmFyIG1vZGVscyA9IHt9O1xuZnVuY3Rpb24gbG9hZE1vZGVsKG1vZGVsUGF0aCkge1xuICAgIG1vZGVsUGF0aCA9IG1vZGVsUGF0aCB8fCBcIlwiO1xuICAgIGlmICghbW9kZWxzW21vZGVsUGF0aF0pIHtcbiAgICAgICAgbW9kZWxzW21vZGVsUGF0aF0gPSBNb2RlbC5sb2FkTW9kZWxzKG1vZGVsUGF0aCk7XG4gICAgfVxuICAgIHJldHVybiBtb2RlbHNbbW9kZWxQYXRoXTtcbn1cbmlmIChuZXdGbG93KSB7XG59XG5lbHNlIHtcbn1cbmZ1bmN0aW9uIGlzQW5vbnltb3VzKHVzZXJpZCkge1xuICAgIHJldHVybiB1c2VyaWQuaW5kZXhPZihcImFubzpcIikgPT09IDA7XG59XG5mdW5jdGlvbiByZXN0cmljdExvZ2dlZE9uKHNlc3Npb24sIGFycikge1xuICAgIHZhciB1c2VyaWQgPSBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzc1xuICAgICAgICAmJiBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzcy51c2VyXG4gICAgICAgICYmIHNlc3Npb24ubWVzc2FnZS5hZGRyZXNzLnVzZXIuaWQgfHwgXCJcIjtcbiAgICBpZiAocHJvY2Vzcy5lbnYuQUJPVF9FTUFJTF9VU0VSICYmIGlzQW5vbnltb3VzKHVzZXJpZCkpIHtcbiAgICAgICAgaWYgKGFyci5sZW5ndGggPCA2KSB7XG4gICAgICAgICAgICByZXR1cm4gYXJyO1xuICAgICAgICB9XG4gICAgICAgIHZhciBsZW4gPSBhcnIubGVuZ3RoO1xuICAgICAgICB2YXIgcmVzID0gYXJyLnNsaWNlKDAsIE1hdGgubWluKE1hdGgubWF4KE1hdGguZmxvb3IoYXJyLmxlbmd0aCAvIDMpLCA3KSwgYXJyLmxlbmd0aCkpO1xuICAgICAgICBpZiAodHlwZW9mIGFyclswXSA9PT0gXCJzdHJpbmdcIikge1xuICAgICAgICAgICAgdmFyIGRlbHRhID0gbGVuIC0gcmVzLmxlbmd0aDtcbiAgICAgICAgICAgIHJlcy5wdXNoKFwiLi4uIGFuZCBcIiArIGRlbHRhICsgXCIgbW9yZSBlbnRyaWVzIGZvciByZWdpc3RlcmVkIHVzZXJzXCIpO1xuICAgICAgICB9XG4gICAgICAgIHJldHVybiByZXM7XG4gICAgfVxuICAgIHJldHVybiBhcnI7XG59XG4vKlxuZXhwb3J0IGNsYXNzIFNpbXBsZVJlY29nbml6ZXIgaW1wbGVtZW50cyBidWlsZGVyLklJbnRlbnRSZWNvZ25pemVyIHtcbiAgY29uc3RydWN0b3IoKSB7XG5cbiAgfVxuXG4gIHJlY29nbml6ZShjb250ZXh0OiBidWlsZGVyLklSZWNvZ25pemVDb250ZXh0LCBjYWxsYmFjazogKGVycjogRXJyb3IsIHJlc3VsdDogYnVpbGRlci5JSW50ZW50UmVjb2duaXplclJlc3VsdCkgPT4gdm9pZCk6IHZvaWQge1xuICAgIHZhciB1ID0ge30gYXMgYnVpbGRlci5JSW50ZW50UmVjb2duaXplclJlc3VsdDtcblxuICAgIGRlYnVnbG9nKFwicmVjb2duaXppbmcgXCIgKyBjb250ZXh0Lm1lc3NhZ2UudGV4dCk7XG4gICAgaWYgKGNvbnRleHQubWVzc2FnZS50ZXh0LmluZGV4T2YoXCJzdGFydFwiKSA+PSAwKSB7XG4gICAgICB1LmludGVudCA9IFwiU2hvd0VudGl0eVwiO1xuICAgICAgdS5zY29yZSA9IDAuOTtcbiAgICAgIHZhciBlMSA9IHt9IGFzIGJ1aWxkZXIuSUVudGl0eTtcbiAgICAgIGUxLnN0YXJ0SW5kZXggPSBcInN0YXJ0IFwiLmxlbmd0aDtcbiAgICAgIGUxLmVuZEluZGV4ID0gY29udGV4dC5tZXNzYWdlLnRleHQubGVuZ3RoO1xuICAgICAgZTEuc2NvcmUgPSAwLjM7XG4gICAgICB1LmVudGl0aWVzID0gW2UxXTtcbiAgICAgIGNhbGxiYWNrKHVuZGVmaW5lZCwgdSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKGNvbnRleHQubWVzc2FnZS50ZXh0LmluZGV4T2YoXCJ0cmFpblwiKSA+PSAwKSB7XG4gICAgICB1LmludGVudCA9IFwidHJhaW5cIjtcbiAgICAgIHUuc2NvcmUgPSAwLjk7XG4gICAgICB2YXIgZTEgPSB7fSBhcyBidWlsZGVyLklFbnRpdHk7XG4gICAgICBlMS5zdGFydEluZGV4ID0gXCJ0cmFpbiBcIi5sZW5ndGg7XG4gICAgICBlMS5lbmRJbmRleCA9IGNvbnRleHQubWVzc2FnZS50ZXh0Lmxlbmd0aDtcbiAgICAgIGUxLnNjb3JlID0gMC4zO1xuICAgICAgdS5lbnRpdGllcyA9IFtlMV07XG4gICAgICBjYWxsYmFjayh1bmRlZmluZWQsIHUpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoY29udGV4dC5tZXNzYWdlLnRleHQuaW5kZXhPZihcImxlYXJuXCIpID49IDApIHtcbiAgICAgIHUuaW50ZW50ID0gXCJsZWFyblwiO1xuICAgICAgdS5zY29yZSA9IDAuOTtcbiAgICAgIHZhciBlMSA9IHt9IGFzIGJ1aWxkZXIuSUVudGl0eTtcbiAgICAgIGUxLnR5cGUgPSBcInRyYWluRmFjdFwiO1xuICAgICAgZTEuc3RhcnRJbmRleCA9IFwidHJhaW4gXCIubGVuZ3RoO1xuICAgICAgZTEuZW5kSW5kZXggPSBjb250ZXh0Lm1lc3NhZ2UudGV4dC5sZW5ndGg7XG4gICAgICBlMS5zY29yZSA9IDAuMztcbiAgICAgIHUuZW50aXRpZXMgPSBbZTFdO1xuICAgICAgY2FsbGJhY2sodW5kZWZpbmVkLCB1KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGNvbnRleHQubWVzc2FnZS50ZXh0LmluZGV4T2YoXCJoZWxwXCIpID49IDApIHtcbiAgICAgIHUuaW50ZW50ID0gXCJoZWxwXCI7XG4gICAgICB1LnNjb3JlID0gMC45O1xuICAgICAgdmFyIGUxID0ge30gYXMgYnVpbGRlci5JRW50aXR5O1xuICAgICAgZTEuc3RhcnRJbmRleCA9IFwidHJhaW4gXCIubGVuZ3RoO1xuICAgICAgZTEuZW5kSW5kZXggPSBjb250ZXh0Lm1lc3NhZ2UudGV4dC5sZW5ndGg7XG4gICAgICBlMS5zY29yZSA9IDAuMztcbiAgICAgIHUuZW50aXRpZXMgPSBbZTFdO1xuICAgICAgY2FsbGJhY2sodW5kZWZpbmVkLCB1KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGNvbnRleHQubWVzc2FnZS50ZXh0LmluZGV4T2YoXCJleGl0XCIpID49IDApIHtcbiAgICAgIHUuaW50ZW50ID0gXCJleGl0XCI7XG4gICAgICB1LnNjb3JlID0gMC45O1xuICAgICAgdmFyIGUxID0ge30gYXMgYnVpbGRlci5JRW50aXR5O1xuICAgICAgZTEuc3RhcnRJbmRleCA9IFwiZXhpdCBcIi5sZW5ndGg7XG4gICAgICBlMS5lbmRJbmRleCA9IGNvbnRleHQubWVzc2FnZS50ZXh0Lmxlbmd0aDtcbiAgICAgIGUxLnNjb3JlID0gMC4zO1xuICAgICAgdS5lbnRpdGllcyA9IFtlMV07XG4gICAgICBjYWxsYmFjayh1bmRlZmluZWQsIHUpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoY29udGV4dC5tZXNzYWdlLnRleHQuaW5kZXhPZihcIndyb25nXCIpID49IDApIHtcbiAgICAgIHUuaW50ZW50ID0gXCJ3cm9uZ1wiO1xuICAgICAgdS5zY29yZSA9IDAuOTtcbiAgICAgIHZhciBlMSA9IHt9IGFzIGJ1aWxkZXIuSUVudGl0eTtcbiAgICAgIGUxLnN0YXJ0SW5kZXggPSBcImV4aXQgXCIubGVuZ3RoO1xuICAgICAgZTEuZW5kSW5kZXggPSBjb250ZXh0Lm1lc3NhZ2UudGV4dC5sZW5ndGg7XG4gICAgICBlMS5zY29yZSA9IDAuMztcbiAgICAgIHUuZW50aXRpZXMgPSBbZTFdO1xuICAgICAgY2FsbGJhY2sodW5kZWZpbmVkLCB1KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgZGVidWdsb2coJ3JlY29nbml6aW5nIG5vdGhpbmcnKTtcbiAgICB1LmludGVudCA9IFwiTm9uZVwiO1xuICAgIHUuc2NvcmUgPSAwLjE7XG4gICAgdmFyIGUxID0ge30gYXMgYnVpbGRlci5JRW50aXR5O1xuICAgIGUxLnN0YXJ0SW5kZXggPSBcImV4aXQgXCIubGVuZ3RoO1xuICAgIGUxLmVuZEluZGV4ID0gY29udGV4dC5tZXNzYWdlLnRleHQubGVuZ3RoO1xuICAgIGUxLnNjb3JlID0gMC4xO1xuICAgIHUuZW50aXRpZXMgPSBbXTtcbiAgICBjYWxsYmFjayh1bmRlZmluZWQsIHUpO1xuICB9XG59XG4qL1xudmFyIGFUcmFpblJlcGxpZXMgPSBbXCJUaGFuayB5b3UgZm9yIHNoYXJpbmcgdGhpcyBzdWdnZXN0aW9uIHdpdGggdXNcIixcbiAgICBcIlRoYW5rIGZvciBmb3IgdGhpcyB2YWx1YWJsZSBpbmZvcm1hdGlvbi5cIixcbiAgICBcIlRoYW5rIGZvciBmb3IgdGhpcyBpbnRlcmVzdGluZyBmYWN0IVwiLFxuICAgIFwiVGhhdHMgYSBwbGV0aG9yaWEgb2YgaW5mb3JtYXRpb24uXCIsXG4gICAgXCJUaGF0J3MgYSBudWdnZXQgb2YgaW5mb3JtYXRpb24uXCIsXG4gICAgXCJMb3ZlbHksIEkgbWF5IGNvbnNpZGVyIHlvdSBpbnB1dC5cIixcbiAgICBcIldlbGwgZG9uZSwgYW55dGhpbmcgbW9yZSB0byBsZXQgbWUga25vdz9cIixcbiAgICBcIkkgZG8gYXBwcmVjaWF0ZSB5b3VyIHRlYWNoaW5nIGFuZCBteSBsZWFybmluZyBleHBlcmllbmNlLCBvciB3YXMgaXQgdGhlIG90aGVyIHdheSByb3VuZD9cIixcbiAgICBcIllvdXIgaGVscGZ1bCBpbnB1dCBoYXMgYmVlbiBzdG9yZWQgaW4gc29tZSBkdXN0eSBjb3JuZXIgb2YgdGhlIFdvcmxkIHdpZGUgd2ViIVwiLFxuICAgIFwiVGhhbmsgeW91IGZvciBteSBsZWFybmluZyBleHBlcmllbmNlIVwiLFxuICAgIFwiSSBoYXZlIGluY29ycG9yYXRlZCB5b3VyIHZhbHVhYmxlIHN1Z2dlc3Rpb24gaW4gdGhlIHdpc2RvbSBvZiB0aGUgaW50ZXJuZXRcIlxuXTtcbnZhciBhVHJhaW5EaWFsb2cgPSBhVHJhaW5SZXBsaWVzO1xudmFyIGFUcmFpbkV4aXRIaW50ID0gW1xuICAgIFwiXFxudHlwZSBcXFwiZG9uZVxcXCIgd2hlbiB5b3UgYXJlIGRvbmUgdHJhaW5pbmcgbWUuXCIsXG4gICAgXCJcIixcbiAgICBcIlwiLFxuICAgIFwiXCIsXG4gICAgXCJcXG5yZW1lbWJlciwgeW91IGFyZSBzdHVjayBoZXJlIGluc3RydWN0aW5nIG1lLCB0eXBlIFxcXCJkb25lXFxcIiB0byByZXR1cm4uXCIsXG4gICAgXCJcIl07XG52YXIgYUVudGVyVHJhaW4gPSBbXCJTbyB5b3UgdGhpbmsgdGhpcyBpcyB3cm9uZz8gWW91IGNhbiBvZmZlciB5b3VyIGFkdmlzZSBoZXJlLlxcbiBUeXBlIFxcXCJkb25lXFxcIiBpZiB5b3UgYXJlIGRvbmUgd2l0aCBpbnN0cnVjdGluZyBtZVwiLFxuICAgIFwiRmVlbCBmcmVlIHRvIG9mZmVyIG1lIHlvdXIgYmV0dGVyIHNvbHV0aW9uIGhlcmUuXFxuXCIsXG4gICAgXCJTb21lIHNheSBcXFwiVGhlIHNlY3JldCB0byBoYXBwaW5lc3MgaXMgdG8gbG93ZXIgeW91ciBleHBlY3RhdGlvbnMgdG8gdGhlIHBvaW50IHRoZXkgYXJlIGFscmVhZHkgbWV0LlxcXCIsIFxcbnQgaWYgeW91IGNvdWxkIGhlbHAgbWUgdG8gYmVjb21kZSBiZXR0ZXIsIGluc3RydWN0IG1lLlwiLFxuICAgIFwiRmVlbCBmcmVlIHRvIG9mZmVyIG1lIHlvdXIgYmV0dGVyIHNvbHV0aW9uIGhlcmUuXFxuIFR5cGUgXFxcImRvbmVcXFwiIGlmIHlvdSBhcmUgZG9uZSB3aXRoIGluc3RydWN0aW5nIG1lXCIsXG4gICAgXCJGZWVsIGZyZWUgdG8gb2ZmZXIgbWUgeW91ciBiZXR0ZXIgc29sdXRpb24gaGVyZS5cXG4gVHlwZSBcXFwiZG9uZVxcXCIgaWYgeW91IGFyZSBkb25lIHdpdGggaW5zdHJ1Y3RpbmcgbWVcIixcbl07XG52YXIgYUJhY2tGcm9tVHJhaW5pbmcgPSBbXG4gICAgXCJQdXVoLCBiYWNrIGZyb20gdHJhaW5pbmchIE5vdyBmb3IgdGhlIGVhc3kgcGFydCAuLi5cIixcbiAgICBcIkxpdmUgYW5kIGRvbid0IGxlYXJuLCB0aGF0J3MgdXMuIE5hYWgsIHdlJ2xsIHNlZS5cIixcbiAgICBcIlRoZSBzZWNyZXQgdG8gaGFwcGluZXNzIGlzIHRvIGxvd2VyIHlvdXIgZXhwZWN0YXRpb25zIHRvIHRoZSBwb2ludCB0aGV5IGFyZSBhbHJlYWR5IG1ldC5cIixcbiAgICBcIlRoYW5rcyBmb3IgaGF2aW5nIHRoaXMgbGVjdHVyZSBzZXNzaW9uLCBub3cgYmFjayB0byBvdXIgdXN1YWwgc2VsZi5cIlxuXTtcbnZhciBhVHJhaW5Ob0tsaW5nb24gPSBbXG4gICAgXCJIZSB3aG8gbWFzdGVyIHRoZSBkYXJrIGFydHMgb2YgU0FQIG11c3Qgbm90IGR3ZWxsIGluIHRoZSBlYXJ0aGx5IHJlYWxtcyBvZiBTdGFydCBUcmVrLlwiLFxuICAgIFwiU0FQIGlzIGEgY2xvdWQgY29tcGFueSwgbm90IGEgc3BhY2UgY29tcGFueS5cIixcbiAgICBcIlRoZSBkZXB0aCBvZiBSLzMgYXJlIGRlZXBlciB0aGFuIERlZXAgU3BhY2UgNDIuXCIsXG4gICAgXCJNeSBicmFpbnBvd2VyIGlzIGZ1bGx5IGFic29yYmVkIHdpdGggbWFzdGVyaW5nIG90aGVyIHJlYWxtcy5cIixcbiAgICBcIkZvciB0aGUgd29zYXAsIHRoZSBza3kgaXMgdGhlIGxpbWl0LiBGZWVsIGZyZWUgdG8gY2hlY2sgb3V0IG5hc2EuZ292IC5cIixcbiAgICBcIlRoZSBmdXR1cmUgaXMgU0FQIG9yIElCTSBibHVlLCBub3Qgc3BhY2UgYmxhY2suXCIsXG4gICAgXCJUaGF0J3MgbGVmdCB0byBzb21lIG11c2t5IGZ1dHVyZS5cIlxuXTtcbmZ1bmN0aW9uIGdldFJhbmRvbVJlc3VsdChhcnIpIHtcbiAgICByZXR1cm4gYXJyW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIGFyci5sZW5ndGgpICUgYXJyLmxlbmd0aF07XG59XG52YXIgU2ltcGxlVXBEb3duUmVjb2duaXplciA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gU2ltcGxlVXBEb3duUmVjb2duaXplcigpIHtcbiAgICB9XG4gICAgU2ltcGxlVXBEb3duUmVjb2duaXplci5wcm90b3R5cGUucmVjb2duaXplID0gZnVuY3Rpb24gKGNvbnRleHQsIGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciB1ID0ge307XG4gICAgICAgIGRlYnVnbG9nKFwicmVjb2duaXppbmcgXCIgKyBjb250ZXh0Lm1lc3NhZ2UudGV4dCk7XG4gICAgICAgIGlmIChjb250ZXh0Lm1lc3NhZ2UudGV4dC5pbmRleE9mKFwiZG93blwiKSA+PSAwKSB7XG4gICAgICAgICAgICB1LmludGVudCA9IFwiaW50ZW50LmRvd25cIjtcbiAgICAgICAgICAgIHUuc2NvcmUgPSAwLjk7XG4gICAgICAgICAgICB2YXIgZTEgPSB7fTtcbiAgICAgICAgICAgIGUxLnN0YXJ0SW5kZXggPSBcInN0YXJ0IFwiLmxlbmd0aDtcbiAgICAgICAgICAgIGUxLmVuZEluZGV4ID0gY29udGV4dC5tZXNzYWdlLnRleHQubGVuZ3RoO1xuICAgICAgICAgICAgZTEuc2NvcmUgPSAwLjM7XG4gICAgICAgICAgICB1LmVudGl0aWVzID0gW2UxXTtcbiAgICAgICAgICAgIGNhbGxiYWNrKHVuZGVmaW5lZCwgdSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbnRleHQubWVzc2FnZS50ZXh0LmluZGV4T2YoXCJ1cFwiKSA+PSAwKSB7XG4gICAgICAgICAgICB1LmludGVudCA9IFwiaW50ZW50LnVwXCI7XG4gICAgICAgICAgICB1LnNjb3JlID0gMC45O1xuICAgICAgICAgICAgdmFyIGUxID0ge307XG4gICAgICAgICAgICBlMS5zdGFydEluZGV4ID0gXCJ1cFwiLmxlbmd0aDtcbiAgICAgICAgICAgIGUxLmVuZEluZGV4ID0gY29udGV4dC5tZXNzYWdlLnRleHQubGVuZ3RoO1xuICAgICAgICAgICAgZTEuc2NvcmUgPSAwLjM7XG4gICAgICAgICAgICB1LmVudGl0aWVzID0gW2UxXTtcbiAgICAgICAgICAgIGNhbGxiYWNrKHVuZGVmaW5lZCwgdSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbnRleHQubWVzc2FnZS50ZXh0LmluZGV4T2YoXCJkb25lXCIpID49IDApIHtcbiAgICAgICAgICAgIHUuaW50ZW50ID0gXCJpbnRlbnQudXBcIjtcbiAgICAgICAgICAgIHUuc2NvcmUgPSAwLjk7XG4gICAgICAgICAgICB2YXIgZTEgPSB7fTtcbiAgICAgICAgICAgIGUxLnN0YXJ0SW5kZXggPSBcInVwXCIubGVuZ3RoO1xuICAgICAgICAgICAgZTEuZW5kSW5kZXggPSBjb250ZXh0Lm1lc3NhZ2UudGV4dC5sZW5ndGg7XG4gICAgICAgICAgICBlMS5zY29yZSA9IDAuMztcbiAgICAgICAgICAgIHUuZW50aXRpZXMgPSBbZTFdO1xuICAgICAgICAgICAgY2FsbGJhY2sodW5kZWZpbmVkLCB1KTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29udGV4dC5tZXNzYWdlLnRleHQuaW5kZXhPZihcImV4aXRcIikgPj0gMCkge1xuICAgICAgICAgICAgdS5pbnRlbnQgPSBcImludGVudC51cFwiO1xuICAgICAgICAgICAgdS5zY29yZSA9IDAuOTtcbiAgICAgICAgICAgIHZhciBlMSA9IHt9O1xuICAgICAgICAgICAgZTEuc3RhcnRJbmRleCA9IFwidXBcIi5sZW5ndGg7XG4gICAgICAgICAgICBlMS5lbmRJbmRleCA9IGNvbnRleHQubWVzc2FnZS50ZXh0Lmxlbmd0aDtcbiAgICAgICAgICAgIGUxLnNjb3JlID0gMC4zO1xuICAgICAgICAgICAgdS5lbnRpdGllcyA9IFtlMV07XG4gICAgICAgICAgICBjYWxsYmFjayh1bmRlZmluZWQsIHUpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb250ZXh0Lm1lc3NhZ2UudGV4dC5pbmRleE9mKFwicXVpdFwiKSA+PSAwKSB7XG4gICAgICAgICAgICB1LmludGVudCA9IFwiaW50ZW50LnVwXCI7XG4gICAgICAgICAgICB1LnNjb3JlID0gMC45O1xuICAgICAgICAgICAgdmFyIGUxID0ge307XG4gICAgICAgICAgICBlMS5zdGFydEluZGV4ID0gXCJ1cFwiLmxlbmd0aDtcbiAgICAgICAgICAgIGUxLmVuZEluZGV4ID0gY29udGV4dC5tZXNzYWdlLnRleHQubGVuZ3RoO1xuICAgICAgICAgICAgZTEuc2NvcmUgPSAwLjM7XG4gICAgICAgICAgICB1LmVudGl0aWVzID0gW2UxXTtcbiAgICAgICAgICAgIGNhbGxiYWNrKHVuZGVmaW5lZCwgdSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgZGVidWdsb2coJ3JlY29nbml6aW5nIG5vdGhpbmcnKTtcbiAgICAgICAgdS5pbnRlbnQgPSBcIk5vbmVcIjtcbiAgICAgICAgdS5zY29yZSA9IDAuMTtcbiAgICAgICAgdmFyIGUxID0ge307XG4gICAgICAgIGUxLnN0YXJ0SW5kZXggPSBcImV4aXQgXCIubGVuZ3RoO1xuICAgICAgICBlMS5lbmRJbmRleCA9IGNvbnRleHQubWVzc2FnZS50ZXh0Lmxlbmd0aDtcbiAgICAgICAgZTEuc2NvcmUgPSAwLjE7XG4gICAgICAgIHUuZW50aXRpZXMgPSBbXTtcbiAgICAgICAgY2FsbGJhY2sodW5kZWZpbmVkLCB1KTtcbiAgICB9O1xuICAgIHJldHVybiBTaW1wbGVVcERvd25SZWNvZ25pemVyO1xufSgpKTtcbmV4cG9ydHMuU2ltcGxlVXBEb3duUmVjb2duaXplciA9IFNpbXBsZVVwRG93blJlY29nbml6ZXI7XG52YXIgQW55T2JqZWN0ID0gT2JqZWN0O1xuLy8gZ2xvYmFsVHVubmVsLmluaXRpYWxpemUoe1xuLy8gIGhvc3Q6ICdwcm94eS5leHh4YW1wbGUuY29tJyxcbi8vICBwb3J0OiA4MDgwXG4vLyB9KVxuLy8gQ3JlYXRlIGJvdCBhbmQgYmluZCB0byBjb25zb2xlXG4vLyB2YXIgY29ubmVjdG9yID0gbmV3IGh0bWxjb25uZWN0b3IuSFRNTENvbm5lY3RvcigpXG4vLyBjb25uZWN0b3Iuc2V0QW5zd2VySG9vayhmdW5jdGlvbiAoc0Fuc3dlcikge1xuLy8gIGNvbnNvbGUubG9nKCdHb3QgYW5zd2VyIDogJyArIHNBbnN3ZXIgKyAnXFxuJylcbi8vIH0pXG52YXIgYm90O1xuLy8gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4vLyAgIGNvbm5lY3Rvci5wcm9jZXNzTWVzc2FnZSgnc3RhcnQgdW5pdCB0ZXN0IEFCQyAnKVxuLy8gfSwgNTAwMClcbnZhciBmcyA9IHJlcXVpcmUoJ2ZzJyk7XG52YXIgb0pTT04gPSBKU09OLnBhcnNlKCcnICsgZnMucmVhZEZpbGVTeW5jKCcuL3Jlc291cmNlcy9tb2RlbC9pbnRlbnRzLmpzb24nKSk7XG52YXIgb1J1bGVzID0gUGxhaW5SZWNvZ25pemVyLnBhcnNlUnVsZXMob0pTT04pO1xuLy8gdmFyIFJlY29nbml6ZXIgPSBuZXcgKHJlY29nbml6ZXIuUmVnRXhwUmVjb2duaXplcikob1J1bGVzKTtcbmZ1bmN0aW9uIGxvZ1F1ZXJ5KHNlc3Npb24sIGludGVudCwgcmVzdWx0KSB7XG4gICAgZnMuYXBwZW5kRmlsZSgnLi9sb2dzL3Nob3dtZXF1ZXJpZXMudHh0JywgXCJcXG5cIiArIEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgdGV4dDogc2Vzc2lvbi5tZXNzYWdlLnRleHQsXG4gICAgICAgIHRpbWVzdGFtcDogc2Vzc2lvbi5tZXNzYWdlLnRpbWVzdGFtcCxcbiAgICAgICAgaW50ZW50OiBpbnRlbnQsXG4gICAgICAgIHJlczogcmVzdWx0ICYmIHJlc3VsdC5sZW5ndGggJiYgTWF0Y2guVG9vbE1hdGNoLmR1bXBOaWNlKHJlc3VsdFswXSkgfHwgXCIwXCIsXG4gICAgICAgIGNvbnZlcnNhdGlvbklkOiBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzc1xuICAgICAgICAgICAgJiYgc2Vzc2lvbi5tZXNzYWdlLmFkZHJlc3MuY29udmVyc2F0aW9uXG4gICAgICAgICAgICAmJiBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzcy5jb252ZXJzYXRpb24uaWQgfHwgXCJcIixcbiAgICAgICAgdXNlcmlkOiBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzc1xuICAgICAgICAgICAgJiYgc2Vzc2lvbi5tZXNzYWdlLmFkZHJlc3MudXNlclxuICAgICAgICAgICAgJiYgc2Vzc2lvbi5tZXNzYWdlLmFkZHJlc3MudXNlci5pZCB8fCBcIlwiXG4gICAgfSksIGZ1bmN0aW9uIChlcnIsIHJlcykge1xuICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICBkZWJ1Z2xvZyhcImxvZ2dpbmcgZmFpbGVkIFwiICsgZXJyKTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuZnVuY3Rpb24gbG9nUXVlcnlXaGF0SXMoc2Vzc2lvbiwgaW50ZW50LCByZXN1bHQpIHtcbiAgICBmcy5hcHBlbmRGaWxlKCcuL2xvZ3Mvc2hvd21lcXVlcmllcy50eHQnLCBcIlxcblwiICsgSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICB0ZXh0OiBzZXNzaW9uLm1lc3NhZ2UudGV4dCxcbiAgICAgICAgdGltZXN0YW1wOiBzZXNzaW9uLm1lc3NhZ2UudGltZXN0YW1wLFxuICAgICAgICBpbnRlbnQ6IGludGVudCxcbiAgICAgICAgcmVzOiByZXN1bHQgJiYgcmVzdWx0Lmxlbmd0aCAmJiBXaGF0SXMuZHVtcE5pY2UocmVzdWx0WzBdKSB8fCBcIjBcIixcbiAgICAgICAgY29udmVyc2F0aW9uSWQ6IHNlc3Npb24ubWVzc2FnZS5hZGRyZXNzXG4gICAgICAgICAgICAmJiBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzcy5jb252ZXJzYXRpb25cbiAgICAgICAgICAgICYmIHNlc3Npb24ubWVzc2FnZS5hZGRyZXNzLmNvbnZlcnNhdGlvbi5pZCB8fCBcIlwiLFxuICAgICAgICB1c2VyaWQ6IHNlc3Npb24ubWVzc2FnZS5hZGRyZXNzXG4gICAgICAgICAgICAmJiBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzcy51c2VyXG4gICAgICAgICAgICAmJiBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzcy51c2VyLmlkIHx8IFwiXCJcbiAgICB9KSwgZnVuY3Rpb24gKGVyciwgcmVzKSB7XG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgIGRlYnVnbG9nKFwibG9nZ2luZyBmYWlsZWQgXCIgKyBlcnIpO1xuICAgICAgICB9XG4gICAgfSk7XG59XG52YXIgZ3dvcmRzID0ge307XG4vKipcbiAqIENvbnN0cnVjdCBhIGJvdFxuICogQHBhcmFtIGNvbm5lY3RvciB7Q29ubmVjdG9yfSB0aGUgY29ubmVjdG9yIHRvIHVzZVxuICogSFRNTENvbm5lY3RvclxuICogb3IgY29ubmVjdG9yID0gbmV3IGJ1aWxkZXIuQ29uc29sZUNvbm5lY3RvcigpLmxpc3RlbigpXG4gKi9cbmZ1bmN0aW9uIG1ha2VCb3QoY29ubmVjdG9yLCBtb2RlbFBhdGgpIHtcbiAgICB2YXIgdGhlTW9kZWwgPSBsb2FkTW9kZWwobW9kZWxQYXRoKTtcbiAgICBib3QgPSBuZXcgYnVpbGRlci5Vbml2ZXJzYWxCb3QoY29ubmVjdG9yKTtcbiAgICAvLyBDcmVhdGUgTFVJUyByZWNvZ25pemVyIHRoYXQgcG9pbnRzIGF0IG91ciBtb2RlbCBhbmQgYWRkIGl0IGFzIHRoZSByb290ICcvJyBkaWFsb2cgZm9yIG91ciBDb3J0YW5hIEJvdC5cbiAgICAvLyB2YXIgbW9kZWwgPSBzZW5zaXRpdmUubW9kZWx1cmw7XG4gICAgLy8gdmFyIG1vZGVsID0gJ2h0dHBzOi8vYXBpLnByb2plY3RveGZvcmQuYWkvbHVpcy92Mi4wL2FwcHMvYzQxM2IyZWYtMzgyYy00NWJkLThmZjAtZjc2ZDYwZTJhODIxP3N1YnNjcmlwdGlvbi1rZXk9YzIxMzk4YjU5ODBhNGNlMDlmNDc0YmJmZWU5M2I4OTImcT0nXG4gICAgdmFyIHJlY29nbml6ZXIgPSBuZXcgUGxhaW5SZWNvZ25pemVyLlJlZ0V4cFJlY29nbml6ZXIob1J1bGVzKTtcbiAgICB2YXIgZGlhbG9nID0gbmV3IGJ1aWxkZXIuSW50ZW50RGlhbG9nKHsgcmVjb2duaXplcnM6IFtyZWNvZ25pemVyXSB9KTtcbiAgICAvLyBkaWFsb2cub25CZWdpbihmdW5jdGlvbihzZXNzaW9uLGFyZ3MpIHtcbiAgICAvLyBjb25zb2xlLmxvZyhcImJlZ2lubmluZyAuLi5cIilcbiAgICAvLyBzZXNzaW9uLmRpYWxvZ0RhdGEucmV0cnlQcm9tcHQgPSBhcmdzICYmIGFyZ3MucmV0cnlQcm9tcHQgfHwgXCJJIGFtIHNvcnJ5XCJcbiAgICAvLyBzZXNzaW9uLnNlbmQoXCJXaGF0IGRvIHlvdSB3YW50P1wiKVxuICAgIC8vXG4gICAgLy8gfSlcbiAgICB2YXIgZGlhbG9nVXBEb3duID0gbmV3IGJ1aWxkZXIuSW50ZW50RGlhbG9nKHsgcmVjb2duaXplcnM6IFtuZXcgU2ltcGxlVXBEb3duUmVjb2duaXplcigpXSB9KTtcbiAgICBib3QuZGlhbG9nKCcvdXBkb3duJywgZGlhbG9nVXBEb3duKTtcbiAgICBkaWFsb2dVcERvd24ub25CZWdpbihmdW5jdGlvbiAoc2Vzc2lvbikge1xuICAgICAgICBkaWFsb2dsb2coXCJUcmFpbk1lXCIsIHNlc3Npb24sIHNlbmQoZ2V0UmFuZG9tUmVzdWx0KGFFbnRlclRyYWluKSkpO1xuICAgICAgICAvL3Nlc3Npb24uc2VuZChcIkhpIHRoZXJlLCB1cGRvd24gaXMgd2FpdGluZyBmb3IgeW91XCIpO1xuICAgIH0pO1xuICAgIGRpYWxvZ1VwRG93bi5tYXRjaGVzKCdpbnRlbnQudXAnLCBbXG4gICAgICAgIGZ1bmN0aW9uIChzZXNzaW9uLCBhcmdzLCBuZXh0KSB7XG4gICAgICAgICAgICBzZXNzaW9uLmRpYWxvZ0RhdGEuYWJjID0gYXJncyB8fCB7fTtcbiAgICAgICAgICAgIGJ1aWxkZXIuUHJvbXB0cy50ZXh0KHNlc3Npb24sICd5b3Ugd2FudCB0byBleGl0IHRyYWluaW5nPyB0eXBlIFxcXCJkb25lXFxcIiBhZ2Fpbi4nKTtcbiAgICAgICAgfSxcbiAgICAgICAgZnVuY3Rpb24gKHNlc3Npb24sIHJlc3VsdHMsIG5leHQpIHtcbiAgICAgICAgICAgIHNlc3Npb24uZGlhbG9nRGF0YS5hYmMgPSByZXN1bHRzLnJlcG9uc2U7XG4gICAgICAgICAgICBuZXh0KCk7XG4gICAgICAgIH0sXG4gICAgICAgIGZ1bmN0aW9uIChzZXNzaW9uLCByZXN1bHRzKSB7XG4gICAgICAgICAgICBzZXNzaW9uLmVuZERpYWxvZ1dpdGhSZXN1bHQoeyByZXNwb25zZTogc2Vzc2lvbi5kaWFsb2dEYXRhLmFiYyB9KTtcbiAgICAgICAgfVxuICAgIF0pO1xuICAgIGRpYWxvZ1VwRG93bi5tYXRjaGVzKCdpbnRlbnQuZG93bicsIFtcbiAgICAgICAgZnVuY3Rpb24gKHNlc3Npb24sIGFyZ3MsIG5leHQpIHtcbiAgICAgICAgICAgIHNlc3Npb24uZGlhbG9nRGF0YS5hYmMgPSBhcmdzIHx8IHt9O1xuICAgICAgICAgICAgYnVpbGRlci5Qcm9tcHRzLnRleHQoc2Vzc2lvbiwgJ3lvdSB3YW50IHRvIGdvIGRvd24hJyk7XG4gICAgICAgIH0sXG4gICAgICAgIGZ1bmN0aW9uIChzZXNzaW9uLCByZXN1bHRzLCBuZXh0KSB7XG4gICAgICAgICAgICBzZXNzaW9uLmRpYWxvZ0RhdGEuYWJjID0gLTE7IC8vIHJlc3VsdHMucmVwb25zZTtcbiAgICAgICAgICAgIG5leHQoKTtcbiAgICAgICAgfSxcbiAgICAgICAgZnVuY3Rpb24gKHNlc3Npb24sIHJlc3VsdHMpIHtcbiAgICAgICAgICAgIHNlc3Npb24uc2VuZChcInN0aWxsIGdvaW5nIGRvd24/XCIpO1xuICAgICAgICB9XG4gICAgXSk7XG4gICAgZGlhbG9nVXBEb3duLm9uRGVmYXVsdChmdW5jdGlvbiAoc2Vzc2lvbikge1xuICAgICAgICBsb2dRdWVyeShzZXNzaW9uLCBcIm9uRGVmYXVsdFwiKTtcbiAgICAgICAgdmFyIHJlcyA9IGdldFJhbmRvbVJlc3VsdChhVHJhaW5EaWFsb2cpICsgZ2V0UmFuZG9tUmVzdWx0KGFUcmFpbkV4aXRIaW50KTtcbiAgICAgICAgZGlhbG9nbG9nKFwiVHJhaW5NZVwiLCBzZXNzaW9uLCBzZW5kKHJlcykpO1xuICAgIH0pO1xuICAgIGJvdC5kaWFsb2coJy90cmFpbicsIFtcbiAgICAgICAgZnVuY3Rpb24gKHNlc3Npb24sIGFyZ3MsIG5leHQpIHtcbiAgICAgICAgICAgIHNlc3Npb24uZGlhbGdvRGF0YS5hYmMgPSBhcmdzIHx8IHt9O1xuICAgICAgICAgICAgYnVpbGRlci5Qcm9tcHRzLnRleHQoc2Vzc2lvbiwgJ0RvIHlvdSB3YW50IHRvIHRyYWluIG1lJyk7XG4gICAgICAgIH0sXG4gICAgICAgIGZ1bmN0aW9uIChzZXNzaW9uLCByZXN1bHRzLCBuZXh0KSB7XG4gICAgICAgICAgICBzZXNzaW9uLmRpYWxvZ0RhdGEuYWJjID0gcmVzdWx0cy5yZXBvbnNlO1xuICAgICAgICB9LFxuICAgICAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgcmVzdWx0cykge1xuICAgICAgICAgICAgc2Vzc2lvbi5lbmREaWFsb2dXaXRoUmVzdWx0KHsgcmVzcG9uc2U6IHNlc3Npb24uRGlhbG9nRGF0YS5hYmMgfSk7XG4gICAgICAgIH1cbiAgICBdKTtcbiAgICBib3QuZGlhbG9nKCcvJywgZGlhbG9nKTtcbiAgICBkaWFsb2cubWF0Y2hlcygnU2hvd01lJywgW1xuICAgICAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgYXJncywgbmV4dCkge1xuICAgICAgICAgICAgdmFyIGlzQ29tYmluZWRJbmRleCA9IHt9O1xuICAgICAgICAgICAgdmFyIG9OZXdFbnRpdHk7XG4gICAgICAgICAgICAvLyBleHBlY3RpbmcgZW50aXR5IEExXG4gICAgICAgICAgICBkZWJ1Z2xvZyhcIlNob3cgRW50aXR5XCIpO1xuICAgICAgICAgICAgZGVidWdsb2coJ3JhdzogJyArIEpTT04uc3RyaW5naWZ5KGFyZ3MuZW50aXRpZXMpLCB1bmRlZmluZWQsIDIpO1xuICAgICAgICAgICAgdmFyIGExID0gYnVpbGRlci5FbnRpdHlSZWNvZ25pemVyLmZpbmRFbnRpdHkoYXJncy5lbnRpdGllcywgJ0ExJyk7XG4gICAgICAgICAgICB2YXIgcmVzdWx0ID0gQW5hbHl6ZS5hbmFseXplQWxsKGExLmVudGl0eSwgdGhlTW9kZWwucnVsZXMsIHRoZU1vZGVsLnRvb2xzLCBnd29yZHMpO1xuICAgICAgICAgICAgbG9nUXVlcnkoc2Vzc2lvbiwgJ1Nob3dNZScsIHJlc3VsdCk7XG4gICAgICAgICAgICAvLyB0ZXN0LmV4cGVjdCgzKVxuICAgICAgICAgICAgLy8gIHRlc3QuZGVlcEVxdWFsKHJlc3VsdC53ZWlnaHQsIDEyMCwgJ2NvcnJlY3Qgd2VpZ2h0Jyk7XG4gICAgICAgICAgICBpZiAoIXJlc3VsdCB8fCByZXN1bHQubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgbmV4dCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gZGVidWdsb2coJ3Jlc3VsdCA6ICcgKyBKU09OLnN0cmluZ2lmeShyZXN1bHQsIHVuZGVmaW5lZCwgMikpO1xuICAgICAgICAgICAgZGVidWdsb2coJ2Jlc3QgcmVzdWx0IDogJyArIEpTT04uc3RyaW5naWZ5KHJlc3VsdFswXSB8fCB7fSwgdW5kZWZpbmVkLCAyKSk7XG4gICAgICAgICAgICBkZWJ1Z2xvZygndG9wIDogJyArIE1hdGNoLlRvb2xNYXRjaC5kdW1wV2VpZ2h0c1RvcChyZXN1bHQsIHsgdG9wOiAzIH0pKTtcbiAgICAgICAgICAgIGlmIChBbmFseXplLmlzQ29tcGxldGUocmVzdWx0WzBdKSkge1xuICAgICAgICAgICAgICAgIHNlc3Npb24uZGlhbG9nRGF0YS5yZXN1bHQgPSByZXN1bHRbMF07XG4gICAgICAgICAgICAgICAgLy8gICAgc2Vzc2lvbi5zZW5kKCdTaG93aW5nIGVudGl0eSAuLi4nKTtcbiAgICAgICAgICAgICAgICBuZXh0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChBbmFseXplLmdldFByb21wdChyZXN1bHRbMF0pKSB7XG4gICAgICAgICAgICAgICAgdmFyIHByb21wdCA9IEFuYWx5emUuZ2V0UHJvbXB0KHJlc3VsdFswXSk7XG4gICAgICAgICAgICAgICAgc2Vzc2lvbi5kaWFsb2dEYXRhLnJlc3VsdCA9IHJlc3VsdFswXTtcbiAgICAgICAgICAgICAgICBzZXNzaW9uLmRpYWxvZ0RhdGEucHJvbXB0ID0gcHJvbXB0O1xuICAgICAgICAgICAgICAgIGRpYWxvZ2xvZyhcIlNob3dNZVwiLCBzZXNzaW9uLCBzZW5kKFwiTm90IGVub3VnaCBpbmZvcm1hdGlvbiBzdXBwbGllZDogXCIgKyBNYXRjaC5Ub29sTWF0Y2guZHVtcE5pY2Uoc2Vzc2lvbi5kaWFsb2dEYXRhLnJlc3VsdCkpKTtcbiAgICAgICAgICAgICAgICBidWlsZGVyLlByb21wdHMudGV4dChzZXNzaW9uLCBwcm9tcHQudGV4dCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YXIgYmVzdCA9IHJlc3VsdC5sZW5ndGggPyBNYXRjaC5Ub29sTWF0Y2guZHVtcE5pY2UocmVzdWx0WzBdKSA6IFwiPG5vdGhpbmc+XCI7XG4gICAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiU2hvd01lXCIsIHNlc3Npb24sIHNlbmQoJ0kgZGlkIG5vdCB1bmRlcnN0YW5kIHRoaXMnICsgYmVzdCkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgcmVzdWx0cywgbmV4dCkge1xuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHNlc3Npb24uZGlhbG9nRGF0YS5yZXN1bHQ7XG4gICAgICAgICAgICBpZiAoIXJlc3VsdCB8fCByZXN1bHQubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgbmV4dCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKHJlc3VsdHMucmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAvLyBzb21lIHByb21wdGluZ1xuICAgICAgICAgICAgICAgIEFuYWx5emUuc2V0UHJvbXB0KHNlc3Npb24uZGlhbG9nRGF0YS5yZXN1bHQsIHNlc3Npb24uZGlhbG9nRGF0YS5wcm9tcHQsIHJlc3VsdHMucmVzcG9uc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKEFuYWx5emUuaXNDb21wbGV0ZShzZXNzaW9uLmRpYWxvZ0RhdGEucmVzdWx0KSkge1xuICAgICAgICAgICAgICAgIG5leHQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKEFuYWx5emUuZ2V0UHJvbXB0KHNlc3Npb24uZGlhbG9nRGF0YS5yZXN1bHQpKSB7XG4gICAgICAgICAgICAgICAgdmFyIHByb21wdCA9IEFuYWx5emUuZ2V0UHJvbXB0KHNlc3Npb24uZGlhbG9nRGF0YS5yZXN1bHQpO1xuICAgICAgICAgICAgICAgIHNlc3Npb24uZGlhbG9nRGF0YS5wcm9tcHQgPSBwcm9tcHQ7XG4gICAgICAgICAgICAgICAgYnVpbGRlci5Qcm9tcHRzLnRleHQoc2Vzc2lvbiwgcHJvbXB0LnRleHQpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgcmVzdWx0cywgbmV4dCkge1xuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IHNlc3Npb24uZGlhbG9nRGF0YS5yZXN1bHQ7XG4gICAgICAgICAgICBpZiAocmVzdWx0cy5yZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIC8vIHNvbWUgcHJvbXB0aW5nXG4gICAgICAgICAgICAgICAgQW5hbHl6ZS5zZXRQcm9tcHQoc2Vzc2lvbi5kaWFsb2dEYXRhLnJlc3VsdCwgc2Vzc2lvbi5kaWFsb2dEYXRhLnByb21wdCwgcmVzdWx0cy5yZXNwb25zZSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoQW5hbHl6ZS5pc0NvbXBsZXRlKHNlc3Npb24uZGlhbG9nRGF0YS5yZXN1bHQpKSB7XG4gICAgICAgICAgICAgICAgdmFyIGV4ZWMgPSBFeGVjU2VydmVyLmV4ZWNUb29sKHNlc3Npb24uZGlhbG9nRGF0YS5yZXN1bHQsIHRoZU1vZGVsLnJlY29yZHMpO1xuICAgICAgICAgICAgICAgIHZhciByZXBseSA9IG5ldyBidWlsZGVyLk1lc3NhZ2Uoc2Vzc2lvbilcbiAgICAgICAgICAgICAgICAgICAgLnRleHQoZXhlYy50ZXh0KVxuICAgICAgICAgICAgICAgICAgICAuYWRkRW50aXR5KGV4ZWMuYWN0aW9uKTtcbiAgICAgICAgICAgICAgICAvLyAuYWRkQXR0YWNobWVudCh7IGZhbGxiYWNrVGV4dDogXCJJIGRvbid0IGtub3dcIiwgY29udGVudFR5cGU6ICdpbWFnZS9qcGVnJywgY29udGVudFVybDogXCJ3d3cud29tYmF0Lm9yZ1wiIH0pO1xuICAgICAgICAgICAgICAgIGRpYWxvZ2xvZyhcIlNob3dNZVwiLCBzZXNzaW9uLCBzZW5kKHJlcGx5KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBpZiAoc2Vzc2lvbi5kaWFsb2dEYXRhLnJlc3VsdCkge1xuICAgICAgICAgICAgICAgICAgICBkaWFsb2dsb2coXCJTaG93TWVcIiwgc2Vzc2lvbiwgc2VuZChcIk5vdCBlbm91Z2ggaW5mb3JtYXRpb24gc3VwcGxpZWQ6IFwiICsgTWF0Y2guVG9vbE1hdGNoLmR1bXBOaWNlKHNlc3Npb24uZGlhbG9nRGF0YS5yZXN1bHQpKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBkaWFsb2dsb2coXCJTaG93TWVcIiwgc2Vzc2lvbiwgc2VuZChcIkkgZGlkIG5vdCBnZXQgd2hhdCB5b3Ugd2FudFwiKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgIF0pO1xuICAgIGRpYWxvZy5tYXRjaGVzKCdXaGF0SXMnLCBbXG4gICAgICAgIGZ1bmN0aW9uIChzZXNzaW9uLCBhcmdzLCBuZXh0KSB7XG4gICAgICAgICAgICB2YXIgaXNDb21iaW5lZEluZGV4ID0ge307XG4gICAgICAgICAgICB2YXIgb05ld0VudGl0eTtcbiAgICAgICAgICAgIC8vIGV4cGVjdGluZyBlbnRpdHkgQTFcbiAgICAgICAgICAgIHZhciBtZXNzYWdlID0gc2Vzc2lvbi5tZXNzYWdlLnRleHQ7XG4gICAgICAgICAgICBkZWJ1Z2xvZyhcIldoYXRJcyBFbnRpdGllc1wiKTtcbiAgICAgICAgICAgIGRlYnVnbG9nKCdyYXc6ICcgKyBKU09OLnN0cmluZ2lmeShhcmdzLmVudGl0aWVzKSwgdW5kZWZpbmVkLCAyKTtcbiAgICAgICAgICAgIHZhciBjYXRlZ29yeUVudGl0eSA9IGJ1aWxkZXIuRW50aXR5UmVjb2duaXplci5maW5kRW50aXR5KGFyZ3MuZW50aXRpZXMsICdjYXRlZ29yeScpO1xuICAgICAgICAgICAgdmFyIGNhdGVnb3J5ID0gY2F0ZWdvcnlFbnRpdHkuZW50aXR5O1xuICAgICAgICAgICAgdmFyIGExID0gYnVpbGRlci5FbnRpdHlSZWNvZ25pemVyLmZpbmRFbnRpdHkoYXJncy5lbnRpdGllcywgJ0ExJyk7XG4gICAgICAgICAgICB2YXIgY2F0ID0gV2hhdElzLmFuYWx5emVDYXRlZ29yeShjYXRlZ29yeSwgdGhlTW9kZWwucnVsZXMsIG1lc3NhZ2UpO1xuICAgICAgICAgICAgaWYgKCFjYXQpIHtcbiAgICAgICAgICAgICAgICBzZXNzaW9uLnNlbmQoJ0kgZG9uXFwndCBrbm93IGFueXRoaW5nIGFib3V0IFwiJyArIGNhdGVnb3J5ICsgJ1wiJyk7XG4gICAgICAgICAgICAgICAgLy8gbmV4dCgpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGRlYnVnbG9nKCdjYXRlZ29yeSBpZGVudGlmaWVkOicgKyBjYXQpO1xuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IFdoYXRJcy5yZXNvbHZlQ2F0ZWdvcnkoY2F0LCBhMS5lbnRpdHksIHRoZU1vZGVsLnJ1bGVzLCB0aGVNb2RlbC5yZWNvcmRzKTtcbiAgICAgICAgICAgIGRlYnVnbG9nKCd3aGF0aXMgcmVzdWx0OicgKyBKU09OLnN0cmluZ2lmeShyZXN1bHQpKTtcbiAgICAgICAgICAgIGxvZ1F1ZXJ5V2hhdElzKHNlc3Npb24sICdXaGF0SXMnLCByZXN1bHQpO1xuICAgICAgICAgICAgdmFyIGluZGlzID0gV2hhdElzLmlzSW5kaXNjcmltaW5hdGVSZXN1bHQocmVzdWx0KTtcbiAgICAgICAgICAgIGlmIChpbmRpcykge1xuICAgICAgICAgICAgICAgIHNlc3Npb24uc2VuZChpbmRpcyk7XG4gICAgICAgICAgICAgICAgLy8gbmV4dCgpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghcmVzdWx0IHx8IHJlc3VsdC5sZW5ndGggPT09IDApIHtcbiAgICAgICAgICAgICAgICBkaWFsb2dsb2coXCJXaGF0SXNcIiwgc2Vzc2lvbiwgc2VuZCgnSSBkb25cXCd0IGtub3cgYW55dGhpbmcgYWJvdXQgXCInICsgY2F0ICsgXCIgKFwiICsgY2F0ZWdvcnkgKyAnKVxcXCIgaW4gcmVsYXRpb24gdG8gXCInICsgYTEuZW50aXR5ICsgJ1wiJykpO1xuICAgICAgICAgICAgICAgIC8vIG5leHQoKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAvLyBkZWJ1Z2xvZygncmVzdWx0IDogJyArIEpTT04uc3RyaW5naWZ5KHJlc3VsdCwgdW5kZWZpbmVkLCAyKSk7XG4gICAgICAgICAgICAgICAgZGVidWdsb2coJ2Jlc3QgcmVzdWx0IDogJyArIEpTT04uc3RyaW5naWZ5KHJlc3VsdFswXSB8fCB7fSwgdW5kZWZpbmVkLCAyKSk7XG4gICAgICAgICAgICAgICAgZGVidWdsb2coJ3RvcCA6ICcgKyBXaGF0SXMuZHVtcFdlaWdodHNUb3AocmVzdWx0LCB7IHRvcDogMyB9KSk7XG4gICAgICAgICAgICAgICAgLy8gVE9ETyBjbGVhbnNlZCBzZW50ZW5jZVxuICAgICAgICAgICAgICAgIGRpYWxvZ2xvZyhcIldoYXRJc1wiLCBzZXNzaW9uLCBzZW5kKCdUaGUgJyArIGNhdGVnb3J5ICsgJyBvZiAnICsgYTEuZW50aXR5ICsgJyBpcyAnICsgcmVzdWx0WzBdLnJlc3VsdCArIFwiXFxuXCIpKTsgLy8gICsgSlNPTi5zdHJpbmdpZnkocmVzdWx0WzBdKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICBdKTtcbiAgICBkaWFsb2cubWF0Y2hlcygnTGlzdEFsbCcsIFtcbiAgICAgICAgZnVuY3Rpb24gKHNlc3Npb24sIGFyZ3MsIG5leHQpIHtcbiAgICAgICAgICAgIHZhciBpc0NvbWJpbmVkSW5kZXggPSB7fTtcbiAgICAgICAgICAgIHZhciBvTmV3RW50aXR5O1xuICAgICAgICAgICAgLy8gZXhwZWN0aW5nIGVudGl0eSBBMVxuICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSBzZXNzaW9uLm1lc3NhZ2UudGV4dDtcbiAgICAgICAgICAgIGRlYnVnbG9nKFwiSW50ZW50IDogTGlzdEFsbFwiKTtcbiAgICAgICAgICAgIGRlYnVnbG9nKCdyYXc6ICcgKyBKU09OLnN0cmluZ2lmeShhcmdzLmVudGl0aWVzKSwgdW5kZWZpbmVkLCAyKTtcbiAgICAgICAgICAgIHZhciBjYXRlZ29yeUVudGl0eSA9IGJ1aWxkZXIuRW50aXR5UmVjb2duaXplci5maW5kRW50aXR5KGFyZ3MuZW50aXRpZXMsICdjYXRlZ29yaWVzJyk7XG4gICAgICAgICAgICB2YXIgY2F0ZWdvcnkgPSBjYXRlZ29yeUVudGl0eS5lbnRpdHk7XG4gICAgICAgICAgICB2YXIgYTEgPSBidWlsZGVyLkVudGl0eVJlY29nbml6ZXIuZmluZEVudGl0eShhcmdzLmVudGl0aWVzLCAnaW5zdGgnKTtcbiAgICAgICAgICAgIGlmIChjYXRlZ29yeSA9PT0gXCJjYXRlZ29yaWVzXCIpIHtcbiAgICAgICAgICAgICAgICAvLyBkbyB3ZSBoYXZlIGEgZmlsdGVyID9cbiAgICAgICAgICAgICAgICB2YXIgZG9tYWluID0gdW5kZWZpbmVkO1xuICAgICAgICAgICAgICAgIGlmIChhMSAmJiBhMS5lbnRpdHkpIHtcbiAgICAgICAgICAgICAgICAgICAgZG9tYWluID0gTGlzdEFsbC5pbmZlckRvbWFpbih0aGVNb2RlbCwgYTEuZW50aXR5KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgaWYgKCFkb21haW4pIHtcbiAgICAgICAgICAgICAgICAgICAgdmFyIHJlcyA9IHJlc3RyaWN0TG9nZ2VkT24oc2Vzc2lvbiwgdGhlTW9kZWwuY2F0ZWdvcnkpLmpvaW4oXCI7XFxuXCIpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoYTEgJiYgYTEuZW50aXR5KSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsXCIsIHNlc3Npb24sIHNlbmQoXCJJIGRpZCBub3QgaW5mZXIgYSBkb21haW4gcmVzdHJpY3Rpb24gZnJvbSBcXFwiXCIgKyBhMS5lbnRpdHkgKyBcIlxcXCIsIGFsbCBteSBjYXRlZ29yaWVzIGFyZSAuLi5cXG5cIiArIHJlcykpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbFwiLCBzZXNzaW9uLCBzZW5kKFwibXkgY2F0ZWdvcmllcyBhcmUgLi4uXFxuXCIgKyByZXMpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICB2YXIgYVJlcyA9IE1vZGVsLmdldENhdGVnb3JpZXNGb3JEb21haW4odGhlTW9kZWwsIGRvbWFpbik7XG4gICAgICAgICAgICAgICAgICAgIHZhciByZXMgPSByZXN0cmljdExvZ2dlZE9uKHNlc3Npb24sIGFSZXMpLmpvaW4oXCI7XFxuXCIpO1xuICAgICAgICAgICAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsXCIsIHNlc3Npb24sIHNlbmQoXCJteSBjYXRlZ29yaWVzIGluIGRvbWFpbiBcXFwiXCIgKyBkb21haW4gKyBcIlxcXCIgYXJlIC4uLlxcblwiICsgcmVzKSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoY2F0ZWdvcnkgPT09IFwiZG9tYWluc1wiKSB7XG4gICAgICAgICAgICAgICAgdmFyIHJlcyA9IHJlc3RyaWN0TG9nZ2VkT24oc2Vzc2lvbiwgdGhlTW9kZWwuZG9tYWlucykuam9pbihcIjtcXG5cIik7XG4gICAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbFwiLCBzZXNzaW9uLCBzZW5kKFwibXkgZG9tYWlucyBhcmUgLi4uXFxuXCIgKyByZXMpKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoY2F0ZWdvcnkgPT09IFwidG9vbHNcIikge1xuICAgICAgICAgICAgICAgIHZhciByZXMgPSByZXN0cmljdExvZ2dlZE9uKHNlc3Npb24sIHRoZU1vZGVsLnRvb2xzKS5tYXAoZnVuY3Rpb24gKG9Ub29sKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBvVG9vbC5uYW1lO1xuICAgICAgICAgICAgICAgIH0pLmpvaW4oXCI7XFxuXCIpO1xuICAgICAgICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxcIiwgc2Vzc2lvbiwgc2VuZChcIm15IHRvb2xzIGFyZSAuLi5cXG5cIiArIHJlcykpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciBjYXQgPSBXaGF0SXMuYW5hbHl6ZUNhdGVnb3J5KGNhdGVnb3J5LCB0aGVNb2RlbC5ydWxlcywgbWVzc2FnZSk7XG4gICAgICAgICAgICBpZiAoIWNhdCkge1xuICAgICAgICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxcIiwgc2Vzc2lvbiwgc2VuZCgnSSBkb25cXCd0IGtub3cgYW55dGhpbmcgYWJvdXQgXCInICsgY2F0ZWdvcnkgKyAnXCInKSk7XG4gICAgICAgICAgICAgICAgLy8gbmV4dCgpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGRlYnVnbG9nKCdjYXRlZ29yeSBpZGVudGlmaWVkOicgKyBjYXQpO1xuICAgICAgICAgICAgaWYgKGExICYmIGExLmVudGl0eSkge1xuICAgICAgICAgICAgICAgIGRlYnVnbG9nKCdnb3QgZmlsdGVyOicgKyBhMS5lbnRpdHkpO1xuICAgICAgICAgICAgICAgIHZhciBjYXRlZ29yeVNldCA9IE1vZGVsLmdldEFsbFJlY29yZENhdGVnb3JpZXNGb3JUYXJnZXRDYXRlZ29yeSh0aGVNb2RlbCwgY2F0LCB0cnVlKTtcbiAgICAgICAgICAgICAgICB2YXIgcmVzdWx0MSA9IExpc3RBbGwubGlzdEFsbFdpdGhDb250ZXh0KGNhdCwgYTEuZW50aXR5LCB0aGVNb2RlbC5ydWxlcywgdGhlTW9kZWwucmVjb3JkcywgY2F0ZWdvcnlTZXQpO1xuICAgICAgICAgICAgICAgIC8vIFRPRE8gY2xhc3NpZnlpbmcgdGhlIHN0cmluZyB0d2ljZSBpcyBhIHRlcnJpYmxlIHdhc3RlXG4gICAgICAgICAgICAgICAgaWYgKCFyZXN1bHQxLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBkZWJ1Z2xvZygnZ29pbmcgZm9yIGhhdmluZycpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgY2F0ZWdvcnlTZXRGdWxsID0gTW9kZWwuZ2V0QWxsUmVjb3JkQ2F0ZWdvcmllc0ZvclRhcmdldENhdGVnb3J5KHRoZU1vZGVsLCBjYXQsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICAgICAgcmVzdWx0MSA9IExpc3RBbGwubGlzdEFsbEhhdmluZ0NvbnRleHQoY2F0LCBhMS5lbnRpdHksIHRoZU1vZGVsLnJ1bGVzLCB0aGVNb2RlbC5yZWNvcmRzLCBjYXRlZ29yeVNldEZ1bGwpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBkZWJ1Z2xvZygnbGlzdGFsbCByZXN1bHQ6JyArIEpTT04uc3RyaW5naWZ5KHJlc3VsdDEpKTtcbiAgICAgICAgICAgICAgICB2YXIgam9pbnJlc3VsdHMgPSByZXN0cmljdExvZ2dlZE9uKHNlc3Npb24sIExpc3RBbGwuam9pblJlc3VsdHMocmVzdWx0MSkpO1xuICAgICAgICAgICAgICAgIGxvZ1F1ZXJ5V2hhdElzKHNlc3Npb24sICdMaXN0QWxsJywgcmVzdWx0MSk7XG4gICAgICAgICAgICAgICAgaWYgKGpvaW5yZXN1bHRzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsXCIsIHNlc3Npb24sIHNlbmQoXCJ0aGUgXCIgKyBjYXRlZ29yeSArIFwiIGZvciBcIiArIGExLmVudGl0eSArIFwiIGFyZSAuLi5cXG5cIiArIGpvaW5yZXN1bHRzLmpvaW4oXCI7XFxuXCIpKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsXCIsIHNlc3Npb24sIHNlbmQoXCJpIGRpZCBub3QgZmluZCBhbnkgXCIgKyBjYXRlZ29yeSArIFwiIGZvciBcIiArIGExLmVudGl0eSArIFwiLlxcblwiICsgam9pbnJlc3VsdHMuam9pbihcIjtcXG5cIikpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gbm8gZW50aXR5LCBlLmcuIGxpc3QgYWxsIGNvdW50cmllc1xuICAgICAgICAgICAgICAgIC8vXG4gICAgICAgICAgICAgICAgdmFyIGNhdGVnb3J5U2V0RnVsbCA9IE1vZGVsLmdldEFsbFJlY29yZENhdGVnb3JpZXNGb3JUYXJnZXRDYXRlZ29yeSh0aGVNb2RlbCwgY2F0LCBmYWxzZSk7XG4gICAgICAgICAgICAgICAgdmFyIHJlc3VsdCA9IExpc3RBbGwubGlzdEFsbEhhdmluZ0NvbnRleHQoY2F0LCBjYXQsIHRoZU1vZGVsLnJ1bGVzLCB0aGVNb2RlbC5yZWNvcmRzLCBjYXRlZ29yeVNldEZ1bGwpO1xuICAgICAgICAgICAgICAgIGxvZ1F1ZXJ5V2hhdElzKHNlc3Npb24sICdMaXN0QWxsJywgcmVzdWx0KTtcbiAgICAgICAgICAgICAgICBpZiAocmVzdWx0Lmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBkZWJ1Z2xvZygnbGlzdGFsbCByZXN1bHQ6JyArIEpTT04uc3RyaW5naWZ5KHJlc3VsdCkpO1xuICAgICAgICAgICAgICAgICAgICB2YXIgam9pbnJlc3VsdHMgPSBbXTtcbiAgICAgICAgICAgICAgICAgICAgZGVidWdsb2coXCJoZXJlIGlzIGNhdD5cIiArIGNhdCk7XG4gICAgICAgICAgICAgICAgICAgIGlmIChjYXQgIT09IFwiZXhhbXBsZSBxdWVzdGlvblwiKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBqb2lucmVzdWx0cyA9IHJlc3RyaWN0TG9nZ2VkT24oc2Vzc2lvbiwgTGlzdEFsbC5qb2luUmVzdWx0cyhyZXN1bHQpKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIGpvaW5yZXN1bHRzID0gTGlzdEFsbC5qb2luUmVzdWx0cyhyZXN1bHQpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIHZhciByZXNwb25zZSA9IFwidGhlIFwiICsgY2F0ZWdvcnkgKyBcIiBhcmUgLi4uXFxuXCIgKyBqb2lucmVzdWx0cy5qb2luKFwiO1xcblwiKTtcbiAgICAgICAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbFwiLCBzZXNzaW9uLCBzZW5kKHJlc3BvbnNlKSk7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIHZhciByZXNwb25zZSA9IFwiRm91bmQgbm8gZGF0YSBoYXZpbmcgXFxcIlwiICsgY2F0ICsgXCJcXFwiXCI7XG4gICAgICAgICAgICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxcIiwgc2Vzc2lvbiwgc2VuZChyZXNwb25zZSkpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgXSk7XG4gICAgZGlhbG9nLm1hdGNoZXMoJ0xpc3RBbGxCaW5PcCcsIFtcbiAgICAgICAgZnVuY3Rpb24gKHNlc3Npb24sIGFyZ3MsIG5leHQpIHtcbiAgICAgICAgICAgIHZhciBpc0NvbWJpbmVkSW5kZXggPSB7fTtcbiAgICAgICAgICAgIHZhciBvTmV3RW50aXR5O1xuICAgICAgICAgICAgLy8gZXhwZWN0aW5nIGVudGl0eSBBMVxuICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSBzZXNzaW9uLm1lc3NhZ2UudGV4dDtcbiAgICAgICAgICAgIGRlYnVnbG9nKFwiSW50ZW50IDogTGlzdEFsbEJpbk9wXCIpO1xuICAgICAgICAgICAgZGVidWdsb2coJ3JhdzogJyArIEpTT04uc3RyaW5naWZ5KGFyZ3MuZW50aXRpZXMpLCB1bmRlZmluZWQsIDIpO1xuICAgICAgICAgICAgdmFyIGNhdGVnb3J5RW50aXR5ID0gYnVpbGRlci5FbnRpdHlSZWNvZ25pemVyLmZpbmRFbnRpdHkoYXJncy5lbnRpdGllcywgJ2NhdGVnb3J5Jyk7XG4gICAgICAgICAgICB2YXIgY2F0ZWdvcnlXb3JkID0gY2F0ZWdvcnlFbnRpdHkuZW50aXR5O1xuICAgICAgICAgICAgdmFyIG9wRW50aXR5ID0gYnVpbGRlci5FbnRpdHlSZWNvZ25pemVyLmZpbmRFbnRpdHkoYXJncy5lbnRpdGllcywgJ29wZXJhdG9yJyk7XG4gICAgICAgICAgICB2YXIgb3BlcmF0b3JXb3JkID0gb3BFbnRpdHkuZW50aXR5O1xuICAgICAgICAgICAgLy8gY2F0ZWdvcml6ZSBhcyBvcGVyYXRvciA/XG4gICAgICAgICAgICB2YXIgb3BlcmF0b3IgPSBXaGF0SXMuYW5hbHl6ZU9wZXJhdG9yKG9wZXJhdG9yV29yZCwgdGhlTW9kZWwucnVsZXMsIG1lc3NhZ2UpO1xuICAgICAgICAgICAgdmFyIGNhdGVnb3J5ID0gV2hhdElzLmFuYWx5emVDYXRlZ29yeShjYXRlZ29yeVdvcmQsIHRoZU1vZGVsLnJ1bGVzLCBtZXNzYWdlKTtcbiAgICAgICAgICAgIHZhciBvcGVyYXRvckFyZ3MgPSBNb2RlbC5nZXRPcGVyYXRvcih0aGVNb2RlbCwgb3BlcmF0b3IpO1xuICAgICAgICAgICAgdmFyIGEyID0gYnVpbGRlci5FbnRpdHlSZWNvZ25pemVyLmZpbmRFbnRpdHkoYXJncy5lbnRpdGllcywgJ0EyJyk7XG4gICAgICAgICAgICBpZiAoIW9wZXJhdG9yKSB7XG4gICAgICAgICAgICAgICAgdmFyIHMgPSBcIlVua25vd24gb3BlcmF0b3IgXCIgKyBvcGVyYXRvcldvcmQgKyBcIiwgdGhpcyBpcyBhIG1vZGVsIGJ1ZywgY2hlY2sgb3BlcmF0b3JzLmpzb24gYW5kIGludGVudHMuanNvblwiO1xuICAgICAgICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxCaW5PcFwiLCBzZXNzaW9uLCBzZW5kKFwib3VjaCwgdGhpcyB3YXMgaW4gaW50ZXJuYWwgZXJyb3IuIFJlY292ZXJpbmcgZnJvbSBhIHdlaXJkIG9wZXJhdG9yIFxcXCJcIlxuICAgICAgICAgICAgICAgICAgICArIG9wZXJhdG9yV29yZCArIFwiXFxcIlxcblwiKSk7XG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKHMpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIGZyYWdtZW50ID0gYTIgJiYgYTIuZW50aXR5O1xuICAgICAgICAgICAgZnJhZ21lbnQgPSBCcmVha0Rvd24udHJpbVF1b3RlZChCcmVha0Rvd24udHJpbVF1b3RlZFNwYWNlZChmcmFnbWVudCkpO1xuICAgICAgICAgICAgZGVidWdsb2coXCJmcmFnbWVudCBhZnRlciB0cmltbWluZyBcXFwiXCIgKyBmcmFnbWVudCArIFwiXFxcIlwiKTtcbiAgICAgICAgICAgIGlmIChjYXRlZ29yeVdvcmQgPT09IFwiY2F0ZWdvcmllc1wiKSB7XG4gICAgICAgICAgICAgICAgLy8gZG8gd2UgaGF2ZSBhIGZpbHRlcj9cbiAgICAgICAgICAgICAgICB2YXIgYUZpbHRlcmVkQ2F0ZWdvcmllcyA9IExpc3RBbGwuZmlsdGVyU3RyaW5nTGlzdEJ5T3Aob3BlcmF0b3JBcmdzLCBmcmFnbWVudCwgdGhlTW9kZWwuY2F0ZWdvcnkpO1xuICAgICAgICAgICAgICAgIHJlcyA9IHJlc3RyaWN0TG9nZ2VkT24oc2Vzc2lvbiwgYUZpbHRlcmVkQ2F0ZWdvcmllcykuam9pbihcIjtcXG5cIik7XG4gICAgICAgICAgICAgICAgaWYgKHJlcy5sZW5ndGgpIHtcbiAgICAgICAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbEJpbk9wXCIsIHNlc3Npb24sIHNlbmQoXCJteSBjYXRlZ29yaWVzIFwiICsgb3BlcmF0b3IgKyAnIFwiJyArIGZyYWdtZW50ICsgJ1wiIGFyZSAuLi5cXG4nICsgcmVzKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsQmluT3BcIiwgc2Vzc2lvbiwgc2VuZCgnSSBoYXZlIG5vIGNhdGVnb3JpZXMgJyArIG9wZXJhdG9yICsgJyBcIicgKyBmcmFnbWVudCArICdcIicpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSBpZiAoY2F0ZWdvcnlXb3JkID09PSBcImRvbWFpbnNcIikge1xuICAgICAgICAgICAgICAgIHZhciBhUmVzID0gTGlzdEFsbC5maWx0ZXJTdHJpbmdMaXN0QnlPcChvcGVyYXRvckFyZ3MsIGZyYWdtZW50LCB0aGVNb2RlbC5kb21haW5zKTtcbiAgICAgICAgICAgICAgICByZXMgPSByZXN0cmljdExvZ2dlZE9uKHNlc3Npb24sIGFSZXMpLmpvaW4oXCI7XFxuXCIpO1xuICAgICAgICAgICAgICAgIGlmIChyZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxCaW5PcFwiLCBzZXNzaW9uLCBzZW5kKFwibXkgZG9tYWlucyBcIiArIG9wZXJhdG9yICsgJyBcIicgKyBmcmFnbWVudCArICdcIiBhcmUgLi4uXFxuJyArIHJlcykpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbEJpbk9wXCIsIHNlc3Npb24sIHNlbmQoJ0kgaGF2ZSBubyBkb21haW5zICcgKyBvcGVyYXRvciArICcgXCInICsgZnJhZ21lbnQgKyAnXCInKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2UgaWYgKGNhdGVnb3J5V29yZCA9PT0gXCJ0b29sc1wiKSB7XG4gICAgICAgICAgICAgICAgdmFyIGFSZXMgPSBMaXN0QWxsLmZpbHRlclN0cmluZ0xpc3RCeU9wKG9wZXJhdG9yQXJncywgZnJhZ21lbnQsIHRoZU1vZGVsLnRvb2xzLm1hcChmdW5jdGlvbiAob1Rvb2wpIHsgcmV0dXJuIG9Ub29sLm5hbWU7IH0pKTtcbiAgICAgICAgICAgICAgICB2YXIgcmVzID0gcmVzdHJpY3RMb2dnZWRPbihzZXNzaW9uLCBhUmVzKS5qb2luKFwiO1xcblwiKTtcbiAgICAgICAgICAgICAgICBpZiAocmVzLmxlbmd0aCkge1xuICAgICAgICAgICAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsQmluT3BcIiwgc2Vzc2lvbiwgc2VuZChcIm15IHRvb2xzIFwiICsgb3BlcmF0b3IgKyAnIFwiJyArIGZyYWdtZW50ICsgJ1wiIGFyZSAuLi5cXG4nICsgcmVzKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsQmluT3BcIiwgc2Vzc2lvbiwgc2VuZChcIkkgaGF2ZSBubyB0b29scyBcIiArIG9wZXJhdG9yICsgJyBcIicgKyBmcmFnbWVudCArICdcIicpKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgdmFyIGNhdCA9IFdoYXRJcy5hbmFseXplQ2F0ZWdvcnkoY2F0ZWdvcnlXb3JkLCB0aGVNb2RlbC5ydWxlcywgbWVzc2FnZSk7XG4gICAgICAgICAgICAgICAgaWYgKCFjYXQpIHtcbiAgICAgICAgICAgICAgICAgICAgZGlhbG9nbG9nKFwiTGlzdEFsbEJpbk9wXCIsIHNlc3Npb24sIHNlbmQoJ0kgZG9uXFwndCBrbm93IGFueXRoaW5nIGFib3V0IFwiJyArIGNhdGVnb3J5V29yZCArICdcIicpKTtcbiAgICAgICAgICAgICAgICAgICAgLy8gbmV4dCgpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGRlYnVnbG9nKCdjYXRlZ29yeSBpZGVudGlmaWVkOicgKyBjYXQpO1xuICAgICAgICAgICAgICAgIHZhciBhUmVzID0gTGlzdEFsbC5nZXRDYXRlZ29yeU9wRmlsdGVyQXNEaXN0aW5jdFN0cmluZ3Mob3BlcmF0b3JBcmdzLCBmcmFnbWVudCwgY2F0ZWdvcnksIHRoZU1vZGVsLnJlY29yZHMpO1xuICAgICAgICAgICAgICAgIHZhciByZXMgPSByZXN0cmljdExvZ2dlZE9uKHNlc3Npb24sIGFSZXMpLmpvaW4oXCI7XFxuXCIpO1xuICAgICAgICAgICAgICAgIHZhciBpbmZpeEV4cGxhaW4gPSAnJztcbiAgICAgICAgICAgICAgICBpZiAoIUxpc3RBbGwubGlrZWx5UGx1cmFsRGlmZihjYXRlZ29yeSwgY2F0ZWdvcnlXb3JkKSkge1xuICAgICAgICAgICAgICAgICAgICBpbmZpeEV4cGxhaW4gPSAnKFwiJyArIGNhdGVnb3J5ICsgJ1wiKSc7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGlmIChyZXMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgICAgICAgIGRpYWxvZ2xvZyhcIkxpc3RBbGxCaW5PcFwiLCBzZXNzaW9uLCBzZW5kKCdteSAnICsgY2F0ZWdvcnlXb3JkICsgaW5maXhFeHBsYWluICsgJyAnICsgb3BlcmF0b3IgKyAnIFwiJyArIGZyYWdtZW50ICsgJ1wiIGFyZSAuLi5cXG4nICsgcmVzKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBkaWFsb2dsb2coXCJMaXN0QWxsQmluT3BcIiwgc2Vzc2lvbiwgc2VuZCgnSSBoYXZlIG5vICcgKyBjYXRlZ29yeVdvcmQgKyBpbmZpeEV4cGxhaW4gKyAnICcgKyBvcGVyYXRvciArICcgXCInICsgZnJhZ21lbnQgKyAnXCInKSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIF0pO1xuICAgIGRpYWxvZy5tYXRjaGVzKCdUcmFpbk1lJywgW1xuICAgICAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgYXJncywgbmV4dCkge1xuICAgICAgICAgICAgdmFyIGlzQ29tYmluZWRJbmRleCA9IHt9O1xuICAgICAgICAgICAgdmFyIG9OZXdFbnRpdHk7XG4gICAgICAgICAgICAvLyBleHBlY3RpbmcgZW50aXR5IEExXG4gICAgICAgICAgICB2YXIgbWVzc2FnZSA9IHNlc3Npb24ubWVzc2FnZS50ZXh0O1xuICAgICAgICAgICAgZGVidWdsb2coXCJJbnRlbnQgOiBUcmFpblwiKTtcbiAgICAgICAgICAgIGRlYnVnbG9nKCdyYXc6ICcgKyBKU09OLnN0cmluZ2lmeShhcmdzLmVudGl0aWVzKSwgdW5kZWZpbmVkLCAyKTtcbiAgICAgICAgICAgIHZhciBjYXRlZ29yeUVudGl0eSA9IGJ1aWxkZXIuRW50aXR5UmVjb2duaXplci5maW5kRW50aXR5KGFyZ3MuZW50aXRpZXMsICdjYXRlZ29yaWVzJyk7XG4gICAgICAgICAgICBpZiAobWVzc2FnZS50b0xvd2VyQ2FzZSgpLmluZGV4T2YoXCJrcm9ub3NcIikgPj0gMCB8fCBtZXNzYWdlLnRvTG93ZXJDYXNlKCkuaW5kZXhPZihcImtsaW5nb25cIikgPj0gMCkge1xuICAgICAgICAgICAgICAgIGRpYWxvZ2xvZyhcIlRyYWluTWVcIiwgc2Vzc2lvbiwgc2VuZChnZXRSYW5kb21SZXN1bHQoYVRyYWluTm9LbGluZ29uKSkpO1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHZhciByZXMgPSBnZXRSYW5kb21SZXN1bHQoYVRyYWluUmVwbGllcyk7XG4gICAgICAgICAgICBkaWFsb2dsb2coXCJUcmFpbk1lXCIsIHNlc3Npb24sIHNlbmQocmVzKSk7XG4gICAgICAgIH1cbiAgICBdKTtcbiAgICBkaWFsb2cubWF0Y2hlcygnV3JvbmcnLCBbXG4gICAgICAgIGZ1bmN0aW9uIChzZXNzaW9uLCBhcmdzLCBuZXh0KSB7XG4gICAgICAgICAgICBkaWFsb2dMb2dnZXIoe1xuICAgICAgICAgICAgICAgIHNlc3Npb246IHNlc3Npb24sXG4gICAgICAgICAgICAgICAgaW50ZW50OiBcIldyb25nXCIsXG4gICAgICAgICAgICAgICAgcmVzcG9uc2U6ICc8YmVnaW4gdXBkb3duPidcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgc2Vzc2lvbi5iZWdpbkRpYWxvZygnL3VwZG93bicsIHNlc3Npb24udXNlckRhdGEuY291bnQpO1xuICAgICAgICB9LFxuICAgICAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgcmVzdWx0cywgbmV4dCkge1xuICAgICAgICAgICAgdmFyIGFsYXJtID0gc2Vzc2lvbi5kaWFsb2dEYXRhLmFsYXJtO1xuICAgICAgICAgICAgbmV4dCgpO1xuICAgICAgICB9LFxuICAgICAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgcmVzdWx0cykge1xuICAgICAgICAgICAgc2Vzc2lvbi5zZW5kKGdldFJhbmRvbVJlc3VsdChhQmFja0Zyb21UcmFpbmluZykpOyAvLyAgKyBKU09OLnN0cmluZ2lmeShyZXN1bHRzKSk7XG4gICAgICAgICAgICAvL3Nlc3Npb24uc2VuZCgnZW5kIG9mIHdyb25nJyk7XG4gICAgICAgIH1cbiAgICBdKTtcbiAgICBkaWFsb2cubWF0Y2hlcygnRXhpdCcsIFtcbiAgICAgICAgZnVuY3Rpb24gKHNlc3Npb24sIGFyZ3MsIG5leHQpIHtcbiAgICAgICAgICAgIGRlYnVnbG9nKCdleGl0IDonKTtcbiAgICAgICAgICAgIGRlYnVnbG9nKCdleGl0JyArIEpTT04uc3RyaW5naWZ5KGFyZ3MuZW50aXRpZXMpKTtcbiAgICAgICAgICAgIGRpYWxvZ0xvZ2dlcih7XG4gICAgICAgICAgICAgICAgc2Vzc2lvbjogc2Vzc2lvbixcbiAgICAgICAgICAgICAgICBpbnRlbnQ6IFwiRXhpdFwiLFxuICAgICAgICAgICAgICAgIHJlc3BvbnNlOiAneW91IGFyZSBpbiBhIGxvZ2ljIGxvb3AnXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHNlc3Npb24uc2VuZChcInlvdSBhcmUgaW4gYSBsb2dpYyBsb29wIFwiKTtcbiAgICAgICAgfVxuICAgIF0pO1xuICAgIGRpYWxvZy5tYXRjaGVzKCdIZWxwJywgW1xuICAgICAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgYXJncywgbmV4dCkge1xuICAgICAgICAgICAgZGVidWdsb2coJ2hlbHAgOicpO1xuICAgICAgICAgICAgZGVidWdsb2coJ2hlbHAnKTtcbiAgICAgICAgICAgIHNlc3Npb24uc2VuZChcIkkga25vdyBhYm91dCAuLi4uIDxjYXRlZ29yaWVzPj5cIik7XG4gICAgICAgIH1cbiAgICBdKTtcbiAgICAvLyBBZGQgaW50ZW50IGhhbmRsZXJzXG4gICAgZGlhbG9nLm1hdGNoZXMoJ3RyYWluJywgW1xuICAgICAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgYXJncywgbmV4dCkge1xuICAgICAgICAgICAgZGVidWdsb2coJ3RyYWluJyk7XG4gICAgICAgICAgICAvLyBSZXNvbHZlIGFuZCBzdG9yZSBhbnkgZW50aXRpZXMgcGFzc2VkIGZyb20gTFVJUy5cbiAgICAgICAgICAgIHZhciB0aXRsZSA9IGJ1aWxkZXIuRW50aXR5UmVjb2duaXplci5maW5kRW50aXR5KGFyZ3MuZW50aXRpZXMsICdidWlsdGluLmFsYXJtLnRpdGxlJyk7XG4gICAgICAgICAgICB2YXIgdGltZSA9IGJ1aWxkZXIuRW50aXR5UmVjb2duaXplci5yZXNvbHZlVGltZShhcmdzLmVudGl0aWVzKTtcbiAgICAgICAgICAgIHZhciBhbGFybSA9IHNlc3Npb24uZGlhbG9nRGF0YS5hbGFybSA9IHtcbiAgICAgICAgICAgICAgICB0aXRsZTogdGl0bGUgPyB0aXRsZS5lbnRpdHkgOiBudWxsLFxuICAgICAgICAgICAgICAgIHRpbWVzdGFtcDogdGltZSA/IHRpbWUuZ2V0VGltZSgpIDogbnVsbFxuICAgICAgICAgICAgfTtcbiAgICAgICAgICAgIC8vIFByb21wdCBmb3IgdGl0bGVcbiAgICAgICAgICAgIGlmICghYWxhcm0udGl0bGUpIHtcbiAgICAgICAgICAgICAgICBkaWFsb2dMb2dnZXIoe1xuICAgICAgICAgICAgICAgICAgICBzZXNzaW9uOiBzZXNzaW9uLFxuICAgICAgICAgICAgICAgICAgICBpbnRlbnQ6IFwidHJhaW5cIixcbiAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2U6ICdXaGF0IGZhY3Qgd291bGQgeW91IGxpa2UgdG8gdHJhaW4/J1xuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGJ1aWxkZXIuUHJvbXB0cy50ZXh0KHNlc3Npb24sICdXaGF0IGZhY3Qgd291bGQgeW91IGxpa2UgdG8gdHJhaW4/Jyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBuZXh0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIGZ1bmN0aW9uIChzZXNzaW9uLCByZXN1bHRzLCBuZXh0KSB7XG4gICAgICAgICAgICB2YXIgYWxhcm0gPSBzZXNzaW9uLmRpYWxvZ0RhdGEuYWxhcm07XG4gICAgICAgICAgICBpZiAocmVzdWx0cy5yZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIGFsYXJtLnRpdGxlID0gcmVzdWx0cy5yZXNwb25zZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vIFByb21wdCBmb3IgdGltZSAodGl0bGUgd2lsbCBiZSBibGFuayBpZiB0aGUgdXNlciBzYWlkIGNhbmNlbClcbiAgICAgICAgICAgIGlmIChhbGFybS50aXRsZSAmJiAhYWxhcm0udGltZXN0YW1wKSB7XG4gICAgICAgICAgICAgICAgYnVpbGRlci5Qcm9tcHRzLnRpbWUoc2Vzc2lvbiwgJ1doYXQgdGltZSB3b3VsZCB5b3UgbGlrZSB0byBzZXQgdGhlIGFsYXJtIGZvcj8nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIG5leHQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZnVuY3Rpb24gKHNlc3Npb24sIHJlc3VsdHMpIHtcbiAgICAgICAgICAgIHZhciBhbGFybSA9IHNlc3Npb24uZGlhbG9nRGF0YS5hbGFybTtcbiAgICAgICAgICAgIGlmIChyZXN1bHRzLnJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgdmFyIHRpbWUgPSBidWlsZGVyLkVudGl0eVJlY29nbml6ZXIucmVzb2x2ZVRpbWUoW3Jlc3VsdHMucmVzcG9uc2VdKTtcbiAgICAgICAgICAgICAgICBhbGFybS50aW1lc3RhbXAgPSB0aW1lID8gdGltZS5nZXRUaW1lKCkgOiBudWxsO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gU2V0IHRoZSBhbGFybSAoaWYgdGl0bGUgb3IgdGltZXN0YW1wIGlzIGJsYW5rIHRoZSB1c2VyIHNhaWQgY2FuY2VsKVxuICAgICAgICAgICAgaWYgKGFsYXJtLnRpdGxlICYmIGFsYXJtLnRpbWVzdGFtcCkge1xuICAgICAgICAgICAgICAgIC8vIFNhdmUgYWRkcmVzcyBvZiB3aG8gdG8gbm90aWZ5IGFuZCB3cml0ZSB0byBzY2hlZHVsZXIuXG4gICAgICAgICAgICAgICAgYWxhcm0uYWRkcmVzcyA9IHNlc3Npb24ubWVzc2FnZS5hZGRyZXNzO1xuICAgICAgICAgICAgICAgIC8vYWxhcm1zW2FsYXJtLnRpdGxlXSA9IGFsYXJtO1xuICAgICAgICAgICAgICAgIC8vIFNlbmQgY29uZmlybWF0aW9uIHRvIHVzZXJcbiAgICAgICAgICAgICAgICB2YXIgZGF0ZSA9IG5ldyBEYXRlKGFsYXJtLnRpbWVzdGFtcCk7XG4gICAgICAgICAgICAgICAgdmFyIGlzQU0gPSBkYXRlLmdldEhvdXJzKCkgPCAxMjtcbiAgICAgICAgICAgICAgICBzZXNzaW9uLnNlbmQoJ0NyZWF0aW5nIGFsYXJtIG5hbWVkIFwiJXNcIiBmb3IgJWQvJWQvJWQgJWQ6JTAyZCVzJywgYWxhcm0udGl0bGUsIGRhdGUuZ2V0TW9udGgoKSArIDEsIGRhdGUuZ2V0RGF0ZSgpLCBkYXRlLmdldEZ1bGxZZWFyKCksIGlzQU0gPyBkYXRlLmdldEhvdXJzKCkgOiBkYXRlLmdldEhvdXJzKCkgLSAxMiwgZGF0ZS5nZXRNaW51dGVzKCksIGlzQU0gPyAnYW0nIDogJ3BtJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICBzZXNzaW9uLnNlbmQoJ09rLi4uIG5vIHByb2JsZW0uJyk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICBdKTtcbiAgICBkaWFsb2cub25EZWZhdWx0KGZ1bmN0aW9uIChzZXNzaW9uKSB7XG4gICAgICAgIGxvZ1F1ZXJ5KHNlc3Npb24sIFwib25EZWZhdWx0XCIpO1xuICAgICAgICB2YXIgZWxpemEgPSBnZXRFbGl6YUJvdChnZXRDb252ZXJzYXRpb25JZChzZXNzaW9uKSk7XG4gICAgICAgIHZhciByZXBseSA9IGVsaXphLnRyYW5zZm9ybShzZXNzaW9uLm1lc3NhZ2UudGV4dCk7XG4gICAgICAgIGRpYWxvZ2xvZyhcImVsaXphXCIsIHNlc3Npb24sIHNlbmQocmVwbHkpKTtcbiAgICAgICAgLy9uZXcgRWlsemFib3RcbiAgICAgICAgLy9zZXNzaW9uLnNlbmQoXCJJIGRvIG5vdCB1bmRlcnN0YW5kIHRoaXMgYXQgYWxsXCIpO1xuICAgICAgICAvL2J1aWxkZXIuRGlhbG9nQWN0aW9uLnNlbmQoJ0lcXCdtIHNvcnJ5IEkgZGlkblxcJ3QgdW5kZXJzdGFuZC4gSSBjYW4gb25seSBzaG93IHN0YXJ0IGFuZCByaW5nJyk7XG4gICAgfSk7XG4gICAgLypcbiAgICAvLyBWZXJ5IHNpbXBsZSBhbGFybSBzY2hlZHVsZXJcbiAgICB2YXIgYWxhcm1zID0ge307XG4gICAgc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIG5vdyA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICAgICAgZm9yICh2YXIga2V5IGluIGFsYXJtcykge1xuICAgICAgICB2YXIgYWxhcm0gPSBhbGFybXNba2V5XTtcbiAgICAgICAgaWYgKG5vdyA+PSBhbGFybS50aW1lc3RhbXApIHtcbiAgICAgICAgICB2YXIgbXNnID0gbmV3IGJ1aWxkZXIuTWVzc2FnZSgpXG4gICAgICAgICAgICAuYWRkcmVzcyhhbGFybS5hZGRyZXNzKVxuICAgICAgICAgICAgLnRleHQoJ0hlcmVcXCdzIHlvdXIgXFwnJXNcXCcgYWxhcm0uJywgYWxhcm0udGl0bGUpO1xuICAgICAgICAgIGJvdC5zZW5kKG1zZyk7XG4gICAgICAgICAgZGVsZXRlIGFsYXJtc1trZXldO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSwgMTUwMDApO1xuICAgICovXG59XG5pZiAobW9kdWxlKSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSB7XG4gICAgICAgIFNpbXBsZVVwRG93blJlY29nbml6ZXI6IFNpbXBsZVVwRG93blJlY29nbml6ZXIsXG4gICAgICAgIG1ha2VCb3Q6IG1ha2VCb3RcbiAgICB9O1xufVxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
