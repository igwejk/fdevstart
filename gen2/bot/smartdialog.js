/**
 * The bot implementation
 *
 * Instantiate apssing a connector via
 * makeBot
 *
 */
/**
 * @file
 * @module jfseb.fdevstart.smartdialog
 * @copyright (c) 2016 Gerd Forstmann
 */
//declare module 'elizabot' { };
"use strict";

var builder = require('botbuilder');
var debug = require('debug');
var Match = require('../match/match');
var Analyze = require('../match/analyze');
var WhatIs = require('../match/whatis');
var elizabot = require('../extern/elizabot/elizabot');
//import * as elizabot from 'elizabot';
var debuglog = debug('smartdialog');
var PlainRecognizer = require('./plainrecognizer');
//var builder = require('botbuilder');
var dispatcher = require('../match/dispatcher.js').dispatcher;
function getConversationId(session) {
    return session.message && session.message.address && session.message.address.conversation.id;
}
var elizabots = {};
function getElizaBot(id) {
    if (!elizabots[id]) {
        elizabots[id] = {
            access: new Date(),
            elizabot: new elizabot()
        };
    }
    elizabots[id].access = new Date();
    return elizabots[id].elizabot;
}
var newFlow = true;
var Model = require('../model/model');
var ExecServer = require('../exec/execserver');
var theModel = Model.loadModels();
if (newFlow) {} else {}
var SimpleRecognizer = function () {
    function SimpleRecognizer() {}
    SimpleRecognizer.prototype.recognize = function (context, callback) {
        var u = {};
        console.log("recognizing " + context.message.text);
        if (context.message.text.indexOf("start") >= 0) {
            u.intent = "ShowEntity";
            u.score = 0.9;
            var e1 = {};
            e1.startIndex = "start ".length;
            e1.endIndex = context.message.text.length;
            e1.score = 0.3;
            u.entities = [e1];
            callback(undefined, u);
            return;
        }
        if (context.message.text.indexOf("train") >= 0) {
            u.intent = "train";
            u.score = 0.9;
            var e1 = {};
            e1.startIndex = "train ".length;
            e1.endIndex = context.message.text.length;
            e1.score = 0.3;
            u.entities = [e1];
            callback(undefined, u);
            return;
        }
        if (context.message.text.indexOf("learn") >= 0) {
            u.intent = "learn";
            u.score = 0.9;
            var e1 = {};
            e1.type = "trainFact";
            e1.startIndex = "train ".length;
            e1.endIndex = context.message.text.length;
            e1.score = 0.3;
            u.entities = [e1];
            callback(undefined, u);
            return;
        }
        if (context.message.text.indexOf("help") >= 0) {
            u.intent = "help";
            u.score = 0.9;
            var e1 = {};
            e1.startIndex = "train ".length;
            e1.endIndex = context.message.text.length;
            e1.score = 0.3;
            u.entities = [e1];
            callback(undefined, u);
            return;
        }
        if (context.message.text.indexOf("exit") >= 0) {
            u.intent = "exit";
            u.score = 0.9;
            var e1 = {};
            e1.startIndex = "exit ".length;
            e1.endIndex = context.message.text.length;
            e1.score = 0.3;
            u.entities = [e1];
            callback(undefined, u);
            return;
        }
        if (context.message.text.indexOf("wrong") >= 0) {
            u.intent = "wrong";
            u.score = 0.9;
            var e1 = {};
            e1.startIndex = "exit ".length;
            e1.endIndex = context.message.text.length;
            e1.score = 0.3;
            u.entities = [e1];
            callback(undefined, u);
            return;
        }
        console.log('recognizing nothing');
        u.intent = "None";
        u.score = 0.1;
        var e1 = {};
        e1.startIndex = "exit ".length;
        e1.endIndex = context.message.text.length;
        e1.score = 0.1;
        u.entities = [];
        callback(undefined, u);
    };
    return SimpleRecognizer;
}();
var SimpleUpDownRecognizer = function () {
    function SimpleUpDownRecognizer() {}
    SimpleUpDownRecognizer.prototype.recognize = function (context, callback) {
        var u = {};
        console.log("recognizing " + context.message.text);
        if (context.message.text.indexOf("down") >= 0) {
            u.intent = "intent.down";
            u.score = 0.9;
            var e1 = {};
            e1.startIndex = "start ".length;
            e1.endIndex = context.message.text.length;
            e1.score = 0.3;
            u.entities = [e1];
            callback(undefined, u);
            return;
        }
        if (context.message.text.indexOf("up") >= 0) {
            u.intent = "intent.up";
            u.score = 0.9;
            var e1 = {};
            e1.startIndex = "up".length;
            e1.endIndex = context.message.text.length;
            e1.score = 0.3;
            u.entities = [e1];
            callback(undefined, u);
            return;
        }
        console.log('recognizing nothing');
        u.intent = "None";
        u.score = 0.1;
        var e1 = {};
        e1.startIndex = "exit ".length;
        e1.endIndex = context.message.text.length;
        e1.score = 0.1;
        u.entities = [];
        callback(undefined, u);
    };
    return SimpleUpDownRecognizer;
}();
var AnyObject = Object;
// globalTunnel.initialize({
//  host: 'proxy.exxxample.com',
//  port: 8080
// })
// Create bot and bind to console
// var connector = new htmlconnector.HTMLConnector()
// connector.setAnswerHook(function (sAnswer) {
//  console.log('Got answer : ' + sAnswer + '\n')
// })
var bot;
// setTimeout(function () {
//   connector.processMessage('start unit test ABC ')
// }, 5000)
var fs = require('fs');
var oJSON = JSON.parse('' + fs.readFileSync('./resources/model/intents.json'));
var oRules = PlainRecognizer.parseRules(oJSON);
// var Recognizer = new (recognizer.RegExpRecognizer)(oRules);
function logQuery(session, intent, result) {
    fs.appendFile('./logs/showmequeries.txt', "\n" + JSON.stringify({
        text: session.message.text,
        timestamp: session.message.timestamp,
        intent: intent,
        res: result && result.length && Match.ToolMatch.dumpNice(result[0]) || "0",
        conversationId: session.message.address && session.message.address.conversation && session.message.address.conversation.id || "",
        userid: session.message.address && session.message.address.user && session.message.address.user.id || ""
    }), function (err, res) {
        if (err) {
            debuglog("logging failed " + err);
        }
    });
}
function logQueryWhatIs(session, intent, result) {
    fs.appendFile('./logs/showmequeries.txt', "\n" + JSON.stringify({
        text: session.message.text,
        timestamp: session.message.timestamp,
        intent: intent,
        res: result && result.length && WhatIs.dumpNice(result[0]) || "0",
        conversationId: session.message.address && session.message.address.conversation && session.message.address.conversation.id || "",
        userid: session.message.address && session.message.address.user && session.message.address.user.id || ""
    }), function (err, res) {
        if (err) {
            debuglog("logging failed " + err);
        }
    });
}
var gwords = {};
/**
 * Construct a bot
 * @param connector {Connector} the connector to use
 * HTMLConnector
 * or connector = new builder.ConsoleConnector().listen()
 */
function makeBot(connector) {
    bot = new builder.UniversalBot(connector);
    // Create LUIS recognizer that points at our model and add it as the root '/' dialog for our Cortana Bot.
    // var model = sensitive.modelurl;
    // var model = 'https://api.projectoxford.ai/luis/v2.0/apps/c413b2ef-382c-45bd-8ff0-f76d60e2a821?subscription-key=c21398b5980a4ce09f474bbfee93b892&q='
    var recognizer = new PlainRecognizer.RegExpRecognizer(oRules);
    var dialog = new builder.IntentDialog({ recognizers: [recognizer] });
    // dialog.onBegin(function(session,args) {
    // console.log("beginning ...")
    // session.dialogData.retryPrompt = args && args.retryPrompt || "I am sorry"
    // session.send("What do you want?")
    //
    // })
    var dialogUpDown = new builder.IntentDialog({ recognizers: [new SimpleUpDownRecognizer()] });
    bot.dialog('/updown', dialogUpDown);
    dialogUpDown.onBegin(function (session) {
        session.send("Hi there, updown is waiting for you");
    });
    dialogUpDown.matches('intent.up', [function (session, args, next) {
        session.dialogData.abc = args || {};
        builder.Prompts.text(session, 'you want to go up');
    }, function (session, results, next) {
        session.dialogData.abc = results.reponse;
        next();
    }, function (session, results) {
        session.endDialogWithResult({ response: session.dialogData.abc });
    }]);
    dialogUpDown.matches('intent.down', [function (session, args, next) {
        session.dialogData.abc = args || {};
        builder.Prompts.text(session, 'you want to go down!');
    }, function (session, results, next) {
        session.dialogData.abc = -1; // results.reponse;
        next();
    }, function (session, results) {
        session.send("still going down?");
    }]);
    dialogUpDown.onDefault(function (session) {
        logQuery(session, "onDefault");
        session.send("You are trapped in a dialog which only understands up and down, one of them will get you out");
        //builder.DialogAction.send('I\'m sorry I didn\'t understand. I can only show start and ring');
    });
    bot.dialog('/train', [function (session, args, next) {
        session.dialgoData.abc = args || {};
        builder.Prompts.text(session, 'Do you want to train me');
    }, function (session, results, next) {
        session.dialogData.abc = results.reponse;
    }, function (session, results) {
        session.endDialogWithResult({ response: session.DialogData.abc });
    }]);
    bot.dialog('/', dialog);
    dialog.matches('ShowMe', [function (session, args, next) {
        var isCombinedIndex = {};
        var oNewEntity;
        // expecting entity A1
        debuglog("Show Entity");
        console.log('raw: ' + JSON.stringify(args.entities), undefined, 2);
        var a1 = builder.EntityRecognizer.findEntity(args.entities, 'A1');
        var result = Analyze.analyzeAll(a1.entity, theModel.mRules, theModel.tools, gwords);
        logQuery(session, 'ShowMe', result);
        // test.expect(3)
        //  test.deepEqual(result.weight, 120, 'correct weight');
        if (!result || result.length === 0) {
            next();
        }
        // debuglog('result : ' + JSON.stringify(result, undefined, 2));
        debuglog('best result : ' + JSON.stringify(result[0] || {}, undefined, 2));
        debuglog('top : ' + Match.ToolMatch.dumpWeightsTop(result, { top: 3 }));
        if (Analyze.isComplete(result[0])) {
            session.dialogData.result = result[0];
            //    session.send('Showing entity ...');
            next();
        } else if (Analyze.getPrompt(result[0])) {
            var prompt = Analyze.getPrompt(result[0]);
            session.dialogData.result = result[0];
            session.dialogData.prompt = prompt;
            session.send("Not enough information supplied: " + Match.ToolMatch.dumpNice(session.dialogData.result));
            builder.Prompts.text(session, prompt.text);
        } else {
            var best = result.length ? Match.ToolMatch.dumpNice(result[0]) : "<nothing>";
            //session.send('I did not understand this' + best);
            var reply = new builder.Message(session).text('I did not understand this' + best).addEntity({ url: "I don't know" });
            // .addAttachment({ fallbackText: "I don't know", contentType: 'image/jpeg', contentUrl: "www.wombat.org" });
            session.send(reply);
        }
    }, function (session, results, next) {
        var result = session.dialogData.result;
        if (!result || result.length === 0) {
            next();
        }
        if (results.response) {
            // some prompting
            Analyze.setPrompt(session.dialogData.result, session.dialogData.prompt, results.response);
        }
        if (Analyze.isComplete(session.dialogData.result)) {
            next();
        } else if (Analyze.getPrompt(session.dialogData.result)) {
            var prompt = Analyze.getPrompt(session.dialogData.result);
            session.dialogData.prompt = prompt;
            builder.Prompts.text(session, prompt.text);
        }
    }, function (session, results, next) {
        var result = session.dialogData.result;
        if (results.response) {
            // some prompting
            Analyze.setPrompt(session.dialogData.result, session.dialogData.prompt, results.response);
        }
        if (Analyze.isComplete(session.dialogData.result)) {
            var exec = ExecServer.execTool(session.dialogData.result, theModel.records);
            var reply = new builder.Message(session).text(exec.text).addEntity(exec.action);
            // .addAttachment({ fallbackText: "I don't know", contentType: 'image/jpeg', contentUrl: "www.wombat.org" });
            session.send(reply);
        } else {
            if (session.dialogData.result) {
                session.send("Not enough information supplied: " + Match.ToolMatch.dumpNice(session.dialogData.result));
            } else {
                session.send("I did not get what you want");
            }
        }
    }]);
    dialog.matches('WhatIs', [function (session, args, next) {
        var isCombinedIndex = {};
        var oNewEntity;
        // expecting entity A1
        var message = session.message.text;
        debuglog("WhatIs Entity");
        console.log('raw: ' + JSON.stringify(args.entities), undefined, 2);
        var categoryEntity = builder.EntityRecognizer.findEntity(args.entities, 'category');
        var category = categoryEntity.entity;
        var a1 = builder.EntityRecognizer.findEntity(args.entities, 'A1');
        var cat = WhatIs.analyzeCategory(category, theModel.mRules, message);
        if (!cat) {
            session.send('I don\'t know anything about "' + category + '"');
            next();
        }
        var result = WhatIs.resolveCategory(cat, a1.entity, theModel.mRules, theModel.records);
        logQueryWhatIs(session, 'WhatIs', result);
        var indis = WhatIs.isIndiscriminateResult(result);
        if (indis) {
            session.send(indis);
            next();
            return;
        }
        if (!result || result.length === 0) {
            session.send('I don\'t know anything about "' + cat + " (" + category + ')\" in relation to "' + a1.entity + '"');
            next();
            return;
        } else {
            // debuglog('result : ' + JSON.stringify(result, undefined, 2));
            debuglog('best result : ' + JSON.stringify(result[0] || {}, undefined, 2));
            debuglog('top : ' + WhatIs.dumpWeightsTop(result, { top: 3 }));
            // TODO cleansed sentence
            session.send('The ' + category + ' of ' + a1.entity + ' is ' + result[0].result + "\n"); //  + JSON.stringify(result[0]));
        }
    }]);
    dialog.matches('Wrong', [function (session, args, next) {
        session.beginDialog('/updown', session.userData.count);
    }, function (session, results, next) {
        var alarm = session.dialogData.alarm;
        session.send("back from wrong : " + JSON.stringify(results));
        next();
    }, function (session, results) {
        session.send('end of wrong');
    }]);
    dialog.matches('Exit', [function (session, args, next) {
        console.log('exit :');
        console.log('exit' + JSON.stringify(args.entities));
        session.send("you are in a logic loop ");
    }]);
    dialog.matches('Help', [function (session, args, next) {
        console.log('help :');
        console.log('help');
        session.send("I know about .... <categories>>");
    }]);
    // Add intent handlers
    dialog.matches('train', [function (session, args, next) {
        console.log('train');
        // Resolve and store any entities passed from LUIS.
        var title = builder.EntityRecognizer.findEntity(args.entities, 'builtin.alarm.title');
        var time = builder.EntityRecognizer.resolveTime(args.entities);
        var alarm = session.dialogData.alarm = {
            title: title ? title.entity : null,
            timestamp: time ? time.getTime() : null
        };
        // Prompt for title
        if (!alarm.title) {
            builder.Prompts.text(session, 'What fact would you like to train?');
        } else {
            next();
        }
    }, function (session, results, next) {
        var alarm = session.dialogData.alarm;
        if (results.response) {
            alarm.title = results.response;
        }
        // Prompt for time (title will be blank if the user said cancel)
        if (alarm.title && !alarm.timestamp) {
            builder.Prompts.time(session, 'What time would you like to set the alarm for?');
        } else {
            next();
        }
    }, function (session, results) {
        var alarm = session.dialogData.alarm;
        if (results.response) {
            var time = builder.EntityRecognizer.resolveTime([results.response]);
            alarm.timestamp = time ? time.getTime() : null;
        }
        // Set the alarm (if title or timestamp is blank the user said cancel)
        if (alarm.title && alarm.timestamp) {
            // Save address of who to notify and write to scheduler.
            alarm.address = session.message.address;
            //alarms[alarm.title] = alarm;
            // Send confirmation to user
            var date = new Date(alarm.timestamp);
            var isAM = date.getHours() < 12;
            session.send('Creating alarm named "%s" for %d/%d/%d %d:%02d%s', alarm.title, date.getMonth() + 1, date.getDate(), date.getFullYear(), isAM ? date.getHours() : date.getHours() - 12, date.getMinutes(), isAM ? 'am' : 'pm');
        } else {
            session.send('Ok... no problem.');
        }
    }]);
    dialog.onDefault(function (session) {
        logQuery(session, "onDefault");
        var eliza = getElizaBot(getConversationId(session));
        var reply = eliza.transform(session.message.text);
        session.send(reply);
        //new Eilzabot
        //session.send("I do not understand this at all");
        //builder.DialogAction.send('I\'m sorry I didn\'t understand. I can only show start and ring');
    });
    /*
    // Very simple alarm scheduler
    var alarms = {};
    setInterval(function () {
      var now = new Date().getTime();
      for (var key in alarms) {
        var alarm = alarms[key];
        if (now >= alarm.timestamp) {
          var msg = new builder.Message()
            .address(alarm.address)
            .text('Here\'s your \'%s\' alarm.', alarm.title);
          bot.send(msg);
          delete alarms[key];
        }
      }
    }, 15000);
    */
}
if (module) {
    module.exports = {
        makeBot: makeBot
    };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9ib3Qvc21hcnRkaWFsb2cudHMiLCJib3Qvc21hcnRkaWFsb2cuanMiXSwibmFtZXMiOlsiYnVpbGRlciIsInJlcXVpcmUiLCJkZWJ1ZyIsIk1hdGNoIiwiQW5hbHl6ZSIsIldoYXRJcyIsImVsaXphYm90IiwiZGVidWdsb2ciLCJQbGFpblJlY29nbml6ZXIiLCJkaXNwYXRjaGVyIiwiZ2V0Q29udmVyc2F0aW9uSWQiLCJzZXNzaW9uIiwibWVzc2FnZSIsImFkZHJlc3MiLCJjb252ZXJzYXRpb24iLCJpZCIsImVsaXphYm90cyIsImdldEVsaXphQm90IiwiYWNjZXNzIiwiRGF0ZSIsIm5ld0Zsb3ciLCJNb2RlbCIsIkV4ZWNTZXJ2ZXIiLCJ0aGVNb2RlbCIsImxvYWRNb2RlbHMiLCJTaW1wbGVSZWNvZ25pemVyIiwicHJvdG90eXBlIiwicmVjb2duaXplIiwiY29udGV4dCIsImNhbGxiYWNrIiwidSIsImNvbnNvbGUiLCJsb2ciLCJ0ZXh0IiwiaW5kZXhPZiIsImludGVudCIsInNjb3JlIiwiZTEiLCJzdGFydEluZGV4IiwibGVuZ3RoIiwiZW5kSW5kZXgiLCJlbnRpdGllcyIsInVuZGVmaW5lZCIsInR5cGUiLCJTaW1wbGVVcERvd25SZWNvZ25pemVyIiwiQW55T2JqZWN0IiwiT2JqZWN0IiwiYm90IiwiZnMiLCJvSlNPTiIsIkpTT04iLCJwYXJzZSIsInJlYWRGaWxlU3luYyIsIm9SdWxlcyIsInBhcnNlUnVsZXMiLCJsb2dRdWVyeSIsInJlc3VsdCIsImFwcGVuZEZpbGUiLCJzdHJpbmdpZnkiLCJ0aW1lc3RhbXAiLCJyZXMiLCJUb29sTWF0Y2giLCJkdW1wTmljZSIsImNvbnZlcnNhdGlvbklkIiwidXNlcmlkIiwidXNlciIsImVyciIsImxvZ1F1ZXJ5V2hhdElzIiwiZ3dvcmRzIiwibWFrZUJvdCIsImNvbm5lY3RvciIsIlVuaXZlcnNhbEJvdCIsInJlY29nbml6ZXIiLCJSZWdFeHBSZWNvZ25pemVyIiwiZGlhbG9nIiwiSW50ZW50RGlhbG9nIiwicmVjb2duaXplcnMiLCJkaWFsb2dVcERvd24iLCJvbkJlZ2luIiwic2VuZCIsIm1hdGNoZXMiLCJhcmdzIiwibmV4dCIsImRpYWxvZ0RhdGEiLCJhYmMiLCJQcm9tcHRzIiwicmVzdWx0cyIsInJlcG9uc2UiLCJlbmREaWFsb2dXaXRoUmVzdWx0IiwicmVzcG9uc2UiLCJvbkRlZmF1bHQiLCJkaWFsZ29EYXRhIiwiRGlhbG9nRGF0YSIsImlzQ29tYmluZWRJbmRleCIsIm9OZXdFbnRpdHkiLCJhMSIsIkVudGl0eVJlY29nbml6ZXIiLCJmaW5kRW50aXR5IiwiYW5hbHl6ZUFsbCIsImVudGl0eSIsIm1SdWxlcyIsInRvb2xzIiwiZHVtcFdlaWdodHNUb3AiLCJ0b3AiLCJpc0NvbXBsZXRlIiwiZ2V0UHJvbXB0IiwicHJvbXB0IiwiYmVzdCIsInJlcGx5IiwiTWVzc2FnZSIsImFkZEVudGl0eSIsInVybCIsInNldFByb21wdCIsImV4ZWMiLCJleGVjVG9vbCIsInJlY29yZHMiLCJhY3Rpb24iLCJjYXRlZ29yeUVudGl0eSIsImNhdGVnb3J5IiwiY2F0IiwiYW5hbHl6ZUNhdGVnb3J5IiwicmVzb2x2ZUNhdGVnb3J5IiwiaW5kaXMiLCJpc0luZGlzY3JpbWluYXRlUmVzdWx0IiwiYmVnaW5EaWFsb2ciLCJ1c2VyRGF0YSIsImNvdW50IiwiYWxhcm0iLCJ0aXRsZSIsInRpbWUiLCJyZXNvbHZlVGltZSIsImdldFRpbWUiLCJkYXRlIiwiaXNBTSIsImdldEhvdXJzIiwiZ2V0TW9udGgiLCJnZXREYXRlIiwiZ2V0RnVsbFllYXIiLCJnZXRNaW51dGVzIiwiZWxpemEiLCJ0cmFuc2Zvcm0iLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7OztBQU9BOzs7OztBQUtBO0FDQ0E7O0FEQ0EsSUFBWUEsVUFBT0MsUUFBTSxZQUFOLENBQW5CO0FBRUEsSUFBWUMsUUFBS0QsUUFBTSxPQUFOLENBQWpCO0FBR0EsSUFBWUUsUUFBS0YsUUFBTSxnQkFBTixDQUFqQjtBQUVBLElBQVlH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QUNFZ0QsTUFBTUMsS0FEUixFQUVFSSxLQUFLRyxRQUFMLEtBQWtCLENBRnBCLEVBRXVCSCxLQUFLSSxPQUFMLEVBRnZCLEVBRXVDSixLQUFLSyxXQUFMLEVBRnZDLEVBR0VKLE9BQU9ELEtBQUtFLFFBQUwsRUFBUCxHQUF5QkYsS0FBS0UsUUFBTCxLQUFrQixFQUg3QyxFQUdpREYsS0FBS00sVUFBTCxFQUhqRCxFQUdvRUwsT0FBTyxJQUFQLEdBQWMsSUFIbEY7QUFJRCxTQVpELE1BWU87QUFDTDFILG9CQUFRb0UsSUFBUixDQUFhLG1CQUFiO0FBQ0Q7QUFDRixLQXBEcUIsQ0FBeEI7QUF1REFMLFdBQU9nQixTQUFQLENBQWlCLFVBQVUvRSxPQUFWLEVBQWlCO0FBQ2hDNEMsaUJBQVM1QyxPQUFULEVBQWtCLFdBQWxCO0FBQ0EsWUFBSWdJLFFBQVExSCxZQUFZUCxrQkFBa0JDLE9BQWxCLENBQVosQ0FBWjtBQUNBLFlBQUlpRyxRQUFRK0IsTUFBTUMsU0FBTixDQUFnQmpJLFFBQVFDLE9BQVIsQ0FBZ0JxQixJQUFoQyxDQUFaO0FBQ0F0QixnQkFBUW9FLElBQVIsQ0FBYTZCLEtBQWI7QUFDQTtBQUNBO0FBQ0E7QUFDRCxLQVJEO0FBVUE7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBaUJEO0FBRUQsSUFBSWlDLE1BQUosRUFBWTtBQUNWQSxXQUFPQyxPQUFQLEdBQWlCO0FBQ2Z6RSxpQkFBU0E7QUFETSxLQUFqQjtBQUdEIiwiZmlsZSI6ImJvdC9zbWFydGRpYWxvZy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogVGhlIGJvdCBpbXBsZW1lbnRhdGlvblxuICpcbiAqIEluc3RhbnRpYXRlIGFwc3NpbmcgYSBjb25uZWN0b3IgdmlhXG4gKiBtYWtlQm90XG4gKlxuICovXG4vKipcbiAqIEBmaWxlXG4gKiBAbW9kdWxlIGpmc2ViLmZkZXZzdGFydC5zbWFydGRpYWxvZ1xuICogQGNvcHlyaWdodCAoYykgMjAxNiBHZXJkIEZvcnN0bWFublxuICovXG4vL2RlY2xhcmUgbW9kdWxlICdlbGl6YWJvdCcgeyB9O1xuXG5pbXBvcnQgKiBhcyBidWlsZGVyIGZyb20gJ2JvdGJ1aWxkZXInO1xuXG5pbXBvcnQgKiBhcyBkZWJ1ZyBmcm9tICdkZWJ1Zyc7XG5cbmltcG9ydCAqIGFzIEV4ZWMgZnJvbSAnLi4vZXhlYy9leGVjJztcbmltcG9ydCAqIGFzIE1hdGNoIGZyb20gJy4uL21hdGNoL21hdGNoJztcblxuaW1wb3J0ICogYXMgQW5hbHl6ZSBmcm9tICcuLi9tYXRjaC9hbmFseXplJztcblxuaW1wb3J0ICogYXMgV2hhdElzIGZyb20gJy4uL21hdGNoL3doYXRpcyc7XG5cbnZhciBlbGl6YWJvdCA9IHJlcXVpcmUoJy4uL2V4dGVybi9lbGl6YWJvdC9lbGl6YWJvdCcpO1xuLy9pbXBvcnQgKiBhcyBlbGl6YWJvdCBmcm9tICdlbGl6YWJvdCc7XG5cbmxldCBkZWJ1Z2xvZyA9IGRlYnVnKCdzbWFydGRpYWxvZycpO1xuaW1wb3J0ICogYXMgUGxhaW5SZWNvZ25pemVyIGZyb20gJy4vcGxhaW5yZWNvZ25pemVyJztcbi8vdmFyIGJ1aWxkZXIgPSByZXF1aXJlKCdib3RidWlsZGVyJyk7XG5cbnZhciBkaXNwYXRjaGVyID0gcmVxdWlyZSgnLi4vbWF0Y2gvZGlzcGF0Y2hlci5qcycpLmRpc3BhdGNoZXI7XG5cblxuZnVuY3Rpb24gZ2V0Q29udmVyc2F0aW9uSWQoc2Vzc2lvbjogYnVpbGRlci5TZXNzaW9uKTogc3RyaW5nIHtcbiAgcmV0dXJuIHNlc3Npb24ubWVzc2FnZSAmJlxuICAgIHNlc3Npb24ubWVzc2FnZS5hZGRyZXNzICYmXG4gICAgc2Vzc2lvbi5tZXNzYWdlLmFkZHJlc3MuY29udmVyc2F0aW9uLmlkO1xufVxuXG52YXIgZWxpemFib3RzID0ge307XG5cbmZ1bmN0aW9uIGdldEVsaXphQm90KGlkOiBzdHJpbmcpIHtcbiAgaWYgKCFlbGl6YWJvdHNbaWRdKSB7XG4gICAgZWxpemFib3RzW2lkXSA9IHtcbiAgICAgIGFjY2VzczogbmV3IERhdGUoKSxcbiAgICAgIGVsaXphYm90OiBuZXcgZWxpemFib3QoKVxuICAgIH07XG4gIH1cbiAgZWxpemFib3RzW2lkXS5hY2Nlc3MgPSBuZXcgRGF0ZSgpO1xuICByZXR1cm4gZWxpemFib3RzW2lkXS5lbGl6YWJvdDtcbn1cblxuaW1wb3J0ICogYXMgSU1hdGNoIGZyb20gJy4uL21hdGNoL2lmbWF0Y2gnO1xuaW1wb3J0ICogYXMgVG9vbHMgZnJvbSAnLi4vbWF0Y2gvdG9vbHMnO1xuXG52YXIgbmV3RmxvdyA9IHRydWU7XG5cbmltcG9ydCAqIGFzIE1vZGVsIGZyb20gJy4uL21vZGVsL21vZGVsJztcbmltcG9ydCAqIGFzIEV4ZWNTZXJ2ZXIgZnJvbSAnLi4vZXhlYy9leGVjc2VydmVyJztcblxuY29uc3QgdGhlTW9kZWwgPSBNb2RlbC5sb2FkTW9kZWxzKCk7XG5pZiAobmV3Rmxvdykge1xuXG59IGVsc2Uge1xuXG4gIC8vY29uc3QgdG9vbHMgPSBUb29scy5nZXRUb29scygpO1xuICAvL2NvbnN0IElucHV0RmlsdGVyUnVsZXMgPSByZXF1aXJlKCcuLi9tYXRjaC9pbnB1dEZpbHRlclJ1bGVzLmpzJyk7XG4gIC8vY29uc3QgbVJ1bGVzID0gSW5wdXRGaWx0ZXJSdWxlcy5nZXRNUnVsZXNTYW1wbGUoKTtcbn1cblxuXG5cbmNsYXNzIFNpbXBsZVJlY29nbml6ZXIgaW1wbGVtZW50cyBidWlsZGVyLklJbnRlbnRSZWNvZ25pemVyIHtcbiAgY29uc3RydWN0b3IoKSB7XG5cbiAgfVxuXG4gIHJlY29nbml6ZShjb250ZXh0OiBidWlsZGVyLklSZWNvZ25pemVDb250ZXh0LCBjYWxsYmFjazogKGVycjogRXJyb3IsIHJlc3VsdDogYnVpbGRlci5JSW50ZW50UmVjb2duaXplclJlc3VsdCkgPT4gdm9pZCk6IHZvaWQge1xuICAgIHZhciB1ID0ge30gYXMgYnVpbGRlci5JSW50ZW50UmVjb2duaXplclJlc3VsdDtcblxuICAgIGNvbnNvbGUubG9nKFwicmVjb2duaXppbmcgXCIgKyBjb250ZXh0Lm1lc3NhZ2UudGV4dCk7XG4gICAgaWYgKGNvbnRleHQubWVzc2FnZS50ZXh0LmluZGV4T2YoXCJzdGFydFwiKSA+PSAwKSB7XG4gICAgICB1LmludGVudCA9IFwiU2hvd0VudGl0eVwiO1xuICAgICAgdS5zY29yZSA9IDAuOTtcbiAgICAgIHZhciBlMSA9IHt9IGFzIGJ1aWxkZXIuSUVudGl0eTtcbiAgICAgIGUxLnN0YXJ0SW5kZXggPSBcInN0YXJ0IFwiLmxlbmd0aDtcbiAgICAgIGUxLmVuZEluZGV4ID0gY29udGV4dC5tZXNzYWdlLnRleHQubGVuZ3RoO1xuICAgICAgZTEuc2NvcmUgPSAwLjM7XG4gICAgICB1LmVudGl0aWVzID0gW2UxXTtcbiAgICAgIGNhbGxiYWNrKHVuZGVmaW5lZCwgdSk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKGNvbnRleHQubWVzc2FnZS50ZXh0LmluZGV4T2YoXCJ0cmFpblwiKSA+PSAwKSB7XG4gICAgICB1LmludGVudCA9IFwidHJhaW5cIjtcbiAgICAgIHUuc2NvcmUgPSAwLjk7XG4gICAgICB2YXIgZTEgPSB7fSBhcyBidWlsZGVyLklFbnRpdHk7XG4gICAgICBlMS5zdGFydEluZGV4ID0gXCJ0cmFpbiBcIi5sZW5ndGg7XG4gICAgICBlMS5lbmRJbmRleCA9IGNvbnRleHQubWVzc2FnZS50ZXh0Lmxlbmd0aDtcbiAgICAgIGUxLnNjb3JlID0gMC4zO1xuICAgICAgdS5lbnRpdGllcyA9IFtlMV07XG4gICAgICBjYWxsYmFjayh1bmRlZmluZWQsIHUpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoY29udGV4dC5tZXNzYWdlLnRleHQuaW5kZXhPZihcImxlYXJuXCIpID49IDApIHtcbiAgICAgIHUuaW50ZW50ID0gXCJsZWFyblwiO1xuICAgICAgdS5zY29yZSA9IDAuOTtcbiAgICAgIHZhciBlMSA9IHt9IGFzIGJ1aWxkZXIuSUVudGl0eTtcbiAgICAgIGUxLnR5cGUgPSBcInRyYWluRmFjdFwiO1xuICAgICAgZTEuc3RhcnRJbmRleCA9IFwidHJhaW4gXCIubGVuZ3RoO1xuICAgICAgZTEuZW5kSW5kZXggPSBjb250ZXh0Lm1lc3NhZ2UudGV4dC5sZW5ndGg7XG4gICAgICBlMS5zY29yZSA9IDAuMztcbiAgICAgIHUuZW50aXRpZXMgPSBbZTFdO1xuICAgICAgY2FsbGJhY2sodW5kZWZpbmVkLCB1KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGNvbnRleHQubWVzc2FnZS50ZXh0LmluZGV4T2YoXCJoZWxwXCIpID49IDApIHtcbiAgICAgIHUuaW50ZW50ID0gXCJoZWxwXCI7XG4gICAgICB1LnNjb3JlID0gMC45O1xuICAgICAgdmFyIGUxID0ge30gYXMgYnVpbGRlci5JRW50aXR5O1xuICAgICAgZTEuc3RhcnRJbmRleCA9IFwidHJhaW4gXCIubGVuZ3RoO1xuICAgICAgZTEuZW5kSW5kZXggPSBjb250ZXh0Lm1lc3NhZ2UudGV4dC5sZW5ndGg7XG4gICAgICBlMS5zY29yZSA9IDAuMztcbiAgICAgIHUuZW50aXRpZXMgPSBbZTFdO1xuICAgICAgY2FsbGJhY2sodW5kZWZpbmVkLCB1KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGNvbnRleHQubWVzc2FnZS50ZXh0LmluZGV4T2YoXCJleGl0XCIpID49IDApIHtcbiAgICAgIHUuaW50ZW50ID0gXCJleGl0XCI7XG4gICAgICB1LnNjb3JlID0gMC45O1xuICAgICAgdmFyIGUxID0ge30gYXMgYnVpbGRlci5JRW50aXR5O1xuICAgICAgZTEuc3RhcnRJbmRleCA9IFwiZXhpdCBcIi5sZW5ndGg7XG4gICAgICBlMS5lbmRJbmRleCA9IGNvbnRleHQubWVzc2FnZS50ZXh0Lmxlbmd0aDtcbiAgICAgIGUxLnNjb3JlID0gMC4zO1xuICAgICAgdS5lbnRpdGllcyA9IFtlMV07XG4gICAgICBjYWxsYmFjayh1bmRlZmluZWQsIHUpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBpZiAoY29udGV4dC5tZXNzYWdlLnRleHQuaW5kZXhPZihcIndyb25nXCIpID49IDApIHtcbiAgICAgIHUuaW50ZW50ID0gXCJ3cm9uZ1wiO1xuICAgICAgdS5zY29yZSA9IDAuOTtcbiAgICAgIHZhciBlMSA9IHt9IGFzIGJ1aWxkZXIuSUVudGl0eTtcbiAgICAgIGUxLnN0YXJ0SW5kZXggPSBcImV4aXQgXCIubGVuZ3RoO1xuICAgICAgZTEuZW5kSW5kZXggPSBjb250ZXh0Lm1lc3NhZ2UudGV4dC5sZW5ndGg7XG4gICAgICBlMS5zY29yZSA9IDAuMztcbiAgICAgIHUuZW50aXRpZXMgPSBbZTFdO1xuICAgICAgY2FsbGJhY2sodW5kZWZpbmVkLCB1KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgY29uc29sZS5sb2coJ3JlY29nbml6aW5nIG5vdGhpbmcnKTtcbiAgICB1LmludGVudCA9IFwiTm9uZVwiO1xuICAgIHUuc2NvcmUgPSAwLjE7XG4gICAgdmFyIGUxID0ge30gYXMgYnVpbGRlci5JRW50aXR5O1xuICAgIGUxLnN0YXJ0SW5kZXggPSBcImV4aXQgXCIubGVuZ3RoO1xuICAgIGUxLmVuZEluZGV4ID0gY29udGV4dC5tZXNzYWdlLnRleHQubGVuZ3RoO1xuICAgIGUxLnNjb3JlID0gMC4xO1xuICAgIHUuZW50aXRpZXMgPSBbXTtcbiAgICBjYWxsYmFjayh1bmRlZmluZWQsIHUpO1xuICB9XG59XG5cblxuY2xhc3MgU2ltcGxlVXBEb3duUmVjb2duaXplciBpbXBsZW1lbnRzIGJ1aWxkZXIuSUludGVudFJlY29nbml6ZXIge1xuICBjb25zdHJ1Y3RvcigpIHtcblxuICB9XG5cbiAgcmVjb2duaXplKGNvbnRleHQ6IGJ1aWxkZXIuSVJlY29nbml6ZUNvbnRleHQsIGNhbGxiYWNrOiAoZXJyOiBFcnJvciwgcmVzdWx0OiBidWlsZGVyLklJbnRlbnRSZWNvZ25pemVyUmVzdWx0KSA9PiB2b2lkKTogdm9pZCB7XG4gICAgdmFyIHUgPSB7fSBhcyBidWlsZGVyLklJbnRlbnRSZWNvZ25pemVyUmVzdWx0O1xuXG4gICAgY29uc29sZS5sb2coXCJyZWNvZ25pemluZyBcIiArIGNvbnRleHQubWVzc2FnZS50ZXh0KTtcbiAgICBpZiAoY29udGV4dC5tZXNzYWdlLnRleHQuaW5kZXhPZihcImRvd25cIikgPj0gMCkge1xuICAgICAgdS5pbnRlbnQgPSBcImludGVudC5kb3duXCI7XG4gICAgICB1LnNjb3JlID0gMC45O1xuICAgICAgdmFyIGUxID0ge30gYXMgYnVpbGRlci5JRW50aXR5O1xuICAgICAgZTEuc3RhcnRJbmRleCA9IFwic3RhcnQgXCIubGVuZ3RoO1xuICAgICAgZTEuZW5kSW5kZXggPSBjb250ZXh0Lm1lc3NhZ2UudGV4dC5sZW5ndGg7XG4gICAgICBlMS5zY29yZSA9IDAuMztcbiAgICAgIHUuZW50aXRpZXMgPSBbZTFdO1xuICAgICAgY2FsbGJhY2sodW5kZWZpbmVkLCB1KTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgaWYgKGNvbnRleHQubWVzc2FnZS50ZXh0LmluZGV4T2YoXCJ1cFwiKSA+PSAwKSB7XG4gICAgICB1LmludGVudCA9IFwiaW50ZW50LnVwXCI7XG4gICAgICB1LnNjb3JlID0gMC45O1xuICAgICAgdmFyIGUxID0ge30gYXMgYnVpbGRlci5JRW50aXR5O1xuICAgICAgZTEuc3RhcnRJbmRleCA9IFwidXBcIi5sZW5ndGg7XG4gICAgICBlMS5lbmRJbmRleCA9IGNvbnRleHQubWVzc2FnZS50ZXh0Lmxlbmd0aDtcbiAgICAgIGUxLnNjb3JlID0gMC4zO1xuICAgICAgdS5lbnRpdGllcyA9IFtlMV07XG4gICAgICBjYWxsYmFjayh1bmRlZmluZWQsIHUpO1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zb2xlLmxvZygncmVjb2duaXppbmcgbm90aGluZycpO1xuICAgIHUuaW50ZW50ID0gXCJOb25lXCI7XG4gICAgdS5zY29yZSA9IDAuMTtcbiAgICB2YXIgZTEgPSB7fSBhcyBidWlsZGVyLklFbnRpdHk7XG4gICAgZTEuc3RhcnRJbmRleCA9IFwiZXhpdCBcIi5sZW5ndGg7XG4gICAgZTEuZW5kSW5kZXggPSBjb250ZXh0Lm1lc3NhZ2UudGV4dC5sZW5ndGg7XG4gICAgZTEuc2NvcmUgPSAwLjE7XG4gICAgdS5lbnRpdGllcyA9IFtdO1xuICAgIGNhbGxiYWNrKHVuZGVmaW5lZCwgdSk7XG4gIH1cbn1cblxuY29uc3QgQW55T2JqZWN0ID0gT2JqZWN0IGFzIGFueTtcbi8vIGdsb2JhbFR1bm5lbC5pbml0aWFsaXplKHtcbi8vICBob3N0OiAncHJveHkuZXh4eGFtcGxlLmNvbScsXG4vLyAgcG9ydDogODA4MFxuLy8gfSlcblxuLy8gQ3JlYXRlIGJvdCBhbmQgYmluZCB0byBjb25zb2xlXG4vLyB2YXIgY29ubmVjdG9yID0gbmV3IGh0bWxjb25uZWN0b3IuSFRNTENvbm5lY3RvcigpXG5cbi8vIGNvbm5lY3Rvci5zZXRBbnN3ZXJIb29rKGZ1bmN0aW9uIChzQW5zd2VyKSB7XG4vLyAgY29uc29sZS5sb2coJ0dvdCBhbnN3ZXIgOiAnICsgc0Fuc3dlciArICdcXG4nKVxuLy8gfSlcblxudmFyIGJvdDtcbi8vIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuLy8gICBjb25uZWN0b3IucHJvY2Vzc01lc3NhZ2UoJ3N0YXJ0IHVuaXQgdGVzdCBBQkMgJylcbi8vIH0sIDUwMDApXG5cbmltcG9ydCAqIGFzIGZzIGZyb20gJ2ZzJztcblxudmFyIG9KU09OID0gSlNPTi5wYXJzZSgnJyArIGZzLnJlYWRGaWxlU3luYygnLi9yZXNvdXJjZXMvbW9kZWwvaW50ZW50cy5qc29uJykpO1xudmFyIG9SdWxlcyA9IFBsYWluUmVjb2duaXplci5wYXJzZVJ1bGVzKG9KU09OKTtcbi8vIHZhciBSZWNvZ25pemVyID0gbmV3IChyZWNvZ25pemVyLlJlZ0V4cFJlY29nbml6ZXIpKG9SdWxlcyk7XG5cblxuZnVuY3Rpb24gbG9nUXVlcnkoc2Vzc2lvbjogYnVpbGRlci5TZXNzaW9uLCBpbnRlbnQ6IHN0cmluZywgcmVzdWx0PzogQXJyYXk8SU1hdGNoLklUb29sTWF0Y2g+KSB7XG5cbiAgZnMuYXBwZW5kRmlsZSgnLi9sb2dzL3Nob3dtZXF1ZXJpZXMudHh0JywgXCJcXG5cIiArIEpTT04uc3RyaW5naWZ5KHtcbiAgICB0ZXh0OiBzZXNzaW9uLm1lc3NhZ2UudGV4dCxcbiAgICB0aW1lc3RhbXA6IHNlc3Npb24ubWVzc2FnZS50aW1lc3RhbXAsXG4gICAgaW50ZW50OiBpbnRlbnQsXG4gICAgcmVzOiByZXN1bHQgJiYgcmVzdWx0Lmxlbmd0aCAmJiBNYXRjaC5Ub29sTWF0Y2guZHVtcE5pY2UocmVzdWx0WzBdKSB8fCBcIjBcIixcbiAgICBjb252ZXJzYXRpb25JZDogc2Vzc2lvbi5tZXNzYWdlLmFkZHJlc3NcbiAgICAmJiBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzcy5jb252ZXJzYXRpb25cbiAgICAmJiBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzcy5jb252ZXJzYXRpb24uaWQgfHwgXCJcIixcbiAgICB1c2VyaWQ6IHNlc3Npb24ubWVzc2FnZS5hZGRyZXNzXG4gICAgJiYgc2Vzc2lvbi5tZXNzYWdlLmFkZHJlc3MudXNlclxuICAgICYmIHNlc3Npb24ubWVzc2FnZS5hZGRyZXNzLnVzZXIuaWQgfHwgXCJcIlxuICB9KSwgZnVuY3Rpb24gKGVyciwgcmVzKSB7XG4gICAgaWYgKGVycikge1xuICAgICAgZGVidWdsb2coXCJsb2dnaW5nIGZhaWxlZCBcIiArIGVycik7XG4gICAgfVxuICB9KTtcbn1cblxuXG5cbmZ1bmN0aW9uIGxvZ1F1ZXJ5V2hhdElzKHNlc3Npb246IGJ1aWxkZXIuU2Vzc2lvbiwgaW50ZW50OiBzdHJpbmcsIHJlc3VsdD86IEFycmF5PElNYXRjaC5JV2hhdElzQW5zd2VyPikge1xuXG4gIGZzLmFwcGVuZEZpbGUoJy4vbG9ncy9zaG93bWVxdWVyaWVzLnR4dCcsIFwiXFxuXCIgKyBKU09OLnN0cmluZ2lmeSh7XG4gICAgdGV4dDogc2Vzc2lvbi5tZXNzYWdlLnRleHQsXG4gICAgdGltZXN0YW1wOiBzZXNzaW9uLm1lc3NhZ2UudGltZXN0YW1wLFxuICAgIGludGVudDogaW50ZW50LFxuICAgIHJlczogcmVzdWx0ICYmIHJlc3VsdC5sZW5ndGggJiYgV2hhdElzLmR1bXBOaWNlKHJlc3VsdFswXSkgfHwgXCIwXCIsXG4gICAgY29udmVyc2F0aW9uSWQ6IHNlc3Npb24ubWVzc2FnZS5hZGRyZXNzXG4gICAgJiYgc2Vzc2lvbi5tZXNzYWdlLmFkZHJlc3MuY29udmVyc2F0aW9uXG4gICAgJiYgc2Vzc2lvbi5tZXNzYWdlLmFkZHJlc3MuY29udmVyc2F0aW9uLmlkIHx8IFwiXCIsXG4gICAgdXNlcmlkOiBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzc1xuICAgICYmIHNlc3Npb24ubWVzc2FnZS5hZGRyZXNzLnVzZXJcbiAgICAmJiBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzcy51c2VyLmlkIHx8IFwiXCJcbiAgfSksIGZ1bmN0aW9uIChlcnIsIHJlcykge1xuICAgIGlmIChlcnIpIHtcbiAgICAgIGRlYnVnbG9nKFwibG9nZ2luZyBmYWlsZWQgXCIgKyBlcnIpO1xuICAgIH1cbiAgfSk7XG59XG5cbnZhciBnd29yZHMgPSB7fTtcbi8qKlxuICogQ29uc3RydWN0IGEgYm90XG4gKiBAcGFyYW0gY29ubmVjdG9yIHtDb25uZWN0b3J9IHRoZSBjb25uZWN0b3IgdG8gdXNlXG4gKiBIVE1MQ29ubmVjdG9yXG4gKiBvciBjb25uZWN0b3IgPSBuZXcgYnVpbGRlci5Db25zb2xlQ29ubmVjdG9yKCkubGlzdGVuKClcbiAqL1xuZnVuY3Rpb24gbWFrZUJvdChjb25uZWN0b3IpIHtcbiAgYm90ID0gbmV3IGJ1aWxkZXIuVW5pdmVyc2FsQm90KGNvbm5lY3Rvcik7XG5cblxuXG4gIC8vIENyZWF0ZSBMVUlTIHJlY29nbml6ZXIgdGhhdCBwb2ludHMgYXQgb3VyIG1vZGVsIGFuZCBhZGQgaXQgYXMgdGhlIHJvb3QgJy8nIGRpYWxvZyBmb3Igb3VyIENvcnRhbmEgQm90LlxuICAvLyB2YXIgbW9kZWwgPSBzZW5zaXRpdmUubW9kZWx1cmw7XG4gIC8vIHZhciBtb2RlbCA9ICdodHRwczovL2FwaS5wcm9qZWN0b3hmb3JkLmFpL2x1aXMvdjIuMC9hcHBzL2M0MTNiMmVmLTM4MmMtNDViZC04ZmYwLWY3NmQ2MGUyYTgyMT9zdWJzY3JpcHRpb24ta2V5PWMyMTM5OGI1OTgwYTRjZTA5ZjQ3NGJiZmVlOTNiODkyJnE9J1xuICB2YXIgcmVjb2duaXplciA9IG5ldyBQbGFpblJlY29nbml6ZXIuUmVnRXhwUmVjb2duaXplcihvUnVsZXMpO1xuXG4gIHZhciBkaWFsb2cgPSBuZXcgYnVpbGRlci5JbnRlbnREaWFsb2coeyByZWNvZ25pemVyczogW3JlY29nbml6ZXJdIH0pO1xuICAvLyBkaWFsb2cub25CZWdpbihmdW5jdGlvbihzZXNzaW9uLGFyZ3MpIHtcbiAgLy8gY29uc29sZS5sb2coXCJiZWdpbm5pbmcgLi4uXCIpXG4gIC8vIHNlc3Npb24uZGlhbG9nRGF0YS5yZXRyeVByb21wdCA9IGFyZ3MgJiYgYXJncy5yZXRyeVByb21wdCB8fCBcIkkgYW0gc29ycnlcIlxuICAvLyBzZXNzaW9uLnNlbmQoXCJXaGF0IGRvIHlvdSB3YW50P1wiKVxuICAvL1xuICAvLyB9KVxuXG4gIHZhciBkaWFsb2dVcERvd24gPSBuZXcgYnVpbGRlci5JbnRlbnREaWFsb2coeyByZWNvZ25pemVyczogW25ldyBTaW1wbGVVcERvd25SZWNvZ25pemVyKCldIH0pO1xuXG4gIGJvdC5kaWFsb2coJy91cGRvd24nLCBkaWFsb2dVcERvd24pO1xuICBkaWFsb2dVcERvd24ub25CZWdpbihmdW5jdGlvbiAoc2Vzc2lvbikge1xuICAgIHNlc3Npb24uc2VuZChcIkhpIHRoZXJlLCB1cGRvd24gaXMgd2FpdGluZyBmb3IgeW91XCIpO1xuICB9KVxuXG4gIGRpYWxvZ1VwRG93bi5tYXRjaGVzKCdpbnRlbnQudXAnLCBbXG4gICAgZnVuY3Rpb24gKHNlc3Npb24sIGFyZ3MsIG5leHQpIHtcbiAgICAgIHNlc3Npb24uZGlhbG9nRGF0YS5hYmMgPSBhcmdzIHx8IHt9O1xuICAgICAgYnVpbGRlci5Qcm9tcHRzLnRleHQoc2Vzc2lvbiwgJ3lvdSB3YW50IHRvIGdvIHVwJyk7XG4gICAgfSxcbiAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgcmVzdWx0cywgbmV4dCkge1xuICAgICAgc2Vzc2lvbi5kaWFsb2dEYXRhLmFiYyA9IHJlc3VsdHMucmVwb25zZTtcbiAgICAgIG5leHQoKTtcbiAgICB9LFxuICAgIGZ1bmN0aW9uIChzZXNzaW9uLCByZXN1bHRzKSB7XG4gICAgICBzZXNzaW9uLmVuZERpYWxvZ1dpdGhSZXN1bHQoeyByZXNwb25zZTogc2Vzc2lvbi5kaWFsb2dEYXRhLmFiYyB9KTtcbiAgICB9XG4gIF1cbiAgKTtcblxuICBkaWFsb2dVcERvd24ubWF0Y2hlcygnaW50ZW50LmRvd24nLCBbXG4gICAgZnVuY3Rpb24gKHNlc3Npb24sIGFyZ3MsIG5leHQpIHtcbiAgICAgIHNlc3Npb24uZGlhbG9nRGF0YS5hYmMgPSBhcmdzIHx8IHt9O1xuICAgICAgYnVpbGRlci5Qcm9tcHRzLnRleHQoc2Vzc2lvbiwgJ3lvdSB3YW50IHRvIGdvIGRvd24hJyk7XG4gICAgfSxcbiAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgcmVzdWx0cywgbmV4dCkge1xuICAgICAgc2Vzc2lvbi5kaWFsb2dEYXRhLmFiYyA9IC0xOyAvLyByZXN1bHRzLnJlcG9uc2U7XG4gICAgICBuZXh0KCk7XG4gICAgfSxcbiAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgcmVzdWx0cykge1xuICAgICAgc2Vzc2lvbi5zZW5kKFwic3RpbGwgZ29pbmcgZG93bj9cIik7XG4gICAgfVxuICBdXG4gICk7XG4gIGRpYWxvZ1VwRG93bi5vbkRlZmF1bHQoZnVuY3Rpb24gKHNlc3Npb24pIHtcbiAgICBsb2dRdWVyeShzZXNzaW9uLCBcIm9uRGVmYXVsdFwiKTtcbiAgICBzZXNzaW9uLnNlbmQoXCJZb3UgYXJlIHRyYXBwZWQgaW4gYSBkaWFsb2cgd2hpY2ggb25seSB1bmRlcnN0YW5kcyB1cCBhbmQgZG93biwgb25lIG9mIHRoZW0gd2lsbCBnZXQgeW91IG91dFwiKTtcbiAgICAvL2J1aWxkZXIuRGlhbG9nQWN0aW9uLnNlbmQoJ0lcXCdtIHNvcnJ5IEkgZGlkblxcJ3QgdW5kZXJzdGFuZC4gSSBjYW4gb25seSBzaG93IHN0YXJ0IGFuZCByaW5nJyk7XG4gIH0pO1xuXG5cbiAgYm90LmRpYWxvZygnL3RyYWluJywgW1xuICAgIGZ1bmN0aW9uIChzZXNzaW9uLCBhcmdzLCBuZXh0KSB7XG4gICAgICBzZXNzaW9uLmRpYWxnb0RhdGEuYWJjID0gYXJncyB8fCB7fTtcbiAgICAgIGJ1aWxkZXIuUHJvbXB0cy50ZXh0KHNlc3Npb24sICdEbyB5b3Ugd2FudCB0byB0cmFpbiBtZScpO1xuICAgIH0sXG4gICAgZnVuY3Rpb24gKHNlc3Npb24sIHJlc3VsdHMsIG5leHQpIHtcbiAgICAgIHNlc3Npb24uZGlhbG9nRGF0YS5hYmMgPSByZXN1bHRzLnJlcG9uc2U7XG4gICAgfSxcbiAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgcmVzdWx0cykge1xuICAgICAgc2Vzc2lvbi5lbmREaWFsb2dXaXRoUmVzdWx0KHsgcmVzcG9uc2U6IHNlc3Npb24uRGlhbG9nRGF0YS5hYmMgfSk7XG4gICAgfVxuICBdKTtcblxuXG4gIGJvdC5kaWFsb2coJy8nLCBkaWFsb2cpO1xuXG4gIGRpYWxvZy5tYXRjaGVzKCdTaG93TWUnLCBbXG4gICAgZnVuY3Rpb24gKHNlc3Npb24sIGFyZ3MsIG5leHQpIHtcbiAgICAgIHZhciBpc0NvbWJpbmVkSW5kZXggPSB7fTtcbiAgICAgIHZhciBvTmV3RW50aXR5O1xuICAgICAgLy8gZXhwZWN0aW5nIGVudGl0eSBBMVxuICAgICAgZGVidWdsb2coXCJTaG93IEVudGl0eVwiKTtcbiAgICAgIGNvbnNvbGUubG9nKCdyYXc6ICcgKyBKU09OLnN0cmluZ2lmeShhcmdzLmVudGl0aWVzKSwgdW5kZWZpbmVkLCAyKTtcbiAgICAgIHZhciBhMSA9IGJ1aWxkZXIuRW50aXR5UmVjb2duaXplci5maW5kRW50aXR5KGFyZ3MuZW50aXRpZXMsICdBMScpO1xuICAgICAgY29uc3QgcmVzdWx0ID0gQW5hbHl6ZS5hbmFseXplQWxsKGExLmVudGl0eSxcbiAgICAgICAgdGhlTW9kZWwubVJ1bGVzLCB0aGVNb2RlbC50b29scywgZ3dvcmRzKTtcbiAgICAgIGxvZ1F1ZXJ5KHNlc3Npb24sICdTaG93TWUnLCByZXN1bHQpO1xuICAgICAgLy8gdGVzdC5leHBlY3QoMylcbiAgICAgIC8vICB0ZXN0LmRlZXBFcXVhbChyZXN1bHQud2VpZ2h0LCAxMjAsICdjb3JyZWN0IHdlaWdodCcpO1xuICAgICAgaWYgKCFyZXN1bHQgfHwgcmVzdWx0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICBuZXh0KCk7XG4gICAgICB9XG4gICAgICAvLyBkZWJ1Z2xvZygncmVzdWx0IDogJyArIEpTT04uc3RyaW5naWZ5KHJlc3VsdCwgdW5kZWZpbmVkLCAyKSk7XG4gICAgICBkZWJ1Z2xvZygnYmVzdCByZXN1bHQgOiAnICsgSlNPTi5zdHJpbmdpZnkocmVzdWx0WzBdIHx8IHt9LCB1bmRlZmluZWQsIDIpKTtcbiAgICAgIGRlYnVnbG9nKCd0b3AgOiAnICsgTWF0Y2guVG9vbE1hdGNoLmR1bXBXZWlnaHRzVG9wKHJlc3VsdCwgeyB0b3A6IDMgfSkpO1xuXG5cbiAgICAgIGlmIChBbmFseXplLmlzQ29tcGxldGUocmVzdWx0WzBdKSkge1xuICAgICAgICBzZXNzaW9uLmRpYWxvZ0RhdGEucmVzdWx0ID0gcmVzdWx0WzBdO1xuICAgICAgICAvLyAgICBzZXNzaW9uLnNlbmQoJ1Nob3dpbmcgZW50aXR5IC4uLicpO1xuICAgICAgICBuZXh0KCk7XG4gICAgICB9IGVsc2UgaWYgKEFuYWx5emUuZ2V0UHJvbXB0KHJlc3VsdFswXSkpIHtcbiAgICAgICAgdmFyIHByb21wdCA9IEFuYWx5emUuZ2V0UHJvbXB0KHJlc3VsdFswXSk7XG4gICAgICAgIHNlc3Npb24uZGlhbG9nRGF0YS5yZXN1bHQgPSByZXN1bHRbMF07XG4gICAgICAgIHNlc3Npb24uZGlhbG9nRGF0YS5wcm9tcHQgPSBwcm9tcHQ7XG4gICAgICAgIHNlc3Npb24uc2VuZChcIk5vdCBlbm91Z2ggaW5mb3JtYXRpb24gc3VwcGxpZWQ6IFwiICsgTWF0Y2guVG9vbE1hdGNoLmR1bXBOaWNlKFxuICAgICAgICAgIHNlc3Npb24uZGlhbG9nRGF0YS5yZXN1bHRcbiAgICAgICAgKSk7XG4gICAgICAgIGJ1aWxkZXIuUHJvbXB0cy50ZXh0KHNlc3Npb24sIHByb21wdC50ZXh0KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciBiZXN0ID0gcmVzdWx0Lmxlbmd0aCA/IE1hdGNoLlRvb2xNYXRjaC5kdW1wTmljZShyZXN1bHRbMF0pIDogXCI8bm90aGluZz5cIjtcbiAgICAgICAgLy9zZXNzaW9uLnNlbmQoJ0kgZGlkIG5vdCB1bmRlcnN0YW5kIHRoaXMnICsgYmVzdCk7XG4gICAgICAgIHZhciByZXBseSA9XG4gICAgICAgICAgbmV3IGJ1aWxkZXIuTWVzc2FnZShzZXNzaW9uKVxuICAgICAgICAgICAgLnRleHQoJ0kgZGlkIG5vdCB1bmRlcnN0YW5kIHRoaXMnICsgYmVzdClcbiAgICAgICAgICAgIC5hZGRFbnRpdHkoeyB1cmw6IFwiSSBkb24ndCBrbm93XCIgfSk7XG4gICAgICAgIC8vIC5hZGRBdHRhY2htZW50KHsgZmFsbGJhY2tUZXh0OiBcIkkgZG9uJ3Qga25vd1wiLCBjb250ZW50VHlwZTogJ2ltYWdlL2pwZWcnLCBjb250ZW50VXJsOiBcInd3dy53b21iYXQub3JnXCIgfSk7XG4gICAgICAgIHNlc3Npb24uc2VuZChyZXBseSk7XG4gICAgICB9XG4gICAgfSxcbiAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgcmVzdWx0cywgbmV4dCkge1xuICAgICAgdmFyIHJlc3VsdCA9IHNlc3Npb24uZGlhbG9nRGF0YS5yZXN1bHQ7XG4gICAgICBpZiAoIXJlc3VsdCB8fCByZXN1bHQubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIG5leHQoKTtcbiAgICAgIH1cblxuICAgICAgaWYgKHJlc3VsdHMucmVzcG9uc2UpIHtcbiAgICAgICAgLy8gc29tZSBwcm9tcHRpbmdcbiAgICAgICAgQW5hbHl6ZS5zZXRQcm9tcHQoc2Vzc2lvbi5kaWFsb2dEYXRhLnJlc3VsdCwgc2Vzc2lvbi5kaWFsb2dEYXRhLnByb21wdCwgcmVzdWx0cy5yZXNwb25zZSk7XG4gICAgICB9XG4gICAgICBpZiAoQW5hbHl6ZS5pc0NvbXBsZXRlKHNlc3Npb24uZGlhbG9nRGF0YS5yZXN1bHQpKSB7XG4gICAgICAgIG5leHQoKTtcbiAgICAgIH0gZWxzZSBpZiAoQW5hbHl6ZS5nZXRQcm9tcHQoc2Vzc2lvbi5kaWFsb2dEYXRhLnJlc3VsdCkpIHtcbiAgICAgICAgdmFyIHByb21wdCA9IEFuYWx5emUuZ2V0UHJvbXB0KHNlc3Npb24uZGlhbG9nRGF0YS5yZXN1bHQpO1xuICAgICAgICBzZXNzaW9uLmRpYWxvZ0RhdGEucHJvbXB0ID0gcHJvbXB0O1xuICAgICAgICBidWlsZGVyLlByb21wdHMudGV4dChzZXNzaW9uLCBwcm9tcHQudGV4dCk7XG4gICAgICB9XG4gICAgfSxcbiAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgcmVzdWx0cywgbmV4dCkge1xuICAgICAgdmFyIHJlc3VsdCA9IHNlc3Npb24uZGlhbG9nRGF0YS5yZXN1bHQ7XG4gICAgICBpZiAocmVzdWx0cy5yZXNwb25zZSkge1xuICAgICAgICAvLyBzb21lIHByb21wdGluZ1xuICAgICAgICBBbmFseXplLnNldFByb21wdChzZXNzaW9uLmRpYWxvZ0RhdGEucmVzdWx0LFxuICAgICAgICAgIHNlc3Npb24uZGlhbG9nRGF0YS5wcm9tcHQsIHJlc3VsdHMucmVzcG9uc2UpO1xuICAgICAgfVxuICAgICAgaWYgKEFuYWx5emUuaXNDb21wbGV0ZShzZXNzaW9uLmRpYWxvZ0RhdGEucmVzdWx0KSkge1xuICAgICAgICBjb25zdCBleGVjID0gRXhlY1NlcnZlci5leGVjVG9vbChzZXNzaW9uLmRpYWxvZ0RhdGEucmVzdWx0IGFzIElNYXRjaC5JVG9vbE1hdGNoLCB0aGVNb2RlbC5yZWNvcmRzKTtcblxuICAgICAgICB2YXIgcmVwbHkgPSBuZXcgYnVpbGRlci5NZXNzYWdlKHNlc3Npb24pXG4gICAgICAgICAgLnRleHQoZXhlYy50ZXh0KVxuICAgICAgICAgIC5hZGRFbnRpdHkoZXhlYy5hY3Rpb24pO1xuICAgICAgICAvLyAuYWRkQXR0YWNobWVudCh7IGZhbGxiYWNrVGV4dDogXCJJIGRvbid0IGtub3dcIiwgY29udGVudFR5cGU6ICdpbWFnZS9qcGVnJywgY29udGVudFVybDogXCJ3d3cud29tYmF0Lm9yZ1wiIH0pO1xuICAgICAgICBzZXNzaW9uLnNlbmQocmVwbHkpO1xuXG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoc2Vzc2lvbi5kaWFsb2dEYXRhLnJlc3VsdCkge1xuICAgICAgICAgIHNlc3Npb24uc2VuZChcIk5vdCBlbm91Z2ggaW5mb3JtYXRpb24gc3VwcGxpZWQ6IFwiICsgTWF0Y2guVG9vbE1hdGNoLmR1bXBOaWNlKFxuICAgICAgICAgICAgc2Vzc2lvbi5kaWFsb2dEYXRhLnJlc3VsdFxuICAgICAgICAgICkpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHNlc3Npb24uc2VuZChcIkkgZGlkIG5vdCBnZXQgd2hhdCB5b3Ugd2FudFwiKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0sXG4gIF0pO1xuXG4gIGRpYWxvZy5tYXRjaGVzKCdXaGF0SXMnLCBbXG4gICAgZnVuY3Rpb24gKHNlc3Npb24sIGFyZ3MsIG5leHQpIHtcbiAgICAgIHZhciBpc0NvbWJpbmVkSW5kZXggPSB7fTtcbiAgICAgIHZhciBvTmV3RW50aXR5O1xuICAgICAgLy8gZXhwZWN0aW5nIGVudGl0eSBBMVxuICAgICAgdmFyIG1lc3NhZ2UgPSBzZXNzaW9uLm1lc3NhZ2UudGV4dDtcbiAgICAgIGRlYnVnbG9nKFwiV2hhdElzIEVudGl0eVwiKTtcbiAgICAgIGNvbnNvbGUubG9nKCdyYXc6ICcgKyBKU09OLnN0cmluZ2lmeShhcmdzLmVudGl0aWVzKSwgdW5kZWZpbmVkLCAyKTtcbiAgICAgIHZhciBjYXRlZ29yeUVudGl0eSA9IGJ1aWxkZXIuRW50aXR5UmVjb2duaXplci5maW5kRW50aXR5KGFyZ3MuZW50aXRpZXMsICdjYXRlZ29yeScpO1xuICAgICAgdmFyIGNhdGVnb3J5ID0gY2F0ZWdvcnlFbnRpdHkuZW50aXR5O1xuICAgICAgdmFyIGExID0gYnVpbGRlci5FbnRpdHlSZWNvZ25pemVyLmZpbmRFbnRpdHkoYXJncy5lbnRpdGllcywgJ0ExJyk7XG5cbiAgICAgIHZhciBjYXQgPSBXaGF0SXMuYW5hbHl6ZUNhdGVnb3J5KGNhdGVnb3J5LCB0aGVNb2RlbC5tUnVsZXMsIG1lc3NhZ2UpO1xuICAgICAgaWYoIWNhdCkge1xuICAgICAgICBzZXNzaW9uLnNlbmQoJ0kgZG9uXFwndCBrbm93IGFueXRoaW5nIGFib3V0IFwiJyArIGNhdGVnb3J5ICsgJ1wiJyk7XG4gICAgICAgIG5leHQoKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHJlc3VsdCA9IFdoYXRJcy5yZXNvbHZlQ2F0ZWdvcnkoY2F0LCBhMS5lbnRpdHksXG4gICAgICAgIHRoZU1vZGVsLm1SdWxlcywgdGhlTW9kZWwucmVjb3Jkcyk7XG4gICAgICBsb2dRdWVyeVdoYXRJcyhzZXNzaW9uLCAnV2hhdElzJywgcmVzdWx0KTtcbiAgICAgIHZhciBpbmRpcyA9IFdoYXRJcy5pc0luZGlzY3JpbWluYXRlUmVzdWx0KHJlc3VsdCk7XG4gICAgICBpZiAoaW5kaXMpIHtcbiAgICAgICAgc2Vzc2lvbi5zZW5kKGluZGlzKTtcbiAgICAgICAgbmV4dCgpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG4gICAgICBpZiAoIXJlc3VsdCB8fCByZXN1bHQubGVuZ3RoID09PSAwKSB7XG4gICAgICAgIHNlc3Npb24uc2VuZCgnSSBkb25cXCd0IGtub3cgYW55dGhpbmcgYWJvdXQgXCInICsgY2F0ICsgXCIgKFwiICsgY2F0ZWdvcnkgKyAnKVxcXCIgaW4gcmVsYXRpb24gdG8gXCInICsgYTEuZW50aXR5ICsgJ1wiJyk7XG4gICAgICAgIG5leHQoKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgLy8gZGVidWdsb2coJ3Jlc3VsdCA6ICcgKyBKU09OLnN0cmluZ2lmeShyZXN1bHQsIHVuZGVmaW5lZCwgMikpO1xuICAgICAgICBkZWJ1Z2xvZygnYmVzdCByZXN1bHQgOiAnICsgSlNPTi5zdHJpbmdpZnkocmVzdWx0WzBdIHx8IHt9LCB1bmRlZmluZWQsIDIpKTtcbiAgICAgICAgZGVidWdsb2coJ3RvcCA6ICcgKyBXaGF0SXMuZHVtcFdlaWdodHNUb3AocmVzdWx0LCB7IHRvcDogMyB9KSk7XG4gICAgICAgIC8vIFRPRE8gY2xlYW5zZWQgc2VudGVuY2VcbiAgICAgICAgc2Vzc2lvbi5zZW5kKCdUaGUgJyArIGNhdGVnb3J5ICsgJyBvZiAnICsgYTEuZW50aXR5ICsgJyBpcyAnICsgcmVzdWx0WzBdLnJlc3VsdCArIFwiXFxuXCIpOyAvLyAgKyBKU09OLnN0cmluZ2lmeShyZXN1bHRbMF0pKTtcbiAgICAgIH1cbiAgICB9XG4gIF0pO1xuXG5cblxuXG4gIGRpYWxvZy5tYXRjaGVzKCdXcm9uZycsIFtcbiAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgYXJncywgbmV4dCkge1xuICAgICAgc2Vzc2lvbi5iZWdpbkRpYWxvZygnL3VwZG93bicsIHNlc3Npb24udXNlckRhdGEuY291bnQpO1xuICAgIH0sXG4gICAgZnVuY3Rpb24gKHNlc3Npb24sIHJlc3VsdHMsIG5leHQpIHtcbiAgICAgIHZhciBhbGFybSA9IHNlc3Npb24uZGlhbG9nRGF0YS5hbGFybTtcbiAgICAgIHNlc3Npb24uc2VuZChcImJhY2sgZnJvbSB3cm9uZyA6IFwiICsgSlNPTi5zdHJpbmdpZnkocmVzdWx0cykpO1xuICAgICAgbmV4dCgpO1xuICAgIH0sXG4gICAgZnVuY3Rpb24gKHNlc3Npb24sIHJlc3VsdHMpIHtcbiAgICAgIHNlc3Npb24uc2VuZCgnZW5kIG9mIHdyb25nJyk7XG4gICAgfVxuICBdKTtcblxuICBkaWFsb2cubWF0Y2hlcygnRXhpdCcsIFtcbiAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgYXJncywgbmV4dCkge1xuICAgICAgY29uc29sZS5sb2coJ2V4aXQgOicpO1xuICAgICAgY29uc29sZS5sb2coJ2V4aXQnICsgSlNPTi5zdHJpbmdpZnkoYXJncy5lbnRpdGllcykpO1xuICAgICAgc2Vzc2lvbi5zZW5kKFwieW91IGFyZSBpbiBhIGxvZ2ljIGxvb3AgXCIpO1xuICAgIH1cbiAgXSk7XG4gIGRpYWxvZy5tYXRjaGVzKCdIZWxwJywgW1xuICAgIGZ1bmN0aW9uIChzZXNzaW9uLCBhcmdzLCBuZXh0KSB7XG4gICAgICBjb25zb2xlLmxvZygnaGVscCA6Jyk7XG4gICAgICBjb25zb2xlLmxvZygnaGVscCcpO1xuICAgICAgc2Vzc2lvbi5zZW5kKFwiSSBrbm93IGFib3V0IC4uLi4gPGNhdGVnb3JpZXM+PlwiKTtcbiAgICB9XG4gIF0pO1xuXG5cblxuICAvLyBBZGQgaW50ZW50IGhhbmRsZXJzXG4gIGRpYWxvZy5tYXRjaGVzKCd0cmFpbicsIFtcbiAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgYXJncywgbmV4dCkge1xuICAgICAgY29uc29sZS5sb2coJ3RyYWluJyk7XG4gICAgICAvLyBSZXNvbHZlIGFuZCBzdG9yZSBhbnkgZW50aXRpZXMgcGFzc2VkIGZyb20gTFVJUy5cbiAgICAgIHZhciB0aXRsZSA9IGJ1aWxkZXIuRW50aXR5UmVjb2duaXplci5maW5kRW50aXR5KGFyZ3MuZW50aXRpZXMsICdidWlsdGluLmFsYXJtLnRpdGxlJyk7XG4gICAgICB2YXIgdGltZSA9IGJ1aWxkZXIuRW50aXR5UmVjb2duaXplci5yZXNvbHZlVGltZShhcmdzLmVudGl0aWVzKTtcbiAgICAgIHZhciBhbGFybSA9IHNlc3Npb24uZGlhbG9nRGF0YS5hbGFybSA9IHtcbiAgICAgICAgdGl0bGU6IHRpdGxlID8gdGl0bGUuZW50aXR5IDogbnVsbCxcbiAgICAgICAgdGltZXN0YW1wOiB0aW1lID8gdGltZS5nZXRUaW1lKCkgOiBudWxsXG4gICAgICB9O1xuICAgICAgLy8gUHJvbXB0IGZvciB0aXRsZVxuICAgICAgaWYgKCFhbGFybS50aXRsZSkge1xuICAgICAgICBidWlsZGVyLlByb21wdHMudGV4dChzZXNzaW9uLCAnV2hhdCBmYWN0IHdvdWxkIHlvdSBsaWtlIHRvIHRyYWluPycpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgbmV4dCgpO1xuICAgICAgfVxuICAgIH0sXG4gICAgZnVuY3Rpb24gKHNlc3Npb24sIHJlc3VsdHMsIG5leHQpIHtcbiAgICAgIHZhciBhbGFybSA9IHNlc3Npb24uZGlhbG9nRGF0YS5hbGFybTtcbiAgICAgIGlmIChyZXN1bHRzLnJlc3BvbnNlKSB7XG4gICAgICAgIGFsYXJtLnRpdGxlID0gcmVzdWx0cy5yZXNwb25zZTtcbiAgICAgIH1cblxuICAgICAgLy8gUHJvbXB0IGZvciB0aW1lICh0aXRsZSB3aWxsIGJlIGJsYW5rIGlmIHRoZSB1c2VyIHNhaWQgY2FuY2VsKVxuICAgICAgaWYgKGFsYXJtLnRpdGxlICYmICFhbGFybS50aW1lc3RhbXApIHtcbiAgICAgICAgYnVpbGRlci5Qcm9tcHRzLnRpbWUoc2Vzc2lvbiwgJ1doYXQgdGltZSB3b3VsZCB5b3UgbGlrZSB0byBzZXQgdGhlIGFsYXJtIGZvcj8nKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG5leHQoKTtcbiAgICAgIH1cbiAgICB9LFxuICAgIGZ1bmN0aW9uIChzZXNzaW9uLCByZXN1bHRzKSB7XG4gICAgICB2YXIgYWxhcm0gPSBzZXNzaW9uLmRpYWxvZ0RhdGEuYWxhcm07XG4gICAgICBpZiAocmVzdWx0cy5yZXNwb25zZSkge1xuICAgICAgICB2YXIgdGltZSA9IGJ1aWxkZXIuRW50aXR5UmVjb2duaXplci5yZXNvbHZlVGltZShbcmVzdWx0cy5yZXNwb25zZV0pO1xuICAgICAgICBhbGFybS50aW1lc3RhbXAgPSB0aW1lID8gdGltZS5nZXRUaW1lKCkgOiBudWxsO1xuICAgICAgfVxuICAgICAgLy8gU2V0IHRoZSBhbGFybSAoaWYgdGl0bGUgb3IgdGltZXN0YW1wIGlzIGJsYW5rIHRoZSB1c2VyIHNhaWQgY2FuY2VsKVxuICAgICAgaWYgKGFsYXJtLnRpdGxlICYmIGFsYXJtLnRpbWVzdGFtcCkge1xuICAgICAgICAvLyBTYXZlIGFkZHJlc3Mgb2Ygd2hvIHRvIG5vdGlmeSBhbmQgd3JpdGUgdG8gc2NoZWR1bGVyLlxuICAgICAgICBhbGFybS5hZGRyZXNzID0gc2Vzc2lvbi5tZXNzYWdlLmFkZHJlc3M7XG4gICAgICAgIC8vYWxhcm1zW2FsYXJtLnRpdGxlXSA9IGFsYXJtO1xuXG4gICAgICAgIC8vIFNlbmQgY29uZmlybWF0aW9uIHRvIHVzZXJcbiAgICAgICAgdmFyIGRhdGUgPSBuZXcgRGF0ZShhbGFybS50aW1lc3RhbXApO1xuICAgICAgICB2YXIgaXNBTSA9IGRhdGUuZ2V0SG91cnMoKSA8IDEyO1xuICAgICAgICBzZXNzaW9uLnNlbmQoJ0NyZWF0aW5nIGFsYXJtIG5hbWVkIFwiJXNcIiBmb3IgJWQvJWQvJWQgJWQ6JTAyZCVzJyxcbiAgICAgICAgICBhbGFybS50aXRsZSxcbiAgICAgICAgICBkYXRlLmdldE1vbnRoKCkgKyAxLCBkYXRlLmdldERhdGUoKSwgZGF0ZS5nZXRGdWxsWWVhcigpLFxuICAgICAgICAgIGlzQU0gPyBkYXRlLmdldEhvdXJzKCkgOiBkYXRlLmdldEhvdXJzKCkgLSAxMiwgZGF0ZS5nZXRNaW51dGVzKCksIGlzQU0gPyAnYW0nIDogJ3BtJyk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzZXNzaW9uLnNlbmQoJ09rLi4uIG5vIHByb2JsZW0uJyk7XG4gICAgICB9XG4gICAgfVxuICBdKTtcblxuICBkaWFsb2cub25EZWZhdWx0KGZ1bmN0aW9uIChzZXNzaW9uKSB7XG4gICAgbG9nUXVlcnkoc2Vzc2lvbiwgXCJvbkRlZmF1bHRcIik7XG4gICAgdmFyIGVsaXphID0gZ2V0RWxpemFCb3QoZ2V0Q29udmVyc2F0aW9uSWQoc2Vzc2lvbikpO1xuICAgIHZhciByZXBseSA9IGVsaXphLnRyYW5zZm9ybShzZXNzaW9uLm1lc3NhZ2UudGV4dCk7XG4gICAgc2Vzc2lvbi5zZW5kKHJlcGx5KTtcbiAgICAvL25ldyBFaWx6YWJvdFxuICAgIC8vc2Vzc2lvbi5zZW5kKFwiSSBkbyBub3QgdW5kZXJzdGFuZCB0aGlzIGF0IGFsbFwiKTtcbiAgICAvL2J1aWxkZXIuRGlhbG9nQWN0aW9uLnNlbmQoJ0lcXCdtIHNvcnJ5IEkgZGlkblxcJ3QgdW5kZXJzdGFuZC4gSSBjYW4gb25seSBzaG93IHN0YXJ0IGFuZCByaW5nJyk7XG4gIH0pO1xuXG4gIC8qXG4gIC8vIFZlcnkgc2ltcGxlIGFsYXJtIHNjaGVkdWxlclxuICB2YXIgYWxhcm1zID0ge307XG4gIHNldEludGVydmFsKGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgbm93ID0gbmV3IERhdGUoKS5nZXRUaW1lKCk7XG4gICAgZm9yICh2YXIga2V5IGluIGFsYXJtcykge1xuICAgICAgdmFyIGFsYXJtID0gYWxhcm1zW2tleV07XG4gICAgICBpZiAobm93ID49IGFsYXJtLnRpbWVzdGFtcCkge1xuICAgICAgICB2YXIgbXNnID0gbmV3IGJ1aWxkZXIuTWVzc2FnZSgpXG4gICAgICAgICAgLmFkZHJlc3MoYWxhcm0uYWRkcmVzcylcbiAgICAgICAgICAudGV4dCgnSGVyZVxcJ3MgeW91ciBcXCclc1xcJyBhbGFybS4nLCBhbGFybS50aXRsZSk7XG4gICAgICAgIGJvdC5zZW5kKG1zZyk7XG4gICAgICAgIGRlbGV0ZSBhbGFybXNba2V5XTtcbiAgICAgIH1cbiAgICB9XG4gIH0sIDE1MDAwKTtcbiAgKi9cbn1cblxuaWYgKG1vZHVsZSkge1xuICBtb2R1bGUuZXhwb3J0cyA9IHtcbiAgICBtYWtlQm90OiBtYWtlQm90XG4gIH07XG59XG4iLCIvKipcbiAqIFRoZSBib3QgaW1wbGVtZW50YXRpb25cbiAqXG4gKiBJbnN0YW50aWF0ZSBhcHNzaW5nIGEgY29ubmVjdG9yIHZpYVxuICogbWFrZUJvdFxuICpcbiAqL1xuLyoqXG4gKiBAZmlsZVxuICogQG1vZHVsZSBqZnNlYi5mZGV2c3RhcnQuc21hcnRkaWFsb2dcbiAqIEBjb3B5cmlnaHQgKGMpIDIwMTYgR2VyZCBGb3JzdG1hbm5cbiAqL1xuLy9kZWNsYXJlIG1vZHVsZSAnZWxpemFib3QnIHsgfTtcblwidXNlIHN0cmljdFwiO1xudmFyIGJ1aWxkZXIgPSByZXF1aXJlKCdib3RidWlsZGVyJyk7XG52YXIgZGVidWcgPSByZXF1aXJlKCdkZWJ1ZycpO1xudmFyIE1hdGNoID0gcmVxdWlyZSgnLi4vbWF0Y2gvbWF0Y2gnKTtcbnZhciBBbmFseXplID0gcmVxdWlyZSgnLi4vbWF0Y2gvYW5hbHl6ZScpO1xudmFyIFdoYXRJcyA9IHJlcXVpcmUoJy4uL21hdGNoL3doYXRpcycpO1xudmFyIGVsaXphYm90ID0gcmVxdWlyZSgnLi4vZXh0ZXJuL2VsaXphYm90L2VsaXphYm90Jyk7XG4vL2ltcG9ydCAqIGFzIGVsaXphYm90IGZyb20gJ2VsaXphYm90JztcbnZhciBkZWJ1Z2xvZyA9IGRlYnVnKCdzbWFydGRpYWxvZycpO1xudmFyIFBsYWluUmVjb2duaXplciA9IHJlcXVpcmUoJy4vcGxhaW5yZWNvZ25pemVyJyk7XG4vL3ZhciBidWlsZGVyID0gcmVxdWlyZSgnYm90YnVpbGRlcicpO1xudmFyIGRpc3BhdGNoZXIgPSByZXF1aXJlKCcuLi9tYXRjaC9kaXNwYXRjaGVyLmpzJykuZGlzcGF0Y2hlcjtcbmZ1bmN0aW9uIGdldENvbnZlcnNhdGlvbklkKHNlc3Npb24pIHtcbiAgICByZXR1cm4gc2Vzc2lvbi5tZXNzYWdlICYmXG4gICAgICAgIHNlc3Npb24ubWVzc2FnZS5hZGRyZXNzICYmXG4gICAgICAgIHNlc3Npb24ubWVzc2FnZS5hZGRyZXNzLmNvbnZlcnNhdGlvbi5pZDtcbn1cbnZhciBlbGl6YWJvdHMgPSB7fTtcbmZ1bmN0aW9uIGdldEVsaXphQm90KGlkKSB7XG4gICAgaWYgKCFlbGl6YWJvdHNbaWRdKSB7XG4gICAgICAgIGVsaXphYm90c1tpZF0gPSB7XG4gICAgICAgICAgICBhY2Nlc3M6IG5ldyBEYXRlKCksXG4gICAgICAgICAgICBlbGl6YWJvdDogbmV3IGVsaXphYm90KClcbiAgICAgICAgfTtcbiAgICB9XG4gICAgZWxpemFib3RzW2lkXS5hY2Nlc3MgPSBuZXcgRGF0ZSgpO1xuICAgIHJldHVybiBlbGl6YWJvdHNbaWRdLmVsaXphYm90O1xufVxudmFyIG5ld0Zsb3cgPSB0cnVlO1xudmFyIE1vZGVsID0gcmVxdWlyZSgnLi4vbW9kZWwvbW9kZWwnKTtcbnZhciBFeGVjU2VydmVyID0gcmVxdWlyZSgnLi4vZXhlYy9leGVjc2VydmVyJyk7XG52YXIgdGhlTW9kZWwgPSBNb2RlbC5sb2FkTW9kZWxzKCk7XG5pZiAobmV3Rmxvdykge1xufVxuZWxzZSB7XG59XG52YXIgU2ltcGxlUmVjb2duaXplciA9IChmdW5jdGlvbiAoKSB7XG4gICAgZnVuY3Rpb24gU2ltcGxlUmVjb2duaXplcigpIHtcbiAgICB9XG4gICAgU2ltcGxlUmVjb2duaXplci5wcm90b3R5cGUucmVjb2duaXplID0gZnVuY3Rpb24gKGNvbnRleHQsIGNhbGxiYWNrKSB7XG4gICAgICAgIHZhciB1ID0ge307XG4gICAgICAgIGNvbnNvbGUubG9nKFwicmVjb2duaXppbmcgXCIgKyBjb250ZXh0Lm1lc3NhZ2UudGV4dCk7XG4gICAgICAgIGlmIChjb250ZXh0Lm1lc3NhZ2UudGV4dC5pbmRleE9mKFwic3RhcnRcIikgPj0gMCkge1xuICAgICAgICAgICAgdS5pbnRlbnQgPSBcIlNob3dFbnRpdHlcIjtcbiAgICAgICAgICAgIHUuc2NvcmUgPSAwLjk7XG4gICAgICAgICAgICB2YXIgZTEgPSB7fTtcbiAgICAgICAgICAgIGUxLnN0YXJ0SW5kZXggPSBcInN0YXJ0IFwiLmxlbmd0aDtcbiAgICAgICAgICAgIGUxLmVuZEluZGV4ID0gY29udGV4dC5tZXNzYWdlLnRleHQubGVuZ3RoO1xuICAgICAgICAgICAgZTEuc2NvcmUgPSAwLjM7XG4gICAgICAgICAgICB1LmVudGl0aWVzID0gW2UxXTtcbiAgICAgICAgICAgIGNhbGxiYWNrKHVuZGVmaW5lZCwgdSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbnRleHQubWVzc2FnZS50ZXh0LmluZGV4T2YoXCJ0cmFpblwiKSA+PSAwKSB7XG4gICAgICAgICAgICB1LmludGVudCA9IFwidHJhaW5cIjtcbiAgICAgICAgICAgIHUuc2NvcmUgPSAwLjk7XG4gICAgICAgICAgICB2YXIgZTEgPSB7fTtcbiAgICAgICAgICAgIGUxLnN0YXJ0SW5kZXggPSBcInRyYWluIFwiLmxlbmd0aDtcbiAgICAgICAgICAgIGUxLmVuZEluZGV4ID0gY29udGV4dC5tZXNzYWdlLnRleHQubGVuZ3RoO1xuICAgICAgICAgICAgZTEuc2NvcmUgPSAwLjM7XG4gICAgICAgICAgICB1LmVudGl0aWVzID0gW2UxXTtcbiAgICAgICAgICAgIGNhbGxiYWNrKHVuZGVmaW5lZCwgdSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbnRleHQubWVzc2FnZS50ZXh0LmluZGV4T2YoXCJsZWFyblwiKSA+PSAwKSB7XG4gICAgICAgICAgICB1LmludGVudCA9IFwibGVhcm5cIjtcbiAgICAgICAgICAgIHUuc2NvcmUgPSAwLjk7XG4gICAgICAgICAgICB2YXIgZTEgPSB7fTtcbiAgICAgICAgICAgIGUxLnR5cGUgPSBcInRyYWluRmFjdFwiO1xuICAgICAgICAgICAgZTEuc3RhcnRJbmRleCA9IFwidHJhaW4gXCIubGVuZ3RoO1xuICAgICAgICAgICAgZTEuZW5kSW5kZXggPSBjb250ZXh0Lm1lc3NhZ2UudGV4dC5sZW5ndGg7XG4gICAgICAgICAgICBlMS5zY29yZSA9IDAuMztcbiAgICAgICAgICAgIHUuZW50aXRpZXMgPSBbZTFdO1xuICAgICAgICAgICAgY2FsbGJhY2sodW5kZWZpbmVkLCB1KTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBpZiAoY29udGV4dC5tZXNzYWdlLnRleHQuaW5kZXhPZihcImhlbHBcIikgPj0gMCkge1xuICAgICAgICAgICAgdS5pbnRlbnQgPSBcImhlbHBcIjtcbiAgICAgICAgICAgIHUuc2NvcmUgPSAwLjk7XG4gICAgICAgICAgICB2YXIgZTEgPSB7fTtcbiAgICAgICAgICAgIGUxLnN0YXJ0SW5kZXggPSBcInRyYWluIFwiLmxlbmd0aDtcbiAgICAgICAgICAgIGUxLmVuZEluZGV4ID0gY29udGV4dC5tZXNzYWdlLnRleHQubGVuZ3RoO1xuICAgICAgICAgICAgZTEuc2NvcmUgPSAwLjM7XG4gICAgICAgICAgICB1LmVudGl0aWVzID0gW2UxXTtcbiAgICAgICAgICAgIGNhbGxiYWNrKHVuZGVmaW5lZCwgdSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbnRleHQubWVzc2FnZS50ZXh0LmluZGV4T2YoXCJleGl0XCIpID49IDApIHtcbiAgICAgICAgICAgIHUuaW50ZW50ID0gXCJleGl0XCI7XG4gICAgICAgICAgICB1LnNjb3JlID0gMC45O1xuICAgICAgICAgICAgdmFyIGUxID0ge307XG4gICAgICAgICAgICBlMS5zdGFydEluZGV4ID0gXCJleGl0IFwiLmxlbmd0aDtcbiAgICAgICAgICAgIGUxLmVuZEluZGV4ID0gY29udGV4dC5tZXNzYWdlLnRleHQubGVuZ3RoO1xuICAgICAgICAgICAgZTEuc2NvcmUgPSAwLjM7XG4gICAgICAgICAgICB1LmVudGl0aWVzID0gW2UxXTtcbiAgICAgICAgICAgIGNhbGxiYWNrKHVuZGVmaW5lZCwgdSk7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgaWYgKGNvbnRleHQubWVzc2FnZS50ZXh0LmluZGV4T2YoXCJ3cm9uZ1wiKSA+PSAwKSB7XG4gICAgICAgICAgICB1LmludGVudCA9IFwid3JvbmdcIjtcbiAgICAgICAgICAgIHUuc2NvcmUgPSAwLjk7XG4gICAgICAgICAgICB2YXIgZTEgPSB7fTtcbiAgICAgICAgICAgIGUxLnN0YXJ0SW5kZXggPSBcImV4aXQgXCIubGVuZ3RoO1xuICAgICAgICAgICAgZTEuZW5kSW5kZXggPSBjb250ZXh0Lm1lc3NhZ2UudGV4dC5sZW5ndGg7XG4gICAgICAgICAgICBlMS5zY29yZSA9IDAuMztcbiAgICAgICAgICAgIHUuZW50aXRpZXMgPSBbZTFdO1xuICAgICAgICAgICAgY2FsbGJhY2sodW5kZWZpbmVkLCB1KTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBjb25zb2xlLmxvZygncmVjb2duaXppbmcgbm90aGluZycpO1xuICAgICAgICB1LmludGVudCA9IFwiTm9uZVwiO1xuICAgICAgICB1LnNjb3JlID0gMC4xO1xuICAgICAgICB2YXIgZTEgPSB7fTtcbiAgICAgICAgZTEuc3RhcnRJbmRleCA9IFwiZXhpdCBcIi5sZW5ndGg7XG4gICAgICAgIGUxLmVuZEluZGV4ID0gY29udGV4dC5tZXNzYWdlLnRleHQubGVuZ3RoO1xuICAgICAgICBlMS5zY29yZSA9IDAuMTtcbiAgICAgICAgdS5lbnRpdGllcyA9IFtdO1xuICAgICAgICBjYWxsYmFjayh1bmRlZmluZWQsIHUpO1xuICAgIH07XG4gICAgcmV0dXJuIFNpbXBsZVJlY29nbml6ZXI7XG59KCkpO1xudmFyIFNpbXBsZVVwRG93blJlY29nbml6ZXIgPSAoZnVuY3Rpb24gKCkge1xuICAgIGZ1bmN0aW9uIFNpbXBsZVVwRG93blJlY29nbml6ZXIoKSB7XG4gICAgfVxuICAgIFNpbXBsZVVwRG93blJlY29nbml6ZXIucHJvdG90eXBlLnJlY29nbml6ZSA9IGZ1bmN0aW9uIChjb250ZXh0LCBjYWxsYmFjaykge1xuICAgICAgICB2YXIgdSA9IHt9O1xuICAgICAgICBjb25zb2xlLmxvZyhcInJlY29nbml6aW5nIFwiICsgY29udGV4dC5tZXNzYWdlLnRleHQpO1xuICAgICAgICBpZiAoY29udGV4dC5tZXNzYWdlLnRleHQuaW5kZXhPZihcImRvd25cIikgPj0gMCkge1xuICAgICAgICAgICAgdS5pbnRlbnQgPSBcImludGVudC5kb3duXCI7XG4gICAgICAgICAgICB1LnNjb3JlID0gMC45O1xuICAgICAgICAgICAgdmFyIGUxID0ge307XG4gICAgICAgICAgICBlMS5zdGFydEluZGV4ID0gXCJzdGFydCBcIi5sZW5ndGg7XG4gICAgICAgICAgICBlMS5lbmRJbmRleCA9IGNvbnRleHQubWVzc2FnZS50ZXh0Lmxlbmd0aDtcbiAgICAgICAgICAgIGUxLnNjb3JlID0gMC4zO1xuICAgICAgICAgICAgdS5lbnRpdGllcyA9IFtlMV07XG4gICAgICAgICAgICBjYWxsYmFjayh1bmRlZmluZWQsIHUpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb250ZXh0Lm1lc3NhZ2UudGV4dC5pbmRleE9mKFwidXBcIikgPj0gMCkge1xuICAgICAgICAgICAgdS5pbnRlbnQgPSBcImludGVudC51cFwiO1xuICAgICAgICAgICAgdS5zY29yZSA9IDAuOTtcbiAgICAgICAgICAgIHZhciBlMSA9IHt9O1xuICAgICAgICAgICAgZTEuc3RhcnRJbmRleCA9IFwidXBcIi5sZW5ndGg7XG4gICAgICAgICAgICBlMS5lbmRJbmRleCA9IGNvbnRleHQubWVzc2FnZS50ZXh0Lmxlbmd0aDtcbiAgICAgICAgICAgIGUxLnNjb3JlID0gMC4zO1xuICAgICAgICAgICAgdS5lbnRpdGllcyA9IFtlMV07XG4gICAgICAgICAgICBjYWxsYmFjayh1bmRlZmluZWQsIHUpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnNvbGUubG9nKCdyZWNvZ25pemluZyBub3RoaW5nJyk7XG4gICAgICAgIHUuaW50ZW50ID0gXCJOb25lXCI7XG4gICAgICAgIHUuc2NvcmUgPSAwLjE7XG4gICAgICAgIHZhciBlMSA9IHt9O1xuICAgICAgICBlMS5zdGFydEluZGV4ID0gXCJleGl0IFwiLmxlbmd0aDtcbiAgICAgICAgZTEuZW5kSW5kZXggPSBjb250ZXh0Lm1lc3NhZ2UudGV4dC5sZW5ndGg7XG4gICAgICAgIGUxLnNjb3JlID0gMC4xO1xuICAgICAgICB1LmVudGl0aWVzID0gW107XG4gICAgICAgIGNhbGxiYWNrKHVuZGVmaW5lZCwgdSk7XG4gICAgfTtcbiAgICByZXR1cm4gU2ltcGxlVXBEb3duUmVjb2duaXplcjtcbn0oKSk7XG52YXIgQW55T2JqZWN0ID0gT2JqZWN0O1xuLy8gZ2xvYmFsVHVubmVsLmluaXRpYWxpemUoe1xuLy8gIGhvc3Q6ICdwcm94eS5leHh4YW1wbGUuY29tJyxcbi8vICBwb3J0OiA4MDgwXG4vLyB9KVxuLy8gQ3JlYXRlIGJvdCBhbmQgYmluZCB0byBjb25zb2xlXG4vLyB2YXIgY29ubmVjdG9yID0gbmV3IGh0bWxjb25uZWN0b3IuSFRNTENvbm5lY3RvcigpXG4vLyBjb25uZWN0b3Iuc2V0QW5zd2VySG9vayhmdW5jdGlvbiAoc0Fuc3dlcikge1xuLy8gIGNvbnNvbGUubG9nKCdHb3QgYW5zd2VyIDogJyArIHNBbnN3ZXIgKyAnXFxuJylcbi8vIH0pXG52YXIgYm90O1xuLy8gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4vLyAgIGNvbm5lY3Rvci5wcm9jZXNzTWVzc2FnZSgnc3RhcnQgdW5pdCB0ZXN0IEFCQyAnKVxuLy8gfSwgNTAwMClcbnZhciBmcyA9IHJlcXVpcmUoJ2ZzJyk7XG52YXIgb0pTT04gPSBKU09OLnBhcnNlKCcnICsgZnMucmVhZEZpbGVTeW5jKCcuL3Jlc291cmNlcy9tb2RlbC9pbnRlbnRzLmpzb24nKSk7XG52YXIgb1J1bGVzID0gUGxhaW5SZWNvZ25pemVyLnBhcnNlUnVsZXMob0pTT04pO1xuLy8gdmFyIFJlY29nbml6ZXIgPSBuZXcgKHJlY29nbml6ZXIuUmVnRXhwUmVjb2duaXplcikob1J1bGVzKTtcbmZ1bmN0aW9uIGxvZ1F1ZXJ5KHNlc3Npb24sIGludGVudCwgcmVzdWx0KSB7XG4gICAgZnMuYXBwZW5kRmlsZSgnLi9sb2dzL3Nob3dtZXF1ZXJpZXMudHh0JywgXCJcXG5cIiArIEpTT04uc3RyaW5naWZ5KHtcbiAgICAgICAgdGV4dDogc2Vzc2lvbi5tZXNzYWdlLnRleHQsXG4gICAgICAgIHRpbWVzdGFtcDogc2Vzc2lvbi5tZXNzYWdlLnRpbWVzdGFtcCxcbiAgICAgICAgaW50ZW50OiBpbnRlbnQsXG4gICAgICAgIHJlczogcmVzdWx0ICYmIHJlc3VsdC5sZW5ndGggJiYgTWF0Y2guVG9vbE1hdGNoLmR1bXBOaWNlKHJlc3VsdFswXSkgfHwgXCIwXCIsXG4gICAgICAgIGNvbnZlcnNhdGlvbklkOiBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzc1xuICAgICAgICAgICAgJiYgc2Vzc2lvbi5tZXNzYWdlLmFkZHJlc3MuY29udmVyc2F0aW9uXG4gICAgICAgICAgICAmJiBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzcy5jb252ZXJzYXRpb24uaWQgfHwgXCJcIixcbiAgICAgICAgdXNlcmlkOiBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzc1xuICAgICAgICAgICAgJiYgc2Vzc2lvbi5tZXNzYWdlLmFkZHJlc3MudXNlclxuICAgICAgICAgICAgJiYgc2Vzc2lvbi5tZXNzYWdlLmFkZHJlc3MudXNlci5pZCB8fCBcIlwiXG4gICAgfSksIGZ1bmN0aW9uIChlcnIsIHJlcykge1xuICAgICAgICBpZiAoZXJyKSB7XG4gICAgICAgICAgICBkZWJ1Z2xvZyhcImxvZ2dpbmcgZmFpbGVkIFwiICsgZXJyKTtcbiAgICAgICAgfVxuICAgIH0pO1xufVxuZnVuY3Rpb24gbG9nUXVlcnlXaGF0SXMoc2Vzc2lvbiwgaW50ZW50LCByZXN1bHQpIHtcbiAgICBmcy5hcHBlbmRGaWxlKCcuL2xvZ3Mvc2hvd21lcXVlcmllcy50eHQnLCBcIlxcblwiICsgSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICB0ZXh0OiBzZXNzaW9uLm1lc3NhZ2UudGV4dCxcbiAgICAgICAgdGltZXN0YW1wOiBzZXNzaW9uLm1lc3NhZ2UudGltZXN0YW1wLFxuICAgICAgICBpbnRlbnQ6IGludGVudCxcbiAgICAgICAgcmVzOiByZXN1bHQgJiYgcmVzdWx0Lmxlbmd0aCAmJiBXaGF0SXMuZHVtcE5pY2UocmVzdWx0WzBdKSB8fCBcIjBcIixcbiAgICAgICAgY29udmVyc2F0aW9uSWQ6IHNlc3Npb24ubWVzc2FnZS5hZGRyZXNzXG4gICAgICAgICAgICAmJiBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzcy5jb252ZXJzYXRpb25cbiAgICAgICAgICAgICYmIHNlc3Npb24ubWVzc2FnZS5hZGRyZXNzLmNvbnZlcnNhdGlvbi5pZCB8fCBcIlwiLFxuICAgICAgICB1c2VyaWQ6IHNlc3Npb24ubWVzc2FnZS5hZGRyZXNzXG4gICAgICAgICAgICAmJiBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzcy51c2VyXG4gICAgICAgICAgICAmJiBzZXNzaW9uLm1lc3NhZ2UuYWRkcmVzcy51c2VyLmlkIHx8IFwiXCJcbiAgICB9KSwgZnVuY3Rpb24gKGVyciwgcmVzKSB7XG4gICAgICAgIGlmIChlcnIpIHtcbiAgICAgICAgICAgIGRlYnVnbG9nKFwibG9nZ2luZyBmYWlsZWQgXCIgKyBlcnIpO1xuICAgICAgICB9XG4gICAgfSk7XG59XG52YXIgZ3dvcmRzID0ge307XG4vKipcbiAqIENvbnN0cnVjdCBhIGJvdFxuICogQHBhcmFtIGNvbm5lY3RvciB7Q29ubmVjdG9yfSB0aGUgY29ubmVjdG9yIHRvIHVzZVxuICogSFRNTENvbm5lY3RvclxuICogb3IgY29ubmVjdG9yID0gbmV3IGJ1aWxkZXIuQ29uc29sZUNvbm5lY3RvcigpLmxpc3RlbigpXG4gKi9cbmZ1bmN0aW9uIG1ha2VCb3QoY29ubmVjdG9yKSB7XG4gICAgYm90ID0gbmV3IGJ1aWxkZXIuVW5pdmVyc2FsQm90KGNvbm5lY3Rvcik7XG4gICAgLy8gQ3JlYXRlIExVSVMgcmVjb2duaXplciB0aGF0IHBvaW50cyBhdCBvdXIgbW9kZWwgYW5kIGFkZCBpdCBhcyB0aGUgcm9vdCAnLycgZGlhbG9nIGZvciBvdXIgQ29ydGFuYSBCb3QuXG4gICAgLy8gdmFyIG1vZGVsID0gc2Vuc2l0aXZlLm1vZGVsdXJsO1xuICAgIC8vIHZhciBtb2RlbCA9ICdodHRwczovL2FwaS5wcm9qZWN0b3hmb3JkLmFpL2x1aXMvdjIuMC9hcHBzL2M0MTNiMmVmLTM4MmMtNDViZC04ZmYwLWY3NmQ2MGUyYTgyMT9zdWJzY3JpcHRpb24ta2V5PWMyMTM5OGI1OTgwYTRjZTA5ZjQ3NGJiZmVlOTNiODkyJnE9J1xuICAgIHZhciByZWNvZ25pemVyID0gbmV3IFBsYWluUmVjb2duaXplci5SZWdFeHBSZWNvZ25pemVyKG9SdWxlcyk7XG4gICAgdmFyIGRpYWxvZyA9IG5ldyBidWlsZGVyLkludGVudERpYWxvZyh7IHJlY29nbml6ZXJzOiBbcmVjb2duaXplcl0gfSk7XG4gICAgLy8gZGlhbG9nLm9uQmVnaW4oZnVuY3Rpb24oc2Vzc2lvbixhcmdzKSB7XG4gICAgLy8gY29uc29sZS5sb2coXCJiZWdpbm5pbmcgLi4uXCIpXG4gICAgLy8gc2Vzc2lvbi5kaWFsb2dEYXRhLnJldHJ5UHJvbXB0ID0gYXJncyAmJiBhcmdzLnJldHJ5UHJvbXB0IHx8IFwiSSBhbSBzb3JyeVwiXG4gICAgLy8gc2Vzc2lvbi5zZW5kKFwiV2hhdCBkbyB5b3Ugd2FudD9cIilcbiAgICAvL1xuICAgIC8vIH0pXG4gICAgdmFyIGRpYWxvZ1VwRG93biA9IG5ldyBidWlsZGVyLkludGVudERpYWxvZyh7IHJlY29nbml6ZXJzOiBbbmV3IFNpbXBsZVVwRG93blJlY29nbml6ZXIoKV0gfSk7XG4gICAgYm90LmRpYWxvZygnL3VwZG93bicsIGRpYWxvZ1VwRG93bik7XG4gICAgZGlhbG9nVXBEb3duLm9uQmVnaW4oZnVuY3Rpb24gKHNlc3Npb24pIHtcbiAgICAgICAgc2Vzc2lvbi5zZW5kKFwiSGkgdGhlcmUsIHVwZG93biBpcyB3YWl0aW5nIGZvciB5b3VcIik7XG4gICAgfSk7XG4gICAgZGlhbG9nVXBEb3duLm1hdGNoZXMoJ2ludGVudC51cCcsIFtcbiAgICAgICAgZnVuY3Rpb24gKHNlc3Npb24sIGFyZ3MsIG5leHQpIHtcbiAgICAgICAgICAgIHNlc3Npb24uZGlhbG9nRGF0YS5hYmMgPSBhcmdzIHx8IHt9O1xuICAgICAgICAgICAgYnVpbGRlci5Qcm9tcHRzLnRleHQoc2Vzc2lvbiwgJ3lvdSB3YW50IHRvIGdvIHVwJyk7XG4gICAgICAgIH0sXG4gICAgICAgIGZ1bmN0aW9uIChzZXNzaW9uLCByZXN1bHRzLCBuZXh0KSB7XG4gICAgICAgICAgICBzZXNzaW9uLmRpYWxvZ0RhdGEuYWJjID0gcmVzdWx0cy5yZXBvbnNlO1xuICAgICAgICAgICAgbmV4dCgpO1xuICAgICAgICB9LFxuICAgICAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgcmVzdWx0cykge1xuICAgICAgICAgICAgc2Vzc2lvbi5lbmREaWFsb2dXaXRoUmVzdWx0KHsgcmVzcG9uc2U6IHNlc3Npb24uZGlhbG9nRGF0YS5hYmMgfSk7XG4gICAgICAgIH1cbiAgICBdKTtcbiAgICBkaWFsb2dVcERvd24ubWF0Y2hlcygnaW50ZW50LmRvd24nLCBbXG4gICAgICAgIGZ1bmN0aW9uIChzZXNzaW9uLCBhcmdzLCBuZXh0KSB7XG4gICAgICAgICAgICBzZXNzaW9uLmRpYWxvZ0RhdGEuYWJjID0gYXJncyB8fCB7fTtcbiAgICAgICAgICAgIGJ1aWxkZXIuUHJvbXB0cy50ZXh0KHNlc3Npb24sICd5b3Ugd2FudCB0byBnbyBkb3duIScpO1xuICAgICAgICB9LFxuICAgICAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgcmVzdWx0cywgbmV4dCkge1xuICAgICAgICAgICAgc2Vzc2lvbi5kaWFsb2dEYXRhLmFiYyA9IC0xOyAvLyByZXN1bHRzLnJlcG9uc2U7XG4gICAgICAgICAgICBuZXh0KCk7XG4gICAgICAgIH0sXG4gICAgICAgIGZ1bmN0aW9uIChzZXNzaW9uLCByZXN1bHRzKSB7XG4gICAgICAgICAgICBzZXNzaW9uLnNlbmQoXCJzdGlsbCBnb2luZyBkb3duP1wiKTtcbiAgICAgICAgfVxuICAgIF0pO1xuICAgIGRpYWxvZ1VwRG93bi5vbkRlZmF1bHQoZnVuY3Rpb24gKHNlc3Npb24pIHtcbiAgICAgICAgbG9nUXVlcnkoc2Vzc2lvbiwgXCJvbkRlZmF1bHRcIik7XG4gICAgICAgIHNlc3Npb24uc2VuZChcIllvdSBhcmUgdHJhcHBlZCBpbiBhIGRpYWxvZyB3aGljaCBvbmx5IHVuZGVyc3RhbmRzIHVwIGFuZCBkb3duLCBvbmUgb2YgdGhlbSB3aWxsIGdldCB5b3Ugb3V0XCIpO1xuICAgICAgICAvL2J1aWxkZXIuRGlhbG9nQWN0aW9uLnNlbmQoJ0lcXCdtIHNvcnJ5IEkgZGlkblxcJ3QgdW5kZXJzdGFuZC4gSSBjYW4gb25seSBzaG93IHN0YXJ0IGFuZCByaW5nJyk7XG4gICAgfSk7XG4gICAgYm90LmRpYWxvZygnL3RyYWluJywgW1xuICAgICAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgYXJncywgbmV4dCkge1xuICAgICAgICAgICAgc2Vzc2lvbi5kaWFsZ29EYXRhLmFiYyA9IGFyZ3MgfHwge307XG4gICAgICAgICAgICBidWlsZGVyLlByb21wdHMudGV4dChzZXNzaW9uLCAnRG8geW91IHdhbnQgdG8gdHJhaW4gbWUnKTtcbiAgICAgICAgfSxcbiAgICAgICAgZnVuY3Rpb24gKHNlc3Npb24sIHJlc3VsdHMsIG5leHQpIHtcbiAgICAgICAgICAgIHNlc3Npb24uZGlhbG9nRGF0YS5hYmMgPSByZXN1bHRzLnJlcG9uc2U7XG4gICAgICAgIH0sXG4gICAgICAgIGZ1bmN0aW9uIChzZXNzaW9uLCByZXN1bHRzKSB7XG4gICAgICAgICAgICBzZXNzaW9uLmVuZERpYWxvZ1dpdGhSZXN1bHQoeyByZXNwb25zZTogc2Vzc2lvbi5EaWFsb2dEYXRhLmFiYyB9KTtcbiAgICAgICAgfVxuICAgIF0pO1xuICAgIGJvdC5kaWFsb2coJy8nLCBkaWFsb2cpO1xuICAgIGRpYWxvZy5tYXRjaGVzKCdTaG93TWUnLCBbXG4gICAgICAgIGZ1bmN0aW9uIChzZXNzaW9uLCBhcmdzLCBuZXh0KSB7XG4gICAgICAgICAgICB2YXIgaXNDb21iaW5lZEluZGV4ID0ge307XG4gICAgICAgICAgICB2YXIgb05ld0VudGl0eTtcbiAgICAgICAgICAgIC8vIGV4cGVjdGluZyBlbnRpdHkgQTFcbiAgICAgICAgICAgIGRlYnVnbG9nKFwiU2hvdyBFbnRpdHlcIik7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygncmF3OiAnICsgSlNPTi5zdHJpbmdpZnkoYXJncy5lbnRpdGllcyksIHVuZGVmaW5lZCwgMik7XG4gICAgICAgICAgICB2YXIgYTEgPSBidWlsZGVyLkVudGl0eVJlY29nbml6ZXIuZmluZEVudGl0eShhcmdzLmVudGl0aWVzLCAnQTEnKTtcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSBBbmFseXplLmFuYWx5emVBbGwoYTEuZW50aXR5LCB0aGVNb2RlbC5tUnVsZXMsIHRoZU1vZGVsLnRvb2xzLCBnd29yZHMpO1xuICAgICAgICAgICAgbG9nUXVlcnkoc2Vzc2lvbiwgJ1Nob3dNZScsIHJlc3VsdCk7XG4gICAgICAgICAgICAvLyB0ZXN0LmV4cGVjdCgzKVxuICAgICAgICAgICAgLy8gIHRlc3QuZGVlcEVxdWFsKHJlc3VsdC53ZWlnaHQsIDEyMCwgJ2NvcnJlY3Qgd2VpZ2h0Jyk7XG4gICAgICAgICAgICBpZiAoIXJlc3VsdCB8fCByZXN1bHQubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgbmV4dCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gZGVidWdsb2coJ3Jlc3VsdCA6ICcgKyBKU09OLnN0cmluZ2lmeShyZXN1bHQsIHVuZGVmaW5lZCwgMikpO1xuICAgICAgICAgICAgZGVidWdsb2coJ2Jlc3QgcmVzdWx0IDogJyArIEpTT04uc3RyaW5naWZ5KHJlc3VsdFswXSB8fCB7fSwgdW5kZWZpbmVkLCAyKSk7XG4gICAgICAgICAgICBkZWJ1Z2xvZygndG9wIDogJyArIE1hdGNoLlRvb2xNYXRjaC5kdW1wV2VpZ2h0c1RvcChyZXN1bHQsIHsgdG9wOiAzIH0pKTtcbiAgICAgICAgICAgIGlmIChBbmFseXplLmlzQ29tcGxldGUocmVzdWx0WzBdKSkge1xuICAgICAgICAgICAgICAgIHNlc3Npb24uZGlhbG9nRGF0YS5yZXN1bHQgPSByZXN1bHRbMF07XG4gICAgICAgICAgICAgICAgLy8gICAgc2Vzc2lvbi5zZW5kKCdTaG93aW5nIGVudGl0eSAuLi4nKTtcbiAgICAgICAgICAgICAgICBuZXh0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChBbmFseXplLmdldFByb21wdChyZXN1bHRbMF0pKSB7XG4gICAgICAgICAgICAgICAgdmFyIHByb21wdCA9IEFuYWx5emUuZ2V0UHJvbXB0KHJlc3VsdFswXSk7XG4gICAgICAgICAgICAgICAgc2Vzc2lvbi5kaWFsb2dEYXRhLnJlc3VsdCA9IHJlc3VsdFswXTtcbiAgICAgICAgICAgICAgICBzZXNzaW9uLmRpYWxvZ0RhdGEucHJvbXB0ID0gcHJvbXB0O1xuICAgICAgICAgICAgICAgIHNlc3Npb24uc2VuZChcIk5vdCBlbm91Z2ggaW5mb3JtYXRpb24gc3VwcGxpZWQ6IFwiICsgTWF0Y2guVG9vbE1hdGNoLmR1bXBOaWNlKHNlc3Npb24uZGlhbG9nRGF0YS5yZXN1bHQpKTtcbiAgICAgICAgICAgICAgICBidWlsZGVyLlByb21wdHMudGV4dChzZXNzaW9uLCBwcm9tcHQudGV4dCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICB2YXIgYmVzdCA9IHJlc3VsdC5sZW5ndGggPyBNYXRjaC5Ub29sTWF0Y2guZHVtcE5pY2UocmVzdWx0WzBdKSA6IFwiPG5vdGhpbmc+XCI7XG4gICAgICAgICAgICAgICAgLy9zZXNzaW9uLnNlbmQoJ0kgZGlkIG5vdCB1bmRlcnN0YW5kIHRoaXMnICsgYmVzdCk7XG4gICAgICAgICAgICAgICAgdmFyIHJlcGx5ID0gbmV3IGJ1aWxkZXIuTWVzc2FnZShzZXNzaW9uKVxuICAgICAgICAgICAgICAgICAgICAudGV4dCgnSSBkaWQgbm90IHVuZGVyc3RhbmQgdGhpcycgKyBiZXN0KVxuICAgICAgICAgICAgICAgICAgICAuYWRkRW50aXR5KHsgdXJsOiBcIkkgZG9uJ3Qga25vd1wiIH0pO1xuICAgICAgICAgICAgICAgIC8vIC5hZGRBdHRhY2htZW50KHsgZmFsbGJhY2tUZXh0OiBcIkkgZG9uJ3Qga25vd1wiLCBjb250ZW50VHlwZTogJ2ltYWdlL2pwZWcnLCBjb250ZW50VXJsOiBcInd3dy53b21iYXQub3JnXCIgfSk7XG4gICAgICAgICAgICAgICAgc2Vzc2lvbi5zZW5kKHJlcGx5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZnVuY3Rpb24gKHNlc3Npb24sIHJlc3VsdHMsIG5leHQpIHtcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSBzZXNzaW9uLmRpYWxvZ0RhdGEucmVzdWx0O1xuICAgICAgICAgICAgaWYgKCFyZXN1bHQgfHwgcmVzdWx0Lmxlbmd0aCA9PT0gMCkge1xuICAgICAgICAgICAgICAgIG5leHQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChyZXN1bHRzLnJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgLy8gc29tZSBwcm9tcHRpbmdcbiAgICAgICAgICAgICAgICBBbmFseXplLnNldFByb21wdChzZXNzaW9uLmRpYWxvZ0RhdGEucmVzdWx0LCBzZXNzaW9uLmRpYWxvZ0RhdGEucHJvbXB0LCByZXN1bHRzLnJlc3BvbnNlKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChBbmFseXplLmlzQ29tcGxldGUoc2Vzc2lvbi5kaWFsb2dEYXRhLnJlc3VsdCkpIHtcbiAgICAgICAgICAgICAgICBuZXh0KCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIGlmIChBbmFseXplLmdldFByb21wdChzZXNzaW9uLmRpYWxvZ0RhdGEucmVzdWx0KSkge1xuICAgICAgICAgICAgICAgIHZhciBwcm9tcHQgPSBBbmFseXplLmdldFByb21wdChzZXNzaW9uLmRpYWxvZ0RhdGEucmVzdWx0KTtcbiAgICAgICAgICAgICAgICBzZXNzaW9uLmRpYWxvZ0RhdGEucHJvbXB0ID0gcHJvbXB0O1xuICAgICAgICAgICAgICAgIGJ1aWxkZXIuUHJvbXB0cy50ZXh0KHNlc3Npb24sIHByb21wdC50ZXh0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZnVuY3Rpb24gKHNlc3Npb24sIHJlc3VsdHMsIG5leHQpIHtcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSBzZXNzaW9uLmRpYWxvZ0RhdGEucmVzdWx0O1xuICAgICAgICAgICAgaWYgKHJlc3VsdHMucmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICAvLyBzb21lIHByb21wdGluZ1xuICAgICAgICAgICAgICAgIEFuYWx5emUuc2V0UHJvbXB0KHNlc3Npb24uZGlhbG9nRGF0YS5yZXN1bHQsIHNlc3Npb24uZGlhbG9nRGF0YS5wcm9tcHQsIHJlc3VsdHMucmVzcG9uc2UpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgaWYgKEFuYWx5emUuaXNDb21wbGV0ZShzZXNzaW9uLmRpYWxvZ0RhdGEucmVzdWx0KSkge1xuICAgICAgICAgICAgICAgIHZhciBleGVjID0gRXhlY1NlcnZlci5leGVjVG9vbChzZXNzaW9uLmRpYWxvZ0RhdGEucmVzdWx0LCB0aGVNb2RlbC5yZWNvcmRzKTtcbiAgICAgICAgICAgICAgICB2YXIgcmVwbHkgPSBuZXcgYnVpbGRlci5NZXNzYWdlKHNlc3Npb24pXG4gICAgICAgICAgICAgICAgICAgIC50ZXh0KGV4ZWMudGV4dClcbiAgICAgICAgICAgICAgICAgICAgLmFkZEVudGl0eShleGVjLmFjdGlvbik7XG4gICAgICAgICAgICAgICAgLy8gLmFkZEF0dGFjaG1lbnQoeyBmYWxsYmFja1RleHQ6IFwiSSBkb24ndCBrbm93XCIsIGNvbnRlbnRUeXBlOiAnaW1hZ2UvanBlZycsIGNvbnRlbnRVcmw6IFwid3d3LndvbWJhdC5vcmdcIiB9KTtcbiAgICAgICAgICAgICAgICBzZXNzaW9uLnNlbmQocmVwbHkpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgaWYgKHNlc3Npb24uZGlhbG9nRGF0YS5yZXN1bHQpIHtcbiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbi5zZW5kKFwiTm90IGVub3VnaCBpbmZvcm1hdGlvbiBzdXBwbGllZDogXCIgKyBNYXRjaC5Ub29sTWF0Y2guZHVtcE5pY2Uoc2Vzc2lvbi5kaWFsb2dEYXRhLnJlc3VsdCkpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgc2Vzc2lvbi5zZW5kKFwiSSBkaWQgbm90IGdldCB3aGF0IHlvdSB3YW50XCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICBdKTtcbiAgICBkaWFsb2cubWF0Y2hlcygnV2hhdElzJywgW1xuICAgICAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgYXJncywgbmV4dCkge1xuICAgICAgICAgICAgdmFyIGlzQ29tYmluZWRJbmRleCA9IHt9O1xuICAgICAgICAgICAgdmFyIG9OZXdFbnRpdHk7XG4gICAgICAgICAgICAvLyBleHBlY3RpbmcgZW50aXR5IEExXG4gICAgICAgICAgICB2YXIgbWVzc2FnZSA9IHNlc3Npb24ubWVzc2FnZS50ZXh0O1xuICAgICAgICAgICAgZGVidWdsb2coXCJXaGF0SXMgRW50aXR5XCIpO1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ3JhdzogJyArIEpTT04uc3RyaW5naWZ5KGFyZ3MuZW50aXRpZXMpLCB1bmRlZmluZWQsIDIpO1xuICAgICAgICAgICAgdmFyIGNhdGVnb3J5RW50aXR5ID0gYnVpbGRlci5FbnRpdHlSZWNvZ25pemVyLmZpbmRFbnRpdHkoYXJncy5lbnRpdGllcywgJ2NhdGVnb3J5Jyk7XG4gICAgICAgICAgICB2YXIgY2F0ZWdvcnkgPSBjYXRlZ29yeUVudGl0eS5lbnRpdHk7XG4gICAgICAgICAgICB2YXIgYTEgPSBidWlsZGVyLkVudGl0eVJlY29nbml6ZXIuZmluZEVudGl0eShhcmdzLmVudGl0aWVzLCAnQTEnKTtcbiAgICAgICAgICAgIHZhciBjYXQgPSBXaGF0SXMuYW5hbHl6ZUNhdGVnb3J5KGNhdGVnb3J5LCB0aGVNb2RlbC5tUnVsZXMsIG1lc3NhZ2UpO1xuICAgICAgICAgICAgaWYgKCFjYXQpIHtcbiAgICAgICAgICAgICAgICBzZXNzaW9uLnNlbmQoJ0kgZG9uXFwndCBrbm93IGFueXRoaW5nIGFib3V0IFwiJyArIGNhdGVnb3J5ICsgJ1wiJyk7XG4gICAgICAgICAgICAgICAgbmV4dCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IFdoYXRJcy5yZXNvbHZlQ2F0ZWdvcnkoY2F0LCBhMS5lbnRpdHksIHRoZU1vZGVsLm1SdWxlcywgdGhlTW9kZWwucmVjb3Jkcyk7XG4gICAgICAgICAgICBsb2dRdWVyeVdoYXRJcyhzZXNzaW9uLCAnV2hhdElzJywgcmVzdWx0KTtcbiAgICAgICAgICAgIHZhciBpbmRpcyA9IFdoYXRJcy5pc0luZGlzY3JpbWluYXRlUmVzdWx0KHJlc3VsdCk7XG4gICAgICAgICAgICBpZiAoaW5kaXMpIHtcbiAgICAgICAgICAgICAgICBzZXNzaW9uLnNlbmQoaW5kaXMpO1xuICAgICAgICAgICAgICAgIG5leHQoKTtcbiAgICAgICAgICAgICAgICByZXR1cm47XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoIXJlc3VsdCB8fCByZXN1bHQubGVuZ3RoID09PSAwKSB7XG4gICAgICAgICAgICAgICAgc2Vzc2lvbi5zZW5kKCdJIGRvblxcJ3Qga25vdyBhbnl0aGluZyBhYm91dCBcIicgKyBjYXQgKyBcIiAoXCIgKyBjYXRlZ29yeSArICcpXFxcIiBpbiByZWxhdGlvbiB0byBcIicgKyBhMS5lbnRpdHkgKyAnXCInKTtcbiAgICAgICAgICAgICAgICBuZXh0KCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgLy8gZGVidWdsb2coJ3Jlc3VsdCA6ICcgKyBKU09OLnN0cmluZ2lmeShyZXN1bHQsIHVuZGVmaW5lZCwgMikpO1xuICAgICAgICAgICAgICAgIGRlYnVnbG9nKCdiZXN0IHJlc3VsdCA6ICcgKyBKU09OLnN0cmluZ2lmeShyZXN1bHRbMF0gfHwge30sIHVuZGVmaW5lZCwgMikpO1xuICAgICAgICAgICAgICAgIGRlYnVnbG9nKCd0b3AgOiAnICsgV2hhdElzLmR1bXBXZWlnaHRzVG9wKHJlc3VsdCwgeyB0b3A6IDMgfSkpO1xuICAgICAgICAgICAgICAgIC8vIFRPRE8gY2xlYW5zZWQgc2VudGVuY2VcbiAgICAgICAgICAgICAgICBzZXNzaW9uLnNlbmQoJ1RoZSAnICsgY2F0ZWdvcnkgKyAnIG9mICcgKyBhMS5lbnRpdHkgKyAnIGlzICcgKyByZXN1bHRbMF0ucmVzdWx0ICsgXCJcXG5cIik7IC8vICArIEpTT04uc3RyaW5naWZ5KHJlc3VsdFswXSkpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgXSk7XG4gICAgZGlhbG9nLm1hdGNoZXMoJ1dyb25nJywgW1xuICAgICAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgYXJncywgbmV4dCkge1xuICAgICAgICAgICAgc2Vzc2lvbi5iZWdpbkRpYWxvZygnL3VwZG93bicsIHNlc3Npb24udXNlckRhdGEuY291bnQpO1xuICAgICAgICB9LFxuICAgICAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgcmVzdWx0cywgbmV4dCkge1xuICAgICAgICAgICAgdmFyIGFsYXJtID0gc2Vzc2lvbi5kaWFsb2dEYXRhLmFsYXJtO1xuICAgICAgICAgICAgc2Vzc2lvbi5zZW5kKFwiYmFjayBmcm9tIHdyb25nIDogXCIgKyBKU09OLnN0cmluZ2lmeShyZXN1bHRzKSk7XG4gICAgICAgICAgICBuZXh0KCk7XG4gICAgICAgIH0sXG4gICAgICAgIGZ1bmN0aW9uIChzZXNzaW9uLCByZXN1bHRzKSB7XG4gICAgICAgICAgICBzZXNzaW9uLnNlbmQoJ2VuZCBvZiB3cm9uZycpO1xuICAgICAgICB9XG4gICAgXSk7XG4gICAgZGlhbG9nLm1hdGNoZXMoJ0V4aXQnLCBbXG4gICAgICAgIGZ1bmN0aW9uIChzZXNzaW9uLCBhcmdzLCBuZXh0KSB7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnZXhpdCA6Jyk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnZXhpdCcgKyBKU09OLnN0cmluZ2lmeShhcmdzLmVudGl0aWVzKSk7XG4gICAgICAgICAgICBzZXNzaW9uLnNlbmQoXCJ5b3UgYXJlIGluIGEgbG9naWMgbG9vcCBcIik7XG4gICAgICAgIH1cbiAgICBdKTtcbiAgICBkaWFsb2cubWF0Y2hlcygnSGVscCcsIFtcbiAgICAgICAgZnVuY3Rpb24gKHNlc3Npb24sIGFyZ3MsIG5leHQpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdoZWxwIDonKTtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdoZWxwJyk7XG4gICAgICAgICAgICBzZXNzaW9uLnNlbmQoXCJJIGtub3cgYWJvdXQgLi4uLiA8Y2F0ZWdvcmllcz4+XCIpO1xuICAgICAgICB9XG4gICAgXSk7XG4gICAgLy8gQWRkIGludGVudCBoYW5kbGVyc1xuICAgIGRpYWxvZy5tYXRjaGVzKCd0cmFpbicsIFtcbiAgICAgICAgZnVuY3Rpb24gKHNlc3Npb24sIGFyZ3MsIG5leHQpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCd0cmFpbicpO1xuICAgICAgICAgICAgLy8gUmVzb2x2ZSBhbmQgc3RvcmUgYW55IGVudGl0aWVzIHBhc3NlZCBmcm9tIExVSVMuXG4gICAgICAgICAgICB2YXIgdGl0bGUgPSBidWlsZGVyLkVudGl0eVJlY29nbml6ZXIuZmluZEVudGl0eShhcmdzLmVudGl0aWVzLCAnYnVpbHRpbi5hbGFybS50aXRsZScpO1xuICAgICAgICAgICAgdmFyIHRpbWUgPSBidWlsZGVyLkVudGl0eVJlY29nbml6ZXIucmVzb2x2ZVRpbWUoYXJncy5lbnRpdGllcyk7XG4gICAgICAgICAgICB2YXIgYWxhcm0gPSBzZXNzaW9uLmRpYWxvZ0RhdGEuYWxhcm0gPSB7XG4gICAgICAgICAgICAgICAgdGl0bGU6IHRpdGxlID8gdGl0bGUuZW50aXR5IDogbnVsbCxcbiAgICAgICAgICAgICAgICB0aW1lc3RhbXA6IHRpbWUgPyB0aW1lLmdldFRpbWUoKSA6IG51bGxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgICAvLyBQcm9tcHQgZm9yIHRpdGxlXG4gICAgICAgICAgICBpZiAoIWFsYXJtLnRpdGxlKSB7XG4gICAgICAgICAgICAgICAgYnVpbGRlci5Qcm9tcHRzLnRleHQoc2Vzc2lvbiwgJ1doYXQgZmFjdCB3b3VsZCB5b3UgbGlrZSB0byB0cmFpbj8nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIG5leHQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgZnVuY3Rpb24gKHNlc3Npb24sIHJlc3VsdHMsIG5leHQpIHtcbiAgICAgICAgICAgIHZhciBhbGFybSA9IHNlc3Npb24uZGlhbG9nRGF0YS5hbGFybTtcbiAgICAgICAgICAgIGlmIChyZXN1bHRzLnJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgYWxhcm0udGl0bGUgPSByZXN1bHRzLnJlc3BvbnNlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8gUHJvbXB0IGZvciB0aW1lICh0aXRsZSB3aWxsIGJlIGJsYW5rIGlmIHRoZSB1c2VyIHNhaWQgY2FuY2VsKVxuICAgICAgICAgICAgaWYgKGFsYXJtLnRpdGxlICYmICFhbGFybS50aW1lc3RhbXApIHtcbiAgICAgICAgICAgICAgICBidWlsZGVyLlByb21wdHMudGltZShzZXNzaW9uLCAnV2hhdCB0aW1lIHdvdWxkIHlvdSBsaWtlIHRvIHNldCB0aGUgYWxhcm0gZm9yPycpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbmV4dCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBmdW5jdGlvbiAoc2Vzc2lvbiwgcmVzdWx0cykge1xuICAgICAgICAgICAgdmFyIGFsYXJtID0gc2Vzc2lvbi5kaWFsb2dEYXRhLmFsYXJtO1xuICAgICAgICAgICAgaWYgKHJlc3VsdHMucmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICB2YXIgdGltZSA9IGJ1aWxkZXIuRW50aXR5UmVjb2duaXplci5yZXNvbHZlVGltZShbcmVzdWx0cy5yZXNwb25zZV0pO1xuICAgICAgICAgICAgICAgIGFsYXJtLnRpbWVzdGFtcCA9IHRpbWUgPyB0aW1lLmdldFRpbWUoKSA6IG51bGw7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICAvLyBTZXQgdGhlIGFsYXJtIChpZiB0aXRsZSBvciB0aW1lc3RhbXAgaXMgYmxhbmsgdGhlIHVzZXIgc2FpZCBjYW5jZWwpXG4gICAgICAgICAgICBpZiAoYWxhcm0udGl0bGUgJiYgYWxhcm0udGltZXN0YW1wKSB7XG4gICAgICAgICAgICAgICAgLy8gU2F2ZSBhZGRyZXNzIG9mIHdobyB0byBub3RpZnkgYW5kIHdyaXRlIHRvIHNjaGVkdWxlci5cbiAgICAgICAgICAgICAgICBhbGFybS5hZGRyZXNzID0gc2Vzc2lvbi5tZXNzYWdlLmFkZHJlc3M7XG4gICAgICAgICAgICAgICAgLy9hbGFybXNbYWxhcm0udGl0bGVdID0gYWxhcm07XG4gICAgICAgICAgICAgICAgLy8gU2VuZCBjb25maXJtYXRpb24gdG8gdXNlclxuICAgICAgICAgICAgICAgIHZhciBkYXRlID0gbmV3IERhdGUoYWxhcm0udGltZXN0YW1wKTtcbiAgICAgICAgICAgICAgICB2YXIgaXNBTSA9IGRhdGUuZ2V0SG91cnMoKSA8IDEyO1xuICAgICAgICAgICAgICAgIHNlc3Npb24uc2VuZCgnQ3JlYXRpbmcgYWxhcm0gbmFtZWQgXCIlc1wiIGZvciAlZC8lZC8lZCAlZDolMDJkJXMnLCBhbGFybS50aXRsZSwgZGF0ZS5nZXRNb250aCgpICsgMSwgZGF0ZS5nZXREYXRlKCksIGRhdGUuZ2V0RnVsbFllYXIoKSwgaXNBTSA/IGRhdGUuZ2V0SG91cnMoKSA6IGRhdGUuZ2V0SG91cnMoKSAtIDEyLCBkYXRlLmdldE1pbnV0ZXMoKSwgaXNBTSA/ICdhbScgOiAncG0nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHNlc3Npb24uc2VuZCgnT2suLi4gbm8gcHJvYmxlbS4nKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIF0pO1xuICAgIGRpYWxvZy5vbkRlZmF1bHQoZnVuY3Rpb24gKHNlc3Npb24pIHtcbiAgICAgICAgbG9nUXVlcnkoc2Vzc2lvbiwgXCJvbkRlZmF1bHRcIik7XG4gICAgICAgIHZhciBlbGl6YSA9IGdldEVsaXphQm90KGdldENvbnZlcnNhdGlvbklkKHNlc3Npb24pKTtcbiAgICAgICAgdmFyIHJlcGx5ID0gZWxpemEudHJhbnNmb3JtKHNlc3Npb24ubWVzc2FnZS50ZXh0KTtcbiAgICAgICAgc2Vzc2lvbi5zZW5kKHJlcGx5KTtcbiAgICAgICAgLy9uZXcgRWlsemFib3RcbiAgICAgICAgLy9zZXNzaW9uLnNlbmQoXCJJIGRvIG5vdCB1bmRlcnN0YW5kIHRoaXMgYXQgYWxsXCIpO1xuICAgICAgICAvL2J1aWxkZXIuRGlhbG9nQWN0aW9uLnNlbmQoJ0lcXCdtIHNvcnJ5IEkgZGlkblxcJ3QgdW5kZXJzdGFuZC4gSSBjYW4gb25seSBzaG93IHN0YXJ0IGFuZCByaW5nJyk7XG4gICAgfSk7XG4gICAgLypcbiAgICAvLyBWZXJ5IHNpbXBsZSBhbGFybSBzY2hlZHVsZXJcbiAgICB2YXIgYWxhcm1zID0ge307XG4gICAgc2V0SW50ZXJ2YWwoZnVuY3Rpb24gKCkge1xuICAgICAgdmFyIG5vdyA9IG5ldyBEYXRlKCkuZ2V0VGltZSgpO1xuICAgICAgZm9yICh2YXIga2V5IGluIGFsYXJtcykge1xuICAgICAgICB2YXIgYWxhcm0gPSBhbGFybXNba2V5XTtcbiAgICAgICAgaWYgKG5vdyA+PSBhbGFybS50aW1lc3RhbXApIHtcbiAgICAgICAgICB2YXIgbXNnID0gbmV3IGJ1aWxkZXIuTWVzc2FnZSgpXG4gICAgICAgICAgICAuYWRkcmVzcyhhbGFybS5hZGRyZXNzKVxuICAgICAgICAgICAgLnRleHQoJ0hlcmVcXCdzIHlvdXIgXFwnJXNcXCcgYWxhcm0uJywgYWxhcm0udGl0bGUpO1xuICAgICAgICAgIGJvdC5zZW5kKG1zZyk7XG4gICAgICAgICAgZGVsZXRlIGFsYXJtc1trZXldO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSwgMTUwMDApO1xuICAgICovXG59XG5pZiAobW9kdWxlKSB7XG4gICAgbW9kdWxlLmV4cG9ydHMgPSB7XG4gICAgICAgIG1ha2VCb3Q6IG1ha2VCb3RcbiAgICB9O1xufVxuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
