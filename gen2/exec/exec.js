/**
 * Functionality to execute a certain response
 *
 * via a) commandline (e.g. browser startup)
 * @file
 */
"use strict";

var debug = require('debug');
var IFMatch = require('../match/ifmatch');
var debuglog = debug('dispatcher');
var child_process_1 = require('child_process');
(function (EnumResponseCode) {
    EnumResponseCode[EnumResponseCode["NOMATCH"] = 0] = "NOMATCH";
    EnumResponseCode[EnumResponseCode["EXEC"] = 1] = "EXEC";
    EnumResponseCode[EnumResponseCode["QUERY"] = 2] = "QUERY";
})(exports.EnumResponseCode || (exports.EnumResponseCode = {}));
var EnumResponseCode = exports.EnumResponseCode;
/**
 * Defines the interface for an analysis
 * reponse
 */
/*
export interface IResponse {
  rating : number,
  type : EnumResponseCode,
  query : string,
  context : { [key:string] :string},
  text : string,
  action : IAction,
  prompts : { [key :string ] : { text : string, description : any }; }


export const enum EnumActionType {
  STARTURL,
  STARTCMDLINE
}

export interface IAction {
  data : any,
  type : EnumActionType,
  pattern : string,
  concrete : string
}
}*/
//var exec = require('child_process').exec
function startBrowser(oUrlAction) {
    var cmd = '"%ProgramFiles(x86)%\\Google\\Chrome\\Application\\chrome.exe" --incognito -url "' + oUrlAction.concrete + '"';
    child_process_1.exec(cmd, function (error, stdout, stderr) {
        if (error) {
            console.error("exec error: " + error);
            return;
        }
        console.log("stdout: " + stdout);
        console.log("stderr: " + stderr);
    });
}
function startCommandLine(scmd) {
    var cmd = scmd.concrete;
    child_process_1.exec(cmd, function (error, stdout, stderr) {
        if (error) {
            console.error("exec error: " + error);
            return;
        }
        console.log("stdout: " + stdout);
        console.log("stderr: " + stderr);
    });
}
function expandContextIntoAction(oResult) {
    var pattern = oResult.action.pattern;
    Object.keys(oResult.context).forEach(function (sKey) {
        var regex = new RegExp('{' + sKey + '}', 'g');
        pattern = pattern.replace(regex, oResult.context[sKey]);
        pattern = pattern.replace(regex, oResult.context[sKey]);
    });
    oResult.action.concrete = pattern;
    return pattern;
}
exports.expandContextIntoAction = expandContextIntoAction;
/**
 * execute some starupt
 *
 */
function executeStartup(oResult, cb) {
    if (oResult.type !== 1 /* EXEC */) {
            return;
        }
    var action = oResult.action;
    if (oResult.action.type === 0 /* STARTURL */) {
            //var ptn = expandParametersInURL(oResult)
            startBrowser(action);
            return action.concrete;
        } else if (oResult.action.type === 1 /* STARTCMDLINE */) {
            startCommandLine(action);
        } else {
        var s = "Don't know how to start " + oResult.type + '\n for "' + oResult.query + '"';
        console.error(s);
        return s;
    }
}
module.exports = {
    executeStartup: executeStartup
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9leGVjL2V4ZWMudHMiLCJleGVjL2V4ZWMuanMiXSwibmFtZXMiOlsiZGVidWciLCJyZXF1aXJlIiwiSUZNYXRjaCIsImRlYnVnbG9nIiwiY2hpbGRfcHJvY2Vzc18xIiwiRW51bVJlc3BvbnNlQ29kZSIsImV4cG9ydHMiLCJzdGFydEJyb3dzZXIiLCJvVXJsQWN0aW9uIiwiY21kIiwiY29uY3JldGUiLCJleGVjIiwiZXJyb3IiLCJzdGRvdXQiLCJzdGRlcnIiLCJjb25zb2xlIiwibG9nIiwic3RhcnRDb21tYW5kTGluZSIsInNjbWQiLCJleHBhbmRDb250ZXh0SW50b0FjdGlvbiIsIm9SZXN1bHQiLCJwYXR0ZXJuIiwiYWN0aW9uIiwiT2JqZWN0Iiwia2V5cyIsImNvbnRleHQiLCJmb3JFYWNoIiwic0tleSIsInJlZ2V4IiwiUmVnRXhwIiwicmVwbGFjZSIsImV4ZWN1dGVTdGFydHVwIiwiY2IiLCJ0eXBlIiwicyIsInF1ZXJ5IiwibW9kdWxlIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7O0FDTUE7O0FER0EsSUFBWUEsUUFBS0MsUUFBTSxPQUFOLENBQWpCO0FBRUEsSUFBYUMsVUFBT0QsUUFBTSxrQkFBTixDQUFwQjtBQUVBLElBQU1FLFdBQVdILE1BQU0sWUFBTixDQUFqQjtBQUVBLElBQUFJLGtCQUFBSCxRQUFxQixlQUFyQixDQUFBO0FBR0EsQ0FBQSxVQUFrQkksZ0JBQWxCLEVBQWtDO0FBQ2hDQSxxQkFBQUEsaUJBQUEsU0FBQSxJQUFBLENBQUEsSUFBQSxTQUFBO0FBQ0FBLHFCQUFBQSxpQkFBQSxNQUFBLElBQUEsQ0FBQSxJQUFBLE1BQUE7QUFDQUEscUJBQUFBLGlCQUFBLE9BQUEsSUFBQSxDQUFBLElBQUEsT0FBQTtBQUNELENBSkQsRUFBa0JDLFFBQUFELGdCQUFBLEtBQUFDLFFBQUFELGdCQUFBLEdBQWdCLEVBQWhCLENBQWxCO0FBQUEsSUFBa0JBLG1CQUFBQyxRQUFBRCxnQkFBbEI7QUFNQTs7OztBQUlBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQXdCQTtBQUVBLFNBQUFFLFlBQUEsQ0FBdUJDLFVBQXZCLEVBQW1EO0FBQ2pELFFBQUlDLE1BQ0osc0ZBQXNGRCxXQUFXRSxRQUFqRyxHQUE0RyxHQUQ1RztBQUVBTixvQkFBQU8sSUFBQSxDQUFLRixHQUFMLEVBQVUsVUFBVUcsS0FBVixFQUFpQkMsTUFBakIsRUFBeUJDLE1BQXpCLEVBQStCO0FBQ3ZDLFlBQUlGLEtBQUosRUFBVztBQUNURyxvQkFBUUgsS0FBUixDQUFjLGlCQUFlQSxLQUE3QjtBQUNBO0FBQ0Q7QUFDREcsZ0JBQVFDLEdBQVIsQ0FBWSxhQUFXSCxNQUF2QjtBQUNBRSxnQkFBUUMsR0FBUixDQUFZLGFBQVdGLE1BQXZCO0FBQ0QsS0FQRDtBQVFEO0FBRUQsU0FBQUcsZ0JBQUEsQ0FBMkJDLElBQTNCLEVBQWlEO0FBQy9DLFFBQUlULE1BQU1TLEtBQUtSLFFBQWY7QUFDQU4sb0JBQUFPLElBQUEsQ0FBS0YsR0FBTCxFQUFVLFVBQVVHLEtBQVYsRUFBaUJDLE1BQWpCLEVBQXlCQyxNQUF6QixFQUErQjtBQUN2QyxZQUFJRixLQUFKLEVBQVc7QUFDVEcsb0JBQVFILEtBQVIsQ0FBYyxpQkFBZUEsS0FBN0I7QUFDQTtBQUNEO0FBQ0RHLGdCQUFRQyxHQUFSLENBQVksYUFBV0gsTUFBdkI7QUFDQUUsZ0JBQVFDLEdBQVIsQ0FBWSxhQUFXRixNQUF2QjtBQUNELEtBUEQ7QUFRRDtBQUdELFNBQUFLLHVCQUFBLENBQXlDQyxPQUF6QyxFQUFvRTtBQUNsRSxRQUFJQyxVQUFVRCxRQUFRRSxNQUFSLENBQWVELE9BQTdCO0FBQ0FFLFdBQU9DLElBQVAsQ0FBWUosUUFBUUssT0FBcEIsRUFBNkJDLE9BQTdCLENBQXFDLFVBQVVDLElBQVYsRUFBYztBQUNqRCxZQUFJQyxRQUFRLElBQUlDLE1BQUosQ0FBVyxNQUFNRixJQUFOLEdBQWEsR0FBeEIsRUFBNkIsR0FBN0IsQ0FBWjtBQUNBTixrQkFBVUEsUUFBUVMsT0FBUixDQUFnQkYsS0FBaEIsRUFBdUJSLFFBQVFLLE9BQVIsQ0FBZ0JFLElBQWhCLENBQXZCLENBQVY7QUFDQU4sa0JBQVVBLFFBQVFTLE9BQVIsQ0FBZ0JGLEtBQWhCLEVBQXVCUixRQUFRSyxPQUFSLENBQWdCRSxJQUFoQixDQUF2QixDQUFWO0FBQ0QsS0FKRDtBQUtBUCxZQUFRRSxNQUFSLENBQWVaLFFBQWYsR0FBMEJXLE9BQTFCO0FBQ0EsV0FBT0EsT0FBUDtBQUNEO0FBVGVmLFFBQUFhLHVCQUFBLEdBQXVCQSx1QkFBdkI7QUFXaEI7Ozs7QUFJQSxTQUFBWSxjQUFBLENBQXlCWCxPQUF6QixFQUFxRFksRUFBckQsRUFBcUc7QUFDbkcsUUFBSVosUUFBUWEsSUFBUixLQUFpQixDQUFyQixDQUFxQixVQUFyQixFQUFvRDtBQUNsRDtBQUNEO0FBQ0QsUUFBSVgsU0FBU0YsUUFBUUUsTUFBckI7QUFDQSxRQUFHRixRQUFRRSxNQUFSLENBQWVXLElBQWYsS0FBd0IsQ0FBM0IsQ0FBMkIsY0FBM0IsRUFBNEQ7QUFDMUQ7QUFDQTFCLHlCQUFhZSxNQUFiO0FBQ0EsbUJBQU9BLE9BQU9aLFFBQWQ7QUFDRCxTQUpELE1BSU8sSUFBR1UsUUFBUUUsTUFBUixDQUFlVyxJQUFmLEtBQXdCLENBQTNCLENBQTJCLGtCQUEzQixFQUFnRTtBQUNyRWhCLDZCQUFpQkssTUFBakI7QUFDRCxTQUZNLE1BRUE7QUFDTCxZQUFJWSxJQUFLLDZCQUE2QmQsUUFBUWEsSUFBckMsR0FBNEMsVUFBNUMsR0FBeURiLFFBQVFlLEtBQWpFLEdBQXlFLEdBQWxGO0FBQ0FwQixnQkFBUUgsS0FBUixDQUFjc0IsQ0FBZDtBQUNBLGVBQU9BLENBQVA7QUFDRDtBQUNGO0FBRURFLE9BQU85QixPQUFQLEdBQWlCO0FBQ2Z5QixvQkFBZ0JBO0FBREQsQ0FBakIiLCJmaWxlIjoiZXhlYy9leGVjLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXHJcbiAqIEZ1bmN0aW9uYWxpdHkgdG8gZXhlY3V0ZSBhIGNlcnRhaW4gcmVzcG9uc2VcclxuICpcclxuICogdmlhIGEpIGNvbW1hbmRsaW5lIChlLmcuIGJyb3dzZXIgc3RhcnR1cClcclxuICogQGZpbGVcclxuICovXHJcblxyXG5pbXBvcnQgKiBhcyBpbnRmIGZyb20gJ2NvbnN0YW50cyc7XHJcblxyXG5pbXBvcnQgKiBhcyBkZWJ1ZyBmcm9tICdkZWJ1Zyc7XHJcblxyXG5pbXBvcnQgKiAgYXMgSUZNYXRjaCBmcm9tICcuLi9tYXRjaC9pZm1hdGNoJztcclxuXHJcbmNvbnN0IGRlYnVnbG9nID0gZGVidWcoJ2Rpc3BhdGNoZXInKVxyXG5cclxuaW1wb3J0IHsgZXhlYyB9IGZyb20gJ2NoaWxkX3Byb2Nlc3MnO1xyXG5cclxuXHJcbmV4cG9ydCBjb25zdCBlbnVtIEVudW1SZXNwb25zZUNvZGUge1xyXG4gIE5PTUFUQ0ggPSAwLFxyXG4gIEVYRUMsXHJcbiAgUVVFUllcclxufVxyXG5cclxuLyoqXHJcbiAqIERlZmluZXMgdGhlIGludGVyZmFjZSBmb3IgYW4gYW5hbHlzaXNcclxuICogcmVwb25zZVxyXG4gKi9cclxuLypcclxuZXhwb3J0IGludGVyZmFjZSBJUmVzcG9uc2Uge1xyXG4gIHJhdGluZyA6IG51bWJlcixcclxuICB0eXBlIDogRW51bVJlc3BvbnNlQ29kZSxcclxuICBxdWVyeSA6IHN0cmluZyxcclxuICBjb250ZXh0IDogeyBba2V5OnN0cmluZ10gOnN0cmluZ30sXHJcbiAgdGV4dCA6IHN0cmluZyxcclxuICBhY3Rpb24gOiBJQWN0aW9uLFxyXG4gIHByb21wdHMgOiB7IFtrZXkgOnN0cmluZyBdIDogeyB0ZXh0IDogc3RyaW5nLCBkZXNjcmlwdGlvbiA6IGFueSB9OyB9XHJcblxyXG5cclxuZXhwb3J0IGNvbnN0IGVudW0gRW51bUFjdGlvblR5cGUge1xyXG4gIFNUQVJUVVJMLFxyXG4gIFNUQVJUQ01ETElORVxyXG59XHJcblxyXG5leHBvcnQgaW50ZXJmYWNlIElBY3Rpb24ge1xyXG4gIGRhdGEgOiBhbnksXHJcbiAgdHlwZSA6IEVudW1BY3Rpb25UeXBlLFxyXG4gIHBhdHRlcm4gOiBzdHJpbmcsXHJcbiAgY29uY3JldGUgOiBzdHJpbmdcclxufVxyXG59Ki9cclxuXHJcbi8vdmFyIGV4ZWMgPSByZXF1aXJlKCdjaGlsZF9wcm9jZXNzJykuZXhlY1xyXG5cclxuZnVuY3Rpb24gc3RhcnRCcm93c2VyIChvVXJsQWN0aW9uIDogSUZNYXRjaC5JQWN0aW9uKSB7XHJcbiAgdmFyIGNtZCA9XHJcbiAgJ1wiJVByb2dyYW1GaWxlcyh4ODYpJVxcXFxHb29nbGVcXFxcQ2hyb21lXFxcXEFwcGxpY2F0aW9uXFxcXGNocm9tZS5leGVcIiAtLWluY29nbml0byAtdXJsIFwiJyArIG9VcmxBY3Rpb24uY29uY3JldGUgKyAnXCInXHJcbiAgZXhlYyhjbWQsIGZ1bmN0aW9uIChlcnJvciwgc3Rkb3V0LCBzdGRlcnIpIHtcclxuICAgIGlmIChlcnJvcikge1xyXG4gICAgICBjb25zb2xlLmVycm9yKGBleGVjIGVycm9yOiAke2Vycm9yfWApXHJcbiAgICAgIHJldHVyblxyXG4gICAgfVxyXG4gICAgY29uc29sZS5sb2coYHN0ZG91dDogJHtzdGRvdXR9YClcclxuICAgIGNvbnNvbGUubG9nKGBzdGRlcnI6ICR7c3RkZXJyfWApXHJcbiAgfSlcclxufVxyXG5cclxuZnVuY3Rpb24gc3RhcnRDb21tYW5kTGluZSAoc2NtZCA6IElGTWF0Y2guSUFjdGlvbikge1xyXG4gIHZhciBjbWQgPSBzY21kLmNvbmNyZXRlO1xyXG4gIGV4ZWMoY21kLCBmdW5jdGlvbiAoZXJyb3IsIHN0ZG91dCwgc3RkZXJyKSB7XHJcbiAgICBpZiAoZXJyb3IpIHtcclxuICAgICAgY29uc29sZS5lcnJvcihgZXhlYyBlcnJvcjogJHtlcnJvcn1gKVxyXG4gICAgICByZXR1cm5cclxuICAgIH1cclxuICAgIGNvbnNvbGUubG9nKGBzdGRvdXQ6ICR7c3Rkb3V0fWApXHJcbiAgICBjb25zb2xlLmxvZyhgc3RkZXJyOiAke3N0ZGVycn1gKVxyXG4gIH0pXHJcbn1cclxuXHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZXhwYW5kQ29udGV4dEludG9BY3Rpb24gKG9SZXN1bHQgOiBJRk1hdGNoLklSZXNwb25zZSkge1xyXG4gIHZhciBwYXR0ZXJuID0gb1Jlc3VsdC5hY3Rpb24ucGF0dGVyblxyXG4gIE9iamVjdC5rZXlzKG9SZXN1bHQuY29udGV4dCkuZm9yRWFjaChmdW5jdGlvbiAoc0tleSkge1xyXG4gICAgdmFyIHJlZ2V4ID0gbmV3IFJlZ0V4cCgneycgKyBzS2V5ICsgJ30nLCAnZycpXHJcbiAgICBwYXR0ZXJuID0gcGF0dGVybi5yZXBsYWNlKHJlZ2V4LCBvUmVzdWx0LmNvbnRleHRbc0tleV0pXHJcbiAgICBwYXR0ZXJuID0gcGF0dGVybi5yZXBsYWNlKHJlZ2V4LCBvUmVzdWx0LmNvbnRleHRbc0tleV0pXHJcbiAgfSlcclxuICBvUmVzdWx0LmFjdGlvbi5jb25jcmV0ZSA9IHBhdHRlcm47XHJcbiAgcmV0dXJuIHBhdHRlcm5cclxufVxyXG5cclxuLyoqXHJcbiAqIGV4ZWN1dGUgc29tZSBzdGFydXB0XHJcbiAqXHJcbiAqL1xyXG5mdW5jdGlvbiBleGVjdXRlU3RhcnR1cCAob1Jlc3VsdDogSUZNYXRjaC5JUmVzcG9uc2UsIGNiOiAoZXJyIDogYW55LCBhIDogSUZNYXRjaC5JUmVzcG9uc2UpID0+IHN0cmluZykge1xyXG4gIGlmIChvUmVzdWx0LnR5cGUgIT09IElGTWF0Y2guRW51bVJlc3BvbnNlQ29kZS5FWEVDKSB7XHJcbiAgICByZXR1cm5cclxuICB9XHJcbiAgdmFyIGFjdGlvbiA9IG9SZXN1bHQuYWN0aW9uO1xyXG4gIGlmKG9SZXN1bHQuYWN0aW9uLnR5cGUgPT09IElGTWF0Y2guRW51bUFjdGlvblR5cGUuU1RBUlRVUkwpIHtcclxuICAgIC8vdmFyIHB0biA9IGV4cGFuZFBhcmFtZXRlcnNJblVSTChvUmVzdWx0KVxyXG4gICAgc3RhcnRCcm93c2VyKGFjdGlvbilcclxuICAgIHJldHVybiBhY3Rpb24uY29uY3JldGVcclxuICB9IGVsc2UgaWYob1Jlc3VsdC5hY3Rpb24udHlwZSA9PT0gSUZNYXRjaC5FbnVtQWN0aW9uVHlwZS5TVEFSVENNRExJTkUpIHtcclxuICAgIHN0YXJ0Q29tbWFuZExpbmUoYWN0aW9uKTtcclxuICB9IGVsc2Uge1xyXG4gICAgdmFyIHMgPSAoXCJEb24ndCBrbm93IGhvdyB0byBzdGFydCBcIiArIG9SZXN1bHQudHlwZSArICdcXG4gZm9yIFwiJyArIG9SZXN1bHQucXVlcnkgKyAnXCInKVxyXG4gICAgY29uc29sZS5lcnJvcihzKVxyXG4gICAgcmV0dXJuIHNcclxuICB9XHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0ge1xyXG4gIGV4ZWN1dGVTdGFydHVwOiBleGVjdXRlU3RhcnR1cFxyXG59XHJcbiIsIi8qKlxuICogRnVuY3Rpb25hbGl0eSB0byBleGVjdXRlIGEgY2VydGFpbiByZXNwb25zZVxuICpcbiAqIHZpYSBhKSBjb21tYW5kbGluZSAoZS5nLiBicm93c2VyIHN0YXJ0dXApXG4gKiBAZmlsZVxuICovXG5cInVzZSBzdHJpY3RcIjtcbnZhciBkZWJ1ZyA9IHJlcXVpcmUoJ2RlYnVnJyk7XG52YXIgSUZNYXRjaCA9IHJlcXVpcmUoJy4uL21hdGNoL2lmbWF0Y2gnKTtcbnZhciBkZWJ1Z2xvZyA9IGRlYnVnKCdkaXNwYXRjaGVyJyk7XG52YXIgY2hpbGRfcHJvY2Vzc18xID0gcmVxdWlyZSgnY2hpbGRfcHJvY2VzcycpO1xuKGZ1bmN0aW9uIChFbnVtUmVzcG9uc2VDb2RlKSB7XG4gICAgRW51bVJlc3BvbnNlQ29kZVtFbnVtUmVzcG9uc2VDb2RlW1wiTk9NQVRDSFwiXSA9IDBdID0gXCJOT01BVENIXCI7XG4gICAgRW51bVJlc3BvbnNlQ29kZVtFbnVtUmVzcG9uc2VDb2RlW1wiRVhFQ1wiXSA9IDFdID0gXCJFWEVDXCI7XG4gICAgRW51bVJlc3BvbnNlQ29kZVtFbnVtUmVzcG9uc2VDb2RlW1wiUVVFUllcIl0gPSAyXSA9IFwiUVVFUllcIjtcbn0pKGV4cG9ydHMuRW51bVJlc3BvbnNlQ29kZSB8fCAoZXhwb3J0cy5FbnVtUmVzcG9uc2VDb2RlID0ge30pKTtcbnZhciBFbnVtUmVzcG9uc2VDb2RlID0gZXhwb3J0cy5FbnVtUmVzcG9uc2VDb2RlO1xuLyoqXG4gKiBEZWZpbmVzIHRoZSBpbnRlcmZhY2UgZm9yIGFuIGFuYWx5c2lzXG4gKiByZXBvbnNlXG4gKi9cbi8qXG5leHBvcnQgaW50ZXJmYWNlIElSZXNwb25zZSB7XG4gIHJhdGluZyA6IG51bWJlcixcbiAgdHlwZSA6IEVudW1SZXNwb25zZUNvZGUsXG4gIHF1ZXJ5IDogc3RyaW5nLFxuICBjb250ZXh0IDogeyBba2V5OnN0cmluZ10gOnN0cmluZ30sXG4gIHRleHQgOiBzdHJpbmcsXG4gIGFjdGlvbiA6IElBY3Rpb24sXG4gIHByb21wdHMgOiB7IFtrZXkgOnN0cmluZyBdIDogeyB0ZXh0IDogc3RyaW5nLCBkZXNjcmlwdGlvbiA6IGFueSB9OyB9XG5cblxuZXhwb3J0IGNvbnN0IGVudW0gRW51bUFjdGlvblR5cGUge1xuICBTVEFSVFVSTCxcbiAgU1RBUlRDTURMSU5FXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgSUFjdGlvbiB7XG4gIGRhdGEgOiBhbnksXG4gIHR5cGUgOiBFbnVtQWN0aW9uVHlwZSxcbiAgcGF0dGVybiA6IHN0cmluZyxcbiAgY29uY3JldGUgOiBzdHJpbmdcbn1cbn0qL1xuLy92YXIgZXhlYyA9IHJlcXVpcmUoJ2NoaWxkX3Byb2Nlc3MnKS5leGVjXG5mdW5jdGlvbiBzdGFydEJyb3dzZXIob1VybEFjdGlvbikge1xuICAgIHZhciBjbWQgPSAnXCIlUHJvZ3JhbUZpbGVzKHg4NiklXFxcXEdvb2dsZVxcXFxDaHJvbWVcXFxcQXBwbGljYXRpb25cXFxcY2hyb21lLmV4ZVwiIC0taW5jb2duaXRvIC11cmwgXCInICsgb1VybEFjdGlvbi5jb25jcmV0ZSArICdcIic7XG4gICAgY2hpbGRfcHJvY2Vzc18xLmV4ZWMoY21kLCBmdW5jdGlvbiAoZXJyb3IsIHN0ZG91dCwgc3RkZXJyKSB7XG4gICAgICAgIGlmIChlcnJvcikge1xuICAgICAgICAgICAgY29uc29sZS5lcnJvcihcImV4ZWMgZXJyb3I6IFwiICsgZXJyb3IpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNvbnNvbGUubG9nKFwic3Rkb3V0OiBcIiArIHN0ZG91dCk7XG4gICAgICAgIGNvbnNvbGUubG9nKFwic3RkZXJyOiBcIiArIHN0ZGVycik7XG4gICAgfSk7XG59XG5mdW5jdGlvbiBzdGFydENvbW1hbmRMaW5lKHNjbWQpIHtcbiAgICB2YXIgY21kID0gc2NtZC5jb25jcmV0ZTtcbiAgICBjaGlsZF9wcm9jZXNzXzEuZXhlYyhjbWQsIGZ1bmN0aW9uIChlcnJvciwgc3Rkb3V0LCBzdGRlcnIpIHtcbiAgICAgICAgaWYgKGVycm9yKSB7XG4gICAgICAgICAgICBjb25zb2xlLmVycm9yKFwiZXhlYyBlcnJvcjogXCIgKyBlcnJvcik7XG4gICAgICAgICAgICByZXR1cm47XG4gICAgICAgIH1cbiAgICAgICAgY29uc29sZS5sb2coXCJzdGRvdXQ6IFwiICsgc3Rkb3V0KTtcbiAgICAgICAgY29uc29sZS5sb2coXCJzdGRlcnI6IFwiICsgc3RkZXJyKTtcbiAgICB9KTtcbn1cbmZ1bmN0aW9uIGV4cGFuZENvbnRleHRJbnRvQWN0aW9uKG9SZXN1bHQpIHtcbiAgICB2YXIgcGF0dGVybiA9IG9SZXN1bHQuYWN0aW9uLnBhdHRlcm47XG4gICAgT2JqZWN0LmtleXMob1Jlc3VsdC5jb250ZXh0KS5mb3JFYWNoKGZ1bmN0aW9uIChzS2V5KSB7XG4gICAgICAgIHZhciByZWdleCA9IG5ldyBSZWdFeHAoJ3snICsgc0tleSArICd9JywgJ2cnKTtcbiAgICAgICAgcGF0dGVybiA9IHBhdHRlcm4ucmVwbGFjZShyZWdleCwgb1Jlc3VsdC5jb250ZXh0W3NLZXldKTtcbiAgICAgICAgcGF0dGVybiA9IHBhdHRlcm4ucmVwbGFjZShyZWdleCwgb1Jlc3VsdC5jb250ZXh0W3NLZXldKTtcbiAgICB9KTtcbiAgICBvUmVzdWx0LmFjdGlvbi5jb25jcmV0ZSA9IHBhdHRlcm47XG4gICAgcmV0dXJuIHBhdHRlcm47XG59XG5leHBvcnRzLmV4cGFuZENvbnRleHRJbnRvQWN0aW9uID0gZXhwYW5kQ29udGV4dEludG9BY3Rpb247XG4vKipcbiAqIGV4ZWN1dGUgc29tZSBzdGFydXB0XG4gKlxuICovXG5mdW5jdGlvbiBleGVjdXRlU3RhcnR1cChvUmVzdWx0LCBjYikge1xuICAgIGlmIChvUmVzdWx0LnR5cGUgIT09IDEgLyogRVhFQyAqLykge1xuICAgICAgICByZXR1cm47XG4gICAgfVxuICAgIHZhciBhY3Rpb24gPSBvUmVzdWx0LmFjdGlvbjtcbiAgICBpZiAob1Jlc3VsdC5hY3Rpb24udHlwZSA9PT0gMCAvKiBTVEFSVFVSTCAqLykge1xuICAgICAgICAvL3ZhciBwdG4gPSBleHBhbmRQYXJhbWV0ZXJzSW5VUkwob1Jlc3VsdClcbiAgICAgICAgc3RhcnRCcm93c2VyKGFjdGlvbik7XG4gICAgICAgIHJldHVybiBhY3Rpb24uY29uY3JldGU7XG4gICAgfVxuICAgIGVsc2UgaWYgKG9SZXN1bHQuYWN0aW9uLnR5cGUgPT09IDEgLyogU1RBUlRDTURMSU5FICovKSB7XG4gICAgICAgIHN0YXJ0Q29tbWFuZExpbmUoYWN0aW9uKTtcbiAgICB9XG4gICAgZWxzZSB7XG4gICAgICAgIHZhciBzID0gKFwiRG9uJ3Qga25vdyBob3cgdG8gc3RhcnQgXCIgKyBvUmVzdWx0LnR5cGUgKyAnXFxuIGZvciBcIicgKyBvUmVzdWx0LnF1ZXJ5ICsgJ1wiJyk7XG4gICAgICAgIGNvbnNvbGUuZXJyb3Iocyk7XG4gICAgICAgIHJldHVybiBzO1xuICAgIH1cbn1cbm1vZHVsZS5leHBvcnRzID0ge1xuICAgIGV4ZWN1dGVTdGFydHVwOiBleGVjdXRlU3RhcnR1cFxufTtcbiJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==
